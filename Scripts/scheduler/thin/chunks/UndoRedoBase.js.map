{"version":3,"file":"UndoRedoBase.js","sources":["../../../../Core/lib/Core/widget/base/UndoRedoBase.js"],"sourcesContent":["import Container from '../Container.js';\nimport '../Combo.js';\n\n/**\n * @module Core/widget/base/UndoRedoBase\n */\n\n/**\n * Abstract base class used by UndoRedo widgets in Scheduler and TaskBoard.\n *\n * @extends Core/widget/Container\n * @abstract\n */\nexport default class UndoRedoBase extends Container {\n    static get $name() {\n        return 'UndoRedoBase';\n    }\n\n    static get type() {\n        return 'undoredobase';\n    }\n\n    static get configurable() {\n        return {\n            // Documented on subclasses\n            project : null,\n\n            stm : null,\n\n            /**\n             * Configure as `true` to show \"Undo\" and \"Redo\" as button texts. The buttons always have a tooltip\n             * as a hint to the user as to their purpose.\n             * @config {Boolean}\n             */\n            text : null,\n\n            /**\n             * Button color for the undo and redo buttons. See {@link Core.widget.Button#config-color}.\n             * @config {String}\n             */\n            color : null,\n\n            /**\n             * Configure as `true` to show \"0\" badge on the undo and redo buttons when they have no actions\n             * left to perform. By default when there are no actions, no badge is displayed.\n             * @config {Boolean}\n             */\n            showZeroActionBadge : null,\n\n            cls : 'b-undo-controls b-toolbar',\n\n            layoutStyle : {\n                alignItems : 'stretch',\n                flexFlow   : 'row nowrap',\n                overflow   : 'visible'\n            },\n\n            items : {\n                undoBtn : {\n                    type     : 'button',\n                    icon     : 'b-icon-undo',\n                    tooltip  : 'L{UndoRedo.UndoLastAction}',\n                    onAction : 'up.onUndo'     // 'up.' means method is on a parent Widget.\n                },\n                transactionsCombo : {\n                    type                 : 'combo',\n                    valueField           : 'idx',\n                    editable             : false,\n                    store                : {},\n                    emptyText            : 'L{UndoRedo.NoActions}',\n                    onAction             : 'up.onTransactionSelected',\n                    displayValueRenderer : 'up.transactionsDisplayValueRenderer'\n                },\n                redoBtn : {\n                    type     : 'button',\n                    icon     : 'b-icon-redo',\n                    tooltip  : 'L{UndoRedo.RedoLastAction}',\n                    onAction : 'up.onRedo'\n                }\n            }\n        };\n    }\n\n    afterConstruct() {\n        this.updateUndoRedoControls();\n    }\n\n    updateStm(stm) {\n        this.detachListeners('undoredo');\n\n        stm?.ion({\n            name          : 'undoredo',\n            recordingstop : 'updateUndoRedoControls',\n            restoringstop : 'updateUndoRedoControls',\n            queueReset    : 'updateUndoRedoControls',\n            disabled      : 'updateUndoRedoControls',\n            thisObj       : this\n        });\n    }\n\n    changeItems(items) {\n        const { undoBtn, redoBtn } = items;\n\n        if (this.color) {\n            undoBtn && (undoBtn.color = this.color);\n            redoBtn && (redoBtn.color = this.color);\n        }\n        if (this.text) {\n            undoBtn && (undoBtn.text = 'L{UndoRedo.Undo}');\n            redoBtn && (redoBtn.text = 'L{UndoRedo.Redo}');\n        }\n\n        return super.changeItems(items);\n    }\n\n    updateProject(project) {\n        this.stm = project.stm;\n    }\n\n    fillUndoRedoCombo() {\n        const { transactionsCombo } = this.widgetMap;\n        // The transactionsCombo may be configured away if only undo and redo buttons are wanted\n        transactionsCombo && (transactionsCombo.items = this.stm.queue.map((title, idx) => [idx, title || `Transaction ${idx}`]));\n    }\n\n    updateUndoRedoControls() {\n        const\n            {\n                stm,\n                showZeroActionBadge\n            } = this,\n            {\n                undoBtn,\n                redoBtn\n            } = this.widgetMap;\n\n        undoBtn.badge = stm.position || (showZeroActionBadge ? '0' : '');\n        redoBtn.badge = (stm.length - stm.position) || (showZeroActionBadge ? '0' : '');\n\n        undoBtn.disabled = !stm.canUndo;\n        redoBtn.disabled = !stm.canRedo;\n\n        this.fillUndoRedoCombo();\n    }\n\n    transactionsDisplayValueRenderer(record, combo) {\n        const stmPos = this.stm?.position || 0;\n\n        return `${stmPos} undo actions / ${combo.store.count - stmPos} redo actions`;\n    }\n\n    onUndo() {\n        this.stm.canUndo && this.stm.undo();\n    }\n\n    onRedo() {\n        this.stm.canRedo && this.stm.redo();\n    }\n\n    onTransactionSelected(combo) {\n        const\n            stm   = this.stm,\n            value = combo.value;\n\n        if (value >= 0) {\n            if (stm.canUndo && value < stm.position) {\n                stm.undo(stm.position - value);\n            }\n            else if (stm.canRedo && value >= stm.position) {\n                stm.redo(value - stm.position + 1);\n            }\n        }\n    }\n}\n\nUndoRedoBase.initClass();\n"],"names":["UndoRedoBase","Container","$name","type","configurable","project","stm","text","color","showZeroActionBadge","cls","layoutStyle","alignItems","flexFlow","overflow","items","undoBtn","icon","tooltip","onAction","transactionsCombo","valueField","editable","store","emptyText","displayValueRenderer","redoBtn","afterConstruct","updateUndoRedoControls","updateStm","detachListeners","ion","name","recordingstop","restoringstop","queueReset","disabled","thisObj","changeItems","updateProject","fillUndoRedoCombo","widgetMap","queue","map","title","idx","badge","position","length","canUndo","canRedo","transactionsDisplayValueRenderer","record","combo","_this$stm","stmPos","count","onUndo","undo","onRedo","redo","onTransactionSelected","value","initClass","_$name"],"mappings":"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"}