/*!
 *
 * Bryntum Scheduler Pro 5.3.7
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Sx=Object.defineProperty,wx=(e,r,t)=>r in e?Sx(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,R=(e,r,t)=>(wx(e,typeof r!="symbol"?r+"":r,t),t),Ov=(e,r,t)=>{if(!r.has(e))throw TypeError("Cannot "+t)},Dx=(e,r,t)=>(Ov(e,r,"read from private field"),t?t.call(e):r.get(e)),Ex=(e,r,t)=>{if(r.has(e))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(e):r.set(e,t)},Lv=(e,r,t,i)=>(Ov(e,r,"write to private field"),i?i.call(e,t):r.set(e,t),t),Y=class{static cacheFlags(e=navigator.platform,r=navigator.userAgent){const t=this;t._isLinux=!!e.match(/Linux/),t._isMac=!!e.match(/Mac/),t._isWindows=!!e.match(/Win32/),t._isWebkit=!!(r.match(/WebKit/)&&!r.match(/Edg/)),t._firefoxVersion=t.getVersion(r,/Firefox\/(\d+)\./),t._isFirefox=t._firefoxVersion>0,t._chromeVersion=t.getVersion(r,/Chrom(?:e|ium)\/(\d+)\./),t._isChrome=t._chromeVersion>0,t._isSafari=!!r.match(/Safari/)&&!t._isChrome,t._isMobileSafari=!!r.match(/Mobile.*Safari/),t._safariVersion=t.getVersion(r,/Version\/(.*).Safari/),t._isAndroid=!!r.match(/Android/g)}static get supportsOverflowClip(){if(this._supportsOverflowClip==null){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip=e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow")==="clip",e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,r){const t=e.match(r);return t?parseFloat(t[1]):0}static get isTouchDevice(){return this._isTouchDevice===void 0&&(this._isTouchDevice=globalThis.matchMedia("(pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return this._isHoverableDevice===void 0&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return typeof window!="undefined"}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get supportsRandomUUID(){if(this._supportsRandomUUID===void 0)try{this._supportsRandomUUID=globalThis.crypto.randomUUID().length>0}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,r;try{return e=localStorage,r="__storage_test__",e.setItem(r,r),e.removeItem(r),!0}catch(t){return t instanceof DOMException&&(t.code===22||t.code===1014||t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e.length!==0}}static setLocalStorageItem(e,r){this.storageAvailable&&localStorage.setItem(e,r)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,r=null,t=document.location.search){const i=new RegExp(`[?&]${e}=?([^&]*)`),n=t.match(i);return n&&n[1]||r}static getCookie(e){const r=encodeURIComponent(e)+"=",t=document.cookie.split(";");for(let i=0;i<t.length;i++){let n=t[i];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(r)===0)return decodeURIComponent(n.substring(r.length,n.length))}return""}static download(e,r){const t=document.createElement("a");t.download=e,t.href=r||e,t.style.cssText="display:none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}static downloadBlob(e,r){const t=globalThis.URL.createObjectURL(e);this.download(r,t),globalThis.URL.revokeObjectURL(t)}static get queryString(){var e;const r=new URL(globalThis.location.href).searchParams;return(e=Object.fromEntries)==null?void 0:e.call(Object,r.entries())}static copyToClipboard(e){let r=!0;const t=document.createElement("textarea");t.value=e,t.style.height=t.style.width=0,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(i){r=!1}return t.remove(),r}static isBryntumOnline(e){return e=Array.isArray(e)?e:[e],!!(/^(www\.)?bryntum\.com/.test(globalThis.location.host)||e!=null&&e.some(r=>this.queryString[r]!=null))}static get isCSP(){const{bryntum:e,document:r}=globalThis;return e.CSP==null&&(e.CSP=!!r.querySelector('meta[http-equiv="Content-Security-Policy"]')),e.CSP}static async setupClipboard(){return globalThis.bryntum.clipboard||(globalThis.bryntum.clipboard={hasNativeAccess:!0,async writeText(e,r){if(r&&this.hasNativeAccess)try{await navigator.clipboard.writeText(e)}catch(t){this.hasNativeAccess=!1}this._content=e},async readText(e){if(e&&this.hasNativeAccess)try{return await navigator.clipboard.readText()}catch(r){this.hasNativeAccess=!1}return this._content}}),globalThis.bryntum.clipboard}static async writeToClipboard(e,r=!0){return await(await this.setupClipboard()).writeText(e,r)}static async readFromClipboard(e=!0){return await(await this.setupClipboard()).readText(e)}};R(Y,"supportsPointerEvents",!!(globalThis.PointerEvent||globalThis.MSPointerEvent)),R(Y,"supportsPointerEventConstructor",typeof PointerEvent!="undefined"),R(Y,"PointerEventConstructor",globalThis.PointerEvent||globalThis.CustomEvent),Y.isBrowserEnv&&Y.cacheFlags(),Y._$name="BrowserHelper";var $v,jv,Bv,Hv,Vv=/([a-z])([A-Z])/g,xx=/[\n\r]/g,Rx=/[.*+?^${}()|[\]\\]/g,Tx=/[&<]/,Mx=/(^[^a-z]+[^\w]+)/gi,Px=/\s+/,Ix=/^[^a-z]+|[^\w:.-]+/gi,Ax=(e,r)=>jv[r.toLowerCase()]||String.fromCharCode(parseInt(r.substr(2),10)),_x=(e,r)=>$v[r],Fx=(e,r,t)=>`${r}-${t.toLowerCase()}`,kx=(e,r,t)=>`${r} ${t.toLowerCase()}`,Ox=e=>e?`_x${[...e].map(r=>r.charCodeAt(0).toString(16)).join("")}`:"__blank__",Nv={},zv={},Jr=class{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const r=Nv[e];return r||(Nv[e]=e.replace(Vv,Fx))}static separate(e){const r=zv[e];return r||(zv[e]=this.capitalize(e.replace(Vv,kx)))}static createId(e){return String(e).replace(Mx,Ox)}static makeValidDomId(e,r=""){return e==null?null:String(e).replace(Ix,r)}static escapeRegExp(e,r){let t=e.replace(Rx,"\\$&");return r!==void 0&&(t=new RegExp(t,r)),t}static decodeHtml(e){return e&&String(e).replace(Hv,Ax)}static encodeHtml(e=""){return e&&String(e).replace(Bv,_x)}static encodeHtmlBR(e){var r;return(r=Jr.encodeHtml(e))==null?void 0:r.replace(xx,"<br>")}static isHtml(e){return typeof e=="string"&&Tx.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const r=Object.keys(e);$v=e,jv=r.reduce((t,i)=>(t[e[i]]=i,t),{}),Bv=new RegExp(`([${r.map(t=>"[-]".includes(t)?"\\"+t:t).join("")}])`,"g"),Hv=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let r=null;try{r=JSON.parse(e)}catch(t){}return r}static safeJsonStringify(e,r=null,t=null){let i=null;try{i=JSON.stringify(e,r,t)}catch(n){}return i}static joinPaths(e,r="/"){return e.join(r).replace(new RegExp("\\"+r+"+","g"),r)}static split(e,r=Px){let t=e;return typeof t=="string"&&(t=e.trim(),t=t?t.split(r):[]),t}static xss(e,...r){const t=[];let i=r.length;for(t[i]=e[i];i-- >0;)t[i]=e[i]+Jr.encodeHtml(r[i]);return t.join("")}static xssBR(e,...r){const t=[];let i=r.length;for(t[i]=e[i];i-- >0;)t[i]=e[i]+Jr.encodeHtmlBR(r[i]);return t.join("")}static toJavaScriptValue(e,r){const t=U.typeOf(e);if(t==="boolean"||t==="string"||t==="number"||e===null)return Jr.safeJsonStringify(e);if(e===globalThis)return"window";if(t==="date")return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if(t==="array")return`[${e.map(i=>Jr.toJavaScriptValue(i,r))}]`;if(t==="object"||t==="instance")return this.toJavaScriptString(e,r);if(t==="function"){let i=e.toString();return i.match(/^async (\w+?)\(/)?i=i.replace(/^async (\w+?)\(/,"async function("):!i.startsWith("async(")&&i.match(/^(\w+?)\(/)&&(i=i.replace(/^(\w+?)\(/,"function(")),i}if(t==="class")return e.toJavaScriptValue?e.toJavaScriptValue(r):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name}static toJavaScriptString(e,r={}){var t;const i=(t=r.level)!=null?t:0,n=2;return`{
`+Object.keys(e).map(s=>" ".repeat((i+1)*n)+(s.match(/[- *]/)?`"${s}"`:s)+`: ${Jr.toJavaScriptValue(e[s],{...r,level:i+1})}`).join(`,
`)+`
`+" ".repeat(i*n)+"}"}static encodeAttributeSelector(e,r){return`[${e}="${String(r).replace(/["\\]/g,"\\$&")}"]`}static generateUUID(){var e;return Y.supportsRandomUUID?globalThis.crypto.randomUUID():(e=globalThis.crypto)!=null&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,r=>(r^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16)):`${Date.now()}-${++Jr.fakeNodeUUIDIndex}`}},L=Jr;R(L,"fakeNodeUUIDIndex",0),L.initHtmlEntities(),L._$name="StringHelper";var{hasOwnProperty:Lx,toString:$x}=Object.prototype,{isFrozen:Wv}=Object,jx=/\s*<\s*/,Bx=/\s*>\s*/,Uv={},Gv={},Yv=Object.freeze({}),U=class{static assign(e,...r){for(let t,i,n=0;n<r.length;n++)if(t=r[n],t)for(i in t)e[i]=t[i];return e}static assignIf(e,...r){for(let t,i,n=0;n<r.length;n++)if(t=r[n],t)for(i in t)(!(i in e)||e[i]===void 0)&&(e[i]=t[i]);return e}static blend(e,r,t){t=t||Uv,e=e||{};const{clone:i=U.clone,merge:n=U.blend}=t;if(Array.isArray(r)){if(r.length>1)return r.forEach(s=>{e=U.blend(e,s,t)}),e;r=r[0]}if(r){let s,a,o;for(a in r)o=r[a],o&&U.isObject(o)&&(s=e[a],t.key=a,s&&U.isObject(s)?(Wv(s)&&(e[a]=s=i(s,t)),o=n(s,o,t)):o=Wv(o)?o:i(o,t)),e[a]=o}return e}static clone(e,r){let t=e,i;if(e&&typeof e=="object")if(r&&typeof r=="object"&&r&&(r=null),U.isObject(e))if(e.skipClone)t=e;else{t={};for(i in e)t[i]=U.clone(e[i])}else if(Array.isArray(e))for(t=[],i=e.length;i-- >0;)t[i]=U.clone(e[i]);else U.isDate(e)?t=new Date(e.getTime()):r&&(t=r(e));return t}static createTruthyKeys(e){const r=L.split(e),t=r&&{};if(r)for(const i of r)i&&(t[i]=!0);return t}static getPath(e,r){return r.split(".").reduce((t,i)=>(t||Yv)[i],e)}static getPathDefault(e,r,t){const i=Array.isArray(r)?r:typeof r=="string"?r.split("."):[r],n=i.length-1;return i.reduce((s,a,o)=>(t&&!(a in s)&&(s[a]=o===n?t:{}),(s||Yv)[a]),e)}static hasPath(e,r){return r.split(".").every(t=>t in e?(e=e[t],!0):!1)}static getTruthyKeys(e){const r=[];for(const t in e)e[t]&&r.push(t);return r}static getTruthyValues(e){const r=[];for(const t in e)e[t]&&r.push(e[t]);return r}static isClass(e){var r;return typeof e=="function"&&((r=e.prototype)==null?void 0:r.constructor)===e}static isDate(e){return!!(e!=null&&e.getUTCDate)&&U.typeOf(e)==="date"}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||typeof(e==null?void 0:e.then)=="function";throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&typeof e=="object")for(const r in e)return!1;return!0}static isObject(e){const r=e==null?void 0:e.constructor;return!!(r?r===Object||r.getPrototypeOf&&r.prototype&&!Object.getPrototypeOf(r.prototype):e&&typeof e=="object")}static isInstantiated(e){return e?typeof e=="object"&&!U.isObject(e):!1}static merge(e,...r){return U.blend(e,r)}static mergeItems(e,r,t){t=t||Uv;let i,n,s,a,o,l,c;const{merge:d=U.blend}=t;if(e=e||{},Array.isArray(r))r.forEach(u=>{e=U.mergeItems(e,u,t)});else if(r)for(o in r)if(c=r[o],i=null,o.includes(">")?([o,i]=o.split(Bx),n=0):o.includes("<")&&([i,o]=o.split(jx),n=1),o in e)c&&e[o]&&d&&(t.key=o,c=d(e[o],c,t)),e[o]=c;else if(!i)e[o]=c,a==null||a.set(o,a.size);else{if(!a){a=new Map,s=0;for(const u in e)a.set(u,s++)}if(s=a.get(i),e[o]=c,s==null&&n)s=a.size;else{l=l||[],s=(s||0)+n;for(const u of a){const[h,f]=u;s<=f&&(l&&(l[a.size-f-1]=h),a.set(h,f+1))}if(l)for(;l.length;){const u=l.pop(),h=e[u];delete e[u],e[u]=h}}a.set(o,s)}return e}static setPath(e,r,t){return r.split(".").reduce((i,n,s,a)=>s===a.length-1?i[n]=t:(i[n]instanceof Object||(i[n]={}),i[n]),e),e}static typeOf(e){let r,t;return e===null?t="null":e!==e?t="nan":(t=typeof e,t==="object"?e.isBase?t="instance":Array.isArray(e)?t="array":(t=Gv[r=$x.call(e)])||(Gv[r]=t=r.slice(8,-1).toLowerCase()):t==="function"&&e.isBase&&(t="class")),t}};Object.defineProperty(U,"hasOwn",{value:Object.hasOwn||((e,r)=>Lx.call(e,r))}),U._$name="Objects";var re=class{static setVersion(e,r){e=e.toLowerCase(),Yt[e]={version:r,isNewerThan(n){return re.semanticCompareVersion(n,r,"<")},isOlderThan(n){return re.semanticCompareVersion(n,r,">")}};let t="";typeof productName!="undefined"&&(t=productName);const i=`${t}.${e}${r.replace(/\./g,"-")}`;if(Y.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(globalThis.bryntum[i]===!0)if(this.isTestEnv)globalThis.BUNDLE_EXCEPTION=!0;else{let n=t||e;n==="core"&&(n="grid");let s=L.capitalize(n);throw n==="schedulerpro"&&(s="SchedulerPro"),new Error(`The Bryntum ${s} bundle was loaded multiple times by the application.

Common reasons you are getting this error includes:

* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)
* Imports point to both sources and bundle
* Imports do not use the shortest relative path, JS treats them as different files
* Cache busters differ between imports, JS treats ${n}.module.js?1 and ${n}.module.js?2 as different files
* Imports missing file type, verify they all end in .js

See https://bryntum.com/products/${n}/docs/guide/${s}/gettingstarted/es6bundle#troubleshooting for more information

`)}else globalThis.bryntum[i]=!0}static getVersion(e){if(e=e.toLowerCase(),!Yt[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return Yt[e].version}static semanticCompareVersion(e,r,t="="){e=e||"",r=r||"";const i=e.split(/[-.]/),n=r.split(/[-.]/),s=t.includes("<"),a=(l,c)=>{const d=["rc","beta","alpha"],u=l.map(h=>{if(d.includes(h))return-d.indexOf(h)-2;const f=Number.parseInt(h);return Number.isNaN(f)?-d.length:f});for(;u.length<c;)u.push(-1);return u},o=()=>{const l=Math.max(i.length,n.length),c=a(i,l),d=a(n,l);for(let u=0;u<l;u++)if(c[u]!==d[u])return s?c[u]<d[u]:c[u]>d[u];return!0};switch(t){case"=":return e===r;case"<=":case">=":return e===r||o();case"<":case">":return e!==r&&o()}return!1}static checkVersion(e,r,t){return re.semanticCompareVersion(Yt.getVersion(e),r,t)}static deprecate(e,r,t){if(Yt.checkVersion(e,r,"<"))console.warn(`Deprecation warning: You are using a deprecated API which will change in v${r}. ${t}`);else throw new Error(`Deprecated API use. ${t}`)}static get isTestEnv(){var e,r,t;const i=!!((e=globalThis.bryntum)!=null&&e.isTestEnv);try{return i||!!((t=(r=globalThis.parent)==null?void 0:r.bryntum)!=null&&t.isTestEnv)}catch(n){return i}}static get isDebug(){return!1}},Yt=re;Y.isBrowserEnv&&(Yt.isTestEnv&&(Y._isHoverableDevice=!0),globalThis.bryntum=Object.assign(globalThis.bryntum||{},{getVersion:Yt.getVersion.bind(Yt),checkVersion:Yt.checkVersion.bind(Yt),deprecate:Yt.deprecate.bind(Yt),license:"182a63af-4479-11eb-b269-d094663d5c88"})),re._$name="VersionHelper";var{defineProperty:kl,getOwnPropertyDescriptor:qv}=Reflect,{hasOwnProperty:Kv,toString:Iu}=Object.prototype,Au=Symbol("instanceProperties"),Xv=Symbol("configuring"),Nn=Symbol("lazyConfigValues"),Zv=Iu.call(new Date),Hx=/\s+/,Vx=(e,r)=>(e[r]=1,e),Re=class{static get(e,r){const{cache:t}=this,i=t[e]||(t[e]=new Re(e));let n=i,s;return r&&(s=Re.makeCacheKey(e,r),(n=s&&t[s])||(n=i.extend(r),s&&(t[s]=n))),n}constructor(e){const r=this,t=e[0].toUpperCase()+e.substr(1);r.base=r,r.name=e,r.field="_"+e,r.capName=t,r.changer="change"+t,r.initializing="initializing"+t,r.updater="update"+t}get descriptor(){let e=this._descriptor;return(!e||!Kv.call(this,"_descriptor"))&&(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return(!e||!Kv.call(this,"_initDescriptor"))&&(this._initDescriptor=e=this.makeInitter()),e}equal(e,r){return e===r}extend(e){const r=Object.assign(Object.create(this),e),{equal:t,merge:i}=e,{equalityMethods:n}=Re;return typeof t=="string"&&(t.endsWith("[]")?r.equal=Re.makeArrayEquals(n[t.substr(0,t.length-2)]):r.equal=n[t]),typeof i=="string"&&(r.merge=Re.mergeMethods[i]),r}define(e){const r=qv(e,this.name);let t=this.descriptor;r&&r.get&&(t=Object.assign({},t),t.get=r.get),kl(e,this.name,t)}defineInitter(e,r){const{name:t}=this,i=e[Au];let n,s;!i[t]&&(s=qv(e,t))&&!("value"in s)&&(i[t]=s),kl(e,t,this.initDescriptor),this.lazy&&(n=e[Nn]||(e[Nn]=new Map),n.set(t,r))}static makeArrayEquals(e){return(r,t)=>{let i,n=r&&t&&r.length===(i=t.length);if(n&&Array.isArray(r)&&Array.isArray(t))if(e)for(;n&&i-- >0;)n=e(r[i],t[i]);else for(;n&&i-- >0;)n=r[i]===t[i];else n=e?e(r,t):r===t;return n}}static makeCacheKey(e,r){const t=Object.keys(r).sort();for(let i,n,s,a=t.length;a-- >0;)if(s=r[i=t[a]],s==null&&s===!1)t.splice(a,1);else{if(n=typeof s,n==="function")return null;n==="string"?t[a]=`${i}:"${s}"`:n==="number"&&(t[a]=`${i}:${s}`)}return t.length?`${e}>${t.join("|")}`:e}makeDescriptor(){const e=this,{base:r,field:t,changer:i,updater:n,name:s}=e;return r!==e&&r.equal===e.equal?r.descriptor:{get(){var a;return(a=this.configObserver)==null||a.get(s,this),this[t]},set(a){var o,l;const c=this;let d=c[t],u,h;if(typeof a=="string"){let f=a;a.startsWith("up.")?f=(o=c.owner)==null?void 0:o.resolveProperty(a.substr(3)):a.startsWith("this.")&&(f=c.resolveProperty(a.substr(5))),f!==void 0&&typeof f!="function"&&(a=f)}c[i]&&(u=(h=c[i](a,d))===void 0,u||(a=h,d=c[t])),!u&&!(e.equal===Jv?d===a:e.equal(d,a))&&(c[t]=a,u=!0,(l=c[n])==null||l.call(c,a,d)),u&&!c.isDestroyed&&!c.onConfigChange.$nullFn&&c.onConfigChange({name:s,value:a,was:d,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:r,name:t}=e;return{configurable:!0,get(){const i=this;return e.removeInitter(i),i[r]=!0,i[t]=i[Xv][t],i[r]=!1,i.configDone[t]=!0,i[t]},set(i){e.removeInitter(this),this.configDone[t]=!0,this[t]=i}}}makeLazyInitter(){const e=this,{initializing:r,name:t}=e;return{configurable:!0,get(){const i=this,n=i[Nn].get(t);return e.removeInitter(i),i.isDestroying||(i[r]=!0,i[t]=n,i[r]=!1),i[t]},set(i){e.removeInitter(this),this[t]=i}}}removeInitter(e){const{name:r}=this,t=e[Au][r],i=e[Nn];t?kl(e,r,t):delete e[r],i!=null&&i.delete(r)&&!i.size&&delete e[Nn]}setDefault(e,r){kl(e.prototype,this.field,{configurable:!0,writable:!0,value:r})}merge(e,r){if(r&&e&&U.isObject(e)){if(r.isBase)return r.setConfig(e);U.isObject(r)&&(e=U.merge(U.clone(r),e))}return e}},{prototype:Da}=Re,{equal:Jv}=Da;Re.symbols={configuring:Xv,instanceProperties:Au,lazyConfigs:Nn},Re.cache=Object.create(null),Re.equalityMethods={array:Re.makeArrayEquals(),date(e,r){return e===r?!0:e&&r&&Iu.call(e)===Zv&&Iu.call(r)===Zv?e.getTime()===r.getTime():!1},strict:Re.equal=Jv},Re.mergeMethods={distinct(e,r){let t=r?r.slice():[];if(e!=null)if(U.isObject(e))if(r===void 0)t=e;else{let i,n;for(i in e)n=t.indexOf(i),e[i]?n<0&&t.push(i):n>-1&&t.splice(n,1)}else Array.isArray(e)?e.forEach(i=>!t.includes(i)&&t.push(i)):t.includes(e)||t.push(e);return t},merge:Re.merge=Da.merge,classList(e,r){if(typeof e=="string"){if(!e.length)return r;e=e.split(Hx)}return Array.isArray(e)&&(e=e.reduce(Vx,{})),Re.merge(e,r)},objects(e,r){return e===!0?r||{}:Re.merge(e,r)},replace(e){return e},items(e,r,t,i){return i?U.mergeItems(r,e,{merge:(n,s)=>Da.merge(s,n)}):Da.merge(e,r)}},Object.assign(Da,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),Re._$name="Config";var Nx=class{constructor(e){e&&Object.assign(this,e)}getInherited(e,r=!0){var t;let i=this[e];return e in this||(i=(t=this.super)==null?void 0:t.getInherited(e,r),(i||r)&&(this[e]=i=Object.create(i||null))),i}},{getPrototypeOf:Qv}=Object,{hasOwn:rr}=U,{defineProperty:ey}=Reflect,Ol=Symbol("classMetaData"),ty=Symbol("mixinTag"),_u=Symbol("originalConfig"),j_=Symbol("createdAt"),Fr=Re.symbols.configuring,zx=Re.symbols.instanceProperties,Ea=Re.symbols.lazyConfigs,Wx={merge:"replace",simple:!0},Ll=()=>{},ry=e=>new Nx(e),iy={},Ux=Object.freeze({}),ny=Object.freeze([]),F=class{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const r=this,t=r.constructor;r.$meta.class!==t&&Ll(t.$meta),r.construct(...e),r.afterConstruct(),r.isConstructing=!1}static new(...e){return e=e.filter(r=>r),new this(e.length>1?this.mergeConfigs(...e):e[0])}construct(...e){e[0]!==null&&this.configure(...e),this.afterConfigure()}static destroy(...e){const r=t=>{t!=null&&t.destroy?t.destroy():Array.isArray(t)&&t.forEach(r)};r(e)}destroy(){const e=this,{id:r}=e;e.isDestroying=!0,e.destroy=Ll,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)t!=="destroy"&&t!=="isDestroying"&&delete e[t];delete e[_u],e.isDestroyed=!0,e.id=r}_thisIsAUsedExpression(e){}static get $$name(){return rr(this,"$name")&&this.$name||rr(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,r,t=ny){const{handler:i,thisObj:n}=this.resolveCallback(e,r==="this"?this:r)||Ux;return i==null?void 0:i.apply(n,t)}resolveProperty(e){let r=this;for(;r;){if(U.hasPath(r,e))return U.getPath(r,e);r=r.owner}}resolveCallback(e,r=this,t=!0){if(e!=null&&e.substring){if(e.endsWith("?")&&(t=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),r=this.owner;r&&!r[e];r=r.owner);if(!r)return}else e.startsWith("this.")&&(e=e.substring(5),r=this);if(!r||!(r instanceof Object))return;e=r[e]}if(typeof e=="function")return{handler:e,thisObj:r};if(t)throw new Error(`No method named ${e} on ${r.$$name||"thisObj object"}`)}bindCallback(e,r=this){if(e){const{handler:t,thisObj:i}=this.resolveCallback(e,r);if(t)return t.bind(i)}}delay(e,r,t=e.name||e){return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:globalThis)[typeof r=="number"?"setTimeout":"requestAnimationFrame"](e,r,t)}doDestroy(){const e=this,{nullify:r}=e.$meta;if(r)for(let t=0;t<r.length;++t)e[r[t].field]!=null&&(e[r[t].name]=null)}destroyProperties(...e){var r,t;const i=this;let n;for(n of e)n in i&&(!i[Fr]||!i[Fr][n])&&((t=(r=i[n])==null?void 0:r.destroy)==null||t.call(r),delete i[n])}configure(e={}){const r=this,t=r.$meta,{beforeConfigure:i}=e,n=t.configs,s=r.getDefaultConfiguration();let a,o,l;r.initialConfig=e,r.isConfiguring=!0,Object.assign(r,r.getProperties());for(o in e)l=e[o],a=n[o],s[o]=a?a.merge(l,s[o],null,t):l;i&&(delete s.beforeConfigure,i(r,s)),r.setConfig(r[_u]=s,!0),r.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,r){var t;const i=this,n=i[Fr],s=n?i.configDone:i.configDone={},a=i.$meta.configs;let o,l;i[zx]={},i[Fr]=n?Object.setPrototypeOf(Object.assign({},e),n):e;for(l in e)e[l]!=null||rr(e,l)?(o=a[l]||Re.get(l),o.defineInitter(i,e[l]),r||(s[l]=!1)):s[l]=!0;r&&i.startConfigure(e);for(l in e)!s[l]&&!((t=a[l])!=null&&t.lazy)&&(i[l]=e[l]);return n?i[Fr]=n:delete i[Fr],r&&i.finishConfigure(e),i}hasConfig(e){var r;const t=this,i=t[Fr];return!!(t["_"+e]!=null||((r=t[Ea])==null?void 0:r.get(e))!=null||!t.configDone[e]&&i&&(i[e]!=null||rr(i,e)))}peekConfig(e){const r=this,t=r[Ea],i=r[Fr];if(t!=null&&t.has(e))return t.get(e);if(i&&e in i){if(r.configDone[e])return r[e];if(i[e]!=null||rr(i,e))return i[e]}}triggerConfig(e){const r=this,{configDone:t}=r,i=r[Ea],n=r[Fr],s=i!=null&&i.has(e)||n&&(n[e]!=null||rr(n,e))?!t[e]:null;return s&&r.getConfig(e),s}triggerConfigs(e){const r=this,t=r.$meta.configs,i=r[Ea],n=i?[...i.keys()].filter(s=>t[s].lazy===e):ny;for(const s of n)r.triggerConfig(s);return n.length?n:null}onConfigChange(){}get config(){const e={},r=this[_u];for(const t in r)e[t]=r[t];return e}static processConfigValue(e,r){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map(t=>F.processConfigValue(t,r));if(e instanceof F)return r.visited.has(e)?void 0:e.getCurrentConfig(r);if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(U.isObject(e)){const t={};for(const i in e)i!=="owner"&&(t[i]=F.processConfigValue(e[i],r));return t}return e}getConfigValue(e,r){var t;const i=this,n=i[Ea];if(!((t=i.$meta.configs[e])!=null&&t.lazy))return F.processConfigValue(i[e],r);if(n!=null&&n.has(e))return F.processConfigValue(n.get(e),r)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const r=this,t=e.configs==="all"?r.config:U.clone(r.initialConfig),i=e.visited||(e.visited=new Set),n=e.depth||(e.depth=0),s={};if(!i.has(r)){i.add(r),this.preProcessCurrentConfigs(t);for(const a in t){const o=r.getConfigValue(a,{...e,depth:n+1});o!==void 0&&(s[a]=o)}return s}}getConfigString(e={}){return L.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const r=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(r){const t=r.toLowerCase(),i=`../../build/${t}.module.js`;let n,s;e.import==="static"?(n=`import * as module from "${i}";Object.assign(window, module);`,s=""):(n=`import("${i}").then(module => { Object.assign(window, module);
`,s="});");const a=re.getVersion(t);return a&&(n+=`
console.log('${r} ${a}');
`),`${n}      
const ${t} = new ${r}(${this.getConfigString(e)});
${s}`}}downloadTestCase(e={}){e.output="return";const r=this.getTestCase(e);Y.download("app.js","data:application/javascript;charset=utf-8,"+escape(r))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let r=e[Ol];return rr(e,Ol)||(e[Ol]=r=ry(),r.class=e,e.setupClass(r)),r}static onClassMixedIn(){}static mergeConfigs(e,...r){const t=this.$meta.configs,i=U.clone(e)||{};let n,s,a,o;for(s=0;s<r.length;++s)if(n=r[s],n)for(a in n)o=n[a],t[a]?o=t[a].merge(o,i[a]):i[a]&&o&&(o=Re.merge(o,i[a])),i[a]=o;return i}static mixin(...e){let r=this,t;for(t=0;t<e.length;++t){const i=e[t],n=i[ty]||(i[ty]=Symbol("mixinTag"));r[n]||(r=i(r),r[n]=!0,rr(r,"onClassMixedIn")&&r.onClassMixedIn())}return r}static setupClass(e){var r;const t=e.class,i=Qv(t).$meta,n=t.$$name,s=i.names,a=t.prototype;if(ey(a,"$meta",{value:e}),Object.assign(e,{super:i,config:Object.create(i.config),configs:Object.create(i.configs),declarables:i.declarables,forkConfigs:i.forkConfigs,hierarchy:Object.freeze([...i.hierarchy,t]),names:s.includes(n)?s:Object.freeze([...s,n]),properties:i.properties,nullify:(r=i.nullify)==null?void 0:r.slice()}),s!==e.names){const o=`is${n}`,l=c=>{rr(c,o)||ey(c,o,{get(){return rr(typeof c=="object"?c.constructor:c,"$name")||console.warn(`$name static property or getter required for class ${n} to provide class name for minified sources.`+(re.isTestEnv?"":`
https://bryntum.com/products/grid/docs/api/Core/widget/Widget#property-$name-static`)),!0}})};l(a),l(t)}for(let o,l,c=0;c<e.declarables.length;++c)o=e.declarables[c],rr(t,o)&&(l=iy[o]||(iy[o]=`setup${L.capitalize(o)}`),t[l](t,e))}static setupConfigs(e,r,t){const i=e.config,n=e.configs,s=e.class,a=e.super;let{nullify:o}=e,l,c,d,u,h,f;for(const g in r)h=r[g],t?(l=n[g])?h=l.merge(h,i[g],e,a):l=Re.get(g,Wx):(c=d=u=void 0,h&&typeof h=="object"&&"$config"in h&&(d=h.$config,d&&!U.isObject(d)&&(d=U.createTruthyKeys(d)),u="default"in h,c=u?h.default:c,h=h.value),(l=n[g])?(f=l.nullify,d&&(l=l.extend(d)),h=l.merge(h,i[g],e,a)):(l=Re.get(g,d),l.define(s.prototype),u=!(l.field in s.prototype),f=!1),u&&l.setDefault(s,c),l.nullify&&!f&&(o||(o=e.nullify||(e.nullify=[]))).push(l)),h&&(U.isObject(h)||Array.isArray(h))&&!Object.isFrozen(h)&&(e.forkConfigs=!0),n[g]=l,i[g]=h}static setupConfigurable(e,r){e.setupConfigs(r,e.configurable,!1)}static setupDefaultConfig(e,r){e.setupConfigs(r,e.defaultConfig,!0)}static setupDeclarable(e,r){const t=e.declarable;let i=r.declarables,n,s;for(s=0;s<t.length;++s)i.includes(t[s])||(n||(r.declarables=n=i=i.slice()),i.push(t[s]))}static setupProperties(e,r){r.properties=r.super.properties.slice(),r.properties.push(e),Object.freeze(r.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,r=e.forkConfigs?F.fork(e.config):Object.create(e.config);if(re.isTestEnv&&Y.isBrowserEnv&&r.testConfig&&globalThis.__applyTestConfigs)for(const t in r.testConfig)r[t]=r.testConfig[t];return r}static fork(e){let r=e,t,i;if(e&&U.isObject(e)&&!Object.isFrozen(e)){r=Object.create(e);for(t in e)i=e[t],i&&(U.isObject(i)?r[t]=F.fork(i):Array.isArray(i)&&(r[t]=i.slice()))}return r}getProperties(){const e=this.$meta.properties,r={};for(let t=0;t<e.length;t++)Object.assign(r,e[t].properties);return r}static get superclass(){return Qv(this)}classHierarchy(e){const r=this.$meta.hierarchy,t=e?r.indexOf(e):0;return t>0?r.slice(t):r}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){let r=this.$detachers;if(r=r==null?void 0:r[e],r)for(;r.length;)r.pop()()}trackDetacher(e,r){const t=this.$detachers||(this.$detachers={});(t[e]||(t[e]=[])).push(r)}untrackDetachers(e){const r=this.$detachers;if(r)for(const t in r){const i=r[t];for(let n=i.length;n-- >0;)i[n].eventer===e&&i.splice(n,1)}}},Fu=F.prototype;Fu.onConfigChange.$nullFn=Ll.$nullFn=!0,F[Ol]=Fu.$meta=ry({class:F,config:Object.freeze({}),configs:Object.create(null),declarables:F.declarable,forkConfigs:!1,hierarchy:Object.freeze([F]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(Fu,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),F.emptyFn=Ll,re.setVersion("core","5.3.7"),F._$name="Base";var H=class{static clean(e){return e.reduce((r,t)=>(t!=null&&!(Array.isArray(t)&&t.length===0)&&t!==""&&r.push(t),r),[])}static from(e,r,t){const i=[];if(e)for(const n of e)(!r||r(n))&&i.push(t?t(n):n);return i}static remove(e,...r){let t,i,n=!1;r=r[0]instanceof Set?[...r[0]]:r;for(let s=0;s<r.length;s++)i=r[s],(t=e.indexOf(i))!==-1&&(e.splice(t,1),n=!0);return n}static findInsertionIndex(e,r,t=this.lexicalCompare,i){const n=r.length;let s,a;return i<n&&(s=i>0?t(r[i-1],e):0,a=i<n-1?t(e,r[i]):0,s<1&&a<1)?i:this.binarySearch(r,e,t)}static findLast(e,r,t){for(let{length:i}=e,n=i-1;n>=0;n--)if(r.call(t,e[n],n,e))return e[n]}static binarySearch(e,r,t=0,i=e.length,n=this.lexicalCompare){const s=e.length;let a,o;for(t instanceof Function?(n=t,t=0):i instanceof Function&&(n=i,i=s),--i;t<=i;)a=t+i>>1,o=n(r,e[a]),o>=0?t=a+1:o<0&&(i=a-1);return t}magnitudeCompare(e,r){return e<r?-1:e>r?1:0}lexicalCompare(e,r){return e=String(e),r=String(r),e<r?-1:e>r?1:0}static fill(e,r={},t=null){const i=[],n=Array.isArray(r)?r:[r];for(let s=0;s<e;s++)for(const a of n){const o=Object.assign({},a);t&&t(o,s),i.push(o)}return i}static populate(e,r,t=!1){const i=[];for(let n=0;n<e;n++)i.push(r(n+(t?1:0)));return i}static include(e,...r){for(const t of r)e.includes(t)||e.push(t)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(r,t,i){if(typeof t!="string")return Reflect.get(r,t,i);const n=Number(t);return Number.isNaN(n)?Reflect.get(r,t,i):r[n<0?r.length+n:n]},set(r,t,i,n){if(typeof t!="string")return Reflect.set(r,t,i,n);const s=Number(t);return Number.isNaN(s)?Reflect.set(r,t,i,n):(r[s<0?r.length+s:s]=i,!0)}})}static delta(e,r,t=!1){if(!r)return t?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const i=[],n=[],s=new Set,a=new Set(r);for(let o=0;o<e.length;o++){const l=e[o];a.has(l)?s.add(l):i.push(l)}for(let o=0;o<r.length;o++){const l=r[o];s.has(l)||n.push(l)}return t?{toAdd:i,toRemove:n,toKeep:s}:{onlyInA:i,onlyInB:n,inBoth:[...s]}}static asArray(e){return e==null?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,r,t=H.identity){const i=typeof r=="string"?s=>s==null?void 0:s[r]:r,n=typeof t=="string"?s=>s==null?void 0:s[t]:t;return e.reduce((s,a)=>(s[i(a)]=n(a),s),{})}static groupBy(e,r){const t=typeof r=="string"?i=>i==null?void 0:i[r]:r;return e.reduce((i,n)=>{const s=t(n);return(i[s]=i[s]||[]).push(n),i},{})}};H._$name="ArrayHelper";var sy=/,\s*/,ku=Symbol("decompiled"),Gx=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,Yx=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,qx=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:Kx}=Object.prototype,Te=class{static after(e,r,t,i,n){const s=typeof t=="string",a=(n==null?void 0:n.return)!==!1,o=(...l)=>{const c=o.$nextHook.call(e,...l),d=i!=null&&i.isDestroyed?void 0:a?s?i[t](c,...l):t.call(i,c,...l):s?i[t](...l):t.call(i,...l);return d===void 0?c:d};return Te.hookMethod(e,r,o)}static before(e,r,t,i){const n=typeof t=="string",s=(...a)=>{const o=i!=null&&i.isDestroyed?0:n?i[t](...a):t.call(i,...a);return o===!1?o:s.$nextHook.call(e,...a)};return Te.hookMethod(e,r,s)}static curry(e){return function r(...t){return t.length>=e.length?e.apply(this,t):function(...i){return r.apply(this,t.concat(i))}}}static bindAll(e){for(const r in e)typeof e[r]=="function"&&(e[r]=e[r].bind(e))}static createInterceptor(e,r,t){return function(...i){const n=t||this;return r.call(n,...i)!==!1?e.call(n,...i):!1}}static createSequence(e,r,t){return(...i)=>{const n=e.call(t,...i),s=r.call(t,...i);return s===void 0?n:s}}static createThrottled(e,r,t,i,n){let s=-Number.MAX_VALUE,a,o;const l=()=>{o=0,s=performance.now(),a.push.apply(a,i),e.apply(t,a)},c=function(...d){const u=performance.now()-s;a=d,u>=r?(clearTimeout(o),l()):(o||(o=setTimeout(l,r-u)),n&&(a.push.apply(a,i),n.apply(t,a)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,r,t,i){let n,s;const a=()=>{s=0,o.isPending=!1,n.push.apply(n,i),e.apply(t,n)},o=function(...l){n=l,s&&clearTimeout(s),o.isPending=!0,s=setTimeout(a,r)};return o.cancel=()=>{o.isPending=!1,clearTimeout(s)},o}static decompile(e){if(!(ku in e)){const r=e.toString();let t=Gx.exec(r),i,n,s,a,o;t?(i=[t[2]],n=t[3]):(t=Yx.exec(r))?(o=t[2].trim(),i=o?o.split(sy):[],n=t[3]):(t=qx.exec(r))&&(s=t[2],o=t[3].trim(),i=o?o.split(sy):[],n=t[4]),n=n==null?void 0:n.trim(),e[ku]=a=t&&{args:i,async:!!t[1],body:n!=null&&n.startsWith("{")?n.substring(1,n.length-1).trim():n},s&&(a.name=s)}return e[ku]}static hookMethod(e,r,t){return t.$nextHook=e[r],e[r]=t,()=>{var i;if(Kx.call(e,r)){let n=e[r],s;if(n===t)((i=Object.getPrototypeOf(e))==null?void 0:i[r])===t.$nextHook?delete e[r]:e[r]=t.$nextHook;else for(;s=n==null?void 0:n.$nextHook;n=s)if(s===t){n.$nextHook=t.$nextHook;break}}}}static noThrow(e,r,t){const i=e[r];e[r]=(...n)=>{try{return i.apply(e,n)}catch(s){return t==null?void 0:t(s)}}}static returnTrue(){return!0}static animate(e,r,t,i="linear"){let n=!1;const s=new Promise(a=>{const o=performance.now(),l=()=>{const c=Math.min((performance.now()-o)/e,1),d=t&&t.setTimeout?t:globalThis;n||r.call(t,this.easingFunctions[i](c))===!1&&a(),n||c===1?d.requestAnimationFrame(()=>a()):d.requestAnimationFrame(l)};l()});return s.cancel=()=>(n=!0,!1),s}},Me=.5,Qr=1.70158,qt=7.5625,$l=1.525,Ou=2/2.75,Lu=2.25/2.75,$u=1/2.75,ju=1.5/2.75,Bu=2.5/2.75,Hu=2.625/2.75,Vu=.75,Nu=.9375,zu=.984375,Xx=1.70158,Zx=1.70158;Te.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=Me)<1?Me*Math.pow(e,2):-Me*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=Me)<1?Me*Math.pow(e,3):Me*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=Me)<1?Me*Math.pow(e,4):-Me*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=Me)<1?Me*Math.pow(e,5):Me*(Math.pow(e-2,5)+2),easeInSine:e=>-Math.cos(e*(Math.PI/2))+1,easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-Me*(Math.cos(Math.PI*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>e===0?0:e===1?1:(e/=Me)<1?Me*Math.pow(2,10*(e-1)):Me*(-Math.pow(2,-10*--e)+2),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=Me)<1?-Me*(Math.sqrt(1-e*e)-1):Me*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<$u?qt*e*e:e<Ou?qt*(e-=ju)*e+Vu:e<Bu?qt*(e-=Lu)*e+Nu:qt*(e-=Hu)*e+zu,easeInBack:e=>e*e*((Qr+1)*e-Qr),easeOutBack:e=>(e=e-1)*e*((Qr+1)*e+Qr)+1,easeInOutBack:e=>{let r=Xx;return(e/=Me)<1?Me*(e*e*(((r*=$l)+1)*e-r)):Me*((e-=2)*e*(((r*=$l)+1)*e+r)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((e*6-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let r=Zx;return(e/=Me)<1?Me*(e*e*(((r*=$l)+1)*e-r)):Me*((e-=2)*e*(((r*=$l)+1)*e+r)+2)},swingFrom:e=>e*e*((Qr+1)*e-Qr),swingTo:e=>(e-=1)*e*((Qr+1)*e+Qr)+1,bounce:e=>e<$u?qt*e*e:e<Ou?qt*(e-=ju)*e+Vu:e<Bu?qt*(e-=Lu)*e+Nu:qt*(e-=Hu)*e+zu,bouncePast:e=>e<$u?qt*e*e:e<Ou?2-(qt*(e-=ju)*e+Vu):e<Bu?2-(qt*(e-=Lu)*e+Nu):2-(qt*(e-=Hu)*e+zu),easeFromTo:e=>(e/=Me)<1?Me*Math.pow(e,4):-Me*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},Te._$name="FunctionHelper";var{isArray:ay}=Array,{hasOwnProperty:Jx}=Object.prototype,oy={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},ly=(e,r)=>r.prio-e.prio,Ae=e=>class Av extends(e||F){constructor(){super(...arguments),R(this,"eventsSuspended",null)}static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(t,i){const n=i.getInherited("deprecatedEvents"),s=t.deprecatedEvents;for(const a in s)n[a.toLowerCase()]=n[a]=s[a]}static get configurable(){return{listeners:{value:null,$config:{merge(t,i){if(t!==null){if(!t)return i;i&&(t=t?[t]:[],t.push[ay(i)?"apply":"call"](t,i))}return t}}},internalListeners:null,bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(t,...i){(this.configuredListeners=t==null?void 0:t.listeners)&&(t=U.assign({},t),delete t.listeners),super.construct(t,...i),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const t=this,{isConfiguring:i}=t;t.isConfiguring=!1,t.listeners=t.configuredListeners,t.configuredListeners=null,t.isConfiguring=i}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(t){super.setupClass(t),Av.prototype.onListen.$nullFn=!0,Av.prototype.onUnlisten.$nullFn=!0}addListener(t,i,n){if(ay(t)){for(let o=0,{length:l}=t;o<l;o++)this.addListener(t[o],i);return}const s=this,a=s.$meta.getInherited("deprecatedEvents");if(typeof t=="string")return s.addListener({[t]:i,detachable:i.detachable!==!1,thisObj:n});{i=t.thisObj=t.thisObj!==void 0?t.thisObj:i;for(const d in t)if(!oy[d]&&t[d]!=null){const u=d.toLowerCase(),h=a==null?void 0:a[u],f=s.eventListeners||(s.eventListeners={}),g=t[d],m=g.expires||t.expires,p={fn:typeof g=="object"?g.fn:g,thisObj:g.thisObj!==void 0?g.thisObj:i,args:g.args||t.args,prio:g.prio!==void 0?g.prio:t.prio!==void 0?t.prio:0,once:g.once!==void 0?g.once:t.once!==void 0?t.once:!1,buffer:g.buffer||t.buffer,throttle:g.throttle||t.throttle,$internal:t.$internal,catchAll:d==="catchAll"};if(h){const{product:y,invalidAsOfVersion:S,message:D}=h;re.deprecate(y,S,D)}if(m){const{alt:y}=m,S=y?m.delay:m,D=t.name||d,w=()=>{s.un(u,p),y&&!p.called&&s.callback(y,i)};s.isDelayable?s.setTimeout({fn:w,name:D,cancelOutstanding:!0,delay:S}):globalThis.setTimeout(w,S)}let v=f[u]||(f[u]=[]);v.$firing&&(f[u]=v=v.slice()),v.splice(H.findInsertionIndex(p,v,ly,v.length),0,p),!s.onListen.$nullFn&&v.length<2&&s.onListen(u)}t.relayAll&&s.relayAll(t.relayAll),i&&i!==s&&s.attachAutoDetacher(t,i);const o=t.detachable!==!1,l=t.name,c=t.expires||o||l?()=>{s.isDestroyed||s.removeListener(t,i)}:null;if(c&&(c.eventer=s,c.listenerName=l,l&&(i!=null&&i.trackDetacher)&&i.trackDetacher(l,c),t.expires&&s.delay(c,isNaN(t.expires)?t.expires.delay:t.expires,l),o))return c}}on(t,i,n){return this.addListener(t,i,n)}ion(t){return t.$internal=!0,this.on(t)}un(...t){this.removeListener(...t)}updateInternalListeners(t,i){i==null||i.detach(),t&&(t.detach=this.ion(t))}get listeners(){return this.eventListeners}changeListeners(t){if(this.isConfiguring)this.getConfig("internalListeners"),t&&this.on(t,this);else{if(Array.isArray(t))for(let i=0,n=t[0],{length:s}=t;i<s;n=t[++i])"thisObj"in n||(t[i]=U.assign({thisObj:this},n));else t&&!("thisObj"in t)&&(t=U.assign({thisObj:this},t));return t}}updateListeners(t,i){i&&this.un(i),t&&this.on(t)}removeListener(t,i=t.thisObj,n){const s=this;if(typeof t=="string")return s.removeListener({[t]:i},n);Object.entries(t).forEach(([a,o])=>{if(!oy[a]&&o!=null){a=a.toLowerCase();const l=s.eventListeners,c=s.findListener(a,o,i);if(c>=0){let d=l[a];d.length>1?(d.$firing&&(l[a]=d=d.slice()),d.splice(c,1)):(delete l[a],s.onUnlisten.$nullFn||s.onUnlisten(a))}}}),t.thisObj&&!t.thisObj.isDestroyed&&s.detachAutoDetacher(t)}findListener(t,i,n){var s;const a=(s=this.eventListeners)==null?void 0:s[t],o=i.fn||i,l=i.thisObj||n;if(a){for(let c,d=0,{length:u}=a;d<u;d++)if(c=a[d],c.fn===o&&c.thisObj===l)return d}return-1}hasListener(t){var i;return!!((i=this.eventListeners)!=null&&i[t==null?void 0:t.toLowerCase()])}relayAll(t,i,n=!0){this.relayAllTargets||(this.relayAllTargets=[]);const s=this.relayAllTargets;t.on({beforeDestroy:({source:a})=>{a===t&&s.filter(l=>l.through===t).forEach(l=>H.remove(s,l))}}),s.push({through:t,prefix:i,transformCase:n})}removeAllListeners(t=!0){var i;const n=this.eventListeners;let s,a;for(const o in n){const l=n[o];for(s=l.length;s-- >0;){const c=l[s];(!c.$internal||!t)&&(this.removeListener(o,c),a=c.thisObj,(i=a==null?void 0:a.untrackDetachers)==null||i.call(a,this))}}}relayEvents(t,i,n=""){const s={detachable:!0,thisObj:this};return i.forEach(a=>{s[a]=(o,...l)=>this.trigger(n+a,o,...l)}),t.on(s)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:t,target:i,oldDestructor:n}=this;for(let s=0;s<t.length;s++){const{dispatcher:a,config:o}=t[s];a.isDestroyed||a.removeListener(o,i)}n.call(i)}attachAutoDetacher(t,i){const n=t.thisObj||i,s="doDestroy"in n?"doDestroy":"destroy";if(s in n){let{$autoDetachers:a}=n;a||(n.$autoDetachers=a=[]),n.$oldDestructor||(n.$oldDestructor=n[s],n[s]=this.destructorInterceptor.bind({autoDetachers:a,oldDestructor:n.$oldDestructor,target:n})),a.push({config:t,dispatcher:this})}else n[s]=()=>{this.removeListener(t)}}detachAutoDetacher(t){const i=t.thisObj;i.$oldDestructor&&!i.isDestroying&&(H.remove(i.$autoDetachers,i.$autoDetachers.find(n=>n.config===t&&n.dispatcher===this)),i.$autoDetachers.length||(i["doDestroy"in i?"doDestroy":"destroy"]=i.$oldDestructor,i.$oldDestructor=null))}await(t,i={checkLog:!0,resetLog:!0,args:null}){const n=this;i===!1&&(i={checkLog:!1});const{args:s}=i;return new Promise(a=>{var o;if(i.checkLog&&((o=n._triggered)!=null&&o[t])&&(a(),i.resetLog&&n.clearLog(t)),s){const l=n.on({[t]:(...c)=>{Object.keys(s).every(u=>u in c[0]&&c[0][u]===s[u])&&(a(...c),i.resetLog&&n.clearLog(t),l())},prio:-1e4})}else n.on({[t]:(...l)=>{a(...l),i.resetLog&&n.clearLog(t)},prio:-1e4,once:!0})})}clearLog(t){this._triggered&&(t?delete this._triggered[t]:this._triggered={})}trigger(t,i){var n,s,a,o;const l=this,c=t.toLowerCase(),{eventsSuspended:d,relayAllTargets:u,callOnFunctions:h}=l;let f=(n=l.eventListeners)==null?void 0:n[c],g;if(l._triggered||(l._triggered={}),l._triggered[t]=!0,d)return d.shouldQueue&&d.queue.push(arguments),!0;if((s=l.eventListeners)!=null&&s.catchall&&((f=f?f.slice():[]).push(...l.eventListeners.catchall),f.sort(ly)),!f&&!u&&!h)return!0;if(i?"source"in i||(Object.isExtensible(i)?i.source=l:i=Object.setPrototypeOf({source:l},i)):i={source:l},i.type!==c&&(i.constructor!==Object?Reflect.defineProperty(i,"type",{get:()=>c}):i.type=c),i.eventName=t,!("bubbles"in i)&&((a=l.bubbleEvents)!=null&&a[t])&&(i.bubbles=l.bubbleEvents[t]),h){const p="on"+L.capitalize(t);if(p in l){const v=l[p]?l.callback(l[p],l,[i]):!0;let y;if(U.isPromise(v)?(g||(g=[])).push(v):y=v===!1||y,!l.isDestroyed&&Jx.call(l,p)&&!((o=l.pluginFunctionChain)!=null&&o[p])){const S=Object.getPrototypeOf(l);if(p in S){const D=S[p].call(l,i);if(U.isPromise(D)?(g||(g=[])).push(D):y=D===!1||y,l.isDestroyed)return}}if(y)return!1}}let m;if(f){let p=0,v=!1;for(f.$firing=!0,p;p<f.length&&!l.isDestroyed&&!v;p++){const y=f[p];if(m===!1&&!y.$internal)continue;let S,D=y.thisObj;if(!D||!D.isDestroyed){if(y.called=!0,y.once&&l.removeListener(c,y),typeof y.fn=="string"){if(D&&(S=D[y.fn]),!S){const E=l.resolveCallback(y.fn);S=E.handler,D=E.thisObj}}else S=y.fn;if(y.buffer){if(!y.bufferFn){const E=Number(y.buffer);if(typeof E!="number"||isNaN(E))throw new Error(`Incorrect type for buffer, got "${E}" (expected a Number)`);y.bufferFn=Te.createBuffered(S,E,D,y.args)}S=y.bufferFn}if(y.throttle){const E=Number(y.throttle);if(typeof E!="number"||isNaN(E))throw new Error(`Incorrect type for throttle, got "${E}" (expected a Number)`);y.throttledFn||(y.throttledFn=Te.createThrottled(S,E,D,y.args)),S=y.throttledFn}const w=S.call(D||l,...y.args||[],i);m!==!1&&(m=w),y.$internal&&w===!1&&(v=!0),U.isPromise(w)&&(w.$internal=y.$internal,(g||(g=[])).push(w))}}if(f.$firing=!1,v)return!1}return u==null||u.forEach(p=>{let v=t;if(p.transformCase&&(v=L.capitalize(v)),p.prefix&&(v=p.prefix+v),p.through.trigger(v,i)===!1)return!1}),i.bubbles&&l.owner&&!l.owner.isDestroyed?l.owner.trigger(t,i):(g=g==null?void 0:g.filter(p=>m!==!1||p.$internal),g!=null&&g.length?new Promise(p=>{Promise.all(g).then(v=>{const y=!v.some(S=>S===!1);p(y)})}):m!==!1)}suspendEvents(t=!1){const i=this.eventsSuspended||(this.eventsSuspended={shouldQueue:t,queue:[],count:0});i.count++}resumeEvents(){const t=this.eventsSuspended;if(t&&--t.count===0&&(this.eventsSuspended=null,t.shouldQueue))for(const i of t.queue)this.trigger(...i);return!this.eventsSuspended}},Wu=class{static animationFrame(){return new Promise(e=>{requestAnimationFrame(e)})}static sleep(e){return new Promise(r=>{setTimeout(()=>{r()},e)})}static yield(){return Promise.resolve()}};Wu._$name="AsyncHelper";var Qx=/^(\w+)=(.*)$/,e0=function(e){const r={},t=e.split("&");for(const i of t){const[n,s,a]=Qx.exec(i),o=decodeURIComponent(s),l=decodeURIComponent(a);if(n){let c=r[o];c?(Array.isArray(c)||(c=r[o]=[c]),c.push(l)):r[o]=l}}return r},Fi=class{static get(e,r){return this.fetch(e,r)}static post(e,r,t={}){return!(r instanceof FormData)&&typeof r!="string"&&(r=JSON.stringify(r),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:r},t))}static fetch(e,r){let t;if(r=U.merge({},Fi.DEFAULT_FETCH_OPTIONS,r),typeof AbortController!="undefined"&&(t=r.abortController=new AbortController,r.signal=t.signal),"credentials"in r||(r.credentials="include"),r.queryParams){const n=Object.entries(r.queryParams);if(n.length){let s=!1;if(r.headers&&r.addQueryParamsToBody===!0){const a=new Headers(r.headers).get("Content-Type");let o;switch(a){case"application/x-www-form-urlencoded":o=URLSearchParams;break;case"multipart/form-data":o=FormData;break}if(o){const l=r.body||(r.body=new o);l instanceof o&&(n.forEach(([c,d])=>l.set(c,d)),s=!0)}}s||(e+=(e.includes("?")?"&":"?")+n.map(([a,o])=>`${a}=${encodeURIComponent(o)}`).join("&"))}}const i=new Promise((n,s)=>{fetch(e,r).then(a=>{r.parseJson?a.json().then(o=>{a.parsedJson=o,n(a)}).catch(o=>{a.parsedJson=null,a.error=o,s(a)}):n(a)}).catch(a=>{a.stack=i.stack,s(a)})});return i.stack=new Error().stack,i.abort=function(){t==null||t.abort()},i}static mockUrl(e,r){const t=this;(t.mockAjaxMap||(t.mockAjaxMap={}))[e]=r,Fi.originalFetch||(Fi.originalFetch=Fi.fetch,Fi.fetch=t.mockAjaxFetch.bind(t))}static async mockAjaxFetch(e,r){const t=e.split("?");let i=this.mockAjaxMap[t[0]],n=null;if(i){typeof i=="function"&&(i=await i(t[0],t[1]&&e0(t[1]),r));try{n=(r==null?void 0:r.parseJson)&&JSON.parse(i.responseText)}catch(s){n=null,i.error=s}return i=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:n,text:()=>new Promise(s=>{s(i.responseText)}),json:()=>new Promise(s=>{s(n)})},i),new Promise(function(s,a){i.synchronous?s(i):setTimeout(function(){s(i)},"delay"in i?i.delay:100)})}else return Fi.originalFetch(e,r)}},mr=Fi;R(mr,"DEFAULT_FETCH_OPTIONS",{}),mr._$name="AjaxHelper";var xa=class{static mergeLocales(...e){const r={};return e.forEach(t=>{Object.keys(t).forEach(i=>{typeof t[i]=="object"?r[i]={...r[i],...t[i]}:r[i]=t[i]})}),r}static trimLocale(e,r){const t=(i,n)=>{e[i]&&(n?e[i][n]&&delete e[i][n]:delete e[i])};Object.keys(r).forEach(i=>{Object.keys(r[i]).length>0?Object.keys(r[i]).forEach(n=>t(i,n)):t(i)})}static normalizeLocale(e,r){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if(typeof e=="string"){if(!r)throw new Error('"config" parameter can not be empty');r.locale?r.name=e||r.name:r.localeName=e}else r=e;let t={};if(r.name||r.locale)t=Object.assign({localeName:r.name},r.locale),r.desc&&(t.localeDesc=r.desc),r.code&&(t.localeCode=r.code),r.path&&(t.localePath=r.path);else{if(!r.localeName)throw new Error(`"config" parameter doesn't have "localeName" property`);t=Object.assign({},r)}for(const i of["name","desc","code","path"])t[i]&&delete t[i];if(!t.localeName)throw new Error("Locale name can not be empty");return t}static get locales(){return globalThis.bryntum.locales||{}}static set locales(e){globalThis.bryntum.locales=e}static get localeName(){return globalThis.bryntum.locale||"En"}static set localeName(e){globalThis.bryntum.locale=e||xa.localeName}static get locale(){return xa.localeName&&this.locales[xa.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,r){const{locales:t}=globalThis.bryntum,i=xa.normalizeLocale(e,r),{localeName:n}=i;return!t[n]||r===!0?t[n]=i:t[n]=this.mergeLocales(t[n]||{},i||{}),t[n]}},ct=xa;R(ct,"skipLocaleIntegrityCheck",!1),globalThis.bryntum=globalThis.bryntum||{},globalThis.bryntum.locales=globalThis.bryntum.locales||{},ct._$name="LocaleHelper";var t0=class extends Ae(F){static get defaultConfig(){return{throwOnMissingLocale:re.isTestEnv}}construct(...e){var r;const t=this;if(super.construct(...e),Y.isBrowserEnv){const i=document.querySelector("script[data-default-locale]");i?t.applyLocale(i.dataset.defaultLocale):(r=t.locale)!=null&&r.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return ct.locales}set locales(e){ct.locales=e}set locale(e){this.applyLocale(e)}get locale(){return ct.locale}registerLocale(e,r){re.deprecate("Core","6.0.0","LocaleManager.registerLocale deprecated, use LocaleHelper.publishLocale instead"),ct.publishLocale(e,r)}extendLocale(e,r){re.deprecate("Core","6.0.0","LocaleManager.extendLocale deprecated, use LocaleManager.applyLocale instead");const t=ct.publishLocale(e,r);return this.applyLocale(t,!0)}applyLocale(e,r,t=!1){const i=this;let n;if(typeof e=="string")if(typeof r!="object"){if(n=i.locales[e],!n){if(t)return!0;throw new Error(`Locale "${e}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else n=ct.publishLocale(e,r);else n=ct.publishLocale(e);if(i.locale.localeName&&i.locale.localeName===n.localeName&&r!==!0)return i.locale;ct.localeName=n.localeName;const s=()=>{i.trigger("locale",n)};return n.localePath?new Promise((a,o)=>{i.loadLocale(n.localePath).then(l=>{l.text().then(c=>{new Function(c)(),Y.isBrowserEnv&&(n=i.locales[n.localeName],n&&delete n.localePath),s(),a(n)})}).catch(l=>o(l))}):(s(),n)}loadLocale(e){return mr.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}},r0=new t0,He=r0,i0=Object.getPrototypeOf(Object),cy=/L{.*?}/g,dy=/L{(.*?)}/g,uy=/((.*?)\.)?(.+)/g,n0=e=>e.replace(/{(\d+)}/gm,"[[$1]]"),hy=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),s0=Object.freeze(Object.create(null)),Ve=e=>class Ar extends(e||F){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(t){var i,n;return typeof t=="string"?t:t===i0?"Object":t.$$name||t.name||((i=t.prototype)==null?void 0:i.$$name)||((n=t.prototype)==null?void 0:n.name)}static parseLocaleString(t){const i=[];let n;if(t!=null&&t.includes("L{"))for(t=n0(t),dy.lastIndex=0;(n=dy.exec(t))!=null;){uy.lastIndex=0;const s=uy.exec(n[1]);i.push({match:hy(n[0]),localeKey:hy(s[3]),localeClass:s[2]})}return i.length>0?i:[{match:t,localeKey:t,localeClass:void 0}]}construct(t={},...i){super.construct(t,...i),He.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(t){var i,n,s;const a=this,o=U.getPath(a,t),l=((i=a.$meta.configs[t])==null?void 0:i.localeKey)||((s=(n=a.fieldMap)==null?void 0:n[t])==null?void 0:s.defaultValue);let c;return l?(c=Ar.localize(l,a,a.localeClass||a),c&&!(t in(a.initialConfig||s0))&&U.setPath(a.isColumn?a.data:a,t,c)):typeof o=="string"&&(a.originalLocales=a.originalLocales||{},c=U.getPath(a.originalLocales,t),c===void 0&&(U.setPath(a.originalLocales,t,o),c=o),c&&U.setPath(a,t,c=a.optionalL(c,a))),c||o}updateLocalization(){var t,i;this.localizable!==!1&&((t=this.localizableProperties)==null||t.forEach(this.localizeProperty,this),(i=this.trigger)==null||i.call(this,"localized"))}static getTranslation(t,i,n){const s=He.locale;let a=null,o,l;if(s)for(const{match:c,localeKey:d,localeClass:u}of this.parseLocaleString(t)){const h=g=>{var m;const p=(m=s[g])==null?void 0:m[d];return p&&(typeof p=="function"?a=i!=null?p(i):p:typeof p=="object"||t===c?a=p:a=(a||t).replace(c,p),typeof p=="string"&&p.includes("L{")&&(a=this.getTranslation(p,i,n))),p};let f=!1;for(l=n;l&&(o=Ar.clsName(l))&&!(f=h(o));l=Object.getPrototypeOf(l))if(typeof l=="string")break;!f&&u&&h(u)}return a}static localize(t,i=void 0,...n){(n==null?void 0:n.length)===0&&(n=[this]);let s=null;return n.some(a=>(s=Ar.getTranslation(t,i,a),s!=null)),s}static L(t,i=void 0,...n){(n==null?void 0:n.length)===0&&(n=[this]);const s=this.localize(t,i,...n);if(s==null&&He.throwOnMissingLocale&&t.includes("L{"))throw new Error(`Localization is not found for '${t}' in '${n.map(a=>Ar.clsName(a)).join(", ")}'. ${He.locale.localeName?`Locale : ${He.locale.localeName}`:""}`);return s!=null?s:t}L(t,i){const{localeClass:n,constructor:s}=this;return n&&Ar.clsName(n)!==Ar.clsName(s)?Ar.L(t,i,n,s):Ar.L(t,i,s)}static optionalL(t,i=void 0,...n){const s=He.throwOnMissingLocale;He.throwOnMissingLocale=s&&cy.test(t),(n==null?void 0:n.length)===0&&(n=[this]);const a=Ar.L(t,i,...n);return He.throwOnMissingLocale=s,a}optionalL(t,i=this,n=!1){const s=He.throwOnMissingLocale;He.throwOnMissingLocale=s&&cy.test(t)&&!n;const a=this.L(t,i);return He.throwOnMissingLocale=s,a}get localeManager(){return He}get localeHelper(){return ct}},a0={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:e=>`Add ${e}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading..."},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"is empty",isNotEmpty:"is not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"is one of",isNotOneOf:"is not one of",isGreaterThan:"is greater than",isLessThan:"is less than",isGreaterThanOrEqualTo:"is greater than or equal to",isLessThanOrEqualTo:"is less than or equal to",isBetween:"is between",isNotBetween:"is not between",isBefore:"is before",isAfter:"is after",isToday:"is today",isTomorrow:"is tomorrow",isYesterday:"is yesterday",isThisWeek:"is this week",isNextWeek:"is next week",isLastWeek:"is last week",isThisMonth:"is this month",isNextMonth:"is next month",isLastMonth:"is last month",isThisYear:"is this year",isNextYear:"is next year",isLastYear:"is last year",isYearToDate:"is year to date",isTrue:"is true",isFalse:"is false",selectAProperty:"Select a property",selectAnOperator:"Select an operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectOneOrMoreValues:"Select one or more values",enterAValue:"Enter a value",enterANumber:"Enter a number",selectADate:"Select a date"},FieldFilterPickerGroup:{addFilter:"Add filter"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{const r=["11","12","13"].find(i=>e.endsWith(i));let t="th";if(!r){const i=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[i]||"th"}return e+t}}},B_=ct.publishLocale(a0),{toString:fy}=Object.prototype,o0=fy.call(new Date),jl=new Date,Uu=1e3*60*60,Gu=(e,r)=>isNaN(e)||e==null?r:e,l0=/([ES]){([^}]+)}/g,gy=e=>{const r=["11","12","13"].find(i=>e.endsWith(i));let t="th";if(!r){const i=e[e.length-1];t={1:"st",2:"nd",3:"rd"}[i]||"th"}return e+t},dt=(e,r,t)=>(ti[e]||(ti[e]=new Intl.DateTimeFormat(ei,r))).format(t),Ra=(e,r,t,i=!1)=>{let n=dt(e,r,t);return/am|pm/i.test(n)&&(n=n.replace(/^0/,""),i&&(n=n.replace(/:00/,""))),n},c0=(e,r)=>Math.floor((e.getTime()-r.getTime()-(e.getTimezoneOffset()-r.getTimezoneOffset())*Tt.minute.millisecond)/Tt.day.millisecond)+1,my=e=>e>=0?e:e+7,d0=/([^\w])(S+)/gm,u0=(e,r)=>r+"SSS",py=/[:.\-/\s]/,ei="en-US",kr=gy,Bl={},Ta={},ti={},Yu={},vy=e=>{const r=qu[e];if(!r)throw new Error("Only international formats should be used here");if(Ta[e]!==void 0)return Ta[e];const t=new Intl.DateTimeFormat(ei,r),i=t.formatToParts(new Date(2001,1,2,3,4,5,6)).map(n=>{const s=n.type,a=r[s];if(s==="literal")return n.value.replace(/,/g,"");if(s==="day")return a==="numeric"?"D":"DD";if(s==="month")return a==="short"?"MMM":a==="long"?"MMMM":a==="numeric"?"M":"MM";if(s==="year")return a==="numeric"?"YYYY":"YY"}).join("");return Ta[e]=i},yy=2020,by=0,Cy=1,qu={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},tt={M:e=>e.getMonth()+1,Mo:e=>kr(tt.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>dt("MMM",{month:"short"},e),MMMM:e=>dt("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>kr(tt.Q(e).toString()),D:e=>e.getDate(),Do:e=>kr(tt.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/Tt.day.millisecond),DDDo:e=>kr(tt.DDD(e).toString()),DDDD:e=>tt.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>kr(e.getDay().toString()),d1:e=>dt("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>tt.ddd(e).substring(0,2),ddd:e=>dt("ddd",{weekday:"short"},e),dddd:e=>dt("dddd",{weekday:"long"},e),u:e=>{const r=ti.u||(ti.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})),t=r.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:e=>{const r=ti.uu||(ti.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),t=r.formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>b.getWeekNumber(e)[1],Wo:e=>kr(tt.W(e).toString()),WW:e=>tt.W(e).toString().padStart(2,"0"),Wp:e=>`${b.localize("L{Week}")} ${tt.W(e)}`,WWp:e=>`${b.localize("L{Week}")} ${tt.WW(e)}`,Wp0:e=>`${b.localize("L{Week}")[0]}${tt.W(e)}`,WWp0:e=>`${b.localize("L{Week}")[0]}${tt.WW(e)}`,Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>tt.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>tt.k(e).toString().padStart(2,"0"),K:e=>Ra("K",{hour:"numeric"},e),KK:e=>Ra("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>tt.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>tt.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>dt("z",{timeZoneName:"short"},e),zz:e=>dt("zz",{timeZoneName:"long"},e),Z:e=>O.getGMTOffset(e),LT:e=>Ra("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>Ra("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>Ra("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>dt("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>dt("l",qu.l,e),LL:e=>dt("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>dt("ll",qu.ll,e),LLL:e=>dt("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>dt("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>dt("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>dt("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},h0=Object.keys(tt).sort((e,r)=>r.length-e.length),f0=`^(?:${h0.join("|")})`,mt=()=>({}),g0=e=>w0.test(e),Ku=e=>g0(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},Sy={YYYY:e=>{const r=parseInt(e);return{year:r>=1e3&&r<=9999?r:NaN}},Y:e=>({year:parseInt(e)}),YY:e=>{const r=parseInt(e);return{year:r+(r>1968?1900:2e3)}},M:e=>({month:parseInt(e)-1}),MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),MMM:e=>{const r=(e||"").toLowerCase();for(const[t,i]of Object.entries(b._monthShortNamesIndex))if(r.startsWith(t))return{month:i.value}},MMMM:e=>{const r=(e||"").toLowerCase();for(const[t,i]of Object.entries(b._monthNamesIndex))if(r.startsWith(t))return{month:i.value}},DD:e=>({date:parseInt(e)}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:mt,DDDo:mt,DDDD:mt,d:mt,do:mt,d1:mt,dd:mt,ddd:mt,dddd:mt,Q:mt,Qo:mt,W:mt,Wo:mt,WW:mt,e:mt,E:mt,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:Ku,SS:Ku,SSS:Ku,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>vy("l")},ll:{type:"dynamic",parser:()=>vy("ll")},Z:e=>{if(!e||!Ey.test(e)&&e!=="Z")return null;let r=0;if(e!=="Z"){const t=Ey.exec(e);if(t){const i=t[1]==="+"?1:-1,n=parseInt(t[2])||0,s=parseInt(t[3])||0;r=i*(n*60+s)}else r=-1*new Date().getTimezoneOffset()}return{timeZone:r}}},m0=Object.keys(Sy).sort((e,r)=>r.length-e.length),wy=new RegExp(`(${m0.join("|")})`),p0=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),Tt={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:24*3652,minute:1440*3652,second:86400*3652,millisecond:864e5*3652},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:24*365,minute:1440*365,second:86400*365,millisecond:864e5*365},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:24*91,minute:1440*91,second:86400*91,millisecond:864e5*91},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-24*30,minute:-1440*30,second:-86400*30,millisecond:-864e5*30},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/(3652*24),year:-1/(365*24),quarter:-1/(91*24),month:-1/(30*24),week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/(3652*1440),year:-1/(365*1440),quarter:-1/(91*1440),month:-1/(30*1440),week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/(3652*86400),year:-1/(365*86400),quarter:-1/(91*86400),month:-1/(30*86400),week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/(3652*864e5),year:-1/(365*864e5),quarter:-1/(91*864e5),month:-1/(30*864e5),week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:1/1e3}},Dy={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},v0=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,y0=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,zn=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],b0=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],Xu=["decade","year","month","week","day","hour","minute","second","millisecond"],C0=["milliseconds","seconds","minutes","hours","date","month","year"],S0=e=>{const r=parseFloat(e);return isNaN(r)?null:r},w0=/^[0-9]+$/,Ey=/([+-])(\d\d):*(\d\d)*$/,Kt={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},D0={round(e,r=1){return Math.round(e/r)*r},floor(e,r=1){return Math.floor(e/r)*r},ceil(e,r=1){return Math.ceil(e/r)*r}},xy={},Or=class extends Ve(){static get $name(){return"DateHelper"}static set defaultFormat(e){O._defaultFormat=e}static get defaultFormat(){return O._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const r=e.split(wy),t=[];return r.length===1||p0.test(e)?[]:(r.reduce((i,n,s,a)=>{if(s!==0||n!=="")if(wy.test(n)){const o=this.localize("L{parsers}")||{},l=o[n]||Sy[n];if(n==="Z"&&s<a.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const c=typeof l=="function"||typeof l=="string"?l:l.parser();if(typeof c=="string"){const d=O.buildParser(c),u=d.pop();delete u.last,t.push(...d),i=u}else i.pattern=n,i.fn=c}else i.splitter=n,t.push(i),i={};else Object.prototype.hasOwnProperty.call(i,"pattern")&&t.push(i);return i},{}),t[t.length-1].last=!0,t)}static makeKey(e){if(e.length===10)return e;e.getTime&&(e=e.getTime());const r=xy[Math.trunc(e/Uu)];if(r)return r;jl.setTime(e);const t=jl.getMonth()+1,i=jl.getDate();return xy[Math.trunc(e/Uu)]=`${jl.getFullYear()}-${t<10?"0"+t:t}-${i<10?"0"+i:i}`}static parseKey(e){return O.parse(e,"YYYY-MM-DD")}static parse(e,r=O.defaultParseFormat,t=!1){if(e instanceof Date)return e;if(typeof e!="string"||!e)return null;const i={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};r=r.replace(d0,u0);let n=Yu[r],s;if(n||(n=Yu[r]=O.buildParser(r)),e.includes("\u202F")&&(e=e.replace(/\s/g," ")),n.reduce((o,l)=>{var c;if(l.last)Object.assign(i,l.fn(o));else{let d;if(l.splitter==="T"&&o.indexOf("T")===-1)d=o.indexOf(" ");else{const f=o.indexOf("+");let{splitter:g}=l;!t&&py.test(g)&&(g=py),d=l.splitter!==""?o.search(typeof g=="string"?L.escapeRegExp(g):g):((c=l.pattern)==null?void 0:c.length)||-1,f>-1&&d>f&&(d=-1)}let u,h;if(d===-1||l.pattern==="SSS"&&o.match(/^\d+Z$/)){const f=o.split(/([Z\-+])/);f.length===1?(u=o,h=""):(u=f[0],h=`${f[1]}${f[2]}`)}else u=o.substring(0,d)||o,h=o.substring(d+l.splitter.length);if(l.fn){const f=l.fn(u);f?Object.assign(i,f):h=u+h}return h}},e),i.year&&!i.date&&(i.date=1),i.date>31||i.month>12)return null;const a=O.create(i,t);return a?s=a:t||(s=new Date(e)),s}static create(e,r=!1){const t={...e};let i=isNaN(t.year)||r&&(isNaN(t.month)||isNaN(t.date)),n=!1;if(!i){let a=!0;C0.forEach(o=>{(!(o in t)||isNaN(t[o]))&&(t[o]=0),a=a&&t[o]===null}),i=a}if(i||(t.amPm==="am"?t.hours=t.hours%12:t.amPm==="pm"&&(t.hours=t.hours%12+12),"timeZone"in t&&(n=!0,t.minutes-=t.timeZone),r&&(t.year==null||t.month==null||t.date==null)))return null;const s=[Gu(t.year,yy),Gu(t.month,by),Gu(t.date,Cy),t.hours,t.minutes,t.seconds,t.milliseconds];return n?new Date(Date.UTC(...s)):new Date(...s)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,r=O.defaultFormat){if(!e||isNaN(e))return null;let t=Bl[r],i="";if(!t){t=Bl[r]=[];for(let n=0;n<r.length;n++){const s=r.slice(n).match(f0),a=s==null?void 0:s[0];if(a){const o=this.localize("L{formats}")||{},l=o[a]||tt[a];t.push(l),n+=a.length-1}else if(r[n]==="{"){const o=r.indexOf("}",n+1);o===-1?(t.push(r.substr(n+1)),n=r.length):(t.push(r.substring(n+1,o)),n=o)}else t.push(r[n])}}return t.forEach(n=>{typeof n=="string"?i+=n:i+=n(e)}),i}static formatRange(e,r){return r.replace(l0,(t,i,n)=>Or.format(e[i==="S"?0:1],n))}static asMilliseconds(e,r=null){return typeof e=="string"&&(r=e,e=1),O.as("millisecond",e,r)}static asMonths(e){const r=O.as("ms",O.daysInMonth(e),"day"),t=(e.valueOf()-O.startOf(e,"month").valueOf())/r;return e.getYear()*12+e.getMonth()+t}static monthsToDate(e){const r=Math.floor(e),t=e-r,i=new Date(0,r),n=O.as("ms",O.daysInMonth(i),"days");return i.setTime(i.getTime()+t*n),i}static formatDelta(e,r){let t,i;typeof r=="boolean"?t=r:r&&(t=r.abbrev);const n=this.getDelta(e,r),s=[],a=(r==null?void 0:r.separator)||(t?"":" ");for(i in n)s.push(`${n[i]}${a}${i}`);return(r==null?void 0:r.asString)===!1?s:s.join(", ")}static getDelta(e,r){let t,i,n,s,a,o,l;typeof r=="boolean"?t=r:r&&(t=r.abbrev,s=O.normalizeUnit(r.precision),o=r.maxUnit,l=!t&&r.ignoreLocale);const c={},d=t?O.getShortNameOfUnit:O.getLocalizedNameOfUnit,u=o?Xu.slice(Xu.indexOf(o)):Xu;for(a of u)if(i=O.as(a,e),n=s===a,i=Math[n?"round":"floor"](i),(i||n&&!c.length)&&(c[l?a:d.call(O,a,i!==1)]=i,e-=O.as("ms",i,a)),n||!e)break;return c}static as(e,r,t="ms"){return typeof r=="string"&&(r=O.parseDuration(r)),typeof r=="object"&&(t=r.unit,r=r.magnitude),e===t||(e=O.normalizeUnit(e),t=O.normalizeUnit(t),e===t)?r:Kt[t]>Kt[e]?r*Math.abs(Tt[t][e]):r/Math.abs(Tt[e][t])}static formatContainsHourInfo(e){const r=/(\\.)/g;return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(r,""))}static is24HourFormat(e){return O.format(O.getTime(13,0,0),e).includes("13")}static add(e,r,t="ms",i=!0){let n;if(typeof e=="string"?n=O.parse(e):i?n=new Date(e.getTime()):n=e,typeof r=="string"){const s=Or.parseDuration(r);r=s.magnitude,t=s.unit}else r&&typeof r=="object"&&(t=r.unit,r=r.magnitude);if(!t||r===0)return n;switch(t=O.normalizeUnit(t),t){case"millisecond":n.setTime(n.getTime()+r);break;case"second":n.setTime(n.getTime()+r*1e3);break;case"minute":n.setTime(n.getTime()+r*6e4);break;case"hour":n.setTime(n.getTime()+r*36e5);break;case"day":r%1===0?(n.setDate(n.getDate()+r),n.getHours()===23&&e.getHours()===0&&n.setHours(n.getHours()+1)):n.setTime(n.getTime()+r*864e5);break;case"week":n.setDate(n.getDate()+r*7);break;case"month":{let s=n.getDate();s>28&&(s=Math.min(s,O.getLastDateOfMonth(O.add(O.getFirstDateOfMonth(n),r,"month")).getDate())),n.setDate(s),n.setMonth(n.getMonth()+r);break}case"quarter":O.add(n,r*3,"month",!1);break;case"year":n.setFullYear(n.getFullYear()+r);break;case"decade":n.setFullYear(n.getFullYear()+r*10);break}return n}static diff(e,r,t="ms",i=!0){if(t=O.normalizeUnit(t),!e||!r)return 0;let n;switch(t){case"year":n=O.diff(e,r,"month")/12;break;case"quarter":n=O.diff(e,r,"month")/3;break;case"month":n=(r.getFullYear()-e.getFullYear())*12+(r.getMonth()-e.getMonth()),n===0&&i&&(n=O.diff(e,r,"day",i)/O.daysInMonth(e));break;case"week":n=O.diff(e,r,"day")/7;break;case"day":{const s=e.getTimezoneOffset()-r.getTimezoneOffset();n=(r-e+s*60*1e3)/864e5;break}case"hour":n=(r-e)/36e5;break;case"minute":n=(r-e)/6e4;break;case"second":n=(r-e)/1e3;break;case"millisecond":n=r-e;break}return i?n:Math.round(n)}static startOf(e,r="day",t=!0,i=O.weekStartDay){if(!e)return null;switch(r=O.normalizeUnit(r),t&&(e=O.clone(e)),r){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth((O.get(e,"quarter")-1)*3,1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const n=e.getDay()-i;return e.setDate(e.getDate()-n),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,r=!0){return e?(r&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,r){let t=O.clearTime(e);return r&&t<e&&(t=O.add(t,1,"d")),t}static getTimeOfDay(e,r="ms"){const t=e.getHours()*Tt.hour.millisecond+e.getMinutes()*Tt.minute.millisecond+e.getSeconds()*Tt.second.millisecond+e.getMilliseconds();return r==="ms"?t:O.as(r,t,"ms")}static set(e,r,t){if(!r)return e;if(typeof r=="string")switch(O.normalizeUnit(r)){case"millisecond":(t!==0||e.getMilliseconds()>0)&&e.setMilliseconds(t);break;case"second":(t!==0||e.getSeconds()>0)&&e.setSeconds(t);break;case"minute":(t!==0||e.getMinutes()>0)&&e.setMinutes(t);break;case"hour":e.setHours(t);break;case"day":case"date":e.setDate(t);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(t);break;case"quarter":e.setDate(1),e.setMonth((t-1)*3);break;case"year":e.setFullYear(t);break}else Object.entries(r).sort((i,n)=>Kt[i[0]]-Kt[n[0]]).forEach(([i,n])=>{O.set(e,i,n)});return e}static setDateToMidday(e,r=!0){return O.set(O.clearTime(e,r),"hour",12)}static constrain(e,r,t){return r!=null&&(e=O.max(e,r)),t==null?e:O.min(e,t)}static getTime(e,r=0,t=0,i=0){return e instanceof Date&&(i=e.getMilliseconds(),t=e.getSeconds(),r=e.getMinutes(),e=e.getHours()),new Date(yy,by,Cy,e,r,t,i)}static copyTimeValues(e,r){return e.setHours(r.getHours()),e.setMinutes(r.getMinutes()),e.setSeconds(r.getSeconds()),e.setMilliseconds(r.getMilliseconds()),e}static get isDSTEnabled(){const e=new Date().getFullYear(),r=new Date(e,0,1),t=new Date(e,6,1);return r.getTimezoneOffset()!==t.getTimezoneOffset()}static isDST(e){const r=e.getFullYear(),t=new Date(r,0,1),i=new Date(r,6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),i.getTimezoneOffset())}static isBefore(e,r){return e<r}static isAfter(e,r){return e>r}static isEqual(e,r,t=null){return t===null?e&&r&&e.getTime()===r.getTime():O.startOf(e,t)-O.startOf(r,t)===0}static compare(e,r,t=null){return t&&(e=O.startOf(e,t),r=O.startOf(r,t)),e<r?-1:e>r?1:0}static clamp(e,r,t){if(!isNaN(e))return r!=null&&(e=Math.max(e,r)),t!=null&&(e=Math.min(e,t)),new Date(e)}static isSameDate(e,r){return O.compare(e,r,"d")===0}static isSameTime(e,r){return e.getHours()===r.getHours()&&e.getMinutes()===r.getMinutes()&&e.getSeconds()===r.getSeconds()&&e.getMilliseconds()===r.getMilliseconds()}static isStartOf(e,r){return O.isEqual(e,O.startOf(e,r))}static betweenLesser(e,r,t){return r.getTime()<=e.getTime()&&e.getTime()<t.getTime()}static betweenLesserEqual(e,r,t){return r.getTime()<=e.getTime()&&e.getTime()<=t.getTime()}static intersectSpans(e,r,t,i){return O.betweenLesser(e,t,i)||O.betweenLesser(t,e,r)}static compareUnits(e,r){return Math.sign(Kt[O.normalizeUnit(e)]-Kt[O.normalizeUnit(r)])}static timeSpanContains(e,r,t,i){return t-e>=0&&r-i>=0}static get weekStartDay(){return O._weekStartDay==null&&(O._weekStartDay=this.localize("L{weekStartDay}")||0),O._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,r){switch(O.normalizeUnit(r)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return tt.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const r=e.getFullYear(),t=new Date(r+1,0,1)-new Date(r,0,1);return this.as("day",t)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const r=e.getFullYear(),t=e.getMonth(),i=e.getDate(),n=new Date(r,t,i+1)-new Date(r,t,i);return this.as("hour",n)}static getNormalizedUnitDuration(e,r){let t;switch(r){case"month":t=O.asMilliseconds(O.daysInMonth(e),"day");break;case"year":t=O.asMilliseconds(O.daysInYear(e),"day");break;case"day":t=O.asMilliseconds(O.hoursInDay(e),"hour");break;default:t=O.asMilliseconds(r)}return t}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,r){return e.getTime()<r.getTime()?e:r}static max(e,r){return e.getTime()>r.getTime()?e:r}static getNext(e,r,t=1,i=O.weekStartDay){if(r==="week"){const n=O.clone(e),s=n.getDay();return O.startOf(n,"day",!1),O.add(n,i-s+7*(t-(i<=s?0:1)),"day",!1),n.getDay()!==i&&O.add(n,1,"hour"),n}return O.startOf(O.add(e,t,r),r,!1)}static isValidDate(e){return O.isDate(e)&&!isNaN(e)}static isDate(e){return e&&fy.call(e)===o0}static getStartOfNextDay(e,r=!1,t=!1){let i=O.add(t?e:O.clearTime(e,r),1,"day");if(i.getDate()===e.getDate()){const n=O.add(O.clearTime(e,r),2,"day").getTimezoneOffset(),s=e.getTimezoneOffset();i=O.add(i,s-n,"minute")}return i}static getEndOfPreviousDay(e,r=!1){const t=r?e:O.clearTime(e,!0);return t-e?t:O.add(t,-1,"day")}static getWeekDescription(e,r=e){const t=e.getMonth()===r.getMonth()?Or.format(e,"MMMM"):`${Or.format(e,"MMM")} - ${Or.format(r,"MMM")}`,i=Or.getWeekNumber(e);return`${i[1]}, ${t} ${i[0]}`}static getWeekNumber(e,r=Or.weekStartDay){const t=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),11,31),n=my(t.getDay()-r),s=my(i.getDay()-r),a=c0(e,t);let o;if(n<4?o=Math.floor((a+n-1)/7)+1:o=Math.floor((a+n-1)/7),o){let c=e.getFullYear();return o===53&&s<3&&(c++,o=1),[c,o]}const l=Or.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,l]}static formatCount(e,r){return r=O.normalizeUnit(r),e!==1&&(r+="s"),e+" "+r}static getUnitToBaseUnitRatio(e,r,t=!1){return e=O.normalizeUnit(e),r=O.normalizeUnit(r),e===r?1:Tt[e]&&Tt[e][r]&&(t||Tt[e][r]>0)?1/O.as(r,1,e):Tt[r]&&Tt[r][e]&&(t||Tt[r][e]>0)?O.as(e,1,r):-1}static getShortNameOfUnit(e){return e=O.parseTimeUnit(e),O.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,r=!1){const t=e.charAt(0)===e.charAt(0).toUpperCase();return e=O.normalizeUnit(e),e=O.parseTimeUnit(e),e=O.unitLookup[e][r?"plural":"single"],t&&(e=L.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const r=e.toLowerCase();return r==="date"||zn.includes(r)?r:Dy[e]||Dy[r]}static getUnitByName(e){return O.normalizeUnit(e)||O.normalizeUnit(O.parseTimeUnit(e))}static getDurationInUnit(e,r,t,i){return O.diff(e,r,t,i)}static doesUnitsAlign(e,r){return!(e!==r&&r==="week")}static getSmallerUnit(e){return zn[Kt[O.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return zn[Kt[O.normalizeUnit(e)]+1]||null}static round(e,r,t,i){return O.snap("round",e,r,t,i)}static floor(e,r,t,i){return O.snap("floor",e,r,t,i)}static ceil(e,r,t,i){return O.snap("ceil",e,r,t,i)}static snap(e,r,t,i,n=O.weekStartDay){const s=D0[e];if(typeof t=="string"&&(t=O.parseDuration(t)),U.isObject(t)){const a=t.magnitude||t.increment;switch(t.unit){case"week":{const o=r.getDay();return i=O.add(O.clearTime(r),o>=n?n-o:-(o-n+7),"day"),O[e](r,`${a*7} days`,i)}case"month":{r=O.asMonths(r);let o;return i?(i=O.asMonths(i),o=r+s(r-i,a)):o=s(r,a),O.monthsToDate(o)}case"quarter":return O[e](r,`${a*3} months`,i);case"year":return O[e](r,`${a*12} months`,i);case"decade":return O[e](r,`${a*10} years`,i)}t=O.as("ms",a,t.unit)}if(i){const a=O.as("ms",i.getTimezoneOffset()-r.getTimezoneOffset(),"ms");return new Date(i.valueOf()+s(O.diff(i,r,"ms")+a,t))}else{const a=r.getTimezoneOffset()*60*1e3;return new Date(s(r.valueOf()-a,t)+a)}}static parseDuration(e,r=!0,t){var i;const n=r?v0:y0,s=n.exec(e);if(e==null||!s)return null;const a=S0((i=s[1])==null?void 0:i.replace(",",".")),o=O.parseTimeUnit(s[2])||t;return o?{magnitude:a,unit:o}:null}static parseTimeUnit(e){const r=e==null?null:O.durationRegEx.exec(e.toLowerCase());if(!r)return null;for(let t=0;t<zn.length;t++)if(r[t+1])return zn[t]}static getGMTOffset(e=new Date){if(!e)return;const r=e.getTimezoneOffset();return r?(r>0?"-":"+")+Math.abs(Math.trunc(r/60)).toString().padStart(2,"0")+":"+Math.abs(r%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),r=O._dayNames||[],t=O._dayShortNames||[];r.length=0,t.length=0;for(let i=2;i<9;i++)e.setDate(i),r.push(O.format(e,"dddd")),t.push(O.format(e,"ddd"));O._dayNames=r,O._dayShortNames=t}static getDayNames(){return O._dayNames}static getDayName(e){return O._dayNames[e]}static getDayShortNames(){return O._dayShortNames}static getDayShortName(e){return O._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),r=O._monthNames||[],t=O._monthShortNames||[],i={},n={};r.length=0,t.length=0;for(let s=0;s<12;s++){e.setMonth(s);const a=O.format(e,"MMMM");r.push(a);const o=O.format(e,"MMM");t.push(o),i[a.toLowerCase()]={name:a,value:s},n[o.toLowerCase()]={name:o,value:s}}O._monthNames=r,O._monthShortNames=t,O._monthNamesIndex=i,O._monthShortNamesIndex=n}static getMonthShortNames(){return O._monthShortNames}static getMonthShortName(e){return O._monthShortNames[e]}static getMonthNames(){return O._monthNames}static getMonthName(e){return O._monthNames[e]}static set locale(e){ei=e,ti={},Bl={},Ta={}}static get locale(){return ei}static setupDurationRegEx(e=[],r=[]){const t=this,i={};let n="";for(let s=0;s<r.length;s++){const a=r[s],o=e[s];o.canonicalUnitName=zn[s],i[o.single]=i[o.single.toUpperCase()]=i[o.canonicalUnitName]=i[o.canonicalUnitName.toUpperCase()]=o,n+=`${s?"|":""}(`;for(let l=0;l<a.length;l++)n+=`${a[l]}|`;if(ei=t.localize("L{locale}")||"en-US",ei!=="en-US"){const l=b0[s];for(let c=0;c<l.length;c++)n+=`${l[c]}|`}n+=`${o.single}|${o.plural}|${o.canonicalUnitName}|${o.canonicalUnitName}s)`}t.unitLookup=i,t.durationRegEx=new RegExp(`^(?:${n})$`)}static applyLocale(){const e=this,r=e.localize("L{unitAbbreviations}")||[],t=e.unitNames=e.localize("L{unitNames}");t!=="unitNames"&&(ei=e.localize("L{locale}")||"en-US",ei==="en-US"?kr=gy:kr=e.localize("L{ordinalSuffix}")||kr,Bl={},Ta={},Yu={},ti={},O._weekStartDay=null,O.setupDurationRegEx(t,r),O.fillDayNames(),O.fillMonthNames())}},b=Or;R(b,"MS_PER_DAY",Uu*24);var O=b;O.useIntlFormat=dt,He.ion({locale:"applyLocale",prio:1e3,thisObj:O}),He.locale&&O.applyLocale(),b._$name="DateHelper";var{hasOwn:Zu}=U,Ry=1.005.toFixed(2)==="1.01"?null:function(e,r){const t=e.toString().split("."),i=+(t[1]?t.join(".")+"1":t[0]);return e.toFixed.call(i,r)},T=class extends U{static transformArrayToNamedObject(e,r="ref"){const t={};return e.forEach((i,n)=>{const s=i[r]!=null&&i[r].toString().length?i[r]:n;t[s]=i}),t}static transformNamedObjectToArray(e,r="ref"){return Object.keys(e).filter(t=>e[t]).map(t=>{const i=e[t];return i[r]=t,i})}static isEqual(e,r,t=!1){if(e===null&&r!==null||e===void 0&&r!==void 0||r===null&&e!==null||r===void 0&&e!==void 0)return!1;if(e==null&&r==null||e===r)return!0;const i=typeof e;if(i===typeof r){switch(i){case"number":case"string":case"boolean":return e===r}switch(!0){case(e instanceof Date&&r instanceof Date):return e.getTime()===r.getTime();case(Array.isArray(e)&&Array.isArray(r)):return e.length===r.length?e.every((s,a)=>Ht.isEqual(s,r[a],t)):!1;case(i==="object"&&e.constructor.prototype===r.constructor.prototype):return t?Ht.isDeeplyEqual(e,r,t):L.safeJsonStringify(e)===L.safeJsonStringify(r)}}return String(e)===String(r)}static isDeeplyEqual(e,r,t={}){if(e===r)return!0;if(!e||!r)return!1;const i=Ht.keys(e,t.ignore),n=Ht.keys(r,t.ignore);if(i.length!==n.length)return!1;for(let s=0;s<i.length;s++){const a=i[s],o=n[s];if(a!==o)return!1;const l=e[a],c=r[o];if(!(t.shouldEvaluate&&t.shouldEvaluate(a,{value:l,object:e},{value:c,object:r})===!1)){if(t.evaluate){const d=t.evaluate(a,{value:l,object:e},{value:c,object:r});if(d===!1)return!1;if(d===!0)continue}if(!Ht.isEqual(l,c,t))return!1}}return!0}static isPartial(e,r){return e=String(e).toLowerCase(),r=String(r).toLowerCase(),e.indexOf(r)!==-1}static isLessThan(e,r){return e instanceof Date&&r instanceof Date?b.isBefore(e,r):e<r}static isMoreThan(e,r){return e instanceof Date&&r instanceof Date?b.isAfter(e,r):e>r}static fork(e){let r,t,i;if(e&&e.constructor===Object){r=Object.setPrototypeOf({},e);for(t in e)i=e[t],i&&(i.constructor===Object?r[t]=Ht.fork(i):i instanceof Array&&(r[t]=i.slice()))}else r=e;return r}static copyProperties(e,r,t){let i,n;for(n=0;n<t.length;n++)i=t[n],i in r&&(e[i]=r[i]);return e}static copyPropertiesIf(e,r,t){if(r)for(const i of t)i in e||(e[i]=r[i]);return e}static entries(e,r){const t=[],i=typeof r=="function";if(e)for(const n in e)(i?!r(n,e[n]):!(r!=null&&r[n]))&&t.push([n,e[n]]);return t}static fromEntries(e,r){if(r=r||{},e)for(let t=0;t<e.length;++t)r[e[t][0]]=e[t][1];return r}static keys(e,r,t){const i=[],n=typeof r=="function";if(e){let s=0;for(const a in e)(n?!r(a,e[a]):!(r!=null&&r[a]))&&(i.push(t?t(a,s):a),++s)}return i}static values(e,r,t){const i=[],n=typeof r=="function";if(e){let s=0;for(const a in e)(n?!r(a,e[a]):!(r!=null&&r[a]))&&(i.push(t?t(e[a],s):e[a]),++s)}return i}static pathExists(e,r){return r.split(".").every(i=>!e||!(i in e)?!1:(e=e[i],!0))}static pathifyKeys(e){const r={};for(const t in e)if(Zu(e,t))if(Array.isArray(e[t]))r[t]=e[t].slice();else if(e[t]instanceof Object){const i=this.pathifyKeys(e[t]);for(const n in i)r[`${t}.${n}`]=i[n]}else r[t]=e[t];return r}static deletePath(e,r){r.split(".").reduce((t,i,n,s)=>{if(t==null)return null;if(Zu(t,i))if(n===s.length-1)delete t[i];else return t[i]},e)}static coerce(e,r){const t=U.typeOf(e),i=U.typeOf(r),n=typeof e=="string";if(t!==i)switch(i){case"string":return String(e);case"number":return Number(e);case"boolean":return n&&(!e||e==="false"||e==="0")?!1:!!e;case"null":return n&&(!e||e==="null")?null:!1;case"undefined":return n&&(!e||e==="undefined")?void 0:!1;case"date":return n&&isNaN(e)?b.parse(e):Date(Number(e))}return e}static wrapProperty(e,r,t,i,n=!0){const s={};let a=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(a,r);for(;!o&&a&&n;)a=Object.getPrototypeOf(a),a&&(o=Object.getOwnPropertyDescriptor(a,r));o?(o.set?s.set=l=>{o.set.call(e,l),i&&i.call(e,o.get.call(e))}:s.set=i,o.get?s.get=()=>{let l=o.get.call(e);return t&&(l=t.call(e,l)),l}:s.get=t):(s.set=l=>{e[`_${r}`]=l,i&&i.call(e,l)},s.get=()=>{let l=e[`_${r}`];return t&&(l=t.call(e,l)),l}),Object.defineProperty(e,r,s)}static hookProperty(e,r,t){const i=T.getPropertyDescriptor(t.prototype,"value"),n=T.getPropertyDescriptor(e,r),s=`_${r}`,a=class{get value(){return n?n.get.call(this):this[s]}set value(l){n?n.set.call(this,l):this[s]=l}},o=T.getPropertyDescriptor(a.prototype,"value");return Object.setPrototypeOf(t.prototype,a.prototype),Object.defineProperty(e,r,{configurable:!0,get:i.get||o.get,set:i.set||o.set}),()=>delete e[r]}static getPropertyDescriptor(e,r){let t=null;for(let i=e;i&&!t&&!Zu(i,"isBase");i=Object.getPrototypeOf(i))t=Object.getOwnPropertyDescriptor(i,r);return t}static cleanupProperties(e,r=!1){return Object.entries(e).forEach(([t,i])=>{r?i===void 0&&delete e[t]:i==null&&delete e[t]}),e}static removeAllProperties(e){return Object.keys(e).forEach(r=>delete e[r]),e}static assertType(e,r,t){const i=U.typeOf(e);if(e!=null&&i!==r)throw new Error(`Incorrect type "${i}" for ${t}, expected "${r}"`)}static assertObject(e,r){Ht.assertType(e,"object",r)}static assertInstance(e,r){Ht.assertType(e,"instance",r)}static assertClass(e,r){Ht.assertType(e,"class",r)}static assertFunction(e,r){if(typeof e!="function"||e.isBase||e.$$name)throw new Error(`Incorrect type for ${r}, got "${e}" (expected a function)`)}static assertNumber(e,r){const t=Number(e);if(typeof e!="number"||isNaN(t))throw new Error(`Incorrect type for ${r}, got "${e}" (expected a Number)`)}static assertBoolean(e,r){Ht.assertType(e,"boolean",r)}static assertString(e,r){Ht.assertType(e,"string",r)}static assertArray(e,r){Ht.assertType(e,"array",r)}static toFixed(e,r){return Ry?Ry(e,r):e.toFixed(r)}static roundTo(e,r=1){return Math.round(e/r)*r}static round(e,r){if(r==null)return e;const t=10**r;return Math.round(e*t)/t}static getMapPath(e,r,t){const i=Array.isArray(r)?r:typeof r=="string"?r.split("."):[r],n=i.length===1,s=i[0],a=e.has(s)?e.get(s):e.set(s,n?t:{}).get(s);return n?a:Ht.getPathDefault(a,i.slice(1),t)}},Ht=T;T._$name="ObjectHelper";var Ty=["border-top-width","border-right-width","border-bottom-width","border-left-width"],E0=["margin-top","margin-right","margin-bottom","margin-left"],x0=["padding-top","padding-right","padding-bottom","padding-left"],ri={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},Hl={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},R0=Object.freeze({x:0,y:0}),T0=/^([trblc])(\d*)-([trblc])(\d*)$/i,M0=/^([trblc])(\d*)$/i,Vl=["top","right","bottom","left"],Ma={t:0,r:1,b:2,l:3},Ju=["b-t","l-r","t-b","r-l"],P0={bt:1,tb:1,lr:2,rl:2},My=Object.freeze([0,0]),I0=["width","height"],Nl=(e,r=e,t=e,i=r)=>Array.isArray(e)?Nl.apply(null,e):[e,r,t,i];function Py(e,r){const t=T0.exec(e),i=t[1],n=t[3],s=parseInt(t[2]||50),a=parseInt(t[4]||50),o=r&&!(Ma[i]&1)?100-s:s,l=r&&!(Ma[n]&1)?100-a:a,c=P0[i+n];return{myAlignmentPoint:i+o,myEdge:i,myOffset:o,targetAlignmentPoint:n+l,targetEdge:n,targetOffset:l,startZone:Ma[n],edgeAligned:c}}function A0(e){return`${Vl[(Ma[e.myEdge]+2)%4][0]}${e.myOffset}-${Vl[(Ma[e.targetEdge]+2)%4][0]}${e.targetOffset}`}function _0(e){return e==null?My:typeof e=="number"?[e,e]:e}var k=class{get isRectangle(){return!0}static from(e,r,t){if(typeof e=="string"?e=document.querySelector(e):(e==null?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),typeof r=="string"&&(r=document.querySelector(r)),e==null||e.isRectangle)return e;if(e=e.element||e,t===void 0&&typeof r=="boolean"&&(t=r,r=null),!(r!=null&&r.isRectangle))if(r){let{scrollLeft:l,scrollTop:c}=r;Y.isSafari&&r===document.body&&(l=c=0),r=k.from(r).translate(-l,-c)}else r=R0;const i=e===document||e===globalThis,n=e===document.body&&document.body.offsetHeight===0,s=n&&e.getBoundingClientRect(),a=n?new k(s.left,s.top,s.width,document.body.parentElement.scrollHeight):i?new k(0,0,globalThis.innerWidth,globalThis.innerHeight):e.getBoundingClientRect(),o=t||i?[0,0]:[globalThis.pageXOffset,globalThis.pageYOffset];return new k(a.left+o[0]-r.x,a.top+o[1]-r.y,a.width,a.height)}static fromScreen(e,r){return k.from(e,r,!0)}static inner(e,r,t=!1){const i=this.from(e,r,t);if(document.body.contains(e)){const n=C.getStyleValue(e,Ty);i.x+=parseFloat(n[ri.l]),i.y+=parseFloat(n[ri.t]),i.right-=parseFloat(n[ri.r]),i.bottom-=parseFloat(n[ri.b])}return i}static content(e,r,t=!1){const i=this.from(e,r,t);if(document.body.contains(e)){const n=C.getStyleValue(e,Ty),s=C.getStyleValue(e,x0);i.x+=parseFloat(n[ri.l])+parseFloat(s[Hl.l]),i.y+=parseFloat(n[ri.t])+parseFloat(s[Hl.t]),i.right-=parseFloat(n[ri.r])+parseFloat(s[Hl.r]),i.bottom-=parseFloat(n[ri.b])+parseFloat(s[Hl.b])}return i}static client(e,r,t=!1){const i=this.content(e,r,t),n=C.scrollBarWidth;let s;return n&&(e.scrollHeight>e.clientHeight&&C.getStyleValue(e,"overflow-y")!=="hidden"&&(s=parseFloat(C.getStyleValue(e,"padding-right")),i.right+=s-Math.max(s,n)),e.scrollWidth>e.clientWidth&&C.getStyleValue(e,"overflow-x")!=="hidden"&&(s=parseFloat(C.getStyleValue(e,"padding-bottom")),i.bottom+=s-Math.max(s,n))),i}static outer(e,r,t=!1){const i=this.from(e,r,t);if(document.body.contains(e)){const n=C.getStyleValue(e,E0);i.x-=parseFloat(n["margin-left"]),i.y-=parseFloat(n["margin-top"]),i.right+=parseFloat(n["margin-right"]),i.bottom+=parseFloat(n["margin-bottom"])}return i}static union(...e){let{x:r,y:t,right:i,bottom:n}=e[0],s;if(e.length>1)for(let a=1;a<e.length;a++)s=e[a],s.x<r&&(r=s.x),s.y<t&&(t=s.y),s.right>i&&(i=s.right),s.bottom>n&&(n=s.bottom);return new k(r,t,i-r,n-t)}roundPx(e=globalThis.devicePixelRatio||1){const r=this;return r._x=C.roundPx(r._x,e),r._y=C.roundPx(r._y,e),r._width=C.roundPx(r._width,e),r._height=C.roundPx(r._height,e),r}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,r,t,i){T.assertNumber(e,"Rectangle.x"),T.assertNumber(r,"Rectangle.y"),T.assertNumber(t,"Rectangle.width"),T.assertNumber(i,"Rectangle.height");const n=this;t<0&&(e+=t,t=-t),i<0&&(r+=i,i=-i),n._x=e,n._y=r,n._width=t,n._height=i}clone(){const e=this,r=new k(e.x,e.y,e.width,e.height);return r.isAlignRectangle=e.isAlignRectangle,r.minHeight=e.minHeight,r.minWidth=e.minWidth,r}contains(e){const r=this;return e.isRectangle?e._x>=r._x&&e._y>=r._y&&e.right<=r.right&&e.bottom<=r.bottom:!1}intersect(e,r=!1,t=!1){const i=this,n=Math.max(i.y,e.y),s=Math.min(i.right,e.right),a=Math.min(i.bottom,e.bottom),o=Math.max(i.x,e.x);return(t?a>=n&&s>=o:a>n&&s>o)?r?!0:new k(o,n,s-o,a-n):!1}equals(e,r=!1){const t=r?i=>Math.round(i):i=>i;return e.isRectangle&&t(e.x)===t(this.x)&&t(e.y)===t(this.y)&&t(e.width)===t(this.width)&&t(e.height)===t(this.height)}translate(e,r){return this._x+=e||0,this._y+=r||0,this}moveTo(e,r){return e!=null&&(this._x=e),r!=null&&(this._y=r),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new k.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const r=e-this._x;this._x=e,this._width-=r}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const r=e-this._y;this._y=e,this._height-=r}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,r=!0){return r?e?this.right:this.left:this.top}getEnd(e,r=!0){return r?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const r=this;isNaN(e)?r._minWidth=null:(r._minWidth=Number(e),r.isAlignRectangle||(r.width=Math.max(r.width,r._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const r=this;isNaN(e)?r._minHeight=null:(r._minHeight=Number(e),r.isAlignRectangle||(r.height=Math.max(r.height,r._minHeight)))}get minHeight(){return this._minHeight}adjust(e,r,t,i){const n=this;return n.x+=e,n.y+=r,n.width+=t,n.height+=i,n}inflate(e,r=e,t=e,i=r){return Array.isArray(e)&&([e,r,t,i]=Nl(e)),this.adjust(-i,-e,r,t)}deflate(e,r=e,t=e,i=r){return Array.isArray(e)&&([e,r,t,i]=Nl(e)),this.adjust(i,e,-r,-t)}constrainTo(e,r){const t=this,i=t.height,n=t.y,s=t.minWidth||t.width,a=t.minHeight||t.height;if(t.height>=e.height){if(r&&a>e.height)return!1;t._y=e.y,t.height=e.height}if(t.width>=e.width){if(r&&s>e.width)return t.y=n,t.height=i,!1;t._x=e.x,t.width=e.width}return t.translate.apply(t,t.constrainVector=[Math.min(e.right-t.right,0),Math.min(e.bottom-t.bottom,0)]),t.translate(Math.max(e.x-t.x,0),Math.max(e.y-t.y,0)),t}alignTo(e){let r=this.clone(),{target:t,constrainTo:i,constrainPadding:n}=e,s,a,o,l;if(t&&!t.isRectangle&&(t=k.from(t.element?t.element:t)),i){if(!i.isRectangle){l=i===globalThis||i===document;const M="ignorePageScroll"in e?e.ignorePageScroll:!l;i=k.from(i.element?i.element:i,null,M)}n&&(n=Nl(n),n[0]=Math.min(n[0],t.top),n[1]=Math.min(n[1],i.right-t.right),n[2]=Math.min(n[0],i.bottom-t.bottom),n[3]=Math.min(n[0],t.left),i=i.deflate.apply(i.clone(),n))}const c=this,d=_0(e.offset),{align:u,axisLock:h,anchorSize:f,anchorPosition:g,matchSize:m,position:p,rtl:v}=e,y=Py(u,v),S=i&&i.clone(),D=[],w=[{zone:a=y.startZone,align:u}],E=m&&I0[y.startZone&1],x=c[E];if(E&&h?r[E]=t[E]:!y.edgeAligned&&m&&(r.width=t.width,r.height=t.height),i&&r.constrainTo(i),i&&y.startZone!=null)if(h)w.push({zone:a=(a+2)%4,align:A0(y)}),h==="flexible"&&(w.push({zone:a=(y.startZone+1)%4,align:Ju[a]}),w.push({zone:a=(a+2)%4,align:Ju[a]}));else for(let M=1;M<4;M++)w.push({zone:a=(a+1)%4,align:Ju[a]});if(g){const M=y.startZone&1?"y":"x";s={[M]:g[M],edge:Vl[(y.startZone+2)%4]}}if(S&&t&&(S.adjust(-t.width,-t.height,t.width,t.height),t.constrainTo(S)),r.minWidth=c.minWidth,r.minHeight=c.minHeight,p)r.moveTo(p.x,p.y),i&&r.constrainTo(i);else{const M=y.myEdge==="c"||y.targetEdge==="c",I=f&&!M?[f[1]+d[0],f[1]+d[1]]:d,P=t.getAlignmentPoint(y.targetAlignmentPoint,I),_=r.getAlignmentPoint(y.myAlignmentPoint);r.translate(P[0]-_[0],P[1]-_[1]);let A=r.intersect(t,!0);if(A)i&&r.constrainTo(i),o=y.startZone,r.translate(...I);else if(i&&!i.contains(r)){const V=r.clone(),N=[];let B,Z;s=null,D[0]=B=i.clone(),B.bottom=t.y-I[1],D[1]=B=i.clone(),B.x=t.right+I[0],D[2]=B=i.clone(),B.y=t.bottom+I[1],D[3]=B=i.clone(),B.right=t.x-I[0];for(let K=0;K<w.length;K++){if(E&&K==2&&(r[E]=x),B=D[o=w[K].zone],r=r.alignTo({target:t,offsets:I,align:w[K].align}),r.constrainTo(B,!0)&&(N.push({result:r,zone:o}),!Z||r.width<c.width||r.height<c.height)){r.align=w[K].align;break}if(!Z||B.area>Z.area){const se=r.clone();switch(o){case 0:se.moveTo(null,B.bottom-se.height);break;case 1:se.moveTo(B.left);break;case 2:se.moveTo(null,B.top);break;case 3:se.moveTo(B.right-se.width);break}Z={area:B.area,result:se,zone:o}}}N.length?(N.length>1&&!h&&N.sort((K,se)=>{const xe=Math.sqrt((V.x-K.result.x)**2+(V.y-K.result.y)**2),gr=Math.sqrt((V.x-se.result.x)**2+(V.y-se.result.y)**2);return xe-gr}),r=N[0].result,o=N[0].zone):(r=Z.result,o=Z.zone,l&&r.constrainTo(i))}else o=y.startZone;if(r.zone=o,r.overlap=A=r.intersect(t,!0),f&&!A){if(!s){const V=o&1,N=V?"y":"x",B=V?"bottom":"right",Z=Math.max(t[N],r[N]),K=Math.min(t[B],r[B]);let se=Z+(K-Z)/2-f[0]/2;const xe=se+f[0];xe>r[B]&&(se-=xe-r[B]),se<r[N]&&(se+=r[N]-se),s={[N]:se-r[N],edge:Vl[(o+2)%4]}}r.anchor=s}}return r}getAlignmentPoint(e,r=My){const t=this,i=M0.exec(e),n=i[1].toLowerCase(),s=Math.min(Math.max(parseInt(i[2]||50),0),100)/100;switch(n){case"t":return[t.x+t.width*s,t.y-r[1]];case"r":return[t.right+r[0],t.y+t.height*s];case"b":return[t.x+t.width*s,t.bottom+r[1]];case"l":return[t.x-r[0],t.y+t.height*s];case"c":return[t.x+t.width/2,t.y+t.height/2]}}highlight(){const e=this,r=C.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;
                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return C.highlight(r).then(()=>r.remove())}visualize(e,r){const t=this,i=T.merge({style:{left:`${t.x}px`,top:`${t.y}px`,width:`${t.width}px`,height:`${t.height}px`,pointerEvents:"none",...e.class?{}:{position:"absolute","z-index":9999999}}},e);return r?i:C.createElement(i)}toString(e=","){return[`${this.top}px`,`${this.right}px`,`${this.bottom}px`,`${this.left}px`].join(e)}};k._$name="Rectangle";var ki=Symbol("value"),Iy=Symbol("length"),J=class{static change(e,r,t,i="string"){t=J.normalize(t,"object");const n=J.normalize(e,"array").filter(s=>!t[s]);if(r){r=J.normalize(r,"array");for(let s=0;s<r.length;++s)n.includes(r[s])||n.push(r[s])}return J.normalize(n,i)}static from(e,r){return e&&(e.isDomClassList?r=r!=null?r:!0:(r=r!=null?r:U.isObject(e)&&!U.isEmpty(e),e=new J(e)),!e.value&&!r&&(e=null)),e||(r?new J:null)}static normalize(e,r="string"){e=e||"";const t=typeof e,i=r==="array",n=r==="object",s=!i&&!n;let a=t==="string",o,l,c;for(t==="object"&&(e.nodeType===Element.ELEMENT_NODE&&typeof e.getAttribute=="function"?(e=e.getAttribute("class")||"",a=!0):e!=null&&e.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter(d=>e.get(d)):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=U.getTruthyKeys(e))),a&&(e=[...new Set(L.split(e))]),l=e.length;l-- >0;)o=e[l],o.length?o.includes(" ")&&e.splice(l,1,...L.split(o)):e.splice(l,1);if(i)c=e;else if(s)c=e.join(" ");else for(c=Object.create(null),l=0;l<e.length;++l)c[e[l]]=!0;return c}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new J(this)}contains(e){return typeof e=="string"&&e?!!this[e]:!1}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const r=J.normalize(e,"array"),t=r.length;if(this.length===t){for(let i=0;i<t;i++)if(!this[r[i]])return!1;return!0}return!1}get value(){let e=this[ki],r;return e==null&&(r=U.getTruthyKeys(this),this[Iy]=r.length,this[ki]=e=r.join(" ")),e}set value(e){const r=this,t=Object.keys(r),i=t.length;for(let n=0;n<i;n++)delete r[t[n]];e?r.process(1,[e]):delete r[ki]}get values(){return U.getTruthyKeys(this)}get length(){return this.value?this[Iy]:0}process(e,r){for(let t,i,n=0;n<r.length;n++)if(r[n])if(t=r[n],t.isDomClassList||U.isObject(t))for(i in t)this[i]=e?t[i]:!t[i];else for(t=J.normalize(r[n],"array"),i=0;i<t.length;++i)this[t[i]]=e;return delete this[ki],this}assign(e){for(const r in e)!this[r]!=!e[r]&&(this[r]=e[r],delete this[ki]);return this}assignTo(e){const r=e.nodeType===Element.ELEMENT_NODE?e.classList:e,t=J.from(r);t.add(this),r.value=t.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,r=!this[e]){if(r=!!r,!!this[e]!==r)return this[e]=r,delete this[ki],!0}split(){return U.getTruthyKeys(this)}forEach(e){return U.getTruthyKeys(this).forEach(e)}};J.prototype[ki]=null,J._$name="DomClassList";var ir=class extends k{static from(e){const r=e.changedTouches;return new ir(r?r[0].screenX:e.screenX,r?r[0].screenY:e.pageY)}constructor(e,r){super(e,r,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}};Object.getPrototypeOf(ir).Point=ir,ir._$name="Point";var F0=["clientX","clientY","pageX","pageY","screenX","screenY"],k0={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1},ii=!0,Ay={configurable:ii,value:!0},O0={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},L0={Meta:1,Control:1,Alt:1},$0={Control:"ctrl",Alt:"alt",Shift:"shift"},j0=/^(ctrl|shift|alt|meta)$/,B0=["altKey","bubbles","button","buttons","cancelBubble","cancelable","clientX","clientY","ctrlKey","layerX","layerY","metaKey","pageX","pageY","returnValue","screenX","screenY","shiftKey"],_y=class{static normalizeEvent(e){return T.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],F0)}static copyEvent(e,r){return T.copyProperties(e,r,B0)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,r){const t=Ne.getXY(e),i=Ne.getXY(r);return Math.sqrt(Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2))}static getPagePoint(e){return new k.Point(e.pageX,e.pageY)}static getClientPoint(e){return new k.Point(e.clientX,e.clientY)}static addListener(e,r,t,i){return e.nodeType?typeof r=="string"?i=Object.assign({element:e,[r]:t},i):i=Object.assign({element:e},r):i=e,Ne.on(i)}static on(e){const r=e.element,t=e.thisObj,i=[];for(const s in e)if(!k0[s]){let a=e[s];typeof a!="object"&&(a={handler:a});const o=a.element||r;i.push(Ne.addElementListener(o,s,a,e))}const n=()=>{for(let s,a=0;a<i.length;a++)s=i[a],Ne.removeEventListener(s[0],s[1],s[2]);i.length=0};return t&&e.autoDetach!==!1&&(t.doDestroy=Te.createInterceptor(t.doDestroy,n,t)),n}static addElementListener(e,r,t,i){const n=Ne.createHandler(e,r,t,i),{spec:s}=n,a=t.expires||i.expires,o=s.capture!=null||s.passive!=null?{capture:s.capture,passive:s.passive}:void 0;if(e.addEventListener(r,n,o),a){const l=t.thisObj||i.thisObj,c=l!=null&&l.isDelayable?l:globalThis,{alt:d}=a,u=d?a.delay:a,{spec:h}=n;h.expires=a,h.timerId=c[typeof u=="number"?"setTimeout":"requestAnimationFrame"](()=>{h.timerId=null,Ne.removeEventListener(e,r,n),d&&!n.called&&(typeof d=="string"?l[d]:d).call(l)},u,`listener-timer-${performance.now()}`)}return[e,r,n,o]}static getComposedPathTarget(e){return e.composedPath()[0]||e.path[0]}static fixEvent(e){var r,t,i;if(e.fixed)return e;const{type:n,target:s}=e;if((s!=null&&s.shadowRoot||(t=(r=s==null?void 0:s.getRootNode)==null?void 0:r.call(s))!=null&&t.host)&&e.composedPath){const a=this.getComposedPathTarget(e),o=s;Object.defineProperty(e,"target",{value:a,configurable:ii}),Object.defineProperty(e,"originalTarget",{value:o,configurable:ii})}if(Object.defineProperty(e,"fixed",Ay),n.startsWith("key")){const a=O0[e.key];a&&Object.defineProperty(e,"key",{value:a,configurable:ii}),e.key===" "&&!e.code&&Object.defineProperty(e,"code",{value:"Space",configurable:ii})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",Ay),s&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"borderOffsetX")||Object.defineProperty(e,"borderOffsetX",{get:()=>e.offsetX+(Y.isSafari?0:parseInt(s.ownerDocument.defaultView.getComputedStyle(s).getPropertyValue("border-left-width")))}),Object.getOwnPropertyDescriptor(e,"borderOffsetY")||Object.defineProperty(e,"borderOffsetY",{get:()=>e.offsetY+(Y.isSafari?0:parseInt(s.ownerDocument.defaultView.getComputedStyle(s).getPropertyValue("border-top-width")))})),(s==null?void 0:s.nodeType)===Element.DOCUMENT_NODE&&"clientX"in e){const a=C.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{value:a,configurable:ii})}if((s==null?void 0:s.nodeType)===Element.TEXT_NODE){const a=e.target.parentElement;Object.defineProperty(e,"target",{value:a,configurable:ii})}if(((i=e.relatedTarget)==null?void 0:i.nodeType)===Element.TEXT_NODE){const a=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{value:a,configurable:ii})}return n.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,r,t,i){const n=t.delay||i.delay,s=t.throttled||i.throttled,a=t.block||i.block,o="once"in t?t.once:i.once,l="capture"in t?t.capture:i.capture,c="passive"in t?t.passive:i.passive,d="delegate"in t?t.delegate:i.delegate,u=t.handler,h=t.expires,f=t.thisObj||i.thisObj,{rtlSource:g=f}=f||{};let m=(p,...v)=>{Ne.playingDemo&&p.isTrusted||f!=null&&f.isDestroyed||(p=Ne.fixEvent(p,g==null?void 0:g.rtl),m.called=!0,(typeof u=="string"?f[u]:u).call(f,p,...v),delete p.target,delete p.relatedTarget,delete p.originalarget,delete p.key,delete p.code,delete p.ctrlKey,delete p.fixed)};if(a){const p=m;let v,y;m=(S,...D)=>{const w=performance.now();(!v||S.target!==y||w-v>a)&&(y=S.target,v=w,p(S,...D))}}if(n!=null){const p=m,v=f!=null&&f.setTimeout?f:globalThis;m=(...y)=>{v.setTimeout(()=>{p(...y)},n)}}if(s!=null){let p,v=s;s.buffer&&(p=y=>s.alt.call(Ne,Ne.fixEvent(y,g==null?void 0:g.rtl)),v=s.buffer),f!=null&&f.isDelayable?m=f.throttle(m,{delay:v,throttled:p}):m=Te.createThrottled(m,v,f,null,p)}if(o){const p=m;m=(...v)=>{Ne.removeEventListener(e,r,m),p(...v)}}if(d){const p=m;m=(v,...y)=>{var S;v=Ne.fixEvent(v,g==null?void 0:g.rtl);const D=((S=v.target.closest)==null?void 0:S.call)&&v.target.closest(d);D&&(Object.defineProperty(v,"currentTarget",{get:()=>D,configurable:!0}),p(v,...y))}}return t.thisObj&&t.autoDetach!==!1&&(f.doDestroy=Te.createInterceptor(f.doDestroy,()=>Ne.removeEventListener(e,r,m),f)),m.spec={delay:n,throttled:s,block:a,once:o,thisObj:f,capture:l,expires:h,passive:c,delegate:d},m}static removeEventListener(e,r,t){const{expires:i,timerId:n,thisObj:s,capture:a}=t.spec;i!=null&&i.alt&&n&&(s!=null&&s.isDelayable?s:globalThis)[typeof i.delay=="number"?"clearTimeout":"cancelAnimationFrame"](n),e.removeEventListener(r,t,a)}static onTransitionEnd({element:e,animationName:r,property:t,handler:i,mode:n=r?"animation":"transition",duration:s=C[`get${n==="transition"?"Property":""}${L.capitalize(n)}Duration`](e,t),thisObj:a=globalThis,args:o=[],timerSource:l,runOnDestroy:c}){let d;l=l||(a.isDelayable?a:globalThis);const u=[e,t,...o],h=()=>{f(),a.isDestroyed||(a.callback?a.callback(i,a,u):i.apply(a,u))},f=Ne.on({element:e,[`${n}end`]({animationName:g,propertyName:m,target:p}){p===e&&(m===t||g!=null&&g.match(r))&&(d&&(l.clearTimeout(d),d=null),h())}});return s!=null&&(d=l.setTimeout(h,s+50,"onTransitionEnd",c)),f}static async waitForTransitionEnd(e){return new Promise(r=>{e.handler=r,_y.onTransitionEnd(e)})}static createDblClickWrapper(e,r,t){let i,n,s;return()=>{n||(n=Ne.on({element:e,touchstart:a=>{i=a.changedTouches[0].identifier,a.preventDefault()},touchend:a=>{if(a.changedTouches[0].identifier===i){a.preventDefault(),clearTimeout(s),i=n=null;const o=k.from(a.changedTouches[0].target,null,!0),l=a.changedTouches[0].pageX-o.x,c=a.changedTouches[0].pageY-o.y,d=Object.assign({browserEvent:a},a),u=new MouseEvent("dblclick",d);Object.defineProperties(u,{target:{value:a.target},offsetX:{value:l},offsetY:{value:c}}),typeof r=="string"&&(r=t[r]),r.call(t,u)}},once:!0}),s=setTimeout(()=>{n(),i=n=null},Ne.dblClickTime))}}static toSpecialKey(e,r=Y.isMac?"metaKey":"ctrlKey"){let t=!1;return e===!0?t=r:typeof e=="string"&&(e=e.toLowerCase(),e.match(j0)&&(t=`${e}Key`)),t}static specialKeyFromEventKey(e){return $0[e]||""}},j=_y;R(j,"eventNameMap",{mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"});var Ne=j;Ne.longPressTime=700,Ne.dblClickTime=300,Ne.globalListenerDetacher=Ne.on({element:document,capture:!0,passive:!0,pointerdown({target:e}){var r;const t=C.getRootElement(e);C.usingKeyboard=!1,(r=t.classList)==null||r.remove("b-using-keyboard"),C.removeClsGlobally(t,"b-using-keyboard")},keydown({target:e,key:r}){if(!L0[r]){C.usingKeyboard=!0;const t=C.getRootElement(e);t.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Array.from(t.children).forEach(i=>{i.matches(".b-outer")&&i.classList.add("b-using-keyboard")}):t.classList.add("b-using-keyboard")}}}),Y.isTouchDevice&&Ne.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),j._$name="EventHelper";var H0=14,V0={align:"t0-t0"},Pa=Node.ELEMENT_NODE,zl=Node.TEXT_NODE,{isObject:N0}=T,Fy=/[+-]?\d*\.?\d+[eE]?-?\d*/g,pr=Fy.source,z0=new RegExp(`matrix\\((?:${pr}),\\s?(?:${pr}),\\s?(?:${pr}),\\s?(?:${pr}),\\s?(${pr}),\\s?(${pr})`),W0=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),Wl=new RegExp(`(?:${z0.source})|(?:${W0.source})`),U0=new RegExp(`translate(3d|X)?\\((${pr})px(?:,\\s?(${pr})px)?`),G0=new RegExp(`translate(3d|Y)?\\((${pr})px(?:,\\s?(${pr})px)?`),Y0=/\s+/,q0=/\s*;\s*/,K0=/\s*:\s*/,X0=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,Z0="$bryntum",J0={elementData:"",for:"htmlFor",retainElement:""},Q0={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},ky={length:1,parentRule:1,style:1},eR={INPUT:1,TEXTAREA:1},tR={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},Ul=globalThis,rt=document,rR=Object.freeze({}),Qu=Array.prototype.slice,iR=Promise.resolve(),nR=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],sR=e=>e._hidden,aR=e=>e.parentNode||e.host,oR=(e,r,t)=>t.key==="children"?T.mergeItems(e,r,t):T.blend(e,r,t),eh=e=>{const r=e.ownerDocument.defaultView.getComputedStyle(e);return r.getPropertyValue("display")!=="none"&&r.getPropertyValue("visibility")!=="hidden"},ni=e=>e&&(e===rt.body||!!e.offsetParent||(e.ownerDocument.defaultView&&"offsetParent"in e&&C.getStyleValue(e,"position")!=="fixed"?e.offsetParent:ni(e.parentNode))),Oy=e=>e instanceof Node?e:typeof e=="string"?W.createElementFromTemplate(e):W.createElement(e),Ia=Object.create(null),Ly=(e,r)=>{const t=Ia[e]||[L.hyphenate(e),r];return Ia[e]||(Ia[t[0]]=Ia[e]=t),t},lR=e=>e.ownerSVGElement?e.ownerSVGElement.parentNode:e.offsetParent,cR=/b-slide-in-from-\w+/;["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing"].forEach(e=>Ly(e,!0));var Aa=null,dR=0,Oi=null,th,$y,jy,C=class{static async slideIn(e,r=1){const t=`b-slide-in-${r>0?"next":"previous"}`,{classList:i}=e,{style:n}=e.parentNode,{overflow:s,overflowX:a,overflowY:o}=n;n.overflow="hidden",i.add(t),await j.waitForTransitionEnd({element:e,animationName:cR}),n.overflow=s,n.overflowX=a,n.overflowY=o,i.remove(t)}static isFocusable(e,r=!1){if(!r&&(!W.isVisible(e)||W.Widget.fromElement(e,sR)))return!1;const t=e.nodeName;return tR[t]||(t==="A"||t==="LINK")&&!!e.href||e.getAttribute("tabIndex")!=null||e.contentEditable==="true"}static isEditable(e){return e.isContentEditable||eR[e.nodeName]}static isInView(e,r=!1,t){if(!ni(e))return!1;const i=(t==null?void 0:t.positioned)&&C.getStyleValue(t.element,"position")!=="fixed",n=k.from(globalThis),s=r?"contains":"intersect",a=i&&t.element.offsetParent,o=i&&k.from(a);if(n.height=rt.scrollingElement.scrollHeight,e===rt.body)return n;const l=this.getViewportIntersection(e,n,s);return l&&i&&l.translate(rt.scrollingElement.scrollLeft,rt.scrollingElement.scrollTop),i&&l?l.translate(-o.x+a.scrollLeft,-o.y+a.scrollTop):l}static getViewportIntersection(e,r,t){const{parentNode:i}=e,{parentElement:n}=i.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.getRootNode().host:e,s=n.ownerDocument.defaultView.getComputedStyle(n),a=s.overflowX!=="visible"||s.overflowY!=="visible",o=lR(e);let l=k.from(e,null,!0);for(let c=a?e.parentNode:o;l&&c!==rt.documentElement;c=c.parentNode){c.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&c.host&&(c=c.host.parentNode);const d=c===rt.body,u=c.ownerDocument.defaultView.getComputedStyle(c),h=d?r:k.inner(c,null,!0);(d||u.overflow!=="visible")&&(l=h[t](l,!1,!0))}return l}static isVisible(e){const r=e.ownerDocument;for(;e;e=aR(e)){if(e===r)return!0;if(e.nodeType===e.ELEMENT_NODE&&!eh(e))return!1}return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...r){return T.blend(e,r,{merge:oR})}static normalizeChildren(e,r,t){var i;let n=e==null?void 0:e.children,s,a,o,l,c;if((i=e==null?void 0:e.syncOptions)!=null&&i.ignoreRefs&&(t=!0),n&&!(e instanceof Node))if(Array.isArray(n))for(a=0;a<n.length;++a)W.normalizeChildren(n[a],r,t);else{l=n,e.children=n=[];for(o in l)s=l[o],s!=null&&s.isWidget&&(s=s.element),c=!o.startsWith("$")&&!W.isElement(s),c&&(r==null||r(o,!t)),s&&(s instanceof Node||(s.reference===!1?delete s.reference:c&&typeof s!="string"&&(s.reference=o),W.normalizeChildren(s,r,t)),n.push(s))}return e}static roundPx(e,r=globalThis.devicePixelRatio||1){const t=1/r;return Math.round(e/t)*t}static floorPx(e,r=globalThis.devicePixelRatio||1){const t=1/r;return Math.floor(e*t)/t}static isCustomElement(e){return!!(e!=null&&e.shadowRoot)}static elementFromPoint(e,r){let t=document.elementFromPoint(e,r);return W.isCustomElement(t)&&(t=t.shadowRoot.elementFromPoint(e,r)||t),t}static childFromPoint(e,r,t,i=e){const n=t==null?r:new k(r,t,0,0);let s=null;return Array.from(e.children).reverse().some(a=>{if(k.from(a,i).contains(n))return s=a.children.length&&W.childFromPoint(a,n,null,i)||a,!0}),s}static unitize(e,r,t="px"){const[i,n]=Ly(e);return r!=null&&(r=String(r),r=n&&X0.test(r)?r+t:r),[i,r]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){e!=null&&e.isWidget&&(e=e.element);let r=((e==null?void 0:e.getRootNode())||document).activeElement;for(;r!=null&&r.shadowRoot;)r=r.shadowRoot.activeElement;return r}static getRootElement(e){var r;const t=(r=e.getRootNode)==null?void 0:r.call(e),{nodeType:i}=t;return i===Node.DOCUMENT_NODE?t.body:i===Node.DOCUMENT_FRAGMENT_NODE?t:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var r;const t=(r=e.getRootNode)==null?void 0:r.call(e);if(t!=null&&t.body)return t==null?void 0:t.body;for(;e.parentNode!==t&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){return e===document.body||e.constructor.name==="ShadowRoot"}static getId(e){return e.id||(e.id="b-element-"+ ++dR)}static getCommonAncestor(e,r){var t;if(e===r)return e;for(;e&&!((t=e[e.isWidget?"owns":"contains"])!=null&&t.call(e,r)||e===r);)e=e.owner||e.parentNode;return e}static getElement(e){return e instanceof Element?e:rt.querySelector(e)}static setAttributes(e,r){const t=W.getElement(e);if(t&&r)for(const i in r)r[i]==null?t.removeAttribute(i):t.setAttribute(i,r[i])}static setLength(e,r,t){return arguments.length===1?t=typeof e=="number"?`${e}px`:e!=null?e:"":(e=W.getElement(e),t=e.style[r]=typeof t=="number"?`${t}px`:t!=null?t:""),t}static percentify(e,r=2){const t=Math.pow(10,r);return e==null||e===""||isNaN(e)?"":`${Math.round(e*t)/t}%`}static getChild(e,r){return e.querySelector(":scope>"+r)}static hasChild(e,r){return W.getChild(e,r)!=null}static children(e,r){return(r[0]===">"||r.startsWith("# "))&&(r[0]==="#"&&(r=r.substr(2)),r=":scope "+r),Array.from(e.querySelectorAll(r))}static getChildElementCount(e){return e.childElementCount}static down(e,r){return e?e.matches&&e.matches(r)?e:(r=":scope "+r,e.querySelector(r)):null}static isDescendant(e,r){const t=W.getRootElement(e),i=W.getRootElement(r);return i&&t!==i&&i.host?W.isDescendant(t,i.host):e.contains(r)}static getEventElement(e,r="target"){return!e||W.isElement(e)?e:e[r]}static isElement(e){return(e==null?void 0:e.nodeType)===document.ELEMENT_NODE&&W.isNode(e)}static isReactElement(e){return(e==null?void 0:e.$$typeof)===Symbol.for("react.element")}static isNode(e){return!!e&&typeof e.nodeType=="number"&&!N0(e)}static forEachSelector(e,r,t){if(typeof e=="string")throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");W.children(e,r).forEach(t)}static forEachChild(e,r){Array.from(e.children).forEach(r)}static removeEachSelector(e,r){W.forEachSelector(e,r,t=>t.remove())}static removeClsGlobally(e,...r){r.forEach(t=>W.forEachSelector(e,"."+t,i=>i.classList.remove(t)))}static up(e,r){return re.deprecate("Core","6.0.0","DomHelper.up() deprecated, use native `element.closest()` instead"),e.closest(r)}static getAncestor(e,r,t=null){let i=!1,n,s=e;for(r=H.asArray(r);s=s.parentElement;){if(r.includes(s)){i=!0;break}if(t&&s===t)break;n=s}return i?n||e:null}static getParents(e){const r=[];for(;e.parentElement;)r.push(e.parentElement),e=e.parentElement;return r}static makeValidId(e,r=""){return L.makeValidDomId(e,r)}static createElement(e={},r){var t,i;let n=r,s,a,o,l,c,d,u,h,f,g,m;if(typeof n=="boolean")throw new Error("Clean up");r&&(c=r.ignoreRefs,f=r.refOwner,g=r.refs,n=r.returnAll,m=r.syncIdField,c&&(o=!0,c=c!=="children")),typeof e.parent=="string"&&(e.parent=document.getElementById(e.parent));const p=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:v,html:y,reference:S,syncOptions:D,text:w}=e;if(D&&(m=D.syncIdField||m,l=D.ignoreRefs,l&&(o=!0,c=l!=="children",r={...r,ignoreRefs:!0})),c&&(f=null),e.ns?s=rt.createElementNS(e.ns,e.tag||"svg"):s=rt.createElement(e.tag||"div"),w!=null?W.setInnerText(s,w):y!=null&&(y instanceof DocumentFragment?s.appendChild(y):s.innerHTML=y),e.tooltip&&W.Widget.attachTooltip(s,e.tooltip),e.style&&W.applyStyle(s,e.style),v)for(u in v)h=v[u],h!=null&&(s.dataset[u]=h);p&&this.addChild(p,s,e.nextSibling),f&&(s.$refOwnerId=f.id),S&&!c&&(f?(s.$reference=S,f.attachRef(S,s,e)):(g||(r=Object.assign({},r),r.refs=g={}),g[S]=s,s.setAttribute("data-reference",S)));const E=e.className||e.class,x=Object.keys(e);for(E&&s.setAttribute("class",J.normalize(E)),a=0;a<x.length;++a)u=x[a],h=e[u],(d=J0[u])!=null?s[d||u]=h:!Q0[u]&&u&&h!=null&&s.setAttribute(u,h);return!e["aria-hidden"]&&!e.role&&!e.tabIndex&&!C.isFocusable(s,!0)&&!s.htmlFor&&s.setAttribute("role","presentation"),(i=r==null?void 0:r.callback)==null||i.call(r,{action:"newElement",domConfig:e,targetElement:s,syncId:f?S:r.syncIdField&&((t=e.dataset)==null?void 0:t[r.syncIdField])}),n===!0?r.returnAll=n=[s]:Array.isArray(n)&&n.push(s),e.children&&(m&&(s.syncIdMap={}),e.children.forEach(M=>{var I,P,_;if(M)if(typeof M=="string"){const A=document.createTextNode(M);f&&(A.$refOwnerId=f.id),s.appendChild(A)}else if(isNaN(M.nodeType)){M.parent=s,!M.ns&&e.ns&&(M.ns=e.ns);const A=W.createElement(M,{...r,ignoreRefs:(P=(I=e.syncOptions)==null?void 0:I.ignoreRef)!=null?P:o}),V=(_=M.dataset)==null?void 0:_[m];V!=null&&(s.syncIdMap[V]=A),delete M.parent}else s.appendChild(M)})),s.lastDomConfig=e,g||n||s}static createElementFromTemplate(e,r=rR){const{array:t,raw:i,fragment:n}=r;let s;if(W.supportsTemplate){if((th||(th=rt.createElement("template"))).innerHTML=e,s=th.content,n)return s.cloneNode(!0)}else if(s=($y||($y=new DOMParser)).parseFromString(e,"text/html").body,n){const a=s.childNodes;for(s=document.createDocumentFragment();a.length;)s.appendChild(a[0]);return s}return i?s=s.childNodes:s=s.children,s.length===1&&!t?s[0]:Qu.call(s)}static triggerMouseEvent(e,r="contextmenu"){const t=this.isInView(e),i=t||k.from(e),n=i.center,s=new MouseEvent(r,{clientX:n.x,clientY:n.y,bubbles:!0});e.dispatchEvent(s)}static insertFirst(e,r){return r&&r.nodeType!==Pa&&r.tag&&(r=W.createElement(r)),e.insertBefore(r,e.firstElementChild)}static insertBefore(e,r,t){return r&&r.nodeType!==Pa&&r.tag&&(r=W.createElement(r)),t?e.insertBefore(r,t):W.insertFirst(e,r)}static insertAt(e,r,t){const i=Array.from(e.children);if(t>=i.length)return W.append(e,r);const n=i[t];return W.insertBefore(e,r,n)}static append(e,r){if(r.forEach){if(Array.isArray(r)&&(r=r.map(t=>Oy(t))),e.append)e.append(...r);else{const t=document.createDocumentFragment();r.forEach(function(i){t.appendChild(i)}),e.appendChild(t)}return r}else return e.appendChild(Oy(r))}static getTranslateX(e){const r=e.style.transform;let t=U0.exec(r);return t?parseFloat(t[2]):(t=Wl.exec(r)||Wl.exec(W.getStyleValue(e,"transform")),t?parseFloat(t[1]||t[3]):0)}static getTranslateY(e){const r=e.style.transform;let t=G0.exec(r);if(t){const i=parseFloat(t[t[1]==="Y"?2:3]);return isNaN(i)?0:i}else return t=Wl.exec(r)||Wl.exec(W.getStyleValue(e,"transform")),t?parseFloat(t[2]||t[4]):0}static getTranslateXY(e){return[W.getTranslateX(e),W.getTranslateY(e)]}static getOffsetX(e,r=null){return r?e.getBoundingClientRect().left-r.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,r=null){return r?e.getBoundingClientRect().top-r.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,r=null){return[W.getOffsetX(e,r),W.getOffsetY(e,r)]}static focusWithoutScrolling(e){function r(i){i.forEach(({element:n,scrollLeft:s,scrollTop:a})=>{n.scrollLeft!==s&&(n.scrollLeft=s),n.scrollTop!==a&&(n.scrollTop=a)})}if(!Y.isSafari)e.focus({preventScroll:!0});else{const i=W.getParents(e),n=i.map(s=>({element:s,scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}));e.focus(),setTimeout(()=>r(n),0)}}static getPageX(e){return e.getBoundingClientRect().left+Ul.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+Ul.pageYOffset}static getExtremalSizePX(e,r){const t=L.hyphenate(r),i=t.split("-")[1];let n=W.getStyleValue(e,t);return/%/.test(n)?e.parentElement?n=parseInt(W.getStyleValue(e.parentElement,i),10):n=NaN:n=parseInt(n,10),n}static setScale(e,r,t=r){const i=W.getStyleValue(e,"transform").split(/,\s*/);i.length>1?(i[0].startsWith("matrix3d")?(i[0]=`matrix3d(${r}`,i[5]=t):(i[0]=`matrix(${r}`,i[3]=t),e.style.transform=i.join(",")):e.style.transform=`scale(${r}, ${t})`}static setTranslateX(e,r){const t=W.getStyleValue(e,"transform").split(/,\s*/);r=W.roundPx(r),t.length>1?(t[t[0].startsWith("matrix3d")?12:4]=r,e.style.transform=t.join(",")):e.style.transform=`translateX(${r}px)`}static setTranslateY(e,r){const t=W.getStyleValue(e,"transform").split(/,\s*/);r=W.roundPx(r),t.length>1?(t[t[0].startsWith("matrix3d")?13:5]=r,e.style.transform=t.join(",")+")"):e.style.transform=`translateY(${r}px)`}static setTop(e,r){W.setLength(e,"top",r)}static setLeft(e,r){W.setLength(e,"left",r)}static setTopLeft(e,r,t){W.setLength(e,"top",r),W.setLength(e,"left",t)}static setRect(e,{x:r,y:t,width:i,height:n}){W.setTopLeft(e,t,r),W.setLength(e,"width",i),W.setLength(e,"height",n)}static setTranslateXY(e,r,t){if(r==null)return W.setTranslateY(e,t);if(t==null)return W.setTranslateX(e,r);r=W.roundPx(r),t=W.roundPx(t);const i=W.getStyleValue(e,"transform").split(/,\s*/),n=i[0].startsWith("matrix3d");i.length>1?(i[n?12:4]=r,i[n?13:5]=t,e.style.transform=i.join(",")+")"):e.style.transform=`translate(${r}px, ${t}px)`}static addTranslateX(e,r){W.setTranslateX(e,W.getTranslateX(e)+r)}static addTranslateY(e,r){W.setTranslateY(e,W.getTranslateY(e)+r)}static addLeft(e,r){W.setLeft(e,W.getOffsetX(e)+r)}static addTop(e,r){W.setTop(e,W.getOffsetY(e)+r)}static alignTo(e,r,t=V0,i){r=r instanceof k?r:k.from(r,!0);const n=W.getTranslateXY(e),s=k.from(e,!0);i&&(s.roundPx(),r.roundPx());const a=s.alignTo(Object.assign(t,{target:r}));W.setTranslateXY(e,n[0]+a.x-s.x,n[1]+a.y-s.y)}static getStyleValue(e,r,t,i){const n=t?e.style:e.ownerDocument.defaultView.getComputedStyle(e,i);if(Array.isArray(r)){const s={};for(const a of r)s[a]=n.getPropertyValue(L.hyphenate(a));return s}return n.getPropertyValue(L.hyphenate(r))}static getEdgeSize(e,r,t){const i=r==="border"?"-width":"",n={raw:{}};for(const s of["top","right","bottom","left"])(!t||t.includes(s[0]))&&(n[s]=parseFloat(n.raw[s]=W.getStyleValue(e,`${r}-${s}${i}`)));return n.width=(n.left||0)+(n.right||0),n.height=(n.top||0)+(n.bottom||0),n}static parseStyle(e){if(typeof e=="string"){const r=e.split(q0);e={};for(let t=0,{length:i}=r;t<i;t++){const n=r[t].split(K0);e[n[0]]=n[1]}}return e||{}}static applyStyle(e,r,t=!1){if(typeof r=="string")t?(r.length||e.style.cssText.length)&&(e.style.cssText=r):e.style.cssText+=r;else if(r){t&&(e.style.cssText=""),r.style&&typeof r.style!="string"&&(r=T.assign({},r,r.style));let i,n;for(i in r)ky[i]||([i,n]=W.unitize(i,r[i]),n==null?e.style.removeProperty(i):e.style.setProperty(i,n));typeof r.style=="string"&&(e.style.cssText+=r.style)}}static getCSSText(e){if(typeof e=="string")return e;let r="";for(const t in e)ky[t]||(r+=`${L.hyphenate(t)}:${e[t]};`);return r}static addClasses(e,r){re.deprecate("Core","6.0.0","DomHelper.addClasses should be replaced by native classList.add"),e.classList.add(...r)}static removeClasses(e,r){re.deprecate("Core","6.0.0","DomHelper.removeClasses should be replaced by native classList.remove"),e.classList.remove(...r)}static toggleClasses(e,r,t=null){r=H.asArray(r),t===!0?e.classList.add(...r):t===!1?e.classList.remove(...r):r.forEach(i=>e.classList.toggle(i))}static addTemporaryClass(e,r,t,i=globalThis){t>0&&(e.classList.add(r),i.setTimeout({fn:n=>e.classList.remove(n),delay:t,name:r,args:[r],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,r){const t=globalThis.getComputedStyle(e),i=t.transitionProperty.split(", "),n=t.transitionDuration.split(", "),s=i.indexOf(L.hyphenate(r));let a;return s!==-1&&(a=parseFloat(n[s])*1e3),a}static getAnimationDuration(e){return parseFloat(W.getStyleValue(e,"animation-duration"))*1e3}static highlight(e,r=globalThis){return e instanceof k?e.highlight():new Promise(t=>{r.setTimeout(()=>{e.classList.add("b-fx-highlight"),r.setTimeout(()=>{e.classList.remove("b-fx-highlight"),t()},1e3)},0)})}static get scrollBarWidth(){if(Aa===null){const e=jy||(jy=W.createElement({parent:rt.documentElement,style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==rt.documentElement&&rt.documentElement.appendChild(e),Aa=e.offsetWidth}return Aa}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){Aa=null}static measureText(e,r,t=!1,i=void 0){const n=W.getMeasureElement(r,i);n[t?"innerHTML":"innerText"]=e;const s=n.clientWidth;return n.className="",s}static measureSize(e,r,t=!0){if(!e)return 0;if(typeof e=="number")return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(r){const i=W.getMeasureElement(r);i.innerHTML="",i.style.width=W.setLength(e);const n=t?i.offsetWidth:i.getBoundingClientRect().width;return i.style.width=i.className="",n}return/^\d+em$/.test(e)?parseInt(e)*H0:isNaN(e)?0:parseInt(e)}static getMeasureElement(e,r=rt.body){const t=Ul.getComputedStyle(e),i=r.offScreenDiv=r.offScreenDiv||W.createElement({parent:r,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return nR.forEach(n=>{i.style[n]!==t[n]&&(i.style[n]=t[n])}),i.className=e.className,i.parentElement.parentElement!==r&&r.appendChild(i.parentElement),i}static stripTags(e){return(W.$domParser||(W.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,r){if(typeof e=="string")if(e===""){r.innerHTML="";return}else e=W.createElementFromTemplate(e);return W.performSync(e,r),r}static performSync(e,r){return e.outerHTML!==r.outerHTML?(W.syncAttributes(e,r),W.syncContent(e,r),W.syncChildren(e,r),!0):!1}static getSyncAttributes(e){const r={},t=[];for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i];if(n.specified){const s=n.name.toLowerCase();r[s]=n.value,t.push(s)}}return{attributes:r,names:t}}static syncAttributes(e,r){const{attributes:t,names:i}=W.getSyncAttributes(e),{attributes:n,names:s}=W.getSyncAttributes(r),a=i.includes("dataset"),o=i.filter(d=>!s.includes(d)),l=s.filter(d=>!i.includes(d)&&(!a||!d.startsWith("data-"))),c=i.filter(d=>s.includes(d));if(o.length>0)for(let d=0;d<o.length;d++){const u=o[d];u==="style"?W.applyStyle(r,t.style,!0):u==="dataset"?Object.assign(r.dataset,t.dataset):r.setAttribute(u,t[u])}if(l.length>0)for(let d=0;d<l.length;d++)r.removeAttribute(l[d]);if(c.length>0)for(let d=0;d<c.length;d++){const u=c[d];if(u==="style")W.applyStyle(r,t.style,!0);else if(u==="dataset")Object.assign(r.dataset,t.dataset);else if(u==="class"&&(t.class.isDomClassList||typeof t.class=="object")){let h;t.class.isDomClassList?h=t.class:h=new J(t.class),h.isEqual(n.class)||r.setAttribute("class",h)}else n[u]!==t[u]&&r.setAttribute(u,t[u])}}static syncContent(e,r){W.getChildElementCount(e)===0&&(r.innerText=e.innerText)}static setInnerText(e,r){const{firstChild:t}=e;(t==null?void 0:t.nodeType)===Element.TEXT_NODE?t.data=r:e.textContent=r}static syncChildren(e,r){const t=this,i=Qu.call(e.childNodes),n=Qu.call(r.childNodes);for(;i.length;){const s=i.shift(),a=n.shift();if(s&&s.nodeType!==zl&&s.nodeType!==Pa)throw new Error(`Source node type ${s.nodeType} not supported by DomHelper.sync()`);if(a&&a.nodeType!==zl&&a.nodeType!==Pa)throw new Error(`Target node type ${a.nodeType} not supported by DomHelper.sync()`);if(!a)r.appendChild(s);else if(s.nodeType===a.nodeType)s.nodeType===zl?a.data=s.data:s.tagName===a.tagName?t.performSync(s,a):(r.insertBefore(s,a),a.remove());else if(s.nodeType===zl&&a.nodeType===Pa)r.innerText=s.data.trim();else{const o=s.parentElement||s;throw new Error(`Currently no support for transforming nodeType.
${o.outerHTML}`)}}n.forEach(s=>{s.remove()})}static syncClassList(e,r){const{classList:t}=e,i=typeof r=="string",n=i?r.split(Y0):J.normalize(r,"array"),s=n.length;let a=t.length!==s,o;for(o=0;!a&&o<s;o++)a=!t.contains(n[o]);return a&&(e.className=i?r:n.join(" ")),a}static updateClassList(e,r){const{classList:t}=e;let i,n,s=!1;for(i in r)n=!!r[i],t.contains(i)!==n&&(t[n?"add":"remove"](i),s=!0);return s}static setTheme(e,r){e=e.toLowerCase();const{head:t}=document,i=W.getThemeInfo(r).name.toLowerCase();let n=t.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),s=0;if(i===e)return iR;W.removeEachSelector(t,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");const a={theme:e,prev:i};function o(l,c,d){const u=C.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:l.href.replace(i,e),nextSibling:l});u.addEventListener("load",()=>{delete u.dataset.loading,Oi=null,++s===n.length&&(n.forEach(h=>h.remove()),he.trigger("theme",a),c(a))}),u.addEventListener("error",h=>{delete u.dataset.loading,d(h)})}if(n.length)return new Promise((l,c)=>{n.forEach((d,u)=>{o(d,l,c,u===n.length-1)})});{const l=t.querySelector("#bryntum-theme:not([data-loading])")||t.querySelector(`[href*="${i}.css"]:not([data-loading])`);if(!(l!=null&&l.href.includes(`${i}.css`)))throw new Error(`Theme link for ${i} not found`);return n=[l],new Promise((c,d)=>o(l,c,d))}}static get themeInfo(){return C.getThemeInfo()}static getThemeInfo(e){if(!Oi){const r=W.createElement({parent:document.body,className:"b-theme-info"}),t=W.getStyleValue(r,"content",!1,":before");if(t)try{Oi=JSON.parse(t.replace(/^["']|["']$|\\/g,""))}catch(i){Oi=null}Oi=Oi||(e?{name:e}:null),r.remove()}return Oi}static async transition({element:e,selector:r="[data-dom-transition]",duration:t,action:i,thisObj:n=this,addTransition:s={},removeTransition:a={}}){const o=new Set,l=Array.from(e.querySelectorAll(r)),c=new Map(l.map(f=>{let g=0,m=f.parentElement;for(;m&&m!==e;)g++,m=m.parentElement;f.$depth=g,f.scrollHeight>f.offsetHeight&&getComputedStyle(f).overflow==="auto"&&(f.$scrollTop=f.scrollTop,o.add(f));const{parentElement:p}=f,v=k.from(f,e),y=k.from(f,p),S=getComputedStyle(p),D=parseFloat(S.borderLeftWidth);return D&&(v.left-=D,y.left-=D),[f.id,{element:f,globalBounds:v,localBounds:y,depth:g,parentElement:p}]}));i.call(n);const d=Array.from(e.querySelectorAll(r)),u=new Map(d.map(f=>{const g=k.from(f,e),m=k.from(f,f.parentElement),p=globalThis.getComputedStyle(f.parentElement),v=parseFloat(p.borderLeftWidth);return v&&(g.left-=v,m.left-=v),[f.id,{element:f,globalBounds:g,localBounds:m}]})),h=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];for(const[f,g]of c){const m=u.get(f);if(m){const{element:p}=m,{style:v,parentElement:y}=p,S=parseInt(W.getStyleValue(p,"zIndex")),{globalBounds:D,localBounds:w,depth:E,parentElement:x}=g,M=x!==y;T.copyProperties(p.$initial={parentElement:y},v,h);let I;M?(m.bounds=m.globalBounds,I=D,e.appendChild(p)):(m.bounds=m.localBounds,I=w,x.appendChild(p));let P="hidden";o.has(p)&&(p.$scrollPlaceholder=W.createElement({parent:p,style:{height:p.scrollHeight}}),P="auto");const _={position:"absolute",top:`${I.top}px`,left:`${I.left}px`,width:`${I.width}px`,height:`${I.height}px`,minWidth:0,minHeight:0,margin:0,zIndex:E+(S||0),overflow:P};p.dataset.domTransition!=="preserve-padding"&&(_.padding=0),Object.assign(v,_),m.processed=!0}else{const{element:p,localBounds:v,depth:y,parentElement:S}=g;p.$initial={removed:!0},Object.assign(p.style,{position:"absolute",top:`${v.top}px`,left:`${v.left}px`,width:`${v.width}px`,height:`${v.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:y,overflow:"hidden"}),S.appendChild(p),u.set(f,{element:p,bounds:v,removed:!0,processed:!0}),d.push(p)}}for(const[,f]of u)if(!f.processed){const{element:g}=f,{style:m,parentElement:p}=g,v=f.bounds=f.localBounds;g.classList.add("b-dom-transition-adding"),T.copyProperties(g.$initial={parentElement:p},m,h),Object.assign(m,{position:"absolute",top:s.top?0:`${v.top}px`,left:s.left?0:`${v.left}px`,width:s.width?0:`${v.width}px`,height:s.height?0:`${v.height}px`,opacity:s.opacity?0:null,zIndex:p.$depth+1,overflow:"hidden"})}for(const f of o)f.scrollTop=f.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:f,bounds:g,removed:m}]of u)m?Object.assign(f.style,{top:a.top?0:`${g.top}px`,left:a.left?0:`${g.left}px`,width:a.width?0:`${g.width}px`,height:a.height?0:`${g.height}px`,opacity:a.opacity?0:f.$initial.opacity}):Object.assign(f.style,{top:`${g.top}px`,left:`${g.left}px`,width:`${g.width}px`,height:`${g.height}px`,opacity:f.$initial.opacity});await Wu.sleep(t),e.classList.remove("b-dom-transition");for(const f of d)f.$initial&&(f.$initial.removed?f.remove():(T.copyProperties(f.style,f.$initial,h),f.$scrollPlaceholder&&(f.$scrollPlaceholder.remove(),delete f.$scrollPlaceholder),f.classList.remove("b-dom-transition-adding"),f.$initial.parentElement.appendChild(f)));for(const f of o)f.scrollTop=f.$scrollTop,delete f.$scrollTop}static async loadScript(e){return new Promise((r,t)=>{const i=document.createElement("script");i.src=e,i.onload=r,i.onerror=t,document.head.appendChild(i)})}static isNamedColor(e){return e&&!/^(#|hsl|rgb|hwb)/.test(e)}static get NodeFilter(){return NodeFilter}static addChild(e,r,t){e.insertBefore(r,t)}},W=C,By,uR=()=>W.isTouchEvent=!1,Hy=()=>{W.isTouchEvent=!0,clearTimeout(By),By=setTimeout(uR,400)};if(rt.addEventListener("touchstart",Hy,!0),rt.addEventListener("touchend",Hy,!0),W.canonicalStyles=Ia,W.supportsTemplate="content"in rt.createElement("template"),W.elementPropKey=Z0,W.numberRe=Fy,!("children"in Node.prototype)){const e=r=>r.nodeType===r.ELEMENT_NODE;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const r=(this.document||this.ownerDocument).querySelectorAll(e);let t=r.length;for(;--t>=0&&r.item(t)!==this;);return t>-1}),Ul.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){let r=this;if(!rt.documentElement.contains(r))return null;do{if(r.matches(e))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===r.ELEMENT_NODE);return null}:Node.prototype.closest=function(e){var r;return(r=this.parentNode)==null?void 0:r.closest(e)},function(e){e.forEach(function(r){Object.prototype.hasOwnProperty.call(r,"remove")||Object.defineProperty(r,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),globalThis.addEventListener("resize",()=>Aa=null),C._$name="DomHelper";var hR=5,fR=e=>e.floating,gR={touchend:1,pointerup:1},Lr=new class extends F.mixin(Ae){suspendFocusEvents(){Gl=!0}resumeFocusEvents(){Gl=!1}setupFocusListenersOnce(r,t){r&&!Lr.observedElements.has(r)&&(Lr.setupFocusListeners(r,t),Lr.observedElements.add(r))}setupFocusListeners(r=document,t,i=!1){const n={element:r,touchstart(s){if(!nr&&s.changedTouches.length===1){if(nr=s.changedTouches[0],!Y.isAndroid){const a=({clientX:c,clientY:d,type:u})=>{(gR[u]||Math.max(Math.abs(c-nr.clientX),Math.abs(d-nr.clientY))>hR)&&(rh=null,o(),clearTimeout(l))},o=t.on({element:document,touchmove:a,touchend:a,pointermove:a,pointerup:a,capture:!0}),l=setTimeout(()=>{rh=nr.identifier,o(),s.target.dispatchEvent(new MouseEvent("contextmenu",t.copyEvent({},s)))},t.longPressTime)}}else nr=null},touchend:{handler:s=>{nr&&(s.changedTouches[0].identifier===rh?(s.stopImmediatePropagation(),s.preventDefault()):s.changedTouches.length===1&&s.changedTouches[0].identifier===nr.identifier&&Lr.trigger("globaltap",{event:s}),nr=null)},passive:!1},mousedown:{handler:s=>{Yl="mouse",nr||Lr.trigger("globaltap",{event:s}),Li=s;const a=s.ctrlKey||s.altKey||s.shiftKey||s.metaKey;!Ye&&a?Ye=new KeyboardEvent("keydown",{key:s.ctrlKey?"Control":s.shiftKey?"Shift":s.altKey?"Alt":"Meta",ctrlKey:s.ctrlKey,altKey:s.altKey,shiftKey:s.shiftKey,metaKey:s.metaKey}):Ye&&!a&&(Ye=null)},passive:!1},mouseup(){Li=null},pointerdown:{passive:!1,handler:s=>{_a=s}},pointerup:{passive:!1,handler:s=>{(_a==null?void 0:_a.pointerId)===s.pointerId&&(_a=null)}},keydown(s){Yl="key",Ye=s},keypress(){Yl="key"},keyup(){Ye=null},focusin(s){var a;const{Widget:o}=Lr;if(o.resetFloatRootScroll(),Gl)return;const l=s.relatedTarget?s.relatedTarget instanceof HTMLElement?s.relatedTarget:document.body:null,c=s.target||document.body,d=o.fromElement(l),u=o.fromElement(c),h=C.getCommonAncestor(d,u),f=!!(l&&c.compareDocumentPosition(l)&4),g=o.query(mR);let m=null;if(c&&c!==document.body?m=C.getActiveElement(c):m=C.getActiveElement(document),g&&!g._isRevertingFocus&&(!u||!g.owns(u)&&!(g.element.compareDocumentPosition(u.element)&4&&u.up(fR))))return g.focus();let p=nh("focusout",l,s.target,d,u,f);for(let y=d,S;y&&y!==h;y=S)if(S=y.owner,!y.isDestroying&&y.onFocusOut&&(y.onFocusOut(p),s.target&&m!==C.getActiveElement(s.target)))return;if(h&&s.target===h.element)!h.isDestroying&&C.getActiveElement(h)===c&&h.focusElement&&h.focusElement!==h.element&&(!h.element.contains(m)||h.focusDescendant)&&h.setTimeout(()=>{var y;return(y=h.focus)==null?void 0:y.call(h)},0);else{p=nh("focusin",c,l,d,u,f);for(let y=u;y&&y!==h;y=y.owner)y.isDestroying||(a=y.onFocusIn)==null||a.call(y,p)}const v=C.getCommonAncestor((l==null?void 0:l.nodeType)===Element.ELEMENT_NODE?l:null,c)||c.parentNode;v&&(p=nh("focusmove",c,l,d,u,f,{bubbles:!0}),v.dispatchEvent(p))},focusout(s){if(!Gl&&(!s.relatedTarget||!Lr.Widget.fromElement(s.relatedTarget))){const a=s.relatedTarget&&s.relatedTarget instanceof HTMLElement?s.relatedTarget:null;n.focusin({target:a,relatedTarget:s.target}),Ye=Li=null}},blur:{element:globalThis,handler(s){s.target===globalThis&&(Ye=null,Li=null)}},capture:!0,passive:!0};i&&(ih==null||ih()),ih=this.detachEvents=t.on(n)}get lastInteractionType(){return Yl}get shiftKeyDown(){return Ye==null?void 0:Ye.shiftKey}get ctrlKeyDown(){return(Ye==null?void 0:Ye.ctrlKey)||(Ye==null?void 0:Ye.metaKey)}get altKeyDown(){return Ye==null?void 0:Ye.altKey}isKeyDown(r){return r?(Ye==null?void 0:Ye.key)===r||Ye[(r==null?void 0:r.toLowerCase())+"Key"]===!0:!!Ye}isMouseDown(r=0){return(Li==null?void 0:Li.button)===r}get currentMouseDown(){return Li}get currentPointerDown(){return _a}get currentTouch(){return nr}get currentKeyDown(){return Ye}},mR=e=>e.isVisible&&e.isTopModal;Lr.observedElements=new Set;var nr,rh,Gl=!1,Yl,Ye,Li,_a,ih;function nh(e,r,t,i,n,s,a){const o=new CustomEvent(e,a);return Object.defineProperty(o,"_target",{get(){return r}}),Object.defineProperty(o,"relatedTarget",{get(){return t}}),o.fromWidget=i,o.toWidget=n,o.backwards=s,o}var he=Lr;function pR(e,r){const t=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),r);return t&&(t.get||t.set)?t:null}var X=class extends F.mixin(Ae,Ve){static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:r}=this;r.keyMap=r.mergeKeyMaps(r.keyMap,e,L.uncapitalize(this.constructor.$name))}static initPlugins(e,...r){const t=e.plugins||(e.plugins={});for(const i of r)t[i.$$name]=new i(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return(e=this.client)==null?void 0:e.getFocusRevertTarget()}construct(...e){const r=this;let[t,i]=e,n;e.length===1?T.isObject(t)&&(i=t,t=i.client):(i=T.assign({},i),delete i.client),r.client=t,super.construct(i),r.applyPluginConfig(t),n=r.clientListeners,n&&(n=T.assign({},n),n.thisObj=r,t.ion(n))}applyPluginConfig(e){const r=this,t=r.pluginConfig||r.constructor.pluginConfig;if(t){const{assign:i,chain:n,after:s,before:a,override:o}=t;i&&r.applyAssign(e,i),(n||s)&&r.applyChain(e,n||s),a&&r.applyChain(e,a,!1),o&&r.applyOverride(e,o)}}applyAssign(e,r){r.forEach(t=>this.assign(e,t))}applyChain(e,r,t=!0){if(Array.isArray(r))for(const i of r)this.chain(e,i,i,t);else for(const i in r)this.chain(e,i,r[i],t)}applyOverride(e,r){const t=this;t.overridden||(t.overridden={}),r.forEach(i=>{if(!t[i])throw new Error(`Trying to chain fn ${e.$$name}#${i}, but plugin fn ${t.$$name}#${i} does not exist`);typeof e[i]=="function"&&(t.overridden[i]=e[i].bind(e)),e[i]=t[i].bind(t)})}assign(e,r){const t=this,i=pR(t,r);i?Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:i.get&&i.get.bind(t),set:i.set&&i.set.bind(t)}):e[r]=t[r].bind(t)}chain(e,r,t,i=!0){let n=0;typeof r=="object"&&(r=r.fn),typeof t=="object"&&(n=t.prio||0,t=t.fn);const s=this,a=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=s[t]&&s[t].bind(s),l=s.functionChainRunner;if(!o)throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${s.$$name}#${t} does not exist`);if(!a[r]){let c=e[r];c&&(c=c.bind(e),c.$this=e,c.$prio=0),a[r]=c?[c]:[],e[r]=(...d)=>l(a[r],d)}o.$this=s,o.$prio=n,a[r][i?"push":"unshift"](o),a[r].$sorted=!1}functionChainRunner(e,r){let t,i,n;for(e.$sorted||(e.sort((s,a)=>a.$prio-s.$prio),e.$sorted=!0),i=0;i<e.length&&(t=e[i],!(!t.$this.isDestroyed&&(n=t(...r),n===!1)));i++);return n}doDisable(e){var r,t;const i=this,{constructor:n}=i,s="featureClass"in n?n.featureClass:`b-${n.$$name.toLowerCase()}`;s&&((t=(r=i.client)==null?void 0:r._element)==null||t.classList[e?"remove":"add"](s)),i.isConfiguring||(e?i.trigger("disable"):i.trigger("enable"))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}};R(X,"$name","InstancePlugin"),X._$name="InstancePlugin";var sh=e=>class extends(e||F){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(t){t&&(Array.isArray(t)||(t=[t]),X.initPlugins(this,...t)),this.initPlugins()}initPlugins(){}addPlugins(...t){X.initPlugins(this,...t)}hasPlugin(t){return this.getPlugin(t)!=null}getPlugin(t){var i;return typeof t=="function"&&(t=t.$$name),(i=this.plugins)==null?void 0:i[t]}get widgetClass(){}},{defineProperty:ah}=Reflect,ql;Y.isBrowserEnv?ql=globalThis.performance:ql={now(){return new Date().getTime()}};var me=null;if(re.isTestEnv){const e=globalThis.bryntum||(globalThis.bryntum={});me=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty(r=!1){return me.timeouts.size+me.animationFrames.size+me.idleCallbacks.size+(r?me.intervals.size:0)===0},getFiltered({ignoreTimeouts:r=[],maxDelay:t=5e3,includeIntervals:i=!1}){const n=[],s=["timeouts","animationFrames","idleCallbacks"];i&&s.push("intervals");for(const a of s){const o=me[a];for(const[,l]of o.entries())!r.includes(l.name)&&(!Number.isInteger(l.delay)||l.delay<t)&&n.push(l)}return n}}}var Fa=(e,r,t,i)=>{const n=typeof r=="string",s=(i==null?void 0:i.appendArgs)||[],a=()=>{t.timerId=null,t.lastCallTime=ql.now();const o=t.args;t.args=null,n?e[r](...o,...s):r.call(e,...o,...s),t.called=!0,++t.calls};return i&&(e=i.thisObj||e),t.lastCallTime=-9e9,t.calls=0,t.invoker=a,a.wrapFn=t,a},Kl=(e,r,t="clearTimeout")=>(r.cancel=()=>{r.isPending&&(e[t](r.timerId),r.args=r.timerId=null)},r.flush=()=>{r.isPending&&(e[t](r.timerId),r.timerId=null,r.invoker())},r.now=(...i)=>{r.cancel(),r.args=i,r.invoker()},r.resume=i=>{const n=r.suspended;r.suspended=i||n<1?0:n-1},r.suspend=()=>{++r.suspended},r.immediate=!1,r.suspended=0,r.timerId=null,ah(r,"isPending",{get(){return r.timerId!==null}}),r),ge=e=>class extends(e||F){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const t=this;super.doDestroy(),t.timeoutIds&&(t.timeoutIds.forEach((i,n)=>{typeof i=="function"&&i(),clearTimeout(n),me==null||me.timeouts.delete(n)}),t.timeoutIds=null),t.timeoutMap&&(t.timeoutMap.forEach((i,n)=>clearTimeout(n)),t.timeoutMap=null),t.intervalIds&&(t.intervalIds.forEach(i=>{clearInterval(i),me==null||me.intervals.delete(i)}),t.intervalIds=null),t.animationFrameIds&&(t.animationFrameIds.forEach(i=>{cancelAnimationFrame(i),me==null||me.animationFrames.delete(i)}),t.animationFrameIds=null),t.idleCallbackIds&&(t.idleCallbackIds.forEach(i=>{cancelIdleCallback(i),me==null||me.idleCallbacks.delete(i)}),t.idleCallbackIds=null)}hasTimeout(t){var i;return!!((i=this.timeoutMap)!=null&&i.has(t))}setTimeout({fn:t,delay:i,name:n,runOnDestroy:s,cancelOutstanding:a,args:o}){(arguments.length>1||typeof arguments[0]=="function")&&([t,i,n,s]=arguments),typeof t=="string"?n=t:n||(n=t.name||t),a&&this.clearTimeout(n);const l=this,c=l.timeoutIds||(l.timeoutIds=new Map),d=l.timeoutMap||(l.timeoutMap=new Map),u=setTimeout(()=>{typeof t=="string"&&(t=l[n]),c==null||c.delete(u),d==null||d.delete(n),me==null||me.timeouts.delete(u),t.apply(l,o)},i);return c.set(u,s?t:!0),me==null||me.timeouts.set(u,{fn:t,delay:i,name:n}),n&&d.set(n,u),u}clearTimeout(t){var i;let n=t;if(typeof n=="string")if(this.timeoutMap)n=this.timeoutMap.get(t),this.timeoutMap.delete(t);else return;clearTimeout(n),(i=this.timeoutIds)==null||i.delete(n),me==null||me.timeouts.delete(n)}clearInterval(t){var i;clearInterval(t),(i=this.intervalIds)==null||i.delete(t),me==null||me.intervals.delete(t)}setInterval(t,i,n){const s=setInterval(t,i);return(this.intervalIds||(this.intervalIds=new Set)).add(s),me==null||me.intervals.set(s,{fn:t,delay:i,name:n}),s}requestAnimationFrame(t,i=[],n=this){const s=this.animationFrameIds||(this.animationFrameIds=new Set),a=requestAnimationFrame(()=>{me==null||me.animationFrames.delete(a),s.delete(a)&&t.apply(n,i)});return s.add(a),me==null||me.animationFrames.set(a,{fn:t,extraArgs:i,thisObj:n}),a}requestIdleCallback(t,i=[],n=this){const s=this.idleCallbackIds||(this.idleCallbackIds=new Set),a=requestIdleCallback(()=>{me==null||me.idleCallbacks.delete(a),s.delete(a)&&t.apply(n,i)});return s.add(a),me==null||me.idleCallbacks.set(a,{fn:t,extraArgs:i,thisObj:n}),a}createOnFrame(t,i=[],n=this,s){let a;const o=(...l)=>{a!=null&&s&&(this.cancelAnimationFrame(a),a=null),a==null&&(a=this.requestAnimationFrame(()=>{typeof t=="string"&&(t=n[t]),a=null,l.push(...i),t.apply(n,l)}))};return o.cancel=()=>this.cancelAnimationFrame(a),o}cancelAnimationFrame(t){var i;cancelAnimationFrame(t),(i=this.animationFrameIds)==null||i.delete(t),me==null||me.animationFrames.delete(t)}cancelIdleCallback(t){var i;cancelIdleCallback(t),(i=this.idleCallbackIds)==null||i.delete(t),me==null||me.idleCallbacks.delete(t)}async nextAnimationFrame(){return new Promise(t=>this.requestAnimationFrame(t))}buffer(t,i){let n=i;i&&typeof i!="number"?n=i.delay:i=null;const s=(...o)=>{if(s.suspended)return;const{delay:l}=s;s.cancel(),s.called=!1,s.args=o,s.immediate||!l?a():s.timerId=this.setTimeout(a,l)},a=Fa(this,t,s,i);return s.delay=n,Kl(this,s)}raf(t,i){let n=i;i&&typeof i!="boolean"?n=i.cancelOutstanding:i=null;const s=(...o)=>{s.suspended||(s.cancelOutstanding&&s.cancel(),s.called=!1,s.args=o,s.immediate?a():s.isPending||(s.timerId=this.requestAnimationFrame(a)))},a=Fa(this,t,s,i);return s.cancelOutstanding=n,Kl(this,s,"cancelAnimationFrame")}idle(t,i){let n=i;i&&typeof i!="boolean"?n=i.cancelOutstanding:i=null;const s=(...o)=>{s.suspended||(s.cancelOutstanding&&s.cancel(),s.called=!1,s.args=o,s.immediate?a():s.isPending||(s.timerId=this.requestIdleCallback(a)))},a=Fa(this,t,s,i);return s.cancelOutstanding=n,this.setTimeout(()=>this.idleCallbackIds.delete(s.timerId)&&s.now(),100),Kl(this,s,"cancelIdleCallback")}throttle(t,i){let n=i,s;i&&typeof i!="number"?(n=i.delay,s=i.throttled):i=null;const a=this,o=(...c)=>{if(o.suspended)return;const{delay:d}=o,u=ql.now()-o.lastCallTime;o.args=c,o.immediate||u>=d?(a.clearTimeout(o.timerId),l()):(o.isPending||(o.timerId=a.setTimeout(l,d-u),o.called=!1),s&&(s.wrapFn.args=c,s()))},l=Fa(a,t,o,i);return o.delay=n,s&&(s=Fa(a,s,()=>{},i)),Kl(a,o)}static setupDelayable(t){t.setupDelayableMethods(t.delayable)}static setupDelayableMethods(t,i=null){const n=this,s=t.static,a=i||n.prototype;s&&delete t.static;for(const o in t){let l=t[o];const c=o+"Now",d=typeof l;a[c]||(a[c]=a[o]),d==="number"?l={type:"buffer",delay:l}:d==="string"&&(l={type:l}),ah(a,o,{get(){const u=this[l.type]((...h)=>{this[c](...h)},l);return ah(this,o,{value:u}),u}})}}get widgetClass(){}},Wn=class{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,r){}};Wn._$name="StateStorage";var vR=class extends Wn{constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=Vy(),r=this.keys;for(const t of r)e[t]=this.getItem(t);return e}get keys(){return Ny(this.prefix,this.prefix.length)}clear(){const e=Ny(this.prefix);for(const r of e)localStorage.removeItem(r)}getItem(e){const r=localStorage.getItem(this.prefix+e);return r===null?r:JSON.parse(r)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,r){return localStorage.setItem(this.prefix+e,JSON.stringify(r))}},yR=class extends Wn{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return T.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=Vy()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,r){this._data[e]=r}},Vy=()=>Object.create(null),Ny=(e,r=0)=>{const t=[],i=localStorage.length;for(let n,s=0;s<i;++s)n=localStorage.key(s),n.startsWith(e)&&t.push(n.slice(r));return t},zy=new Wn,oh={local:vR,memory:yR},Un=class extends F.mixin(ge,Ae){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){e==null?e=Wy:((typeof e=="string"||T.isClass(e)||e instanceof Wn)&&(e={storage:e}),T.isObject(e)&&(e=new Un(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(!e)this.clear();else for(const r in e)this.setValue(r,e[r])}clear(){return this.storage.clear(),this}changeStorage(e){if(e==null)e=zy;else{if(typeof e=="string"){if(!oh[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(oh).join('", "')}")`);e=oh[e]}T.isClass(e)&&(e=new e(this))}return e}saveStateful(e,r){(this.pendingSaves||(this.pendingSaves=[])).push([e,r]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:r}=e,t=r==null?void 0:r.length,i=[],n=[];if(e.pendingSaves=null,t){for(let s,a,o,l=0;l<t;++l)[a,s]=r[l],!a.isDestroying&&a.isSaveStatePending&&(o=a.saveState({...s,immediate:!0}),o&&(i.push(o),n.push(a)));i.length&&e.trigger("save",{stateIds:i,saved:n})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,r){const t=this,{storage:i}=t,n=t.getValue(e);return r!=null?(i.setItem(e,r),t.trigger("set",{key:e,value:r,was:n})):n!==null&&(i.removeItem(e),t.trigger("remove",{key:e,was:n})),t}},Wy=new Un({storage:zy});Un._instance=Wy,Un._$name="StateProvider";var bR=/boolean|number|string/,Xl=e=>{var r;return r=class extends(e||F){afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(t){this._state=t,t&&this.applyState(t)}updateStatefulEvents(t){var i;const n=this,s={name:"statefulEvents",thisObj:n};if(n.detachListeners(s.name),t&&(typeof t=="string"?t=L.split(t):Array.isArray(t)||(t=T.getTruthyKeys(t)),t.length)){for(const a of t)s[a]="onStatefulEvent";(i=n.ion)==null||i.call(n,s)}}get statefulId(){const t=this,{responsiveState:i}=t;let n=t.stateId;return n==null&&t.hasGeneratedId===!1&&t.stateful!==!1&&(n=t.id),n&&i&&(n=`${n}[${i}]`),n}get statefulness(){const{stateful:t}=this;return Array.isArray(t)?T.createTruthyKeys(t):t}get stateProvider(){return this._stateProvider||Un.instance}applyState(t){t=this.pruneState(t),t&&this.setConfig(t)}getState(){const t=this,{initialConfig:i,statefulness:n,isConstructing:s}=t,{configs:a}=t.$meta,o=s?Object.setPrototypeOf(i,t.$meta.config):t;let l=null,c,d;if(n){l={};for(c in n)if(n[c]){if(d=o[c],d!=null&&d.isStateful)d=d.state;else if(!s&&(T.isDate(d)&&(d=b.format(d,"YYYY-MM-DDTHH:mm:ssZ")),a[c].equal(d,i==null?void 0:i[c])||!bR.test(typeof d)))continue;l[c]=d}}return l}loadState(t,i){typeof t=="boolean"&&(i=t,t=null);const n=this,{statefulLoaded:s}=n;if(n.isStatefulActive&&(i||!s)){const a=n.loadStatefulData(t||(t=n.statefulId));!s&&t&&(n.defaultState=n.state,n.statefulLoaded=!0),a&&(n.state=a)}}loadStatefulData(t){var i;return t=this.isStatefulActive?t||this.statefulId:null,t&&((i=this.stateProvider)==null?void 0:i.getValue(t))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(t=!1){this.statefulSuspended=t?0:Math.max(this.statefulSuspended-1,0)}saveState(t){typeof t=="string"?t={id:t}:t=t||{};const i=this,{stateProvider:n}=i,s=t.id||i.isStatefulActive&&i.statefulId;if(s&&n)return t.immediate?(i.isSaveStatePending=!1,n.setValue(s,i.state)):i.isSaveStatePending||(i.isSaveStatePending=!0,n.saveStateful(i,t)),s}suspendStateful(){++this.statefulSuspended}onConfigChange({name:t,value:i,was:n,config:s}){if(super.onConfigChange({name:t,value:i,was:n,config:s}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:a}=this;(Array.isArray(a)?a.includes(t):a!=null&&a[t])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(t){const{statefulness:i}=this;if(i){const n={};for(const s in t)i[s]&&(n[s]=t[s]);t=n}return t}get widgetClass(){}},R(r,"$name","State"),R(r,"configurable",{stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),R(r,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),r},Uy=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),CR={string:1,number:1},Gn=e=>class extends(e||F){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(t,i){const{identifiable:n}=t;n.idMap=Object.create(null),Reflect.defineProperty(t,"identifiable",{get(){return n}})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(t){return(this.hasGeneratedId=!t)?this.generateAutoId():t}updateId(t,i){const n=this,s=n.constructor;i&&s.unregisterInstance(n,i),(!n.hasGeneratedId||s.identifiable.registerGeneratedId!==!1)&&s.registerInstance(n,t)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(t="generatedId"){return t+(Uy[t]=(Uy[t]||0)+1)}static registerInstance(t,i=t.id){const{idMap:n}=this.identifiable;if(i in n&&!this.disableThrow)throw new Error("Id "+i+" already in use");n[i]=t}static unregisterInstance(t,i=t.id){const{idMap:n}=this.identifiable;CR[typeof t]?delete n[t]:n[i]===t&&delete n[i]}static getById(t){const i=this.identifiable.idMap;if(i)return i[t]}static get registeredInstances(){const t=this.identifiable.idMap;return t?Object.values(t):[]}},Gy=Symbol("STM_PROP"),Yy={parentIndex:1},qy=e=>class extends(e||F){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(t){this.stm||(this.stm=t.stm)}unjoinStore(t){var i;this.stm===t.stm&&(this.stm=null),(i=super.unjoinStore)==null||i.call(this,t)}get stm(){return this[Gy]}set stm(t){this[Gy]=t}beforeChronoFieldSet(t,i){var n;const s=this;return!s.inSetting&&((n=s.stm)!=null&&n.enabled)&&!Yy[t]&&!s.constructor.nonPersistableFields[t]&&s.getFieldDefinition(t)?{[t]:{value:i,oldValue:s[t]}}:null}afterChronoFieldSet(t,i,n){n&&this.afterSet(t,i,!1,!1,n,!0)}shouldRecordFieldChange(t,i,n){const s=this.firstStore;return!(this.constructor.nonPersistableFields[t]||i==null&&n==null||i===n||i instanceof Date&&n instanceof Date&&i.getTime()===n.getTime()||t==="id"||t==="$PhantomId"||t==="parentId"&&s&&s.oldIdMap[i]===s.getById(n))}afterSet(t,i,n,s,a,o){const{stm:l}=this,c=this.constructor.nonPersistableFields;if(l!=null&&l.isBase&&l.enabled&&!Yy[t]&&!c[t]&&a){let d;const[u,h]=Object.keys(a).reduce((f,g)=>{const{value:m,oldValue:p}=a[g];return this.shouldRecordFieldChange(g,p,m)&&(d=!0,f[0][g]=m,f[1][g]=p),f},[{},{}]);d&&l.onModelUpdate(this,u,h,o)}}beforeInsertChild(t){var i;const n=((i=super.beforeInsertChild)==null?void 0:i.call(this,t))||[],{stm:s}=this;return s!=null&&s.enabled&&n.push(t.reduce((a,o)=>(o.root===this.root&&a.set(o,{parent:o.parent,index:o.parent?o.parentIndex:void 0}),a),new Map)),n}afterInsertChild(t,i,n,s){var a;const{stm:o}=this;if(o!=null&&o.enabled){const l=n.pop();s&&o.onModelInsertChild(this,t,s,l)}(a=super.afterInsertChild)==null||a.call(this,t,i,n,s)}beforeRemoveChild(t,i){const n=super.beforeRemoveChild?super.beforeRemoveChild(t,i):[],{stm:s}=this;return s!=null&&s.enabled&&!i&&n.push(t.reduce((a,o)=>(a.set(o,o.parentIndex),a),new Map)),n}afterRemoveChild(t,i,n){var s;const{stm:a}=this;if(a!=null&&a.enabled&&!n){const o=i.pop();t&&t.length&&a.onModelRemoveChild(this,t,o)}(s=super.afterRemoveChild)==null||s.call(this,t,i,n)}},SR={includeFilteredOutRecords:!1},lh=e=>(e=e||!1,typeof e=="boolean"&&(e={includeFilteredOutRecords:e}),e||SR),Ky=e=>class extends(e||F){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(t){t===!0?t={onLoad:!0,onRemove:!0}:t===!1&&(t={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=t}constructor(...t){super(...t),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(t,i=this.stores){const{inProcessChildren:n,constructor:s}=this,a=i[0];if(t===!0)return n?!0:[];if(t){t=H.asArray(t);const o=t.length,l=[];for(let c=0,d;c<o;c++)d=t[c],d=d.isModel?d:a?a.createRecord(d,!1,!0):new s(d,null,null,!0),d=a?a.processRecord(d):d,l.push(d);if(this.children===!0&&a){const c=a.createSorterFn(a.sorters);l.sort(c)}return l}}processChildren(t=this.stores){const i=this,{meta:n}=i;i.inProcessChildren=!0;const s=i.ingestChildren(i.data[i.constructor.childrenField],t);if(s){const{convertEmptyParentToLeaf:a}=i.constructor;if(a===!0||a.onLoad?s.length:Array.isArray(s)){if(n.isLeaf=!1,i.children===!0)i.children=[];else if(s.length===0){i.children=s;return}i.insertChild(s)}else s===!0?(n.isLeaf=!1,i.children=!0):i.isRoot||(n.isLeaf=i.constructor.convertEmptyParentToLeaf.onLoad)}i.inProcessChildren=!1}ancestorsExpanded(t=this.firstStore){const{parent:i}=this;return!i||i.isExpanded(t)&&i.ancestorsExpanded(t)}isExpanded(t=this.firstStore){const i=this.instanceMeta(t.id);return Object.prototype.hasOwnProperty.call(i,"collapsed")||(i.collapsed=!this.expanded),!i.collapsed}get expanded(){return this.data.expanded}get childLevel(){let t=this,i=-1;for(;t&&!t.isRoot;)++i,t=t.parent;return i}get isLeaf(){return this.meta.isLeaf!==!1&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(t=!1,i=this.firstStore){const{children:n}=this;return!n||!Array.isArray(n)||t&&!this.isExpanded(i)?0:n.reduce((s,a)=>s+a.getDescendantCount(t),n.length)}get allChildren(){const{children:t}=this;return!t||t===!0?[]:t.reduce((i,n)=>(i.push(n),i.push.apply(i,n.allChildren),i),[])}get firstChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[0]||null}get lastChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[t.length-1]||null}get previousSiblingsTotalCount(){let t=this.previousSibling,i=this.parentIndex;for(;t;)i+=t.descendantCount,t=t.previousSibling;return i}get previousOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex-1]}get nextOrderedSibling(){var t;return(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex+1]}get root(){var t;return((t=this.parent)==null?void 0:t.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(t){const i=this,{parent:n}=i,s=t===null?i.firstStore.rootNode:i.firstStore.getById(t);s===n||!n&&!s||(i.isBatchUpdating?i.meta.batchChanges.parentId=t:s?s.appendChild(i):i.parent.removeChild(i))}static set parentIdField(t){this._parentIdField=t,Object.defineProperty(this.prototype,t,{set:function(i){this.parentId=i},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(t){let i;return t.includeFilteredOutRecords?i=this.unfilteredChildren||this.children:t.useOrderedTree?i=this.orderedChildren:i=this.children,i}traverse(t,i,n){n=lh(n);const s=this,a=s.getChildren(n);i||t.call(s,s);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,n)}traverseBefore(t,i,n){n=lh(n);const s=this,a=s.getChildren(n);for(let o=0,l=a==null?void 0:a.length;o<l;o++)a[o].traverse(t,!1,n);i||t.call(s,s)}traverseWhile(t,i,n){n=lh(n);const s=this;let a=i||t.call(s,s)!==!1;if(a){const o=s.getChildren(n);o!=null&&o.length&&(a=o.every(l=>l.traverseWhile(t,!1,n)))}return a}bubble(t,i=!1){let n=this;for(i||t.call(n,n);n.parent;)n=n.parent,t.call(n,n)}bubbleWhile(t,i=!1){let n=this,s=!0;for(i||(s=t.call(n,n));s&&n.parent;)n=n.parent,s=t.call(n,n);return s}contains(t,i=!1){return t&&typeof t=="object"&&(t=t.id),!this.traverseWhile(n=>n.id!=t,i)}getTopParent(t){let i;return t?(i=[],this.bubbleWhile(n=>(i.push(n),n.parent&&!n.parent.isRoot))):(i=null,this.bubbleWhile(n=>(n.parent||(i=n),n.parent&&!n.parent.isRoot))),i}appendChild(t,i=!1){return this.insertChild(t,null,i)}insertChild(t,i=null,n=!1,s={}){var a,o,l,c,d,u,h;const f=this,g=Array.isArray(t);if(t=H.asArray(t),typeof i=="number"&&(i=(o=(a=f.children)==null?void 0:a[i])!=null?o:null),!n&&!f.stores.every(y=>y.trigger("beforeAdd",{records:t,parent:f})!==!1))return null;t=f.ingestChildren(t);const m=(d=(c=i==null?void 0:i.parentIndex)!=null?c:(l=f.children)==null?void 0:l.length)!=null?d:0,p=(u=f.beforeInsertChild)==null?void 0:u.call(f,t),v=f.internalAppendInsert(t,i,n,s);return v.length&&f.convertToParent(n),(h=f.afterInsertChild)==null||h.call(f,m,t,p,v),g||!v?v:v[0]}convertToParent(t=!1){const i=this,n=i.isLeaf;i.meta.isLeaf=!1,i.children||(i.children=[]),n&&!i.root.isLoading&&!t&&i.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(t,i=this.stores){i.forEach(n=>{n.trigger("update",{record:this,records:[this],changes:t}),n.trigger("change",{action:"update",record:this,records:[this],changes:t})})}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(t,i,n,s){const a=this,{stores:o,root:l,children:c}=a,{firstStore:d}=l,{parentIdField:u}=a.constructor,h=a.isAutoRoot?null:a.id;let f,g,m,p,v,y;if(!l.isLoading&&d)for(y={},v=[],m=0;m<t.length;m++){const S=t[m];y[S.id]=S.root===l,v[m]=S.parentIndex}if(i&&i.parent!==a&&(i=null),c){const S=i?i.parentIndex:c.length;if(c[g=S]===t[0]||c[g=S-1]===t[0])for(f=!0,m=0;f&&m<t.length;m++)t[m]!==c[g+m]&&(f=!1)}if(f)return t;for(m=0;m<t.length;m++){const S=t[m],D=S.parent;d&&!l.isLoading&&S.traverse(w=>{w.root===l&&(y[w.id]=!0)}),(D==null?void 0:D.removeChild(S,y==null?void 0:y[S.id],n,{isInserting:!0,...s}))===!1?(p||(t=t.slice(),p=!0),t.splice(m--,1)):(S.parent=a,S.data[u]=h,D&&(S.meta.oldParentId=D.id))}if(t.length){Array.isArray(c)||(a.children=[]),Array.isArray(a.orderedChildren)||(a.orderedChildren=[]);const S=a.addToChildren(i,t,s);o.forEach(D=>{D.isChained||(t.forEach(w=>{w.joinStore(D)}),D.onNodeAddChild(a,t,S,y,n),t.forEach((w,E)=>{if(w.meta.oldParentId!=null&&!(a.inProcessChildren||a.isLoading)){const x={[u]:h,[a.getDataSource("parentIndex")]:w.parentIndex},M={},{modified:I,oldParentId:P}=w.meta,_=v[E];if(delete w.meta.oldParentId,a.id!==P&&(M[u]={value:h,oldValue:P}),w.parentIndex!==_&&(M.parentIndex={value:w.parentIndex,oldValue:_}),I[u]===a.id?Reflect.deleteProperty(I,u):u in I||(I[u]=P),y[w.id]){const A=D.getById(P);A.isLeaf&&!n&&A.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[D])}w.afterChange(x,M)}}))})}return t}removeChild(t,i=!1,n=!1,s={}){var a,o;const l=this,c=[],d=l.isLeaf,{children:u,stores:h}=l;if(t=H.asArray(t),t=t.filter(g=>g.parent===l),!n){for(const g of h)if(!g.isChained&&g.trigger("beforeRemove",{parent:l,records:t,isMove:i})===!1)return!1}const f=(a=l.beforeRemoveChild)==null?void 0:a.call(l,t,i);for(const g of t){const{parentIdField:m}=g.constructor,{modified:p}=g.meta,v=g.parent?g.parent.id:null;!(m in p)&&!g.isLinked&&(p[m]=v);const y=l.removeFromChildren(g,s);h.forEach(S=>{if(!S.isChained){const{isRemoving:D}=S;S.isRemoving=!0,c.push(...S.onNodeRemoveChild(l,[g],y,{isMove:i,silent:n})),S.isRemoving=D}}),i||(g.parent=g.parentIndex=g.unfilteredIndex=g.nextSibling=g.previousSibling=null,g.data[m]=null)}return(l.unfilteredChildren||u).length===0&&l.constructor.convertEmptyParentToLeaf.onRemove&&!l.isRoot&&(l.meta.isLeaf=!0),l.isLeaf!==d&&!n&&!i&&l.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),(o=l.afterRemoveChild)==null||o.call(l,t,f,i),c}clearParentId(){const t=this;Reflect.deleteProperty(t.data,t.parentIdField),Reflect.deleteProperty(t.originalData,t.parentIdField),t.meta.modified&&Reflect.deleteProperty(t.meta.modified,t.parentIdField)}replaceChildren(t){return this.clearChildren(),this.data[this.constructor.childrenField]=t,this.processChildren(),this.children}clearChildren(t=!1){const i=this,{stores:n}=i,s=i.unfilteredChildren||i.children;i.children=[],i.orderedChildren=[],s&&s!==!0&&(n.forEach(a=>{a.isChained||a.onNodeRemoveChild(i,s,0,{unfiltered:!0,silent:t})}),i.unfilteredChildren&&(i.unfilteredChildren=[]))}clear(){var t;const i=this,{stores:n}=i,s=(t=i.children)==null?void 0:t.slice();if(!(!i.isRoot||!s)){for(const a of n)if(!a.isChained&&a.trigger("beforeRemove",{parent:i,records:s,isMove:!1,removingAll:!0})===!1)return!1;i.children.length=0,i.unfilteredChildren&&(i.unfilteredChildren.length=0),n.forEach(a=>{s.forEach(o=>{o.stores.includes(a)&&o.unjoinStore(a),o.parent=o.parentIndex=o.nextSibling=o.previousSibling=null}),a.storage.suspendEvents(),a.storage.clear(),a.storage.resumeEvents(),a.added.clear(),a.modified.clear(),a.trigger("removeAll"),a.trigger("change",{action:"removeall"})})}}updateChildrenIndices(t,i,n=!1){let s=null;for(let a=0;a<t.length;a++){const o=t[a],l=o[i];i==="parentIndex"||i==="orderedParentIndex"?l===void 0||n?o.setData(i,a):l!==a&&o.set(i,a,!0):o[i]=a,i==="parentIndex"&&(o.previousSibling=s,s&&(s.nextSibling=o),a===t.length-1&&(o.nextSibling=null),s=o)}}addToChildren(t,i,n={}){var s,a;const o=this,l=[[o.children,"parentIndex",t],[o.unfilteredChildren,"unfilteredIndex",t],[o.orderedChildren,"orderedParentIndex",(s=n==null?void 0:n.orderedBeforeNode)!=null?s:t]];for(const c of l){const[d,u,h]=c;if(d){const f=h?h[u]:d.length;c.push(f),d.splice(f,0,...i),(a=n==null?void 0:n[u])!=null&&a.skip||o.updateChildrenIndices(d,u)}}return l[0][3]}removeFromChildren(t,i){var n;const s=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const a of s){const[o,l]=a;if(o){const c=o.indexOf(t);a.push(c),c>-1&&(o.splice(c,1),(n=i==null?void 0:i[l])!=null&&n.skip||this.updateChildrenIndices(o,l))}}return s[0][2]}sortOrderedChildren(t=!0,i=!1){const n=[];return this.isLeaf||(this.orderedChildren.sort((s,a)=>{var o,l;if(i){const c=(o=s.meta.modified.orderedParentIndex)!=null?o:s.orderedParentIndex,d=(l=a.meta.modified.orderedParentIndex)!=null?l:a.orderedParentIndex,u=c-d;return u!==0&&(n.push(s),n.push(a)),u}else return s.orderedParentIndex-a.orderedParentIndex}),t&&this.orderedChildren.forEach(s=>{n.push(...s.sortOrderedChildren(t,i))}),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(n)}},Xy={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},wR={get(e,r){return r==="proxyMeta"?this.proxyMeta:r==="constructor"?e.constructor:r==="setData"?this.setDataOverride:r==="set"?this.setOverride:Xy[r]?this.proxyMeta.data[r]:Reflect.get(e,r,this.proxyRecord)},set(e,r,t){return Xy[r]?this.proxyMeta.data[r]=t:e[r]=t,!0},setDataOverride(e,r){e==="parentIndex"?this.proxyMeta.data.parentIndex=r:this.proxyMeta.originalRecord.setData(e,r)},setOverride(e,r,...t){e==="parentIndex"?this.proxyMeta.data.parentIndex=r:this.proxyMeta.originalRecord.set(e,r,...t)}},Zy=e=>{var r;return r=class extends(e||F){link(){if(this.isLinked)return this.$original.link();const t=this,i={...wR,proxyMeta:{originalRecord:t,data:{id:`${t.id}_link_${L.generateUUID()}`,stores:[]}}},n=new Proxy(t,i);return i.proxyRecord=n,(t.meta.linkedRecords||(t.meta.linkedRecords=[])).push(n),n}get isLinked(){var t;return!!((t=this.proxyMeta)!=null&&t.originalRecord)}get hasLinks(){return!!(!this.proxyMeta&&this.$links.length)}removeLink(t,i=null,n=!1){if(t.hasLinks)for(const s of t.$links.slice())i?H.include(i,s):s.remove(n);else t.isLinked&&H.remove(t.$original.$links,t)}beforeRemove(t){this.removeLink(this,t)}removeChild(t,i,n,s){if(!(s!=null&&s.isInserting)){t=H.asArray(t);for(const a of t)this.removeLink(a,null,n)}return super.removeChild(t,i,n,s)}get $originalId(){return this.$original.id}get $links(){var t;return(t=this.meta.linkedRecords)!=null?t:[]}},R(r,"$name","ModelLink"),r},{defineProperty:Jy}=Reflect,ch=Symbol("owner"),DR=/[\s,]+/,$i=e=>class extends(e||F){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(t,i,n=globalThis.__BRYNTUM_EXAMPLE){const{factoryable:s}=this.initClass(),{caseless:a,registry:o}=s,l=L.split(t,DR);for(let c,d,u=0;u<l.length;++u){if(d=l[u],c=a?d.toLowerCase():d,!n&&c in o)throw new Error(`Type "${d}" already registered with ${s.class.name} factory`);o[d]=o[c]=i.initClass()}}static isA(t,i){return this.isType(t,i,!0)}static isType(t,i,n){const{factoryable:s}=this,{caseless:a,registry:o}=s,l=o[a?i.toLowerCase():i];return l?n?t instanceof l:t.constructor===l:!1}static setupAlias(t){t.register(t.alias,t)}static setupFactoryable(t,i){const n=i.super.class;let{factoryable:s}=t;s={caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type",...s},s.class=t,s.registry=Object.create(null),s.extends&&!Array.isArray(s.extends)&&(s.extends=[s.extends]),Jy(t,"factoryable",{get(){return s}})}static setupType(t,i){const{type:n}=t;t.register(n,t,i.replaceType),Jy(t.prototype,"type",{value:n})}static create(t,i){return this.reconfigure(null,t,i)}static reconfigure(t,i,n){const s=this,{factoryable:a}=s,{typeKey:o}=a;let l=n,c,d,u,h,f,g,m,p,v;if(n&&!T.isClass(n)&&(l=null,m=typeof n,m==="function"?g=n:m==="string"?l=n:T.isObject(n)?(c=n.cleanup,d=n.defaults,h=n.owner,g=n.setup,l=n.type,p=n.transform):h=n),p&&(i=typeof p=="string"?h[p](i):p(i)),v=i,typeof v=="string")i={};else if(i){if(i===!0&&(i={}),!T.isObject(i))return h&&i!==t&&(t==null?void 0:t[ch])===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy()),i;v=i[o]}if(v=v&&s.resolveType(v),t){if(i&&(!v||t.constructor===v))return o in i&&(i=T.assign({},i),delete i[o]),t.setConfig(i),t;h&&t[ch]===h&&(typeof c=="string"?h[c](t):c==null||c(t),t.destroy())}if(i){if(d){if(!(u=v)){if(!(u=d[o]||l||a.defaultType))throw new Error(`No default mergeType defined for ${a.class.name} factory`);u=s.resolveType(u)}u&&(i=u.mergeConfigs(d,i))}if(g){if(f=typeof g=="string"?h[g](i,v,d):g(i,v,d),f===null)return f;i=f||i}if(!v){if(!(v=i[o]||l||a.defaultType))throw new Error(`No default type defined for ${a.class.name} factory`);v=s.resolveType(v)}d&&!u&&(i=v.mergeConfigs(d,i)),o in i&&(i=T.assign({},i),delete i[o]),i=new v(i),h&&(i[ch]=h)}return i||null}static resolveType(t,i){if(typeof t!="string")return t;const{factoryable:n}=this,s=n.extends;let a=n.registry[n.caseless?t.toLowerCase():t],o;for(o=0;!a&&s&&o<s.length;++o)a=s[o].resolveType(t,!0);if(!a&&!i)throw new Error(`Invalid type name "${t}" passed to ${n.class.name} factory`);return a}},{getOwnPropertyDescriptor:ER}=Reflect,Xt=class extends F.mixin($i){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1}}construct(e){const r=this;e&&(r.name=e.name,Object.assign(r,e)),r.compare&&(r.compareItems=(t,i)=>r.compare(t==null?void 0:t[r.name],i==null?void 0:i[r.name]))}defineAccessor(e,r){const{name:t,dataSource:i}=this;!r&&t in e&&e.$meta.hierarchy.some(n=>{var s;return((s=ER(n.prototype,t))==null?void 0:s.enumerable)===!1})||Reflect.defineProperty(e,t,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(t,i)}:function(){return this.batching&&t in this.meta.batchChanges?this.meta.batchChanges[t]:i in this.data?this.data[i]:this.data[t]},set(n){const s=this.$meta.fields.map[t];s&&s.readOnly||this.set(t,n)}})}isEqual(e,r){return T.isEqual(e,r)}print(e){return e==null?this.nullText:this.printValue(e)}printValue(e){return String(e)}};Xt._$name="DataField";var dh=class extends Xt{static get $name(){return"ArrayDataField"}static get type(){return"array"}isEqual(e,r){return e===r}};dh.initClass(),dh._$name="ArrayDataField";var uh=class extends Xt{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}isEqual(e,r){return e==null&&r==null?!0:super.isEqual(e,r)}convert(e){var r;return e==null?this.nullable?e:this.nullValue:((r=e.toLowerCase)==null?void 0:r.call(e))==="false"?!1:!!e}};uh.initClass(),uh._$name="BooleanDataField";var hh=class extends Xt{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return e==null?this.nullable||(e=this.nullValue):e==="now"?e=new Date:e instanceof Date||(e=b.parse(e,this.format||b.defaultParseFormat),(!e||isNaN(e))&&(e=void 0)),e}serialize(e){return e instanceof Date&&(e=b.format(e,this.format||b.defaultFormat)),e}printValue(e){return b.format(e,this.format||b.defaultFormat)}};hh.initClass(),hh._$name="DateDataField";var Zl=class extends Xt{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return e==null?this.nullable?e:this.nullValue:String(e)}};Zl.initClass(),Zl._$name="StringDataField";var Qy=class extends Zl{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,r){return b.compareUnits(e,r)===0}};Qy.initClass(),Qy._$name="DurationUnitDataField";var fh=class extends Xt{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return e==null?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}};fh.initClass(),fh._$name="IntegerDataField";var gh=class extends Xt{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,r){return e&&r&&r instanceof e.constructor&&r.id==e.id}};gh.initClass(),gh._$name="ModelDataField";var mh=class extends Xt{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,r){return isNaN(Number(e))&&isNaN(Number(r))||super.isEqual(e,r)}convert(e){if(e==null)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let r=this.precision;return r?(r=10**r,e=Math.round(e*r)/r):r===0&&(e=Math.round(e)),e}};mh.initClass(),mh._$name="NumberDataField";var ph=class extends Xt{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}};ph.initClass(),ph._$name="ObjectDataField";var ka=class extends Xt{init(e,r){var t;const i=this,n=`${i.name}Store`,s={skipStack:!0};if(i.modelClass&&(s.modelClass=i.modelClass),(t=r[`init${L.capitalize(n)}`])==null||t.call(r,s),!s.storeClass&&!i.storeClass)throw new Error(`Field '${i.name}' with type 'store' must have a storeClass configured`);const a=r.meta[n]=new(s.storeClass||i.storeClass)(s);i.complexMapping?T.setPath(e,i.dataSource,a):e[i.dataSource]=a,a.verifyNoGeneratedIds=!1,a.usesId=!a.count||!a.every(o=>o.hasGeneratedId),a.$currentValue=i.getValue(a),a.ion({change:({action:o})=>{const l=i.getValue(a);if(!a.$isSettingStoreFieldData){const c=a.$preserveCurrentDataset;a.$preserveCurrentDataset=i.subStore&&(o==="update"||o==="remove"||o==="add"),r.set(i.name,l),a.$preserveCurrentDataset=c}a.$currentValue=l}})}set(e,r,t){var i,n;const s=this,a=`${s.name}Store`,{[a]:o}=t.meta;if(!o)return t.meta.initableValues.set(s,e),!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=(n=(i=t[`process${L.capitalize(a)}Data`])==null?void 0:i.call(t,e,t))!=null?n:e,o.$preserveCurrentDataset||(o.data=e),o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every(l=>l.hasGeneratedId))}serialize(e,r){return r.meta[`${this.name}Store`].$currentValue}getValue(e){return e.allRecords.map(r=>{const t=r.persistableData;return e.usesId||delete t.id,t})}isEqual(e,r){return e!=null&&e.isStore&&(e=e.$currentValue),r!=null&&r.isStore&&(r=r.$currentValue),T.isDeeplyEqual(e,r)}getOldValue(e){const r=e.meta[`${this.name}Store`];return r?T.clone(r.$currentValue):null}};R(ka,"$name","StoreDataField"),R(ka,"type","store"),ka.initClass(),ka._$name="StoreDataField";var{defineProperty:xR}=Reflect,{hasOwn:Oa}=T,$r=void 0,RR={children:1,data:1,meta:1},TR=["name","title","text","label","description"],MR={boolean:1,number:1,date:1,object:1},eb={parentId:1,$PhantomId:2,id:3},vh=class extends F.mixin(qy,Ky,Zy){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(e==null?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let r=this,t=r.childLevel;for(r=this;r&&!r.isRoot;r=r.parent)e[t--]=r.parentIndex+1;return e}construct(e={},r=null,t=null,i=!1,n=!1,s=!1){var a,o;const l=this,c=(a=H.asArray(r))!=null?a:[],{constructor:d,fieldMap:u}=l;let h=null;if(r=c[0],l.meta={modified:{},...d.metaConfig,...t},d.applyConfigs)for(const f in l.getDefaultConfiguration())h||(h={},(!l.useRawData||!l.useRawData.enabled)&&(e={...e})),f in e&&(e[f]!==void 0&&(h[f]=e[f]),delete e[f]);if(super.construct(h),i||d.exposeProperties(e,s),!Oa(d,"idFieldProcessed")){let f=l.meta.idField;f||(d._assignedIdField?f=d.idField:r&&(f=r.idField)),f&&f!==u.id.dataSource&&d.addField({name:"id",dataSource:f,internal:!0}),d._idField=u.id.dataSource,d.idFieldProcessed=!0}l._internalId=vh._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=d.processData(e,!1,r,l,n),(o=l.meta.initableValues)!=null&&o.size&&l.assignInitables(),l.id==null&&l.setData("id",l.generateId(r)),l.data[d.childrenField]&&l.processChildren(c),l.generation=0}set isCreating(e){const r=this;!!r.meta.isCreating!==e&&(r.meta.isCreating=e,r.stores.forEach(t=>{t.onIsCreatingToggle(r,e)}))}get isCreating(){return!!this.meta.isCreating}equals(e){if(e instanceof this.constructor){for(let r=this.$meta.fields.defs,t=0,{length:i}=r;t<i;t++){const n=r[t],{name:s}=n;if(s!=="id"&&!n.isEqual(this[s],e[s]))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:$r},this.data),this.stores[0],null,!0)}static processData(e,r=!1,t,i,n){const{fieldMap:s,defaultValues:a}=this,{useRawData:o={enabled:!1}}=t||{},l=n||o.enabled?e:T.clone(e);let c;if(r=r||o.disableDefaultValue||n,!r){for(c in a)if(l[c]===$r){let d=a[c];Array.isArray(d)&&(d=d.slice()),l[c]=d}}if(!o.disableTypeConversion&&!n)for(c in s){const d=s[c],{name:u,dataSource:h}=d,f=h!==u,g=d.complexMapping,m=f&&(g?T.pathExists(e,h):h in e),p=u in e&&(!f||!m),v=!o.disableTypeConversion&&d.convert;if((p||v)&&(!r||p||m)){const y=p?l[u]:g?T.getPath(l,h):l[h],S=v?d.convert(y,e,i):y;g?T.setPath(l,h,S):l[h]=S,f&&delete l[u]}}return this.$meta.fields.initable.length&&this.initInitables(i,l),l}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,r){var t,i,n,s,a;const o=Oa(e,"fields")&&e.fields,l=r.super.fields,c=r.fields={defs:(t=l==null?void 0:l.defs.slice())!=null?t:[],exposedData:!1,defaults:l?{...l.defaults}:{},exposed:Object.create((i=l==null?void 0:l.exposed)!=null?i:null),ordinals:Object.create((n=l==null?void 0:l.ordinals)!=null?n:null),map:Object.create((s=l==null?void 0:l.map)!=null?s:null),sources:Object.create((a=l==null?void 0:l.sources)!=null?a:null)};Oa(e,"defaults")&&Object.assign(c.defaults,e.defaults),Oa(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),o!=null&&o.length&&o.map(e.addField,e),c.initable=c.defs.filter(d=>d.init),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,r=!0){const t=this,i=t.$meta.fields,n=r?"exposed":"map";if(e&&t.autoExposeFields&&!i.exposedData){let s,a,o;for(s in e)!i[n][s]&&s!==t.childrenField&&(o=T.typeOf(e[s]),a={name:s,dataSource:s,fromData:!0},MR[o]&&(a.type=o),t.addField(a));i.exposedData=!0}t.exposeRelations()}static addField(e){if(e==null)return;typeof e=="string"&&(e={name:e});const r=this.initClass(),t=r.$meta.fields,{ordinals:i}=t,n=t.exposed,{name:s}=e,a=t.map[s],o=e.dataSource||(e.dataSource=s);let l,c;if(!a||e.type&&e.type!==a.type)l=Xt.create(e),l.definedBy=a?a.definedBy:r,l.ordinal=a?a.ordinal:i[s]=t.defs.length;else{l=Object.create(a);for(c in e)c!=="type"&&(l[c]=e[c])}return l.owner=r,t.defs[l.ordinal]=l,t.map[s]=l,t.sources[o]||(t.sources[o]=l),o.includes(".")&&(l.complexMapping=!0),l.complexMapping?n[o.split(".")[0]]=!0:n[o]=!0,"defaultValue"in l&&(t.defaults[o]=l.defaultValue),RR[s]||l.defineAccessor(r.prototype),r._nonPersistableFields=null,r._alwaysWriteFields=null,l}static removeField(e){const r=this.initClass(),t=r.$meta.fields,i=t.map[e],{ordinals:n}=t,s=n[e];if(i){t.defs.splice(s,1),delete n[e],delete t.defaults[e],delete t.exposed[e],delete t.map[e],delete t.sources[i.dataSource];for(const a in n)n[a]>s&&--n[a];delete r.prototype[e]}}static exposeRelations(){const e=this;if(!Oa(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const r in e.relations){const t=e.relations[r];t.relationName=r,e.exposedRelations.push(t),Reflect.ownKeys(e.prototype).includes(r)||xR(e.prototype,r,{enumerable:!0,get:function(){return this.getForeign(r)},set:function(i){this.setForeign(r,i,t)}})}}}static initInitables(e,r){const t=e.meta.initableValues=new Map;for(const i of this.$meta.fields.initable){const n=T.getPath(r,i.dataSource);n!==void 0&&t.set(i,n),!i.lazy&&i.init(r,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[r,t]of e)r.set(t,this.data,this)!==!1&&e.delete(r)}static get autoExposeFields(){return!0}static fieldSorter(e,r){return(eb[e]||100)-(eb[r]||100)}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){return this.getFieldDefinition(e).dataSource}getDataSource(e){const r=this.constructor.getFieldDefinition(e);return(r==null?void 0:r.dataSource)||(r==null?void 0:r.name)}static processField(e,r,t){const i=this.fieldMap[e];return i!=null&&i.convert?i.convert(r,this.data,t):r}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach(t=>{var i;t.modelRelations||t.initRelations();const n=[];(i=t.modelRelations)==null||i.forEach(s=>{n.push({related:e.initRelation(s),config:s})}),t.updateRecordRelationCache(e,n)})}initRelation(e){const r=this,t=r.get(e.foreignKey),i=t!==$r&&typeof e.foreignStore!="string"&&e.foreignStore.getById(t),n=r.meta.relationCache||(r.meta.relationCache={});return n[e.relationName]=i||(t!=null?{id:t,placeHolder:!0}:null),i}removeRelation(e){const{relationName:r,foreignKey:t,nullFieldOnRemove:i}=e;this.meta.relationCache[r]&&(delete this.meta.relationCache[r],i&&this.setData(t,null))}getForeign(e){var r;return(r=this.meta.relationCache)==null?void 0:r[e]}setForeign(e,r,t){const i=vh.asId(r);return this.set(t.foreignKey,i)}getRelationConfig(e){var r,t;return(t=(r=this.firstStore)==null?void 0:r.modelRelations)==null?void 0:t.find(i=>i.foreignKey===e)}flatGet(e,r){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:r in this.data?this.data[r]:this.data[e]}complexGet(e,r){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:T.getPath(this.data,r)}get(e){if(!e)return;const r=this.fieldMap[e];return!r&&e.includes(".")?this.complexGet(e,e):r!=null&&r.complexMapping?this.complexGet(e,r.dataSource):this.flatGet(e,(r==null?void 0:r.dataSource)||e)}setData(e,r){var t,i;const{data:n,fieldMap:s}=this;if(typeof e=="string"){const a=s[e],o=(t=a==null?void 0:a.dataSource)!=null?t:e;a!=null&&a.set?a.set(r,this.data,this):a!=null&&a.complexMapping?T.setPath(n,o,r):n[o]=r}else{const a=Object.keys(e);for(let o=0;o<a.length;o++){const l=a[o],c=s[l],d=(i=c==null?void 0:c.dataSource)!=null?i:l;c!=null&&c.set?c.set(r,this.data,this):d&&(c!=null&&c.complexMapping?T.setPath(n,d,e[l]):n[d]=e[l])}}}getData(e){var r;const t=this.fieldMap[e],i=(r=t==null?void 0:t.dataSource)!=null?r:e;if(i)return t!=null&&t.complexMapping?T.getPath(this.data,i):this.data[i]}syncId(e){const r=this.id;if(r!==e){this.setData("id",e);const t={id:{value:e,oldValue:r}};this.afterChange(t,t)}}set(e,r,t=!1,i=!1,n=!1,s=!1,a=!0){var o;const l=this;if(l.isBatchUpdating)return l.inBatchSet(e,r,t||l.$silenceBatch),null;{const c=l.inSet(e,r,t,i,n,s,a);return(o=l.afterSet)==null||o.call(l,e,r,t,i,c),c}}fieldToKeys(e,r){return typeof e!="string"?T.assign({},e):{[e]:r}}inBatchSet(e,r,t){const i=this,{meta:n,constructor:s,fieldMap:a}=i,o={};let l,c=!1;if(typeof e!="string"?Object.keys(i.fieldToKeys(e,r)).forEach(d=>{l=a[d]||T,r=s.processField(d,e[d],i),l.isEqual(n.batchChanges[d],r)||(o[d]={value:r,oldValue:i.get(d)},n.batchChanges[d]=r,c=!0)}):(l=a[e]||T,l.isEqual(n.batchChanges[e],r)||(o[e]={value:r,oldValue:i.get(e)},n.batchChanges[e]=r,c=!0)),c&&(i.generation++,!t)){const d={action:"update",record:i,records:[i],changes:o};i.stores.forEach(u=>{u.trigger("batchedUpdate",{...d})}),i.forEachLinked((u,h)=>u.trigger("batchedUpdate",{...d,record:h,records:[h]}))}}inSet(e,r,t,i,n=!1,s=!1,a=!0){var o,l,c;const d=this,{data:u,meta:h,fieldMap:f,constructor:g}=d,{prototype:m,childrenField:p}=g,v={},y=d.fieldToKeys(e,r),S=Object.keys(y).sort(this.constructor.fieldSorter);let D=!1;if(!t&&!d.triggerBeforeUpdate(y))return null;d.inSetting=!0;for(let w=0;w<S.length;w++){const E=S[w];if(E===p)continue;const x=f[E],M=x||T,I=x==null?void 0:x.readOnly,P=(o=x==null?void 0:x.dataSource)!=null?o:E,_=!n&&!x&&E in m,A=_?d[P]:x!=null&&x.complexMapping?T.getPath(u,P):u[P],V=g.processField(E,y[E],d),N=y[E]={value:V},B=d.getRelationConfig(E);!I&&!M.isEqual(A,V)&&(!s||V!==void 0)&&(d.generation++,N.oldValue=(c=(l=x==null?void 0:x.getOldValue)==null?void 0:l.call(x,d))!=null?c:A,D=!0,E in h.modified&&M.isEqual(h.modified[E],V)?(Reflect.deleteProperty(h.modified,E),d.isReverting&&(d.data[P]=V)):d.ignoreBag||(E in h.modified||d.storeFieldChange(E,A),N.oldValue===$r&&Reflect.deleteProperty(N,"oldValue")),v[E]=N,d.applyValue(_,P,V,n,x),B&&!i&&(d.initRelation(B),d.stores.forEach(Z=>Z.cacheRelatedRecord(d,V,B.relationName,N.oldValue))))}return D&&d.afterChange(y,v,t,i,n),d.inSetting=!1,D?v:null}applyValue(e,r,t,i,n){const s=this;let a=n==null?void 0:n.complexMapping;if(((n==null?void 0:n.name)||r)===s.constructor.parentIdField){(s.firstStore.getById(t)||s.firstStore.rootNode).insertChild(s,null,!1,{orderedParentIndex:{skip:!0}});return}else if(e){s[(n==null?void 0:n.name)||r]=t;return}if(n!=null&&n.set){n.set(t,s.data,s);return}if(!n&&r.includes(".")){const o=r.split(".")[0];n=s.constructor.fieldMap[o],a=(n==null?void 0:n.complexMapping)||(n==null?void 0:n.type)==="object"}a?T.setPath(s.data,r,t):s.data[r]=t}afterChange(e,r,t,i,n){for(const s of this.stores)s.onModelChange(this,e,r,t,i,n);this.forEachLinked((s,a)=>s.onModelChange(a,e,r,t,i,n))}forEachLinked(e){for(const r of this.$links)for(const t of r.stores)e(t,r)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return!!(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!T.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const r=typeof e=="string"?this.getFieldDefinition(e):e,t=(r==null?void 0:r.name)||e;let i;return(!r||r.persist)&&(i=this[t],r!=null&&r.serialize&&(i=r.serialize(i,this))),i}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,r={};if(!e.isModified)return null;let t=!1;return Object.keys(e.meta.modified).forEach(i=>{const n=e.getFieldPersistentValue(i);n!==$r&&(r[i]=n,t=!0)}),t?r:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&T.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:r}=e.constructor,t={};if(!e.isModified)return null;let i=!1;return Object.keys(e.meta.modified).forEach(n=>{const s=r[n];if(s!=null&&s.persist){const a=e.getFieldPersistentValue(n);a!==$r&&(T.setPath(t,s.dataSource,a),i=!0)}}),i?t:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,r=this.modificationData;return e.forEach(t=>{r[this.getFieldDefinition(t).dataSource]=this.getFieldPersistentValue(t)}),r}get persistableData(){const e=this,r={};return e.fields.forEach(t=>{const i=e.getFieldPersistentValue(t);i!==$r&&(t!=null&&t.complexMapping?T.setPath(r,t.dataSource,i):r[t.dataSource]=i)}),r}get dataByFieldName(){const{data:e}=this;return this.fields.reduce((r,t)=>(T.hasPath(e,t.dataSource)&&(r[t.name]=e[t.dataSource]),r),{})}get isCommitting(){return!!this.meta.committing}clearChanges(e=!0,r=!0,t=null){const i=this,{meta:n}=i;if(t)for(const a in t)delete n.modified[a];else n.modified={};const s=T.isEmpty(n.modified);n.committing=!1,r&&i.stores.forEach(a=>{if(s&&a.modified.remove(i),a.added.remove(i),e){const o=a.collectDescendants(i).all;a.added.remove(o),s&&a.modified.remove(o)}})}storeFieldChange(e,r){this.meta.modified[e]=r}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,$r,e),this.isReverting=!1}applyChangeset(e,r="$PhantomId",t=!0){var i;const n=this,s=n.constructor,{idField:a,fieldDataSourceMap:o}=s,l=T.pathifyKeys(e),c=T.pathifyKeys(n.modificationData),d={},u=r in e;for(const f in l){const g=o[f],m=(i=g==null?void 0:g.name)!=null?i:f;(t||((g==null?void 0:g.name)===a?u:l[f]===c[f]))&&(d[m]=l[f])}const h=n.set(d);return n.clearChanges(!1,!0,t?null:d),h?Object.entries(h).reduce((f,[g,m])=>(f[g]=m.value,f),{}):{}}get internalId(){return this._internalId}get isPhantom(){return this.id===""||this.id==null||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return typeof this.id=="string"&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${L.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return e!=null&&e.isModel?e.id:T.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return L.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:r}=this,t=this.persistableData;return(r||e)&&(t[this.constructor.childrenField]=(r||e).map(i=>i.toJSON())),t}toString(){const e=this,r=TR.find(i=>i in e.constructor.fieldMap),t=r?{[e.constructor.idField]:e.id,[r]:e[r]}:e.data;return L.safeJsonStringify(t)}get isBatchUpdating(){return!!this.batching}hasBatchedChange(e){var r,t;return(t=(r=this.meta)==null?void 0:r.batchChanges)==null?void 0:t[e]}beginBatch(e=!1){const r=this;r.batching||(r.batching=0,r.meta.batchChanges={}),e&&(r.$silenceBatch=(r.$silenceBatch||0)+1),r.batching++}endBatch(e=!1,r=!1,t=!0){const i=this,{parentIdField:n}=i.constructor;if(i.batching&&(i.batching--,i.$silenceBatch&&i.$silenceBatch--,!(i.batching>0)&&!T.isEmpty(i.meta.batchChanges))){let{batchChanges:s}=i.meta;i.meta.batchChanges=null,s[n]&&(s={...s},i.parentId=s[n],delete s[n]),i.set(s,$r,e,!1,r,void 0,t)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:r}=e.meta,t={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(r).forEach(([n,s])=>{t[n]={oldValue:s,value:e[n]}});const i={action:"update",record:e,records:[e],changes:t};e.stores.forEach(n=>{n.trigger("batchedUpdate",{...i})}),e.forEachLinked((n,s)=>{n.trigger("batchedUpdate",{...i,record:s,records:[s]})})}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var r;return!((r=this.stores)!=null&&r.some(t=>t.trigger("beforeUpdate",{record:this,changes:e})===!1))}copy(e=null,r){const t=this,i=T.clone(t.data),n=t.constructor.idField,s=T.isObject(r)?r.deep:r;let a;if(e&&typeof e=="object"?(a=e[n],Object.assign(i,e)):a=e,s&&t.children?i.children=t.children.map(l=>l.copy(void 0,r)):(delete i.children,delete i.expanded),t.$meta.fields.initable.length>0){const l=t.toJSON();for(const c of t.$meta.fields.initable)i[c.name]=l[c.name]}e!==!1&&(i[n]=a||t.generateId(t.firstStore));const o=new t.constructor(i,null,null,!1,!0);return o.originalInternalId=t.internalId,o}copyData(e,r,t){const i={};e.allFields.forEach(({name:n})=>{n!==e.constructor.idField&&(i[n]=r?e.get(n):e[n])}),this.set(i,null,t)}remove(e=!1){const r=this,{parent:t}=this;t?t.removeChild(r):r.stores.length&&!r.isSpecialRow&&r.stores.forEach(i=>i.remove(r,e,!1,!0))}beforeRemove(e,r){return super.beforeRemove(e,r)}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){var r;const t=this,{stores:i}=t;if(!i.includes(e)){const{unjoinedStores:n}=t;super.joinStore(e),e.register(t),i.push(e),n.includes(e)&&n.splice(n.indexOf(e),1),t.isLoaded&&t.children.forEach(s=>s.joinStore(e)),t.initRelations(),e.tree&&!t.isRoot&&!((r=e.stm)!=null&&r.isRestoring)&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,r=!1){var t,i,n;const s=this,{stores:a,unjoinedStores:o}=s;a.includes(e)&&(e.isDestroying||(e.unregister(s),o.push(e)),(i=(t=s.unfilteredChildren||s.children)==null?void 0:t.forEach)==null||i.call(t,l=>l.unjoinStore(e,r)),a.splice(a.indexOf(e),1),(n=super.unjoinStore)==null||n.call(this,e,r),e.uncacheRelatedRecord(s))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:r}=this,t=e.id||e;return r.map||(r.map={}),r.map[t]||(r.map[t]={})}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return!!((e=this.meta)!=null&&e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach(r=>{(!r.persist||r.calculated)&&(e._nonPersistableFields[r.name]=1)})),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach(r=>{r.alwaysWrite&&e._alwaysWriteFields.push(r.name)})),e._alwaysWriteFields}get domId(){return typeof this.id=="string"?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:r}=this.$meta,t=r[r.length-2],i=r[r.length-3];return`class ${t} extends ${i} { static fields = ${L.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:r,children:t}=this,{defaultValues:i,applyConfigs:n}=this.constructor,s=n?super.getCurrentConfig(e):{};if(s){for(const a of this.fields)if(a.persist){const o=T.getPath(r,a.dataSource);a.isEqual(o,i[a.name])||T.setPath(s,a.dataSource,F.processConfigValue(o,e))}if(t)if(Array.isArray(t)){s.children=[];for(const a of t)s.children.push(a.getCurrentConfig(e))}else s.children=t;this.hasGeneratedId&&delete s.id,delete s.parentId,delete s.parentIndex}return s}},ae=vh;R(ae,"relations",null),ae._idField="id",ae._internalIdCounter=1,ae._assignedIdField=!1,ae.exposeProperties(),ae._$name="Model";var Le=class{constructor(e,r){typeof e=="number"||e===null?(this._magnitude=e,this._unit=r):(typeof e=="string"&&Object.assign(this,b.parseDuration(e)),typeof e=="object"&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=typeof e=="number"&&e}get unit(){return this._unit}set unit(e){this._unit=b.parseTimeUnit(e)}get isValid(){return this._magnitude!=null&&!!b.normalizeUnit(this._unit)}get milliseconds(){return this.isValid?Math.round(b.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return!!e&&this._magnitude!=null&&e._magnitude!=null&&this.milliseconds===e.milliseconds}toString(e){const r=this,t=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return r.isValid?`${r._magnitude} ${b[t](r._unit,r._magnitude!==1)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}};Le._$name="Duration";var PR=(e,r)=>e==null?void 0:e[r],IR=/^is(this|next|last)(week|month|year)$/i,AR=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"],Jl=class extends F.mixin(Gn){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){typeof e=="function"&&(e={filterBy:e}),e.type?e.type==="date"&&e.value!=null&&!Array.isArray(e.value)?e.value=new Date(e.value):e.type==="duration"&&e.value!=null&&!Array.isArray(e.value)&&(e.value=new Le(e.value)):b.isDate(e.value)||Array.isArray(e.value)&&e.value.every(b.isDate)?e.type="date":e.value instanceof Le&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=Jl.generateId(`b-internal-${this.property}-filter-`):this._id=this.property||Jl.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var r;const t=this;!t.isConfiguring&&((r=t.owner)!=null&&r.onFilterChanged)&&!t.owner.isConfiguring&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const r=this;let t;return r._propertyItems.length>1?t=r._propertyItems.reduce(PR,e):t=e[r.property],r[r.operator](r.convert(t))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const r=this;r._value=e,Array.isArray(e)&&({date:1,duration:1}[r.type]||e.length>0&&typeof e[0]=="string")?r._filterValue=e.map(t=>r.convert(t)):!r.caseSensitive&&Array.isArray(e)&&e.length>0&&typeof e[0]=="string"?r._filterValue=e.map(t=>t==null?void 0:t.toLowerCase()):!r.caseSensitive&&typeof e=="string"?r._filterValue=e.toLowerCase():r._filterValue=r.convert(e),r.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":typeof e.filterValue=="string"?"*":"="}convert(e){var r;return this.operator!=="sameTime"&&!(typeof this.filterValue=="string"&&e instanceof Date)&&(this.operator==="sameDay"&&(e=b.clearTime(e)),e=(r=e==null?void 0:e.valueOf())!=null?r:e),e=!this.caseSensitive&&typeof e=="string"?e.toLowerCase():e,e}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return this.filterValue.length===0||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return this.filterValue.length===0||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return b.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return T.isEqual(e,this.filterValue)}"!="(e){return!T.isEqual(e,this.filterValue)}">"(e){return T.isMoreThan(e,this.filterValue)}">="(e){return T.isMoreThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"<"(e){return T.isLessThan(e,this.filterValue)}"<="(e){return T.isLessThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"*"(e){return T.isPartial(e,this.filterValue)}between(e){const[r,t]=this._filterValue;return(T.isMoreThan(e,r)||T.isEqual(e,r))&&(T.isLessThan(e,t)||T.isEqual(e,t))}notBetween(e){return!this.between(e)}empty(e){return e==null||String(e).length===0}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return e===!0}isFalse(e){return e===!1}setRelativeDateValues(){this._filterValue=Jl.getRelativeDateRange(this._operator).map(e=>e.valueOf())}static getRelativeDateRange(e,r=new Date){let t,i,n,s,a,o,l;switch(e){case"isYearToDate":return[b.floor(r,"1 year"),r];case"isToday":return t=b.floor(r,"1 day"),[t,b.add(t,1,"day")];case"isYesterday":return t=b.floor(r,"1 day"),[b.add(t,-1,"day"),t];case"isTomorrow":return i=b.getStartOfNextDay(r),[i,b.add(i,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(n=e.toLowerCase().match(IR),!n)throw new Error(`Unrecognized relative date expression: ${e}`);return[,o,l]=n,s=`1 ${l}`,a=b.floor(r,s),o==="next"?a=b.add(a,1,l):o==="last"&&(a=b.add(a,-1,l)),[a,b.add(a,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return Te.returnTrue;for(const r of e)r.type==="date"&&AR.includes(r._operator)&&r.setRelativeDateValues();return function(r){let t=!0;for(const i of e)if(i.disabled||(t=i.filter(r)),!t)break;return t}}},it=Jl;R(it,"$name","CollectionFilter"),it._$name="CollectionFilter";var tb=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),ji=class{static generateId(e="generatedId"){return e+(tb[e]=(tb[e]||0)+1)}};ji._$name="IdHelper";var La=class extends F{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){typeof e=="function"&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||ji.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,r){const t=this,{convert:i,property:n,useLocaleSort:s}=t,a=t.direction.toLowerCase()==="desc"?-1:1;if(e=e[n],r=r[n],i&&(e=i(e),r=i(r)),s&&e!=null&&r!=null&&typeof e=="string"){if(s===!0)return String(e).localeCompare(r);if(typeof s=="string")return String(e).localeCompare(r,s);if(typeof s=="object")return String(e).localeCompare(r,s.locale,s)}return(e>r?1:e<r?-1:0)*a}static generateSortFunction(e,r){const t=e.isCollection?e.values:e,i=t.length;return(n,s)=>{let a,o;for(o=0;o<i;++o)if(a=t[o].sortFn(n,s),a)return a;return r?r(n,s):0}}};La._$name="CollectionSorter";var _R=()=>0,FR=(e,r)=>r-e,yh=Symbol("filteredIndicesProperty"),Yn=Object.freeze([]),kR=Object.freeze({action:"sort",added:Yn,removed:Yn,replaced:Yn}),OR=Object.freeze({action:"filter",added:Yn,removed:Yn,replaced:Yn}),Bi={string:1,number:1};function rb(e,r,t){if(r.unique!==!1)r.set(t,e);else{let i=r.get(t);i||(i=new Set,r.set(t,i)),i.add(e)}}function LR(e,r,t){r.unique!==!1?r.delete(t):r.has(t)&&(r.get(t).delete(e),r.get(t).size||r.delete(t))}function ib(e,r,t,i){for(let n=0;n<e.length;n++){const s=e[n];for(let a=0;a<i;a++){const o=t[a],l=s[o],c=r[o];rb(s,c,l)}}}var Mt=class extends F.mixin(Ae){constructor(){super(...arguments),R(this,"_sortFunction",null),R(this,"_addedValues",null)}static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const r=this;r._values.length=0,r.isFiltered&&(r._filteredValues.length=0,r.filters.destroy()),(e=r._sorters)==null||e.destroy()}clear(){const e=this,r=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:r}))}equals(e,r){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:t}=this;return r&&(e=e.map(r),t=t.map(r)),H.delta(e,t).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:r,silent:t=!1,isNewDataset:i=!1}){const n=this;let s,a;n.isFiltered&&!i?(!!r?e&&(s=n._values,n._values=e.slice()):(r=e.slice(),e=null),a=n._filteredValues,n._filteredValues=r.slice()):(s=n._values,n._values=e.slice(),r=null,n.isFiltered&&i&&n.autoFilter?(n._filterFunction=null,n._filteredValues=n._values.filter(n.filterFunction)):n._filteredValues&&(n._filteredValues.length=0)),n._indicesInvalid=!0,n._addedValues=void 0,n.generation++,t||n.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:a,values:e,filteredValues:r})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,r=!1){(this.isFiltered&&!r?this._filteredValues:this._values).forEach(e)}map(e,r=!1){return(this.isFiltered&&!r?this._filteredValues:this._values).map(e)}find(e,r=!1){return(this.isFiltered&&!r?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,r=!0){const t=this,{_values:i}=t,n=[];return t.forEach(s=>{const a=e.get(s.id,!0);if(a){const o=t.indexOf(s,!0),l=i[o];i[o]=a,t.removeFromIndices(l),t.addToIndices(a)}else r&&n.push(s)}),n.length&&t.remove(n),t.isFiltered&&(t._filteredValues=t._values.filter(t.filterFunction)),n}add(...e){e.length===1?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){e.length===1?this.splice(0,...e):this.splice(0,e)}move(e,r){for(e=H.asArray(e);e.length&&e[0]===r;)e.shift();if(!e.length)return;const t=this,{_values:i}=t,n=t.indexOf(e[0],!0);if(e.length===1&&i[n+1]===r)return;t.suspendEvents(),t.remove(e),t.resumeEvents();const s=r?t.indexOf(r,!0):i.length;if(s===-1)throw new Error("Collection move beforeItem parameter must be present in Collection");return i.splice(s,0,...e),t._indicesInvalid=1,t.trigger("change",{action:"move",items:e,from:n,to:s}),s}splice(e=0,r,...t){const i=this,n=i.idProperty,s=i._values,a={},o=[],l=[],c=i.totalCount;let d,u;if(i.trigger("beforeSplice",{index:e,toRemove:r,toAdd:t})!==!1){if(t)if(t.length===1&&Array.isArray(t[0])&&(t=t[0]),c&&t.length){const h=i.indices[n];d=[];for(let f=0;f<t.length;f++){const g=t[f],m=g[n],p=h.get(m),v=p?s.indexOf(p):-1;a[m]=!0,v!==-1?s[v]!==g&&(l.push([s[v],g]),s[v]=g):d.push(g)}}else d=t;if(r){if(typeof r=="number"){r=Math.min(r,s.length-e);for(let h=e;r;--r){const f=s[h][n];a[f]?(e++,h++):(o.push(s[h]),s.splice(h,1),u=!0)}}else{let h=d.length===0,f;r=H.asArray(r);const g=r.reduce((m,p)=>{const v=typeof p=="number",y=v?p:i.indexOf(p,!0);return h&&(f!=null&&y!==f+1||v)&&(h=!1),y>=0&&y<c&&m.push(y),f=y,m},[]).sort(FR);if(h)g.length&&(o.push.apply(o,r),s.splice(g[g.length-1],g.length),u=!0);else for(let m=0;m<g.length;m++){const p=g[m];if(p!==-1){const v=s[p][n];a[v]||(o.unshift(s[p]),s.splice(p,1),u=!0)}}}o.length&&!i._indicesInvalid&&o.forEach(i.removeFromIndices,i)}if(d.length){s.splice(Math.min(e,s.length),0,...d),u=!0,i._indicesInvalid||d.forEach(i.addToIndices,i),i._addedValues||(i._addedValues=new Set);for(const h of d)i._addedValues.add(h)}if(o.length&&i._addedValues)for(const h of o)i._addedValues.delete(h);l.length&&!i._indicesInvalid&&l.forEach(h=>{i.removeFromIndices(h[0]),i.addToIndices(h[1])}),u||l.length?(i.isSorted?i.onSortersChanged():i.isFiltered&&(i.autoFilter?i.onFiltersChanged({action:"splice",oldCount:1}):i._filteredValues.splice(Math.min(e,i._filteredValues.length),0,...d)),i.generation++,i.trigger("change",{action:"splice",removed:o,added:d,replaced:l,oldCount:c})):i.trigger("noChange",{index:e,toRemove:r,toAdd:t})}}changeId(e,r){const t=this,{idProperty:i}=t,n=Bi[typeof e]?e:e[i],s=t.get(n);if(s){const a=t.get(r);if(a&&s!==a)throw new Error(`Attempt to set item ${n} to already existing member's id ${r}`);t.removeIndexEntry(e,i,n),t.addIndexEntry(e,i,r),s[i]=r}}get(e,r=!1){return this.getBy(this.idProperty,e,r)}getAt(e,r=!1){return this.isFiltered&&!r?this._filteredValues[e]:this._values[e]}getBy(e,r,t=!1){return this.findItem(e,r,this.isFiltered&&t)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new Mt({values:H.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const r=e instanceof La?e:new La(e);return this.sorters.add(r),r}get isSorted(){var e;return!!((e=this._sorters)!=null&&e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",kR)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=La.generateSortFunction(this.sorters.values):this._sortFunction=_R),this._sortFunction}get filters(){return this._filters||(this._filters=new Mt({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const r=e instanceof it?e:new it(e);return this.filters.add(r),r}removeFilter(e){const{filters:r}=this;e.isCollectionFilter||(e=r.get(e)),r.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return!!(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:r,oldCount:t}){const i=this,n=t||e==="clear"&&r.length?i._filteredValues:i._values;i._filterFunction=null,i._filteredValues=i._values.filter(i.filterFunction),i._indicesInvalid=!0;const{toAdd:s,toRemove:a}=H.delta(i._filteredValues,n,!0);i.trigger("change",{...OR,added:s,removed:a})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=it.generateFiltersFunction(this.filters.values):this._filterFunction=Te.returnTrue),this._filterFunction}changeExtraKeys(e){return H.asArray(e).map(t=>typeof t=="string"?{property:t,unique:!0}:t)}updateExtraKeys(e){for(let r=0;r<e.length;r++)this.addIndex(e[r])}addIndex(e){const r=this;e&&((r._indices||(r._indices={}))[e.property]=new Map,Object.assign(r._indices[e.property],e),r.invalidateIndices(),e.dependentOn&&(r.hasCompositeIndex=!0))}findIndex(e,r,t=!1){const i=this.findItem(e,r,t);return i?(this.isFiltered&&!t?this._filteredValues:this._values).indexOf(i):-1}findItem(e,r,t=!1){var i;const n=this,{isFiltered:s}=n,a=s&&!t?n.indices[yh][e]:n.indices[e];if(a){const o=(i=a.get(r))!=null?i:typeof r=="string"&&r.length&&!isNaN(r)&&a.get(Number(r))||null;if(o!=null)return o}else{const o=s&&!t?n._filteredValues:n._values,l=o.length;for(let c=0;c<l;c++){const d=o[c];if(d[e]==r)return d}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some(r=>r.dependentOn)}indexOf(e,r=!1){return this.findIndex(this.idProperty,Bi[typeof e]?e:e[this.idProperty],r)}includes(e,r=!1){return Array.isArray(e)?e.some(t=>this.includes(t)):!!this.findItem(this.idProperty,Bi[typeof e]?e:e[this.idProperty],r)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,r=e.isFiltered,t=e._indices||(e._indices={}),i=Object.keys(t),n=i.length,s=e._values;let a;r&&(a=t[yh]={});for(let o=0;o<n;o++){const l=t[i[o]];if(l.clear(),r){let c=a[i[o]];c?c.clear():(c=a[i[o]]=new Map,c.unique=l.unique)}}ib(s,t,i,n),r&&ib(e._filteredValues,a,i,n),e._indicesInvalid=!1}getIndices(e){const r=[this.indices[e]];return this.isFiltered&&r.push(this.indices[yh][e]),r}addToIndices(e){Object.keys(this.indices).forEach(r=>{this.addIndexEntry(e,r,e[r])})}removeFromIndices(e){Object.keys(this.indices).forEach(r=>{this.removeIndexEntry(e,r,e[r])})}removeIndexEntry(e,r,t){this.getIndices(r).forEach(i=>LR(e,i,t))}addIndexEntry(e,r,t){this.getIndices(r).forEach(i=>rb(e,i,t))}onItemMutation(e,r){const t=this;!t._indicesInvalid&&Object.keys(t.indices).length>1&&Object.keys(r).forEach(i=>{var n;if(t.indices[i]){const{value:a,oldValue:o}=r[i];t.removeIndexEntry(e,i,o),t.addIndexEntry(e,i,a)}else if(t.hasCompositeIndex){const a=Object.values(t.indices).find(o=>{var l;return(l=o.dependentOn)==null?void 0:l[i]});if(a){const o={};for(const c in a.dependentOn)o[c]=((n=r[c])==null?void 0:n.oldValue)||e[c];const l=e.buildIndexKey(o);t.removeIndexEntry(e,a.property,l),t.addIndexEntry(e,a.property,e[a.property])}}})}};Mt._$name="Collection";var nb=new WeakMap,$a=e=>{if(e&&typeof e=="object"){let r=nb.get(e);r===void 0&&(r=Symbol("bscik"),nb.set(e,r)),e=r}return e},ja=class{constructor(e){const r=this;r.generation=0,r.items=new Set,r.idMap={},r.idProperty="id",e&&(e.idProperty&&(r.idProperty=e.idProperty),e.values&&(r.values=e.values))}get(e){return this.idMap[$a(e)]}get count(){return this.items.size}add(...e){e.length===1&&Array.isArray(e[0])&&(e=e[0]);const r=this,{items:t,idMap:i,idProperty:n}=r,s=e.length;for(let a=0;a<s;a++){const o=e[a],l=Bi[typeof o]?o:$a(o[n]),c=i[l];c==null?(i[l]=o,t.add(o),r.generation++):c!==o&&(i[l]=o,t.delete(c),t.add(o))}}at(e){let r,t;e<0&&(e+=this.count);for(r of this.items)if(!e--){t=r;break}return t}remove(e){e=H.asArray(e);const{items:r,idMap:t,idProperty:i}=this,n=e.length;for(let s=0;s<n;s++){const a=e[s],o=Bi[typeof a]?a:$a(a[i]),l=t[o];l!=null&&(r.delete(l),delete t[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let r=0,t;for(t of this.items)e(t)&&++r;return r}changeId(e,r){const t=this,{idMap:i,idProperty:n}=t,s=Bi[typeof e]?e:$a(e[n]),a=t.get(s);if(a){const o=t.get(r);if(o&&a!==o)throw new Error(`Attempt to set item ${s} to already existing member's id ${r}`);a[n]=r,delete i[s],i[r]=a}}filter(e,r){const{items:t}=this,i=[];let n=0;return t.forEach(s=>{e.call(r,s,n++,t)&&i.push(s)}),i}includes(e){const r=Bi[typeof e]?e:$a(e[this.idProperty]);return!!this.idMap[r]}map(e,r){const{items:t}=this,i=new Array(t.size);let n=0;return t.forEach(s=>{i[n]=e.call(r,s,n++,t)}),i}forEach(e,r){return this.items.forEach(e,r)}find(e,r=0){let t,i;r<0&&(r+=this.countOf(e));for(t of this.items)if(e(t)&&!r--){i=t;break}return i}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,r){let t=-1,i;for(i of this.items)if((!r||r(i))&&(++t,i===e))return t;return-1}get values(){return[...this.items]}set values(e){e=H.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,r){return this.values.some(e,r)}};ja._$name="Bag";var Ql=class extends ja{add(...e){return e.length===1&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter(r=>r.isPersistable))}};Ql._$name="StoreBag";var sb=e=>class extends(e||F){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(t,i=!1){const n=this,{storage:s}=n;if(t=H.asArray(t).reduce((a,o)=>(o=n.getById(o),o&&a.push(o),a),[]),t.length===0)return t;if(!n.tree&&!i&&n.trigger("beforeRemove",{records:t})===!1)return[];if(n.isRemoving=!0,n.isGrouped){const a=s.count,o=[],l=new Set;for(const c of t){const{groupParent:d}=c.instanceMeta(n);d.meta.collapsed&&o.push(c),H.remove(d.groupChildren,c),H.remove(d.unfilteredGroupChildren,c),d.meta.childCount--,l.add(d)}for(const c of l)c.groupChildren.length>0&&n.onModelChange(c,{},{});o.length&&s.trigger("change",{action:"splice",removed:o,added:[],replaced:[],oldCount:a})}else if(n.tree){const a=[],o=t.length>1,l=t[0],c=o?void 0:s.indexOf(l),d=t.reduce((h,f)=>{const{parent:g}=f;return g&&(h[g.id]||(h[g.id]=[g,[]]),h[g.id][1].push(f)),h},{}),u=Array.from(Object.values(d));if(!i&&n.trigger("beforeRemove",{records:t,isMove:!1,parent:o?void 0:l.parent})===!1)return n.isRemoving=!1,[];u.sort((h,f)=>f[0].childLevel-h[0].childLevel);for(const[h,f]of u)a.push(...h.removeChild(f,!1,!0));return i||(n.trigger("remove",{parent:o?void 0:l.parent,index:c,isChild:!0,allRecords:a,isMove:!1,records:t}),n.trigger("change",{action:"remove",records:t})),n.isRemoving=!1,t}if(t.length===0)return n.isRemoving=!1,t;for(const a of t)a.beforeRemove(t);return i&&n.suspendEvents(),s.remove(t),i&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1,t}clear(t=!1){var i,n;const s=this,{storage:a}=s;if(s.storage.totalCount||(n=(i=s.rootNode)==null?void 0:i.unfilteredChildren)!=null&&n.length){if(!t&&s.trigger("beforeRemove",{records:a.allValues,removingAll:!0})===!1)return null;if(s.rootNode)s.isChained||s.rootNode.clearChildren(t);else if(t){const o=s.registeredRecords;for(let l=o.length-1,c;l>=0;l--)c=o[l],c&&!c.isDestroyed&&c.unjoinStore(s)}t&&(s.removed.clear(),a.suspendEvents()),a.clear(),t&&a.resumeEvents(),s.added.clear(),s.modified.clear()}}removeAll(t=!1){const i=this,n=i.storage;let s;if(i.isRemoving=!0,t){n.suspendEvents();const a=i.registeredRecords;for(let o=a.length-1,l;o>=0;o--)l=a[o],l&&!l.isDestroyed&&!l.isRoot&&l.unjoinStore(i)}return i.tree?s=i.rootNode.clear()!==!1:s=i.clear()!==null,t&&n.resumeEvents(),i.isRemoving=!1,s}add(t,i=!1,n={}){const s=this,{storage:a}=s;if(t=H.asArray(t),!(t!=null&&t.length))return;if(s.tree=s.tree||!!(s.autoTree&&t[0].children),s.tree){const l=new Map,c=s.modelClass.getFieldDataSource("parentIndex"),{parentIdField:d}=s.modelClass,u=[];return t.forEach(h=>{const f=h[d];l.has(f)||l.set(f,{append:[],insert:[]});const g=l.get(f);!h.isModel&&c in h?g.insert.push(h):g.append.push(h)}),l.forEach(({append:h,insert:f},g)=>{const m=g==null?s.rootNode:s.getById(g);if(!m)throw new Error(`Parent node with id ${g} not found, cannot add children.`);if(h.length&&u.push(...m.appendChild(h,i)),f.length)for(const p of f)u.push(m.insertChild(p,p[c],i,n))}),s.reapplySortersOnAdd&&!s.isSyncingDataOnLoad&&s.sort(),u}if(!i&&s.trigger("beforeAdd",{records:t})===!1)return null;if(s.tree=s.tree||!!(s.autoTree&&t[0].children),s.tree)return s.rootNode.appendChild(t);const o=s.processRecords(t);return i&&s.suspendEvents(),a.add(o),i&&s.resumeEvents(),s.autoCommit&&s.doAutoCommit(),o}processRecords(t,i){return t.map(n=>{const s=this.processRecord(n.isModel?n:this.createRecord(n));return i==null||i.call(this,s),s})}insert(t,i,n=!1){var s;const a=this,o=a.storage,l=a.getAt(t),c=o.values,d=[];if(i=H.asArray(i),a.tree){const m=a.rootNode;return m.insertChild(i,(s=m.children)==null?void 0:s[t],n)}if(!n&&a.trigger("beforeAdd",{records:i})===!1)return null;let u,h,f;if(c[h=t]===i[0]||c[h=t-1]===i[0])for(u=!0,f=0;u&&f<i.length;f++)i[f]!==c[h+f]&&(u=!1);if(u)return null;const g=a.processRecords(i,m=>{const p=o.indexOf(m);m.children&&m.children.length&&a.autoTree&&(a.tree=!0),p>-1&&(p<t&&l&&t--,d.push(p)),m.meta.previousIndex=p});return a.suspendEvents(),a.storage.remove(d),a.resumeEvents(),n&&a.suspendEvents(),o.splice(t,0,...g),n&&a.resumeEvents(),a.autoCommit&&a.doAutoCommit(),g}move(t,i){this.isTree?i.parent.insertChild(t,i):this.storage.move(t,i)}setMultiple(t,i,n){const s=this,a=[],o=[];s.forEach(l=>{t(l)&&(o.push(l.set(i,n,!0)),a.push(l))}),s.trigger("updateMultiple",{records:a,all:s.records.length===a.length}),s.trigger("change",{action:"updatemultiple",records:a,all:s.records.length===a.length}),s.reapplyFilterOnUpdate&&s.isFiltered&&s.filter()}setAll(t,i){const n=this,s=[];n.forEach(a=>{s.push(a.set(t,i,!0))}),n.trigger("updateMultiple",{records:n.records,all:!0}),n.trigger("change",{action:"updatemultiple",records:n.records,all:!0}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}acceptChanges(){const t=this;t.added.forEach(i=>i.clearChanges(!0,!1)),t.modified.forEach(i=>i.clearChanges(!0,!1)),t.added.clear(),t.modified.clear(),t.removed.clear()}commit(t=!1){const{changes:i}=this;return!t&&this.trigger("beforeCommit",{changes:i})===!1?!1:(this.acceptChanges(),t||this.trigger("commit",{changes:i}),i)}revertChanges(){const t=this,{changes:i}=t;if(i){const n={action:"clearchanges",changes:i};t.add(t.removed.values,!0),t.remove(t.added.values,!0),t.modified.forEach(s=>s.revertChanges(!0)),t.added.clear(),t.modified.clear(),t.removed.clear(),t.trigger("change",n),t.trigger("refresh",n)}}get changes(){const t=this,i=t.modified.values.filter(n=>n.rawModifications);return t.added.count||i.length||t.removed.count?{added:t.added.values.slice(),modified:i,removed:t.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(t){this._autoCommit=t,t&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(t=!0){this.suspendCount--,this.autoCommit&&t&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},ab=e=>class extends(e||F){static get $name(){return"StoreChanges"}static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(t){const i=this,{changes:n}=t;n&&(n.added&&i.add(n.added),n.removed&&i.remove(n.removed.map(s=>s.id)),n.modified&&n.modified.forEach(s=>{i.getById(s.id).set(s.modifications)}))}applyChangeset(t,i=null,n="$PhantomId",s=!0,a=!1){var o,l,c,d;const u=this,{added:h,updated:f,modified:g,removed:m}=(o=i==null?void 0:i(t,u))!=null?o:t,p=(l=f!=null?f:g)!=null?l:[],v=u.modelClass.getFieldDataSource("id"),y=a?new Map:null,S=[],D=[];let w=!1,E=[];if(u._groupVisibleRecordIds=[],u.isGrouped&&u.forEach(x=>{u._groupVisibleRecordIds.push(x.id)}),(h==null?void 0:h.length)>0){const x=[],M=[];for(const P of h)u.getById((c=P[n])!=null?c:T.getPath(P,v))?x.push(P):M.push(P);p.unshift.apply(p,x);const I=(d=u.add(M,!1,{orderedParentIndex:{skip:!0}}))!=null?d:[];if(S.push(...I),u.tree)for(const P of I){const{parent:_}=P;if(_.isRoot){w=!0,E=[_];break}!_.isRoot&&E.every(A=>!A.contains(_))&&E.push(_)}for(const P of I)y==null||y.set(P.id,P.data),P.clearChanges()}if((p==null?void 0:p.length)>0)for(const x of p){const M=x[n],I=T.getPath(x,v),P=u.getById(M!=null?M:I);if(P){const _=P.applyChangeset(x,n,s);u.tree&&!w&&E.every(A=>!A.contains(P))&&(P.parent.isRoot?(w=!0,E=[P.parent]):E.push(P.parent)),y==null||y.set(I,_),D.push(P)}}if((m==null?void 0:m.length)>0&&u.applyRemovals(m),u.applyChangesetFilterSortTarget==="changes"){const x=u.filterChangeset(S,D);E.push(...x)}return u.afterChangesetApplied(E),u._groupVisibleRecordIds=null,y}afterChangesetApplied(t){t.forEach(i=>{i.traverse(n=>{n.sortOrderedChildren(!1,!1),n.children&&n.updateChildrenIndices(n.children,"parentIndex",!0),n.unfilteredChildren&&n.updateChildrenIndices(n.unfilteredChildren,"unfilteredIndex",!0)})})}applyRemovals(t){const i=this,{removed:n}=i,s=i.modelClass.idField,a=[];for(const o of t){const l=T.getPath(o,s);n.includes(l)?n.remove(l):a.push(l)}i.remove(a);for(const o of a)n.remove(o)}filterChangeset(t,i){const n=this,{isFiltered:s,tree:a,isGrouped:o,filtersFunction:l}=n,c=n.isSorted?n.createSorterFn(n.sorters):void 0,{allValues:d,addedValues:u,isSorted:h}=n.storage,f=c!=null||h?c!=null?c:n.storage.sortFunction:null,g=new Set;if(!s)return[];let m=!1,p;if(o&&(p=n.groupers,n.clearGroupers(!0)),a){const y=new Set(i.filter(l));for(const D of t.filter(l))y.add(D);y.forEach(D=>D.bubble(w=>y.add(w))),y.delete(n.rootNode);const S=H.groupBy(Array.from(y),"parentId");for(const D of Object.values(S)){const{parent:w}=D[0];w.unfilteredChildren&&(w.children.push(...D.filter(E=>!w.children.includes(E))),g.add(w))}}else if(f&&!o){const{filteredValues:y}=n.storage,S=u?y.findLastIndex(E=>!u.has(E))+1:y.length,D=y.slice(0,S),w=new Set(i.filter(l));for(const E of y)w.has(E)&&w.delete(E);for(const E of w)D.push(E);D.sort(f),y.splice(0,S,...D),m=!0}else{const y=i.filter(S=>l(S)&&!n.storage.includes(S));y.length>0&&(n.includeInSubset(d,n.storage.filteredValues,y),m=!0)}const v=new Set(t.filter(y=>!l(y)));if(v.size>0){if(a)for(const y of v)H.remove(y.parent.children,y),g.add(y.parent);else H.remove(n.storage.filteredValues,v);m=!0}return p&&(n.group(p[0],null,!1,!0,!0),m=!0),a&&g.size>0?n.storage.replaceValues({values:n.collectDescendants(n.rootNode).visible,silent:!0}):m&&(n._idMap=null,n.trigger("refresh")),[...g]}includeInSubset(t,i,n){const s=new Set(n);let a=0,o=0,l=s.size===0;for(;o<t.length&&!l;){const c=i[a];let d=t[o];for(;c!==d;)s.has(d)&&(i.splice(a,0,d),a++,s.delete(d),l=s.size===0),d=t[++o];s.has(c)&&s.delete(c),a<i.length&&a++}return i}},ob=e=>class extends(e||F){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(t){this.storage.autoFilter=t}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(t){const i=this,n=i.filters;if(n.clear(),i._filtersFunction=null,t){if(t.constructor.name==="Object")for(const s of Object.entries(t))s[0]==="filterBy"&&typeof s[1]=="function"?n.add(new it({filterBy:s[1]})):n.add(new it(s[1].constructor.name==="Object"?Object.assign({property:s[0]},s[1]):{property:s[0],value:s[1]}));else Array.isArray(t)?n.add(...t.map(s=>s instanceof it?s:new it(s))):t.isCollection?n.add(...t.values):n.add(new it({filterBy:t}));n.forEach(s=>s.owner=i)}}get filters(){return this._filters||(this._filters=new Mt({extraKeys:["property"]}))}set filtersFunction(t){this._filtersFunction=t}get filtersFunction(){const t=this,{filters:i,isGrouped:n}=t;if(!t._filtersFunction)if(i.count){const s=it.generateFiltersFunction(i);t._filtersFunction=a=>n&&a.isSpecialRow?a.groupChildren.some(s):s(a)}else t._filtersFunction=Te.returnTrue;return t._filtersFunction}get isFiltered(){return this.filters.values.some(t=>!t.disabled)}traverseFilter(t){const i=this,n=!t.isRoot&&i.filtersFunction(t),s=t.unfilteredChildren||t.children;return!s||!s.length?n:(t.unfilteredChildren||(t.unfilteredChildren=t.children.slice()),t.children=t.unfilteredChildren.filter(a=>i.traverseFilter(a)),t.updateChildrenIndices(t.unfilteredChildren,"unfilteredIndex",!0),t.updateChildrenIndices(t.children,"parentIndex",!0),n||!!t.children.length)}traverseClearFilter(t){const i=this;t.unfilteredChildren&&(t.children=t.unfilteredChildren.slice(),t.unfilteredChildren=null),t.children&&(t.children.forEach(n=>i.traverseClearFilter(n)),t.updateChildrenIndices(t.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(t,i=!1){const n=this;if(t=t instanceof it?t:new it(t),t.owner=n,n.filters.add(t),!i){if(n.remoteFilter)return n.filter().then(()=>t);n.filter()}return t}filter(t){const i=this;let n=!1,s;if(t){let o=typeof t;if(o==="object"&&("silent"in t||"replace"in t||t.filters)&&(n=t.silent,t.replace&&i.clearFilters(t.filters.length===0),s=t.internal,t=t.filters,o=typeof t),t){const l=i.isFiltered;if(i.isConfiguring=!0,Array.isArray(t))t.forEach(c=>i.addFilter(c,!0),i);else if(o==="function"){const c=new it(t);c.internal=s,i.addFilter(c,!0)}else o==="string"?i.addFilter({property:t,value:arguments[1]},!0):i.addFilter(t,!0);if(i.isConfiguring=!1,!i.isFiltered&&!l)return null}}i.filtersFunction=null;const a=i.performFilter(n);return i._idMap=null,a}performFilter(t){const i=this,{storage:n,filters:s,rootNode:a}=i,o=i.count;i.trigger("beforeFilter",{filters:s});let l,c;if(i.tree){const d=n.values;i.isFiltered?i.traverseFilter(a):i.traverseClearFilter(a);const u=i.collectDescendants(a).visible;n.replaceValues({values:u,silent:!0});const h=H.delta(u,d,!0);l=h.toAdd,c=h.toRemove}else n.ion({change({removed:d,added:u}){c=d,l=u},once:!0}),i.isFiltered?(i.isGrouped&&i.includeCollapsed(),n.addFilter({id:"primary-filter",filterBy:i.filtersFunction}),i.isGrouped&&i.excludeCollapsed()):n.filters.clear();i.afterPerformFilter(t||i.isRemoteDataLoading?null:{action:"filter",filters:s,oldCount:o,added:l,removed:c,records:i.storage.values})}afterPerformFilter(t){this.resetRelationCache(),t&&this.triggerFilterEvent(t)}get filtered(){return this.storage.isFiltered}triggerFilterEvent(t){this.trigger("filter",t),this.remoteFilter||(this.trigger("refresh",t),this.trigger("change",t))}filterBy(t){return this.filter(t)}removeFilter(t,i=!1){const n=this,s=t instanceof it?t:n.filters.get(t);if(s){if(n.filters.remove(s),n._filtersFunction=null,!i){if(n.remoteFilter)return n.filter().then(()=>s);n.filter()}return s}}clearFilters(t=!0){if(this.filters.remove(this.filters.values.filter(i=>!i.internal)),t)return this.filter()}convertFilterToString(t){const i=this.filters.getBy("property",t);return i&&!i.filterBy?String(i):""}doDestroy(){var t;(t=this._filters)==null||t.destroy(),super.doDestroy()}},$R={add:1,replace:1},lb=e=>class extends(e||F){static get $name(){return"StoreGroup"}static get defaultConfig(){return{groupers:null,useGroupFooters:!1,startGroupsCollapsed:null}}static get properties(){return{collapsedGroups:new Set}}construct(t){super.construct(t),this.ion({change:"onDataChanged",thisObj:this})}get groupers(){return this._groupers}set groupers(t){this.setGroupers(t)}setGroupers(t,i){const n=this,{storage:s}=n;let a;return t!=null&&t.length?n._groupers=t:n.groupers&&(delete n._groupers,n.includeCollapsed(),s.replaceValues({values:n.removeHeadersAndFooters(s._values),filteredValues:s.isFiltered?n.removeHeadersAndFooters(s._filteredValues):null,silent:!0}),a=n.group(null,null,null,!1,i==null?void 0:i.silent)),n._idMap=null,a}get groupRecords(){const t=[];if(this.isGrouped)for(const i of this)i.isSpecialRow&&t.push(i);return t}get unfilteredGroupRecords(){var t;const i=this;if(i.isGrouped){const{generation:n}=i.storage;((t=i._unfilteredGroupRecords)==null?void 0:t.generation)!==n&&(i._unfilteredGroupRecords=i.storage.allValues.filter(s=>s.isSpecialRow),i._unfilteredGroupRecords.generation=n)}return i._unfilteredGroupRecords||[]}getGroupHeaderForRecord(t,i=!1){if(this.isGrouped){let n;const s=i?this.storage._values:this.storage.values;for(const a of s)if(a.isGroupHeader){if(!t)n=a;else if(a===t||a.unfilteredGroupChildren.includes(t)){n=a;break}}return n}}includeCollapsed(){for(const t of this.collapsedGroups)this.expand(this.getById(t),!1)}excludeCollapsed(){for(const t of this.collapsedGroups)this.collapse(this.getById(t))}onDataChange({source:t,action:i,removed:n}){var s;const a=this,{groupers:o}=a;o&&(o.length?(i==="splice"&&(n!=null&&n.length)||i==="move")&&t.replaceValues({...a.prepareGroupRecords(),silent:!0}):t.replaceValues({values:a.removeHeadersAndFooters(t._values),filteredValues:t.isFiltered?a.removeHeadersAndFooters(t._filteredValues):null,silent:!0})),(s=super.onDataChange)==null||s.call(this,...arguments)}move(t,i){const n=this;if(n.isGrouped&&!n.tree){let s=i;if(i!=null&&i.isSpecialRow&&(s=n.getPrev(i,!1,!1),!s))return;const a=n.getGroupHeaderForRecord(s),o=n.groupers[0].field,l=a.meta.groupRowFor,{reapplyFilterOnUpdate:c}=n;if(n.reapplyFilterOnUpdate=!1,n.beginBatch(),t.forEach(d=>d[o]=l),n.endBatch(),n.reapplyFilterOnUpdate=c,n.isFiltered&&(i!=null&&i.isSpecialRow)){const{unfilteredGroupRecords:d}=n,u=d.indexOf(a);i=d[u+1]}}super.move(t,i)}collapse(t){return t&&!t.meta.collapsed?(this.excludeGroupRecords(t),t.meta.collapsed=!0,this.collapsedGroups.add(t.id),!0):!1}expand(t,i=!0){return t!=null&&t.meta.collapsed?(this.includeGroupRecords(t),t.meta.collapsed=!1,i&&this.collapsedGroups.delete(t.id),!0):!1}removeHeadersAndFooters(t){return t.filter(i=>i.isSpecialRow?(this.unregister(i),!1):!0)}prepareGroupRecords(t){const i=this,{isFiltered:n,reapplyFilterOnUpdate:s,startGroupsCollapsed:a}=i,o=i.collapsedGroups,{allValues:l}=i.storage,c=[],d=i._groupVisibleRecordIds||[],u=D=>{const w=!n||i.filtersFunction(D);return s?w:w||d.includes(D.id)};for(const D of l)D.isGroupHeader&&(D.meta.collapsed||o.has(D.id))&&(o.add(D.id),c.push(D));for(const D of c)i.includeGroupRecords(D);const h=i.removeHeadersAndFooters(i.storage._values);t&&h.sort(t),n&&(i.filtersFunction=null);const f=[],g=i.groupers[0].field;let m=null,p=null,v=0;function y(){const D=p.meta.groupRowFor,w=`group-footer-${typeof D=="number"?D:L.createId(D)}`,E=i.getById(w)||new i.modelClass({id:w},i,{specialRow:!0,groupFooterFor:D,groupRecord:p});return E.stores=[i],i.register(E),E.groupChildren=p.groupChildren,p.meta.collapsed||f.push(E),i.allRecords.push(E),p.groupChildren.push(E),p.unfilteredGroupChildren.push(E),v++,E}h.forEach(D=>{var w;const E=D[g]==null?"__novalue__":D[g],x=`group-header-${typeof E=="number"?E:L.createId(E)}`;if(((w=D.unfilteredGroupChildren)==null?void 0:w.length)===0){i.unregister(D);return}T.isEqual(E,m)||(p&&(i.useGroupFooters&&y(p),p.meta.childCount=v),p=i.getById(x),p||(p=new i.modelClass({id:x},i,{specialRow:!0,groupRowFor:E,groupField:g}),a&&(o.add(x),i.startGroupsCollapsed=!1)),p.meta.collapsed=o.has(x),p.stores=[i],i.register(p),p.groupChildren=[],p.unfilteredGroupChildren=[],f.push(p),i.allRecords.push(p),m=E,v=0),D.instanceMeta(i.id).groupParent=p,o.has(x)||f.push(D),u(D)&&(p.groupChildren.push(D),v++),p.unfilteredGroupChildren.push(D)}),p&&(i.useGroupFooters&&y(),p.meta.childCount=v),i._idMap=null;const S={values:f};return n&&(S.filteredValues=f.filter(u)),S}get isGrouped(){var t;return!!((t=this.groupers)!=null&&t.length)}group(t,i,n=!1,s=!0,a=!1){var o,l;const c=this;let d,u;if(t&&typeof t=="object"&&(i=t.ascending,u=t.fn,t=t.field),n?c.groupers.push(d={field:t,ascending:i,complexMapping:t.includes(".")}):t&&(i==null&&(i=((o=c.groupInfo)==null?void 0:o.field)===t&&((l=c.groupInfo)==null?void 0:l.fn)===u?!c.groupInfo.ascending:!0),c.groupInfo=d={field:t,ascending:i,fn:u,complexMapping:t.includes(".")},c.groupers=[c.groupInfo]),d){const{prototype:h}=c.modelClass;d.complexMapping&&!Object.prototype.hasOwnProperty.call(h,t)&&Object.defineProperty(h,t,{get(){return T.getPath(this,t)}})}if(s!==!1){if(c.remoteSort&&!c.isRemoteDataLoading)return c.sort(null,null,!1,!0).then(()=>c.onAfterGrouping(a));c.sort(null,null,!1,!0)}c.onAfterGrouping(a)}onAfterGrouping(t){if(t)return;const i=this,n=i.groupers||[];i.trigger("group",{isGrouped:i.isGrouped,groupers:n,records:i.storage.values}),i.trigger("refresh",{action:"group",isGrouped:i.isGrouped,groupers:n,records:i.storage.values})}addGrouper(t,i=!0){return this.group(t,i,!0)}removeGrouper(t){const i=this,{groupers:n}=i;if(!n)return;const s=n.findIndex(a=>a.field===t);if(s>-1)return n.splice(s,1),n.length?i.group():i.clearGroupers()}clearGroupers(t=!1){return this.setGroupers(null,{silent:t})}isRecordInGroup(t,i){var n;if(!this.isGrouped)return null;const s=(n=this.groupers[0])==null?void 0:n.field;return t[s]===i&&!t.isSpecialRow}isInCollapsedGroup(t){const i=t.instanceMeta(this).groupParent;return i==null?void 0:i.meta.collapsed}getGroupRecords(t){return this.isGrouped?this.storage.values.filter(i=>this.isRecordInGroup(i,t)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:t,action:i}){this.isGrouped&&(!t&&$R[i]||t&&this.groupers.some(n=>n.field in t))&&this.sort()}internalIncludeExcludeGroupRecords(t,i){const n=this,s=n.indexOf(t),a=n.allIndexOf(t),{id:o,storage:l}=n,{_filteredValues:c,_values:d}=l,{meta:u,groupChildren:h,unfilteredGroupChildren:f}=t;a===-1||u.collapsed&&!i||!u.collapsed&&i||(f.forEach(g=>g.instanceMeta(o).hiddenByCollapse=!i),i?(c&&c.splice(s+1,0,...h.filter(g=>!n.isAvailable(g))),l._values.splice(a+1,0,...f.filter(g=>!n.isAvailable(g)))):(c&&c.splice(s+1,h.length),d.splice(a+1,f.length)),l._indicesInvalid=!0,n._idMap=null)}excludeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!1)}includeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!0)}collectGroupRecords(t,i=!0){return(t?this.storage.allValues:this.storage.values).reduce((s,a)=>(a.isSpecialRow&&(i&&!a.isGroupFooter&&s.push(a),a.isGroupHeader&&s.push.apply(s,a.groupChildren)),s),[])}},cb=e=>class extends(e||F){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(i,n){if(n in i)return i[n];if(n==="$store")return i;let s=i.getById(n);return!s&&!isNaN(parseInt(n))&&(s=i.getAt(parseInt(n))),s},set(i,n,s){return n in i||i.isDestroying?i[n]=s:i.add({[i.modelClass.idField]:n,...s}),!0},deleteProperty(i,n){return i.isDestroying?(delete i[n],!0):!!i.remove(n).length},has(i,n){if(n in i)return!0;if(n.startsWith("{")&&n.endsWith("}")){const s=L.safeJsonParse(n);n=s==null?void 0:s.id}return i.includes(n)}})}},db=e=>{var r;return r=class extends(e||F){initRelations(t){const i=this,n=i.modelClass.exposedRelations;t&&i.modelRelations&&i.modelRelations.forEach(s=>{var a;return(a=s.storeDetacher)==null?void 0:a.call(s)}),(!i.modelRelations||i.modelRelations.length===0||t)&&n&&(i.modelRelations=[],n==null||n.forEach(s=>{const a={...s},{foreignStore:o,relationName:l,relatedCollectionName:c}=a,d=typeof o=="string"?i[o]:o;if(a.dependentStore=i,i.modelRelations.push(a),d){a.foreignStoreProperty=a.foreignStore,a.foreignStore=d;const u=d.dependentStoreConfigs;if(u.has(i)){const h=u.get(i);if(t){const f=h.find(g=>g.relationName===l);f&&H.remove(h,f)}h.push(a)}else u.set(i,[a]);c&&d.initRelationCollection(a,i),d.count>0&&d.updateDependentStores("dataset",d.records)}}))}initRelationCollection(t,i){const n=this,s=t.relatedCollectionName,a=n.collectionStores||(n.collectionStores={});a[s]={store:i,config:t},n[s+"Store"]||(n[s+"Store"]=i),n.count>0&&n.initModelRelationCollection(s,n.records)}initModelRelationCollection(t,i){const n=this;i.forEach(s=>{s.traverse(a=>{const o=t in a?`$related${L.capitalize(t)}`:t;Object.defineProperty(a,o,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,t)},set:function(l){return n.setCollection(this,t,l)}})})})}resetRelationCache(){this.relationCache={},this.forEach(t=>t.initRelations())}updateRecordRelationCache(t,i){i==null||i.forEach(n=>{const{config:s}=n,a=n.related?n.related.id:t.get(s.foreignKey);a!==void 0&&this.cacheRelatedRecord(t,a,s.relationName,a)})}getRelationCollection(t,i){const n=ae.asId(i);return this.relationCache[t]&&this.relationCache[t][n]||[]}getCollection(t,i){const{config:n,store:s}=this.collectionStores[i];return s.relationCache[n.relationName]&&s.relationCache[n.relationName][t.id]||[]}setCollection(t,i,n){const{config:s,store:a}=this.collectionStores[i],o=a.relationCache[s.relationName]||(a.relationCache[s.relationName]={}),l=(o[t.id]||[]).slice(),c=[],d=[];a.suspendEvents(),l.forEach(u=>{n.includes(u)||(u[s.foreignKey]=null,a.remove(u),d.push(u))}),n.forEach(u=>{u.isModel instanceof ae?u.stores.includes(a)||(a.add(u),c.push(u)):([u]=a.add(u),c.push(u)),u[s.foreignKey]=t.id}),a.resumeEvents(),d.length&&(a.trigger("remove",{records:d}),a.trigger("change",{action:"remove",records:d})),c.length&&(a.trigger("add",{records:c}),a.trigger("change",{action:"add",records:c}))}cacheRelatedRecord(t,i,n,s=null){const a=this,o=a.relationCache[n]||(a.relationCache[n]={});s!==null&&a.uncacheRelatedRecord(t,n,s),i!=null&&H.include(o[i]||(o[i]=[]),t)}uncacheRelatedRecord(t,i=null,n=null){const s=this;function a(o,l){const c=s.relationCache[o],d=c==null?void 0:c[l];if(d){const u=d.indexOf(t);u>=0&&d.splice(u,1),d.length===0&&delete c[l]}}n!=null?a(i,n):t.meta.relationCache&&Object.entries(t.meta.relationCache).forEach(([o,l])=>a(o,l==null?void 0:l.id))}updateDependentStores(t,i){this.dependentStoreConfigs.forEach(n=>{n.forEach(s=>{const{dependentStore:a,relatedCollectionName:o,relationName:l,foreignKey:c}=s,d=a.relationCache[l];if(t==="dataset"){o&&this.initModelRelationCollection(o,i),a.forEach(u=>{const h=u.initRelation(s);h&&a.cacheRelatedRecord(u,h.id,l,h.id)});return}if(t==="removeall"){a.forEach(u=>u.removeRelation(s)),delete a.relationCache[l];return}t==="add"&&o&&this.initModelRelationCollection(o,i),(t==="add"||t==="remove")&&i.forEach(u=>{const h=d==null?void 0:d[u.id];switch(t){case"remove":h&&h.forEach(f=>f.removeRelation(s));break;case"add":a.forEach(f=>{f.get(c)==u.id&&(f.initRelation(s),a.cacheRelatedRecord(f,u.id,l))});break}})})})}updateDependentRecordIds(t,i){var n;(n=this.dependentStoreConfigs)==null||n.forEach(s=>{s.forEach(a=>{var o;const{dependentStore:l,relationName:c,foreignKey:d}=a,u=l.relationCache[c],h=(o=u==null?void 0:u[t])==null?void 0:o.slice();h==null||h.forEach(f=>{l.cacheRelatedRecord(f,i,c,t),f.set(d,i,!1,!0)})})})}},R(r,"$name","StoreRelation"),r},ub=e=>class extends(e||F){static get $name(){return"StoreSum"}sum(t,i=this.storage.values){return i?i.reduce((n,s)=>{if(s.isSpecialRow)return n;const a=Number(s[t]);return isNaN(a)?n:n+a},0):0}min(t,i=this.storage.values){return!i||!i.length?0:i.reduce((n,s)=>{var a;return typeof((a=s[t])==null?void 0:a.valueOf())==="number"&&s[t]<n&&(n=s[t]),n},i[0][t])}max(t,i=this.storage.values){return!i||!i.length?0:i.reduce((n,s)=>{var a;return typeof((a=s[t])==null?void 0:a.valueOf())==="number"&&s[t]>n&&(n=s[t]),n},i[0][t])}average(t,i=this.storage.values){if(!i||!i.length)return 0;let n=0;const s=i.reduce((a,o)=>{if(o.isSpecialRow)return a;const l=parseFloat(o[t]);return isNaN(l)?a:(n++,a+l)},0);return n>0?s/n:0}groupSum(t,i){return this.sum(i,this.getGroupRecords(t))}},bh=(e,r)=>String(e).toLowerCase().includes(r),hb={string:bh,number:bh,boolean:bh,date:(e,r)=>e instanceof Date&&r instanceof Date?e-r===0:String(e.getMonth()+1).includes(r)||String(e.getDate()).includes(r)||String(e.getFullYear()).includes(r),object:(e,r)=>e===r,undefined:(e,r)=>e===r},fb=e=>class extends(e||F){static get $name(){return"StoreSearch"}search(t,i=null,n,s){const a=this.isTree&&!s?this.rootNode.allChildren:this.getAllDataRecords(s),o=a.length,l=[];if(t==null)return[];typeof t=="string"&&(t=t.toLowerCase());let c,d,u,h,f,g;for(c=0;c<o;c++){u=a[c],d=0;for(const m of i||u.fieldNames){h=u[m],f=h instanceof Date?"date":typeof h;const p=n==null?void 0:n[d];p&&(h=p(h),f="string"),g=hb[f],h&&(g!=null&&g(h,t))&&l.push({index:c,data:u,field:m,id:u.id}),d++}}return l}findByField(t,i,n=!1,s=!1){const a=this.getAllDataRecords(s),o=a.length,l=new Set,c=[];let d,u,h;for(i!=null&&(i=String(i).toLowerCase()),d=0;d<o;d++)if(u=a[d],h=u[t],!n||!l.has(h)){const f=h instanceof Date?"date":typeof h,g=hb[f];(i==null&&h===i||i&&g(h,i))&&(c.push({id:u.id,index:d,data:u}),n&&l.add(h))}return c}find(t,i=!1){return this.getAllDataRecords(i).find(t)}findRecord(t,i,n=!1){const s=a=>T.isEqual(a[t],i);return this.isTree?this.query(s,n)[0]:this.getAllDataRecords(n).find(s)}query(t,i=!1){if(this.isTree){const n=[];return this.traverse(s=>{t(s)&&n.push(s)},void 0,void 0,i),n}return this.getAllDataRecords(i).filter(t)}some(t,i=!1){return this.getAllDataRecords(i).some(t)}},jR=/\./,gb=e=>class extends(e||F){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return!!this.sorters.length||this.isGrouped}changeSorters(t){return t.map(i=>this.normalizeSorterConfig(i,!0))}updateReapplySortersOnAdd(t){this.storage.autoSort=t}sort(t,i,n=!1,s=!1){const a=this,o=a.allRecords,l=a.sorters?a.sorters.slice():[];let c=null,d;if(t)if(Array.isArray(t))a.sorters=t.map(u=>a.normalizeSorterConfig(u,typeof u=="string"?!0:i));else{const u=a.normalizeSorterConfig(t,i);n?(d=a.getCurrentSorterByField(u.field),d?(c=d.ascending,d.ascending=u.ascending):a.sorters.push(u)):a.sorters=[u]}return!s&&a.trigger("beforeSort",{sorters:a.sorters,records:o,currentSorters:l})===!1?(a.sorters=l,c!==null&&(d.ascending=c),null):a.performSort(s)}normalizeSorterConfig(t,i){var n,s,a;const o=this,l={ascending:i};if(typeof t=="object"?(T.assign(l,t),t.fn&&(delete l.fn,l.sortFn=t.fn),l.ascending=(n=t.ascending)!=null?n:i):typeof t=="function"?l.sortFn=t:l.field=t,l.ascending==null){const c=o.getCurrentSorterByField(l.field);l.ascending=c?!c.ascending:!0}if(l.sortFn==null){const c=(a=(s=o.modelClass)==null?void 0:s.$meta.fields.map[l.field])==null?void 0:a.compareItems;c&&(l.sortFn=c)}return l}getCurrentSorterByField(t){return typeof t=="string"&&this.sorters.find(i=>i.field===t)||null}addSorter(t,i=!0){return this.sort(t,i,!0)}removeSorter(t){const i=this.sorters.findIndex(n=>n.field===t||n.sortFn===t);if(i>-1)return this.sorters.splice(i,1),this.sort()}clearSorters(t=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,t)}createSorterFn(t){const i=this.useLocaleSort;return(n,s)=>{for(let a=0;a<t.length;a++){const o=t[a],{field:l,ascending:c=!0,useLocaleSort:d=i}=o,u=o.fn||o.sortFn,h=c?1:-1;if(u){const p=u.call(o,n,s);if(p===0)continue;if(p!==null)return p*h}const f=jR.test(l),g=f?n.get(l):n[l],m=f?s.get(l):s[l];if(g!==m){if(g==null)return-h;if(m==null)return h;if(d&&typeof g=="string"){if(d===!0)return String(g).localeCompare(m)*h;if(typeof d=="string")return String(g).localeCompare(m,d)*h;if(typeof d=="object")return String(g).localeCompare(m,d.locale,d)*h}if(g>m)return h;if(g<m)return-h}}return 0}}get sorterFn(){const t=this,{sorters:i}=t;return t.createSorterFn(t.remoteSort?[{field:"_remoteSortIndex"}]:t.isGrouped?t.groupers.concat(i):i)}performSort(t){const i=this,{rootNode:n,storage:s,sorterFn:a}=i;i.tree?(!i.isChained&&n.traverse(o=>{o.isLoaded&&o.isParent&&(o.children.sort(a),o.updateChildrenIndices(o.children,"parentIndex",!0))}),s.replaceValues({values:i.collectDescendants(n).visible,silent:!0})):i.isGrouped?s.replaceValues({...i.prepareGroupRecords(a),silent:!0}):s.replaceValues({values:s.values.sort(a),silent:!0}),i.afterPerformSort(t||i.isRemoteDataLoading)}afterPerformSort(t){if(t)return;const i=this;i._idMap=null;const n={action:"sort",sorters:i.sorters,records:i.allRecords};i.trigger("sort",n),i.trigger("refresh",n)}},mb=()=>!0,pb=e=>class extends(e||F){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0}}static get properties(){return{chainedStores:null}}construct(t){super.construct(t);const i=this,{masterStore:n}=i,s=i.syncOrder?"sort":"";n&&(i.methodNamesToRelay.forEach(a=>i[a]=(...o)=>i.relayToMaster(a,o)),i.removeAll=(...a)=>{n.remove(i.getRange(),...a)},n.ion({changePreCommit:i.onMasterDataChangedPreCommit,change:i.onMasterDataChanged,[s]:i.onMasterDataChanged,prio:1,thisObj:i}),n.chainedStores||(n.chainedStores=[]),n.chainedStores.push(i),i.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return!!this.masterStore}set chainedFilterFn(t){this._chainedFilterFn=this.thisObj?t.bind(this.thisObj):t}get chainedFilterFn(){return this._chainedFilterFn||mb}get methodNamesToRelay(){const t=Array.isArray(this.doRelayToMaster),i=Array.isArray(this.dontRelayToMaster);return t&&this.doRelayToMaster.filter(n=>!i||!this.dontRelayToMaster.includes(n))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(t=>t.fillFromMaster())}fillFromMaster(){const t=this,{masterStore:i,isTree:n}=t;let s=[];if(!t.isChained)throw new Error("fillFromMaster only allowed on chained store");if(i.isGrouped&&i.isFiltered?i.forEach(a=>s.push(a),i,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}):s=i.allRecords.filter(a=>!a.isSpecialRow&&t.chainedFilterFn(a)),n&&(t.idRegister={},t.internalIdRegister={},s.forEach(a=>{a.stores.includes(t)?t.register(a):a.joinStore(t)}),t.excludeCollapsedRecords)){const a=t.getChildren(t.rootNode);s=t.doIncludeExclude(a,!0)}t.isFillingFromMaster=!0,t.data=s,t.isFillingFromMaster=!1}commitToMaster(){const t=this,i=t.masterStore;if(!t.isChained)throw new Error("commitToMaster only allowed on chained store");return i.beginBatch(),i.remove(t.removed.values),i.add(t.added.values),i.endBatch(),t.commit()}relayToMaster(t,i){return this.masterStore[t](...i)}onMasterDataChangedPreCommit(t){this.onMasterDataChanged(t),this.$masterEventhandled=!0}onMasterDataChanged({action:t,changes:i,$handled:n,isMove:s}){var a;if(this.$masterEventhandled){this.$masterEventhandled=!1;return}s&&t==="remove"||(t!=="update"||(a=this.chainedFields)!=null&&a.some(o=>o in i))&&this.fillFromMaster()}makeChained(t=mb,i,n){return new((n==null?void 0:n.storeClass)||this.constructor)({...n||{},tree:!1,autoTree:!1,masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:t,chainedFields:i})}chain(){return this.makeChained(...arguments)}doDestroy(){var t;(t=this.chainedStores)==null||t.forEach(i=>i.destroy()),super.doDestroy()}},vb=e=>class extends(e||F){static get $name(){return"StoreState"}getState(){const{sorters:t,groupers:i,filters:n}=this,s={};return t!=null&&t.length&&(s.sorters=t.map(a=>{const o=T.cleanupProperties(T.clone(a));return delete o.fn,delete o.sortFn,o})),i!=null&&i.length&&(s.groupers=i.map(a=>{const o=T.cleanupProperties(T.clone(a));return delete o.fn,o})),n!=null&&n.values.length&&(s.filters=n.values.map(a=>{const o=T.cleanupProperties(T.clone(a.config));return o.value=a.value,o.caseSensitive&&delete o.caseSensitive,o})),s}applyState(t){const i=this,{sorters:n=[],groupers:s=[],filters:a=[]}=t,{sortParamName:o,filterParamName:l}=i;i.sorters=n.filter(c=>c.field||c.sortFn&&!o),i.groupers=s.slice(),i.sort(),i.filters=a.filter(c=>c.property||c.filterBy&&!l),i.filter()}},BR=e=>String(e).padStart(6,"0"),Vt=class{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e!=null?e:"")}get value(){return this._value}static from(e){return e==null||e instanceof Vt?e:new Vt(e)}static pad(e){return e instanceof Vt?e.valueOf():Vt.split(e).map(BR).join(".")}static split(e){let r,t;if(e||e===0)switch(typeof e){case"object":e=String(e);case"string":for(t=e.split("."),r=t.length;r-- >0;)t[r]=parseInt(t[r],10);break;case"number":t=[e];break}return t||[]}static compare(e,r){return e===r?0:!e||!r?e?1:r?-1:0:(e=Vt.pad(e),r=Vt.pad(r),e<r?-1:r<e?1:0)}append(e){const r=this.value;return Vt.from(r?`${r}.${e}`:e)}isEqual(e){return!Vt.compare(this,e)}match(e){let r=!1;if(e){const t=this.value,i=e[0]==="*",n=e.endsWith("*"),s=e.length;i===n?r=t.indexOf(i?e.substr(1,s-2):e)>-1:i?r=t.endsWith(e.substr(1)):r=t.startsWith(e.substr(0,s-1))}return r}toString(){return this.value}toJSON(){return this.toString()}valueOf(){var e;return(e=this._padded)!=null?e:this._padded=Vt.pad(this.value)}};Vt._$name="Wbs";var HR=Object.freeze([]),yb=e=>{var r;return r=class extends(e||F){get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const t=this,i=[];return t.isTree?(t.traverse(n=>{n.isLeaf&&i.push(n)}),i):(t.allRecords.forEach(n=>{n.isLeaf&&i.push(n),n.traverse(s=>{s.isLeaf&&i.push(s)},!0)}),i)}async loadChildren(t){}onNodeAddChild(t,i,n,s,a=!1){var o;const l=this,c=t===l.rootNode&&t.isLoading,{storage:d}=l,u=[],h=[],{previousSibling:f}=i[0];let g;if(l.collectDescendants(i,u,h,{inCollapsedBranch:!(t.isExpanded(l)&&t.ancestorsExpanded(l))}),!c&&h.length)for(const m of h)!l.modified.includes(m)&&!s[m.id]&&(l.removed.includes(m)?l.removed.remove(m):m.isLinked||l.added.add(m));if(c&&l.rootVisible&&(u.unshift(t),h.unshift(t)),u.length?(n===0||!f?g=d.indexOf(t):g=d.indexOf(f)+f.getDescendantCount(!0,l),d.suspendEvents(),l.storage.splice(++g,0,u),d.resumeEvents(),l._idMap=null):l._allRecords=null,l.updateDependentStores("add",i),c&&u.length){if(l.sorters.length&&l.sort(null,null,!1,!0),(o=l.afterLoadData)==null||o.call(l),!a){const m={action:"dataset",data:l._data,records:u};l.trigger("refresh",m),l.trigger("change",m)}}else if(!a){const m={action:"add",parent:t,isChild:!0,isMove:s,records:i,allRecords:h,index:g};if(l.trigger("add",m),l.trigger("change",m),Object.values(s).some(p=>p)){const p={newParent:t,records:i.filter(v=>s[v.id]),oldParents:i.map(v=>l.getById(v.meta.oldParentId))};l.trigger("move",p)}}}onNodeRemoveChild(t,i,n,s={isMove:!1,silent:!1,unfiltered:!1}){const a=this,{storage:o}=a,l=[],c=[],{isMove:d,silent:u,unfiltered:h}=s,f=h&&a.isFiltered,g=f&&t.unfilteredChildren?t.unfilteredChildren:i;if(a.collectDescendants(g,l,c,{inCollapsedBranch:!(t.isExpanded(a)&&t.ancestorsExpanded(a)),unfiltered:f}),!d){for(const m of i)m.unjoinStore(a);for(const m of c)m.stores.includes(a)&&m.unjoinStore(a),a.added.includes(m)?a.added.remove(m):m.isLinked||a.removed.add(m);a.modified.remove(c)}if(l.length?(n=o.indexOf(l[0]),n>-1&&(o.suspendEvents(),o.splice(n,l.length),o.resumeEvents(),a._idMap=null)):(n=-1,a._allRecords=null),!u&&(a.fireRemoveEventForMoveAction||!d)){const m={action:"remove",parent:t,isChild:!0,isMove:d,records:i,allRecords:c,index:n};a.trigger("remove",m),a.trigger("change",m)}return c}collectDescendants(t,i=[],n=[],s){const a=this,{inCollapsedBranch:o=!1,unfiltered:l=!1}=s||0,c=Array.isArray(t)?t:a.getChildren(t,l);if(c)for(let d=0,u=c.length,h;d<u;d++)h=c[d],o||i.push(h),n.push(h),a.collectDescendants(h,i,n,{inCollapsedBranch:o||!h.isExpanded(a),unfiltered:l});return{visible:i,all:n}}getChildren(t,i=!1){const n=this,s=(i||n.isChained)&&t.unfilteredChildren||t.children;return s!=null&&s.length?n.isChained?s.filter(n.chainedFilterFn).sort(n.sorterFn):s:HR}internalToggleTreeSubRecords(t,i){const n=this,{storage:s}=n,a=s.indexOf(t),o=n.doIncludeExclude(n.getChildren(t),i);if(n.isFiltered&&i&&t.unfilteredChildren&&n.updateChildrenHiddenState(t),o.length&&a!==!1){if(s.suspendEvents(),i){s.splice(a+1,0,...o);const l={action:"add",isExpand:!0,records:o,index:a+1};n.trigger("add",l),n.trigger("change",l)}else{s.splice(a+1,o.length);const l={action:"remove",isCollapse:!0,records:o,index:a+1};n.trigger("remove",l),n.trigger("change",l)}s.resumeEvents(),n._idMap=null}}updateChildrenHiddenState(t){var i;(i=t.unfilteredChildren)==null||i.forEach(n=>{n.instanceMeta(this.id).hidden=!1,n.isLeaf||this.updateChildrenHiddenState(n)})}doIncludeExclude(t,i,n=[]){const s=this,a=(t==null?void 0:t.length)||0;for(let o=0;o<a;o++){const l=t[o];if(!s.isChained||s.chainedFilterFn(l)){const c=l.instanceMeta(s.id);(i||!c.hidden)&&n.push(l),c.hidden=!i,l.isExpanded(s)&&s.doIncludeExclude(s.getChildren(l),i,n)}}return n}async toggleCollapse(t,i){const n=this,s=n.getById(t),a=s.instanceMeta(n);if(i===void 0&&(i=!a.collapsed),!a.isLoadingChildren&&!s.isLeaf&&s.isExpanded(n)===i){if(n.trigger("beforeToggleNode",{record:s,collapse:i}),a.collapsed=i,a.collapsed)return n.onNodeCollapse(s),!0;{n.onNodeExpand(s);let o=!0;if(!s.isLoaded){a.isLoadingChildren=!0;try{await n.loadChildren(s)}catch(l){a.collapsed=!0,o=!1,n.trigger("loadChildrenException",{record:s,exception:l})}finally{a.isLoadingChildren=!1}}return o}}}onNodeCollapse(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!1)}onNodeExpand(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!0)}transformToTree(t){var i;const{parentIdField:n,idField:s,childrenField:a}=this.modelClass,o=new Map,l=[];for(const c of t){const d=c[n];if(d!=null){let u=o.get(d);u===void 0&&(u=(i=t.find(h=>h[s]===d))!=null?i:null,o.set(d,u)),u&&(u[a]||(u[a]=[]),u[a].push(c))}else l.push(c)}return l}treeify(t,i,n=!1){const{length:s}=t,a=[],o={};let l,c;for(l=0;l<s;l++){if(!t[l].call){const u=t[l];t[l]=h=>h[u]}a[l]=new Map}this.rootNode.traverse(u=>{if(c=null,u.isLeaf){for(l=0;l<s;l++){const h=(c==null?void 0:c.path)||"",f=a[l],g=t[l](u),m=`${h+g}/`,p=L.makeValidDomId(`generated_${m}`,"_"),v=f.get(p)||f.set(p,{id:p,key:g,path:m,expanded:!0,readOnly:!0,children:[],generatedParent:!0}).get(p);c&&!c.children.includes(v)&&c.children.push(v),c=v}c.children.push(u)}},!0),a.forEach(u=>u.forEach((h,f,g)=>{i==null||i(h),n&&(h=this.createRecord(h),g.set(f,h))})),o.children=[...a[0].values()];const d=u=>{u.children&&(u.children.sort((h,f)=>{if(h.isLeaf){let g;for(let m=0;!g&&m<s;m++){const p=t[m](h),v=t[m](f);g=p<v?-1:v>p?1:0}return g}else return typeof h.key=="string"||typeof f.key=="string"?h.key.localeCompare(f.key,void 0,{numeric:!0}):h.key<f.key?-1:h.key>f.key?1:0}),u.children.forEach(d))};return d(o),o}treeifyFlatData(t){const{childrenField:i,parentIdField:n}=this.modelClass;let s=!1,a=!0;for(const o of t){if(o.isModel||Array.isArray(o[i])){a=!1;break}o[n]!=null&&(s=!0)}return a&&s&&(t=this.transformToTree(t)),t}async indent(t){const i=this;if(t=Array.isArray(t)?t:[t],t=t.filter(n=>{let s=!!n.previousSibling;for(;s&&!n.isRoot;)s=!t.includes(n.parent),n=n.parent;return s}),t.length&&i.trigger("beforeIndent",{records:t})!==!1){t.sort((n,s)=>Vt.compare(n.wbsCode,s.wbsCode)),i.beginBatch();for(const n of t){const s=n.previousSibling;s.appendChild(n),i.toggleCollapse(s,!1)}i.endBatch(),i.trigger("indent",{records:t}),i.trigger("change",{action:"indent",records:t})}}async outdent(t){const i=this;if(t=Array.isArray(t)?t:[t],t=t.filter(n=>{const{parent:s}=n;let a=s&&!s.isRoot;for(;a&&!n.isRoot;)a=!t.includes(s),n=n.parent;return a}),t.length&&i.trigger("beforeOutdent",{records:t})!==!1){t.sort((n,s)=>Vt.compare(n.wbsCode,s.wbsCode)),i.beginBatch();for(const n of t){const{parent:s}=n,a=s.children.slice(s.children.indexOf(n)+1);s.parent.insertChild(n,s.nextSibling),n.appendChild(a),i.toggleCollapse(n,!1)}i.endBatch(),i.trigger("outdent",{records:t}),i.trigger("change",{action:"outdent",records:t})}}},R(r,"$name","StoreTree"),R(r,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:re.checkVersion("core","6.0","<")}),r},qn=class{static preWalk(e,r,t){const i=[e];let n,s;for(;i.length;)n=i.pop(),t(n),s=r(n),s&&i.push.apply(i,s.slice().reverse())}static preWalkWithParent(e,r,t){const i=[{node:e,parent:null}];for(;i.length;){const{parent:n,node:s}=i.pop();t(n,s);const a=r(s);Array.isArray(a)&&i.push(...a.slice().reverse().map(o=>({node:o,parent:s})))}}static preWalkUnordered(e,r,t){const i=[e];let n,s;for(;i.length;)n=i[i.length-1],t(n),s=r(n),s?i.splice(i.length-1,1,...s):i.length=i.length-1}static postWalk(e,r,t){const i=new Map,n=[e];let s,a;for(;n.length;)s=n[n.length-1],i.has(s)?(t(s),n.pop()):(a=r(s),a&&n.push(...a.slice().reverse()),i.set(s,s))}static prePostWalk(e,r,t,i){const n=new Map,s=[e];let a,o;for(;s.length;)a=s[s.length-1],n.has(a)?(i(a),s.pop()):(t(a),o=r(a),o&&s.push(...o.slice().reverse()),n.set(a,a))}};qn._$name="WalkHelper";var bb=e=>class extends(e||F){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null}}syncDataset(t){var i;const n=this,{storage:s}=n,a=(i=n.shouldSyncDataset)==null?void 0:i.call(n,{data:t});if(a===!1)return;n.isSyncingDataOnLoad=!0;const{toAdd:o,toRemove:l,toMove:c,updated:d,ids:u}=n.tree?n.syncTreeDataset(t,a):n.syncFlatDataset(t,a);let{threshold:h}=n.syncDataOnLoad,f=!1;if(h&&(typeof h=="string"&&(h=parseInt(h,10)/100*n.count),f=o.length+l.length+c.length+d.length>h),n.tree){if(o.length&&n.add(o,f).forEach(p=>p.clearParentId()),c.length)for(const{parent:m,node:p,index:v}of c)n.getById(m.id).insertChild(p,v);n.remove(l,f)}else f&&n.suspendEvents(),n.remove(l),n.add(o),f&&n.resumeEvents();h&&!f&&d.forEach(({record:m,toSet:p,wasSet:v})=>n.onModelChange(m,p,v)),n.acceptChanges();const g={added:o,removed:l,updated:d,thresholdSurpassed:f};if(n.isFiltered&&!n.remoteFilter&&n.filter({silent:n.isRemoteDataLoading}),n.isGrouped)n.group(null,null,!1,!0,n.isRemoteDataLoading);else if(n.isSorted)n.remoteSort?s.replaceValues({values:s.values.sort(n.createSorterFn(n.sorters)),silent:!0}):n.sort();else if(!n.tree)s.values.some((m,p)=>m.id!==u[p])&&(s.replaceValues({values:s.values.sort((m,p)=>u.indexOf(m.id)-u.indexOf(p.id)),silent:!0}),!f&&n.afterPerformSort());else{let m=!1,p=0;qn.preWalk(n.rootNode,v=>Array.isArray(v.children)&&!m?v.children:null,v=>{v.id!==u[p++]&&(m=!0)}),m&&(n.sort((v,y)=>u.indexOf(v.id)-u.indexOf(y.id),void 0,void 0,!0),n.clearSorters(!0),!f&&n.afterPerformSort())}f&&n.trigger("refresh",{action:"batch",data:t,records:s.values,syncInfo:g}),n.isSyncingDataOnLoad=!1,n.trigger("loadSync",g)}syncFlatDataset(t,i){if(!t)return{toRemove:this.records};const n=this,{idField:s,allFields:a}=n.modelClass,o=[],l=[],c=[],d={},u=[],h=Array.isArray(i),{threshold:f,keepMissingValues:g}=n.syncDataOnLoad;let m=0;if(t.forEach(p=>{var v;p=p.isModel?p.data:p;const y=p[s],S=n.getById(y);if(!h||i.includes(y))if(S){if(((v=n.shouldSyncRecord)==null?void 0:v.call(n,{record:S,data:p}))!==!1){if(g===!1)for(const w of a)!(w.dataSource in p)&&w.dataSource in S.data&&(p[w.dataSource]=w.defaultValue);const D=S.set(p,null,!!f);D&&c.push({record:S,wasSet:D,toSet:p})}}else l.push(n.processRecord(n.createRecord(p)));S&&m++,d[y]=1,u.push(y)}),m<n.storage.totalCount)if(i)for(const p of i)d[p]||o.push(n.getById(p));else n.forEach(p=>{d[p.id]||o.push(p)});return{toAdd:l,toRemove:o,toMove:[],updated:c,ids:u}}syncTreeDataset(t){if(!t)return{toRemove:this.records};const i=this,{idField:n,parentIdField:s,childrenField:a,allFields:o}=i.modelClass,{keepMissingValues:l,threshold:c}=i.syncDataOnLoad,d=[],u=[],h=[],f=[],g=new Set,m=[];return i.transformFlatData&&(t=i.treeifyFlatData(t)),qn.preWalkWithParent({isRoot:!0,id:i.rootNode.id,children:t},p=>p.children,(p,v)=>{var y;if(p){const{id:S,node:D}=i.resolveSyncNode(v);if(D){if(((y=i.shouldSyncRecord)==null?void 0:y.call(i,{record:D,data:v}))!==!1){let w;const E=D.children;if(E!==!0&&v[a]===!0&&(D.clearChildren(),D.data[a]=D.children=!0,delete v[a],i.toggleCollapse(D,!0),w=!0),D.parent.id!==p[n]&&h.push({node:D,parent:p,index:p[a].indexOf(v)}),l===!1)for(const M of o)M.name!=="parentId"&&!(M.dataSource in v)&&M.dataSource in D.data&&(v[M.dataSource]=M.defaultValue);const x=D.set(v,null,!!c);x?f.push({record:D,wasSet:x,toSet:v}):w&&D.signalNodeChanged({[a]:{value:!0,oldValue:E}})}}else v[s]=p[n],u.push({...v,...Array.isArray(v[a])?{children:[]}:void 0});g.add(D),m.push(S)}}),g.length!==t.length&&i.traverse(p=>{g.has(p)||d.push(p)}),{toAdd:u,toRemove:d,toMove:h,updated:f,ids:m}}resolveSyncNode(t){const i=t[this.modelClass.idField],n=this.getById(i);return{id:i,node:n}}},Cb=Symbol("STM_PROP"),Sb=e=>class extends(e||F){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[Cb]}set stm(t){var i;const n=this;n.stm!==t&&((i=n.stm)!=null&&i.hasStore(n)&&n.stm.removeStore(n),n[Cb]=t,n.stm&&!n.stm.hasStore(n)&&n.stm.addStore(n))}add(t,i=!1,n={}){let s;const{stm:a}=this;return!this.tree&&(a!=null&&a.enabled)?(s=super.add(t,i),s!=null&&s.length&&a.onStoreModelAdd(this,s,i)):s=super.add(t,i,n),s}insert(t,i,n=!1){let s;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const o=(Array.isArray(i)?i:[i]).reduce((l,c)=>{const d=c instanceof ae?this.indexOf(c):void 0;return d!==void 0&&d!==-1&&l.set(c,d),l},new Map);s=super.insert(t,i),s!=null&&s.length&&(t=this.indexOf(s[0]),a.onStoreModelInsert(this,t,s,o,n))}else s=super.insert(t,i,n);return s}remove(t,i=!1,n){let s;const{stm:a}=this;if(!this.tree&&(a!=null&&a.enabled)){const l=(Array.isArray(t)?t:[t]).map(c=>this.getById(c)).filter(c=>!!c).reduce((c,d)=>{const u=this.indexOf(d);return u!==void 0&&u!==-1&&c.set(d,u),c},new Map);s=super.remove(t,i,n),s!=null&&s.length&&a.onStoreModelRemove(this,s,l,i)}else s=super.remove(t,i,n);return s}removeAll(t){const{stm:i}=this;let n;if(i!=null&&i.enabled){const{tree:s,rootNode:a,allRecords:o}=this,l=o.length,c=s?a.children.slice():o.slice();n=super.removeAll(t),l&&this.count===0&&i.onStoreRemoveAll(this,c,t)}else n=super.removeAll(t);return n}beforeApplyChangeset(){const{stm:t,crudManager:i}=this;let n=!1;return!(i!=null&&i.applyingChangeset)&&(t!=null&&t.enabled)&&(n=!0,t.isRecording&&t.stash(),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),n}applyChangeset(t,i,n,s,a){const o=this.beforeApplyChangeset(),l=super.applyChangeset(t,i,n,s,a);return this.afterApplyChangeset(o),l}afterApplyChangeset(t){if(t){const{stm:i}=this;this.ignoreRemoteChangesInSTM?i.enable():i.stopTransaction(),i.applyStash()}}},VR={splice:1,clear:1},NR={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},Ch=(e,r)=>(r=r||!1,typeof r=="boolean"&&(r={includeFilteredOutRecords:r,includeCollapsedGroupRecords:!1}),r||NR),ee=class extends F.mixin(ge,Gn,Ae,sh,Xl,ob,ab,sb,db,ub,fb,gb,lb,pb,vb,yb,Sb,bb,cb){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:ae,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){const r=this;Object.assign(r,{added:new Ql,removed:new Ql,modified:new Ql,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=T.assign({id:e.storeId},e)),super.construct(e),r.initRelations()}static from(e,r={},t=null){return e&&!e.isStore&&(typeof e=="string"?e=ee.getStore(e):(Array.isArray(e)&&(t&&(e=e.map(i=>i.isModel?i:t(i))),e=T.assign({},r,{data:e})),e=new ee(e))),e}doDestroy(){var e,r,t,i;const n=this,s=n.registeredRecords;for(let a=s.length-1,o;a>=0;a--)o=s[a],o!=null&&o.isDestroyed||o.unjoinStore(n);(e=n._storage)==null||e.destroy(),(t=(r=n.stm)==null?void 0:r.removeStore)==null||t.call(r,n),n.isChained||(i=n.rootNode)==null||i.destroy(),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const r=this;e!=null&&e.isCollection?r._storage=e:r._storage=new Mt(e),r._storage.autoFilter=r.reapplyFilterOnAdd,r._storage.autoSort=r.reapplySortersOnAdd;for(const t of r._storage)t.joinStore(r);r._storage.ion({change:"onDataChange",thisObj:r})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const r=this;if(((e=r._allRecords)==null?void 0:e.generation)!==r.storage.generation){if(r.isTree){const t=r.collectDescendants(r.rootNode,void 0,void 0,{unfiltered:!0}).all;r.rootVisible&&t.unshift(r.rootNode),r._allRecords=t}else r._allRecords=r.isGrouped?r.collectGroupRecords():r.storage.allValues;r._allRecords.generation=r.storage.generation}return r._allRecords}getAllDataRecords(e){return this.isGrouped?this.collectGroupRecords(e,!1):e?this.storage.allValues:this.storage.values}onIsCreatingToggle(e,r){const t=this,i=e.isPersistable&&!r;t.added[i?"add":"remove"](e),i&&(t.trigger("addConfirmed",{record:e}),t.autoCommit&&t.doAutoCommit())}joinRecordsToStore(e){const{allCount:r}=this;for(let t=0;t<e.length;t++){const i=e[t];i.setData("parentIndex",r+t-e.length),i.joinStore(this)}}onDataChange({source:e,action:r,added:t,removed:i,replaced:n,oldCount:s,items:a,from:o,to:l}){const c=this,d=VR[r],u=d&&(t==null?void 0:t.length),h=d&&(i==null?void 0:i.length);let f,g;if(c._idMap=null,u&&c.joinRecordsToStore(t),n==null||n.forEach(([m,p])=>{m.unjoinStore(c,!0),p.joinStore(c)}),super.onDataChange(...arguments),!c.isTree){if(u){for(const m of t)c.removed.includes(m)?c.removed.remove(m):m.isLinked||c.added.add(m);f=!c.remoteFilter&&c.filtered&&c.reapplyFilterOnAdd,f&&c.filter({silent:!0}),g=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,g&&c.sort(null,null,!1,!0)}if(h){for(const m of i)m.cancelBatch(),m.unjoinStore(c),c.added.includes(m)?c.added.remove(m):!m._undoingInsertion&&!m.isCreating&&!m.isLinked&&c.removed.add(m);c.modified.remove(i),f=!c.remoteFilter&&c.filtered,f&&c.filter({silent:!0})}}switch(r){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(u){c.updateDependentStores("add",t);const m=t.reduce((y,S)=>{const{previousIndex:D}=S.meta;return D>-1&&D<y&&(y=D),y},t[0].meta.previousIndex),p=e.indexOf(t[0],!e.autoFilter),v={records:t,index:p};m>-1&&(v.oldIndex=m),c.trigger("add",v),c.trigger("change",Object.assign({action:"add"},v)),f&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:s,records:c.storage.allValues}),g&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}i.length&&(c.updateDependentStores("remove",i),c.trigger("remove",{records:i}),c.trigger("change",{action:"remove",records:i})),n.length&&(c.trigger("replace",{records:n,all:c.records.length===n.length}),c.trigger("change",{action:"replace",replaced:n,all:c.records.length===n.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":{const m=Math.min(o,l),p=Math.min(c.storage.allValues.length-1,Math.max(o,l));for(let v=c.storage.allValues,y=m;y<=p;y++)v[y].setData("parentIndex",y);c.trigger("move",{record:a[0],records:a,from:o,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:r,record:a[0],records:a,from:o,to:l});break}}}onDataReplaced(e,r){var t;const i=this,{storage:n}=i,s=n.allValues,a=i.sorters.length>0;for(let l=0;l<s.length;l++)s[l].joinStore(i);if(!i.remoteFilter&&i.isFiltered&&i.filter({silent:!0}),i.remoteSort?i.isGrouped&&n.replaceValues({...i.prepareGroupRecords(),silent:!0}):(i.isGrouped&&i.group(null,null,!1,!a,!0),a&&i.sort(null,null,!1,!0)),!i.useRawData.disableDuplicateIdCheck){const{idMap:l}=i;if(Object.keys(l).length<n.values.length){const c=[];throw n.values.forEach(d=>l[d.id]?delete l[d.id]:c.push(d)),new Error(`Id collision on ${c.map(d=>d.id)}`)}}const o={action:e,data:r,records:n.values};i.updateDependentStores(e,o.records),(t=i.afterLoadData)==null||t.call(i),i.isRemoteDataLoading||i.trigger("refresh",o),i.trigger("change",o)}onModelChange(e,r,t,i,n){const s=this,a={record:e,records:[e],changes:t,batch:e.batching!=null,fromRelationUpdate:n},o=e.ignoreBag||e.isLinked?!1:s.updateModifiedBagForRecord(e);if(s.storage.onItemMutation(e,t),"id"in t){const{oldValue:l,value:c}=r.id;s.updateDependentRecordIds(l,c),s.onRecordIdChange({record:e,oldValue:l,value:c})}if(!i){if("id"in t){const{oldValue:l,value:c}=r.id;s.trigger("idChange",{store:s,record:e,oldValue:l,value:c})}s.onUpdateRecord(e,t),s.trigger("update",a),s.trigger("change",Object.assign({action:"update"},a))}s.autoCommit&&o&&s.doAutoCommit()}updateModifiedBagForRecord(e){const r=this;let t=!1;return e.isModified?!r.modified.includes(e)&&!r.added.includes(e)&&e.isPartOfStore(r)&&!e.isAutoRoot&&(e.isPhantom?r.added.add(e):r.modified.add(e),t=!0):r.modified.remove(e),t}get idMap(){const e=this,r=!e._idMap,t=e._idMap||(e._idMap={});if(r){const i=e.storage.values;for(let n,s=0,a=0;s<i.length;s++)n=i[s],t[n.id]={index:s,visibleIndex:a,record:n},n.isSpecialRow||a++;if(e.isFiltered)for(let n=0,s=e.storage._values.length;n<s;n++){const a=e.storage._values[n];a.id in t?t[a.id].unfilteredIndex=n:t[a.id]={index:-1,unfilteredIndex:n,record:a}}}return t}changeModelClass(e){const{fields:r}=this;this.originalModelClass=e;let t=e;if(r!=null&&r.length){class i extends e{static get fields(){return r}}t=i}else if(!this.preventSubClassingModel){class i extends e{}t=i}return t.initClass(),t}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,r){return super.changeId(e!==!0&&e,r)}updateId(e,r){const t=ee.getById(e);t&&ee.unregisterInstance(t),super.updateId(e,r)}generateAutoId(){return ee.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,r){if(e instanceof ee)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let t;const i=e.map(n=>(n instanceof ae?t=n.constructor:typeof n=="string"&&(n={text:n}),n));if(!t){class n extends ae{}t=n}e={autoCreated:!0,data:i,modelClass:t,allowNoId:!0},r||(r=ee)}if(r)return new r(e)}static get stores(){return ee.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var r;const t=this,i=t._rootNode;e!==i&&(i&&t.clear(!0),e instanceof ae?(e.instanceMeta(t).collapsed=!1,t._rootNode=e):t._rootNode=e=new t.modelClass(Object.assign({expanded:!0,[t.modelClass.idField]:`${t.id}-rootNode`},e),t,null,!0),t._tree=!0,e.isRoot=!0,e.joinStore(t),((r=e.children)!=null&&r.length||t.rootVisible)&&(e.isLoading=!0,t.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),t.trigger("rootChange",{oldRoot:i,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){const r=this,{idField:t,childrenField:i}=r.modelClass;if(r.transformFlatData&&(e==null?void 0:e.length)>0&&!Object.isExtensible(e[0])&&(r.useRawData=r.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=T.clone(e)),r.getConfig("plugins"),r.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=T.transformNamedObjectToArray(e,t)),r.tree=!r.isChained&&(r.tree||!!(r.autoTree&&(e!=null&&e.some(n=>n[i])))),e&&(r.remoteSort||r.remoteFilter))for(let n=0;n<e.length;n++)e[n]._remoteSortIndex=n;if(!r.syncDataOnLoad||!r._data){if(r._data=e,r.tree){r.transformFlatData&&(e=r.treeifyFlatData(e));const n=r.rootNode;if(n.isLoading=!0,r._data.forEach(s=>delete s.parentId),r.clear(!0),n.appendChild(e),r.updateDependentStores("dataset",[n]),n.isLoading=!1,e.length===0){const s={action:"dataset",data:[],records:[]};r.trigger("refresh",s),r.trigger("change",s)}else r.isFiltered&&r.filter()}else r.loadData(e);r.added.clear(),r.removed.clear(),r.modified.clear()}else r.syncDataset(e)}loadData(e,r="dataset"){var t,i;const n=this,{storage:s,allowNoId:a}=n,o=n.modelClass.fieldMap.id.dataSource,l=n.find(d=>d.isCreating);l&&s.values.splice(n.records.indexOf(l),1);let c=n.verifyNoGeneratedIds;if(n.removeHeadersAndFooters(n.storage.values),n._idMap=null,n.oldIdMap={},e){if(!(e[0]instanceof ae)){n.modelClass.exposeProperties(e[0]);const u=e.length,h=new Array(u);for(let f=0;f<u;f++){const g=e[f];if(!a&&g[o]==null)throw new Error(`Id required but not found on row ${f}`);c&&((i=(t=g[o])==null?void 0:t.startsWith)!=null&&i.call(t,"_generated"))&&(console.warn(`Generated id found in data: ${g[o]}. Generated ids are temporary and should be replaced with real ids by the backend`),c=!1),h[f]=n.processRecord(n.createRecord(g,!0),!0),h[f].setData("parentIndex",f)}n.clear(!0),s.replaceValues({values:h,isNewDataset:!0,silent:!0})}else n.clear(!0),s.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});l&&s.values.push(l),n._data=e,n.onDataReplaced(r,e)}else n.clear(!0),n._data=null;n.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,r,t=!0){return(t?this.storage.allValues:this.storage.values).slice(e,r)}createRecord(e,r=!1,t=!1){return new this.modelClass(e,this,null,r,!1,t)}processRecord(e,r=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:r,value:t}){const i=this,n=i._idMap,{idRegister:s,oldIdMap:a}=i;if(i.storage._indicesInvalid=!0,a[r]=e,n&&!n[t]){const o=n[r];delete n[r],n[t]=o}i.added.changeId(r,t),i.removed.changeId(r,t),i.modified.changeId(r,t),delete s[r],s[t]=e,e.index=i.storage.indexOf(e)}onUpdateRecord(e,r){const t=this,{internalId:i}=r,{internalIdRegister:n}=t;i&&(this.storage._indicesInvalid=!0,delete n[i.oldValue],n[i.value]=e),t.reapplyFilterOnUpdate&&t.isFiltered&&t.filter()}get useRawData(){return this._useRawData}set useRawData(e){e===!0?this._useRawData={enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:this._useRawData=e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-(((e=this.groupRecords)==null?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,r=!1){return this.storage.getAt(e,r)}register(e){const r=this;if(!r.useRawData.disableDuplicateIdCheck){const t=r.isTree&&r.idRegister[e.id];if(t&&t!==e)throw new Error(`Id collision on ${e.id}`)}r.idRegister[e.id]=e,r.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(e!=null&&e.isModel){const r=e;return r.hasLinks&&!this.storage.allValues.includes(r)?r.$links.find(t=>this.storage.allValues.includes(t)):r}return this.idRegister[e]}isAvailable(e){const r=this.getById(e);return r&&this.storage.includes(r)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?this.idRegister[ae.asId(e)]!=null:this.indexOf(e)>-1}indexOf(e,r=!1,t=!1){if(e!=null&&e.isModel&&!e.stores.includes(this.$store||this)){const s=e.$links.find(a=>this.storage.allValues.includes(a));return s?this.indexOf(s,r):-1}if(this.isTree)return(t?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const i=ae.asId(e);if(i==null)return-1;const n=this.idMap[i];return n?n[r?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,r=!1){const t=this,i=[],n={};let s;return t.forEach(a=>{if(!a.isSpecialRow&&!a.isRoot){s=a.get(e);const o=s instanceof Date?s.getTime():s;n[o]||(i.push(s),n[o]=1)}},t,r),i}getValueCount(e,r){let t=0;return this.forEach(i=>{T.isEqual(i.get(e),r)&&t++}),t}set json(e){typeof e=="string"&&(e=L.safeJsonParse(e)),this.data=e}get json(){return L.safeJsonStringify(this)}get formattedJSON(){return L.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map(e=>e.toJSON())}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){var r;const t=[];return this.tree?(r=this.rootNode.children)==null||r.forEach(i=>t.push(i.getCurrentConfig(e))):this.forEach(i=>t.push(i.getCurrentConfig(e))),t}getCurrentConfig(e){var r;const t=super.getCurrentConfig(e),{state:i}=this;return t&&(t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,((r=t.modelClass)==null?void 0:r.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,i&&Object.assign(t,i)),t}forEach(e,r=this,t){const i=this,n=(s,a)=>{if(!s.isRoot&&!s.isSpecialRow)return e.call(r,s,a)};if(t=Ch(i,t),i.isTree)i.isChained&&(t={...t,sorterFn:i.sorterFn}),i.rootNode.traverseWhile(n,!1,t);else{const s=t.includeFilteredOutRecords?i.storage.allValues:i.storage.values;if(i.isGrouped&&t.includeCollapsedGroupRecords)for(let a=0;a<s.length;a++){const o=s[a],l=t.includeFilteredOutRecords?o.unfilteredGroupChildren:o.groupChildren;if(l&&o.meta.collapsed===!0)for(let c=0;c<l.length;c++){const d=l[c];if(n(d,c)===!1)return}else if(n(o,a)===!1)return}else for(let a=0;a<s.length;a++)if(n(s[a],a)===!1)return}}map(e,r=this){return this.storage.values.map(e,r)}every(e,r=this,t){return this.storage[t?"allValues":"values"].every(e,r)}reduce(e,r=[],t=this){return t!==this&&(e=e.bind(t)),this.storage.values.reduce(e,r,t)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,r=this.rootNode,t=r===this.rootNode,i){const n=this;if(i=Ch(n,i),n.isTree){if(typeof r=="boolean"&&(t=r,r=n.rootNode),n.isChained){const s=e;e=a=>{n.chainedFilterFn(a)&&s(a)}}r.traverse(e,t,i)}else n.forEach(s=>s.traverse(e,!1,i),n,i)}traverseWhile(e,r=this.rootNode,t=r===this.rootNode,i){const n=this;if(i=Ch(n,i),n.isTree){if(typeof r=="boolean"&&(t=r,r=n.rootNode),n.isChained){const s=e;e=a=>{n.chainedFilterFn(a)&&s(a)}}r.traverseWhile(e,t,i)}else for(const s of n.storage)if(s.traverse(e,!1,i)===!1)break}getNext(e,r=!1,t=!1){const i=this,n=i.storage.values;let s=i.indexOf(e);if(s>=n.length-1)if(r)s=-1;else return null;const a=n[s+1];return t&&a&&a.isSpecialRow?i.getNext(n[s+1],r,!0):a}getPrev(e,r=!1,t=!1){const i=this,n=i.storage.values;let s=i.indexOf(e);if(s===0)if(r)s=n.length;else return null;const a=n[s-1];return t&&a&&a.isSpecialRow&&s>0?i.getPrev(n[s-1],r,!0):a}getAdjacent(e,r=!0,t=!1,i=!1){return r?this.getNext(e,t,i):this.getPrev(e,t,i)}getNextLeaf(e,r=!1){const t=this,i=t.leaves,n=t.getById(e);let s=i.indexOf(n);if(s>=i.length-1)if(r)s=-1;else return null;return i[s+1]}getPrevLeaf(e,r=!1){const t=this,i=t.leaves,n=t.getById(e);let s=i.indexOf(n);if(s===0)if(r)s=i.length;else return null;return i[s-1]}getAdjacentLeaf(e,r=!0,t=!1){return r?this.getNextLeaf(e,t):this.getPrevLeaf(e,t)}};ee.initClass(),ee._$name="Store";var zR=(e,r)=>(Array.isArray(r[1])?r[1].forEach(t=>e.push(encodeURIComponent(r[0])+"="+encodeURIComponent(t))):e.push(encodeURIComponent(r[0])+"="+encodeURIComponent(r[1])),e),ec=Promise.resolve(),Ba=e=>String(e).padStart(2,"0"),WR=e=>`${e.getFullYear()}-${Ba(e.getMonth()+1)}-${Ba(e.getDate())}T${Ba(e.getHours())}:${Ba(e.getMinutes())}:${Ba(e.getSeconds())}.${e.getMilliseconds()}`,ut=class extends ee{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(()=>{})}get isLoading(){return this._isLoading?2:this.loadTriggerPromise?1:!1}get isCommitting(){return!!this.commitPromise}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...r){const t=e.includes("?"),i=Object.entries(Object.assign({},...r)).reduce(zR,[]).join("&");return i?(t?"&":"?")+i:""}async performSort(e){const r=this;if(r.remoteSort&&!r.isRemoteDataLoading){r.isRemoteDataLoading=!0;const t=await r.internalLoad({},"",i=>{r.data=i.data,r.afterPerformSort(e)});return r.isRemoteDataLoading=!1,t}else super.performSort(e)}async performFilter(e){var r;const t=this;if(t.remoteFilter){(r=t.loadingPromise)==null||r.abort(),t.isRemoteDataLoading=!0;const i=t.count,{filters:n}=t;t.currentPage=1;const s=await t.internalLoad({},"",a=>{t.data=a.data,a=e?null:{action:"filter",filters:n,oldCount:i,records:t.storage.values},t.afterPerformFilter(a),t.trigger("refresh",a)});return t.isRemoteDataLoading=!1,s}else super.performFilter(e)}encodeFilterParams(e){const r=[];for(const{property:t,operator:i,value:n,caseSensitive:s}of e)r.push({field:t,operator:i,value:n,caseSensitive:s});return JSON.stringify(r,function(t,i){return t===""?i:this[t]instanceof Date?WR(this[t]):i})}encodeSorterParams(e){return JSON.stringify(e.filter(r=>!r.sortFn).map(r=>r))}buildReadUrl(){const{readUrl:e}=this;return this.restfulFilter&&this.filters.count?(e.endsWith("/")?e:e+"/")+this.filters.first.value:e}internalLoad(e,r,t,i=0){e=T.assign({},this.params,e);const n=this,s=n.buildReadUrl(),a={action:"read"+r,params:e,url:s};if(!s)throw new Error("No load url specified");if(n.trigger("beforeLoad"+r,a)===!1)throw!1;return n.loadArgs=[s,a,e,r,t],i===!1?new Promise((o,l)=>n.sendLoadRequest(o,l)):n.loadTriggerPromise||(n.loadTriggerPromise=new Promise((o,l)=>{n.setTimeout({delay:i,fn:"sendLoadRequest",args:[o,l],cancelOutstanding:!0})}))}async sendLoadRequest(e,r){const t=this,[i,n,s,a,o]=t.loadArgs;if(t.loadTriggerPromise=null,i){if(t._isLoading=!0,t.trigger(`load${a}Start`,n),t.trigger("beforeRequest",n),t.filterParamName&&t.isFiltered&&(s[t.filterParamName]=t.encodeFilterParams(t.filters.values)),t.remoteSort&&t.isSorted&&(s[t.sortParamName]=t.encodeSorterParams(t.groupers?t.groupers.concat(t.sorters):t.sorters)),t.isPaged){if(!(t.pageParamName in s||t.pageStartParamName in s)){const c=Math.min(t.currentPage||1,t.allCount?t.lastPage:1/0);t.pageParamName?s[t.pageParamName]=c:s[t.pageStartParamName]=(c-1)*t.pageSize}s[t.pageSizeParamName]=t.pageSize}const l={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(l.method=t.httpMethods.read,n.body&&(l.body=JSON.stringify(n.body)));try{const c=t.loadingPromise=mr.get(n.url+t.buildQueryString(n.url,s),T.assign(l,t.fetchOptions)),d=await c,u=d.parsedJson,h=Array.isArray(u),f=h||u&&T.getPath(u,t.responseSuccessProperty)!==!1,g=h?null:T.getPath(u,t.responseTotalProperty);if(t.isDestroyed)return;if(t.loadingPromise=null,t._isLoading=!1,n.response=d,n.json=u,f){if(g!=null&&(t.remoteTotal=parseInt(g,10)),t.isPaged)if(t.remoteTotal>=0){const m=t.pageParamName?s[t.pageParamName]:s[t.pageStartParamName]/t.pageSize+1;t.currentPage=Math.min(m,t.lastPage)}else throw new Error("A paged store must receive its responseTotalProperty in each data packet");n.data=h?u:T.getPath(u,t.responseDataProperty),await o(n),!t.isDestroyed&&t.trigger("load"+a,n),e(n)}else Object.assign(n,{exception:!0,exceptionType:"server",error:u==null?void 0:u.error}),!t.isDestroyed&&t.trigger("exception",n),r(n);!t.isDestroyed&&t.trigger("afterRequest",n)}catch(c){t._isLoading=!1,n.exception=!0,c instanceof Response?(n.exceptionType=c.ok?"server":"network",n.response=c,n.error=c.error):(n.exceptionType="server",n.error=c),!t.isDestroyed&&t.trigger("exception",n),r(n),!t.isDestroyed&&t.trigger("afterRequest",n)}}}async load(e){const r=this;return r.isPaged?r.loadPage(r.currentPage||1,e):r.internalLoad(e,"",t=>{r.data=t.data})}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",r=>{r.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=r.data,e.processChildren(e.stores)},!1):this.immediatePromise}async loadPage(e,r){this.allCount&&(e=Math.min(e,this.lastPage));const t=this,i=t.pageParamName?{[t.pageParamName]:e}:{[t.pageStartParamName]:(e-1)*t.pageSize};return i[t.pageSizeParamName]=t.pageSize,t.internalLoad(T.assign(i,r),"Page",n=>{t.loadData(n.data,"pageLoad")})}async nextPage(e){const r=this;return r.isPaged&&r.currentPage!==r.lastPage?r.loadPage(r.currentPage+1,e):ec}async previousPage(e){return this.isPaged&&this.currentPage!==1?this.loadPage(this.currentPage-1,e):ec}async commit(){const e=this,{changes:r}=e,t=[];if(e.commitPromise)return!1;if(!r)return e.modified.count&&(e.modified.forEach(i=>i.clearChanges(!0,!1)),e.modified.clear()),ec;if(e.trigger("beforeCommit",{changes:r})!==!1){[...r.added,...r.modified,...r.removed].forEach(s=>s.meta.committing=!0),e.trigger("commitStart",{changes:r});const i={action:"commit",exception:!1,changes:r};let n=e.commitRemoved(i);return n&&t.push(n),n=e.commitAdded(i),n&&t.push(n),n=e.commitModified(i),n&&t.push(n),t.length?(n=t.length===1?t[0]:Promise.all(t),e.commitPromise=new Promise((s,a)=>{n.then(()=>{e.commitPromise=null,i.exception?(e.trigger("exception",i),a(i)):(e.trigger("commit",{changes:r}),s(i))}).catch(()=>{e.commitPromise=null,a(i)})})):(e.modified.forEach(s=>s.clearChanges(!0,!1)),e.modified.clear(),e.added.forEach(s=>s.clearChanges(!0,!1)),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:r}),ec)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch(e=>{const{response:r}=e;if(!(r&&(r.ok&&r.parsedJson||[500,404].includes(r.status))))throw e})}commitAdded(e){const r=this,t=r.added,i={action:"create",params:r.params};return t.count&&r.createUrl?new Promise(n=>{const s=t.values.map(c=>c.persistableData);e.create=i,i.body={data:s},r.trigger("beforeRequest",i);let a=i.body;if(r.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(s)),a=c}const o={headers:r.headers,parseJson:!0},l=r.createUrl+r.buildQueryString(r.createUrl,r.params);r.useRestfulMethods&&(o.method=r.httpMethods.create),mr.post(l,a,T.assign(o,r.fetchOptions)).then(c=>{const d=c.parsedJson,u=Array.isArray(d),h=u||d&&d.success!==!1;e.response=c,i.json=d,i.response=c,h?(r.processReturnedData(t.values,u?d:T.getPath(d,r.responseDataProperty)),t.clear(),r.trigger("commitAdded"),r.trigger("refresh",i),n(e)):(t.forEach(f=>f.meta.committing=!1),e.exception=i.exception=!0,e.exceptionType=i.exceptionType="server",r.trigger("exception",i),n(e)),r.trigger("afterRequest",i)}).catch(c=>{t.forEach(d=>d.meta.committing=!1),e.exception=i.exception=!0,c instanceof Response?(e.response=c,i.exceptionType=c.ok?"server":"network",i.response=c,i.error=c.error):(i.exceptionType="server",i.error=c),r.trigger("exception",i),n(e),r.trigger("afterRequest",i)})}):null}commitModified(e){const r=this,{modified:t}=r.changes,i={action:"update",params:r.params},n=t.length&&r.updateUrl?new Promise(s=>{const a=t.map(c=>r.writeAllFields?c.persistableData:c.modificationDataToWrite).filter(c=>!T.isEmpty(c));if(a.length===0){r.modified.clear(),t.forEach(c=>c.meta.committing=!1),s();return}e.update=i,i.body={data:a},r.trigger("beforeRequest",i);let o=i.body;if(r.sendAsFormData){const c=new FormData;c.append("data",JSON.stringify(a)),o=c}const l={headers:r.headers,parseJson:!0};r.useRestfulMethods&&(l.method=r.httpMethods.update),mr.post(r.updateUrl+r.buildQueryString(r.updateUrl,r.params),o,T.assign(l,r.fetchOptions)).then(c=>{const d=c.parsedJson,u=Array.isArray(d),h=u||d&&d.success!==!1;e.response=c,i.json=d,i.response=c,h?(r.processReturnedData(t,u?d:T.getPath(d,r.responseDataProperty),!0),r.modified.clear(),r.trigger("commitModified"),r.trigger("refresh",i),s(e)):(t.forEach(f=>f.meta.committing=!1),e.exception=i.exception=!0,i.exceptionType="server",r.trigger("exception",i),s(e)),r.trigger("afterRequest",i)}).catch(c=>{t.forEach(d=>d.meta.committing=!1),e.exception=i.exception=!0,c instanceof Response?(e.response=c,i.exceptionType=c.ok?"server":"network",i.response=c,i.error=c.error):(i.exceptionType="server",i.error=c),r.trigger("exception",i),s(e),r.trigger("afterRequest",i)})}):null;return!t.length&&r.modified.count&&r.modified.clear(),n}processReturnedData(e,r,t=!1){const i=this,n=i.modelClass,s=n.fieldMap.id.dataSource;r.forEach((a,o)=>{const l=e[o];l.clearChanges(!0,!1),l.syncId(a[s]),Object.assign(e[o].data,n.processData(a,t,i,l))})}commitRemoved(e){const r=this,t=r.removed,i={action:"delete",params:r.params};return t.count&&r.deleteUrl?new Promise(n=>{e.delete=i,i.body={ids:t.map(o=>o.id)},r.trigger("beforeRequest",i);let s=i.body;if(r.sendAsFormData){const o=new FormData;o.append("id",JSON.stringify(s.ids)),s=o}const a={headers:r.headers,parseJson:!0};r.useRestfulMethods&&(a.method=r.httpMethods.delete),mr.post(r.deleteUrl+r.buildQueryString(r.deleteUrl,r.params),s,T.assign(a,r.fetchOptions)).then(o=>{const l=o.parsedJson,c=Array.isArray(l),d=c||l&&l.success!==!1;e.response=o,i.json=l,i.response=o,d?(t.forEach(u=>u.meta.committing=!1),t.clear(),r.trigger("commitRemoved"),r.trigger("refresh",i),n(e)):(t.forEach(u=>u.meta.committing=!1),e.exception=i.exception=!0,i.exceptionType="server",r.trigger("exception",i),n(e)),r.trigger("afterRequest",i)}).catch(o=>{t.forEach(l=>l.meta.committing=!1),e.exception=i.exception=!0,o instanceof Response?(e.response=o,i.exceptionType=o.ok?"server":"network",i.response=o,i.error=o.error):(i.exceptionType="server",i.error=o),r.trigger("exception",i),n(e),r.trigger("afterRequest",i)})}):null}get remoteFilter(){return!!(this.filterParamName||this.restfulFilter)}get remoteSort(){return!!this.sortParamName}};R(ut,"$name","AjaxStore"),ut._$name="AjaxStore";var ze=class{static get(e,r){const t=e._domData||(e._domData={});return r!=null?t[r]:t}static remove(e,r){const{_domData:t}=e,i=t==null?void 0:t[r];return t==null||delete t[r],i}static set(e,r,t){arguments.length===3?(e._domData||(e._domData={}))[r]=t:e._domData=r}static assign(e,r){Object.assign(e._domData||(e._domData={}),r)}};ze._$name="DomDataStore";var wb=()=>{throw new Error("Abstract method call!")},jr=class extends F{get type(){return this.constructor.name}undo(){wb()}redo(){wb()}};jr._$name="ActionBase";var Ze=()=>{throw new Error("Abstract method call!")},Ie=()=>{throw new Error("Method cannot be called at this state!")},si=class extends F{canUndo(e){Ze()}canRedo(e){Ze()}onUndo(e){Ze()}onRedo(e){Ze()}onStartTransaction(e){Ze()}onStopTransaction(e){Ze()}onStopTransactionDelayed(e){Ze()}onRejectTransaction(e){Ze()}onEnable(e){Ze()}onDisable(e){Ze()}onAutoRecordOn(e){Ze()}onAutoRecordOff(e){Ze()}onResetQueue(e){Ze()}onModelUpdate(e){Ze()}onStoreModelAdd(e){Ze()}onStoreModelInsert(e){Ze()}onStoreModelRemove(e){Ze()}onStoreModelRemoveAll(e){Ze()}onModelInsertChild(e){Ze()}onModelRemoveChild(e){Ze()}};si._$name="StateBase";var Pe=Symbol("STATE_PROP"),ai=Symbol("STORES_PROP"),Pt=Symbol("QUEUE_PROP"),sr=Symbol("POS_PROP"),Oe=Symbol("TRANSACTION_PROP"),Zt=Symbol("TRANSACTION_TIMER_PROP"),ar=Symbol("AUTO_RECORD_PROP"),sF=Object.freeze([Pe,ai,Pt,sr,Oe,Zt,ar]),Db=new Map,UR=(e,r)=>{Db.set(e,r)},GR=e=>(typeof e=="string"&&(e=Db.get(e)),e),vr={registerStmState:UR,resolveStmState:GR},tc=(e,r)=>{const{undo:t,redo:i}=r;let n;return t&&!i?n={[Pt]:e[Pt].slice(e.position),[sr]:0}:i&&!t?n={[Pt]:e[Pt].slice(0,e.position)}:n={[Pt]:[],[sr]:0},[n,()=>{e.notifyStoresAboutQueueReset(r)}]},YR=class extends si{canUndo(){return!1}canRedo(){return!1}onUndo(){Ie()}onRedo(){Ie()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){Ie()}onAutoRecordOn(){return{[ar]:!0}}onAutoRecordOff(){return{[ar]:!1}}onStartTransaction(){Ie()}onStopTransaction(){Ie()}onStopTransactionDelayed(){Ie()}onRejectTransaction(){Ie()}onResetQueue(e,r){return tc(e,r)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},Eb=new YR,qR=Eb;vr.registerStmState("disabledstate",Eb);var Kn=Symbol("ACTION_QUEUE_PROP"),rc=class extends F{get defaultConfig(){return{title:null}}construct(...e){this[Kn]=[],super.construct(...e)}get queue(){return this[Kn].slice(0)}get length(){return this[Kn].length}addAction(e){this[Kn].push(e)}undo(){const e=this[Kn];for(let r=e.length-1;r>=0;--r)e[r].undo()}redo(){const e=this[Kn];for(let r=0,t=e.length;r<t;++r)e[r].redo()}};rc._$name="Transaction";var xb=class extends si{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,r){let t=e.position;const i=e[Pt],n=Math.max(0,t-r),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];for(;t!==n;){const o=i[--t];o.undo(),a.push(o)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:a})}]};return[{[Pe]:"restoringstate",[sr]:n},s]}onRedo(e,r){let t=e.position;const i=e[Pt],n=Math.min(i.length,t+r),s=()=>{e.notifyStoresAboutStateRestoringStart();const a=[];do{const o=i[t++];o.redo(),a.push(o)}while(t!==n);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:a})}]};return[{[Pe]:"restoringstate",[sr]:n},s]}onEnable(){Ie()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[Pe]:"autoreadystate",[ar]:!0}}onAutoRecordOff(){Ie()}onStartTransaction(e,r){const t=new rc({title:r});return[{[Pe]:"recordingstate",[Oe]:t},()=>{e.notifyStoresAboutStateRecordingStart(t)}]}onStopTransaction(){Ie()}onStopTransactionDelayed(){Ie()}onRejectTransaction(){Ie()}onResetQueue(e,r){return tc(e,r)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},Rb=new xb,ic=Rb;vr.registerStmState("readystate",Rb);var Tb=class extends si{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const r=e[Oe];return e.notifyStoresAboutStateRecordingStop(r,{disabled:!0}),{[Pe]:"disabledstate",[Oe]:null}}onAutoRecordOn(e){return[{[Pe]:"autorecordingstate",[ar]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){Ie()}onStartTransaction(){Ie()}onStopTransaction(e,r){const t=e[Oe],i=e[Pt];let n=e[sr];return t.length&&(!t.title&&!r&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):r&&(t.title=r),i[n]=t,i.length=++n),[{[Pe]:"readystate",[sr]:n,[Oe]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onRejectTransaction(e){const r=e[Oe];return[{[Pe]:"restoringstate",[Oe]:null},()=>(r.length&&r.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(r,{rejected:!0})}])]}onStopTransactionDelayed(){Ie()}onResetQueue(e,r){return tc(e,r)}onModelUpdate(e,r,t,i,n){e[Oe].addAction(e.makeModelUpdateAction(r,t,i,n))}onModelInsertChild(e,r,t,i,n,s){e[Oe].addAction(e.makeModelInsertChildAction(r,t,i,n,s))}onModelRemoveChild(e,r,t,i){e[Oe].addAction(e.makeModelRemoveChildAction(r,t,i))}onStoreModelAdd(e,r,t,i){e[Oe].addAction(e.makeStoreModelAddAction(r,t,i))}onStoreModelInsert(e,r,t,i,n,s){e[Oe].addAction(e.makeStoreModelInsertAction(r,t,i,n,s))}onStoreModelRemove(e,r,t,i,n){e[Oe].addAction(e.makeStoreModelRemoveAction(r,t,i,n))}onStoreRemoveAll(e,r,t,i){e[Oe].addAction(e.makeStoreRemoveAllAction(r,t,i))}},Mb=new Tb,KR=Mb;vr.registerStmState("recordingstate",Mb);var XR=class extends si{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){Ie()}onRedo(){Ie()}onEnable(){Ie()}onDisable(){Ie()}onAutoRecordOn(){return{[ar]:!0}}onAutoRecordOff(){return{[ar]:!1}}onStartTransaction(){Ie()}onStopTransaction(){Ie()}onStopTransactionDelayed(){Ie()}onRejectTransaction(){Ie()}onQueueReset(){Ie()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},Pb=new XR,ZR=Pb;vr.registerStmState("restoringstate",Pb);var JR=class extends xb{onAutoRecordOn(){Ie()}onAutoRecordOff(){return{[Pe]:"readystate",[ar]:!1}}onStartTransaction(e,r){const t=new rc({title:r});return[{[Pe]:"autorecordingstate",[Oe]:t},()=>{e.notifyStoresAboutStateRecordingStart(t),e.stopTransactionDelayed()}]}onModelUpdate(e,r,t,i){e.startTransaction(),e.onModelUpdate(r,t,i)}onModelInsertChild(e,r,t,i,n){e.startTransaction(),e.onModelInsertChild(r,t,i,n)}onModelRemoveChild(e,r,t,i){e.startTransaction(),e.onModelRemoveChild(r,t,i)}onStoreModelAdd(e,r,t,i){e.startTransaction(),e.onStoreModelAdd(r,t,i)}onStoreModelInsert(e,r,t,i,n,s){e.startTransaction(),e.onStoreModelInsert(r,t,i,n,s)}onStoreModelRemove(e,r,t,i,n){e.startTransaction(),e.onStoreModelRemove(r,t,i,n)}onStoreRemoveAll(e,r,t,i){e.startTransaction(),e.onStoreRemoveAll(r,t,i)}},Ib=new JR,Sh=Ib;vr.registerStmState("autoreadystate",Ib);var QR=class extends Tb.mixin(ge){onDisable(e){const r=e[Oe],t=e[Zt];return t&&this.clearTimeout(t),e.notifyStoresAboutStateRecordingStop(r,{disabled:!0}),{[Pe]:"disabledstate",[Oe]:null,[Zt]:null}}onAutoRecordOn(e){Ie()}onAutoRecordOff(e){const r=e[Zt];return r&&this.clearTimeout(r),{[Pe]:"recordingstate",[ar]:!1,[Zt]:null}}onStopTransaction(e,r){const t=e[Oe],i=e[Zt],n=e[Pt];let s=e[sr];return i&&this.clearTimeout(i),t.length&&(!t.title&&!r&&e.getTransactionTitle?t.title=e.getTransactionTitle(t):r&&(t.title=r),n[s]=t,n.length=++s),[{[Pe]:"autoreadystate",[sr]:s,[Oe]:null,[Zt]:null},()=>{e.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onStopTransactionDelayed(e){let r=e[Zt];return r&&this.clearTimeout(r),r=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[Pe]:wh,[Zt]:r}}onResetQueue(e,r){return tc(e,r)}onRejectTransaction(e){const r=e[Oe],t=e[Zt];return t&&this.clearTimeout(t),[{[Pe]:"restoringstate",[Oe]:null,[Zt]:null},()=>(r.length&&r.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(r,{rejected:!0})}])]}onModelUpdate(e,...r){super.onModelUpdate(e,...r),e.stopTransactionDelayed()}onModelInsertChild(e,...r){super.onModelInsertChild(e,...r),e.stopTransactionDelayed()}onModelRemoveChild(e,...r){super.onModelRemoveChild(e,...r),e.stopTransactionDelayed()}onStoreModelAdd(e,...r){super.onStoreModelAdd(e,...r),e.stopTransactionDelayed()}onStoreModelInsert(e,...r){super.onStoreModelInsert(e,...r),e.stopTransactionDelayed()}onStoreModelRemove(e,...r){super.onStoreModelRemove(e,...r),e.stopTransactionDelayed()}onStoreRemoveAll(e,...r){super.onStoreRemoveAll(e,...r),e.stopTransactionDelayed()}},wh=new QR,eT=wh;vr.registerStmState("autorecordingstate",wh);var Ab=Symbol("MODEL_PROP"),_b=Symbol("NEW_DATA_PROP"),Fb=Symbol("OLD_DATA_PROP"),Ha=class extends jr{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[Ab]}set model(e){this[Ab]=e}get newData(){return this[_b]}set newData(e){this[_b]={...e}}get oldData(){return this[Fb]}set oldData(e){this[Fb]={...e}}undo(){const{model:e,oldData:r}=this;e.$&&Object.assign(e,r),e.set(r,null,null,null,!!e.$)}redo(){const{model:e,newData:r}=this;e.$&&Object.assign(e,r),e.set(r,null,null,null,!!e.$)}};Ha._$name="UpdateAction";var kb=Symbol("PARENT_MODEL_PROP"),Ob=Symbol("CHILD_MODELS_PROP"),Lb=Symbol("INSERT_INDEX_PROP"),$b=Symbol("CONTEXT_PROP"),jb=class extends jr{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[kb]}set parentModel(e){this[kb]=e}get childModels(){return this[Ob]}set childModels(e){this[Ob]=e.slice(0)}get insertIndex(){return this[Lb]}set insertIndex(e){this[Lb]=e}get context(){return this[$b]}set context(e){this[$b]=e}undo(){const{parentModel:e,context:r,childModels:t}=this,i=new Map,n=new Set;for(const s of t){const a=r.get(s);if(!a)n.add(s);else{let o=i.get(a.parent);o||(o={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},i.set(a.parent,o)),a.parent===e?a.index>s.parentIndex?o.moveRight.push({parent:a.parent,model:s,index:a.index+1}):o.moveLeft.push({parent:a.parent,model:s,index:a.index}):o.moveFromAnotherParent.push({parent:a.parent,model:s,index:a.index})}}for(const s of i.values()){const{moveRight:a,moveLeft:o}=s;o.sort((l,c)=>l.index-c.index),a.sort((l,c)=>c.index-l.index)}n.forEach(s=>s.parent.removeChild(s));for(const s of i.values()){const{moveRight:a,moveLeft:o,moveFromAnotherParent:l}=s;o.forEach(c=>{c.parent.insertChild(c.model,c.index)}),a.forEach(c=>{c.parent.insertChild(c.model,c.index)}),l.forEach(c=>{c.parent.insertChild(c.model,c.index)})}}redo(){const{parentModel:e,insertIndex:r,childModels:t}=this;e.insertChild(t,r)}};jb._$name="InsertChildAction";var Bb=Symbol("PARENT_MODEL_PROP"),Hb=Symbol("CHILD_MODELS_PROP"),Vb=Symbol("CONTEXT_PROP"),Nb=class extends jr{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[Bb]}set parentModel(e){this[Bb]=e}get childModels(){return this[Hb]}set childModels(e){this[Hb]=e.slice(0)}get context(){return this[Vb]}set context(e){this[Vb]=e}undo(){const{parentModel:e,context:r,childModels:t}=this;t.sort((i,n)=>{const s=r.get(i),a=r.get(n);return s-a}),t.forEach(i=>{e.insertChild(i,r.get(i))})}redo(){this.parentModel.removeChild(this.childModels)}};Nb._$name="RemoveChildAction";var zb=Symbol("STORE_PROP"),Wb=Symbol("MODEL_LIST_PROP"),Ub=class extends jr{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[zb]}set store(e){this[zb]=e}get modelList(){return this[Wb]}set modelList(e){this[Wb]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}};Ub._$name="AddAction";var Gb=Symbol("STORE_PROP"),Yb=Symbol("MODEL_LIST_PROP"),qb=Symbol("INSERT_INDEX_PROP"),Kb=Symbol("CONTEXT_PROP"),Xb=class extends jr{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[Gb]}set store(e){this[Gb]=e}get modelList(){return this[Yb]}set modelList(e){this[Yb]=e.slice(0)}get insertIndex(){return this[qb]}set insertIndex(e){this[qb]=e}get context(){return this[Kb]}set context(e){this[Kb]=e}undo(){const{store:e,modelList:r,context:t,silent:i}=this;r.sort((n,s)=>{const a=t.get(n),o=t.get(s);return a!==void 0&&o!==void 0?a-o:0}),r.forEach(n=>{const s=t.get(n);n._undoingInsertion=!0,s!==void 0?e.insert(s,n,i):e.remove(n,i),n._undoingInsertion=!1})}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}};Xb._$name="InsertAction";var Zb=Symbol("STORE_PROP"),Jb=Symbol("MODEL_LIST_PROP"),Qb=Symbol("CONTEXT_PROP"),eC=class extends jr{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[Zb]}set store(e){this[Zb]=e}get modelList(){return this[Jb]}set modelList(e){this[Jb]=e.slice(0)}get context(){return this[Qb]}set context(e){this[Qb]=e}undo(){const{store:e,context:r,modelList:t,silent:i}=this;t.sort((n,s)=>{const a=r.get(n),o=r.get(s);return a-o}),t.forEach(n=>{const s=r.get(n);e.insert(s,n,i)})}redo(){this.store.remove(this.modelList,this.silent)}};eC._$name="RemoveAction";var tC=Symbol("STORE_PROP"),rC=Symbol("ALL_RECORDS_PROP"),iC=class extends jr{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[tC]}set store(e){this[tC]=e}get allRecords(){return this[rC]}set allRecords(e){this[rC]=e.slice(0)}undo(){const{store:e,allRecords:r,silent:t}=this;e.add(r,t)}redo(){this.store.removeAll(this.silent)}};iC._$name="RemoveAllAction";var tT=(e,r,t,i)=>new Ha({model:e,newData:r,oldData:t,isInitialUserAction:i}),rT=(e,r,t,i)=>new jb({parentModel:e,childModels:t,insertIndex:r,context:i}),iT=(e,r,t)=>new Nb({parentModel:e,childModels:r,context:t}),nT=(e,r,t)=>new Ub({store:e,modelList:r,silent:t}),sT=(e,r,t,i,n)=>new Xb({store:e,insertIndex:r,modelList:t,context:i,silent:n}),aT=(e,r,t,i)=>new eC({store:e,modelList:r,context:t,silent:i}),oT=(e,r,t)=>new iC({store:e,allRecords:r,silent:t}),nt=(e,r,...t)=>{const i=e.state,n=r.call(e[Pe],e,...t);if(typeof n=="string")e[Pe]=vr.resolveStmState(n);else if(n instanceof si)e[Pe]=n;else if(Array.isArray(n)){const[s,a]=n;typeof s=="string"?e[Pe]=vr.resolveStmState(s):s instanceof si?e[Pe]=s:s&&typeof s=="object"&&(e=Object.assign(e,s),e[Pe]=vr.resolveStmState(e[Pe])),typeof a=="function"&&nt(e,a,...t)}else n&&typeof n=="object"&&(e=Object.assign(e,n),e[Pe]=vr.resolveStmState(e[Pe]));i!==ic&&i!==Sh&&n!==ic&&n!==Sh&&e.trigger("ready")},Xn=class extends Ae(F){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:tT,makeModelInsertChildAction:rT,makeModelRemoveChildAction:iT,makeStoreModelAddAction:nT,makeStoreModelInsertAction:sT,makeStoreModelRemoveAction:aT,makeStoreRemoveAllAction:oT,getTransactionTitle:null}}construct(...e){Object.assign(this,{[Pe]:ic,[ai]:[],[Pt]:[],[sr]:0,[Oe]:null,[Zt]:null,[ar]:!1}),super.construct(...e)}get state(){return this[Pe]}get position(){return this[sr]}get length(){return this[Pt].length}get stores(){return Array.from(this[ai])}hasStore(e){return this[ai].includes(e)}addStore(e){this.hasStore(e)||(this[ai].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[ai]=this[ai].filter(r=>r!==e),e.stm=null)}forEachStore(e){this[ai].forEach(r=>e(r,r.id))}get disabled(){return this.state===qR}set disabled(e){const r=this;r.disabled!==e&&(e?nt(r,r.state.onDisable,r):nt(r,r.state.onEnable,r),r.trigger("stmDisabled",{disabled:e}),r.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===ic||this.state===Sh}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===KR||this.state===eT}get autoRecord(){return this[ar]}set autoRecord(e){const r=this;r.autoRecord!=e&&(e?nt(r,r.state.onAutoRecordOn,r):nt(r,r.state.onAutoRecordOff,r))}startTransaction(e=null){nt(this,this.state.onStartTransaction,e)}stopTransaction(e=null){nt(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){nt(this,this.state.onStopTransactionDelayed)}rejectTransaction(){nt(this,this.state.onRejectTransaction)}get transaction(){return this[Oe]}get queue(){return this[Pt].map(e=>e.title)}get rawQueue(){return this[Pt]}get isRestoring(){return this.state===ZR}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),nt(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),nt(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){nt(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(r=>{var t;return(t=r.onStmRecordingStart)==null?void 0:t.call(r,this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,r){this.forEachStore(t=>{var i;return(i=t.onStmRecordingStop)==null?void 0:i.call(t,this,e,r)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:r})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{var r;return(r=e.onStmRestoringStart)==null?void 0:r.call(e,this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:r}){this.forEachStore(t=>{var i;return(i=t.onStmRestoringStop)==null?void 0:i.call(t,this)}),this.trigger("restoringStop",{stm:this,cause:e,transactions:r})}notifyStoresAboutQueueReset(e){this.forEachStore(r=>{var t;return(t=r.onStmQueueReset)==null?void 0:t.call(r,this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,r,t,i){nt(this,this.state.onModelUpdate,e,r,t,i)}onModelInsertChild(e,r,t,i){nt(this,this.state.onModelInsertChild,e,r,t,i)}onModelRemoveChild(e,r,t){nt(this,this.state.onModelRemoveChild,e,r,t)}onStoreModelAdd(e,r,t){nt(this,this.state.onStoreModelAdd,e,r,t)}onStoreModelInsert(e,r,t,i,n){nt(this,this.state.onStoreModelInsert,e,r,t,i,n)}onStoreModelRemove(e,r,t,i){nt(this,this.state.onStoreModelRemove,e,r,t,i)}onStoreRemoveAll(e,r,t){nt(this,this.state.onStoreRemoveAll,e,r,t)}onUndoKeyPress(e){const r=this;r.enabled&&(e.shiftKey?r.canRedo&&(e.preventDefault(),r.redo()):r.canUndo&&(e.preventDefault(),r.undo()))}stash(){this.transaction&&(this.stashedTransaction=this.transaction,this.rejectTransaction())}applyStash(){this.stashedTransaction&&(this.startTransaction(this.stashedTransaction.title),this.stashedTransaction.redo(),delete this.stashedTransaction)}};Xn._$name="StateTrackingManager";var nC=Array.prototype.slice,sC=Object.freeze([]),lT=Object.freeze({}),aC=/[&<]/,{getPrototypeOf:oC}=Object,{toString:cT}=Object.prototype,{isEqual:lC,isObject:dT}=T,uT={parent:1,elementData:1,ns:1,syncOptions:1},cC=()=>({ignore:uT,refsFound:new Set}),dC={class:1,className:1,classname:1},hT={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},fT={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1},gT=(e,r)=>{const t="className"in r?"className":"class",i=r[t];if(i)if(typeof i=="string"){const n=i.split(" ");n.includes(e)||(n.push(e),r[t]=n.join(" "))}else Array.isArray(i)?i.includes(e)||i.push(e):i.isDomClassList?i.add(e):T.isObject(i)&&(i[e]=1)},mT=(e,r)=>{const t="className"in r?"className":"class",i=r[t];if(i)if(typeof i=="string"){const n=i.split(" ");n.includes(e)&&(n.splice(n.indexOf(e),1),r[t]=n.join(" "))}else Array.isArray(i)?i.includes(e)&&i.splice(i.indexOf(e),1):i.isDomClassList?i.remove(e):T.isObject(i)&&delete i[e]},q=class{static checkEquality(e,r,t,i){var n;if(e===r)return!0;if(e==null)return r==null;if(!e||!r)return!1;const s=typeof e;if(s!==typeof r||hT[s])return!1;let o=t.equalityCache||(t.equalityCache=new Map),l=!!i,c,d,u,h,f,g,m;if(o=o.get(e)||o.set(e,new Map).get(e),c=o.get(r),c===void 0){if(c=!0,oC(e)!==oC(r)||e instanceof Node)c=!1;else if(Array.isArray(e)){if(d=e.length,d!==r.length)c=!1;else for(;d-- >0;)if(!q.checkEquality(e[d],r[d],t,l)){c=!1;break}}else{g=e.syncOptions,h=g==null?void 0:g.ignoreRefs,h&&(l=!0,i=h!=="children"),u=t.ignore||lT;for(f in r)if(!u[f]&&!(f in e)&&!(i&&f==="reference")){c=!1;break}if(c){if(cT.call(r)==="[object Date]")c=e.getTime()===r.getTime();else for(f in e)if(!u[f]&&!(i&&f==="reference")){if(!(f in r)){c=!1;break}if(m=e[f],!q.checkEquality(m,r[f],t,l)){c=!1;break}}}}!i&&dT(e)&&e.reference&&((n=t.refsFound)==null||n.add(e.reference)),o.set(r,c)}return c}static sync(e){const r=e,{refOwner:t}=e,i=t==null?void 0:t.byRef,n=cC();let s=e.affected,a,o,l,c;if(typeof s=="string"&&(s=[s]),e={...e,checkEqualityOptions:n},t){if(t.byRef={},s)for(o in i)s.includes(o)||(t.byRef[o]=i[o]);e.refsWas=i}if(r.changed=q.performSync(e,e.targetElement),t)for(s||(s=Object.keys(i)),a=0;a<s.length;++a)o=s[a],l=i[o],n.refsFound.has(o)||l.retainElement?t.byRef[o]=l:(c=l.lastDomConfig,l.remove(),t.detachRef(o,l,c));return e.targetElement}static performSync(e,r){const{domConfig:t,callback:i}=e,{lastDomConfig:n}=r;if((e.configEquality||q.checkEquality)(t,n,e.checkEqualityOptions,e.ignoreRefs))i==null||i({action:"none",domConfig:t,targetElement:r});else return t?(t.onlyChildren||(q.syncAttributes(t,r,e),q.syncContent(t,r)),t.keepChildren||q.syncChildren(e,r)):(r.innerHTML=null,r.syncIdMap=null),r.lastDomConfig=t!=null&&t.onlyChildren&&n?{...n,children:t.children}:t,!0;return!1}static syncDataset(e,r){const{lastDomConfig:t}=r,i=e===t,n=Object.keys(e.dataset),s=t&&t.dataset&&Object.keys(t.dataset),a=H.delta(n,s);let o,l,c,d;for(l=0;l<a.onlyInA.length;l++)o=a.onlyInA[l],d=e.dataset[o],d!=null&&r.setAttribute(`data-${L.hyphenate(o)}`,d);for(l=0;l<a.inBoth.length;l++)o=a.inBoth[l],d=e.dataset[o],(i||d!=t.dataset[o])&&(c=`data-${L.hyphenate(o)}`,d==null?r.removeAttribute(c):r.setAttribute(c,d));for(l=0;l<a.onlyInB.length;l++)r.removeAttribute(`data-${L.hyphenate(a.onlyInB[l])}`)}static addCls(e,r){const{lastDomConfig:t}=r;e=J.normalize(e,"array"),e.forEach(i=>{r.classList.add(i),gT(i,t)})}static removeCls(e,r){const{lastDomConfig:t}=r;e=J.normalize(e,"array"),e.forEach(i=>{r.classList.remove(i),mT(i,t)})}static syncClassList(e,r,t){let i=e.className||e.class,n=!1,s,a,o,l,c,d;if(t){for(a=J.normalize(r,"array"),i=J.normalize(i,"object"),d=J.normalize(t.className||t.class,"object"),c=[],o=0,l=a.length;o<l;++o)s=a[o],i[s]||!(s in d)?(d[s]=1,c.push(s)):n=!0;for(s in i)d[s]||(c.push(s),n=!0);if(!n)return;i=c.join(" ")}else i=J.normalize(i);r.setAttribute("class",i)}static getSyncAttributes(e){const r={},t=[];return e&&Object.keys(e).forEach(i=>{if(!fT[i]){const n=i.toLowerCase();r[n]=e[i],t.push(n)}}),{attributes:r,names:t}}static syncAttributes(e,r,t){const{lastDomConfig:i}=r,n=e===i,s=q.getSyncAttributes(e),{attributes:a,names:o}=s,{attributes:l,names:c}=n?s:q.getSyncAttributes(i),{onlyInA:d,onlyInB:u,inBoth:h}=n?{onlyInA:sC,onlyInB:sC,inBoth:o}:H.delta(o,c);let f,g;for(g=0;g<d.length;g++){f=d[g];const m=a[f];f==="style"&&m!=null?C.applyStyle(r,m,!0):f==="dataset"?q.syncDataset(e,r):dC[f]?q.syncClassList(e,r):m!=null&&r.setAttribute(f,m)}for(g=0;g<u.length;g++)r.removeAttribute(u[g]);for(g=0;g<h.length;g++){f=h[g];const m=a[f],p=l[f];m==null?r.removeAttribute(f):f==="style"?t.strict?n?q.syncStyles(r,m):lC(m,p,!0)||q.syncStyles(r,m,p):(n||!lC(m,p,!0))&&C.applyStyle(r,m,!0):f==="dataset"?q.syncDataset(e,r):dC[f]?q.syncClassList(e,r,t.strict&&r.lastDomConfig):(n||m!==p)&&r.setAttribute(f,m)}}static syncStyles(e,r,t){let i,n,s;if(!t)i=r;else{if(i={},r=C.parseStyle(r),t=C.parseStyle(t),r)for(n in r)s=r[n],t[n]!==s&&(i[n]=s);for(n in t)n in r||(i[n]="")}C.applyStyle(e,i)}static syncContent(e,r){var t;const{html:i,text:n}=e,s=n!=null?n:i;if(r.didSetTextContent=!1,e.elementData&&(r.elementData=e.elementData),s instanceof DocumentFragment)r.childNodes.length===1&&C.getChildElementCount(r)===0&&s.childNodes.length===1&&C.getChildElementCount(s)===0?C.setInnerText(r,s.firstChild.data):(r.innerHTML="",r.appendChild(s));else if(i!=null&&aC.test(i))r.innerHTML=String(i);else if(s!=null){const{lastDomConfig:a}=r;(t=a==null?void 0:a.children)!=null&&t.length||a!=null&&a.html&&aC.test(r.lastDomConfig.html)?r.innerHTML=s:(C.setInnerText(r,String(s)),r.didSetTextContent=!0)}}static insertTextNode(e,r,t,i,n=null){const s=document.createTextNode(e);r.insertBefore(s,n),i&&(s.$refOwnerId=i.id),t==null||t({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,r,t,i,n,s,a){var o;const l=a.ns?document.createElementNS(a.ns,e.tag||"svg"):document.createElement(e.tag||"div");r.insertBefore(l,t),q.performSync(a,l),s!=null&&(n[s]=l),!e.role&&!e.tabIndex&&!e["aria-hidden"]&&!C.isFocusable(l,!0)&&!l.htmlFor&&l.setAttribute("role","presentation"),i&&(l.$refOwnerId=i.id,s&&(l.$reference=s,i.attachRef(s,l,e))),(o=a.callback)==null||o.call(a,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,r){var t,i,n;let{domConfig:s,syncIdField:a,callback:o,releaseThreshold:l,configEquality:c,ns:d,refOwner:u,refsWas:h,strict:f,checkEqualityOptions:g,ignoreRefs:m}=e,p=null,v,y,S;const D=s.syncOptions||{};if((t=s.html)!=null?t:s.text)return;m=!!((i=D.ignoreRefs)!=null?i:m),m&&(u=h=null),"strict"in D&&(f=D.strict);const w=u?u.byRef:{},E=nC.call(s.children||[]),x=nC.call(r.childNodes),M=h||r.syncIdMap||{},I=r.releasedIdMap||{},P=A=>{for(;x.length&&x[0].parentNode!==r;)x.shift();return(A?x.shift():x[0])||null};a=D.syncIdField||a,f=D.strict||f,o=D.callback||o,c=D.configEquality||c,l="releaseThreshold"in D?D.releaseThreshold:l,a&&(r.syncIdMap=w);const _={checkEqualityOptions:g||cC(),ignoreRefs:m,refOwner:u,refsWas:h,strict:f,syncIdField:a,releaseThreshold:l,callback:o,configEquality:c};for(;E.length;){const A=E.shift();if(S=null,!A)continue;if(C.isReactElement(A)){o({jsx:A,targetElement:r});continue}if(A instanceof Node){y=P(),A!==y&&r.insertBefore(A,y),v=x.indexOf(A),v>-1&&x.splice(v,1);continue}const V=typeof A=="string";if(_.domConfig=A,_.ns=A.ns||d,!V){if(u?S=A.reference:a&&A.dataset&&(S=A.dataset[a]),S!=null&&!A.unmatched){const K=M[S]||I[S];if(K){const{lastDomConfig:se}=K;K.retainElement||q.performSync(_,K)&&(o==null||o({action:"reuseOwnElement",domConfig:A,targetElement:K,lastDomConfig:se,syncId:S})),A.retainElement&&(K.retainElement=!0),w[S]=K,H.remove(x,K),delete I[S],K.isReleased=!1,y=P(),(K.parentNode!==r||f&&K.nextSibling!==y)&&r.insertBefore(K,y)}else f?q.insertElement(A,r,P(),u,w,S,_):(E.push(A),A.unmatched=!0);continue}A.unmatched&&delete A.unmatched}let N=null,B=null,Z;for(;!B&&(Z=P(!0));){if(u){if(Z.$refOwnerId!==u.id)continue;if(Z.$reference){if(!f)continue;N=Z;break}B=Z}else Z.retainElement||(B=Z);B||(p||(p=[])).push(Z)}if(N||!B)V?q.insertTextNode(A,r,o,u,N):q.insertElement(A,r,N,u,w,S,_);else if(!V&&B.nodeType===Node.ELEMENT_NODE&&(A.tag||"div").toLowerCase()===B.tagName.toLowerCase()){const{lastDomConfig:K}=B,se=q.performSync(_,B);if(a&&((n=K==null?void 0:K.dataset)==null?void 0:n[a])!=null){const xe=K.dataset[a];delete I[xe],delete M[xe]}S!=null&&(w[S]=B),B.isReleased=!1,se&&(o==null||o({action:"reuseElement",domConfig:A,targetElement:B,lastDomConfig:K,syncId:S}))}else V&&B.nodeType===Node.TEXT_NODE?B.data=A:(V?q.insertTextNode(A,r,o,u,B):q.insertElement(A,r,B,u,w,S,_),B.remove())}if(!(r.didSetTextContent&&x.length===1&&x[0].nodeType===Node.TEXT_NODE)){for(;y=P(!0);)(!u||y.$refOwnerId===u.id&&!y.$reference)&&(p||(p=[])).push(y);p&&q.syncChildrenCleanup(r,p,w,o,u,l,a)}}static syncChildrenCleanup(e,r,t,i,n,s,a){let o=0,l;for(const c of r){const{lastDomConfig:d}=c;if(c.nodeType===Element.TEXT_NODE){c.remove();continue}c.retainElement?a&&d&&(t[c.dataset[a]]=c):!n&&a&&(s==null||o<s)?(c.isReleased||(c.className="b-released",c.isReleased=!0,d!=null&&d.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[d.dataset[a]]=c),i==null||i({action:"releaseElement",domConfig:d,lastDomConfig:d,targetElement:c}),d&&(d.isReleased=!0,d.className&&(d.className="b-released"),d.class&&(d.class="b-released"),d.style&&(d.style=null))),o++):(c.remove(),n&&(l=c.$reference,l&&n.detachRef(l,c,d)),e.releasedIdMap&&a&&(d!=null&&d.dataset)&&delete e.releasedIdMap[d.dataset[a]],i==null||i({action:"removeElement",domConfig:c.lastDomConfig,lastDomConfig:c.lastDomConfig,targetElement:c}))}}static removeChild(e,r){if(e.contains(r)){const t=e.syncIdMap;if(t){const i=Object.values(t).indexOf(r);i>-1&&delete t[Object.keys(t)[i]]}e.removeChild(r)}}static addChild(e,r,t){e.appendChild(r),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[t]=r}static getChild(e,r){var t;const i=String(r).split(".");for(const n of i)if(e=(t=e==null?void 0:e.syncIdMap)==null?void 0:t[n],!e)return null;return e}};q._$name="DomSync";var yr=class{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],r=s=>e.map(a=>{let o=s+L.capitalize(a);return s==="moz"&&(o=o.replace("screen","Screen"),"mozCancelFullScreen"in document&&a==="exitFullscreen"&&(o="mozCancelFullScreen")),o});this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullScreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&r("ms")||[];const t=["fullscreenchange","fullscreenerror"],i=["MSFullscreenChange","MSFullscreenError"],n=s=>t.map(a=>s+L.capitalize(a));this.events="fullscreenEnabled"in document&&t||"webkitFullscreenEnabled"in document&&n("webkit")||"mozFullscreenEnabled"in document&&n("moz")||"msFullscreenEnabled"in document&&i||[],this.onFullscreenChange(this.onInternalFullscreenChange.bind(this))}static get enabled(){return!!(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&(e==null?void 0:e[this.functions[1]]())}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return!!this.element}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}static onInternalFullscreenChange(){const e=this,{element:r}=e;if(r){if(!r.closest(".b-floatroot")){const t=C.getRootElement(r),{floatRoot:i}=t;i&&(e._floatRoot=i,e._oldParent=i.parentElement,r.appendChild(i))}}else e._floatRoot&&e._oldParent.appendChild(e._floatRoot),e._oldParent=null,e._floatRoot=null}};yr.init(),yr._$name="Fullscreen";var Dh=null,Eh=[],pT=e=>{var r;return e.nodeType===e.ELEMENT_NODE&&((r=e.ownerDocument.defaultView)==null?void 0:r.getComputedStyle(e).getPropertyValue("position"))==="absolute"},Je=class{static addResizeListener(e,r){const t=this;if((e===document||e===globalThis)&&(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)t.hasWindowResizeListener||(globalThis.addEventListener("resize",t.onWindowResize),t.hasWindowResizeListener=!0);else if(globalThis.ResizeObserver)t.resizeObserver||(t.resizeObserver=new ResizeObserver(t.onElementResize)),t.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[i,n,s]=C.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});n.scrollLeft=n.scrollTop=s.scrollLeft=s.scrollTop=1e6,n.addEventListener("scroll",t.onSizeMonitorScroll,!0),s.addEventListener("scroll",t.onSizeMonitorScroll,!0),(r.targetMutationMonitor=new MutationObserver(a=>{const o=[],l=[];for(const d of a)d.type==="childList"&&(o.push.apply(o,d.addedNodes),l.push.apply(l,d.removedNodes));const c=[...o.filter(d=>!l.includes(d)),...l.filter(d=>!o.includes(d))];c.length!==0&&(c.length>0&&c.every(pT)||n.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))})).observe(e,{childList:!0,subtree:!0}),r.monitorElement=i}e._bResizemonitor.handlers.push(r)}static removeResizeListener(e,r){if(e){(e===document||e===globalThis)&&(e=document.body);const t=e._bResizemonitor;let i=0;t&&t.handlers&&(H.remove(t.handlers,r),i=t.handlers.length),i||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(r.monitorElement&&(r.monitorElement.remove(),r.monitorElement=null),r.targetMutationMonitor&&r.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const r of e){const t=r.target,i=t._bResizemonitor,n=r.contentRect||t.getBoundingClientRect();if(ni(t)&&(!i.rectangle||n.width!==i.rectangle.width||n.height!==i.rectangle.height)){const s=i.rectangle;i.rectangle=n;for(const a of i.handlers)a(t,s,n)}}}static onSizeMonitorScroll(e){var r;if((r=document.body)!=null&&r.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,i=t.parentNode,n=i._bResizemonitor,s=i.getBoundingClientRect();(!n.rectangle||s.width!==n.rectangle.width||s.height!==n.rectangle.height)&&(Eh.push([i,n.rectangle,s]),n.rectangle=s,Dh||(Dh=requestAnimationFrame(Je.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const r=document.body,t=r._bResizemonitor,i=t.rectangle;t.rectangle=document.documentElement.getBoundingClientRect();for(const n of t.handlers)n(r,i,t.rectangle)}static fireResizeEvents(){for(const e of Eh)for(const r of e[0]._bResizemonitor.handlers)e[0].offsetParent&&r.apply(this,e);Dh=null,Eh.length=0}static removeGlobalListeners(){globalThis.removeEventListener("resize",this.onWindowResize)}};Je._$name="ResizeMonitor";var uC={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:Y.supportsOverflowClip?"clip":"hidden"},hC="b-widget-scroller",xh={block:"nearest"},fC=Promise.resolve(),gC=e=>new Promise(r=>j.on({element:e===document.documentElement?globalThis:e,scroll:r,once:!0})),vT={x:1},nc={auto:1,scroll:1},yT={true:1,auto:1},bT={overflowX:"auto",overflowY:"auto"},CT=e=>{var r,t,i,n;let s,a,o,l;return e?typeof e=="number"?s=a=o=l=e:(s=(r=e.top)!=null?r:0,a=(t=e.bottom)!=null?t:0,o=(i=e.start)!=null?i:0,l=(n=e.end)!=null?n:0):s=a=o=l=0,{top:s,bottom:a,start:o,end:l}},or=class extends ge(Ae(F)){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,x:0,y:0,rtlSource:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}syncOverflowState(){const e=this,{element:r}=e,t=new J(r.classList),i=e.hasOverflowX=r.scrollWidth>r.clientWidth,n=e.hasOverflowY=r.scrollHeight>r.clientHeight;t.value=r.classList,(t.toggle("b-horizontal-overflow",i)||t.toggle("b-vertical-overflow",n))&&(C.syncClassList(r,t),e.isConfiguring||e.trigger("overflowChange",{x:i,y:n}))}hasOverflow(e="y"){const r=this[`overflow${e.toUpperCase()}`],t=this[`overflow${e==="y"?"x":"y"}`];if(!C.scrollBarWidth||!yT[r]||t==="hidden-scroll"||Y.isFirefox){const i=e==="y"?"Height":"Width";return this[`scroll${i}`]>this[`client${i}`]}else return this[`hasOverflow${e.toUpperCase()}`]}hasScrollbar(e="y"){const{element:r}=this;if(r&&C.scrollBarWidth){const t=e==="y",i=t?"Width":"Height",n=r[`client${i}`],s=parseInt(C.getStyleValue(r,`border${t?"Left":"Top"}Width`))+parseInt(C.getStyleValue(r,`border${t?"Right":"Bottom"}Width`)),a=r[`offset${i}`]-s-n;return Math.abs(a-C.scrollBarWidth)<2}}addPartner(e,r=vT){const t=this;typeof r=="string"&&(r={[r]:1}),t.partners||(t.partners={}),t.partners[e.id]={scroller:e,axes:r},r.x&&(e.x=t.x),r.y&&(e.y=t.y),e.isPartneredWith(t)||e.addPartner(t,r)}eachPartner(e){const{partners:r}=this;r&&Object.values(r).forEach(e)}removePartner(e){this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var r;return!!((r=this.partners)!=null&&r[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach(e=>e.scroller.removePartner(this))}async scrollIntoView(e,r=xh){const t=this,{isRectangle:i}=e,n=i?e:k.from(e),{xDelta:s,yDelta:a}=t.getDeltaTo(e,r),o=t.scrollBy(s,a,r);return(r.highlight||r.focus)&&o.then(()=>{i&&(e=n.translate(-s,-a)),r.highlight&&(isNaN(r.highlight)?(t.widget||t).callback(r.highlight,null,[e]):C.highlight(e,t)),r.focus&&C.focusWithoutScrolling(e)}),o}static async scrollIntoView(e,r=xh,t=!1){const i=k.from(e),n=typeof r=="object"?r.animate:r,s=or._globalScroller||(or._globalScroller=new or),a=[];s.rtlSource={rtl:t};let o=0,l=0,c;for(let d=e.parentNode;d.nodeType===Node.ELEMENT_NODE;d=d.parentNode){if(d===document.body&&d!==document.scrollingElement)continue;const u=d===document.scrollingElement?bT:d.ownerDocument.defaultView.getComputedStyle(d);if(r.y!==!1&&nc[u.overflowY]&&d.scrollHeight>d.clientHeight||r.x!==!1&&nc[u.overflowX]&&d.scrollWidth>d.clientWidth){s.element=d,s.positionDirty=!0;const{xDelta:h,yDelta:f}=s.getDeltaTo(i,r);(h||f)&&(a.push({element:d,x:d.scrollLeft,y:d.scrollTop,xDelta:h,yDelta:f}),i.translate(-h,-f),o+=h,l+=f)}}if(a.length){const d=Math.abs(o),u=Math.abs(l);let h=n&&(typeof n=="number"?n:typeof n.duration=="number"?n.duration:300);if(h&&(d>10||u>10))Math.max(d,u)<50&&(h=Math.min(h,500)),c=s.scrollAnimation=Te.animate(h,f=>{const g=f===1;for(const{element:m,x:p,y:v,xDelta:y,yDelta:S}of a)s.element=m,y&&(s.x=Math[t?"min":"max"](p+(g?y:Math.round(y*f)),0)),S&&(s.y=Math.max(v+(g?S:Math.round(S*f)),0))},null,n.easing),c.then(()=>{s.scrollAnimation=null});else{for(const{element:f,xDelta:g,yDelta:m}of a)f.scrollTop+=m,f.scrollLeft+=g;c=gC(a[a.length-1].element)}}else c=fC;return(r.highlight||r.focus)&&c.then(()=>{r.highlight&&(isNaN(r.highlight)?s.callback(r.highlight,null,[e]):C.highlight(e,s)),r.focus&&e.focus()}),c}async scrollBy(e=0,r=0,t=xh){const i=this,n=typeof t=="object"?t.animate:t,s=Math.abs(e),a=Math.abs(r);i.scrollAnimation&&(i.scrollAnimation.cancel(),i.scrollAnimation=null),(e||r)&&(i.silent=t.silent);let o=n&&(typeof n=="number"?n:typeof n.duration=="number"?n.duration:300);if(o&&(s>10||a>10)){const{x:l,y:c}=i;let d=l,u=c;return Math.max(s,a)<50&&(o=Math.min(o,500)),i.scrollAnimation=Te.animate(o,h=>{var f,g;const m=h===1;if(e){if(i.x!==d&&!t.force)return(f=i.scrollAnimation)==null?void 0:f.cancel();i.x=Math.max(l+(m?e:Math.round(e*h)),0)}if(r){if(i.y!==u&&!t.force)return(g=i.scrollAnimation)==null?void 0:g.cancel();i.y=Math.max(c+(m?r:Math.round(r*h)),0)}d=i.x,u=i.y},i,n.easing),i.element.classList.add("b-scrolling"),i.scrollAnimation.then(()=>{i.isDestroyed||(i.element.classList.remove("b-scrolling"),i.scrollAnimation=null)}),i.scrollAnimation}else{if(e||r){const l=i.x,c=i.y;if(i.x+=e,i.y+=r,i.x!==l||i.y!==c)return gC(i.element)}return fC}}async scrollTo(e,r,t){const{x:i,y:n}=this,s=e==null?0:e-i,a=r==null?0:r-n;return this.scrollBy(s,a,t)}doDestroy(){var e,r;const t=this;t._element&&(t._element.removeEventListener("scroll",t.scrollHandler),(e=t.wheelListenerRemover)==null||e.call(t)),(r=t.scrollAnimation)==null||r.cancel(),Object.values(t.partners||{}).forEach(({scroller:i})=>i.removePartner(t)),super.doDestroy()}onElMutation(e){const r=this,[t,i]=C.getTranslateXY(r.element);if(r._x!==-t||r.y!==-i){const n=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(n,"target",{get:()=>r.element}),r.onScroll(n)}}onElResize(){const e=this,{widget:r}=e;r!=null&&r.isAnimating?r.findListener("animationend","onElResize",e)===-1&&r.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){const r=this,{_x:t,_y:i,element:n}=r;let s=0;r.overflowX==="clip"&&n.scrollLeft!==t&&(n.scrollLeft=t,++s),r.overflowY==="clip"&&n.scrollTop!==i&&(n.scrollTop=i,++s),s!==2&&(!r.widget||!r.widget.isDestroyed)&&(r.positionDirty=!0,n.classList.contains("b-scrolling")||n.classList.add("b-scrolling"),e.widget=r.widget,r.silent||r.trigger("scroll",e),r.syncPartners(),r.controllingPartner=null,r.onScrollEnd(e))}syncPartners(e,r){const t=this;t.partners&&Object.values(t.partners).forEach(({axes:i,scroller:n})=>{(n!==t.controllingPartner||e)&&n.sync(t,i)&&r&&n.syncPartners(e,r)})}onScrollEnd(e){const r=this;r.silent&&(r.silent=!1),r.trigger("scrollEnd",e),r.controllingPartner=null,r.element.classList.remove("b-scrolling")}getDeltaTo(e,r){const t=this;if(!t.viewport)return{xDelta:0,yDelta:0};const{x:i,y:n,scrollWidth:s,scrollHeight:a,isRTL:o}=t,l=e instanceof k?e:k.from(e),c=r.block||"nearest",d=t.viewport,u=CT(r.edgeOffset),h=d.width>=l.width+(u.start+u.end)?u:{start:0,end:0},f=d.height>=l.height+(u.top+u.bottom)?u:{top:0,bottom:0},g=new k(o?d.right- -i-s:d.x-i,d.y-n,s,a),m=l.clone().adjust(-h.start,-f.top,h.end,f.bottom).constrainTo(g),p=m.clone(),v=t.isRTL?-1:1;let y=0,S=0;if(c==="start")p.moveTo(d.x+(t.isRTL?d.width-p.width:0),d.y),y=m.x-p.x,S=m.y-p.y;else if(c==="end")p.moveTo(d.x+(t.isRTL?0:d.width-p.width),d.bottom-p.height),y=m.x-p.x,S=m.y-p.y;else if(c==="center"){const D=d.center;p.moveTo(D.x-p.width/2,D.y-p.height/2),y=y||m.x-p.x,S=S||m.y-p.y}else p.width>d.width?y=p.x-d.x:p.right>d.right?y=p.right-d.right:p.x<d.x&&(y=p.x-d.x),p.height>d.height?S=p.y-d.y:p.bottom>d.bottom?S=p.bottom-d.bottom:p.y<d.y&&(S=p.y-d.y);return y=v*Math.round(y),S=Math.round(S),{xDelta:r.x===!1?0:Math.max(Math.min(y,t.maxX-i),-i),yDelta:r.y===!1?0:Math.max(Math.min(S,t.maxY-n),-n)}}get viewport(){return k.client(this.element)}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,r){var t;const i=this;if(i===or._globalScroller){i._element=e,i.positionDirty=!0;return}const n=i.scrollHandler||(i.scrollHandler=i.onScroll.bind(i)),s=i.resizeHandler||(i.resizeHandler=i.onElResize.bind(i));if(r&&(i.translate?(t=i.mutationObserver)==null||t.disconnect():(r.removeEventListener("scroll",n),r.classList.remove(hC),r.style.overflowX=r.style.overflowY=""),Je.removeResizeListener(r,s)),e){if(i.translate){if(i.mutationObserver||(i.mutationObserver=new MutationObserver(i.mutationHandler||(i.mutationHandler=i.onElMutation.bind(i)))),i._x=i._y=0,document.contains(e)){const[a,o]=C.getTranslateXY(e);i._x=-a,i._y=-o}i.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",n),e.classList.add(hC);Je.addResizeListener(e,s),i.widget||(i.rtlSource={get rtl(){return C.getStyleValue(e,"direction")==="rtl"}}),i.isRTL&&e.classList.add("b-rtl"),i.positionDirty&&(i.updateOverflowX(i.overflowX),i.updateOverflowY(i.overflowY)),i.syncOverflowState(),i.isConfiguring&&(i._x&&i.updateX(i._x),i._y&&i.updateY(i._y))}i.positionDirty=!0}get x(){const e=this,{element:r}=e;if(r&&e.positionDirty){if(e.translate){const[t,i]=C.getTranslateXY(r);e._x=-t,e._y=-i}else e._x=Math.abs(r.scrollLeft),e._y=r.scrollTop;e.positionDirty=!1}return e._x}get scrollLeft(){return this.element.scrollLeft}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e=typeof e=="string"?this.element.querySelector(e):e,Je.addResizeListener(e,this.resizeHandler))}updateX(e){var r;const{element:t}=this;t&&!((r=this.widget)!=null&&r.isConfiguring)&&(e=Math.round(e),this.trigger("scrollStart",{x:e}),this.translate?C.setTranslateX(t,-e):t.scrollLeft=this.isRTL?-e:e),this.positionDirty=!0}sync(e,r){const t=this,{x:i,y:n}=r;let s=!1;return i!=null&&t.x!==e.x&&(t.controllingPartner=e,t.x=e.x,s=!0),n!=null&&t.y!==e.y&&(t.controllingPartner=e,t.y=e.y,s=!0),s}get y(){const e=this,{element:r}=e;if(r&&e.positionDirty){if(e.translate){const[t,i]=C.getTranslateXY(r);e._x=-t,e._y=-i}else e._x=r.scrollLeft,e._y=r.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:r,widget:t}=this;r&&!(t!=null&&t.isConfiguring)&&(this.trigger("scrollStart",{y:e}),this.translate?C.setTranslateY(r,-e):r.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,r){const t=this,{element:i,translate:n}=t,{style:s,classList:a}=i;r==="hidden-scroll"&&a.remove("b-hide-scroll"),e==="hidden-scroll"&&!n&&(nc[s.overflowY]?(e="hidden",t.enableWheel()):a.add("b-hide-scroll")),n||(s.overflowX=uC[e]||e),t.isConfiguring||(t.positionDirty=!0,t.syncOverflowState())}updateOverflowY(e,r){const t=this,{element:i,translate:n}=t,{style:s,classList:a}=i;r==="hidden-scroll"&&a.remove("b-hide-scroll"),e==="hidden-scroll"&&!n&&(nc[s.overflowX]?(e="hidden",t.enableWheel()):a.add("b-hide-scroll")),n||(s.overflowY=uC[e]||e),t.isConfiguring||(t.positionDirty=!0,t.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=j.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&this.overflowX==="hidden-scroll"?this.x+=e.deltaX:this.overflowY==="hidden-scroll"&&(this.y+=e.deltaY)}get scrollWidth(){var e,r;return(r=(e=this.element)==null?void 0:e.scrollWidth)!=null?r:0}set scrollWidth(e){const r=this,{element:t,isRTL:i}=r;let n=r.widthStretcher;n&&e==null?(n.remove(),r.widthStretcher=null):e&&(e=Math.abs(e),n||(n=r.widthStretcher=C.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",retainElement:!0})),n.style.transform=`translateX(${(e-1)*(i?-1:1)}px)`,t&&!t.contains(n)&&t.insertBefore(n,t.firstElementChild)),r.propagate!==!1&&r.eachPartner(({scroller:s})=>{s.propagate=!1,s.scrollWidth=e,delete s.propagate}),r.positionDirty=!0,r.syncOverflowState()}get scrollHeight(){var e,r;return(r=(e=this.element)==null?void 0:e.scrollHeight)!=null?r:0}set scrollHeight(e){const r=this,t=r.stretcher||(r.stretcher=C.createElement({className:"b-scroller-stretcher"}));t.style.transform=`translateY(${e-1}px)`,r.element&&r.element.lastChild!==t&&r.element.appendChild(t),r.positionDirty=!0,r.syncOverflowState()}get clientWidth(){var e;return((e=this.element)==null?void 0:e.clientWidth)||0}get clientHeight(){var e;return((e=this.element)==null?void 0:e.clientHeight)||0}get id(){return this._id||(this.widget?this._id=`${this.widget.id}-scroller`:this._id=ji.generateId("scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}};or._$name="Scroller";var Va=class{constructor(e){this.promise=new Promise((r,t)=>{this.resolve=r,this.reject=t}),e&&e(this)}};Va._$name="Promissory";var{defineProperty:Rh}=Reflect,Hi=class extends F.mixin(Ve,Ae,ge,Gn){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,r=e.$meta;let t=r.renderConfigs,i,n;if(t===void 0){t=null,i=r.configs;for(n in i)i[n].render&&(t||(t=new Set)).add(n);r.renderConfigs=e.prototype.$renderConfigs=t}return t}construct(...e){this.$iid=++Hi.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==Hi.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,r){const t=this;return r&&r.remove(),e&&(e.id=t.id,e=C.createElement(e,{refOwner:t})),e}updateId(e,r){const t=this;if(r){const i=t.element;i.id=e,t.fixRefOwnerId(i,e,r)}}get classes(){return this.element.classList}fixRefOwnerId(e,r,t){if(e.$refOwnerId===t){e.$refOwnerId=r;const i=e.$reference;i&&(e.id=`${r}-${i}`);for(const n of e.childNodes)this.fixRefOwnerId(n,r,t)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,r,t){const i=this,n="_"+e,{listeners:s}=t;n in i||Rh(i,e,{get(){return i.refreshDom.flush(),i[n]},set(a){i[n]=a}}),r.id=`${i.id}-${e}`,i.byRef[e]=r,i[e]=r,s&&(t.listeners={on:s,un:j.on(Object.assign({element:r,thisObj:i},s))})}detachRef(e,r,t){t.listeners&&(t.listeners.un(),t.listeners=null),this[e]=null,delete this.byRef[e]}renderDom(){return{}}get renderContext(){const e=this,r=e.$meta,t=e.constructor;let i=r.renderConfigs||t.renderConfigs,n=e;if(!i){n=Object.create(e),i=new Set;for(const s in r.configs)Rh(n,s,{get(){return i.add(s),e[s]}});n.renderDom=()=>e.renderDom.call(n),e.$renderConfigs=i}return Rh(e,"renderContext",{value:n}),n}refreshDom(){q.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){e==="draw"&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let r=Object.values(e.byRef).find(t=>t.classList.contains("b-drawable"));r||(r=e.element,r.classList.add("b-drawable")),e.intersector=new IntersectionObserver(t=>{e.isDestroyed||t.forEach(i=>{i.isIntersecting&&e.onDraw({count:++e.drawCounter})})}),e.intersector.observe(r)}}onDraw(e){this.trigger("draw",e)}};Hi.$idSeed=0,Object.assign(Hi.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null}),Hi._$name="Renderable";var Na=class extends Hi{construct(e){if(e){let i=e.element,n;i&&(re.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=n=Object.assign({},e),delete n.element,n.target=i),i=e.target,typeof i=="string"&&(e=n=n||Object.assign({},e),n.target=e.owner[i])}super.construct(e);const r=this,{type:t}=r;r.target||(r.target=document.body),r.maskName=`mask${typeof t=="string"?t.trim():""}-${Na.counter++}`,r.show()}doDestroy(){const e=this,{element:r}=e;if(e.type==="trial")return!1;r&&(e.element=null,e.mode.endsWith("blur")&&C.forEachChild(r,t=>{t.classList.remove(`b-masked-${e.mode}`)}),e.target.classList.remove("b-masked"),e.target[e.maskName]=null,H.remove(Na.masks,e)),super.doDestroy()}get maskElement(){return this.element}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:r}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,[`b-mask-${e.mode}`]:1,"b-progress":r,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[r?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(e.progress/r*100)))}%`}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?`<i class="b-mask-icon ${e.icon}"></i>`:"")+e.text}]}]}}static mergeConfigs(...e){const r={};for(const t of e)typeof t=="string"?r.text=t:T.assign(r,t);return r}static mask(e,r=document.body){return Na.new({target:r},typeof e!="string"?{...e}:{text:e})}static unmask(e=document.body){const r=this.getElementMasks(e);return r.length>0?r[r.length-1].close():null}static unmaskAll(e=document.body){return this.getElementMasks(e).forEach(r=>r.close())}static getElementMasks(e){return this.masks.filter(r=>r.target===e)}updateAutoClose(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,r;(r=(e=this.owner)==null?void 0:e.syncMaskCover)==null||r.call(e,this)}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),e==null||e.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:r}=this;r.delay=e,e||r.flush()}deferredClose(){var e;const{owner:r}=this;this.close().then(()=>{var t;(t=r==null?void 0:r.onMaskAutoClose)==null||t.call(r,this)}),(e=r==null?void 0:r.onMaskAutoClosing)==null||e.call(r,this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:r,target:t,hiding:i,maskName:n}=e;i&&(i.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(r.classList.add("b-delayed-show"),e.delayedShow()),r.classList.add("b-visible"),r.classList.remove("b-hidden"),t.classList.add("b-masked"),t[n]||(t[n]=e,t.appendChild(r)),H.include(Na.masks,e),e.shown=!0,e.trigger("show"),e.mode.endsWith("blur")&&C.forEachChild(t,s=>{s!==r&&s.classList.add(`b-masked-${e.mode}`)})}hide(){const e=this,{target:r,element:t}=e;let{hiding:i}=e;if(!i){if(!e.shown)return Promise.resolve();e.hiding=i=new Va,e.shown=!1,t.classList.remove("b-visible"),t.classList.add("b-hidden"),r.classList.remove("b-masked"),e.mode.endsWith("blur")&&C.forEachChild(r,n=>{n!==t&&n.classList.remove(`b-masked-${e.mode}`)}),i.promise=i.promise.then(()=>{e.hiding===i&&(e.hiding=null)}),e.setTimeout(()=>i.resolve(),500,"hide")}return i.promise}async close(){await this.hide(),this.destroy()}},It=Na;R(It,"$name","Mask"),R(It,"type","mask"),R(It,"configurable",{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:{$config:"nullify",value:null},target:null,text:null,type:null,showDelay:null,useTransition:!1}),R(It,"delayable",{deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}}),R(It,"counter",0),R(It,"masks",[]),It._$name="Mask";var mC=e=>{var r;return r=class extends(e||F){get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}matchKeyMapEntry(t,i=this.keyMap){if(i&&!t.handled&&t.key!==void 0)return T.keys(i).find(n=>{const s=n.split("+"),a=s.includes("Alt"),o=s.includes("Shift"),l=s.includes("Ctrl");let c=s[s.length-1].toLowerCase();return c==="space"&&(c=" "),c===t.key.toLowerCase()&&(!t.altKey&&!a||t.altKey&&a)&&(!t.ctrlKey&&!l||t.ctrlKey&&l)&&(!t.shiftKey&&!o||t.shiftKey&&o)})}performKeyMapAction(t){var i;const{keyMap:n}=this;let s=!1;if(n&&!t.handled&&t.key!==void 0){const a=this.matchKeyMapEntry(t);if(n[a]){const o=H.asArray(n[a]);t.fromKeyMap=!0;let l;for(let c of o){if(l=!0,T.isObject(c)){if(!c.handler)continue;c.preventDefault===!1&&(l=!1),c=c.handler}if(typeof c=="string"){const{thisObj:d,handler:u}=this.resolveKeyMapAction(c);if(((i=d.isActionAvailable)==null?void 0:i.call(d,{keyCombination:a,actionName:c.split(".").pop(),action:c,event:t}))!==!1&&u.call(d,t)!==!1){s=!0;break}}else if(c.call(this)!==!1){s=!0;break}}delete t.fromKeyMap,s&&(l&&t.preventDefault(),t.handled=!0)}}return s}resolveKeyMapAction(t){const{keyMapSubComponents:i}=this;if(t.startsWith("up.")||t.startsWith("this."))return this.resolveCallback(t);if(i&&t.includes(".")){const[n,s]=t.split(".");if(n&&s)return{thisObj:i[n],handler:i[n][s]}}return{thisObj:this,handler:this[t]}}updateKeyMap(t){var i;(i=this.keyMapDetacher)==null||i.call(this),T.isEmpty(t)||(this.keyMapDetacher=j.on({element:this.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:this}))}keyMapOnKeyDown(t){this.performKeyMapAction(t)}mergeKeyMaps(t,i,n=null){const s={};t&&T.assign(s,t);for(const a in i){if(!i[a])continue;const o=H.asArray(t==null?void 0:t[a]),l=[];o!=null&&o.length&&l.push(...o);for(const c of H.asArray(i[a]))T.isObject(c)&&c.handler?l.push(T.assignIf({handler:(n?n+".":"")+c.handler},c)):l.push((n?n+".":"")+c);l.sort((c,d)=>{const u=(c.weight||0)-(d.weight||0);return u===0&&(o!=null&&o.length)?o.indexOf(c)-o.indexOf(d):u}),s[a]=l}return s}},R(r,"$name","KeyMap"),R(r,"configurable",{keyMap:{value:null,$config:{merge:"objects",nullify:!0}}}),r},pC=e=>{var r;return r=class extends(e||F){get widgetClass(){}get isRTL(){return this.rtl}updateRtl(t){const{element:i}=this;i&&(i.classList.toggle("b-rtl",t===!0),i.classList.toggle("b-ltr",t===!1))}startConfigure(t){var i,n;if((i=super.startConfigure)==null||i.call(this,arguments),!t.floating&&t.rtl==null){const s=this,a=t.rootElement||t.forElement||((n=s.parent)==null?void 0:n.contentElement)||(s.floating?s.floatRoot:s.changeElementRef(s.getRenderContext(t)[0]||t.adopt||document.body)),o=t.owner||t.parent||s.constructor.fromElement(a);o?t.rtl=o[o.isConfiguring?"peekConfig":"getConfig"]("rtl"):t.rtl=(a==null?void 0:a.nodeType)===1&&getComputedStyle(a).getPropertyValue("direction")==="rtl",t.rtl&&(s.configDone.rtl=!1)}}render(...t){var i,n;super.render&&super.render(...t),(Y.isChrome&&Y.chromeVersion<87||Y.isFirefox&&Y.firefoxVersion<66||Y.isSafari&&Y.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),(getComputedStyle(this.element).direction==="rtl"||(i=this.owner)!=null&&i.rtl)&&(this.rtl=!0,(n=this.childItems)==null||n.forEach(s=>s.rtl=!0))}},R(r,"$name","RTL"),R(r,"configurable",{rtl:null}),r},vC=Object.freeze({highlight:!1,onlyName:!1}),za=[],Th="highlightExternalChange",Mh=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,sc=Symbol("renderConfigObserver"),ST={INPUT:1,TEXTAREA:1},Ph=(e,r,t,i)=>{let n=(t==null?void 0:t.listeners)||(t==null?void 0:t.internalListeners);if(n=(n==null?void 0:n.on)||n,n){const s=j.on(T.assign({element:r,thisObj:e},n));i?(e._refListeners||(e._refListeners=Object.create(null)))[i]=s:t.listeners={on:n,un:s}}},yC=(e,r)=>e&&r&&r[T.keys(e)[0]]?Re.merge(e,r):e,wT=e=>{e.isVisible&&e.triggerPaint()},DT=/^:not\((.+)\)$/,ET=/absolute|fixed/i,xT=e=>e.scale!=null,{hasOwn:Vi}=T,{defineProperty:bC}=Reflect,CC=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3),SC=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],RT={configurable:!0,get(){return!1}},ac=/(?:L\{([^}.]+)\})/,TT=(e,r)=>"L{Tooltip."+r+"}",wC=/^([trblc])(\d*)-([trblc])(\d*)$/i,MT=(e,r)=>(wC.test(e)&&(e={align:e}),wC.test(r)&&(r={align:r}),Re.merge(e,r)),PT=/^[\w.]+$/,$=class extends F.mixin(Ve,Ae,ge,Gn,$i,mC,pC){static mergeCls(e,r){return r&&e?e=new J(r).assign(typeof e=="string"?new J(e):e):e&&!e.isDomClassList&&(e=new J(e)),e}static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,forwardTwinEvents:{$config:{merge:"classList"},value:null},parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:{$config:{merge:MT},value:"t-b"},centered:null,constrainTo:void 0,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:yC},value:null},showAnimation:{$config:{merge:yC},value:null},x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:or,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:"lazy",value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50}}}static get prototypeProperties(){return{hasGeneratedId:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return $._recomposeAsync}static set recomposeAsync(e){if($._recomposeAsync=e,e!=null){const{all:r}=$;for(let t=0;t<r.length;++t)r[t].isComposable&&(r[t].recomposeAsync=e)}}isType(e,r){return $.isType(this,e,r)}static setupRenderConfigs(e,r){const t=r.getInherited("renderConfigs"),{renderConfigs:i}=e;if(i){if(Array.isArray(i))for(const n of i)t[n]=!0;else T.assign(t,i);t[sc]=null}}construct(e={},...r){const t=this,{domSyncCallback:i}=t;t.configureAriaDescription=e.ariaDescription,t._isAnimatingCounter=0,t.alignConstrained=0,t.byRef=Object.create(null),t.onTargetResize=t.onTargetResize.bind(t),t.onFullscreenChange=t.onFullscreenChange.bind(t),t.domSyncCallback=i.$nullFn?null:i.bind(t),t._isUserAction=!1,super.construct(e,...r);const{recomposeAsync:n}=$;n!=null&&t.recomposeAsync==null&&(t.recomposeAsync=n),t.finalizeInit()}startConfigure(e){super.startConfigure(e);const r=this,{adopt:t,element:i}=r;t&&(r.adoptElement(i,t,e.id),r.updateElement(r._element,i))}finalizeInit(){var e;const r=this,t=r.insertBefore||r.appendTo||r.insertFirst||r.adopt;t&&(r.owner||(e=t.nodeType?t:document.getElementById(t))!=null&&e.isConnected?r.render():(r.onFirstResizeAfterConnect=r.onFirstResizeAfterConnect.bind(r),Je.addResizeListener(t,r.onFirstResizeAfterConnect)))}onFirstResizeAfterConnect(e){Je.removeResizeListener(e,this.onFirstResizeAfterConnect),!this.isDestroyed&&!this.rendered&&this.render()}doDestroy(){var e,r,t,i;const n=this,{preExistingElements:s,element:a,_refListeners:o,adopt:l}=n;if(yr.element===a&&yr.exit(),o&&(Object.values(o,c=>c()),n._refListeners=null),a){const c=!n._tooltip&&n._rootElement&&((e=$.Tooltip)==null?void 0:e.getSharedTooltip(n._rootElement,!0));if((c==null?void 0:c.owner)===n&&(c.owner=null,c.hide()),n.onExitFullscreen(),n.clearTimeout(n.scrollListenerTimeout),n.clearTimeout(n.resizeListenerTimeout),n.removeTransientListeners(),n.floating||n.positioned?n.hide(!1):n.revertFocus(),Je.removeResizeListener(a.parentElement,n.onParentElementResize),Je.removeResizeListener(a,n.onElementResize),l){for(let d=Array.from(a.childNodes),u=0,{length:h}=d;u<h;u++){const f=d[u];!s.includes(f)&&f!==n.floatRoot&&f.remove()}a.className=n.adoptedElementClassName,a.style.cssText=n.adoptedElementCssText}(r=n.dragEventDetacher)==null||r.call(n),(t=n.dragOverEventDetacher)==null||t.call(n),n.dragGhost.remove()}(i=n.connectedObserver)==null||i.disconnect(),super.doDestroy(),l||a.remove()}get assignValueDefaults(){return vC}get valueName(){return this.name||this.ref||this.id}getValueName(e){return e=e&&typeof e=="object"?e.onlyName:e,e?this.name:this.valueName}assignFieldValue(e,r,t){const i=this,n=i.defaultBindProperty;n in i&&(i[n]=t)}assignValue(e,r=vC){const t=this,i=t[Th],n=t.getValueName(r);n&&(!e||n in e)&&(r.highlight===!1&&(t[Th]=!1),t.assignFieldValue(e,n,e?e[n]:null),t[Th]=i)}gatherValue(e){const r=this,t=r.defaultBindProperty;r.constructor!==$&&t in r&&(e[r.name||r.ref||r.id]=r[t])}gatherValues(e){this.eachWidget(r=>r.gatherValue(e),!1)}get forwardTwinEvents(){const e=this._forwardTwinEvents;return e&&T.getTruthyKeys(e)}configureOverflowTwin(e){var r;const t=this;let i=T.clone(t.initialConfig);return delete i.id,i.hidden=!1,i.type=t.type,i._overflowTwinOrigin=t,i.disabled=t.disabled,"value"in t&&(i.value=t.value),(r=t.forwardTwinEvents)==null||r.forEach(n=>{delete i[`on${L.capitalize(n)}`]}),e&&(i=typeof e=="function"?e(i)||i:T.assign(i,e)),i}createOverflowTwin(e){var r;const t=this,i=t.configureOverflowTwin(e),n=$.create(i);return(r=t.forwardTwinEvents)==null||r.forEach(s=>{n.ion({[s]:a=>{t.overflowTwin===a.source&&(a=T.assign({},a),delete a.source,t.trigger(a.type,a))}})}),n}ensureOverflowTwin(e,r){let{overflowTwin:t}=this;return t||(this.overflowTwin=t=this.createOverflowTwin(e),r==null||r(t)),t}get isComposable(){return!this.compose.$nullFn}adoptElement(e,r,t){var i;const n=this,s=typeof r=="string"?document.getElementById(r):r,a=$.fromElement(s);a&&a.adopt&&a!==n&&(typeof a.adopt=="string"?document.getElementById(a.adopt):a.adopt)===s&&a.destroy(),n.preExistingElements=Array.from(s.childNodes),n.adoptedElementClassName=s.className,n.adoptedElementCssText=s.style.cssText,s.id&&!t&&(n.id=e.id=s.id),C.syncAttributes(e,s);for(let c=0,{length:d}=e.childNodes;c<d;c++)s.appendChild(e.childNodes[0]);delete n._contentRange,n._element=s;const o=e.lastDomConfig,l=o==null?void 0:o.listeners;l&&n.isComposable&&((i=l.un)==null||i.call(l),Ph(n,s,o)),s.lastDomConfig=o||s.lastDomConfig,s.$refOwnerId=n.id,n.scaleToFitWidth||n.getConfig("monitorResize")}addRefAccessor(e,r){const{prototype:t}=this.constructor;bC(t,r,{writable:!0,value:null}),bC(t,e,{get(){return this.recompose.flush(),this[r]},set(i){this[r]=i}})}attachRef(e,r,t){const i=this,n="_"+e;r.dataset&&(r.dataset.ownerCmp=i.id),i.isComposable&&(n in i||i.addRefAccessor(e,n),Ph(i,r,t,e)),i.byRef[e]=r,i[e]=r}detachRef(e,r,t){const i=this,n=i._refListeners;n!=null&&n[e]&&(n[e](),delete n[e]),i[e]=null,delete i.byRef[e]}afterRecompose(){}compose(){return{class:J.normalize(this.widgetClassList,"object")}}doCompose(){const e=this,{$meta:r}=e,t=r.hierarchy,i=r.renderConfigs||r.getInherited("renderConfigs");let{composers:n}=r,s=null,a,o,l,c;if(e.recompose.suspend(),!n){for(r.composers=n=[],l=t.indexOf($);l<t.length;++l)c=t[l].prototype,Vi(c,"compose")&&n.push(c);Vi(i,sc)||(i[sc]={get(d){i[d]=!0}})}for(e.configObserver=i[sc],l=0;l<n.length;++l)a=n[l].compose.call(e,s),s=s?C.merge(s,a):a;return Vi(e,"compose")&&(a=e.compose)&&(a=a.call(e,s),C.merge(s,a)),e.configObserver=null,C.normalizeChildren(s,(d,u)=>{u&&(o="_"+d,o in e||e.addRefAccessor(d,o))})}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const r=this,t=r.isComposable;return t&&(e=r.doCompose()),typeof e=="string"?e=C.createElementFromTemplate(e):T.isObject(e)?(e=C.createElement(e,{refOwner:r,callback:r.domSyncCallback}),r.recompose.resume(),t&&Ph(r,e,e.lastDomConfig)):C.isReactElement(r.peekConfig("html"))?e=document.createElement("div"):e.nodeType!==1&&(e=C.createElementFromTemplate(r.template(r))),e.id=r.id,r.elementAttributes&&C.setAttributes(e,r.elementAttributes),e}updateElement(e){const r=this,{className:t}=e,{contentElement:i,contentElementCls:n,isComposable:s}=r,a=i!==e,o=!s&&e.querySelectorAll("[data-reference]"),l=s?[]:r.widgetClassList;let c=(a||!s)&&r.uiClasses;if(t&&l.unshift(t),r._hidden&&l.push("b-hidden"),r._readOnly&&l.push("b-readonly"),Te.noThrow(e,"remove"),c?(n!=null&&n.value&&(c=c.slice(),c.push(n.value)),c=c.join(" ")):c=n==null?void 0:n.value,c&&(a?i.className+=" "+c:l.push(c)),!r.parent){const{defaultCls:d}=r,{outerCls:u}=$;l.push(...d?u.filter(h=>!(h in d)||d[h]):u)}if(e.className=l.join(" "),o)for(let d,u=0;u<o.length;++u)d=o[u],r.attachRef(d.getAttribute("data-reference"),d),d.removeAttribute("data-reference");!r.adopt&&!r.scaleToFitWidth&&r.getConfig("monitorResize"),r.getConfig("role"),r.getConfig("ariaLabel"),r.getConfig("ariaDescription"),r._html&&r.getConfig("htmlMutationObserver"),r.trigger("elementCreated",{element:e})}updateAriaDescription(e){const{ariaElement:r}=this,t=`${this.id}-aria-desc-el`;if(e){const i=this._ariaDescEl||(this._ariaDescEl=C.createElement({className:"b-aria-desc-element",id:t,parent:r}));i.innerText=e.match(ac)?this.L(e,this):e,r.setAttribute("aria-describedBy",i.id)}else r.getAttribute("aria-describedby")===t&&r.removeAttribute("aria-describedBy")}updateAriaLabel(e){C.setAttributes(this.ariaElement,{"aria-label":e!=null&&e.match(ac)?this.L(e,this):e})}updateAriaHasPopup(e){C.setAttributes(this.ariaElement,{"aria-haspopup":e})}updateRole(e){var r,t;e?(r=this.ariaElement)==null||r.setAttribute("role",e):(t=this.ariaElement)==null||t.removeAttribute("role")}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:T.getPath(this,e)}isCollapsified({collapsed:e,alt:r}){const{collapsify:t}=this,i=t==="hide",n=t===!1,s=t==null;return r?t==="overlay"||s&&e:n||i||s&&!e}async recompose(){const e=this,r={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await C.transition(T.assign({element:e.element,action(){q.sync(r)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else q.sync(r);r.changed&&(e.afterRecompose(),e.trigger("recompose")),e.resumeRecompose()}resumeRecompose(){this.recompose.resume()}changeElementRef(e){if(typeof e=="string"){const r=e;if(!(e=document.getElementById(r)))throw new Error(`No element found with id '${r}'`)}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,r){let t=r||e.appendTo,{insertFirst:i,insertBefore:n}=e;return i&&(t=i,n=t.firstChild),n&&(t||(t=n.parentElement)),[t,n||void 0]}render(e,r=!0){const t=this,{element:i}=t,[n,s]=t.getRenderContext(t,e);t.emptyCache(),t.syncElement&&t.currentElement?C.sync(i,t.currentElement):(n==null||n.insertBefore(i,s),t.currentElement=i),$.fromElement(i.parentElement)&&i.classList.remove(...$.outerCls),super.render(n,r),t.rendered=!0,t.getConfig("role"),r&&(t.getConfig("contentRange"),t.triggerPaint()),t.setupFocusListeners()}template({tag:e,html:r,htmlCls:t,name:i}){const n=this;typeof r=="string"&&PT.test(r)&&n.resolveCallback(r,n,!1)&&(r=n.callback(r,n,[n]));const s=r!=null&&r.call?r.call(n,n):r;return`<${e} class="${s?t:""}" ${i?`data-name="${i}"`:""}>${s||""}</${e}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var r;this._element&&!this.isDestroying&&((r=this.$meta.renderConfigs)!=null&&r[e])&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,r){return e==="style"?this._style:super.getConfigValue(e,r)}getCurrentConfig(e){const r=super.getCurrentConfig(e);return(e==null?void 0:e.depth)>0&&(r.type=this.type),r}get dataset(){return this.element.dataset}changeDataset(e){Object.assign(this.dataset,e)}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=C.createElement({html:"\xA0",style:"position:absolute;top:-10000em;left:-10000em"}))}updateParent(e){const{_element:r}=this;r&&r.classList[e?"remove":"add"](...$.outerCls)}get constrainTo(){let e=this._constrainTo;if(e=e===void 0?globalThis:(e==null?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?e.host||e.ownerDocument:e,this.positioned){const{offsetParent:r}=this.element;if(r&&C.getStyleValue(r,"overflow")==="hidden")e=k.from(r).moveTo(0,0);else if(e&&!e.isRectangle){const t=e===document||e===globalThis;e=k.from(e,r),t&&e.translate(globalThis.pageXOffset,globalThis.pageYOffset)}}return e}updateCentered(e){const{element:r,_anchorElement:t}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(r.classList.add("b-centered"),r.style.transform=r.style.left=r.style.top="",t==null||t.classList.add("b-hide-display"),r.classList.remove("b-anchored")):r.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:r}=e,t=e._contentRange||(e._contentRange=new Range);return t.collapsed&&(t.setStart(r,e.contentRangeStartOffset||0),t.setEnd(r,e.contentRangeEndOffset||r.childNodes.length)),t}fixRefOwnerId(e,r,t){if(e.$refOwnerId===t){e.$refOwnerId=r;for(let{childNodes:i}=e,n=i.length;n-- >0;)this.fixRefOwnerId(i[n],r,t)}}get placement(){var e;const r=this,{element:t}=r;let i,n,s;if(t!=null&&t.offsetParent&&!ET.test(C.getStyleValue(t,"position"))){const a=t.nextElementSibling,o=t.previousElementSibling,l=!a&&o;n=C.getStyleValue(t.parentElement,"flex-direction"),n?n=n.startsWith("row")?"h":"v":(i=(e=a||o)==null?void 0:e.getBoundingClientRect(),s=i&&t.getBoundingClientRect(),n=i&&Math.abs(i.top-s.top)<Math.abs(i.left-s.left)?"h":"v"),n+=n==="h"?l?"r":"l":l?"b":"t"}return n}updateId(e,r){if(super.updateId(e,r),r){const{byRef:t,element:i}=this;for(const n in t)t[n].dataset&&(t[n].dataset.ownerCmp=e);i.id=e,this.fixRefOwnerId(i,e,r)}}get style(){const{element:e}=this;return(e==null?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}updateStyle(e){this.element&&C.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var r;const t=this,{lastAlignSpec:i,element:n}=t,{offsetParent:s,style:a,classList:o}=n;if(i&&(i.monitorIntersection&&t.intersectionObserver.unobserve(i.target),isFinite(i.zone)&&n.classList.remove(SC[i.zone])),!e){t.removeTransientListeners(),t.anchor=t.lastAlignSpec=null;return}t.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||e.$$name==="Point")&&(e={target:e}),t.releaseSizeConstraints();const{scrollable:l,constrainTo:c}=t,d=t.positioned&&C.getStyleValue(n,"position")!=="fixed",u=t.scale||1,h=e.target,f=e.domEvent||e.event||h,g=h!=null&&h.isRectangle?h:(h==null?void 0:h.element)||h,m=k.from(n,d?s:null,!0),{width:p,height:v}=m,y=(g==null?void 0:g.nodeType)===Element.ELEMENT_NODE,S=((r=f==null?void 0:f.target)==null?void 0:r.nodeType)===Element.ELEMENT_NODE;e=e.realignTarget?e:T.assign({aligningToEvent:S,aligningToElement:y,constrainTo:c,align:"b-t",axisLock:t.axisLock,anchor:t.anchor},t.align,e);const D=e.minWidth||t.minWidth,w=e.minHeight||t.minHeight;if(m.isAlignRectangle=!0,D&&(m.minWidth=D*u),w&&(m.minHeight=w*u),t.lastAlignSpec=e,S)delete e.target,e.domEvent=f,e.anchoredTo=f.target,e.position=new ir(f.clientX+1,f.clientY+1);else if(y&&(e.target=g,ni(g instanceof SVGElement?g.closest("svg"):g))){if(e=Object.setPrototypeOf({},e),e.target=t.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?k.from(g,d?s:null,!d):C.isInView(g,!1,t)),!e.target){const N=t.hide();return t.isDestroyed||(t.lastAlignSpec.targetOutOfView=!0),N}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1),t.lastAlignSpec.anchoredTo=g}e.anchor&&(e.anchorSize=t.anchorSize,n.contains(t.anchorPathElement)||n.appendChild(t.anchorElement)),t.isAligning=!0,t.trigger("beforeAlign",e),t.isAligning=!1,e.rtl=t.rtl,(e.align.includes("s")||e.align.includes("e"))&&(t.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const E=t.lastAlignSpec.result=m.alignTo(e);let{align:x,anchor:M,x:I,y:P,width:_,height:A,overlap:V}=E;if(t.lastAlignSpec.zone=E.zone,A!=v&&("configuredHeight"in t||(t.configuredHeight=a.height),t.height=A/u,t.minHeight||(a.minHeight="unset"),t.alignConstrained=t.alignConstrained|1,l&&(l.overflowY=!0)),_!=p&&("configuredWidth"in t||(t.configuredWidth=a.width),t.width=_/u,t.minWidth||(a.minWidth="unset"),t.alignConstrained=t.alignConstrained|2,l&&(l.overflowX=l.clientWidth>l.scrollWidth)),x&&t.alignConstrained){e.align=x;const N=t.lastAlignSpec.result=k.from(n,d?s:null,!0).alignTo(e);M=N.anchor,I=N.x,P=N.y,_=N.width,A=N.height}if(t.centered||t.setXY(I,P),!E.overlap&&isFinite(E.zone)&&o.add(SC[E.zone]),M!=null&&M.edge){const{edge:N}=M,{anchorElement:B}=t,Z=k.from(n),K=[];N==="top"||N==="bottom"?(K[0]=M.x,K[1]=N==="top"?1:Z.height-1):(K[0]=N==="left"?1:Z.width-1,K[1]=M.y),B.classList.add("b-hide-display");let se=C.childFromPoint(n,...K);if(se!=null&&se.matches(":hover,:focus")&&n.compareDocumentPosition(se)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(se=se.parentNode),se&&se!==document){let xe=C.getStyleValue(se,"background-color");for(;xe.match(Mh)&&C.getStyleValue(se,"position")!=="absolute"&&(se=se.parentNode,se!==document);)xe=C.getStyleValue(se,"background-color");xe.match(Mh)?t.anchorPathElement.setAttribute("fill",t.defaultAnchorBackgroundColor):t.anchorPathElement.setAttribute("fill",xe)}B.classList.remove("b-hide-display"),B.style.transform="",B.className=`b-anchor b-anchor-${N}`,M.x&&(M.x/=u),M.y&&(M.y/=u),C.setTranslateXY(B,M.x,M.y),o.add("b-anchored")}else t._anchorElement&&(t.anchorElement.classList.add("b-hide-display"),o.remove("b-anchored"));if(!y){a.pointerEvents="none";const N=C.elementFromPoint(I,P);t.owns(N)||(t.lastAlignSpec.anchoredTo=N),a.pointerEvents=""}if((t.scrollAction==="realign"&&y||t.scrollAction==="hide")&&!t.documentScrollListener&&(t.clearTimeout(t.scrollListenerTimeout),e.monitorTargetMutation&&!t.targetObserver&&(t.targetObserver||(t.targetObserver=new MutationObserver(t.onTargetParentMutation.bind(t)))).observe(C.getRootElement(g),{childList:!0,attributes:!0,subtree:!0}),t.scrollListenerTimeout=t.setTimeout(()=>{var N,B;const Z=(B=(N=y?g:t.lastAlignSpec.anchoredTo).getRootNode)==null?void 0:B.call(N);t.documentScrollListener=j.addListener(document,"scroll","doHideOrRealign",{capture:!0,thisObj:t}),Z!=null&&Z.mode&&(t.targetRootScrollListener=j.addListener(Z,"scroll","doHideOrRealign",{capture:!0,thisObj:t}))},t.scrollAction==="hide"?t.ignoreScrollDuration:0)),y&&(e.monitorResize&&!t.targetResizeListener&&(Je.addResizeListener(g,t.onTargetResize),t.targetResizeListener=!0),e.monitorIntersection&&!(V||g.contains(n)||g.ownerSVGElement)&&t.intersectionObserver.observe(g)),!Y.isAndroid&&!t.constrainListeners){const N=c!=null&&c.isRectangle?globalThis:c;t.clearTimeout(t.resizeListenerTimeout),t.resizeListenerTimeout=t.setTimeout(()=>{t.constrainListeners=!0,Je.addResizeListener(N||globalThis,t.onAlignConstraintChange)},t.ignoreScrollDuration)}}onTargetParentMutation(e){var r;const{element:t,lastAlignSpec:i}=this;i!=null&&i.aligningToElement&&((r=i.target)!=null&&r.isConnected?e.some(({target:n})=>n.contains(i.target)&&!t.contains(n))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionchange.bind(this),{root:Y.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionchange(e){if(!this.isDestroyed){const r=e[e.length-1];r.isIntersecting||this.onAlignTargetOutOfView(r.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:r,height:t}=e.targetRect,{width:i,height:n}=e.target.getBoundingClientRect();(i!==r||n!==t)&&this.onAlignConstraintChange(...arguments)}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}onAlignConstraintChange(e,r,{height:t}){const{style:i}=this.contentElement,{overflowY:n}=i;this.setTimeout(this.realign,50),r&&t>r.height&&(i.overflowY="hidden",this.requestAnimationFrame(()=>i.overflowY=n))}realign(){const e=this,{lastAlignSpec:r}=e;if((e.floating||e.positioned)&&r&&e.isVisible){if(r.aligningToElement){const t=r.target.contains(this.element),i=C.isInView(r.target,!1,e);if(!r.allowTargetOut&&(!ni(r.target)||!i)){e.hide(),e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0);return}r.realignTarget=t?null:i}C.addTemporaryClass(e.element,"b-realigning",e.realignTimeout,e),e.alignTo(r)}}rectangle(e,r,t){return this.rectangleOf("element",e,r,t)}rectangleOf(e,r,t,i){return typeof r!="string"?(i=t,t=r,r=""):r==="border"&&(r=""),typeof t=="boolean"&&(i=t,t=void 0),e!=="element"&&t===void 0&&(t=this.element),t=t!=null&&t.isWidget?t.element:t,k[r||"from"](this[e],t,i)}releaseSizeConstraints(){const e=this,{scrollable:r}=e,{style:t}=e.element;e.alignConstrained&1&&(e.height=e.configuredHeight,t.minHeight=e._minHeight||"",r&&(r.overflowY=r.config.overflowY)),e.alignConstrained&2&&(e.width=e.configuredWidth,t.minWidth=e._minWidth||"",r&&(r.overflowX=r.config.overflowX)),e.alignConstrained=0}toFront(){const{element:e}=this,r=this.floating?this.floatRoot:this.positioned?e==null?void 0:e.parentNode:null,t=document.createDocumentFragment();for(let i=e.nextSibling,n;i;i=n)n=i.nextSibling,r.contains(i)&&!this.owns(i)&&t.appendChild(i);r.insertBefore(t,e)}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return typeof e=="string"?{align:e}:e}changeScrollable(e,r){return typeof e=="boolean"&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=r?r.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):r==null||r.destroy(),e}handleReactElement(e){const r=this.closest(t=>t.reactComponent);r!=null&&r.reactComponent&&r.reactComponent.processWidgetContent({reactElement:e,widget:this,reactComponent:r.reactComponent})}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const r=this,t=e==null,{element:i,contentElement:n,htmlCls:s}=r;if(!i&&C.isReactElement(e)){r.whenVisible(()=>r.handleReactElement(e));return}if(i){r.updatingHtml=!0;const a=n===i&&r._anchorElement;s&&s.values.forEach(o=>i.classList[t?"remove":"add"](o)),a&&i.removeChild(a),e&&typeof e=="object"?C.isReactElement(e)?r.handleReactElement(e):q.sync({domConfig:{...e,onlyChildren:!0},targetElement:r.contentElement}):r.contentElement.innerHTML=t?"":e,r.getConfig("htmlMutationObserver"),a&&i.appendChild(a),r.isComposable?r.recompose():(r.floating||r.positioned)&&(r.isAligning||r.realign())}}changeHtmlMutationObserver(e,r){const t=this,{contentElement:i}=t;if(r==null||r.disconnect(),e){const n=new MutationObserver(()=>{t.updatingHtml?t.updatingHtml=!1:t._html=i.innerHTML});return n.observe(i,e),n}}updateContent(e){const r=this,t=e==null,{element:i,htmlCls:n}=r;if(i){const{contentRange:s}=r;n&&n.values.forEach(a=>i.classList[t?"remove":"add"](a)),i.isConnected?(s.deleteContents(),t||s.insertNode(C.createElementFromTemplate(e,{fragment:!0}))):r.contentElement.innerHTML=e,r.contentRangeStartOffset=s.startOffset,r.contentRangeEndOffset=s.endOffset,(r.floating||r.positioned)&&!r.isAligning&&r.realign()}}onThemeChange(){var e;(e=this.anchorElement)!=null&&e.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let r=this._anchorSize;if(!r){const t=parseFloat(C.getStyleValue(e.element,"border-top-width")),i=C.getStyleValue(e.element,"border-top-color"),n=e.anchorElement,{className:s}=n,a=n.firstElementChild,o=e.anchorPathElement=a.lastElementChild,l=e._hidden;n.className="b-anchor b-anchor-top";let c=C.getStyleValue(e.contentElement,"background-color");c.match(Mh)&&(c=C.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=c,r=n.getBoundingClientRect();const[d,u]=r=e._anchorSize=[r.width,r.height];n.className=s,a.setAttribute("height",u+t),a.setAttribute("width",d),o.setAttribute("d",`M0,${u}L${d/2},0.5L${d},${u}`),t&&(o.setAttribute("stroke-width",t),o.setAttribute("stroke",i)),r[1]-=t,l&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=he.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return r}get anchorElement(){const e=this;if(!e._anchorElement){const r=e.floating,t=`${e.id}-shadow-filter`;e._anchorElement=C.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[r?{tag:"defs",children:[{tag:"filter",id:t,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[r?"filter":""]:`url(#${t})`}]}]})}return e._anchorElement}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){var r,t,i;const n=this,{element:s}=n;e?(n.dragEventDetacher=j.addListener({element:s,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:n}),n.dragDetacher=j.on({element:s,mousedown(a){const{target:o}=a,l=$.fromElement(o);(!a.target.closest(".b-field-inner")&&l===this||this.strips&&Object.values(this.strips).includes(l))&&s.setAttribute("draggable","true")},thisObj:n})):((r=n.dragEventDetacher)==null||r.call(n),(t=n.dragOverEventDetacher)==null||t.call(n),(i=n.dragDetacher)==null||i.call(n))}onWidgetDragStart(e){var r;const t=this;if(!t.validateDragStartEvent(e))return;const{element:i,align:n,constrainTo:s}=t,a=t.positioned&&C.getStyleValue(i,"position")!=="fixed",o=a?i.parentElement:t.rootElement,l=k.from(i,a?o:null),c=e.clientX,d=e.clientY,u=document.scrollingElement||document.body,[h,f]=a?C.getOffsetXY(i,o):t.getXY(),g=(r=a?k.content(o).moveTo(0,0):s&&(s!=null&&s.isRectangle?s:k.from(s)))==null?void 0:r.deflate(n.constrainPadding||0),m={element:o,dragover:p=>{i.classList.remove("b-centered"),l.moveTo(h+p.clientX-c-(a?0:u.scrollLeft),f+p.clientY-d-(a?0:u.scrollTop)),g&&l.constrainTo(g),C.setTranslateXY(i,l.x,l.y)}};Y.isTouchDevice&&(m.touchmove=p=>p.preventDefault()),t.floatRoot.appendChild(t.dragGhost),t.setDragImage(e),e.dataTransfer.effectAllowed="none",t.dragOverEventDetacher=j.addListener(m),t.alignTo()}validateDragStartEvent(e){var r;const t=this,{element:i}=t,n=C.elementFromPoint(e.clientX,e.clientY),{handleSelector:s}=t.draggable;if(s){const a=(r=DT.exec(s))==null?void 0:r[1];if(a){if(n.closest(`#${i.id} ${a}`))return e.preventDefault(),!1}else if(!n.closest(`#${i.id} ${s}`))return e.preventDefault(),!1}return!0}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,-9999,-9999))}setStyle(e,r){return C.applyStyle(this.element,T.isObject(e)?e:{[e]:r}),this}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),this.element.removeAttribute("draggable")}changeFloating(e){return!!e}changePositioned(e){return!!e}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[C.getPageX(this.element),C.getPageY(this.element)]}setXY(e,r){const t=this,{element:i}=t;if(t.floating||t.positioned){if(e!=null&&(t._x=e),r!=null&&(t._y=r),C.getStyleValue(i,"position")==="fixed"){const n=i.getBoundingClientRect(),[s,a]=C.getTranslateXY(i),o=e-n.x,l=r-n.y;C.setTranslateXY(i,s+o,a+l)}else C.setTranslateXY(i,t._x||0,t._y||0);t.isConstructing?t.centered=!1:i.classList.remove("b-centered")}}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,r=e.element;return e.monitorResize?(e._width==null&&(e._width=r.offsetWidth),e._width):r.offsetWidth}changeWidth(e){const r=this;C.setLength(r.element,"width",e),r._lastWidth=e,r._width=null,r._flex=null,r.element.style.flex=""}clearWidthCache(){this._width=null}get maxWidth(){return C.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){C.setLength(this.element,"maxWidth",e)}get minWidth(){return C.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){C.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),(typeof e=="number"||!isNaN(e))&&(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,r){r&&this.element.classList.remove(`b-text-align-${r}`),this.element.classList.add(`b-text-align-${e}`)}updatePlaceholder(e){this.input&&(e==null?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}get height(){const e=this,r=e.element;return e.monitorResize?(e._height==null&&(e._height=r.offsetHeight),e._height):r.offsetHeight}changeHeight(e){C.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return C.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){C.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return C.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){C.setLength(this.element,"minHeight",e)}updateDisabled(e=!1){const{element:r,focusElement:t,ariaElement:i}=this;this.trigger("beforeUpdateDisabled",{disabled:e}),!(e&&(this.revertFocus(),this._disabled!==e))&&(r&&(r.classList[e?"add":"remove"]("b-disabled"),t&&(t.disabled=e),i&&i.setAttribute("aria-disabled",e)),this.onDisabled(e))}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,r=yr.request(e.floating?e.floatRoot:e.element);return yr.onFullscreenChange(e.onFullscreenChange),e.element.classList.add("b-fullscreen"),r}exitFullscreen(){return yr.exit()}onFullscreenChange(){yr.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){yr.unFullscreenChange(this.onFullscreenChange),this.element.classList.remove("b-fullscreen")}get tooltip(){var e;if(this._tooltip)return this._tooltip;{const r=(e=$.Tooltip)==null?void 0:e.getSharedTooltip(this.rootElement);if(r&&r.activeTarget===this._element&&r.isVisible)return r}}changeTooltip(e,r){var t;const i=this,{element:n}=i;if(e){if(!(i.preventTooltipOnTouch&&Y.isTouchDevice))if(!e.isTooltip&&e.constructor.name!=="Object"&&(e={html:typeof e=="string"?e:i.placeholder,textContent:!0}),i.configureAriaDescription||(i.ariaDescription=(t=e.html)!=null&&t.match(ac)?e.html.replace(ac,TT):e.html),r!=null&&r.isTooltip||e.newInstance)e.type="tooltip",e.forElement||(e.forElement=n),!("showOnHover"in e)&&!e.forSelector&&(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),e=$.reconfigure(r,e,i),i.detachListeners("tooltipValueListener"),i.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:i});else{n.dataset.btip=!0,i.tipConfig=e;return}}else if(r)if(e==null&&r.isTooltip)r.destroy();else{r.html=null;return}else delete n.dataset.btip;return e}onTooltipValueChange({value:e,source:r}){this.ariaDescription=typeof e=="string"?e:r.contentElement.innerText}get tooltipText(){const e=this._tooltip;if(e)return e.isTooltip?e.contentElement.innerText:typeof e=="string"?e:e.html;if(this.tipConfig)return this.tipConfig.html}get isVisible(){const e=this,{element:r}=e;let t;return!!(r&&!e._hidden&&!e.isDestroying&&r.isConnected&&(!e.requireSize||ni(r))&&(!(t=e.containingWidget)||t.isVisible))}whenVisible(e,r=this,t,i=e){const n=this;n.isVisible&&n.isPainted?n.callback(e,r,t):(n.toCallWhenVisible||(n.toCallWhenVisible=new Map)).set(i,{callback:e,thisObj:r,args:t})}focus(){this.isFocusable&&C.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=!this.isDestroying&&this.isVisible&&!this.disabled&&this.focusElement;return e&&(e===document.body||e.offsetParent)}async show({align:e,animate:r=!0}={}){const t=this,{element:i,floating:n}=t,{style:s}=i,a=r&&t.showAnimation;let o,l,c=!t.isVisible;return c&&(c=t.trigger("beforeShow"),T.isPromise(c)&&(c=await c)),c!==!1&&(!t.internalBeforeShow||t.internalBeforeShow()!==!1)?new Promise(d=>{if(t.cancelHideShowAnimation(),t.updateCentered(t._centered),n){const u=t.floatRoot;u.contains(i)||(t.rendered?u.appendChild(t.element):t.render(u,!1)),s.transform.includes("scale")&&(t.scale=null,s.transform=s.transformOrigin="");const h=t.closest(xT);if(h){const{scale:f}=h;t.scale=f,s.transform=`scale(${f})`,s.transformOrigin="0 0"}}if(t._hidden=!1,i.classList.remove("b-hidden"),n&&!eh(i)&&(t.hide(!1),d()),t.onConfigChange({name:"hidden",value:!1,was:!0,config:t.$meta.configs.hidden}),a){o=Object.keys(a)[0],l=a[o];const u=t.currentAnimation={showing:!0,styleProp:o,resolve:d};t.isAnimating=!0,s.transition="none",s[o]=l.from,C.getStyleValue(i,o),t.currentAnimation.detacher=j.onTransitionEnd({element:i,property:o,duration:CC(l.duration)+20,handler:()=>t.afterHideShowAnimate(u),thisObj:t}),s.transition=`${o} ${l.duration} ease ${l.delay}`,s[o]=l.to}t.afterShow(e,a?null:d)}):Promise.resolve()}async showBy(e,r,t){const i=this,n=Array.isArray(e);if(n||typeof e=="number"){const s=n?e:[e,r];e=Object.assign({target:new ir(s[0]+1,s[1]+1),matchSize:!1,align:"t0-b0"},n?r:t)}if(i.requireSize=!0,i.isVisible)C.addTemporaryClass(i.element,"b-realigning",300,i),i.alignTo(e);else return i.show({align:e})}async showByPoint(){return re.deprecate("Core","6.0.0","Widget.showByPoint() replaced by Widget.showBy() with the same signature"),this.showBy(...arguments)}afterShow(e,r){var t,i;const n=this;n.trigger("show"),n._configuredAnchorState=n.anchor,(i=(t=n.owner)==null?void 0:t.onChildShow)==null||i.call(t,n),n.triggerPaint(),(n.floating||n.positioned)&&(e?n.alignTo(e):n.centered?n.alignTo({target:n.constrainTo,align:"c-c"}):n.forElement&&n.alignTo(n.forElement)),r==null||r()}onChildHide(e){e.floating&&this.ariaElement.removeAttribute("aria-owns")}onChildShow(e){e.floating&&(this.ariaHasPopup=e.role,this.ariaElement.setAttribute("aria-owns",e.id))}triggerPaint(){const e=this,{element:r,toCallWhenVisible:t}=e,i=!e.isPainted;if(e.isVisible){if(i&&(e.getConfig("scrollable"),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),Je.addResizeListener(r.parentElement,e.onParentElementResize),e.updateScale()),!e.hideBryntumDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&r.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),r.firstChild),e.onConnectedCallback&&globalThis.ResizeObserver&&(e.connectedObserver=new ResizeObserver(()=>{e.isElementConnected&&!r.isConnected?(e.onConnectedCallback(!1),e.isElementConnected=!1):!e.isElementConnected&&r.isConnected&&(e.onConnectedCallback(!0,e.isElementConnected==null),e.isElementConnected=!0)}),e.connectedObserver.observe(r))),e.eachWidget(wT,!1),i&&(e.rootElement=C.getRootElement(r),e.getConfig("tooltip"),!$.Ripple&&$.RippleClass&&($.Ripple=new $.RippleClass({rootElement:e.rootElement})),globalThis.DocsBrowser&&e.floating&&e.closest(n=>{var s;return(s=n.element)==null?void 0:s.closest(".fiddlePanelResult,.b-owned-by-fiddle")})&&r.classList.add("b-owned-by-fiddle")),e.isPainted=!0,i&&e.triggerConfigs("paint"),e.trigger("paint",{firstPaint:i}),t!=null&&t.size){for(const{callback:n,thisObj:s,args:a}of t.values())e.callback(n,s,a);t.clear()}i&&e.monitorResize&&!e.scaleToFitWidth&&Je.onElementResize([{target:r}])}}cancelHideShowAnimation(){const e=this,{currentAnimation:r,element:t}=e;r&&(e.isAnimating=!1,t.classList.contains("b-hiding")&&(t.classList.remove("b-hiding"),e._hidden=!1),r.detacher(),r.resolve(),t.style.transition=t.style[r.styleProp]="",e.currentAnimation=null,e.trigger(`${r.showing?"show":"hide"}AnimationEnd`))}afterHideShowAnimate(e){const r=this;e===r.currentAnimation&&(r.element.classList.remove("b-hiding"),r.cancelHideShowAnimation(),r._hidden&&r.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",RT)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise(r=>{const t=this,{element:i,lastAlignSpec:n}=t,{style:s}=i,a=e&&t.hideAnimation;if(t.clearTimeout(t.scrollListenerTimeout),t.clearTimeout(t.resizeListenerTimeout),!t._hidden&&t.trigger("beforeHide",{animate:e})!==!1){if(t._hidden=!0,n&&(n.targetOutOfView=null,n.monitorIntersection&&(t.intersectionObserver.takeRecords(),t.intersectionObserver.unobserve(n.target))),t.onConfigChange({name:"hidden",value:!0,was:!1,config:t.$meta.configs.hidden}),!i){r();return}if(i.contains(C.getActiveElement(i))&&t.revertFocus(!0),t.isDestroyed){r();return}if(t.cancelHideShowAnimation(),a){const o=Object.keys(a)[0],l=a[o];if(Number(getComputedStyle(t.element)[o])!==l.to){const c=t.currentAnimation={hiding:!0,styleProp:o,resolve:r};i.classList.add("b-hiding"),t.isAnimating=!0,t.currentAnimation.detacher=j.onTransitionEnd({element:i,property:o,duration:CC(l.duration)+20,handler:()=>t.afterHideShowAnimate(c),thisObj:t}),s[o]=l.from,C.getStyleValue(i,o),s.transition=`${o} ${l.duration} ease ${l.delay}`,s[o]=l.to}else i.classList.add("b-hidden")}else i.classList.add("b-hidden");t.afterHide(!a&&r,a)}})}doHideOrRealign({target:e,isTrusted:r}){const t=this,{lastAlignSpec:i,element:n}=t,s=i==null?void 0:i.anchoredTo,a=i==null?void 0:i.target,o=i==null?void 0:i.position,l=C.getActiveElement(t);if(!r||!ni(n)||e&&(n.contains(e)||e.nodeType===Element.ELEMENT_NODE&&t.owns(e)||e.nodeType===Element.DOCUMENT_NODE&&n.contains(l)&&ST[l]&&globalThis.innerHeight<document.body.offsetHeight))return;if(i.aligningToElement){const d=C.isInView(a,!1,t);if(d&&d.equals(i.targetRect))return}const c=t.scrollAction==="hide"&&t.getXY();if(t.realign(),!t.isDestroyed&&eh(n)&&t.scrollAction==="hide"){const[d,u]=t.getXY(),h=d!==c[0]||u!==c[1];(i!=null&&i.aligningToEvent||(h||(a==null?void 0:a.$$name)==="Point"||o)&&(!s||!ni(s)||e&&C.isDescendant(e,s)))&&t.hide()}}afterHide(e=null,r=this.hideAnimation){var t,i;const n=this;n._anchor=n._configuredAnchorState,n.removeTransientListeners(),r||n.afterHideAnimation(),n.trigger("hide"),(i=(t=n.owner)==null?void 0:t.onChildHide)==null||i.call(t,n),e&&e()}removeTransientListeners(){var e,r,t;const i=this,{targetObserver:n,lastAlignSpec:s}=i;if(i.clearTimeout(i.resizeListenerTimeout),i.clearTimeout(i.scrollListenerTimeout),n&&(n.disconnect(),delete i.targetObserver),i.documentScrollListener=(e=i.documentScrollListener)==null?void 0:e.call(i),i.targetRootScrollListener=(r=i.targetRootScrollListener)==null?void 0:r.call(i),i.targetResizeListener&&(Je.removeResizeListener(s.target,i.onTargetResize),i.targetResizeListener=!1),i.constrainListeners){const a=(t=s.constrainTo)!=null&&t.isRectangle?globalThis:s.constrainTo;Je.removeResizeListener(a||globalThis,i.onAlignConstraintChange),i.constrainListeners=!1}}afterHideAnimation(){const e=this,{element:r}=e;e.floating&&e.floatRoot.contains(r)?r.remove():r.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const r=this;let t;return r.isConfiguring?(t=!!e,r.element.classList[e?"add":"remove"]("b-hidden")):(r.trigger("beforeChangeHidden",{hidden:e}),e?r.hide():r.show()),t}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}get containingWidget(){var e,r;let t=this.parent;if(!t){const i=((e=this.forElement)==null?void 0:e.nodeType)===Element.ELEMENT_NODE?this.forElement:(r=this.element)==null?void 0:r.parentNode;t=(i==null?void 0:i.closest(".b-widget"))&&$.fromElement(i)}return t}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const r=this,{parent:t}=r,i=t?t.childItems:Array.from(r.element.parentElement.querySelectorAll(".b-widget"));return t?i[i.indexOf(r)+e]:$.fromElement(i[i.indexOf(r.element)+e])}up(e,r,t){var i;const{owner:n}=this;return e?(i=n==null?void 0:n.closest)==null?void 0:i.call(n,e,r,t):n}closest(e,r,t){const i=typeof t,n=i==="number",s=i==="string";for(let a=this,o=1;a;a=a.owner,o++){if($.widgetMatches(a,e,r))return a;if(n&&o>=t)return;if(s&&$.widgetMatches(a,t,r))return;if(a===t)return}}owns(e){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=$.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let r=this.owner;for(;r;){if(e(r)===!1)return!1;r=r.owner}return!0}changeMonitorResize(e,r){const t=this.scaleToFitWidth?!1:!!e;if(t!==!!r)return t}updateMonitorResize(e){const r=this;Vi(r,"onElementResize")||(r.onElementResize=r.onElementResize.bind(r)),Je[e?"addResizeListener":"removeResizeListener"](r.element,r.onElementResize)}changeReadOnly(e){if(e=!!e,!!this._readOnly!==e)return e}updateReadOnly(e){var r;(r=this.element)==null||r.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget(t=>{t.ignoreParentReadOnly||("_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly)},!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,r=!0){const t=this.childItems,i=(t==null?void 0:t.length)||0,n={};for(let s=0;s<i;s++){const a=t[s];if(n.down=r,e(a,n)===!1||n.down&&a.eachWidget&&a.eachWidget(e,r)===!1)return!1}return!0}queryAll(e){const r=[];return this.eachWidget(t=>{e(t)&&r.push(t)}),r}query(e){let r=null;return this.eachWidget(t=>{if(e(t))return r=t,!1}),r}getWidgetByRef(e){var r,t;return e instanceof $?e:((r=this==null?void 0:this.widgetMap)==null?void 0:r[e])||((t=this==null?void 0:this.owner)==null?void 0:t.getWidgetByRef(e))}onFocusIn(e){const r=this,{element:t}=r;r.containsFocus=!0,r.focusInEvent=e,(r.floating||r.positioned)&&r.toFront(),t.classList.add("b-contains-focus"),r.updateAriaLabel(r.localizeProperty("ariaLabel")),r.updateAriaDescription(r.localizeProperty("ariaDescription")),t.contains(e._target)&&r.onInternalKeyDown&&!r.keyDownListenerRemover&&(r.keyDownListenerRemover=j.on({element:t,keydown:"onInternalKeyDown",thisObj:r})),r.trigger("focusin",e)}onFocusOut(e){const r=this;r.keyDownListenerRemover&&(r.keyDownListenerRemover(),r.keyDownListenerRemover=null),r.isDestroyed||(e.relatedTarget||r.revertFocus(!r.isVisible),r.containsFocus=!1,r.element.classList.remove("b-contains-focus"),r.updateAriaLabel(r.localizeProperty("ariaLabel")),r.updateAriaDescription(r.localizeProperty("ariaDescription")),r.trigger("focusout",e))}captureFocus(){const e=this,r=C.getActiveElement(e),t=e.contains(r)&&e.captureFocusItem(r);return(i,n)=>{t&&!e.isDestroying&&(C.getActiveElement(e)!==r||n)&&t(i)}}captureFocusItem(e){return(r=!0)=>{this.contains(e)&&(r?e.focus():C.focusWithoutScrolling(e))}}contains(e,r){const{element:t}=this;if(e&&t)return e.isWidget&&(e=e.element),t.contains(e)&&(!r||t!==e)}revertFocus(e){var r;const t=this,i=C.getActiveElement(t);let n=(r=t.focusInEvent)==null?void 0:r.relatedTarget;(e||t.containsFocus&&(n==null?void 0:n.nodeType)===Element.ELEMENT_NODE&&t.element.contains(i))&&((!n||!C.isFocusable(n))&&(n=t.getFocusRevertTarget()),t._isRevertingFocus=!0,n&&C.isFocusable(n)?(n._isRevertingFocus=!0,C.focusWithoutScrolling(n),n._isRevertingFocus=!1):i==null||i.blur(),t._isRevertingFocus=!1)}getFocusRevertTarget(){var e;const r=this,{owner:t,focusInEvent:i}=r,n=i&&i.backwards?1:-1;let s=i&&i.relatedTarget;const a=s&&$.fromElement(s);if(t&&!t.isDestroyed&&(!s||!C.isFocusable(s)||a&&!a.isFocusable)){if(s=null,t.eachWidget){const o=[];if(t.eachWidget(l=>{(l===r||l.isFocusable)&&o.push(l)},!1),o.length>1){const l=o.indexOf(r);s=o[l+n]||o[l-n]}}!s&&t.isFocusable&&(s=t),s=s?s.focusElement:(e=t.getFocusRevertTarget)==null?void 0:e.call(t)}return s}getStaticWidgetClasses(e,r){const t=new J,i=this.$meta.hierarchy;let n,s,a,o,l;for(s=i.indexOf(e);s<i.length;++s)n=i[s],l=Reflect.getOwnPropertyDescriptor(n.prototype,"widgetClass"),l!=null&&l.get?o=l.get.call(this):(a=Vi(n,"$$name")||Vi(n,"$name")||Vi(n,"_$name")?n.$$name:n.name,(a.length<3||a.includes("$"))&&console.warn(`Class "${a}" extending "${n.$name}" should have "$name" static getter with no less than 3 chars.`),o=`b-${a.toLowerCase()}`),o&&t.add(r?o+r:o);return t}get rootUiClass(){return $}get staticClassList(){const{$meta:e}=this;let r=e.staticClassList;return r||(e.staticClassList=r=this.getStaticWidgetClasses($),Y.isTouchDevice&&r.add("b-touch")),r}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:r,defaultCls:t,uiClasses:i}=e;let{staticClassList:n}=e;(t||r)&&(n=n.clone(),t&&n.assign(t),r&&n.assign(r));const s=n.values;return i&&s.push(...i),e.floating&&s.push("b-floating"),e.collapsify==="hide"&&s.push("b-collapsify-hide"),s}changeCls(e){return J.from(e)}updateCls(e,r){if(!this.isConfiguring&&!this.isComposable){const{element:t}=this;r&&T.getTruthyKeys(r).forEach(i=>t.classList.remove(i)),e.assignTo(t)}}changeContentElementCls(e){return J.from(e)}changeHtmlCls(e){return J.from(e)}changeDefaultCls(e){return J.from(e,!0)}changeUi(e){return J.from(e)}updateUi(e){let r=null,t,i;if(e){const n=this.getStaticWidgetClasses(this.rootUiClass);for(i in e)if(e[i])for(t in n)n[t]&&((r||(r=new J))[`${t}-ui-${i}`]=1)}this._uiClasses=r==null?void 0:r.values,this._uiClassList=r}fromCache(e,r=!1,t=this.element){if(!t)return null;const i=this;return i.cache[e]||(i.cache[e]=r?C.children(t,e):C.down(t,e)),i.cache[e]}emptyCache(){this.cache={}}changeMasked(e,r){var t;if(((t=this.masked)==null?void 0:t.type)!=="trial"){if((e===!0||e==="")&&(e="\xA0"),r&&!r.isDestroyed)typeof e=="string"?(r.text=e,e=r):e?(r.setConfig(e),e=r):r.destroy();else if(e){const i=$.resolveType("mask");e=i.mergeConfigs(this.maskDefaults,e),e.owner=this,e=i.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,r,t,i,n){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,r){const t=this,{element:i}=t,n=t._width,s=t._height,a=i.offsetWidth,o=i.offsetHeight;t.floating&&r&&t.onFloatingWidgetResize(...arguments),!t.suspendResizeMonitor&&(n!==a||s!==o)&&(t.onInternalResize(i,a,o,n,s),t.trigger("resize",{width:a,height:o,oldWidth:n,oldHeight:s}))}onFloatingWidgetResize(e,r,t){const i=this,{lastAlignSpec:n,constrainTo:s}=i;if(i.isVisible&&n&&n.target){const a=!r||t.height!==r.height,o=!r||t.width!==r.width,l=s&&!k.from(s).contains(k.from(i.element,null,!0));(a&&n.zone!==2||o&&n.zone!==1||l)&&i.requestAnimationFrame(()=>i.realign())}}updateScale(){const e=this,r=e.element,t=r.parentElement;e.configuredWidth||(e.configuredWidth=e.width),r.style.display="none";const i=k.client(t),n=i.width/e.configuredWidth,s=e.scale=e.allowGrowWidth?Math.min(n,1):n;r.style.transform=`scale(${s})`,r.style.transformOrigin="top left",r.style.display="",e.allowGrowWidth&&n>1&&(e.width=e.configuredWidth*n)}onParentElementResize(e){this.updateScale()}parseTRBL(e,r="px"){if(e=e||0,typeof e=="number")return[`${e}${r}`,`${e}${r}`,`${e}${r}`,`${e}${r}`];const t=e.split(" "),i=t.length;return i===1?t[1]=t[2]=t[3]=t[0]:i===2?(t[2]=t[0],t[3]=t[1]):i===3&&(t[3]=t[1]),[isFinite(t[0])?`${t[0]}${r}`:t[0],isFinite(t[1])?`${t[1]}${r}`:t[2],isFinite(t[2])?`${t[2]}${r}`:t[3],isFinite(t[3])?`${t[3]}${r}`:t[4]]}get documentRoot(){var e;return((e=this.owner)==null?void 0:e.documentRoot)||this.element.getRootNode()}get rootElement(){var e;const r=this;if(!r._rootElement){let t=((e=r.owner)==null?void 0:e.rootElement)||C.getRootElement(r.forElement||(r.element.isConnected?r.element:r.getRenderContext()[0]||r.element));t||(t=document.body),r._rootElement=t}return r._rootElement}get floatRoot(){var e,r;const t=this,i=t.rootElement||((e=t.owner)==null?void 0:e.rootElement);let{floatRoot:n}=i;if(n)i.contains(n)||i.appendChild(n);else{const{outerCls:s}=$,a=(r=C.getThemeInfo(null,i))==null?void 0:r.name;if(!C.isValidFloatRootParent(i))throw new Error("Attaching float root to wrong root");a&&s.push(`b-theme-${a.toLowerCase()}`),n=i.floatRoot=C.createElement({className:`b-float-root ${s.join(" ")}`,parent:i}),za.push(n),Y.isAndroid&&(n.style.height=`${screen.height}px`,j.on({element:globalThis,orientationchange:()=>n.style.height=`${screen.height}px`,thisObj:this})),!Y.isHoverableDevice&&globalThis.visualViewport&&j.on({element:globalThis.visualViewport,resize:({target:o})=>n.style.height=`${o.height}px`,thisObj:this}),he.ion({theme:({theme:o,prev:l})=>{n.classList.add(`b-theme-${o.toLowerCase()}`),n.classList.remove(`b-theme-${l.toLowerCase()}`)}})}return n}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach(r=>{const t=parseInt(getComputedStyle(r).zIndex||0,10);t>e&&(e=t)}),e}static resetFloatRootScroll(){za.forEach(e=>e.scrollTop=e.scrollLeft=0)}static get floatRoots(){return za}static removeFloatRoot(e){za.splice(za.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:r}=Y;return r&&e.push(`b-${r}`),Y.isTouchDevice&&e.push("b-touch-events"),C.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),Y.isChrome?e.push("b-chrome"):Y.isSafari?e.push("b-safari"):Y.isFirefox&&e.push("b-firefox"),globalThis.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const r=this,{_isAnimatingCounter:t}=r;r._isAnimatingCounter=Math.max(0,t+(e?1:-1)),t===0&&e?(r.element.classList.add("b-animating"),r.trigger("animationStart")):t===1&&!e&&(r.element.classList.remove("b-animating"),r.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationend",{checkLog:!1})}static query(e,r=!1){const{idMap:t}=$.identifiable;for(const i in t)if($.widgetMatches(t[i],e,r))return t[i];return null}static queryAll(e,r=!1){const{idMap:t}=$.identifiable,i=[];for(const n in t)$.widgetMatches(t[n],e,r)&&i.push(t[n]);return i}static fromElement(e,r,t){const i=typeof r;e&&!e.nodeType&&(e=e.target),(i==="number"||r&&r.nodeType===Element.ELEMENT_NODE)&&(t=r,r=null);let n=e,s=0,a,o,l;for(typeof t!="number"&&(a=t,t=Number.MAX_VALUE),i==="string"&&(r=r.toLowerCase());n&&n.nodeType===Element.ELEMENT_NODE&&s<t&&n!==a;){if(o=n.dataset&&n.dataset.ownerCmp||n.id,o){if(l=$.getById(o),l)if(r){if(i==="function"){if(r(l))return l}else if($.widgetMatches(l,r,!0))return l}else return l;s++}n=n.parentNode}return null}static fromSelector(e){const r=document.querySelector(e);return r?$.fromElement(r):null}triggerFieldChange(e,r=!0){var t;r&&this.trigger("change",e),(t=this.eachAncestor)==null||t.call(this,i=>{var n,s;if((n=i.onFieldChange)==null||n.call(i,e),(s=i.isolateFieldChange)!=null&&s.call(i,this))return!1})}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){he.setupFocusListenersOnce(this._rootElement,j)}static widgetMatches(e,r,t){return r==="*"?!0:typeof r=="function"?r(e):$.isType(e,r,t)}static attachTooltip(e,r){return typeof r=="string"&&(r={html:r}),$.create(Object.assign({forElement:e},r),"tooltip"),e}changeDock(e){return e==="start"?"left":e==="end"?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget(r=>{"rtl"in r.initialConfig||(r.rtl=e)})}},IT=$.prototype;["compose","domSyncCallback"].forEach(e=>IT[e].$nullFn=!0),$.initClass(),$.register("mask",It),C.Widget=$,he.Widget=$,It.identifiable.idMap=$.identifiable.idMap,Object.assign(globalThis.bryntum||(globalThis.bryntum={}),{get:$.getById.bind($),query:$.query,queryAll:$.queryAll,fromElement:$.fromElement,fromSelector:$.fromSelector}),$._$name="Widget";var br=class extends F.mixin(Ae,$i){get contentElement(){var e;return(e=this.owner)==null?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:r,itemCls:t}=e,{contentElement:i,items:n}=r,s=r.itemCls,a=n==null?void 0:n.length;if(a){r.textContent=!1;for(let o=0;o<a;o++){const l=n[o],{element:c}=l,{classList:d}=c;c.dataset.itemIndex=o,d.contains("b-outer")&&d.remove(...$.outerCls),t&&d.add(t),s&&d.add(s),l.render(i,!!r.isPainted)}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const r=this,{element:t}=e,{owner:i,itemCls:n}=r,{contentElement:s}=i,a=i.itemCls;s.contains(t)&&t.remove(),delete t.dataset.itemIndex,n&&t.classList.remove(n),a&&t.classList.remove(a),r.fixChildIndices(),r.syncChildCount()}appendChild(e){const{element:r}=e,{owner:t,itemCls:i}=this,{contentElement:n}=t,s=t.itemCls;r.dataset.itemIndex=t.indexOfChild(e),t.textContent=!1,i&&r.classList.add(i),s&&r.classList.add(s),e.render(n,!!t.isPainted),this.syncChildCount()}insertChild(e,r){const t=this,{element:i}=e,{owner:n,itemCls:s}=t,{contentElement:a}=n,o=C.getChild(a,`[data-item-index="${r}"]`),l=n.itemCls;n.textContent=!1,s&&i.classList.add(s),l&&i.classList.add(l),a.insertBefore(i,o),e.render(null,!!n.isPainted),t.fixChildIndices(),t.syncChildCount()}fixChildIndices(){this.owner.items.forEach((e,r)=>{e.element.dataset.itemIndex=r})}syncChildCount(){var e;const{owner:r}=this,{length:t}=r.items;(e=r.contentElement)==null||e.classList[t===1?"add":"remove"]("b-single-child")}syncConfigLater(e){const r=this.pendingConfigs||(this.pendingConfigs=[]);r.includes(e)||r.push(e)}syncConfigStyle({name:e,style:r,classes:t,map:i}){const n=this,s=`b-box-${e}-`,{contentElement:a}=n,o=n[e];let l=(i==null?void 0:i[o])||o;if(a){if(t){const{classList:c}=a;t.forEach(d=>{d!==l&&c.remove(s+d)}),t.includes(l)&&(c.add(s+l),l="")}a.style[r]=l}else n.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:r}=e;let t;if(r)for(e.pendingConfigs=null;t=r.pop();)e[e.$meta.configs[t].updater](e[t])}};R(br,"type","default"),R(br,"configurable",{owner:null,containerCls:"b-auto-container",itemCls:null}),R(br,"factoryable",{defaultType:"default"}),br.initClass(),br._$name="Layout";var DC=0,AT=e=>e.ripple,Ih=class extends ${static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),j.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var r;const t=this;t.show();const i=C.getStyleValue(t.circleElement,"animationName");t.hide(),(r=t.listenerDetacher)==null||r.call(t),i&&i!=="none"&&(t.listenerDetacher=j.on({mousedown:{element:t.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:t.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:t.circleElement,handler:"onAnimationEnd"},thisObj:t}),e.type==="mousedown"&&(t.onMousedown(e),he.ion({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){DC=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-DC>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const r=$.fromElement(e.target,AT);if(r){const t=r.ripple,i=t.delegate?e.target.closest(t.delegate):r.focusElement||r.element;if(i){const n=T.assign({event:e,target:i,radius:this.radius},t);if(typeof n.clip=="string"&&(n.clip=r[n.clip]||e.target.closest(n.clip),!n.clip))return;this.ripple(n)}}}ripple({event:e,point:r=j.getClientPoint(e),target:t=e.target,clip:i=t,radius:n=this.radius,color:s=this.color}){this.clip=i,i=k.from(i,null,!0);const a=this,o=i.getDelta(r),l=a.rippleElement.style,c=a.circleElement,d=C.getStyleValue(t,"border-radius");a.hide(),l.transform=`translateX(${o[0]}px) translateY(${o[1]}px)`,l.height=l.width=`${n}px`,a.element.style.borderRadius=d,c.setAttribute("r",n),c.setAttribute("fill",s),a.showBy({target:i,align:"c-c",matchSize:!0})}onAnimationEnd(e){e.animationName==="b-ripple-expand"&&this.hide()}};$.RippleClass=Ih,Ih._$name="Ripple";var _T=Object.freeze({}),{isArray:Zn}=Array,FT=e=>e.weight,EC=({weight:e},{weight:r})=>typeof e=="string"||typeof r=="string"?String(e).localeCompare(String(r)):(e!=null?e:Number.MAX_SAFE_INTEGER)-(r!=null?r:Number.MAX_SAFE_INTEGER),xC=e=>e&&!e.hidden,kT=["display","flex-direction"],OT={default:1,box:1},yt=class extends ${static get $name(){return"Container"}static get type(){return"container"}static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:null,overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,strictRecordMapping:null,autoUpdateRecord:null,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(e){const r=e.items||e.lazyItems;(this.hasItems=!!(r&&(Zn(r)?r:Object.keys(r)).length))||(this.initialItems=!1),super.startConfigure(e)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getAt(e){return this.ensureItems().at(e)}remove(...e){let r=!0;e.length===1&&(Zn(e[0])?e=e[0]:r=!1);const t=this,{_items:i}=t,n=[];for(let s=0;s<e.length;s++){const a=e[s];i.includes(a)&&(i.remove(a),t.layout.removeChild(a),n.push(a),t.onChildRemove(a))}return r?n:n[0]}removeAll(){return this.remove(this.items)}add(...e){const r=this,t=r.ensureItems(),i=[];let n=!0,s,a,o;for(e.length===1&&(Zn(e[0])?e=e[0]:n=!1),a=0;a<e.length;a++)s=e[a],s.isWidget?s.parent=r:s=r.createWidget(s),(s==null?void 0:s.weight)!=null?(o=H.findInsertionIndex(s,t.values,EC),i.push(r.insert(s,o))):s&&(t.includes(s)||(t.add(s),r.onChildAdd(s),r.layout.appendChild(s),i.push(s)));return n?i:i[0]}ensureItems(){const e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}insert(e,r){const t=this,i=t.ensureItems();e instanceof $?e.parent=t:e=t.createWidget(e),i.includes(r)&&(r=t.indexOfChild(r)),r=Math.min(r,i.count);const n=i.values;return n.splice(r,0,e),i.values=n,t.onChildAdd(e),t.layout.insertChild(e,r),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e,r){const t=this,i=[],n=new ja;return Zn(e)?t.processItemsArray(e,i):e&&t.processItemsObject(e,t.namedItems,i),i.some(FT)&&i.sort(EC),n.add(i),r&&r.forEach(s=>{t.remove(s),!n.includes(s)&&s._createdBy===t&&s.destroy()}),n}afterConstruct(){const{rtl:e}=this,{classList:r}=this.contentElement;r.toggle("b-rtl",e===!0),r.toggle("b-ltr",e===!1)}updateRtl(e){super.updateRtl(e);const{contentElement:r}=this;r&&(r.classList.toggle("b-rtl",e===!0),r.classList.toggle("b-ltr",e===!1))}updateItems(e,r){let t=0;e.forEach(i=>{this.onChildAdd(i),r&&!r.temporary&&this.layout.insertChild(i,t),++t}),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new ja,e._items.temporary=!0}return e._items.values}processItemsArray(e,r){const t=e.length;let i,n;for(i=0;i<t;i++)n=e[i],n instanceof $?(n.parent=this,n.element.classList.remove(...$.outerCls)):n=this.createWidget(n),n&&((n.ref||n.id)&&this.addDescendant(n),r.push(n))}processItemsObject(e,r,t){let i,n;for(n in e)i=e[n],i&&(r&&n in r&&(i=typeof i=="object"?T.merge(T.clone(r[n]),i):r[n]),i&&(i instanceof $?i.parent=this:(i instanceof Object&&(i.ref=n),i=this.createWidget(i)),i&&(i.ref=n,this.addDescendant(i),t.push(i))))}onChildAdd(e){if(e.innerItem&&this.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),this.onChildAddLayout(e),e.ref||e.id)for(let r=this;r;r=r.parent)r.addDescendant(e);this.syncChildCount(!0)}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(e){var r;super.onChildHide(e),(r=this._items)!=null&&r.includes(e)&&this.syncChildCount(!0)}onChildShow(e){var r;super.onChildShow(e),(r=this._items)!=null&&r.includes(e)&&this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring){const r=this,{items:t,hasItems:i}=r,n=t.filter(xC),{length:s}=n;if(r.visibleChildCount=s,r.hideWhenEmpty&&e){const a=!s;!!r._hidden!==a&&(r.hidden=a)}t.forEach(a=>a.element.classList.remove("b-last-visible-child","b-first-visible-child")),s&&(n[0].element.classList.add("b-first-visible-child"),n[s-1].element.classList.add("b-last-visible-child")),r.hasItems=!!r.childItems.length,r.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),r.isComposable?i!==r.hasItems&&r.recompose():r.updateTextContent(r._textContent)}}syncFlexDirection(){const e=this,{contentElement:r,flexColCls:t,flexRowCls:i}=e,n=new J(r.className),s=C.getStyleValue(r,kT);n[i]=n[t]=0,s.display==="flex"&&(n[s["flex-direction"]==="row"?i:t]=1),C.syncClassList(r,n)}addDescendant(e){const r=e.ref||e.id,t=this._widgetMap||(this._widgetMap={});t[r]||(t[r]=e)}onChildRemove(e){const r=this,t=e.ref||e.id;if(t)for(let i=r;i;i=i.parent)i.widgetMap[t]===e&&delete i.widgetMap[t];r.layout.onChildRemove(e),r.syncChildCount(!0)}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=e==null?_T:null,e}updateRecord(e){var r;const t=this;(r=t.recordUpdateDetacher)==null||r.call(t),t.trigger("beforeSetRecord",{record:e}),t.setValues(e,{onlyName:t.strictRecordMapping,highlight:!!t.$highlight}),t.autoUpdateFields&&(e!=null&&e.firstStore)&&(t.recordUpdateDetacher=e.firstStore.ion({update:t.onRecordUpdated,thisObj:t}))}setRecord(e,r){this.$highlight=r,this.record=e,this.$highlight=!1}onRecordUpdated({record:e}){e===this.record&&this.setValues(this.record,!0,!0)}onFieldChange({source:e,userAction:r}){if(this.autoUpdateRecord&&r){const{record:t,strictRecordMapping:i}=this,{name:n,ref:s,isValid:a=!0,value:o}=e,l=i?n:n||s;t&&l&&a&&(t[l]=o)}}getValues(e){const r={};return this.eachWidget((t,i)=>{t.isolateFields?i.down=!1:"name"in t&&(!e||e(t))&&(r[t.name]=t.value)},!0),r}get values(){const e={};return this.gatherValue(e),e}set values(e){this.assignValue(e)}get isSettingValues(){return!!this.assigningValues}get assigningValues(){var e;return this._assigningValues||((e=this.parent)==null?void 0:e.assigningValues)}set assigningValues(e){this._assigningValues=e}assignValue(e,r){super.assignValue(e,r),this.isolateFields||this.setValues(e,r)}gatherValue(e){super.gatherValue(e),this.isolateFields||this.gatherValues(e)}setValues(e,r=this.assignValueDefaults){this.assigningValues=r,this.eachWidget(t=>t.assignValue(e,r),!1),this.assigningValues=!1}get hasNoChildren(){const e=this,{items:r,lazyItems:t}=e.initialConfig,i=r&&(Zn(r)?r:T.values(r)),n=t&&(Zn(t)?t:T.values(t)),s=e.isConfiguring?n||i:e.items;return!(s!=null&&s.filter(xC).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(e){const r=this;if(!r.isComposable){const t=!!(e&&r.hasNoChildren),{classList:i}=r.contentElement;t!==i.contains("b-text-content")&&(i[t?"add":"remove"]("b-text-content"),r.rendered&&r.realign())}}updateLayoutStyle(e){C.applyStyle(this.contentElement,e)}updateElement(e){if(super.updateElement(...arguments),e){const{classList:r}=this.contentElement,{containerCls:t}=this.layout;r.add("b-content-element"),t&&r.add(t)}}onPaint(){var e;(e=super.onPaint)==null||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,r){if(r&&(r.takeRecords(),r.disconnect()),e){const t=this,{element:i,contentElement:n}=t;e=new MutationObserver(s=>t.onContentElMutation(s)),e.observe(n,{attributes:!0}),n!==i&&e.observe(i,{attributes:!0}),t.syncFlexDirection()}return e}onContentElMutation(){OT[this.layout.type]&&this.isVisible&&this.syncFlexDirection()}changeLayout(e,r){return br.reconfigure(r,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,r){const t=this;typeof e=="string"?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),(typeof r=="string"||!r&&(r=e.type))&&(r=$.resolveType(r,!0)),e=(r||$).mergeConfigs(t.defaults,e,{parent:t});for(let i=e.parent;i;i=i.parent)if(i.processWidgetConfig(e)===!1)return null;return t.trigger("beforeWidgetCreate",{widgetConfig:e})===!1?null:e}createWidget(e){const r=$.create(this.setupWidgetConfig(e),this.defaultType);return r&&(r._createdBy=this),r}updateDefaults(e,r){if(!this.isConfiguring&&e){const t=Object.entries(e);this.eachWidget(i=>{t.forEach(([n,s])=>{(!r||i[n]===r[n])&&(i[n]=s)})},!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(r=>{var t;return r.isFocusable&&r.ref!=="close"&&!((t=r.ref)!=null&&t.endsWith("collapse"))}));return e?e.focusElement:super.focusElement}doDestroy(){var e;(e=this._items)==null||e.forEach(r=>{var t;return(t=r.destroy)==null?void 0:t.call(r)}),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget(r=>{r.isVisible&&"isValid"in r&&!r.isValid&&(e=!1)},!0),e}};yt.initClass(),yt._$name="Container";var{assign:Wa}=T,RC=()=>performance.now(),LT={start:!1},$T=/^[.\d]+([^\d].*)?$/,TC=e=>{const r=e.$bryntum||(e.$bryntum={});return r.transitions||(r.transitions=Object.create(null))},MC=(e,r)=>{var t;return typeof e=="string"&&(r=(t=$T.exec(e))==null?void 0:t[1],e=parseFloat(e)),e&&e*(r==="s"||!r&&e<10?1e3:1)},Ah=e=>{const r=T.values(TC(e)).filter(t=>t.completed==null).map(t=>t.toString());e.style.transition=r.join(", ")},PC=e=>class extends e{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...t){super(...t),this.id=++jT}start(){this.startTime=RC()}get delay(){var t,i,n;return MC((n=(i=this._delay)!=null?i:(t=this.owner)==null?void 0:t.delay)!=null?n:0,this.unit)}set delay(t){this._delay=t}get duration(){var t;const{owner:i,unit:n}=this;return MC((t=this._duration)!=null?t:i?i.duration:_e.defaultDuration,n)}set duration(t){this._duration=t}get elapsed(){return RC()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var t,i;return(i=this._retain)!=null?i:(t=this.owner)==null?void 0:t.retain}set retain(t){this._retain=t}get timing(){var t,i;return(i=this._timing)!=null?i:(t=this.owner)==null?void 0:t.timing}set timing(t){this._timing=t}get unit(){var t,i;return(i=this._unit)!=null?i:(t=this.owner)==null?void 0:t.unit}set unit(t){this._unit=t}},jT=0,oc=class extends F.mixin(PC){static get $name(){return"AnimatorTransition"}static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:r,transitions:t}=e;let{property:i}=e;[i,e.to]=C.unitize(i,e.to),e.from=C.unitize(i,e.from)[1],e.promissory=new Va,e.property=i;const n=t[i];t[i]=e;let{from:s}=e;n&&(e.from=n.to,s=null,n.destroy()),s===null&&(s=e.getCurrentStyleValue(),n||(e.from=s)),r.style[i]=s,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return(e=this.promissory)==null?void 0:e.promise}get transitions(){return TC(this.element)}clearStyle(){this.setStyle("")}finish(e){const r=this,{transitions:t,promissory:i,property:n}=r;i&&(r.completed=e,r.promissory=null,i.resolve(e),t[n]===r?(delete t[n],e||(Ah(r.element),r.clearStyle())):r.completed=!1)}getCurrentStyleValue(){return C.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:r,element:t,from:i,property:n,_retain:s,_timing:a}=this;return new oc({element:t,property:n,retain:s,timing:a,duration:Math.round(Math.min(e,r)),reverting:this,to:i,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:r,duration:t,element:i,property:n}=e;j.onTransitionEnd({element:i,property:n,duration:r+t+20,thisObj:e.owner,handler:()=>{var s;return(s=e.finish)==null?void 0:s.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:r,property:t,timing:i}=this;return`${t} ${r}ms ${i||"ease-in-out"}${e?` ${e}ms`:""}`}};oc.initClass();var _e=class extends F.mixin(PC){static get $name(){return"Animator"}static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,r){if(T.isObject(e)){T.entries(e).forEach(t=>_e.register(...t));return}_e.fx[e]=r,_e[e]=t=>(C.isElement(t)?t={element:t,[e]:{}}:(t={element:t.element,[e]:t},delete t[e].element),_e.run(t))}static run(e){return new _e(e).start()}constructor(e){var r;super(null);const t=this,i=[],n={};let s,a,o,l;if(Array.isArray(e))t.items=e;else for(o in e)(_e.specialPropsRe.test(o)?t:n)[o]=e[o];T.keys(n).forEach(c=>{l=n[c],l!=null&&l!==!1&&l===l&&((a=_e.fx[c])?(l=Wa(t.defaults,a(l,t,c)),l.owner=t,s=new _e(l)):(l=Wa(t.defaults,typeof l=="object"?l:{to:l}),l.owner=t,l.property=c,s=new oc(l)),i.push(s))}),(r=t.items)==null||r.forEach(c=>{T.isInstantiated(c)?c.owner=t:(c=Wa(t.defaults,c),c.owner=t,c=new _e(c)),i.push(c)}),t.items=i,t.promise=(i.length===1?i[0].promise:Promise.all(i.map(c=>c.promise))).then(c=>{var d;return(d=t.finish)==null||d.call(t,c),t.completed||!1})}doDestroy(){this.items.forEach(e=>e.destroy()),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:r,owner:t}=this;return e!=null?e:r?!1:t?t.retain:!0}set retain(e){super.retain=e}done(){return this.promise}finish(e){var r,t;const i=this,{items:n}=i;for(Ah(i.element),i.completed=typeof e=="boolean"?e:!e.some(s=>!s),(r=i.prefinalize)==null||r.call(i,i.completed,i);n.length;)n.pop().destroy();(t=i.finalize)==null||t.call(i,i.completed,i)}revert(e){var r;const t=this,{reverting:i}=t,n=!e||((r=e.start)!=null?r:!0);let s=t.defaults;return i&&(i.finalize&&(s.finalize=i.finalize),i.prefinalize&&(s.prefinalize=i.prefinalize),s.retain=i._retain),s=Wa(s,e,{items:t.items.map(a=>a.revert(LT)),reverting:t}),s=new _e(s),n&&s.start(),s}start(){const{element:e,items:r}=this;return super.start(),r.length&&(Ah(e),r.forEach(t=>t.start())),this}};_e.initClass().Transition=oc,_e.specialPropsRe=new RegExp(`^(?:${Object.keys(_e.prototypeProperties).concat(Object.keys(_e.superclass.prototypeProperties)).map(e=>e[0]==="_"?e.substr(1):e).join("|")})$`),_e.defaultDuration=200,_e.fx={},_e.register({puff(e){return e===!0?e={}:typeof e!="object"?e={transform:`scale(${e})`}:e.scale&&(e=T.clone(e),e.transform=`scale(${e.scale})`,delete e.scale),Wa({opacity:0,transform:"scale(8)"},e)}}),_e._$name="Animator";var lc=class extends F.mixin(ge){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;(e=this.mousedownRemover)==null||e.call(this),this.cancel(),super.doDestroy()}cancel(){var e,r,t;const i=this;(e=i.activeElement)==null||e.classList.remove(i.pressedCls),i.activeElement=null,(r=i.acceleration)==null||r.cancel(),i.activeListenerRemover=(t=i.activeListenerRemover)==null?void 0:t.call(i),i.clearTimeout(i.autoRepeatTimer),i.clearTimeout(i.repeatTimer)}updateElement(e){var r;(r=this.mousedownRemover)==null||r.call(this),this.mousedownRemover=j.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const r=this,t=r.delegate?e.target.closest(r.delegate):r.element;r.cancel(),t&&(r.activeElement=t,r.triggerEvent=e,t.classList.add(r.pressedCls),r.activeListenerRemover=j.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:t,handler:"onTargetMouseMove"},mouseleave:{element:t,handler:"onTargetMouseLeave"},mouseenter:{element:t,handler:"onTargetMouseEnter"},thisObj:r}),r.autoRepeatTimer=r.setTimeout("startAutoRepeat",r.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const r=this;e.buttons?(r.activeElement.classList.add(r.pressedCls),r.triggerEvent=e,r.fireClick()):r.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=Te.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,r=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(r),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}};lc._$name="ClickRepeater";var BT=/^(?:undefined|null|LEFT|RIGHT)$/,HT={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},IC=e=>{const r=e==null?void 0:e.toUpperCase();return[r,r==="LEFT"||r==="RIGHT"]},cc=e=>class extends(e||F){static get $name(){return"Rotatable"}static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:t}=this;return{class:{[`b-rotate-${(t||"").toLowerCase()}`]:t,"b-rotate-vertical":t}}}syncRotationToDock(t){if(BT.test(String(this.rotate))){const[i,n]=IC(t);this.rotate=n?this.invertRotate?HT[i]:i:null}}get widgetClass(){return null}},Ni=class extends $.mixin(cc){compose(){const{align:e,href:r}=this;return{tag:r!=null?"a":"button",class:{[`b-align-${e||"end"}`]:1,"b-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var e,r;if((e=this.parent)!=null&&e.isPanel&&((r=this.element)!=null&&r.parentNode.matches(".b-panel-header")))return this.parent}changeAlign(e){return e}onInternalClick(e){const r=this,{handler:t,panel:i}=r,n={domEvent:e,tool:r};r.disabled||(r.trigger("click",n),r.isDestroyed||(r.trigger("action",n),!r.isDestroyed&&(i==null?void 0:i.trigger("toolClick",n))!==!1&&t&&r.callback(t,i,[e,i,r])))}onInternalKeyDown(e){(e.key.trim()||e.code)==="Enter"&&(e.cancelBubble=!0,e.stopPropagation())}updateDisabled(e,r){var t;super.updateDisabled(e,r),e&&((t=this.repeat)==null||t.cancel())}changeRepeat(e,r){return r==null||r.destroy(),e&&lc.new({element:this.element},e)}};R(Ni,"$name","Tool"),R(Ni,"type","tool"),R(Ni,"configurable",{align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null}),Ni.initClass(),Ni._$name="Tool";var VT=/right/i,NT=e=>(e.collapsed||e.collapsing)&&e.owner.expandedHeaderDock==="top"&&e.owner.collapsible.direction.match(VT)?"start":"end",_h=class extends Ni{static get $name(){return"CollapseTool"}static get type(){return"collapsetool"}static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:e,direction:r}=this;return{class:{[`b-icon-collapse-${r}`]:1,"b-collapsed":e}}}changeAutoAlign(e){return e===!0?NT:e}syncAutoAlign(){const{autoAlign:e}=this;e&&(this.align=e(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}};_h.initClass(),_h._$name="CollapseTool";var AC=/^(?:UP|DOWN|LEFT|RIGHT)$/,zT=/^(left|top)$/i,WT={},_C=/^b-dock-(top|left|right|bottom)$/,Fh="b-panel-collapse-revealer",UT=/^(?:left|right)$/i,dc="b-collapse-unflex",{round:oi}=Math,FC=["up","down","left","right"].reduce((e,r)=>(e[r.toUpperCase()]=e[r]=r,e),{}),kh={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},GT={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},YT={h:"w",w:"h"},kC={up:"top",right:"right",down:"bottom",left:"left"},uc={top:!1,right:!0,bottom:!1,left:!0},qT={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},OC={top:e=>`translate(0, -${oi(e.height||0)}px)`,bottom:e=>`translate(0, ${oi(e.height||0)}px)`,right:e=>`translate(${oi(e.width||0)}px, 0)`,left:e=>`translate(-${oi(e.width||0)}px, 0)`},KT=0,zi=class extends F.mixin($i){static get $name(){return"PanelCollapser"}static get type(){return"inline"}static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(e){var r;(r=this.collapsible)==null||r.onCollapseClick(e)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return this.collapsingExpanding==="collapsing"}get collapsingExpanding(){var e;const r=(e=this.currentOperation)==null?void 0:e.collapsing;return r==null?null:r?"collapsing":"expanding"}get currentDock(){var e,r,t,i;return(i=(t=(r=(e=this.panel)==null?void 0:e.header)==null?void 0:r.dock)==null?void 0:t.toLowerCase())!=null?i:"top"}get expanding(){return this.collapsingExpanding==="expanding"}get collapseTool(){var e,r;return(r=(e=this.panel)==null?void 0:e.tools)==null?void 0:r.collapse}get collapseDim(){return UT.test(this.collapseDir)?"width":"height"}getCollapseDir(e){var r;let{direction:t,panel:i}=this;if(!t||AC.test(t)){const n=i==null?void 0:i.placement;n?t=GT[n]:t=qT[((r=i==null?void 0:i.header)==null?void 0:r.dock)||"top"]}return e?FC[t]:t}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){return this.collapseInfo[0]}get collapseInfo(){const{panel:e}=this,r=e.hasHeader&&e.expandedHeaderDock;let t=kC[this.collapseDir],i=!1;return r&&((i=uc[t]!==uc[r])||(t=r)),[t,i]}get toolsConfig(){const{direction:e,tool:r}=this;return r&&{collapse:T.assign({direction:e.toLowerCase()},r)}}beforeCollapse(e){const{panel:r}=this,{element:t}=r;t.contains(C.getActiveElement(t))&&r.revertFocus(!0)}changeTool(e){const r=this,{panel:t}=r;if(r.isConfiguring||r.isDestroying||!t||t.isDestroying)return e;t.tools={collapse:e}}collapse(e){var r,t;const i=this,{panel:n}=i,s={id:++KT,completed:!1,panel:n};let{currentOperation:a}=i;return e=e!=null?e:!0,T.isObject(e)&&(s.collapsed=!0,T.assign(s,e),e=s.collapsed,delete s.collapsed),s.collapsing=e,s.previous=a!=null?a:null,e!==i.collapsed?a?a.collapsing!==e&&(s.animation=a.animation.revert({finalize(){var o;(o=i.collapseFinalize)==null||o.call(i,s,!0)}}),s.collapsing=e,a=s):(s.animation=T.clone(("animation"in s?s:i).animation),i.beforeCollapse(s)!==!1&&(s.animation&&(s.animation.finalize=o=>{var l;return(l=i.collapseFinalize)==null?void 0:l.call(i,s,o)}),n.changingCollapse=!0,i[e?"collapseBegin":"expandBegin"](s),s.animation?a=s:(s.completed=!0,i[e?"collapseEnd":"expandEnd"](s)),n.changingCollapse=!1,s.animation||i.onComplete(e?"collapse":"expand"))):a&&a.collapsing!==e&&(i[e?"expandRevert":"collapseRevert"](s),s.animation=a.animation.revert({finalize(){var o;(o=i.collapseFinalize)==null||o.call(i,s,!1)}}),a=s),i.currentOperation=a,(t=(r=a==null?void 0:a.animation)==null?void 0:r.done())!=null?t:Promise.resolve(e===i.collapsed)}collapseFinalize(e,r){const t=this,{currentOperation:i,panel:n}=t,s=n.collapsed?"expand":"collapse";i===e&&(t.currentOperation=null,e.completed=r,n.changingCollapse=!0,t[s+"End"](e),n.changingCollapse=!1,r&&t.onComplete(s))}applyHeaderDock(e,r=!0){const t=this,{currentDock:i,panel:n}=t,s=e?t.collapseDock:n.expandedHeaderDock;s!==i&&n.hasHeader&&(n.header={dock:s},r&&n.recompose.flush())}composeHeader(e){const{panel:r}=this,{class:t}=e,i=r.expandedHeaderDock||Object.keys(t).filter(n=>t[n]&&_C.test(n)).map(n=>_C.exec(n)[1][0]);return t[Fh]=1,t[`b-collapsible-${i[0]}${this.collapseDir[0]}`]=1,e}composeTitle(e){return e.class[Fh]=1,e}collapseBegin(e){var r;const t=this,{animation:i}=e,{collapseDim:n,collapseTool:s,panel:a}=t,{element:o,placement:l}=a,[c,d]=t.collapseInfo,u=s==null?void 0:s.element.classList,h=!l||l[0]==="h"&&n==="width"||l[0]==="v"&&n==="height";t.configuredWidth=a._lastWidth,t.configuredHeight=a._lastHeight,t.transverseCollapse=d,t.applyHeaderDock(!0);const f=a.rectangle(),g=t.lockInnerSize().moveTo(0,0),m=g.clone(),p=kh[c],v=(r=a.headerElement)==null?void 0:r.getBoundingClientRect(),y=oi((v==null?void 0:v[n])||0);o.classList.toggle(dc,h),i?(m[p[0]]=m[p[1]],o.classList.add("b-collapsing"),u==null||u.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),u&&(u.remove("b-collapsed"),a.rectangle(),u.remove("b-collapsing"),u.add("b-collapsed")),i.element=o,i.retain=!0,i[n]={from:oi(f[n]),to:y},i.items=[{element:t.innerElement,retain:!1,clip:{from:`rect(${g})`,to:`rect(${m})`}}],d&&i.items.push({element:a.headerElement,duration:i.duration,retain:!1,transform:{from:OC[c](v),to:"translate(0, 0)"}}),e.animation=_e.run(i)):(o.style[n]=`${y}px`,s&&(u.add("b-collapsing","b-collapsed"),s.rectangle(),u.remove("b-collapsing")))}collapseEnd(e){const r=this,{collapseTool:t}=r;r.panel.element.classList.remove("b-collapsing"),t&&(t.collapsing=!1),e.completed?r.collapsed=!0:(r.applyHeaderDock(!1),r.restoreConfiguredSize(),r.lockInnerSize(!1))}collapseRevert(e){var r;(r=this.collapseTool)==null||r.element.classList.remove("b-collapsed")}expandBegin(e){const r=this,{animation:t}=e,{collapseDim:i,collapseTool:n,panel:s}=r,[a,o]=r.collapseInfo,{element:l}=s,c=l.classList,d=c.contains(dc),u=s.rectangle();c.remove("b-collapsed","b-collapsing"),s.element.style[i]="",r.restoreConfiguredSize(),r.lockInnerSize(!1);const h=s.rectangle(),f=r.lockInnerSize().moveTo(0,0),g=f.clone(),m=kh[r.collapseDock];n==null||n.element.classList.remove("b-collapsed"),t&&(g[m[0]]=g[m[1]],c.add("b-collapsed","b-expanding"),d&&c.add(dc),t.element=l,t[i]={from:oi(u[i]),to:oi(h[i])},t.items=[{element:r.innerElement,retain:!1,clip:{from:`rect(${g})`,to:`rect(${f})`}}],o&&t.items.push({element:s.headerElement,duration:t.duration,retain:!1,transform:{from:"translate(0, 0)",to:OC[a](u)}}),e.animation=_e.run(t))}expandEnd(e){const r=this;r.panel.element.classList.remove("b-expanding"),e.completed&&(r.collapsed=!1,r.applyHeaderDock(!1),r.restoreConfiguredSize(),r.lockInnerSize(!1))}expandRevert(e){var r;(r=this.collapseTool)==null||r.element.classList.add("b-collapsed")}get innerElement(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}get innerSizeElement(){return this.transverseCollapse?this.panel.element:this.innerElement}get supportAxis(){let{_supportAxis:e}=this;const r=e===!0;return(r||e==null)&&(e=this.collapseDim[0],(r||C.getStyleValue(this.panel.element,"position")==="absolute")&&(e+=YT[e])),e||""}lockInnerSize(e=!0){const r=this,{innerElement:t,panel:i}=r,n=e?r.supportAxis:"",s=i.element,a=i.headerElement,o=e&&a&&k.from(a,s),l=e&&k.from(r.innerSizeElement,s),c=t.style;return a&&(a.style.minWidth=n.includes("w")?`${o.width}px`:"",a.style.minHeight=n.includes("h")?`${o.height}px`:""),c.width=e?`${l.width}px`:"",c.height=e?`${l.height}px`:"",t.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),l}onCollapseClick(e){let r=this.collapsing?!1:this.expanding?!0:!this.collapsed;e.altKey&&(r={animation:null,collapsed:r}),this.collapse(r)}onComplete(e){var r;(r=this.panel)==null||r.trigger(e)}onHeaderClick({event:e}){e.button===0&&this.panel.collapsed&&e.target.classList.contains(Fh)&&this.onRevealerClick()}onPanelConfigChange({name:e,value:r}){const t=this,{panel:i}=t;e==="collapsed"?i.isPainted&&(t.collapsed=r):e==="header"&&!i.changingCollapse&&t.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(e){const{configuredHeight:r,configuredWidth:t,panel:i}=this;e=e!=null?e:"wh",i.element.classList.remove(dc),t!=null&&e.includes("w")&&(i.width=t),r!=null&&e.includes("h")&&(i.height=r)}splitHeaderItems({as:e,dock:r}=WT){var t;return(t=this.panel)==null?void 0:t.splitHeaderItems({as:e,dock:r,alt:!0})}syncDirection(){const e=this,{direction:r}=e;(!r||AC.test(r))&&(e.direction=e.getCollapseDir())}changeCollapsed(e){return!!e}updateCollapsed(e){const{collapseTool:r,panel:t}=this;t&&(t.collapsed=e,t.element.classList[e?"add":"remove"]("b-collapsed")),r&&(r.collapsed=e)}updateDirection(e){const{collapseTool:r,panel:t}=this;r&&(r.direction=FC[e]),t!=null&&t.rendered&&t.recompose()}updatePanel(e){var r;const t=this;t.syncDirection(),(r=t.panelChangeDetacher)==null||r.call(t),t.panelChangeDetacher=e&&Te.after(e,"onConfigChange","onPanelConfigChange",t,{return:!1})}wrapCollapser(e,r){var t;const i=this,[n,s]=i.collapseInfo;if(!s)return[e,r];const{collapseDir:a,panel:o}=i,{expandedHeaderDock:l,header:c,uiClassList:d}=o,u=(t=o.tools)==null?void 0:t.recollapse,[h,f]=i.splitHeaderItems({as:"element",dock:n}),g=o.hasHeader?o.title||(c==null?void 0:c.title)||"\xA0":null,m=g&&{tag:"header",class:new J({...d,[`b-dock-${l}`]:1,"b-panel-header":1,"b-panel-collapser-header":1},c==null?void 0:c.cls),children:[...h,{reference:"collapserTitleElement",html:g,class:{...d,[`b-align-${(c==null?void 0:c.titleAlign)||"start"}`]:1,"b-header-title":1}},...f]};return u&&(u.direction=a),["collapseWrapElement",{class:{...d,[`b-panel-collapser-header-${l}`]:1,[`b-panel-collapser-${a}`]:1,[`b-${uc[l]?"h":"v"}box`]:1,"b-panel-collapser":1,"b-box-center":1},children:zT.test(l)?{collapserHeaderElement:m,[e]:r}:{[e]:r,collapserHeaderElement:m}}]}};zi.maps={clipByDock:kh,dockByDirection:kC,dockIsHorz:uc},zi.initClass(),zi._$name="PanelCollapser";var Ua=Symbol("pendingCreate"),Wi=class extends F{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:typeof Proxy!="undefined",setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let r=null;return e.proxyable&&(r=new Proxy(e.instances,{get(t,i){return e.get(i)},set(t,i,n){return e.set(i,n),!0},deleteProperty(t,i){return e.set(i,null),!0}})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:r}),r}get target(){return this.proxy||this.object}define(e,r){const t=this,{transform:i}=t,n=i?i(r,e):r,s=T.isInstantiated(n);t.instances[e]=Ua,s||t.setDefaults(e,n),t.defineProp(e,!0),s&&t.set(e,n)}defineProp(e,r){const t=this,{object:i}=t;t.proxy||Reflect.defineProperty(r?Object.getPrototypeOf(i):i,e,{configurable:!r,enumerable:!0,get(){return t.get(e)},set(n){return t.set(e,n)}})}flush(){var e;const r=this;try{r.updating=!0;for(const t in r.defaults)r.get(t);r.afterConfigureOwner=(e=r.afterConfigureOwner)==null?void 0:e.call(r)}finally{r.updating=!1}}get(e){const{defaults:r,instances:t}=this;return t[e]===Ua&&this.set(e,Ua),t[e]||r[e]&&null}set(e,r){var t;const i=this,{cleanup:n,configName:s,defaults:a,factory:o,instances:l,owner:c,setup:d,transform:u,updating:h}=i,f=c&&s&&!h,g=l[e]===Ua?null:l[e],m=o.reconfigure(g,r===Ua?{}:r||null,{cleanup:n&&(p=>n(p,e)),defaults:a[e]||i.setDefaults(e,{}),owner:i.owner,setup:d&&((p,v,y)=>d(p,e,v,y)),transform:u&&(p=>u(p,e))});if(m!==g){const p=f&&{...l};l[e]=m,m?(i.defineProp(e),(t=i.created)==null||t.call(i,m,e)):(delete i.object[e],delete l[e]),f&&c.onConfigChange({name:s,config:c.$meta.configs[s],value:i.target,was:p})}}setDefaults(e,r){const{defaults:t,factory:i,inferType:n,instances:s,owner:a,ownerName:o}=this,{typeKey:l}=i.factoryable;return r=r===!0?{}:T.assign({},r),(n==="name"||n===!0&&!r[l])&&(r[l]=e),o&&(r[o]=a),r.beforeConfigure=c=>{s[e]=c},t[e]=r}update(e){const r=this,{owner:t}=r;let i,n;try{if(r.updating=!0,e)for(i in e)n=e[i],r.defaults[i]?r.set(i,n):n&&r.define(i,n);else for(i in r.instances)r.set(i,null)}finally{r.updating=!1}t&&(t.isConfiguring?r.afterConfigureOwner||(r.afterConfigureOwner=Te.before(t,"afterConfigure","flush",r)):r.flush())}};Wi.initClass(),Wi._$name="DynamicObject";var XT=[],Oh={},ZT={align:1,weight:1},Lh=e=>class extends(e||$){static get $name(){return"Toolable"}static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(t,i){return(t.weight||0)-(i.weight||0)}byWeightReverseSortFn(t,i){return(i.weight||0)-(t.weight||0)}gatherTools({align:t,alt:i,refs:n}=Oh){var s,a,o;const{collapsed:l,tools:c}=this,d={collapsed:l,alt:i};let u=[],h,f,g,m,p;for(f in c)p=c[f],h=(o=(a=(s=p==null?void 0:p.align)==null?void 0:s.align)!=null?a:p==null?void 0:p.align)!=null?o:"end",h===t&&p.isCollapsified(d)&&u.push(p);if(u.sort(this[t==="end"?"byWeightReverseSortFn":"byWeightSortFn"]),n){const v=n==="widget",y={};for(g=0;g<u.length;++g)m=u[g],y[m.ref]=v?m:m.element;u=y}return u}getEndTools({alt:t,refs:i}=Oh){return this.gatherTools({align:"end",alt:t,refs:i})}getStartTools({alt:t,refs:i}=Oh){return this.gatherTools({align:"start",alt:t,refs:i})}get childItems(){return[...this.getStartTools(),...this._items||XT,...this.getEndTools()]}changeTools(t,i){const n=this,s=n.$tools||(n.$tools=new Wi({configName:"tools",factory:$,inferType:!1,owner:n,created(a){var o,l;a.innerItem=!1,(l=a.syncRotationToDock)==null||l.call(a,(o=n.header)==null?void 0:o.dock),Te.after(a,"onConfigChange",(c,{name:d})=>{ZT[d]&&n.onConfigChange({name:"tools",value:s.target})}),n.onChildAdd(a)},setup(a,o){return a=T.merge({},n.toolDefaults["*"],n.toolDefaults[o],a),a.parent=n,a.ref=o,a}}));if(s.update(t),!i)return s.target}get widgetClass(){}},LC=["b-hbox","b-vbox"],JT={name:"align",style:"alignItems"},QT={name:"contentAlign",style:"alignContent"},eM={name:"direction",style:"flexDirection"},tM={name:"justify",style:"justifyContent",classes:["stretch"]},rM={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}},Ui=class extends br{get vertical(){return this.horizontal===!1}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle(JT)}updateContentAlign(){this.syncConfigStyle(QT)}updateDirection(){this.syncConfigStyle(eM)}updateHorizontal(){var e;const r=this,t=(e=r.contentElement)==null?void 0:e.classList,i=Number(r.vertical);t?(t.remove(LC[1-i]),t.add(LC[i])):r.syncConfigLater("horizontal"),r.syncDirection()}updateJustify(){this.syncConfigStyle(tM)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(rM)}syncDirection(){const e=this,{reverse:r}=e;e.direction=r?`${e.vertical?"column":"row"}${r?"-reverse":""}`:null}};R(Ui,"$name","Box"),R(Ui,"type","box"),R(Ui,"alias","hbox"),R(Ui,"configurable",{itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null}),Ui.initClass(),Ui._$name="Box";var Ga=class extends Ui{};R(Ga,"$name","VBox"),R(Ga,"type","vbox"),R(Ga,"configurable",{horizontal:!1}),Ga.initClass(),Ga._$name="VBox";var $h=e=>class extends(e||F){static get $name(){return"Badge"}static get configurable(){return{badge:null}}compose(){const{badge:t}=this;return{dataset:{badge:t},class:{"b-badge":t!=null&&t!==""}}}},$C=/(?:^|\s)b-icon-/,jC=/(?:^|\s)b-fa-/,BC=Symbol("defaultToggleable"),iM=["items","type","widgets","html","listeners"],HC=Symbol("defaultListener"),Ya=class extends $.mixin($h,cc){static get $name(){return"Button"}static get type(){return"button"}static get configurable(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,iconAlign:"start",text:{value:null,$config:null,default:""},color:null,toggleable:BC,pressed:!1,toggleGroup:null,ripple:{radius:75},forwardTwinEvents:["action","toggle"],localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,defaultBindProperty:null}}updateElement(e,r){var t,i,n;const s=this,{constructor:a}=s,o=super.updateElement(e,r),l=s.peekConfig("menu"),c=l?l.isWidget?l.role:((i=(t=a.resolveType(l.type))==null?void 0:t.configurable)==null?void 0:i.role)||((n=a.configurable.menuDefaults)==null?void 0:n.type)||"menu":!1;return s.ariaHasPopup=c,o}compose(){const{color:e,href:r,icon:t,iconAlign:i,pressed:n,pressedIcon:s,target:a,text:o,toggleable:l,toggleGroup:c,menuIcon:d}=this,u=this.hasConfig("menu"),h=n&&s?s:t;return{tag:r?"a":"button",href:r,target:a,class:{[`b-icon-align-${i}`]:t,[e]:!!e,"b-pressed":n&&l,"b-text":!!o,"b-has-menu":u},"aria-pressed":n,dataset:{group:c},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:(t||s)&&{"aria-hidden":!0,tag:"i",class:{...J.normalize(h,"object"),"b-icon":$C.test(h),"b-fa":jC.test(h)}},label:o&&{tag:"label",text:o},menuIconElement:u&&d&&{tag:"i",class:{"b-icon":$C.test(d),"b-fa":jC.test(d),"b-button-menu-icon":1,[d]:1}}}}}configureOverflowTwin(e){const r=this,t=super.configureOverflowTwin(e);return t.text||(t.text=r.text||r.tooltipText),t}onHide(){var e;(e=this._menu)==null||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var r;super.onFocusOut(e),(r=this.menu)==null||r.hide()}get focusElement(){return this.element}changeText(e){return e==null?"":e}changeToggleable(e){return e===BC?this.toggleGroup||this.config.menu:e}changeMenu(e,r){const t=this,{element:i}=t;return e?(e.isWidget?(e.forElement=i,e.owner=t,e.constrainTo=t.rootElement):(typeof e=="object"&&!iM.some(n=>n in e)&&(e={lazyItems:e}),e=$.reconfigure(r,e?T.merge({owner:t,constrainTo:t.rootElement,forElement:i},t.menuDefaults,e):null,t)),e.align.constrainPadding=10,t.detachListeners(HC),e.ion({name:HC,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):r==null||r.destroy(),e}onMenuBeforeShow({source:e}){return this.trigger("beforeShowMenu",{menu:e})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(e){this.toggleable=!!e}updatePressed(e){var r,t;const i=this;if(!i.toggleable||i.isConfiguring)return;const{menu:n}=i;e&&C.forEachSelector(i.rootElement,`button[data-group=${i.toggleGroup}]`,s=>{s!==i.element&&($.getById(s.id).pressed=!1)}),n&&(n.initialConfig.minWidth||(n.minWidth=i.width),n.align.minHeight=(r=n._minHeight)!=null?r:100,n.align.minWidth=(t=n._minWidth)!=null?t:100,n[e?"show":"hide"]()),i.trigger("toggle",{pressed:e})}onInternalMousedown(e){var r;(r=this._menu)!=null&&r.containsFocus&&this.pressed&&e.preventDefault()}onInternalClick(e){const r=this,t={event:e};r.disabled||r.toggleable&&(r.toggleGroup&&r.pressed||(r.toggle(!r.pressed),r.isDestroyed))||(r.trigger("click",t),r.isDestroyed||r.trigger("action",t),r.href||(e.preventDefault(),e.stopPropagation()))}toggle(e=!this.pressed){this.trigger("beforeToggle",{pressed:e})!==!1&&(this.pressed=e)}};Ya.initClass(),Ya._$name="Button";var VC={refs:"element"},nM=e=>e.element.style.margin="",sM=e=>e.isToolbar,NC=e=>e[0]+(e[1].minifiable?0:9e9),zC={hidden:!1,width:""},aM={...zC,flex:""},oM=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],lM={delay:0,startRate:40,endRate:200,accelerateDuration:500},cM={menu:1,pressed:1},Jn=class extends yt.mixin(Lh){static get $name(){return"Toolbar"}static get type(){return"toolbar"}static get delayable(){return{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{defaultType:"button",dock:"top",layout:{type:"box"},overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}static getEvictionList(e){const r=e.filter(t=>t.overflowable!=="none");return r.forEach((t,i)=>r[i]=[i,t]),r.sort((t,i)=>NC(i)-NC(t)),r}compose(){const e=this,{axisProps:r,dock:t}=e,i=e.getEndTools(VC),n=e.getStartTools(VC);return{class:{[`b-dock-${t}`]:1,[`b-${t}-toolbar`]:1,[`b-${r.box}`]:1},children:{...n,toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}},...i}}}get axisProps(){return oM[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return(e=this.tools)==null?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return typeof e=="string"?e:e==null?void 0:e.type}onChildAdd(e){var r;super.onChildAdd(e),this.processAddedLeafItem(e),(r=e.syncRotationToDock)==null||r.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){Te.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget(r=>this.processAddedLeafItem(r))}onPaint({firstPaint:e}){var r;(r=super.onPaint)==null||r.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){var r;const t=this,{layout:i}=t,{vertical:n}=i;if(i.vertical=IC(e)[1],!t.initialItems){n!==i.vertical&&t.updateOverflow(t.overflow);for(const s of t.childItems)(r=s.syncRotationToDock)==null||r.call(s,e)}}updateOverflow(e,r){var t,i;const n=this,{axisProps:s,contentElement:a,overflowType:o}=n,{flexDir:l}=s,c=(t=n.overflowMenuButton)==null?void 0:t._menu,d={};if(c&&(e?c==null||c.removeAll():c.eachWidget(u=>{u._overflowTwinOrigin.overflowTwin=null})),r==="menu"?d.overflowMenuButton=null:r==="scroll"&&(d.overflowScrollStart=d.overflowScrollEnd=null),o==="menu")(i=n.scrollable)==null||i.destroy(),a.style.overflow=a.style.overflowX=a.style.overflowY="",d.overflowMenuButton={cls:{[`b-${l}-menu`]:1}};else if(o==="scroll"){const u=typeof e=="object"&&(e==null?void 0:e.repeat)||lM;n.scrollable={[s.overflow]:"hidden-scroll",element:a,internalListeners:{scroll:"onContentScroll",thisObj:n}},d.overflowScrollStart={repeat:u,invertRotate:!0,cls:{[`b-${l}-start-scroller`]:1}},d.overflowScrollEnd={repeat:u,invertRotate:!0,cls:{[`b-${l}-end-scroller`]:1}}}n.tools=d,o?(a.classList.add("b-overflow"),n.monitorResize=!0,n.syncOverflowVisibility()):(a.classList.remove("b-overflow"),n.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:r,contentElement:t,isVisible:i}=e,{clientSizeProp:n,edgeProp:s,sizeProp:a}=e.axisProps,{overflowMenuButton:o,overflowScrollStart:l,overflowScrollEnd:c}=e.tools,d=e.rtl&&e.layout.horizontal,u=r==="menu",h=()=>Math.ceil(t[n]+(!l||l.hidden?0:l.rectangle("outer")[a])+(!c||c.hidden?0:c.rectangle("outer")[a])),f=()=>{if(I.length===0)return 0;const P=I[I.length-1].rectangle(t);return Math.floor(d?t[n]-P.left:P[s])};let g,m,p,v,y,S,D,w,E,x,M,I;if(!(!i||!r||e.items.length===0)){if(e.inSyncOverflowVisibility=!0,o==null||o.hide(),e.eachWidget((P,_)=>{D=P.minifiable,x=P.overflowable,x=D?x||D:x,P.floating?_.down=!1:(_.down=!x,P.innerItem&&(P._toolbarOverflow&&(P.hidden=P._toolbarOverflow=!1),P._toolbarMinified&&(P.minified=P._toolbarMinified=!1),P.isVisible&&(D&&(w||(w=[])).push(P),x&&(I||(I=[])).push(P))))}),I&&(g=h(),m=f()),I&&m>g)if(u){for(;m>g&&(y=w==null?void 0:w.pop());)S=m,y._toolbarMinified=!0,y.minified=!0,m=f(),S-=m,(E||(E=[])).push([y,S]);if(m>g){o.show(),g=h(),v=Jn.getEvictionList(I);for(p of v)m>g&&(y=p[1],y._toolbarOverflowWidth=y.width,y._toolbarOverflow=!0,y.hidden=!0,I.splice(I.indexOf(y),1),(M||(M=[])).push(p),m=f());if(M){for(M.sort((P,_)=>P[0]-_[0]).forEach((P,_)=>M[_]=P[1]);E!=null&&E.length;)[y,S]=E.pop(),m+S<=g&&!y._toolbarOverflow&&(m+=S,y.minified=y._toolbarMinified=!1);e.syncOverflowMenuButton(M)}else o.hide()}}else c.show(),l.show(),e.syncScrollerState();else u||(c==null||c.hide(),l==null||l.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var r;const t=this,{axisProps:i,overflowMenuButton:n}=t,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:i.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};if(t.addToMenu(s,e.filter(a=>t.overflowItemFilter(a))),(r=n._menu)!=null&&r.isMenu){const a=n.menu,{toAdd:o,toRemove:l}=H.delta(s.items,a.items,1);if(a.remove(l),a.items.length)for(let c=o.length-1;c>=0;c--)a.insert(o[c],0);else a.add(o)}else n.menu=s}syncScrollerState(){const e=this,{axisProps:r,scrollable:t}=e,{overflowScrollStart:i,overflowScrollEnd:n}=e.tools,s=t[r.pos],a=t[r.max];i.disabled=!s,n.disabled=Math.abs(Math.ceil(s))>=Math.abs(a)}overflowItemFilter(e){const{filter:r}=this.overflow;return!!(r?r.call(this,e):C.getChildElementCount(e.element))}addToMenu(e,r){const t=this.horizontal?aM:zC;for(const i of r){const n=i.ensureOverflowTwin(t,nM);e.items.push(n)}}onLeafItemConfigChange(e,{name:r,value:t}){const i=this,n=i.up(sM),s=n.hasConfig("overflow"),{overflowTwin:a}=i;!s||n!=null&&n.inSyncOverflowVisibility||r==="hidden"&&t===i._toolbarOverflow||(a&&!cM[r]&&(a[r]=t),n!=null&&n.isPainted&&i.ref!=="overflowMenuButton"&&(i.isTextField&&r==="value"&&(i.containsFocus||a!=null&&a.containsFocus)||n.syncOverflowVisibility()))}createWidget(e){e==="->"?e={type:"widget",cls:"b-toolbar-fill"}:e==="|"?e={type:"widget",cls:"b-toolbar-separator"}:typeof e=="string"&&(e={type:"widget",cls:"b-toolbar-text",html:e});const r=super.createWidget(e);return this.widgetCls&&r.element.classList.add(this.widgetCls),r}};Jn.initClass(),Jn._$name="Toolbar";var dM=e=>!e.classList.contains("b-focus-trap")&&C.isFocusable(e)?C.NodeFilter.FILTER_ACCEPT:C.NodeFilter.FILTER_SKIP,jh=[],uM={},WC=[jh,jh],UC=(e,r,t)=>{const{vertical:i}=e;return delete e.vertical,{...e,class:{...r,[`b-${i?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!t}}},Bh=(e,r,t=!1)=>{const i={vertical:t,children:e?[e]:[]};return r&&(i.tag=r),i},hM={dock:1,hidden:1,weight:1},Gi={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},GC={header:1,"pre-header":1},Nt=class extends yt.mixin(Xl,Lh){static get $name(){return"Panel"}static get type(){return"panel"}static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:"region"}}updateElement(e,r){const t=super.updateElement(e,r);return this.titleElement&&C.setAttributes(this.ariaElement,{"aria-describedby":this.titleElement.id}),t}compose(){const e=this,{collapsible:r,focusable:t,hasItems:i,revealed:n,tools:s}=e,a=e.composeHeader(),o=(a==null?void 0:a.class["b-dock-left"])||(a==null?void 0:a.class["b-dock-right"]);let l=e.composeBody(),c="bodyWrapElement";return r&&([c,l]=r.wrapCollapser(c,l)),{tabIndex:i&&t!==!1||t?0:null,class:{[`b-panel-collapsible-${r==null?void 0:r.type}`]:r,[`b-panel-collapse-${r==null?void 0:r.collapseDir}`]:r,[`b-${o?"h":"v"}box`]:1,"b-panel-collapsible":r,"b-panel-has-header":a,"b-panel-has-tools":s?1:0,"b-panel-overlay-revealed":n},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1}},headerElement:a,[c]:l,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}}}composeBody(){const e=this,{bodyCls:r,bodyConfig:t,bodyWrapTag:i,footer:n,uiClassList:s}=e,a=T.values(e.strips,(m,p)=>!Gi[p==null?void 0:p.dock]).sort(e.byWeightSortFn);let o,l,c,d,u,h,f;for(n&&(c=n.dock||"bottom",a.unshift({dock:c,element:{tag:"footer",reference:"footerElement",html:typeof n=="string"?n:n.html,class:{...s,[`b-dock-${c}`]:1,[`${n.cls||""}`]:1}}})),r&&(t[u="className"]||(u="class"),t[u]=new J(t[u]).assign(r)),d=a.length;d-- >0;)o=a[d],[h,l]=Gi[o.dock],f?f.vertical!==h&&(f=Bh(UC(f,s),"",h)):f=Bh(t,i,h),f.children[l?"unshift":"push"](o.element);const g=UC(f||Bh(t,i),s,!0);return g.class["b-panel-body-wrap"]=1,g.class[`b-${e.$$name.toLowerCase()}-body-wrap`]=1,g}get hasHeader(){if(this.header===!1)return!1;const{header:e,title:r,tools:t,parent:i}=this,n=this.maximizable||Object.values(t||{}).some(s=>!s.hidden);return e||!(i!=null&&i.suppressChildHeaders)&&(r||n)}get rootUiClass(){return Nt}composeHeader(e){var r;const t=this;if(!t.hasHeader&&!e)return;const i=t.header||{},n=i.dock||"top",[s,a]=t.splitHeaderItems({as:"element",dock:n}),o=t.$meta.hierarchy,l=t.composeTitle(i),c=new J({[`b-dock-${n}`]:1,...t.uiClassList},i.cls);let d,u;for(d=o.indexOf(Nt);d<o.length;++d)u=o[d].$$name,u!=="Grid"&&(c[`b-${u.toLowerCase()}-header`]=1);const h={tag:"header",class:c,children:[...s,l,...a]};return((r=t.collapsible)==null?void 0:r.composeHeader(h))||h}composeTitle(e){var r;const t=typeof e=="string"?e:this.title||e.title,i={reference:"titleElement",id:`${this.id}-panel-title`,html:t!=null?t:"\xA0",class:{[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1,...this.uiClassList}};return T.isObject(t)&&(delete i.html,T.merge(i,t)),((r=this.collapsible)==null?void 0:r.composeTitle(i))||i}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const r=this,{headerElement:t}=r;(e=r._headerClickDetacher)==null||e.call(r),r._headerClickDetacher=t&&j.on({element:t,click:i=>{var n;return(n=r.trigger)==null?void 0:n.call(r,"headerClick",{event:i})}})}onHeaderClick(e){var r;(r=this.collapsible)==null||r.onHeaderClick(e)}onPaint(){var e;super.onPaint(...arguments),(e=this.collapsible)==null||e.onPanelPaint(this)}splitHeaderItems({as:e,dock:r,alt:t}=uM){var i,n,s,a;const o=this,l=e==="element",{collapsed:c}=o,d=o.getEndTools({alt:t}),u=o.getStartTools({alt:t}),h=T.values(o.strips,(v,y)=>!GC[y==null?void 0:y.dock]&&y.isCollapsified({collapsed:c,alt:t}));let f=WC,g,m,p;if(h.length+d.length+u.length){for(f=[m=[...u,...h.filter(v=>v.dock==="pre-header").sort(o.byWeightSortFn)],g=[...h.filter(v=>v.dock==="header").sort(o.byWeightReverseSortFn),...d]],p=0;p<m.length;++p)r&&((n=(i=m[p]).syncRotationToDock)==null||n.call(i,r)),l&&(m[p]=m[p].element);for(p=0;p<g.length;++p)r&&((a=(s=g[p]).syncRotationToDock)==null||a.call(s,r)),l&&(g[p]=g[p].element)}return f}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:r}=e,t=T.merge({reference:"bodyElement",className:{...e.getStaticWidgetClasses(Nt,"-content"),"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren}},e._bodyConfig);return r&&(t.tag=r),(e.initializingElement||!e._element)&&(t.html=e.content||e._html),t}changeBodyCls(e){return J.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const r=this,t=T.values(r.strips,(o,l)=>!Gi[l==null?void 0:l.dock]).sort(r.byWeightSortFn),[i,n]=r.splitHeaderItems(),[s,a]=((e=r.collapsible)==null?void 0:e.splitHeaderItems())||WC;return[...i,...s,...n,...a,...t.filter(o=>Gi[o.dock][1]),...r._items||jh,...t.filter(o=>!Gi[o.dock][1]).reverse()]}changeStrips(e,r){const t=this,i=t.$strips||(t.$strips=new Wi({configName:"strips",factory:$,inferType:!1,owner:t,created(n){var s;const{dock:a}=n;if(!GC[a]&&!Gi[a])throw new Error(`Invalid dock value "${a}"; must be: top, left, right, bottom, header, or pre-header`);Te.after(n,"onConfigChange",(o,{name:l})=>{hM[l]&&t.onConfigChange({name:"strips",value:i.target})}),n.innerItem=!1,t.onChildAdd(n),n.parent=t,(s=n.layout)==null||s.renderChildren(),n.hasItems&&(t.hasItems=!0)},setup(n,s){return n=T.merge(T.clone(t.stripDefaults["*"]),t.stripDefaults[s],n),n.parent=t,n.ref=s,n},transform(n){return Array.isArray(n)&&(n={items:n}),n||null}}));if(i.update(e),!r)return i.target}get collapsing(){var e;return(e=this.collapsible)==null?void 0:e.collapsing}get collapsingExpanding(){var e;return(e=this.collapsible)==null?void 0:e.collapsingExpanding}get expanding(){var e;return(e=this.collapsible)==null?void 0:e.expanding}changeCollapsed(e){const r=this,{collapsible:t}=r;if(r.recompose.flush(),e=!!e,!t||r.changingCollapse||!r.isPainted)return e;t==null||t.collapse({animation:null,collapsed:e})}changeCollapsible(e,r){const t=this;return t.getConfig("tools"),e&&(e===!0?e={}:typeof e=="string"&&(e={[Gi[e]?"direction":"type"]:e})),zi.reconfigure(r,e,{owner:t,defaults:{panel:t},cleanup(){t.collapsed&&(r.collapse({animation:null,collapsed:!1}),t._collapsed=1)}})}updateCollapsible(e){const r=this,t=e==null?void 0:e.toolsConfig;r.tools={collapse:(t==null?void 0:t.collapse)||null,recollapse:(t==null?void 0:t.recollapse)||null},e&&r.isPainted&&r.collapsed&&(r._collapsed=1),r.collapsed===1&&(r.collapsed=!0)}_collapse(e,r){var t;return r!==!0&&r!==void 0&&(r===!1?e.collapsed=!e.collapsed:typeof r=="number"?e.animation={duration:r}:r===null?e.animation=r:r===!0||("animation"in r?T.merge(e,r):e.animation=r)),(t=this.collapsible)==null?void 0:t.collapse(e)}collapse(e){return this._collapse({collapsed:!0},e)}expand(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e){return this.collapsed?this.expand(e):this.collapse(e)}get expandedHeaderDock(){var e,r,t;return(t=(r=this._expandedHeaderDock)!=null?r:(e=this.initialConfig.header)==null?void 0:e.dock)!=null?t:"top"}set expandedHeaderDock(e){this._expandedHeaderDock=e==null?void 0:e.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=e==null?void 0:e.dock)}updateTrapFocus(e){var r;const t=this;t.element.classList[e?"add":"remove"]("b-focus-trapped"),t.focusTrapListener=(r=t.focusTrapListener)==null?void 0:r.call(t),e&&(t.focusTrapListener=j.on({element:t.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:t}),t.treeWalker||(t.treeWalker=this.setupTreeWalker(t.element,C.NodeFilter.SHOW_ELEMENT,dM)))}setupTreeWalker(e,r,t){return document.createTreeWalker(e,r,t)}onFocusTrapped(e){const r=this,t=r.treeWalker;if(e.target===r.bottomFocusTrap)t.currentNode=r.topFocusTrap,t.nextNode();else if(e.target===r.topFocusTrap)t.currentNode=r.bottomFocusTrap,t.previousNode();else return;r.requestAnimationFrame(()=>t.currentNode.focus())}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){var e;const r=this,t=super.widgetClassList;return r.hasHeader&&t.push("b-panel-has-header",`b-header-dock-${((e=r.header)==null?void 0:e.dock)||"top"}`),r.tbar&&t.push("b-panel-has-top-toolbar"),r.bbar&&t.push("b-panel-has-bottom-toolbar"),t}};Nt.initClass(),Nt._$name="Panel";var st=class extends Nt{static get $name(){return"Popup"}static get type(){return"popup"}static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog"}}finalizeInit(){const e=this,{forElement:r}=e;e.anchoredTo=r,e.initialAnchor=e.anchor,r&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),j.on({element:r,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!r||C.isVisible(r))&&(e.autoShow===!0?e.show():e.setTimeout(()=>e.show(),e.autoShow))}onPaint({firstPaint:e}){var r;(r=super.onPaint)==null||r.call(this,...arguments);const t=this;e&&t.headerElement&&j.on({element:t.headerElement,dblclick:t.onHeaderDblClick,thisObj:t})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:r}=this;return{class:{"b-text-popup":!!(r&&e)}}}close(){const e=this;if(!e._hidden&&e.trigger("beforeClose")!==!1||e._hidden&&e.closeAction==="destroy")return e.modal&&e.closeAction==="destroy"&&e.revertFocus(),e.unmask(),e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout(()=>e.element.classList.add("b-using-keyboard"),0),e[e.closeAction]()}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){C.toggleClasses(this.element,["b-maximized"],e)}onInternalKeyDown(e){const r=this;e.key==="Escape"&&(e.stopImmediatePropagation(),r.floating||r.positioned?r.close(!0):r.collapsible&&(r.revealed?r.collapsible.toggleReveal():r.collapse()))}onDocumentMouseDown({event:e}){const r=this,{owner:t}=r,{target:i}=e;if(e.type!=="touchend"&&(t!=null&&t.isButton)&&t._menu===r&&t.element.contains(i))return e.preventDefault(),!1;r.modal&&i===st.modalMask?(e.preventDefault(),r.modal.closeOnMaskTap?r.close():r.containsFocus||r.focus()):!r.owns(i)&&r.autoClose&&!r.containsFocus&&r.close()}get isTopModal(){return C.isVisible(st.modalMask)&&this.element.previousElementSibling===st.modalMask}onFocusIn(e){const r=C.getActiveElement(this);super.onFocusIn(e),C.getActiveElement(this)===r&&e.target===this.element&&this.focus()}onFocusOut(e){!(globalThis.visualViewport&&globalThis.visualViewport.height<document.documentElement.clientHeight-1)&&!this.modal&&this.autoClose&&this.close(),super.onFocusOut(e)}onShow(){var e;const r=this;r.autoClose&&r.addDocumentMouseDownListener(),r.focusOnToFront&&r.focus(),(e=super.onShow)==null||e.call(this),r.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=he.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){e&&(this.floating=!0)}syncModalMask(){const e=this,{modal:r,element:t}=e;if(t.setAttribute("aria-modal",!!r),r&&e.isVisible)typeof e._x!="number"&&typeof e._y!="number"&&(e.centered=!0,e.anchor=!1),e.modalMask.classList.remove("b-hide-display"),t.classList.add("b-modal");else if(e.isPainted){t.classList.remove("b-modal");const i=e.floatRoot.querySelectorAll(".b-modal"),n=i.length?st.fromElement(i[i.length-1],"popup"):null;n?n.syncModalMask():st.modalMask.classList.add("b-hide-display")}}onHide(){var e,r;const t=this;(e=t.mouseDownRemover)==null||e.call(t),t.mouseDownRemover=null,(r=super.onHide)==null||r.call(this),t.syncModalMask()}onElementUserAction(){this.show()}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=st;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=C.createElement({className:"b-modal-mask b-hide-display"}),j.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}};st.initClass(),st._$name="Popup";var fM=/^b-icon-/,gM=/^b-fa-/,qa=class extends ${static get $name(){return"MenuItem"}static get type(){return"menuitem"}static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},icon:null,closeParent:null,href:null,target:null,localizableProperties:["text"],role:"menuitem",closeMenuDelay:200}}updateElement(e,r){const t=super.updateElement(e,r);return typeof this.checked=="boolean"&&(this.role="menuitemcheckbox"),this.ariaHasPopup=this.hasMenu?"menu":!1,t}compose(){var e;const r=this,{checked:t,href:i,hasMenu:n,separator:s,target:a,text:o,toggleGroup:l}=r,c=typeof t=="boolean",d=r.icon||(c?"b-fw-icon":""),u=`b-icon-${l?"radio-":""}`,h=typeof o=="object";return{tag:i?"a":"div",tabIndex:-1,href:i,target:a,class:{"b-has-submenu":n,"b-checked":t,"b-separator":s||((e=r.cls)==null?void 0:e["b-separator"])},dataset:{group:r.toggleGroup},[c?"aria-checked":""]:t,[n?"aria-expanded":""]:!1,children:{iconElement:d&&{"aria-hidden":!0,tag:"i",class:{"b-fa":gM.test(d),"b-icon":fM.test(d),"b-menuitem-icon":1,[`${u}checked`]:t===!0,[`${u}unchecked`]:t===!1,...J.normalize(d,"object")}},textElement:{tag:"span",html:h?null:o,class:{"b-menu-text":1,"b-menu-custom-content":h},children:h?[o]:null},subMenuIcon:n&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(e){const r=this,t=this.parent,i={menu:t,item:r,element:r.element,bubbles:!0,domEvent:e};if(typeof r.checked=="boolean"){const n=!r.checked;(!r.toggleGroup||n)&&(r.checked=!r.checked)}r.trigger("beforeItem",i),r.trigger("item",i),r.closeParent&&t&&(t.rootMenu.close(),e&&!r.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:e}=this;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:e}=this;return e?[e]:[]}get text(){return this.html}set text(e){this.html=e}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.delay("openMenu",200)}onFocusOut(e){this.clearTimeout("openMenu"),super.onFocusOut(e),this._menu&&(this.menu.closeTimer=this.menu.setTimeout(()=>this.closeMenu(),this.closeMenuDelay))}openMenu(e){const{menu:r}=this;!this.disabled&&r&&(r.focusOnToFront=e,r.show())}onChildShow(e){super.onChildShow(e),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu instanceof $&&this.menu.close()}onChildHide(e){super.onChildHide(e),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(e){return e&&typeof this.checked!="boolean"&&(this.checked=!1),e}changeChecked(e,r){if(this.isConfiguring||typeof r=="boolean")return!!e}updateChecked(e){const r=this;r.isConfiguring||(r.toggleGroup&&r.uncheckToggleGroupMembers(),r.element.setAttribute("aria-checked",e),r.trigger("toggle",{menu:r.owner,item:r,element:r.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const e=this,{checked:r,toggleGroup:t,element:i}=e,n=[];return r&&t&&C.forEachSelector(e.rootElement,`[data-group=${t}]`,s=>{if(s!==i){const a=$.fromElement(s);a&&n.push(a)}}),n}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}get closeParent(){return(typeof this.checked=="boolean"?this._closeParent:this._closeParent!==!1)&&!this.hasMenu}changeMenu(e,r){const t=this,{constrainTo:i,scrollAction:n}=t.owner;return e&&typeof e=="object"&&!("items"in e)&&!("widgets"in e)&&!("html"in e)&&(e={lazyItems:e}),Qn.reconfigure(r,e,{owner:t,defaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,autoShow:!1,cls:"b-sub-menu",forElement:t.element,owner:t,ariaLabel:t.text,constrainTo:i,scrollAction:n}})}};qa.initClass(),qa._$name="MenuItem";var mM={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1},Qn=class extends st{static get $name(){return"Menu"}static get type(){return"menu"}static get configurable(){return{focusable:!0,align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",ariaElement:"bodyElement"}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),j.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(){const{items:e,element:r}=this;e.some(n=>!!n._menu)&&r.classList.add("b-menu-with-submenu"),e.some(n=>n.icon)&&r.classList.add("b-menu-with-icon"),super.afterShow(...arguments)}createWidget(e){return typeof e=="string"&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const r=this,t=(e=r.parentMenu)==null?void 0:e.element.contains(C.getActiveElement(r.parentMenu)),i=r.items[0];return t||C.usingKeyboard||!(i instanceof qa)?super.focusElement:r.element}onDocumentMouseDown({event:e}){if(!this.parentMenu||!this.parentMenu.owns(e.target))return super.onDocumentMouseDown(...arguments)}hide(e){var r,t;const i=this;super.hide(e),i.isVisible||((t=(r=i.currentSubMenu)==null?void 0:r.hide)==null||t.call(r,e),i.parentMenu&&(i.parentMenu.currentSubMenu=null))}show(){super.show(...arguments);const{parentMenu:e}=this;this.isVisible&&e&&(e.currentSubMenu=this)}onMouseClick(e){const r=e.target.closest(".b-menuitem");r&&this.triggerElement(r,e)}onMouseOver(e){var r;if(this.focusOnHover!==!1){const t=(r=e.relatedTarget)==null?void 0:r.closest(".b-widget"),i=e.target.closest(".b-widget"),n=$.fromElement(i);!C.isTouchEvent&&i&&i!==t&&n.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[n],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer)}onMouseLeave(e){const r=this,{relatedTarget:t}=e,i=t&&r.owns(t);let n=t instanceof HTMLElement&&$.fromElement(t),s=!i;if(n){for(;n.ownerCmp;)n=n.ownerCmp;s&=!C.getAncestor(n.element,[e.target])}!i&&s&&(r.currentSubMenu&&!r.currentSubMenu.closeTimer&&r.currentSubMenu.hide(),r.element.contains(C.getActiveElement(r))&&C.getActiveElement(r).matches(".b-menuitem")&&r.focusElement.focus())}onInternalKeyDown(e){const r=$.fromElement(e),t=r&&r!==this&&!(r instanceof qa);if(e.key==="Escape"){(t?this:this.rootMenu).close();return}if(super.onInternalKeyDown(e),t)return;mM[e.key]&&e.preventDefault();const i=this.element,n=C.getActiveElement(i);this.navigateFrom(n!==i&&i.contains(n)?n:null,e.key,e)}navigateFrom(e,r,t){const i=this,{treeWalker:n}=i,s=e&&i.getItem(e),a=i.rtl?"ArrowLeft":"ArrowRight",o=i.rtl?"ArrowRight":"ArrowLeft";let l;switch(r){case"ArrowUp":n.currentNode=e||(e=i.bottomFocusTrap),n.previousNode(),l=n.currentNode;break;case"ArrowDown":n.currentNode=e||(e=i.topFocusTrap),n.nextNode(),l=n.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(s!=null&&s.menu?i.openSubMenu(e,s):i.triggerElement(e,t));break;case a:if(e&&(s!=null&&s.menu)&&!e.classList.contains("b-disabled")){const c=i.openSubMenu(e,s);c==null||c.focus()}else n.currentNode=e||(e=i.topFocusTrap),n.nextNode(),l=n.currentNode;break;case o:i.isSubMenu?i.hide():e||(n.currentNode=e||(e=i.topFocusTrap),n.nextNode(),l=n.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&i.triggerElement(e,t);break}l&&(l===i.element?i.navigateFrom(i.bottomFocusTrap,"ArrowUp",t):l===e?i.navigateFrom(i.topFocusTrap,"ArrowDown",t):l.focus())}getItem(e){if(e!=null)return typeof e=="number"?this.items[e]:e.nodeType===Element.ELEMENT_NODE?$.fromElement(e,"menuitem",this.contentElement):this.items.find(r=>r.id==e)}triggerElement(e,r){const t=this.getItem(e);t&&!t.disabled&&t.doAction(r)}get isSubMenu(){var e;return this===((e=this.owner)==null?void 0:e.menu)}openSubMenu(e,r){var t;const i=this,n=r.menu;if(n){if(!n.isVisible){const s={item:r,element:e};if(i.trigger("beforeSubMenu",s)===!1||((t=r.onBeforeSubMenu)==null?void 0:t.call(r,s))===!1)return;n.show()}return i.currentSubMenu=n}}set selectedElement(e){const r=this,t=r._selectedElement;if(t){const i=r.getItem(t),n=i==null?void 0:i.menu;n==null||n.hide(),t.classList.remove("b-active")}if(r._selectedElement=e,e){const i=C.isFocusable(e);e.classList.add("b-active"),r.scrollable.scrollIntoView(e,{animate:!i,focus:i})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame(()=>e.currentNode.focus())}get parentMenu(){var e;const r=this.owner;return r&&(r.isMenu?r:(e=r.up)==null?void 0:e.call(r,"menu"))}get rootMenu(){let e=this;for(;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}};Qn.initClass(),Qn._$name="Menu";var hc,es=class extends X{static get $name(){return"ContextMenuBase"}static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",scrollAction:"hide",constrainTo:globalThis}},items:{},triggerEvent:!1,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...e){var r;if(super.construct(...e),!((r=this.type)!=null&&r.length))throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){if(!e.handled&&this.triggerEvent===e.type){if(e.ctrlKey===!0&&!Y.isMac){e.preventDefault();return}const r=e;if(hc){const{target:t}=hc;e=j.fixEvent(new MouseEvent(e.type,e)),Object.defineProperty(e,"target",{get:()=>t,configurable:!0}),e.preventDefault=function(){r.preventDefault(),r.handled=!0}}this.internalShowContextMenu(e)}}showContextMenuByKey(e){if(!C.isEditable(e.target)){const r=this.getKeyboardContextMenuTarget(e.target);if(r)return hc=e,C.triggerMouseEvent(r,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),hc=null,!0}return!1}getKeyboardContextMenuTarget(e){const r=C.isInView(e);return e.children.length?C.childFromPoint(e,r.width/2,r.height/2):e}internalShowContextMenu(e){const r=this;if(r.disabled)return;const t=r.getDataFromEvent(e);!e.handled&&!e.defaultPrevented&&t&&r.shouldShowMenu(t)&&(e.type==="contextmenu"&&Y.isSafari&&e.ctrlKey&&!e.metaKey&&j.on({element:e.target,capture:!0,once:!0,thisObj:this,click(i){i.preventDefault(),i.stopImmediatePropagation()}}),t.domEvent=e,r.showContextMenu(t))}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}async showContextMenu(e,r){var t,i;const n=this,s=C.isDOMEvent(e),a=s?n.getDataFromEvent(e):e,o=s?e:a.domEvent;if((t=n._menu)==null||t.hide(),n.disabled)return;n.menuContext=a;const{type:l,client:c,processItems:d}=n,u=C.isInView(a.targetElement).center;if(U.assign(a,{feature:n,point:o!=null&&o.clientX?[o.clientX+1,o.clientY+1]:[u.x,u.y],menu:n,items:{},selection:c.selectedRecords}),n.callChainablePopulateMenuMethod(a),U.merge(a.items,n.baseItems),n.preventDefaultEvent(a),(!d||n.callback(d,c,[a])!==!1)&&n.hasActiveMenuItems(a)&&(n.populateItemsWithData(a),n.beforeContextMenuShow(a)!==!1)){const{menu:h}=n;let f=c.trigger(`${l}MenuBeforeShow`,a);T.isPromise(f)&&(o.handled=!0,f=await f),f!==!1&&(h.items=a.items,h.showBy(r||{target:a.domEvent}),(i=n.touchMoveDetacher)==null||i.call(n),n.touchMoveDetacher=j.on({element:c.element,touchmove:()=>h.hide(),thisObj:h,once:!0}),o&&(o.preventDefault(),o.handled=!0))}}get baseItems(){if(!this._baseItems){const e=this,{namedItems:r}=e,t=e._baseItems=U.assign({},e.items);for(const i in t){const n=t[i];n&&(r&&i in r?t[i]=typeof n=="object"?U.merge(U.clone(r[i]),n):r[i]:n===!0&&delete t[i])}}return this._baseItems}hideContextMenu(e){var r;(r=this.menu)==null||r.hide(e)}callChainablePopulateMenuMethod(e){var r,t;(t=(r=this.client)[`populate${L.capitalize(this.type)}Menu`])==null||t.call(r,e)}hasActiveMenuItems(e){return Object.values(e.items).some(r=>r&&!r.hidden)}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var r;(r=e.event)==null||r.preventDefault()}changeTriggerEvent(e){return e||this.client.contextMenuTriggerEvent}changeMenu(e,r){const t=this,{client:i,type:n}=t;if(e)return Qn.reconfigure(r,e?Qn.mergeConfigs({owner:i,rootElement:i.rootElement,onItem(s){i.trigger(`${n}MenuItem`,s)},onToggle(s){i.trigger(`${n}MenuToggleItem`,s)},onDestroy(){t.menu=null},onBeforeItem(s){Object.assign(s,t.menuContext)},onShow({source:s}){t.menuContext.menu=s,i.trigger(`${n}MenuShow`,t.menuContext)}},e):null,t);r!=null&&r.isWidget&&r.destroy()}};es._$name="ContextMenuBase";var YC=class{static insertRule(e,r=document.head){const t=this.getStyleSheet(r),i=t.cssRules.length;if(t.insertRule(e,0),t.cssRules.length>i)return t.cssRules[0]}static findRule(e){let r;const t=typeof e=="function";return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),i=>{if(r=Array.prototype.find.call(i.sheet.rules||i.sheet.cssRules,n=>t?e(n):n.selectorText===e),r)return!0}),r}static getStyleSheet(e=document.head){return e.$bryntumStylesheet||(e.$bryntumStylesheet=C.createElement({tag:"style",id:"bryntum-private-styles",type:"text/css",parent:e}).sheet),e.$bryntumStylesheet}};YC._$name="CSSHelper";var pM=e=>class extends(e||F){static get $name(){return"DragHelperContainer"}initContainerDrag(){const t=this;if(t.mode||(t.mode="container"),t.mode==="container"&&!t.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(t){const i=this;if(!i.ignoreSelector||!t.target.closest(i.ignoreSelector)){const n=C.getAncestor(t.target,i.containers,i.outerElement);if(n){const s=n.getBoundingClientRect();i.context={element:n,valid:!0,action:"container",offsetX:t.pageX-s.left,offsetY:t.pageY-s.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(t){var i;const n=this,{context:s,floatRootOwner:a}=n,{element:o}=s,l=o.cloneNode(!0),c=o.getBoundingClientRect(),d=a==null?void 0:a.element.closest(".b-outer");l.classList.add(n.dragProxyCls),l.classList.add(n.draggingCls),((a==null?void 0:a.floatRoot)||C.getRootElement(o)).appendChild(l),s.dragProxy=l,l.style.width=c.width+"px",l.style.height=c.height+"px",C.setTranslateXY(s.dragProxy,c.left,c.top),s.dragging=o,o.classList.add(n.dropPlaceholderCls),(i=d==null?void 0:d.parentElement)!=null&&i.matches(".b-float-root")&&(l.style.zIndex=a.floatRootMaxZIndex+1)}updateContainerDrag(t){var i;const n=this,{context:s}=n;if(!s.started||!s.targetElement)return;const a=C.getAncestor(s.targetElement,n.containers,"b-gridbase"),o=(i=s.dragging)==null?void 0:i.contains(C.getActiveElement(s.dragging));a&&C.isDescendant(s.element,a)||(o&&he.suspendFocusEvents(),a&&s.valid?n.moveNextTo(a,t):n.revertPosition(),o&&he.resumeFocusEvents(),t.preventDefault())}finishContainerDrag(t){const i=this,{context:n}=i,{dragging:s,dragProxy:a,valid:o,draggedTo:l,insertBefore:c,originalPosition:d}=n;s&&(n.valid=o&&l&&(s!==c||d.parent!==l),n.finalize=(u=n.valid)=>{!u&&i.context&&i.revertPosition(),s.classList.remove(i.dropPlaceholderCls),a.remove(),i.reset()},n.async=!1,i.trigger("drop",{context:n,event:t}),n.async||n.finalize())}abortContainerDrag(t=!1,i=null,n=!1){const s=this,{context:a}=s;a.dragging&&(a.dragging.classList.remove(s.dropPlaceholderCls),a.dragProxy.remove(),s.revertPosition()),n||s.trigger(t?"drop":"abort",{context:a,event:i}),s.reset()}updateContainerProxy(t){const i=this,{context:n}=i,s=n.dragProxy;let a=t.pageX-n.offsetX,o=t.pageY-n.offsetY;typeof i.minX=="number"&&(a=Math.max(i.minX,a)),typeof i.maxX=="number"&&(a=Math.min(i.maxX-s.offsetWidth,a)),typeof i.minY=="number"&&(o=Math.max(i.minY,o)),typeof i.maxY=="number"&&(o=Math.min(i.maxY-s.offsetHeight,o)),i.lockX?C.setTranslateY(s,o):i.lockY?C.setTranslateX(s,a):C.setTranslateXY(s,a,o);let l;if(t.type==="touchmove"){const c=t.changedTouches[0];l=C.elementFromPoint(c.clientX,c.clientY)}else l=t.target;n.targetElement=l}moveNextTo(t,i){const{context:n}=this,s=n.dragging,a=t.parentElement;if(t!==s){const o=k.from(t).center.x;this.isRTL&&i.pageX>o||!this.isRTL&&i.pageX<o?(a.insertBefore(s,t),n.insertBefore=t):t.nextElementSibling?t.nextElementSibling!==s?(n.insertBefore=t.nextElementSibling,a.insertBefore(s,t.nextElementSibling)):!n.insertBefore&&s.parentElement.lastElementChild!==s&&(n.insertBefore=t.nextElementSibling):(a.appendChild(s),n.insertBefore=null),n.draggedTo=a}}revertPosition(){const{context:t}=this,{dragging:i}=t,{parent:n,next:s}=t.originalPosition;s?s.previousSibling===i||!s&&i===n.lastChild||n.insertBefore(i,s):n.appendChild(i),t.draggedTo=null}},vM={pageXOffset:0,pageYOffset:0},yM=e=>class extends ge(e||F){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const t=this;!t.isElementDraggable&&t.targetSelector&&(t.isElementDraggable=i=>i.closest(t.targetSelector))}grabTranslateDrag(t){const i=this.getTarget(t);return i?(this.context={valid:!0,element:i,startPageX:t.pageX,startPageY:t.pageY,startClientX:t.clientX,startClientY:t.clientY},!0):!1}getTarget(t){return t.target.closest(this.targetSelector)}getX(t){return this.positioning==="absolute"?parseFloat(t.style.left,10):C.getTranslateX(t)}getY(t){return this.positioning==="absolute"?parseFloat(t.style.top,10):C.getTranslateY(t)}getXY(t){return this.positioning==="absolute"?[t.offsetLeft,t.offsetTop]:C.getTranslateXY(t)}setXY(t,i,n){this.skipUpdatingElement||(this.positioning==="absolute"?(t.style.left=i+"px",t.style.top=n+"px"):C.setTranslateXY(t,i,n))}startTranslateDrag(t){const i=this,{context:n,outerElement:s,proxySelector:a}=i,o=i.dragWithin=i.dragWithin||i.cloneTarget&&document.body;let l=n.dragProxy||n.element;const c=l,d=l.parentElement;if(i.cloneTarget){const u=a?l.querySelector(a):l,{width:h,height:f,x:g,y:m}=k.from(u,o);l=i.createProxy(l);let p=g,v=m;if(i.autoSizeClonedTarget&&(l.style.width=`${h}px`,l.style.height=`${f}px`),l.classList.add(i.dragProxyCls,i.draggingCls),l.classList.remove("b-hover","b-selected","b-focused"),o.appendChild(l),!i.autoSizeClonedTarget||a){const y=l.getBoundingClientRect(),{x:S,y:D}=o.getBoundingClientRect(),w=t.clientX-S,E=t.clientY-D+(o!==document.body?document.body.getBoundingClientRect().y:0);p=w-y.width/2,v=E-y.height/2,n.startPageX=t.pageX,n.startPageY=t.pageY}i.setXY(l,p,v),c.classList.add("b-drag-original"),i.hideOriginalElement&&c.classList.add("b-hidden")}l.classList.add(i.draggingCls),Object.assign(n,{element:l,grabbed:c,grabbedParent:d,grabbedNextSibling:l.nextElementSibling,elementStartX:i.getX(l),elementStartY:i.getY(l),elementX:C.getOffsetX(l,o||s),elementY:C.getOffsetY(l,o||s),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!i.cloneTarget||o===s}),o&&(n.parentElement=l.parentElement,o!==l.parentElement&&o.appendChild(l),i.updateTranslateProxy(t))}onDragStarted(){const t=this,{context:i}=t;let{relatedElements:n}=i;if(t.unifiedProxy&&i.element.classList.add("b-drag-main","b-drag-unified-proxy"),(n==null?void 0:n.length)>0){i.relatedElStartPos=[],i.relatedElDragFromPos=[];const{proxySelector:s}=t;let[a,o]=[i.elementStartX,i.elementStartY];i.originalRelatedElements=n,n=i.relatedElements=n.map((l,c)=>{const d=s?l.querySelector(s):l,{x:u,y:h,width:f,height:g}=k.from(d,t.dragWithin),m=t.cloneTarget?t.createProxy(l):l;return m.classList.add(t.draggingCls),m.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(m,u,h),t.dragWithin.appendChild(m),m.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(m.style.width=`${f}px`,m.style.height=`${g}px`),t.hideOriginalElement&&l.classList.add("b-hidden"),l.classList.add("b-drag-original")),i.relatedElStartPos[c]=i.relatedElDragFromPos[c]=t.getXY(m),t.unifiedProxy&&(m.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),a+=t.unifiedOffset,o+=t.unifiedOffset,t.setXY(m,a,o),i.relatedElDragFromPos[c]=[a,o],m.style.zIndex=100-c),m}),t.unifiedProxy&&n&&n.length>0&&j.onTransitionEnd({element:n[0],property:"transform",handler(){n.forEach(l=>l.classList.remove("b-drag-unified-animation"))},thisObj:t,once:!0})}}applyConstraints(t,i,n){const s=this,{constrain:a,dragWithin:o}=s,{pageXOffset:l,pageYOffset:c}=o===document.body?globalThis:vM;return o&&a&&(i<0&&(i=0),i+t.offsetWidth>o.scrollWidth&&(i=o.scrollWidth-t.offsetWidth),n<0&&(n=0),n+t.offsetHeight>o.scrollHeight&&(n=o.scrollHeight-t.offsetHeight)),typeof s.minX=="number"&&(i=Math.max(s.minX+l,i)),typeof s.maxX=="number"&&(i=Math.min(s.maxX+l,i)),typeof s.minY=="number"&&(n=Math.max(s.minY+c,n)),typeof s.maxY=="number"&&(n=Math.min(s.maxY+c,n)),{constrainedX:i,constrainedY:n}}updateTranslateProxy(t,i){const n=this,{lockX:s,lockY:a,context:o}=n,l=o.dragProxy||o.element,{relatedElements:c,relatedElDragFromPos:d}=o;o.scrollManagerElementContainsDragProxy&&i&&(o.scrollX=i.getRelativeLeftScroll(l),o.scrollY=i.getRelativeTopScroll(l)),o.pageX=t.pageX,o.pageY=t.pageY,o.clientX=t.clientX,o.clientY=t.clientY;let u=o.elementStartX+t.pageX-o.startPageX+o.scrollX,h=o.elementStartY+t.pageY-o.startPageY+o.scrollY;if(n.snapCoordinates){const m=n.snapCoordinates({element:l,newX:u,newY:h});u=m.x,h=m.y}const{constrainedX:f,constrainedY:g}=n.applyConstraints(l,u,h);if((o.started||f!==u||g!==h)&&n.setXY(l,s?void 0:f,a?void 0:g),c){const m=s?0:f-o.elementStartX,p=a?0:g-o.elementStartY;c.forEach((v,y)=>{const[S,D]=d[y];n.setXY(v,S+m,D+p)})}o.newX=f,o.newY=g}async finishTranslateDrag(t){const i=this,n=i.context,{target:s}=t,a=!i.lockX&&Math.round(n.newX)!==Math.round(n.elementStartX),o=!i.lockY&&Math.round(n.newY)!==Math.round(n.elementStartY),l=n.dragProxy||n.element,{relatedElements:c}=n;if(!i.ignoreSamePositionDrop||a||o)if(n.valid===!1)await i.abortTranslateDrag(!0,t);else{const d=!i.allowDropOutside&&k.from(i.dragWithin||i.outerElement);d&&(typeof i.minX!="number"&&i.minX!==!0&&t.pageX<d.left||typeof i.maxX!="number"&&i.maxX!==!0&&t.pageX>d.right||typeof i.minY!="number"&&i.minY!==!0&&t.pageY<d.top||typeof i.maxY!="number"&&i.maxY!==!0&&t.pageY>d.bottom)?await i.abortTranslateDrag(!0,t):(n.finalize=async(u=n.valid)=>{if(n.finalized){console.warn("DragHelper: Finalizing already finalized drag");return}n.finalized=!0,!u&&i.context&&await i.abortTranslateDrag(!0,null,!0),i.isDestroyed||(i.trigger("dropFinalized",{context:n,event:t,target:s}),i.reset()),!i.cloneTarget&&l.parentElement!==n.grabbedParent&&[l,...c||[]].forEach(h=>h.style.transform="")},n.async=!1,await i.trigger("drop",{context:n,event:t,target:s}),n.async||await n.finalize())}else i.abortTranslateDrag(!1,t)}async abortTranslateDrag(t=!1,i=null,n=!1){var s,a;const o=this,{cloneTarget:l,context:c,proxySelector:d,dragWithin:u,draggingCls:h}=o,{relatedElements:f,relatedElStartPos:g,grabbed:m}=c,p=c.dragProxy||c.element;if(c.valid=!1,(s=o.scrollManager)==null||s.stopMonitoring(),c.aborted){console.warn("DragHelper: Aborting already aborted drag");return}let{elementStartX:v,elementStartY:y}=c;const S=v!==o.getX(p)||y!==o.getY(p);if(p&&c.started){if(!l&&u&&u!==c.grabbedParent&&c.grabbedParent.insertBefore(p,c.grabbedNextSibling),l&&d){const D=m.querySelector(d)||m,{x:w,y:E}=k.from(D);v=w,y=E}p.classList.add("b-aborting"),o.setXY(p,v,y),f==null||f.forEach((D,w)=>{D.classList.remove(h),D.classList.add("b-aborting"),o.setXY(D,g[w][0],g[w][1])}),n||o.trigger(t?"drop":"abort",{context:c,event:i}),p.isConnected&&!o.isDestroying&&S&&await j.waitForTransitionEnd({element:p,property:C.getPropertyTransitionDuration(p,"transform")?"transform":"all",thisObj:o,once:!0,runOnDestroy:!0}),o.isDestroyed||o.trigger("abortFinalized",{context:c,event:i})}(a=o.context)!=null&&a.started&&o.reset()}cleanUp(){const t=this,{context:i,cloneTarget:n,draggingCls:s,dragProxyCls:a}=t,o=i.dragProxy||i.element,{relatedElements:l,originalRelatedElements:c,grabbed:d}=i,u=n&&(t.removeProxyAfterDrop||!i.valid),h=[s,"b-aborting",a,"b-drag-main","b-drag-unified-proxy"];o.classList.remove(...h),u&&o.remove(),l==null||l.forEach(f=>{u?f.remove():f.classList.remove(...h)}),d.classList.remove("b-drag-original","b-hidden"),c==null||c.forEach(f=>f.classList.remove("b-hidden","b-drag-original"))}},ts={move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},Yi=class extends F.mixin(Ae,pM,yM){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const r=this;super.construct(e),r.initListeners(),r.isContainerDrag?r.initContainerDrag():r.initTranslateDrag(),r.onScrollManagerScrollCallback=r.onScrollManagerScrollCallback.bind(r)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:r}=e,t={element:r,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(r),j.on(t)}getMouseMoveListenerTarget(e){const r=e.getRootNode();let t=this.mouseMoveListenerElement;return r.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&r.mode==="closed"&&(t=e.closest(".b-outer")||t),t}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}onPointerDown(e){const r=this;if(e.button!==0||!C.isVisible(e.target)||r.context||r.isElementDraggable&&!r.isElementDraggable(e.target,e))return;if(r.startEvent=e,r.isContainerDrag?r.grabContainerDrag(e):r.grabTranslateDrag(e)){r.blurDetacher=j.on({element:globalThis,blur:r.onWindowBlur,thisObj:r});const i={element:r.mouseMoveListenerElement,thisObj:r,capture:!0,keydown:ts.keydown};if(e.pointerType==="touch"?(r.touchStartTimer=r.setTimeout(()=>r.touchStartTimer=null,r.touchStartDelay,"touchStartDelay"),i.touchmove={handler:ts.touchmove,passive:!1},i.touchend=i.pointerup=ts.touchend):(i.pointermove=ts.move,i.pointerup=ts.up),r.dragListenersDetacher=j.on(i),r.dragWithin&&r.dragWithin!==r.outerElement&&r.outerElement.contains(r.dragWithin)){const n=k.from(r.dragWithin,r.outerElement);r.minY=n.top,r.maxY=n.bottom,r.minX=n.left,r.maxX=n.right}}}internalMove(e){var r,t,i;if(e.scrollInitiated)return;const n=this,{context:s}=n,a=j.getDistanceBetween(n.startEvent,e);if(n.touchStartTimer&&a>n.dragThreshold){n.abort(!0);return}if(!n.touchStartTimer&&(s!=null&&s.element)&&(s.started||a>=n.dragThreshold)&&((r=e.target)==null?void 0:r.nodeType)===Node.ELEMENT_NODE){if(!s.started){if(n.trigger("beforeDragStart",{context:s,event:e})===!1)return n.abort();n.isContainerDrag?n.startContainerDrag(e):n.startTranslateDrag(e),s.started=!0,(t=n.scrollManager)==null||t.startMonitoring(T.merge({scrollables:[{element:n.dragWithin||n.outerElement}],callback:n.onScrollManagerScrollCallback},n.monitoringConfig)),s.outermostEl=C.getOutermostElement(e.target),s.outermostEl.classList.add("b-draghelper-active"),n.dropTargetSelector&&n.dropTargetCls&&C.getRootElement(n.outerElement).querySelectorAll(n.dropTargetSelector).forEach(l=>l.classList.add(n.dropTargetCls)),n.trigger("dragStart",{context:s,event:e}),(i=n.onDragStarted)==null||i.call(n),n.trigger("afterDragStart",{context:s,event:e})}n.update(e),e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var r;const{lastMouseMoveEvent:t}=this;(r=this.context)!=null&&r.element&&t&&(t.isScroll=!0,this.update(t,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,r){const t=this,{context:i}=t,n=document.scrollingElement||document.body;let s=t.getMouseMoveEventTarget(e);if(e.type==="touchmove"){const o=e.changedTouches[0];s=C.elementFromPoint(o.clientX+n.scrollLeft,o.clientY+n.scrollTop)}i.target=s;let a=t.allowDropOutside||!t.dragWithin||t.dragWithin.contains(e.target);a&&t.dropTargetSelector&&(a=a&&!!(s!=null&&s.closest(t.dropTargetSelector))),t.isContainerDrag?t.updateContainerProxy(e,r):t.updateTranslateProxy(e,r),i.valid=a,t.trigger("drag",{context:i,event:e}),t.isContainerDrag&&t.updateContainerDrag(e,r),i.valid=i.valid&&a;for(const o of t.draggedElements)o.classList.toggle(t.invalidCls,!i.valid);e&&(t.lastMouseMoveEvent=e)}get draggedElements(){var e;const{context:r}=this;return[r.dragProxy||r.element,...(e=r.relatedElements)!=null?e:[]]}async abort(e=!1){var r,t;const i=this,{context:n}=i;(t=(r=i.scrollManager)==null?void 0:r.stopMonitoring)==null||t.call(r),i.removeListeners(),n!=null&&n.started&&!n.aborted?(n.element.getBoundingClientRect(),n.valid=!1,i.isContainerDrag?i.abortContainerDrag(void 0,void 0,e):i.abortTranslateDrag(void 0,void 0,e),n.aborted=!0):i.reset(!0)}removeListeners(){var e,r;(e=this.dragListenersDetacher)==null||e.call(this),(r=this.blurDetacher)==null||r.call(this)}reset(e){const r=this,{context:t}=r;if(t!=null&&t.started){for(const i of r.draggedElements)i.classList.remove(r.invalidCls);t.outermostEl.classList.remove("b-draghelper-active"),r.isContainerDrag?t.dragProxy.remove():r.cleanUp(),r.dropTargetSelector&&r.dropTargetCls&&C.getRootElement(r.outerElement).querySelectorAll(r.dropTargetSelector).forEach(i=>i.classList.remove(r.dropTargetCls))}r.removeListeners(),e||r.trigger("reset"),r.context=r.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){var r;const t=this,{context:i}=t;t.removeListeners(),i&&((r=t.scrollManager)==null||r.stopMonitoring(),i.started?(e.stopPropagation(),i.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),j.on({element:document,thisObj:t,click:ts.docclick,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.reset(!0))}onKeyDown(e){var r;(r=this.context)!=null&&r.started&&e.key==="Escape"&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const r=e.cloneNode(!0);return r.removeAttribute("id"),r}get isContainerDrag(){return this.mode==="container"}async animateProxyTo(e,r={align:"c-c"}){const{context:t,draggedElements:i}=this,{element:n}=t,s=e.isRectangle?e:k.from(e);i.forEach(a=>{a.classList.add("b-drag-final-transition"),C.alignTo(a,s,r)}),await j.waitForTransitionEnd({element:n,property:"all",thisObj:this,once:!0}),i.forEach(a=>a.classList.remove("b-drag-final-transition"))}get isDragging(){var e;return!!((e=this.context)!=null&&e.started)}getMouseMoveEventTarget(e){return e.isScroll?C.elementFromPoint(e.clientX,e.clientY):e.target}};Yi._$name="DragHelper";var Br={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},Ka=class extends Ae(F){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const r=this;super.construct(e),!r.handleSelector&&!Y.isHoverableDevice&&(r.handleSize=r.touchHandleSize),r.handleVisibilityThreshold=r.handleVisibilityThreshold||2*r.handleSize,r.initListeners(),r.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=r=>r.closest(e.targetSelector)),e.grab){const{edge:r,element:t,event:i}=e.grab;e.startEvent=i;const n=e.getCursorOffsetToElementEdge(i,t,r);e.context={element:t,edge:r,valid:!0,async:!1,elementStartX:C.getTranslateX(t)||t.offsetLeft,elementStartY:C.getTranslateY(t)||t.offsetTop,newX:C.getTranslateX(t)||t.offsetLeft,newY:C.getTranslateY(t)||t.offsetTop,elementWidth:t.offsetWidth,elementHeight:t.offsetHeight,cursorOffset:n,startX:i.clientX+n.x+e.scrollLeft,startY:i.clientY+n.y+e.scrollTop,finalize:()=>{var s;return(s=e.reset)==null?void 0:s.call(e)}},t.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,r={element:e.outerElement,mousedown:Br.down,touchstart:Br.touchstart,thisObj:e};!e.handleSelector&&Y.isHoverableDevice&&(r.mousemove={handler:Br.move,delegate:e.targetSelector},r.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),j.on(r)}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const r={element:document,keydown:Br.keydown,thisObj:this};e?(r.touchmove=Br.touchmove,r.touchend=r.pointerup=Br.touchend):(r.mousemove=Br.move,r.mouseup=Br.up),this.removeDragListeners=j.on(r)}removeDragListeners(){}reset(){var e;(e=this.removeDragListeners)==null||e.call(this),this.context=null,this.trigger("reset")}canResize(e,r){return!this.isElementResizable||this.isElementResizable(e,r)}onPointerDown(e,r){const t=this;t.startEvent=r,t.canResize(r.target,r)&&t.grabResizeHandle(e,r)&&(r.stopImmediatePropagation(),r.type==="touchstart"&&r.preventDefault(),t.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){e.button===0&&this.onPointerDown(!1,e)}internalMove(e,r){var t;const i=this,{context:n,direction:s}=i;n!=null&&n.element&&(n.started||j.getDistanceBetween(i.startEvent,r)>=i.dragThreshold)?(n.started||((t=i.scrollManager)==null||t.startMonitoring(T.merge({scrollables:[{element:i.dragWithin||i.outerElement,direction:s}],callback:a=>{var o;return((o=i.context)==null?void 0:o.element)&&i.lastMouseMoveEvent&&i.update(i.lastMouseMoveEvent,a)}},i.monitoringConfig)),i.trigger("resizeStart",{context:n,event:r}),n.started=!0),i.update(r)):!e&&!i.handleSelector&&i.checkResizeHandles(r)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,r){var t,i,n;const s=this,a=s.context;(t=s.removeDragListeners)==null||t.call(s),a?((i=s.scrollManager)==null||i.stopMonitoring(),a.started&&j.on({element:document,thisObj:s,click:Br.docclick,expires:s.clickSwallowDuration,capture:!0,once:!0}),s.finishResize(r)):(n=s.reset)==null||n.call(s)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){e.key==="Escape"&&this.abort()}update(e){const r=this,t=r.context,i=k.from(r.outerElement);t.currentX=Math.max(Math.min(e.clientX+t.cursorOffset.x,i.right),i.x)+r.scrollLeft,t.currentY=Math.max(Math.min(e.clientY+t.cursorOffset.y,i.bottom),i.y)+r.scrollTop,e&&(r.updateResize(e)&&(r.trigger("resizing",{context:t,event:e}),t.element.classList.toggle(r.invalidCls,t.valid===!1)),r.lastMouseMoveEvent=e)}abort(e=!1){var r,t;const i=this;(t=(r=i.scrollManager)==null?void 0:r.stopMonitoring)==null||t.call(r),i.context?i.abortResize(null,e):i.isDestroyed||i.reset()}grabResizeHandle(e,r){const t=this;if(t.allowResize&&!t.allowResize(r.target,r))return!1;const i=t.handleSelector,n=r.type==="touchstart"?r.changedTouches[0]:r,s=n.clientX,a=n.clientY,o=t.targetSelector?r.target.closest(t.targetSelector):r.target;if(o){let l;if(i)if(r.target.matches(i))t.direction==="horizontal"?r.pageX<C.getPageX(o)+o.offsetWidth/2?l=t.isRTL?"right":"left":l=t.isRTL?"left":"right":r.pageY<C.getPageY(o)+o.offsetHeight/2?l="top":l="bottom";else return!1;else if(t.direction==="horizontal"?t.overLeftHandle(r,o)?l=t.isRTL?"right":"left":t.overRightHandle(r,o)&&(l=t.isRTL?"left":"right"):t.overTopHandle(r,o)?l="top":t.overBottomHandle(r,o)&&(l="bottom"),!l)return t.context=null,!1;r.type==="touchstart"&&r.preventDefault();const c=t.getCursorOffsetToElementEdge(n,o,l);if(t.trigger("beforeResizeStart",{element:o,event:r})!==!1)return t.context={element:o,edge:l,isTouch:e,valid:!0,async:!1,direction:t.direction,elementStartX:C.getTranslateX(o)||o.offsetLeft,elementStartY:C.getTranslateY(o)||o.offsetTop,newX:C.getTranslateX(o)||o.offsetLeft,newY:C.getTranslateY(o)||o.offsetTop,elementWidth:o.offsetWidth,elementHeight:o.offsetHeight,cursorOffset:c,startX:s+c.x+t.scrollLeft,startY:a+c.y+t.scrollTop,finalize:()=>{var d;return(d=t.reset)==null?void 0:d.call(t)}},o.classList.add(t.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,r,t){const i=k.from(r);let n=0,s=0;switch(t){case"left":n=i.x-(this.isRTL?i.width:0)-e.clientX;break;case"right":n=i.x+(this.isRTL?0:i.width)-e.clientX;break;case"top":s=i.y-e.clientY;break;case"bottom":s=i.y+i.height-e.clientY;break}return{x:n,y:s}}checkResizeHandles(e){const r=this,t=r.targetSelector?e.target.closest(r.targetSelector):e.target;if(t&&(!r.allowResize||r.allowResize(e.target,e))){if(r.currentElement=r.handleContainerSelector?e.target.closest(r.handleContainerSelector):e.target,r.currentElement){let i;r.direction==="horizontal"?i=r.overLeftHandle(e,t)||r.overRightHandle(e,t):i=r.overTopHandle(e,t)||r.overBottomHandle(e,t),i?r.highlightHandle():r.unHighlightHandle()}}else r.currentElement&&r.unHighlightHandle()}onMouseLeaveTarget(e){const r=this;r.currentElement=r.handleContainerSelector?e.target.closest(r.handleContainerSelector):e.target,r.currentElement&&r.unHighlightHandle()}updateResize(e){const r=this,{context:t,allowEdgeSwitch:i,skipTranslate:n,skipUpdatingElement:s}=r;let a;i&&(r.direction==="horizontal"?t.edge=t.currentX>t.startX?"right":"left":t.edge=t.currentY>t.startY?"bottom":"top");const{element:o,elementStartX:l,elementStartY:c,elementWidth:d,elementHeight:u,edge:h}=t,{style:f}=o,g=t.currentX-t.startX,m=t.currentY-t.startY,p=C.getExtremalSizePX(o,"minWidth")||r.minWidth,v=C.getExtremalSizePX(o,"maxWidth")||r.maxWidth,y=C.getExtremalSizePX(o,"minHeight")||r.minHeight,S=C.getExtremalSizePX(o,"maxHeight")||r.maxHeight,D=h==="right"&&!r.isRTL||h==="bottom"?1:-1,w=d+g*D,E=u+m*D;let x=Math.max(p,w),M=Math.max(y,E);if(v>0&&(x=Math.min(x,v)),S>0&&(M=Math.min(M,S)),f.flex&&(f.flex=""),r.direction==="horizontal"&&d!==x){if(s||(f.width=Math.abs(x)+"px"),t.newWidth=x,h==="left"||x<0){const I=Math.max(Math.min(l+d-r.minWidth,l+g),0);n||C.setTranslateX(o,Math.round(I)),t.newX=I}else h==="right"&&i&&!n&&C.setTranslateX(o,l);a=!0}else r.direction==="vertical"&&u!==E&&(s||(f.height=Math.abs(M)+"px"),t.newHeight=M,h==="top"||M<0?(t.newY=Math.max(Math.min(c+u-r.minHeight,c+m),0),n||C.setTranslateY(o,t.newY)):h==="bottom"&&i&&!n&&C.setTranslateY(o,c),a=!0);return a}finishResize(e){var r;const t=this,i=t.context,n={context:i,event:e};if(i.element.classList.remove(t.resizingCls),i.started){let s=!1;t.direction==="horizontal"?s=i.newWidth&&i.newWidth!==i.elementWidth:s=i.newHeight&&i.newHeight!==i.elementHeight,t.trigger(s?"resize":"cancel",n),i.async||i.finalize()}else(r=t.reset)==null||r.call(t)}abortResize(e=null,r=!1){const t=this,i=t.context;i.element.classList.remove(t.resizingCls),t.direction==="horizontal"?((i.edge==="left"||i.allowEdgeSwitch&&!i.skipTranslate)&&C.setTranslateX(i.element,i.elementStartX),i.element.style.width=i.elementWidth+"px"):(C.setTranslateY(i.element,i.elementStartY),i.element.style.height=i.elementHeight+"px"),!r&&t.trigger("cancel",{context:i,event:e}),t.isDestroyed||t.reset()}highlightHandle(){const e=this,r=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),r.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,r=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;r&&r.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,r){return this.overStartHandle(e,r)||this.overEndHandle(e,r)}overStartHandle(e,r){return this.direction==="horizontal"?this.overLeftHandle(e,r):this.overTopHandle(e,r)}overEndHandle(e,r){return this.direction==="horizontal"?this.overRightHandle(e,r):this.overBottomHandle(e,r)}getDynamicHandleSize(e,r){const t=e?2:1,{handleSize:i}=this;return this.dynamicHandleSize&&i*t>r-this.reservedSpace?Math.max(Math.floor((r-this.reservedSpace)/t),0):i}overLeftHandle(e,r){const t=this,{offsetWidth:i}=r;if(t.leftHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.width=t.getDynamicHandleSize(t.rightHandle,i),n.width>0&&n.contains(j.getPagePoint(e))}return!1}overRightHandle(e,r){const t=this,{offsetWidth:i}=r;if(t.rightHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.x=n.right-t.getDynamicHandleSize(t.leftHandle,i),n.width>0&&n.contains(j.getPagePoint(e))}return!1}overTopHandle(e,r){const t=this,{offsetHeight:i}=r;if(t.topHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.height=t.getDynamicHandleSize(t.bottomHandle,i),n.height>0&&n.contains(j.getPagePoint(e))}return!1}overBottomHandle(e,r){const t=this,{offsetHeight:i}=r;if(t.bottomHandle&&t.canResize(r,e)&&(i>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=k.from(r);return n.y=n.bottom-t.getDynamicHandleSize(t.bottomHandle,i),n.height>0&&n.contains(j.getPagePoint(e))}return!1}};R(Ka,"configurable",{skipUpdatingElement:null}),Ka._$name="ResizeHelper";var qC=/>[ \t\r\n]+</g,bM=/\s\s+/g,Jt=class{static tpl(e,...r){let t=0,i=r.map((n,s)=>{let a=e[s];return Array.isArray(n)?a+=n.reduce((o,l)=>o+=(typeof l=="string"?l.trim():l)+`
`,""):(n===void 0&&(n=""),a+=typeof n=="string"?n.trim():n),t++,a}).join("");return t<=e.length&&(i+=e[e.length-1]),i.replace(qC,"><").replace(bM," ").trim()}static docsTpl(e,...r){let t=0,i=r.map((n,s)=>{let a=e[s];return Array.isArray(n)?a+=n.reduce((o,l)=>o+=(typeof l=="string"?l.trim():l)+`
`,""):(n===void 0&&(n=""),a+=typeof n=="string"?n.trim():n),t++,a}).join("");return t<=e.length&&(i+=e[e.length-1]),i.replace(qC,"><").trim()}static repeat(e){return function(...r){return Jt.tpl(...r).repeat(e)}}static loop(e){}};Jt._$name="TemplateHelper";var CM=class extends Array{constructor(e,r){super(),this.timeZone=e,this.year=r}},SM=class{constructor(e,r){this.asString=e,this.timeZone=r,this.asArray=DM(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}},KC=(e,r)=>{const t=e.toLocaleString("sv-SE",{timeZone:r});return new SM(t,r)},wM=(e,r)=>{const{asTicksUtc:t,asString:i}=KC(new Date(e),r);return{offset:(e-t)/6e4,tzTicksUtc:t,tzString:i}},DM=e=>{const r=e.split(/[\s-:]/).map(t=>t*1);return r[1]-=1,r},EM=-6e4,xM=36e5,XC=-864e5,Xa=2592e6,ZC=(e,r)=>{const t=JC.get(e,r);if(t)return t;const i=new CM(e,r),n=new Date(Date.UTC(r,0,1)).getTime();let s=n,a=Xa,o=0,l=[],c=null,d,u,h,f;for(;!f;)({offset:h,tzTicksUtc:d,tzString:u}=wM(s,e)),c==null?(c=h,i.push({offset:h})):a>0&&h!==c?a=a===Xa?XC:EM:a<0&&h===c&&(a===XC?a=xM:(i.length===1?(i.push(l),c=l.offset):(i[0].startTicks=l.startTicks,i[0].startDateString=l.startDateString,f=!0),a=Xa)),l={offset:h,startDateString:u,startTicks:d},a===Xa&&(s=n,s+=o*Xa,o+=1),s+=a,o>11&&(f=!0);return JC.set(i),i},JC={_cache:{},get(e,r){var t;return(t=this._cache[e])==null?void 0:t[r]},set(e){const{timeZone:r}=e,{_cache:t}=this;t[r]||(t[r]={}),t[r][e.year]=e}},pt=class{static get $name(){return"TimeZoneHelper"}static toTimeZone(e,r){if(typeof r=="number")return this.toUtcOffset(e,r);const t=KC(e,r);return t.asArray[3]!==t.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),t.asLocalDate}static fromTimeZone(e,r){if(typeof r=="number")return this.fromUtcOffset(e,r);const t=this.dateAsArray(e),i=ZC(r,e.getUTCFullYear());let n=i[0].offset;if(i.length===2){const s=Date.UTC(...t);s>=i[1].startTicks&&s<i[0].startTicks&&(n=i[1].offset)}return t[4]+=n,new Date(Date.UTC(...t))}static toUtcOffset(e,r){const t=e.getTimezoneOffset()+r;return new Date(e.getTime()+t*60*1e3)}static fromUtcOffset(e,r){const t=-e.getTimezoneOffset()-r;return new Date(e.getTime()+t*60*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}};pt.findOffsetDates=ZC,pt._$name="TimeZoneHelper";var At=class extends ${static get $name(){return"Toast"}static get type(){return"toast"}static get configurable(){return{testConfig:{destroyTimeout:1,timeout:100},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}compose(){const{appendTo:e,color:r,html:t,showProgress:i,style:n,timeout:s}=this;return{parent:e||this.floatRoot,class:{...J.normalize(r,"object"),"b-toast-hide":1},html:t,style:n,children:{progressElement:i&&{style:`animation-duration:${s/1e3}s;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}get nextBottom(){const{bottomMargin:e,element:r}=this;return parseInt(r.style.bottom,10)+r.offsetHeight+e}async show(){var e,r;await super.show(...arguments);const t=this,{element:i}=t,{toasts:n}=At;n.includes(t)||(i.style.bottom=((r=(e=n[0])==null?void 0:e.nextBottom)!=null?r:t.bottomMargin)+"px",n.unshift(t),i.getBoundingClientRect(),i.classList.remove("b-toast-hide"),t.timeout>0&&(t.hideTimeout=t.setTimeout("hide",t.timeout)))}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const{toasts:e}=At;e.includes(this)&&e.splice(e.indexOf(this),1)}static hideAll(){At.toasts.slice().reverse().forEach(e=>e.hide())}static show(e){const r=At.new({autoDestroy:!0,rootElement:document.body},typeof e=="string"?{html:e}:e);return r.show(),r}};At.toasts=[],At.initClass(),At._$name="Toast";var rs=class{static getById(e){return $.getById(e)}static fromElement(e,r,t){return $.fromElement(e,r,t)}static createWidget(e={}){return e.isWidget?e:$.create(e)}static append(e,r){if(e=Array.isArray(e)&&e||[e],(r instanceof HTMLElement||typeof r=="string")&&(r={appendTo:r}),r.insertFirst){const t=typeof r.insertFirst=="string"?document.getElementById(r.insertFirst):r.insertFirst;t.firstChild?r.insertBefore=t.firstChild:r.appendTo=t}return e.map(t=>$.create(T.assign({},r||{},t)))}static openPopup(e,r){return $.create(T.assign({forElement:e},typeof r=="string"?{html:r}:r),"popup")}static showContextMenu(e,r){const t=this;return t.currentContextMenu&&t.currentContextMenu.destroy(),e instanceof HTMLElement?r.forElement=e:(r.forElement=document.body,Array.isArray(e)&&(e=new ir(...e)),e instanceof ir&&(r.align={position:e})),r.internalListeners={destroy:t.currentContextMenu=null},t.currentContextMenu=$.create(r,"menu")}static attachTooltip(e,r){return $.attachTooltip(e,r)}static hasTooltipAttached(e){return $.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return $.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,r="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:r}),It.mask(e,e.target)}static unmask(e,r=!0){e.mask&&(r?e.mask.close():e.mask.hide())}static toast(e){return At.show(e)}};rs._$name="WidgetHelper";var QC=class{static convertFromObject(e,r={}){U.assignIf(r,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:t,elementName:i,includeHeader:n,rootElementForArray:s}=r;let{xmlns:a}=r;a=a?` xmlns="${a}"`:"";const o=n?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':"",l=c=>{const d=[];for(const u in c){const h=c[u];if(Array.isArray(h)){s&&d.push(`<${u}>`);for(const f of h)i.length?d.push(`<${i}>`):d.push(`<${u}>`),d.push(l(f)),i.length?d.push(`</${i}>`):d.push(`</${u}>`);s&&d.push(`</${u}>`)}else U.isObject(h)?d.push(`<${u}>${l(h)}</${u}>`):h==null?d.push(`<${u}/>`):d.push(`<${u}>${L.encodeHtml(h)}</${u}>`)}return d.join("")};return`${o}<${t}${a}>${l(e)}</${t}>`}};QC._$name="XMLHelper";var is=class{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){const{randomCache:r}=this;let t;return r[e]?t=r[e]:(t=this.random100.filter(i=>i<e),r[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}randomArray(e,r){const t=[],i=this.nextRandom(r+1),n={};for(let s=0,a=this.nextRandom(e.length);s<i;s++){for(;n[a];)a=this.nextRandom(e.length);n[a]=!0,t.push(e[a])}return t}};is._$name="RandomGenerator";var RM=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"],ns=class{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,r=!1,t=1){var i;let n,s;typeof e=="object"&&(r=e.randomHeight,t=(i=e.initialId)!=null?i:1,n=e.addSkills,s=e.rowCallback,e=e.count);const a=this,{rnd:o,rndTime:l,rndRating:c,rndText:d,firstNames:u,surNames:h,teams:f,foods:g,colors:m,cities:p,skills:v}=a;for(let y=0;y<e;y++){const S=o.fromArray(u),D=o.fromArray(h),w=`${S} ${String.fromCharCode(65+y%25)} ${D}`,E=o.nextRandom(60)+1,x=new Date(2019,0,E),M=new Date(2019,0,E+o.nextRandom(30)+2),I={id:t>-1?y+t:void 0,title:"Row "+y,name:w,firstName:S,surName:D,city:o.fromArray(p),team:o.fromArray(p)+" "+o.fromArray(f),age:10+o.nextRandom(80),food:o.fromArray(g),color:o.fromArray(m),score:o.nextRandom(100)*10,rank:o.nextRandom(100)+1,start:x,finish:M,time:b.getTime(l.nextRandom(24),l.nextRandom(12)*5),percent:o.nextRandom(100),done:o.nextRandom(100)<50,rating:c.nextRandom(5),relatedTo:Math.min(e-1,y+t+o.nextRandom(10)),notes:RM[d.nextRandom(7)+1]};n&&(I.skills=o.randomArray(v,7));const P=s==null?void 0:s(I);P&&Object.assign(I,P),r&&(I.rowHeight=o.nextRandom(r===!0?20:r)*5+20),yield I}}static generateData(e,r=!1,t=1,i=!0){let n=e;typeof e!="object"&&(n={count:e,randomHeight:r,initialId:t,reset:i}),n.reset!==!1&&this.reset(),ns.overrideRowCount&&(n.count=ns.overrideRowCount);const s=[],a=this.generate(n);for(let o=0;o<n.count;o++)s.push(a.next().value);return s}static generateEvents({viewStartDate:e,viewEndDate:r,nbrResources:t=50,nbrEvents:i=5,dependencies:n,tickUnit:s="days",minDuration:a=2,maxDuration:o=10}){const l=this.generateData(t),c=[];n=[];for(let d=0;d<t;d++)for(let u=0;u<i;u++){const h=b.getDurationInUnit(e,r,s),f=b.add(e,Math.round(Math.random()*.9*h),s),g=Math.round(Math.random()*(o-a))+a,m=b.add(f,g,"days"),p=c.length+1;c.push({id:p,name:this.tasks[(d+u)%(this.tasks.length-1)],startDate:f,duration:g,endDate:m,resourceId:d}),n&&d>0&&n.push({id:n.length+1,from:p-1,to:p})}return{resources:l,events:c,dependencies:n}}static generateRow(){return ns.generateData(1,!1,-1,!1)[0]}};Object.assign(ns,{rnd:new is,rndTime:new is,rndRating:new is,rndText:new is,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"],skills:["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"],tasks:["Meetings","Documentation","Email communication","Project management","Budgeting","Marketing and advertising","Customer service","Research and analysis","Data entry","IT support","Employee management","Sales and business development","Event planning","Graphic design","Writing and editing","Presentation","Travel arrangements and expense management","Training and development","Quality assurance","Customer support","Technical writing","Social media management","Translation","Legal research","Data analysis and visualization","Video editing and production","Network admin","Content creation","Market research","Public relations","Teaching and training","Recruiting","Product development"]}),ns._$name="DataGenerator";var TM=["action","target","to","deltaX","deltaY","x","y","text"],eS=class extends Ae(ge()){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const r=this;r.widget&&(r.outerElement=r.widget.element,r.widget.playingDemo=!0),j.playingDemo=!0,Object.assign(r,{prevTarget:null,currentStep:0,mouse:C.createElement({parent:r.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),r.intervalId=r.setInterval(r.nextStep.bind(r),1e3),r.outerElement.classList.add("b-playing-demo"),r.outerElement.addEventListener("click",t=>{t.isTrusted&&r.abort()})}doDestroy(){this.abort()}abort(e=!1){const r=this;r.mouse.style.top="-100px",r.clearInterval(r.intervalId),r.timeoutId&&r.clearTimeout(r.timeoutId),r.innerIntervalId&&r.clearInterval(r.innerIntervalId),r.outerElement.classList.remove("b-playing-demo"),r.widget&&(r.widget.playingDemo=!1),j.playingDemo=!1,r.trigger(e?"done":"abort")}triggerEvent(e,r,t){if(!e)return null;let i;if(r.startsWith("mouse")){const n=this.mouse.getBoundingClientRect();i=new MouseEvent(r,Object.assign({view:globalThis,bubbles:!0,cancelable:!0,clientX:n.left,clientY:n.top},t||{}))}else i=document.createEvent("Event"),i.initEvent(r,!0,!1);return e.dispatchEvent(i),i}handleMouseMove(e,r){const t=this,i=t.mouse;i.classList.add("quick"),t.mouseDown&&i.classList.add("drag");const n=k.from(i,t.outerElement),s=n.x,a=n.y;let o=0,l=0;if(e.to)if(typeof e.to=="string"){const d=t.outerElement.querySelector(e.to);if(d){const u=k.from(d,t.outerElement),h=u.x+u.width/2,f=u.y+u.height/2;o=(h-s)/10,l=(f-a)/10}}else e.to.x?o=(e.to.x-s)/10:(o=e.to[0]/10,l=e.to[1]/10);else e.deltaX?o=e.deltaX/10:e.x&&(o=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let c=0;t.innerIntervalId=t.setInterval(()=>{if(t.shouldPause)return;c++===9&&(clearInterval(t.innerIntervalId),e.then&&e.then());const d=s+o*c,u=a+l*c;i.style.left=d+"px",i.style.top=u+"px";const h=i.getBoundingClientRect(),f=h.left,g=h.top,m=C.elementFromPoint(f,g);m!==t.prevTarget&&(t.prevTarget&&(t.mouseOutElements.push(t.prevTarget),C.isDescendant(t.mouseOutElements[0],m)||(t.mouseOutElements.forEach(p=>t.triggerEvent(p,"mouseout")),t.mouseOutElements.length=0)),t.prevTarget=m,t.triggerEvent(m,"mouseover")),t.triggerEvent(m,e.action,{clientX:f,clientY:g})},50)}getTarget(e){const r=this,t=e.target;return t?typeof t=="function"?t(e):document.querySelector(t):r.prevTarget||r.outerElement}normalizeStep(e){if(e.action)return typeof e.action=="function"?e.action(e):e;if(typeof e=="function")return e(),e;for(const r in e)Object.hasOwnProperty.call(e,r)&&!TM.includes(r)&&(e.action=r.toLowerCase(),e.to=e[r]);return!e.target&&(typeof e.to=="string"||typeof e.to=="function")&&(e.target=e.to),e}get isScrolling(){const e=this,r=e.outerElement.getBoundingClientRect(),t=e.lastTop&&r.top!==e.lastTop;return e.lastTop=r.top,t}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<globalThis.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length)if(e.repeat)e.currentStep=0;else return e.abort(!0);e.currentStep===0&&e.trigger("initialize");const r=e.mouse,t=e.normalizeStep(e.steps[e.currentStep++]),i=e.getTarget(t),n=t.action;if(i&&n)if(r.className="simulated-mouse",n==="mousemove")e.handleMouseMove(t,i);else{if(i!==e.prevTarget){const s=k.from(i,e.outerElement);r.style.left=s.x+s.width/2+"px",r.style.top=s.y+s.height/2+"px"}n==="mousedown"&&(e.mouseDown=!0),n==="mouseup"&&(e.mouseDown=!1),e.timeoutId=e.setTimeout(()=>{if(e.prevTarget=i,r.classList.add(n),n==="type"){const s=$.fromElement(i),a=t.text.split("|");s.value=a[a.length===1||s.value!=a[0]?0:1]}else e.triggerEvent(i,n)},n==="type"?100:550)}}};eS._$name="DemoBot";var tS=Object.prototype.hasOwnProperty,Hh=null;function MM(e,r){return Object.defineProperty(e,"parser",{value:r}),r}var PM=class{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,r){return this.formatter.defaultParse(e,r)}resolvedOptions(){return null}},fc=class{static get(e){if(e==null)return this.NULL;if(e instanceof this)return e;const r=typeof e=="string"?e:JSON.stringify(e),t=this.cache;let i=t.get(r);return i||(Hh=r,i=new this(e),t.set(r,i)),i}static get cache(){return tS.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return tS.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const r=this;if(r.cacheKey=Hh,Hh=null,r.initialize(),e===null)r.formatter=new PM(r);else{r.configure(e);for(const[t,i]of Object.entries(r.resolvedOptions()))i!=null&&t in r.defaults&&(r[t]=i)}}get parser(){return MM(this,new this.constructor.Parser(this))}defaultFormat(e){return e==null?e:String(e)}defaultParse(e){return e}format(e){return e==null?e:this.formatter.format(e)}parse(e,r){return e==null?e:this.parser.parse(e,r)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}};fc._$name="Formatter";var qi=class extends F.mixin(Ae,$i){static get $name(){return"Navigator"}static get type(){return"navigator"}static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:e}=this;if(this.target.contains(e))return e;this._activeItem=null}updateOwnerCmp(e){this.itemSelector||(this.itemSelector=`.${this.ownerCmp.itemCls}`),C.setAttributes(this.keyEventTarget,{"aria-activedescendant":`${this.owner.id}-active-descendant`})}set navigationEvent(e){const{owner:r}=this;this._navigationEvent=r.navigationEvent=e,e&&Promise.resolve(1).then(()=>this.navigationEvent=null)}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(e){const r=(e.key||"").trim()||e.code;return`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${r}`}onKeyDown(e){var r;const t=this,{ownerCmp:i,itemSelector:n,activeItem:s,itemsTabbable:a}=t,{target:o}=e,l=t.target.querySelector(n),c=(e.key||"").trim()||e.code,d=t.constructor.getComposedKeyName(e),u=o.matches(n)||o===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(e=t.processEvent.call(i,e)),e&&!t.disabled&&l&&t.target.offsetParent&&u){if(!a){if(t.inlineFlow==null){const h=l.parentNode,f=C.getStyleValue(l,"position"),g=C.getStyleValue(l,"display"),m=C.getStyleValue(l,"float");t.inlineFlow=f==="absolute"||g==="inline"||g==="inline-block"||m==="left"||m==="right"||C.getStyleValue(h,"display")==="flex"&&C.getStyleValue(h,"flex-direction")==="row"}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=e,s)switch(c){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigateNext(e);break;default:{const h=(r=t.keys)==null?void 0:r[d];if(h&&!t.disabled){if(t.callback(h,t.thisObj||i,[e])===!1)return}else i.onInternalKeyDown&&i.onInternalKeyDown(e);if(C.getActiveElement(o)!==o&&e.preventDefault(),a)return}}else{if(a)return;(c===t.nextKey||c===t.prevKey)&&(t.activeItem=t.getDefaultNavigationItem(e))}t.activeItem!==s&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:r,itemSelector:t,prevKey:i,nextKey:n}=this;if(r.compareDocumentPosition(e.target)&4&&e.key===i)return r.querySelector(`${t}:last-of-type`);if(r.compareDocumentPosition(e.target)&2&&e.key===n)return r.querySelector(`${t}`)}navigatePrevious(e){const r=this,t=r.previous;e.preventDefault(),t&&r.ownerCmp.scrollable.scrollIntoView(t,{animate:r.scrollDuration}).then(()=>{r.activeItem=t,r.triggerNavigate(e)})}navigateNext(e){const r=this,t=r.next;e.preventDefault(),t&&r.ownerCmp.scrollable.scrollIntoView(t,{animate:r.scrollDuration}).then(()=>{r.activeItem=t,r.triggerNavigate(e)})}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,r=this.activeItem){const t=this.treeWalker;if(t.currentNode=r,t[e<0?"previousNode":"nextNode"](),t.currentNode!==this.activeItem)return t.currentNode}onTargetFocusIn(e){var r;const t=this,{target:i,relatedTarget:n}=e,{owner:s,itemsTabbable:a,skipScrollIntoView:o,previousActiveItem:l}=t;i.matches(".b-focus-trap")||(i.matches(t.itemSelector)?(t.skipScrollIntoView=!0,t.activeItem=i,t.skipScrollIntoView=o,t.activeItem&&a&&t.triggerNavigate(e)):i===t.target&&((n?i.compareDocumentPosition(n):0)&Node.DOCUMENT_POSITION_CONTAINED_BY?(r=s.previousSibling)==null||r.focus():t.activeItem=l&&t.target.contains(l)?l:0))}onTargetFocusOut(e){const r=this,{relatedTarget:t}=e;t!=null&&t.matches(".b-focus-trap")||(!t||!r.target.contains(t)||!t.matches(r.itemSelector))&&r.activeItem&&(r.activeItem=null,r.itemsTabbable&&r.triggerNavigate(e))}onTargetMouseDown(e){const r=this,t=e.target.closest(r.itemSelector);r.navigationEvent=e,r.itemsTabbable?t===r.activeItem&&r.triggerNavigate(e):r.ownerCmp.itemsFocusable===!1?r.onFocusGesture(e):t&&(e.preventDefault(),C.focusWithoutScrolling(t))}onTargetClick(e){var r;const t=this,{skipScrollIntoView:i}=t;if(t.skipNextClick||(r=t.navigationEvent)!=null&&r.ignoreNavigation){t.skipNextClick=!1;return}t.disabled||(t.skipScrollIntoView=!0,t.processEvent&&(e=t.processEvent.call(t.ownerCmp,e)),e&&(t.activeItem=e.target.closest(t.itemSelector),t.triggerNavigate(e)),t.skipScrollIntoView=i)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&this.ownerCmp.itemsFocusable===!1)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?C.NodeFilter.FILTER_ACCEPT:C.NodeFilter.FILTER_SKIP}changeActiveItem(e){return e!=null&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,r){var t;const i=this,{ownerCmp:n}=i,s=r&&i.target.contains(r),a=e&&C.isFocusable(e)&&e!==C.getActiveElement(e);if(s&&(i.previousActiveItem=r),r&&(r.classList.remove(i.focusCls),r.removeAttribute("id")),e!=null){if(i.skipScrollIntoView?a&&C.focusWithoutScrolling(e):(t=n.scrollable)==null||t.scrollIntoView(e,{block:"nearest",focus:a,silent:i.scrollSilently}),e===r&&s)return;e.classList.add(i.focusCls),e.id=`${i.owner.id}-active-descendant`,i._activeItem=e}else i._activeItem=null,r===C.getActiveElement(r)&&n.revertFocus()}updateTarget(e,r){const t=this,i={element:e,thisObj:t,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:t.itemSelector}};!t.itemsTabbable&&!t.itemsFocusable&&(i.click="onTargetClick"),Object.prototype.hasOwnProperty.call(t,"acceptNode")||(t.acceptNode=t.acceptNode.bind(t),t.acceptNode.acceptNode=t.acceptNode),j.on(i),t.treeWalker=t.setupTreeWalker(e,C.NodeFilter.SHOW_ELEMENT,t.acceptNode),t.keyEventTarget||(t.keyEventTarget=e),(t.targetMutationMonitor=new MutationObserver(t.onTargetChildListChange.bind(t))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,r,t){return document.createTreeWalker(e,r,t)}onTargetChildListChange(){var e;const r=this,{activeItem:t,datasetIdProperty:i}=r;t&&(r.target.contains(t)?t.classList.contains(r.focusCls)||t.classList.add(r.focusCls):r.activeItem=r.target.querySelector(`${r.itemSelector}.${r.focusCls}[data-${L.hyphenate(i)}="${t.dataset[i]}"]`)||((e=r.target.querySelector(`${r.itemSelector}.${r.focusCls}`))==null?void 0:e[t.dataset.index])||null)}changeKeyEventTarget(e){this._keyEventTarget=e,j.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,r=this.activeItem){var t;const i={event:e,item:r,oldItem:this.previousActiveItem};this.trigger("navigate",i),(t=this.ownerCmp)==null||t.trigger("navigate",i)}};qi._$name="Navigator";var gc=L.escapeRegExp,rS=/[\d+-]/g,mc=(e,r)=>new Intl.NumberFormat(e||void 0,r),IM=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,AM="\u2212",_M=class{constructor(e){const r=this,t=e.locale,i=mc(t,{maximumFractionDigits:3}),n=e.is.currency?r._decodeStyle(t,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?r._decodeStyle(t,{style:"percent"}):null,a=i.format(1.2).replace(rS,"")[0],o=i.format(1e9).replace(rS,"")[0]||"";Object.assign(r,{currency:n,decimal:a,formatter:e,grouper:o,percent:s}),r.decimal=a,r.decimalRe=gc(a,"g"),r.grouper=o,r.stripRe=new RegExp(`(?:\\s+|${gc(o)})`+(n?`|(?:${gc(n.text)})`:"")+(s?`|(?:${gc(s.text)})`:""),"g")}decimalPlaces(e){e=e.replace(this.stripRe,"");const r=e.indexOf(this.decimal)+1;return r&&e.length-r}parse(e,r){return typeof e=="string"&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace(AM,"-"),e=r?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,r){const t=mc(e,r),i=mc(e,Object.assign(t.resolvedOptions(),{style:"decimal"})),n=t.format(0),s=i.format(0);return{suffix:n.startsWith(s),text:n.replace(s,"").trim()}}},lr=class extends fc{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return e==null?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const r=this;typeof e!="string"?Object.assign(r,e):r.template=e;const t={},i=r.locale?He.locales[r.locale]:He.locale,n=i&&i.NumberFormat,s=r.template;if(n)for(const a in n)r[a]==null&&typeof n[a]!="function"&&(r[a]=n[a]);if(s){const a=IM.exec(s),o=a[2],l=a[4];r.useGrouping=!!a[3],r.style=a[1]?"currency":a[6]?"percent":"decimal",o&&(r.integer=+o),l==="*"?r.fraction=[0,20]:l!=null&&(r.fraction=[a[5].length,l.length])}r._minMax("fraction",!0,!0),r._minMax("integer",!0,!1),r._minMax("significant",!1,!0);for(const a in r.defaults)r[a]!=null&&(t[a]=r[a]);r.is.from=r.from&&r.from.is,r.is[r.style]=!(r.is.null=!1),r.formatter=mc(r.locale,t)}as(e,r=null){const t=this.resolvedOptions()||{template:"9.*"},i=this._as;let n=r&&i[r];return n||(typeof e=="string"?t.style=e:Object.assign(t,e),t.from=this,n=new lr(t)),r&&(i[r]=n),n}defaultParse(e,r){return e==null?e:r?Number(e):parseFloat(e)}format(e){if(typeof e=="string"){const r=Number(e);e=isNaN(r)?this.parse(e):r}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const r=this,t=r.maximumFractionDigits,{truncator:i}=r;let n=r.parse(e),s;return i&&(n=i.format(n),s=n.indexOf(i.parser.decimal),s>-1&&n.length-s-1>t&&(n=n.substr(0,s+t+1)),n=i.parse(n)),n}resolvedOptions(){const e=super.resolvedOptions();for(const r in e)e[r]===void 0&&(e[r]=this[r]);return e}_minMax(e,r,t){const i=this,n=i[e];if(n!=null){const s=L.capitalize(e),a=`maximum${s}Digits`,o=`minimum${s}Digits`;typeof n=="number"?(r&&(i[o]=n),t&&(i[a]=n)):(i[o]=n[0],i[a]=n[1])}}};lr.Parser=_M,Object.assign(lr.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(lr.prototype,lr.prototype.defaults),fc.number=(e,r)=>lr.format(e,r),lr._$name="NumberFormat";var Za=class extends Ae(F){construct(e={}){const r=this;super.construct(e),r.onWsOpen=r.onWsOpen.bind(r),r.onWsClose=r.onWsClose.bind(r),r.onWsMessage=r.onWsMessage.bind(r),r.onWsError=r.onWsError.bind(r),r.autoConnect&&r.address&&r.open()}doDestroy(){const e=this;e.connector&&(e.detachSocketListeners(e.connector),e.connector.close(),e.connector=null),super.doDestroy()}get isConnecting(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CONNECTING}get isOpened(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.OPEN}get isClosing(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSING}get isClosed(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSED}createWebSocketConnector(){const e=this.connector=new this.constructor.webSocketImplementation(this.address);this.attachSocketListeners(e)}destroyWebSocketConnector(){this.detachSocketListeners(this.connector),this.connector.close(),this.connector=null}attachSocketListeners(e){const r=this;e.addEventListener("open",r.onWsOpen),e.addEventListener("close",r.onWsClose),e.addEventListener("message",r.onWsMessage),e.addEventListener("error",r.onWsError)}detachSocketListeners(e){const r=this;e.removeEventListener("open",r.onWsOpen),e.removeEventListener("close",r.onWsClose),e.removeEventListener("message",r.onWsMessage),e.removeEventListener("error",r.onWsError)}async open(){const e=this;if(e._openPromise)return e._openPromise;if(!e.address){console.warn("Server me.address cannot be empty");return}if(e.isOpened)return!0;e.createWebSocketConnector();let r;return e._openPromise=new Promise(t=>{r=e.ion({open(){t(!0)},error(){t(!1)}})}).then(t=>(r(),e._openPromise=null,t||e.destroyWebSocketConnector(),t)).catch(()=>{e._openPromise=null,e.destroyWebSocketConnector()}),e._openPromise}close(){this.connector&&(this.destroyWebSocketConnector(),this.trigger("close"))}send(e,r={}){var t;(t=this.connector)==null||t.send(JSON.stringify({command:e,...r}))}onWsOpen(e){this.trigger("open",{event:e})}onWsClose(e){this.trigger("close",{event:e})}onWsMessage(e){try{const r=JSON.parse(e.data);this.trigger("message",{data:r})}catch(r){this.trigger("error",{error:r})}}onWsError(e){this.trigger("error",{error:e})}};R(Za,"webSocketImplementation",typeof WebSocket=="undefined"?null:WebSocket),R(Za,"configurable",{address:"",userName:"User",autoConnect:!0}),Za._$name="WebSocketManager";var iS=e=>class extends(e||F){static get $name(){return"Finalizable"}construct(...t){super.construct(...t),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const t=this;let i=t.finalizing;return!i&&!t.isFinalized&&(t.isFinalizing=!0,t.finalizing=i=t._awaitFinalizer()),i}async _awaitFinalizer(){const t=this;try{await t.finalizer}finally{t.finalizing=null,t.isFinalized=!0,t.doFinalize()}}},Vh=Symbol("dragAbort"),pc=Symbol("dragInit"),nS=Symbol("dragDrag"),Nh=Symbol("dragDrop"),FM={x:"horizontal",y:"vertical"},ss=class extends F.mixin(iS,ge,Gn){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}static get identifiable(){return{}}construct(...e){super.construct(...e);const r=this,{event:t}=r;Object.assign(r,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:t.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:pc,startEvent:t,touchStartTimer:null,_valid:!0}),"touches"in t&&r.touchStartDelay&&(r.touchStartTimer=r.setTimeout(()=>r.touchStartTimer=null,r.touchStartDelay,"touchStartDelay")),j.on({element:globalThis,blur:"onWindowBlur",thisObj:r})}doDestroy(){const e=this,{source:r,target:t}=e;e.cleanup(),(t==null?void 0:t.dropping)===e&&(t.dropping=null),(r==null?void 0:r.dragging)===e&&(r.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&this.abort()}get aborted(){return this.state===Vh}get completed(){return this.isDestroying||this.aborted||this.endEvent!==null}get pending(){return this.state===pc}get started(){return this.state!==pc&&!this.aborted}get valid(){return this.started&&this.targetElement!=null&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map(t=>this.get(t)));let r=this.data.get(e);return typeof r=="function"&&(r=await r(),this.data.set(e,r)),r}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map(t=>this.peek(t));let r=this.data.get(e);return typeof r=="function"&&(r=!0),r}set(e,r){this.data.set(e,r)}changeTarget(e,r){if(e!==r){const t=this;t._target=e,t.previousTarget=r,r&&(r.dropping=null),e&&(e.dropping=t,e.dropping!==t&&(e=null,t.valid=!1)),t._target=r}return e}updateTarget(e,r){const t=this;r&&t.source.dragLeaveTarget(t,r),e&&(t.valid=!0,e.dragMove(t),t.source.dragEnterTarget(t))}updateTargetElement(e){let r,t,i,n,s;for(s=e;s;s=s.parentElement)if(t=ze.get(s,"droppables"),t){for(n=0;n<t.length;++n)if(r=t[n],r.dropRootElement.contains(e)&&(i=r.droppableSelector,(!i||e.closest(`#${C.getId(r.dropRootElement)} ${i}`))&&(this.target=r,this.target===r)))return}}abort(){const e=this,{element:r,source:t}=e;r==null||r.getBoundingClientRect(),e.state!==Nh&&(e.state=Vh,e.cleanup()),t==null||t.endDrag(e)}begin(){const e=this,{source:r}=e,t=r.beforeDrag(e);return t!==!1&&(r.dragging=e),t}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const r=this,{lastMoveEvent:t,target:i}=r,{dragSwallowClickTime:n}=r.source;r.event=r.endEvent=e,r.syncFlags(),r.started&&(((t==null?void 0:t.clientX)!==e.clientX||(t==null?void 0:t.clientY)!==e.clientY||(t==null?void 0:t.target)!==e.target)&&r.track(),n&&j.on({element:document,capture:!0,expires:n,once:!0,click(s){s.stopPropagation()}}),r.state=Nh,i!==r.source&&(i==null||i.dragDrop(r)))}fakeKey(e,r){const t=this,{lastMoveEvent:i}=t;if(i&&t.element){let n;i.isKey=!0,e.key==="Alt"?t.altKey!==r&&(t.altKey=r,n=!0):e.key==="Control"&&t.ctrlKey!==r&&(t.ctrlKey=r,n=!0),n&&(t.event=i,t.track())}}keyDown(e){this.completed||(e.key==="Escape"?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return j.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return e==="Control"||e==="Alt"}move(e){const r=this,{target:t}=e,i=r.getDistance(e),n=i>=r.threshold;if(r.syncFlags(),r.touchStartTimer){n&&r.abort();return}if(t&&t.nodeType===Node.ELEMENT_NODE){if(n&&!r.started&&(r.event=e,r.start()===!1)){r.abort();return}r.started&&!r.completed&&(r.lastMoveEvent=r.event=e,e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation()),r.track())}}start(){const e=this,{scrollManager:r,monitoringConfig:t,source:i}=e,{draggingBodyCls:n,dragLock:s}=i,a=i.dragRootElement;if(e.state=nS,r){const l=r.startMonitoring(U.merge({scrollables:[{element:a}],direction:FM[s]||s||"both",callback(c){const{lastMoveEvent:d}=e;d&&e.element&&(d.isScroll=!0,e.event=d,e.scrollerAction=c,e.track(),e.scrollerAction=null)}},t));e.cleaners.push(l)}const o=i.dragRootElement.closest(".b-outer")||document.body;if(o.classList.add(n),e.cleaners.push(()=>o.classList.remove(n)),i.startDrag(e)===!1)return e.cleanup(),!1}syncFlags(){const e=this,{event:r}=e;e.altKey=r.altKey,e.ctrlKey=r.ctrlKey||r.metaKey,e.metaKey=r.metaKey,e.shiftKey=r.shiftKey}track(){const e=this,{event:r,source:t,target:i}=e;let n=r.target,s;r.type==="touchmove"&&(s=r.changedTouches[0],n=C.elementFromPoint(s.clientX,s.clientY)),e.targetElement=n,i===e.target&&(i==null||i.dragMove(e)),t.trackDrag(e)}};R(ss,"$name","DragContext"),ss.prototype.STATE=ss.STATE=Object.freeze({ABORTED:Vh,INIT:pc,DRAGGING:nS,DROPPED:Nh}),ss._$name="DragContext";var as=class extends F.mixin($i){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:as}}updateDragging(e,r){r&&this.close(r),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}};as.initClass(),as._$name="DragProxy";var zh=e=>class extends(e||F){static get $name(){return"Draggable"}static get configurable(){return{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}beforeDrag(t){const{dragRootElement:i,dragSelector:n,ignoreSelector:s}=this,a=n&&t.element.closest(n);return!n||!!(a&&a===i||i.contains(a)&&(!s||!t.element.matches(s)))}dragStart(t){}dragOver(t){}dragEnterTarget(t){}dragLeaveTarget(t,i){}dragDrop(t){}dragEnd(t){}get activeDrag(){const{dragging:t}=this;return t!=null&&t.started&&!t.completed?t:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:t,dragRootElement:i}=this;return t?i==null?void 0:i.closest(t):i}beginDrag(t){const{draggingCls:i,draggingClassElement:n}=this;i&&n&&(n.classList.add(i),t.cleaners.push(()=>n.classList.remove(i)))}async endDrag(t){const i=this,{dragEventer:n,dragProxy:s}=i;t.valid&&await i.dragDrop(t),!i.isDestroyed&&(t.pending?t.destroy():(i.dragEnd(t),s==null||s.dragEnd(t),n==null||n.trigger(t.valid?"drop":"dragCancel",{drag:t,event:t.event}),i.finalizeDrag(t)))}async finalizeDrag(t){var i;await((i=t.finalize)==null?void 0:i.call(t))}moveDrag(t){if(this.dragOver(t)!==!1){const{dragEventer:i,dragProxy:n}=this;n==null||n.dragMove(t),i==null||i.trigger("drag",{drag:t,event:t.event})}}setupDragContext(t){const i=this,{dragItemSelector:n,id:s}=i,{target:a}=t;return{event:t,id:s?`${s}-drag-${i._nextDragId=(i._nextDragId||0)+1}`:null,itemElement:n?a.closest(n):a,touchStartDelay:i.dragTouchStartDelay,source:i,threshold:i.dragThreshold}}startDrag(t){const{draggingStartedCls:i,draggingClassElement:n,draggingItemCls:s,dragEventer:a,dragProxy:o}=this,{itemElement:l}=t;if((a==null?void 0:a.trigger("beforeDragStart",{drag:t,event:t.event}))===!1)return!1;i&&n&&(n.classList.add(i),t.cleaners.push(()=>n.classList.remove(i))),s&&l&&(l.classList.add(s),t.cleaners.push(()=>l.classList.remove(s))),o==null||o.dragStart(t);const c=this.dragStart(t);return c!==!1&&(a==null||a.trigger("dragStart",{drag:t,event:t.event})),c}trackDrag(t){var i;const{dropTargetSelector:n}=this;t.valid=!(n&&!((i=t.targetElement)!=null&&i.closest(n))),this.moveDrag(t)}configureListeners(t){const i=this,n=T.assign({thisObj:i},i.dragDocumentListeners);return"touches"in t.startEvent?(delete n.mousemove,delete n.mouseup):(delete n.contextmenu,delete n.touchmove,delete n.touchend,delete n.pointerup),n}updateDragging(t,i){const n=this;if(t){const s=n.configureListeners(t);t.cleaners.push(j.on(s)),n.beginDrag(t)}else i&&i.destroy()}changeDragProxy(t,i){return as.reconfigure(i,t,{owner:this,defaults:{owner:this}})}updateDragRootElement(t,i){var n;const s=this,{draggableCls:a,dragItemSelector:o,onDragItemMouseMove:l}=s;if(i==null||i.classList.remove(a),(n=s._dragRootDetacher)==null||n.call(s),t){const c={thisObj:s,element:t,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:d=>{var u,h;return d.pointerId&&((h=(u=d.target).releasePointerCapture)==null?void 0:h.call(u,d.pointerId))}};l&&(c.mousemove={delegate:o,handler:"onDragItemMouseMove"}),(s.dragItemOverCls||l||s.onDragItemMouseEnter||s.onDragItemMouseLeave)&&Object.assign(c,{mouseover:{delegate:o,handler:"onDragItemMouseOver"},mouseout:{delegate:o,handler:"onDragItemMouseOut"}}),t.classList.add(a),s._dragRootDetacher=j.on(c)}}onDragItemMouseOver(t){this.overItem=t}onDragItemMouseOut(t){this.dragging||(this.overItem=t)}changeOverItem(t){var i;return this.enterLeaveEvent=t,t.type==="mouseout"?((i=t.relatedTarget)==null?void 0:i.closest(this.dragItemSelector))||null:t.target.closest(this.dragItemSelector)}updateOverItem(t,i){var n,s;const a=this,{dragItemOverCls:o}=a;i&&(o&&i.classList.remove(o),(n=a.onDragItemMouseLeave)==null||n.call(a,a.enterLeaveEvent,i)),t&&(o&&t.classList.add(o),(s=a.onDragItemMouseEnter)==null||s.call(a,a.enterLeaveEvent,t))}onDragContextMenu(t){t.preventDefault()}onDragKeyDown(t){this.dragging.keyDown(t)}onDragKeyUp(t){this.dragging.keyUp(t)}onDragMouseDown(t){t.button===0&&this.onDragPointerDown(t)}onDragPointerDown(t){let{dragging:i}=this;i?i.isFinalizing||i.abort():(i=this.setupDragContext(t),i&&(i=new ss(i),i.begin()===!1&&i.destroy()))}changeDragging(t,i){return i==null||i.destroy(),t}onDragPointerMove(t){const{dragging:i}=this;i&&!i.completed&&(i==null||i.move(t))}onDragPointerUp(t){const{dragging:i}=this;i&&!i.completed&&(i.end(t),this.endDrag(i))}onDragTouchStart(t){t.touches.length===1&&this.onDragPointerDown(t)}},sS=e=>class extends(e||F){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("dragEnter",{drag:t,event:t.event})}dragMove(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("dragMove",{drag:t,event:t.event})}dragDrop(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("drop",{drag:t,event:t.event})}dragLeave(t){var i;return(i=this.dropEventer)==null?void 0:i.trigger("dragLeave",{drag:t,event:t.event})}changeDropping(t,i){if(t!==i){const n=this;i&&(i.aborted||!i.completed)&&n.dragLeave(i),t&&(n._dropping=t,n.dragEnter(t)===!1&&(t=null),n._dropping=i)}return t}updateDropRootElement(t,i){const n=this,{droppableCls:s}=n;let a,o,l;i&&(a=ze.get(i,"droppables"),l=!0,Array.isArray(a)&&(o=a.indexOf(n))>-1&&(a.length<2?ze.remove(i,"droppables"):(a.splice(o,1),a.forEach(c=>{s===c.droppableCls&&(l=!1)}))),l&&i.classList.remove(s)),t&&(a=ze.get(t,"droppables"),a?a.push(n):ze.set(t,"droppables",[n]),t.classList.add(s))}},kM=e=>class extends(e||F){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(t){const i={ownerName:"client",...t.featureable};i.factory.initClass(),Reflect.defineProperty(t,"featureable",{get(){return i}})}doDestroy(){var t;const i=this.features;super.doDestroy();for(const n in i){const s=i[n];(t=s.destroy)==null||t.call(s)}}hasFeature(t){var i;return!!((i=this.features)!=null&&i[t])}changeFeatures(t,i){if(this.isDestroying)return;const n=this,{featureable:s}=n.constructor,a=n.$features||(n.$features=new Wi({configName:"features",factory:s.factory,owner:n,ownerName:s.ownerName}));if(a.update(t),!i)return a.target}get widgetClass(){}getCurrentConfig(t){const i=super.getCurrentConfig(t),{features:n}=i;if(n)for(const s in n)Object.keys(n[s]).length===0&&(n[s]=!0);return i}},Fe={e:"b-hover-edge",t:"b-hover-top",r:"b-hover-right",b:"b-hover-bottom",l:"b-hover-left"},OM={[Fe.e]:1,[Fe.t]:1,[Fe.r]:1,[Fe.b]:1,[Fe.l]:1},LM={t:[Fe.e,Fe.t],r:[Fe.e,Fe.r],b:[Fe.e,Fe.b],l:[Fe.e,Fe.l],tr:[Fe.e,Fe.t,Fe.r],bl:[Fe.e,Fe.b,Fe.l],tl:[Fe.e,Fe.t,Fe.l],br:[Fe.e,Fe.b,Fe.r]},$M=e=>class extends e.mixin(ge){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(t){}hoverIgnore(t){var i;return(i=this.hoverIgnoreElement)==null?void 0:i.contains(t)}hoverLeave(t){}hoverMove(t){}onHoverMouseMove(t){const i=this,{hoverEdges:n,hoverEdgeSize:s,hoverTarget:a}=i;if(a){if(n){const{top:o,left:l,width:c,height:d,right:u,bottom:h}=a.getBoundingClientRect(),{clientX:f,clientY:g}=t,m=l+c/2,p=o+d/2,v=g<(s?o+s:p),y=f>=(s?u-s:m),S=g>=(s?h-s:p),D=f<(s?l+s:m),w=v||S?v?"t":"b":"",E=y||D?y?"r":"l":"";i.hoverZone=(n.includes(w)?w:"")+(n.includes(E)?E:"")}i.hoverEvent=t,i.hoverTrack&&i.hoverMove(t)}}onHoverMouseOver(t){this.hoverEvent=t,this.hoverElement=t.target}onHoverMouseOut(t){this.hoverEvent=t,this.hoverElement=t.relatedTarget}updateHoverDelay(t){this.setHoverTarget.delay=t}changeHoverEdges(t){return t===!0?"trbl":(t||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(t){if(!this.hoverIgnore(t))return t}updateHoverElement(t){const{hoverSelector:i}=this;i&&(t=t==null?void 0:t.closest(i)),this.setHoverTarget(t)}updateHoverRootElement(t,i){const{hoverRootCls:n}=this;n&&(i==null||i.classList.remove(n),t==null||t.classList.add(n)),this.syncHoverListeners()}changeHoverTarget(t,i){return i&&(this.hoverZone=null),t}updateHoverTarget(t,i){const n=this,{hoverCls:s,hoverAnimationCls:a,hoverRootActiveCls:o,hoverRootElement:l}=n;o&&(l==null||l.classList[t?"add":"remove"](o)),i&&(s&&i.classList.remove(s),a&&i.classList.remove(a),n.hoverLeave(i)),t&&(s&&t.classList.add(s),n.hoverEnter(i),n.hoverTrack&&n.hoverMove(n.hoverEvent),a&&(t.getBoundingClientRect(),t.classList.add(a)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(t){const{hoverAnimationCls:i,hoverTarget:n}=this;if(n){const{className:s}=n,a=J.change(s,t?LM[t]:null,OM);s!==a&&(n.className=a,t&&i&&(n.classList.remove(i),n.getBoundingClientRect(),n.classList.add(i)))}}setHoverTarget(t){this.hoverTarget=t}syncHoverListeners(){var t;const i=this,n=i.hoverRootElement,s={element:n,thisObj:i,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(i.hoverTrack||i.hoverEdges)&&(s.mousemove="onHoverMouseMove"),(t=i._hoverRootDetacher)==null||t.call(i),i._hoverRootDetacher=n&&j.on(s)}},Wh=e=>class extends e{static get $name(){return"LoadMaskable"}static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"b-icon b-icon-warning",autoClose:500,showDelay:0}}}}applyLoadMask(){const t=this,{loadMask:i}=t;return i&&(t.masked=It.mergeConfigs(t.loadMaskDefaults,i)),t.masked}applyMaskError(t){const{loadMaskError:i,masked:n}=this;return i===!1?n.hide():n&&(T.assign(n.errorDefaults,i),n.error=t),n}get widgetClass(){}},jM={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1},aS=class{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const r=Object.getOwnPropertyNames(e),t=Object.getOwnPropertyNames(e.prototype);return r.splice(r.indexOf("target"),1),this.internalOverrideAll(e.target.class,r,e),this.internalOverrideAll(e.target.class.prototype,t,e.prototype),!0}static internalOverrideAll(e,r,t){Reflect.ownKeys(t).forEach(i=>{if(r.includes(i)&&!jM[i]){const n=Object.getOwnPropertyDescriptor(t,i);let s=e,a=null;for(;!a&&s;)a=Object.getOwnPropertyDescriptor(s,i),a||(s=Object.getPrototypeOf(s));a&&this.internalOverride(s,i,n,a)}})}static internalOverride(e,r,t,i){const n=e._overridden=e._overridden||{};n[r]=e[r],i.get?Object.defineProperty(e,r,{enumerable:!1,configurable:!0,get:t.get}):e[r]=t.value}static shouldApplyOverride(e){const r=e.target;if(!r.maxVersion&&!r.minVersion)return!0;if(!r.product)throw new Error("Override must specify product when using versioning");return!(r.maxVersion&&re[r.product].isNewerThan(r.maxVersion)||r.minVersion&&re[r.product].isOlderThan(r.minVersion))}};aS._$name="Override";var{defineProperty:oS}=Object,{hasOwn:BM}=T,Uh=Symbol("fencible"),HM=[],lS=e=>Array.from(new Set(e)),Gh=e=>e?lS(L.split(e)):HM,VM=(e,r,t)=>{t===!0&&(t=r),T.isObject(t)||(t={all:t});let i=Gh(t.any);const n=Gh(t.all),s=t.lock?Gh(t.lock):lS(n.concat(i)),a=r+"Impl",o=function(...l){const c=this,d=BM(c,Uh)?c[Uh]:c[Uh]={},u=h=>!d[h];if(n.every(u)&&(!i||i.some(u)))try{return s.forEach(h=>d[h]=(d[h]||0)+1),c[a](...l)}finally{s.forEach(h=>--d[h])}};i=i.length?i:null,!e[a]&&oS(e,a,{configurable:!0,value:e[r]}),oS(e,r,{configurable:!0,value:o})},cS=e=>{var r;return r=class extends(e||F){static setupFenced(t){let{fenced:i}=t;const n=i.static,s=[];n&&(i={...i},delete i.static,s.push([n,t])),s.push([i,t.prototype]);for(const[a,o]of s)for(const l in a)VM(o,l,a[l])}get widgetClass(){}},R(r,"$name","Fencible"),R(r,"declarable",["fenced"]),r},vc=60*1e3,Ki=60*vc,Hr=24*Ki,NM=/(\d+)?:?(\d*)/,at=class{static format(e){const r=Math.floor(e/Ki),t=Math.floor(e/vc)%60;return`${r}:${t<10?"0":""}${t}`}static parse(e){const r=typeof e;if(r==="string"){const t=NM.exec(e);e=Number(t[1]||0)*Ki+Number(t[2]||0)*vc}else r!=="number"?e=b.getTimeOfDay(e):e<=24&&(e*=Ki);return Math.min(Math.max(Math.floor(e),0),Hr)}constructor(e){let r=0,t,i;e!=null&&e.isDayView?(r=e.dayStartShift,t=e.dayStartTime,i=e.dayEndTime):typeof e=="number"?r=t=i=e:e&&(r=e.startShift,t=e.timeStart,i=e.timeEnd),this.startShift=r=at.parse(r||0),this.timeEnd=(i==null?(r+Hr)%Hr:at.parse(i))||Hr,this.timeStart=t==null?r:at.parse(t)}get startHour(){return Math.floor(this.timeStart/Ki)}get endHour(){return Math.floor(this.timeEnd/Ki)}get startTimeOffsetMs(){const{startShift:e,timeStart:r}=this;return r<e?Hr-e+r:r-e}get today(){return this.startOfDay(new Date)}ceil(e){const r=this.startOfDay(e);return r<e&&r.setDate(r.getDate()+1),r}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),b.makeKey(e)}dayOfDate(e){return this.shiftDate(b.clearTime(e))}dayOfWeek(e){return e=this.shiftDate(e,-1),e.getDay()}delta(e,r="ms"){const{timeStart:t}=this,i=at.parse(e),n=(this.startShift&&i<t?i+Hr:i)-t;return r==="ms"?n:b.as(r,n,"ms")}duration(e="ms"){const{timeStart:r,timeEnd:t}=this,i=r<t?t-r:Hr-r+t;return e==="ms"?i:b.as(e,i,"ms")}equals(e){return this.startShift===(e==null?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,r){const t=this,{timeStart:i,timeEnd:n}=t,[s,a]=t._dateRangeArgs(e,r),[o,l]=t.timeRange(s,a);return i<n?o<l?o<n&&i<=l:o<n||i<=l:!(o<l)||o<n||i<=l}isIntraDay(e,r){const t=this,[i,n]=t._dateRangeArgs(e,r),s=t.startOfDay(i),a=Hr-b.diff(s,n,"ms");return a<0?!1:a>0||s<i}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:r,timeStart:t,timeEnd:i}=this,n=at.parse(e);return t<i?n<t?n<r?1:-1:n<i?0:n<r?-1:1:n<i||n>=t?0:n<r?1:-1}parseKey(e){return this.dayOfDate(b.parseKey(e))}shiftDate(e,r=1){const{startShift:t}=this,i=typeof e;return e=i==="number"?new Date(e):i==="string"?b.parse(e):new Date(e.getTime()),r&&t&&e.setMilliseconds(r>0?t:-t),e}sortEvents(e,r){const t=this.startOfDay(e);return r==null?void 0:r.sort((i,n)=>{i=i.eventRecord||i,n=n.eventRecord||n;let{startDate:s}=i,{startDate:a}=n;return s?a?(s=s<t?t:s,a=a<t?t:a,s-a||n.endDate-a-(i.endDate-s)):1:-1})}startOfDay(e){return e=this.shiftDate(e,-1),e=b.clearTime(e),e=this.shiftDate(e),e}timeRange(e,r){const[t,i]=this._dateRangeArgs(e,r);return[b.getTimeOfDay(t),b.getTimeOfDay(i)]}toString(){const{startShift:e,timeEnd:r,timeStart:t}=this,i=e?`@${at.format(e)}`:"",n=at.format(t);return t===r?e?i:n:`${n}-${at.format(r)}${i}`}_dateRangeArgs(e,r){return e.isModel?[e.startDate,e.endingDate]:[e,r]}};at.MIDNIGHT=new at({startShift:0,timeStart:0,timeEnd:24}),at.MILLIS_PER_MINUTE=vc,at.MILLIS_PER_HOUR=Ki,at.MILLIS_PER_DAY=Hr,at._$name="DayTime";var dS=class extends Ae(F){static get configurable(){return{date:{$config:{equal:"date"},value:b.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e=typeof e=="string"?b.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,r){const t=this,{dayColumnIndex:i,weekCount:n}=t,s=b.getFirstDateOfMonth(e),a=b.getLastDateOfMonth(s),o=i[s.getDay()],l=i[a.getDay()],c=!r||e.getFullYear()!==r.getFullYear(),d=!r||e.getMonth()!==r.getMonth(),u=t.eventListeners&&(r?e.getDate()!==r.getDate()|(t.getWeekId(e)!==t.getWeekId(r))<<1|d<<2|c<<3:15);if(t._year=e.getFullYear(),t._month=e.getMonth(),t.startDayOfMonth=1-o,t.endDayOfMonth=a.getDate()+(6-l),t.sixWeeks&&(t.endDayOfMonth+=(6-t.weekCount)*7),(!t.weekBase||c)&&t.calculateWeekBase(),(d||c)&&t.generation++,u){const h={newDate:e,oldDate:r,changes:{d:!0,w:!!(u&2),m:!!(u&12),y:!!(u&8),r:t.weekCount!==n}};t.trigger("dateChange",h),u&2&&t.trigger("weekChange",h),u&12&&t.trigger("monthChange",h),u&8&&t.trigger("yearChange",h)}}calculateWeekBase(){const e=this,{dayColumnIndex:r}=e,t=new Date(e.year,0,1),i=new Date(e.year,11,31),n=e.month?e.getOtherMonth(t):e;e.dayColumnIndex[t.getDay()]>3?e.weekBase=n.startDate:e.weekBase=new Date(e.year,0,n.startDayOfMonth-7);const s=Math.floor(b.diff(e.weekBase,i,"day")/7);e.has53weeks=s===53&&r[i.getDay()]>2}getWeekStart(e){if(typeof e=="number")return b.add(this.weekBase,Math.max(e,1)*7,"day");const r=this,[t,i]=e;return t===r.year?r.getWeekStart(i):r.getOtherMonth(new Date(t,0,1)).getWeekStart(i)}getOtherMonth(e){const r=this,t=r===uS?new dS(null):uS;return t.configure({weekBase:null,weekStartDay:r.weekStartDay,nonWorkingDays:r.nonWorkingDays,hideNonWorkingDays:r.hideNonWorkingDays,sixWeeks:r.sixWeeks,date:new Date(e.getFullYear(),0,1)}),t.date=e,t.updateDate(t.date,t.date),t}changeYear(e){const r=new Date(this.date);r.setFullYear(e),this.date=r}changeMonth(e){const r=new Date(this.date);r.setMonth(e),this.date=r}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||b.nonWorkingDays}changeNonWorkingDays(e){return T.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let r=this.startDayOfMonth;r<=this.endDayOfMonth;r++)e(new Date(this.year,this.month,r))}eachWeek(e){const r=this,{weekCount:t}=r;for(let i=r.startDayOfMonth,n=0;n<t;n++){const s=[],a=r.getWeekNumber(new Date(r.year,r.month,i));for(let o=0;o<7;o++,i++)s.push(new Date(r.year,r.month,i));e(a,s)}}getWeekNumber(e){const r=this;if(e=b.clearTime(e),e.getFullYear()!==r.year)return r.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let t=Math.floor(b.diff(r.weekBase,e,"day")/7),i=e.getFullYear();if(t)t===53&&!r.has53weeks?(t=1,i++):t>53&&(t=t%52);else return r.getOtherMonth(new Date(r.year-1,0,1)).getWeekNumber(new Date(r.year,0,0));return[i,t]}getWeekId(e){const r=this.getWeekNumber(e);return r[0]*100+r[1]}getCellData(e,r,t=at.MIDNIGHT){const i=this,n=e.getDay(),s=i.visibleDayColumnIndex[n],a=i.nonWorkingDays[n],o=i.hideNonWorkingDays&&a;return(e<i.startDate||e>i.endDate)&&(i.month=e.getMonth()),{day:n,dayTime:t,visibleColumnIndex:s,isNonWorking:a,week:i.getOtherMonth(e).getWeekNumber(e),key:b.format(e,"YYYY-MM-DD"),columnIndex:i.dayColumnIndex[n],date:new Date(e),dayEnd:t.duration("s"),tomorrow:t.dayOfDate(b.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+e.getFullYear()*12-(r.month+r.year*12)),visible:!o&&e>=r.startDate&&e<b.add(r.endDate,1,"day"),isRowStart:s===0,isRowEnd:s===i.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:r,nonWorkingDays:t,hideNonWorkingDays:i}=e,n=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],a=e.visibleDayColumnIndex=[];let o=0;for(let l=0;l<7;l++){const c=(r+l)%7;s[l]=c,n[c]=l,(!i||!t[c])&&(a[c]=o++)}e.visibleColumnCount=o,e.weekLength=i?7-T.keys(t).length:7}},os=dS;R(os,"$name","Month");var uS=new os(null);os._$name="Month";var zM=0,hS=new WeakMap,WM=(...e)=>e.map(r=>{let t;return r&&typeof r=="object"||typeof r=="function"?(t=hS.get(r),t===void 0&&(t=++zM,hS.set(r,t))):t=String(r),t}).join("-"),li=e=>{const r=new Map;return(...t)=>{const i=WM(t);let n=r.get(i);return n===void 0&&(n=e(...t),r.set(i,n)),n}},Ja=e=>{const r=new Map,t=d=>d[0],i=d=>d[1],n=(d,u)=>t(d).push(u),s=(d,u)=>i(d).push(u),a=(d,u)=>i(d).some(h=>T.isEqual(h,u)),o=()=>[[],[]],l=d=>!i(d).length&&!t(d).length,c=d=>{let u=r.get(d);return u===void 0&&(u=o(),r.set(d,u)),u};return(d,u)=>{const h=c(d);l(h)?(n(h,u),e(d,f=>{a(h,f)||(s(h,f),t(h).forEach(g=>g(f)))})):(n(h,u),i(h).forEach(f=>u(f)))}},fS=Symbol("success"),UM=Symbol("failure"),yc=(e,r)=>[fS,e,r],Yh=e=>[UM,e],qh=e=>e.length&&e[0]===fS,Qa=e=>typeof e=="function"&&!e.length?e():e,bc=li(e=>Ja((r,t)=>t(yc(e,r)))),GM=li(e=>Ja((r,t)=>{const i=Math.min(e.length,r.length),n=r.substr(0,i),s=r.substr(i);t(n===e?yc(n,s):Yh(s))})),Cc=(e,r)=>(t,i)=>Qa(e)(t,n=>{if(qh(n)){const[,s,a]=n;r(s)(a,i)}else i(n)}),YM=li((...e)=>{const r=li((t,i)=>Ja(Cc(t,n=>Cc(i,s=>bc([].concat(n,s))))));return e.reduce(r,bc([]))}),qM=li((...e)=>Ja((r,t)=>e.forEach(i=>Qa(i)(r,t)))),KM=li(e=>(r,t)=>{const i=new RegExp(`^${e}`),n=i.exec(r);if(n){const s=n[0],a=r.substr(s.length);t(yc(s,a))}else t(Yh(r))}),XM=li((e,r)=>Cc(e,(...t)=>bc(r(...[].concat.apply([],t))))),gS=(e,r)=>{const t=[];return e(r,i=>{if(qh(i)){const[,,n]=i;n===""&&t.push(i)}}),t},ZM=e=>(r,t)=>t?Qa(e)(r,t):gS(Qa(e),r),JM={memo:li,memoCps:Ja,success:yc,failure:Yh,isSuccess:qh,resolveParser:Qa,succeed:bc,string:GM,bind:Cc,seq:YM,alt:qM,regexp:KM,red:XM,runParser:gS,defineParser:ZM},Sc=class extends ge(F){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(e,r){return r==null||r.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return Object.keys(this.activeScroll).length!==0}get rtl(){var e;return(e=this.owner)==null?void 0:e.rtl}startMonitoring(e={}){const r=this,{element:t,direction:i}=r,{scrollables:n=[],direction:s=i,callback:a}=e,o=[];return n.length||n.push({element:t}),n.forEach(l=>{const c=l.element;typeof c=="string"?C.forEachSelector(t,c,d=>{r.createMonitor(d,l.direction||s,l.callback||a),o.push(d)}):(r.createMonitor(c,l.direction||s,l.callback||a),o.push(c))}),function(){var c;(c=r.stopMonitoring)==null||c.call(r,o)}}createMonitor(e,r,t){const{monitoring:i}=this;i.has(e)||i.set(e,new QM({scrollManager:this,element:e,direction:r,callback:t}))}stopMonitoring(e){const r=this,{monitoring:t}=r;if(e=H.asArray(e),t){if(!e){t.forEach(i=>r.stopMonitoring(i.element));return}e.forEach(i=>{const n=t.get(i);i.classList.remove("b-scrolling"),n&&(n.destroy(),t.delete(i))})}}requestScroll(e,r){const{activeScroll:t}=this;return e in t&&t[e]!==r?!1:(t[e]=r,!0)}releaseScroll(e){const{activeScroll:r={}}=this;Object.keys(r).forEach(t=>{r[t]===e&&delete r[t]})}getRelativeScroll(e,r="left"){let t=0;return this.monitoring.forEach((i,n)=>{C.isDescendant(n,e)&&(t+=r==="left"?i.scrollRelativeLeft:i.scrollRelativeTop)}),t}},QM=class extends F{construct(e){const r=this,{element:t}=e,i=t.scrollLeft,n=t.scrollTop;Object.assign(e,{startScrollLeft:i,startScrollTop:n}),super.construct(e),j.on({element:t,scroll:"onElementScroll",pointermove:"onMouseMove",capture:!0,thisObj:r}),j.on({element:t,pointerleave:"onPointerLeave",thisObj:r})}doDestroy(){this.stopScroll(),super.doDestroy()}startScroll(){this.scrolling=!0,this.performScroll()}stopScroll(){const e=this;e.scrolling=!1,e.scrollRequested&&(e.scrollManager.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),e.scrollManager.clearTimeout(e.scrollTimeout),e.scrollManager.releaseScroll(e),e.scrollTimeout=null}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const r=this,{scrollManager:t}=r,i=r.element.getBoundingClientRect(),n=t.zoneWidth,s=t.scrollSpeed;if(r.scrollDeltaX=r.scrollDeltaY=0,r.direction!=="vertical"){const{scrollLeft:a,scrollWidth:o,clientWidth:l}=r.element;t.rtl?e.clientX<i.left+n&&o+a-l>=1?r.scrollDeltaX=-Math.round((n+(i.left-e.clientX))/s)-1:e.clientX>i.right-n&&a<0&&(r.scrollDeltaX=Math.round((n-(i.right-e.clientX))/s)+1):e.clientX>i.right-n&&o-a-l>=1?r.scrollDeltaX=Math.round((n-(i.right-e.clientX))/s)+1:e.clientX<i.left+n&&a>0&&(r.scrollDeltaX=-Math.round((n+(i.left-e.clientX))/s)-1)}if(r.direction!=="horizontal"){const{scrollTop:a,scrollHeight:o,clientHeight:l}=r.element;e.clientY>i.bottom-n&&o-a-l>=1?r.scrollDeltaY=Math.round((n-(i.bottom-e.clientY))/s)+1:e.clientY<i.top+n&&a>0&&(r.scrollDeltaY=-Math.round((n+(i.top-e.clientY))/s)-1)}r.scrollDeltaX!==0&&!t.requestScroll("horizontal",r)&&(r.scrollDeltaX=0),r.scrollDeltaY!==0&&!t.requestScroll("vertical",r)&&(r.scrollDeltaY=0),r.scrollDeltaX===0&&r.scrollDeltaY===0?r.scrolling&&r.stopScroll():r.scrollTimeout||(r.scrollTimeout=t.setTimeout(()=>r.startScroll(),t.startScrollDelay))}performScroll(){const e=this,{element:r}=e;if(e.scrolling&&!e.scrollRequested){if(e.scrollDeltaX!==0){const t=r.scrollLeft,i=Math.min(t+e.scrollDeltaX,r.scrollWidth-r.clientWidth);i!==t&&(r.scrollLeft=i)}if(e.scrollDeltaY!==0){const t=r.scrollTop,i=Math.min(t+e.scrollDeltaY,r.scrollHeight-r.clientHeight);i!==t&&(r.scrollTop=i)}e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame(()=>{e.scrollRequested=!1,e.performScroll(e)})}}onElementScroll(){var e,r;(r=(e=this.config)==null?void 0:e.callback)==null||r.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}};Sc._$name="ScrollManager";var eP={left:!0,right:!0,top:!0,bottom:!0,transform:!0},tP={true:1,false:1},rP=Promise.resolve(),ue=class extends st{static get $name(){return"Tooltip"}static get type(){return"tooltip"}static get configurable(){return{mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:null,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConfigure(){const e=this,{forSelector:r}=e;r&&(e.showOnHover=!0,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=j.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;(e=this.pointerOverOutDetacher)==null||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&C.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){const r=this,{triggeredByEvent:t}=r;t&&C.isTouchEvent&&e.pageX===t.pageX&&e.pageY===t.pageY&&r.activeTarget.contains(e.target)&&performance.now()-t.timeStamp<500||(r.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const r=this,{target:t,relatedTarget:i}=e,{forElement:n,forSelector:s,activeTarget:a}=r;let o;if(!(r.disabled||r.owner&&!r.owner.showTooltipWhenDisabled&&r.owner.disabled)&&!(r.allowOver&&r.element.contains(t))){if(s){if(o=r.filterTarget(t),a!=null&&a.contains(t)&&a.contains(i)&&o===a||o&&(i==null?void 0:i.closest(s))===o)return}else if(!n.contains(i))o=n;else return;o?r.handleForElementOver(e,o):a&&r.handleForElementOut()}}filterTarget(e){return e.closest(this.forSelector)}onTransitionEnd(e){var r;const t=this,{currentOverElement:i}=ue;if(eP[e.propertyName]){if(t.allowOver&&t.element.contains(i))return;(r=t.activeTarget)!=null&&r.contains(i)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,r){const t=this,{activeTarget:i,hideOnDelegateChange:n,anchorToTarget:s}=t,a=r!==i,o=a&&n;if(t.trigger("pointerOver",{event:e,target:r})===!1)t.internalOnPointerOut(e);else{if(t.triggeredByEvent=e,t.hasTimeout("hide")&&(t.abortDelayedHide(),!a))return;if(!n&&t.element.classList.contains("b-hiding")&&t.cancelHideShowAnimation(),!t._hidden&&o&&t.hide(!1),t.activeTarget=r,t.isVisible){const l=t.updateContent();if(U.isPromise(l)&&!t.loadingMsg&&await l,t.trigger("beforeShow")===!1)return t.hide();t.alignTo({[s?"target":"position"]:s?r:"mouse",overlap:!(s&&t.anchor)}),t.trigger("show"),t.afterShowByTarget()}else t.delayShow(r)}}async delayShow(e){var r;const t=this;if((r=t.currentAnimation)!=null&&r.showing&&t.cancelHideShowAnimation(),!t.isVisible&&!t.hasTimeout("show"))if(!t.hoverDelay||t.forSelector&&Date.now()-t.lastHidden<t.quickShowInterval){const i=t.updateContent();U.isPromise(i)&&!t.loadingMsg&&await i,t.showByTarget(e)}else t.addDocumentMouseDownListener(),!t.listeningForMouseMove&&!t.anchorToTarget&&(t.mouseMoveRemover=j.on({element:t.rootElement,mousemove:"onMouseMove",thisObj:t})),t.setTimeout(async()=>{if(e.isConnected){const i=t.updateContent();U.isPromise(i)&&!t.loadingMsg&&await i,t.showByTarget(e)}},!t.triggeredByEvent||t.triggeredByEvent.type==="pointerover"?t.hoverDelay:0,"show");else t.isVisible&&t.showByTarget(e)}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){var r;const t=this,{element:i}=t;i.classList.toggle("b-allow-over",!!e),e?t.allowOverlisteners=j.on({element:i,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:t}):(r=t.allowOverlisteners)==null||r.call(t)}updateContent(){const e=this;if(e.getHtml){const r=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=r,r}}get hasContent(){return!!(C.isReactElement(this._html)||this._html!==""&&typeof this.html=="string"&&this.html.length||this.items.length)}internalBeforeShow(){return(this.updateContentOnMouseMove||this.hasContent)&&!this.disabled}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`
                <div class="b-tooltip-loading">
                    <i class="b-icon b-icon-spinner"></i>
                    ${e}
                </div>
            `)}showByTarget(e){var r;const t=this,{anchorToTarget:i}=t;t.mouseMoveRemover=(r=t.mouseMoveRemover)==null?void 0:r.call(t),t.showBy({[i?"target":"position"]:i?e:"mouse",overlap:!(i&&t.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:r}=e;e.abortDelayedShow(),r&&e.setTimeout("hide",r),e.toFront(),!e.mouseMoveRemover&&(e.trackMouse||e.updateContentOnMouseMove)&&(e.mouseMoveRemover=j.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.inAfterShow=!0,e.allowOver=e.allowOver||e.configuredAllowOver!=!1&&e.childItems.some(t=>t.isVisible&&!t.disabled&&t.focusElement),e.inAfterShow=!1}updateActiveTarget(e,r){e&&!this.isConfiguring&&this.trigger("overTarget",{newTarget:e,lastTarget:r})}internalOnPointerOut(e){var r;const t=this,i=e.relatedTarget;t.allowOver&&t.element.contains(i)||t.element.contains(e.target)&&((r=t.activeTarget)!=null&&r.contains(i))||t.activeTarget&&!t.activeTarget.contains(i)&&t.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:r}=e;if(e.trigger("pointerOut")===!1){e.activeTarget=null;return}e.abortDelayedShow(),e.isVisible&&r!==!1&&(e.abortDelayedHide(),r>0?e.setTimeout("hide",r):e.hide())}show(e){const r=this;!e&&r.forElement&&r.anchorToTarget&&!r.forSelector?r.showByTarget(r.forElement):super.show(...arguments),r.isVisible&&(r.afterShowByTarget(),r.forElement&&!r.transitionEndDetacher&&!r._hidden&&(r.transitionEndDetacher=j.on({element:r.forElement,transitionend:"onTransitionEnd",thisObj:r})))}hide(){var e,r;const t=this;if(t.abortDelayedShow(),t._hidden)return rP;{t.abortDelayedHide();const i=super.hide(...arguments);return t.lastHidden=Date.now(),t.activeTarget=null,(e=t.mouseMoveRemover)==null||e.call(t),t.mouseMoveRemover=null,(r=t.transitionEndDetacher)==null||r.call(t),t.transitionEndDetacher=null,i}}abortDelayedShow(){var e,r,t;const i=this;i.hasTimeout("show")&&((e=i.mouseDownRemover)==null||e.call(i),i.mouseDownRemover=null,i.clearTimeout("show"),(r=i.mouseMoveRemover)==null||r.call(i),i.mouseMoveRemover=null,(t=i.transitionEndDetacher)==null||t.call(i),i.transitionEndDetacher=null)}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,r=e.lastAlignSpec;!e.isConfiguring&&!e.isVisible&&(r!=null&&r.targetOutOfView)&&(r.allowTargetOut||C.isInView(r.target,!1,e))&&(e.show(),r.targetOutOfView=!1),super.realign()}alignTo(e){const r=this,{mouseOffsetX:t,mouseOffsetY:i}=r;if(!r.isVisible)return;let n;!r.anchorToTarget&&e.position==="mouse"&&(n=new ir(r.triggeredByEvent.pageX-globalThis.scrollX,r.triggeredByEvent.pageY-globalThis.scrollY),e.position=new ir(n.x+r.mouseOffsetX*(r.rtl?-1:1),n.y+r.mouseOffsetY)),e&&!(r.triggeredByEvent&&r.element.contains(r.triggeredByEvent.target))&&e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e),n&&r.lastAlignSpec.result.inflate(5).contains(n)&&(r.lastAlignSpec.position="mouse",r.mouseOffsetY=-i-r.height,r.mouseOffsetX=-t-r.width,r.realign(),r.mouseOffsetY=i,r.mouseOffsetX=t)}changeHtml(e){const r=this;if(U.isPromise(e)){r.showAsyncMessage(),e.target=r.activeTarget,e.then(t=>{e.target===r.activeTarget&&(r.html=t)});return}return typeof e!="object"&&(e=e!=null?r.optionalL(String(e)):""),e}updateHtml(e,r){const t=this;let i=e==="";i||(super.updateHtml(e,r),t.hasContent?(t.isVisible&&t.realign(),U.isPromise(e)||t.trigger("innerHtmlUpdate",{value:e})):i=!0),i&&t.hide()}onMouseMove(e){const r=this,{forElement:t,activeTarget:i}=r,n=r.hasTimeout("hide"),s=e.target;if(r.triggeredByEvent=e,!r._hidden){let a;const o=i==null?void 0:i.contains(s),l=!o&&r.forSelector&&i&&!n&&s.nodeType===Node.ELEMENT_NODE&&!s.matches(r.forSelector)&&!(r.allowOver&&r.element.contains(s)),c=t!=null&&t.document?t.document.documentElement:t,d=c&&(c.contains?c.contains(s):c.compareDocumentPosition(s)&16);if(l&&(a=r.handleForElementOut()),a||!n||d){if(r.dismissDelay&&!n&&r.setTimeout("hide",r.dismissDelay),r.updateContentOnMouseMove&&r.getHtml&&(r.html=r.callback(r.getHtml,r,[{tip:r,element:r.element,forElement:i,event:e}]),!r.html)){r.hide();return}r.trackMouse&&r.alignTo({position:"mouse",ignorePageScroll:!0})}}}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,r){var t,i,n;let s=(i=(t=e.bryntum)==null?void 0:t.tooltip)==null?void 0:i.get(ue);if(!s&&!r){(n=e.bryntum)!=null&&n.tooltip||T.setPath(e,"bryntum.tooltip",new Map);const a=e.bryntum.tooltip;a.set(ue,!0),s=new ue({forElement:e,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isShared:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver({source:o,target:l}){for(const u in o.resetCfg)u==="listeners"?o.un(o.resetCfg[u].set):u!=="html"&&(o[u]=o.resetCfg[u].was);o.resetCfg={};const c=$.getById(l.id),d=(c==null?void 0:c.tipConfig)||o.gatherDataConfigs(l.dataset);if(c&&c.element!==l||!c&&l.matches(".b-widget")||c!=null&&c.disabled&&!c.showTooltipWhenDisabled)return!1;o.owner=c;for(const u in d)o.resetCfg[u]={set:d[u],was:o[u]},u==="listeners"?o.ion(d[u]):o[u]=d[u]},hide({source:o}){o.owner=null}},gatherDataConfigs(o){const l=this,c={};for(const d in o)if(d.startsWith("btip"))if(d.length>4){const u=L.uncapitalize(d.substr(4));if(u in l.getDefaultConfiguration()){const h=o[d];c[u]=tP[h]?h==="true":isNaN(h)?h:parseInt(h,10)}}else c.html=o[d];return c},filterTarget(o){const l=o.closest(this.forSelector);if(l)return l;if(ue.showOverflow)for(;(o==null?void 0:o.nodeType)===Element.ELEMENT_NODE;){if(C.getStyleValue(o,"text-overflow")==="ellipsis"&&o.clientWidth<o.scrollWidth)return this.html=L.encodeHtml(o.textContent),o;o=o.parentNode}}}),j.on({element:e,mouseenter:o=>ue.currentOverElement=o.target,keydown:o=>ue.currentOverElement=o.target,capture:!0,thisObj:s}),a.set(ue,s)}return s}static encodeConfig(e){const r={};if(typeof e=="string")r.btip=e;else for(const t in e)r[`btip${t==="html"?"":L.capitalize(t)}`]=e[t];return r}};ue.initClass(),Object.defineProperty($,"tooltip",{get(){return ue.getSharedTooltip(document.body)}}),$.Tooltip=ue,ue._$name="Tooltip";var Kh=class extends as{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;(e=this.tooltip)==null||e.hide()}dragMove(e){const{offset:r,tooltip:t}=this,{event:i}=e;t&&(t.isVisible||t.show(),t.alignTo({align:this.align,target:new k(i.clientX-r,i.clientY-r,r*2,r*2)}))}changeTooltip(e,r){return $.reconfigure(r,e,this)}};Kh.initClass(),Kh._$name="DragTipProxy";var Xh=e=>class extends(e||F){static get $name(){return"Labelable"}static get configurable(){return{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}}get hasLabel(){return!!this.label}compose(){const{hasLabel:t,labelPosition:i}=this;return{class:{[`b-label-${i}`]:t,"b-has-label":t}}}changeLabel(t){return t||""}setupLabel(t){return T.assign({tag:"label",for:`${this.id}-input`,class:`b-label b-align-${t.align||"start"}`},t)}updateLabelWidth(t){this.labelElement&&(this.labelElement.style.flex=`0 0 ${C.setLength(t)}`,this.inputWrap.style.flexBasis=t==null?"":"auto")}get widgetClass(){}},Zh=class extends yt{static get $name(){return"FieldContainer"}static get type(){return"fieldcontainer"}static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){var e;return(e=this.owner.inline)!=null?e:this.ensureItems().count===1}changeCollapsed(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(!!e)}updateCollapsed(e){var r;this.collapser=(r=this.collapser)==null?void 0:r.destroy(),this.setCollapsedCls(e)}updateCollapser(e,r){r&&r.completed==null&&(!r.reverting||!e)&&r.destroy(),this.setOwnerCls("b-collapsing",e)}get collapsing(){const{collapser:e}=this;return e!=null&&e.collapsed}get collapsingExpanding(){return this.collapser!=null}get expanding(){const{collapser:e}=this;return e!=null&&!e.collapsed}collapse(e){this.toggleCollapse(!0,e)}expand(e){this.toggleCollapse(!1,e)}setCollapsedCls(e){this.setOwnerCls("b-collapsed",e)}setOwnerCls(e,r){var t,i;(i=(t=this.owner)==null?void 0:t.element)==null||i.classList[r?"add":"remove"](e)}syncChildConfigs(){const e=this,{owner:r,syncableConfigs:t}=e;if(t){let i,n;for(i in t)n=t[i](r),e.eachWidget(s=>{s[i]=n},!1)}r.afterSyncChildConfigs(e)}syncContainer(){const{inline:e,layout:r}=this;this.autoLayout&&(r.horizontal=e,r.justify=e?"center":"stretch")}toggleCollapse(e,r){const t=this,{animation:i,collapser:n,inline:s}=t,{containerWrapElement:a}=t.owner,o=l=>{l&&(t.element.style.height="",t.togglingCollapse=!0,t.collapsed=e,t.collapser=null)};if(e==null&&(e=!t.collapsed),r!==!1&&r!==null&&(!a||!t.isVisible?r=null:(r===!0?r={}:typeof r=="number"&&(r={duration:r}),r=i||r?T.merge({},i,r):null)),!r)t.togglingCollapse=!0,t.collapsed=e;else if(n&&e!==n.collapsed)t.collapser=n.revert({finalize:o}),t.collapser.collapsed=e;else if(!n&&e!==t.collapsed){!e&&t.setCollapsedCls(!1);const{element:l}=t,{height:c}=l.getBoundingClientRect(),d=s?1:c;!e&&t.setCollapsedCls(!0),l.style.height=`${c}px`,t.collapser=_e.run(T.merge({finalize:o,element:a,[s?"opacity":"height"]:{from:e?d:0,to:e?0:d}},r)),t.collapser.collapsed=e}}};Zh.initClass(),Zh._$name="FieldContainer";var iP=(e,r)=>(e.weight||0)-(r.weight||0),nP=(e,r)=>(r.weight||0)-(e.weight||0),Jh=[],sP={align:!0,weight:!0},$e=class extends $.mixin($h,Xh){static get $name(){return"Field"}static get type(){return"field"}static get configurable(){return{defaultBindProperty:"value",placeholder:null,value:"",name:null,labels:null,required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:e=>e.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,r,t;const i=this,{triggers:n}=i,s=i.isPainted&&$e.getSharedErrorTooltip(i.rootElement,!0);if((e=i.inputListenerRemover)==null||e.call(i),(r=i.keyListenerRemover)==null||r.call(i),(t=i.container)==null||t.destroy(),super.doDestroy(),n)for(const a of Object.values(n))a.destroy();(s==null?void 0:s.field)===i&&s.hide()}get childItems(){const{container:e,triggers:r}=this,t=r?Object.values(r):[];return e?[...t,...e.childItems]:t}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement)}static getSharedErrorTooltip(e,r){var t;let i=(t=e.bryntum)==null?void 0:t.errorTooltip;return!i&&!r&&(e.bryntum=e.bryntum||{},i=new ue({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow(){const n=this,s=$.fromElement(n.activeTarget);if(s){const a=s.getErrors();if(a)return n.html=a.join("<br>"),n.field=s,!0}return!1}}),e.bryntum.errorTooltip=i),i}static get errorTip(){return this.getSharedErrorTooltip(document.body)}construct(e){super.construct(e);const r=this;r.keyStrokeChangeDelay&&(r.changeOnKeyStroke=r.buffer(r.internalOnChange,r.keyStrokeChangeDelay))}changeKeyMap(e){var r;const t=this;let i={};e&&(t._fieldKeyMap?T.assign(i,t._fieldKeyMap):(t._fieldKeyMap=e,T.assign(i,e)));for(const n in t.triggers)(r=t.triggers[n])!=null&&r.keyMap&&(i=t.mergeKeyMaps(i,t.triggers[n].keyMap,n));return i}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const r=this;r.valueOnFocus=T.clone(r.value),r.validOnFocus=!(r.errors&&Object.keys(r.errors).length),super.onFocusIn(e),r.focusing=!0,r.syncInvalid(),r.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return $e}compose(){this.getConfig("clearable");const e=this,{container:r,innerElements:t,label:i,labels:n,labelCls:s,readOnly:a,triggers:o}=e,l=T.values(o,(f,g)=>!g),c=l.filter(f=>f.align==="start").sort(iP),d=l.filter(f=>f.align!=="start").sort(nP),u=e.setupLabel.bind(e),h=[...c.map(f=>f.element),...t,...d.map(f=>f.element)];return{class:{"b-has-start-trigger":c.length,"b-no-input":!t.length,"b-readonly":a,"b-field-container":!!r,"b-field-container-inline":r==null?void 0:r.inline},children:[...(n||Jh).filter(f=>f&&f.align!=="end").map(u),(i||null)&&u({reference:"labelElement",class:`b-label b-align-start ${s||""}`,html:i}),h.length?{class:"b-field-inner",reference:"inputWrap",children:h}:null,...(n||Jh).filter(f=>(f==null?void 0:f.align)==="end").map(u),...r?[{reference:"containerWrapElement",children:[r.element],class:{"b-field-container-wrap":1}}]:Jh]}}updateElement(e,r){var t;const i=this,n=i.initialConfig.value,{input:s}=i;super.updateElement(e,r),n!=null&&(i.value=n),i.syncEmpty(),i.updateInputReadOnly(i.inputReadOnly),i.syncInvalid();const a=s||i.focusElement;(t=i.keyListenerRemover)==null||t.call(i),i.keyListenerRemover=a&&j.on({element:a,thisObj:i,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:r,id:t,inputCls:i,inputType:n,name:s}=this,a=T.assign({reference:"input",tag:"input",type:n,name:s||t,id:`${t}-input`,retainElement:!0},r);i&&(a.class=i);for(let o,l,c=e.length;c-- >0;)o=e[c],l=this[o],l!=null&&(a[o]=l);return a}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){var e;const r=this.input;let t;try{t=[r.selectionStart,r.selectionEnd,r.selectionDirection]}catch(i){t=((e=r.value)==null?void 0:e.length)||0,t=[t,t]}return t}set textSelection(e){typeof e=="number"?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,r]=this.textSelection;return e&&r-e>0}getAfterValue(e){const[r,t]=this.textSelection,i=this.input.value;return`${i.substr(0,r)}${e}${i.substr(t||r)}`}select(e,r){const t=this.focusElement;if(t.value.length){if(arguments.length===0){this.selectAll();return}if(!this.supportsTextSelection)return;t.setSelectionRange(e,r)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const r=e.createTextRange();r.collapse(!1),r.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){var e;const{isEmptyInput:r,isEmpty:t,element:i}=this,n=(e=this.triggers)==null?void 0:e.clear,s=r&&t;i&&(n&&n[s?"hide":"show"](),i.classList.toggle("b-empty",s))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:r,hint:t,hintHtml:i}=e,n=r==null?void 0:r.parentElement;if(r){let s=i||t;const a=e.hintElement||s&&(e.hintElement=C.createElement({parent:n,className:"b-field-hint",nextSibling:r.nextSibling,children:[{className:"b-field-hint-content"}]}));a&&(typeof s=="function"&&(s=s({source:e,value:e.value})),a.firstChild[i?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){const e=this,{isPainted:r}=e;if(e.updatingInvalid=!0,r){const{isValid:t,element:i,inputWrap:n}=e;if(i.classList[t?"remove":"add"]("b-invalid"),t){const s=e.constructor.getSharedErrorTooltip(e.rootElement,!0);s!=null&&s.isVisible&&s.field===e&&s.hide()}else{const s=e.errorTip;s&&(e.containsFocus||e.isVisible&&n.contains(ue.currentOverElement))&&(s.activeTarget===n&&s.isVisible?s.onBeforeShow():(s.activeTarget=n,s.showBy(n)))}}e.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||this.editable===!1}updateInputReadOnly(e){const r=this,{input:t,inputListenerRemover:i}=r;t&&(t.readOnly=e?"readOnly":null,e?r.inputListenerRemover=i==null?void 0:i():i||(r.inputListenerRemover=j.on({element:t,thisObj:r,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return!!e}updateReadOnly(e){this.syncInputReadOnly()}updateClearable(e){const r=this;r.getConfig("triggers"),r.triggers={clear:e&&T.assign({cls:"b-icon-remove",weight:1e3,key:"Shift+backspace",handler(){r._isUserAction=!0,r.clear(...arguments),r._isUserAction=!1}},e)||null}}changeTriggers(e,r){const t=this,i=t.$triggers||(t.$triggers=new Wi({configName:"triggers",factory:$e.Trigger,inferType:!1,owner:t,created(n){Te.after(n,"onConfigChange",(s,{name:a})=>{sP[a]&&t.onConfigChange({name:"triggers",value:i.target})})},setup(n,s){n.reference=n.ref=s,n.parent=t}}));if(t.stepTriggers===!1&&(e.back||e.forward)&&(e=T.assign({},e),delete e.back,delete e.forward),i.update(e),t.element&&(t.keyMap=t.keyMap),!r)return i.target}updateInputWidth(e){this.input.style.width=C.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const r=e.validity;if(r)return r.valid}return!0}get isEmpty(){return this.value==null||this.value===""}get isEmptyInput(){return!this.input||this.input.value==null||this.input.value===""}get validity(){const e=this.input;return e==null?void 0:e.validity}async setValue(e){this.value=e}changeValue(e,r){return e==null&&(e=this.nullValue),this.hasChanged(r,e)?e:(e===""&&this.syncRequired(),r)}updateValue(e,r){const t=this;t.isConfiguring||(t.syncRequired(),t.inputting||t.triggerChange()),t.inputting||(t._lastValue=e),t.syncInputFieldValue(),t.overflowTwin&&!t._overflowTwinSync&&(t._overflowTwinSync=!0,t.overflowTwin.value=e,t._overflowTwinSync=!1)}hasChanged(e,r){return r!==e}syncInputFieldValue(e=!1){const r=this,{input:t,parent:i,inputValueAttr:n,inputValue:s}=r;if(t&&!r.inputting&&t[n]!==s&&(t[n]=s,!r.isConfiguring&&!r.containsFocus&&r.highlightExternalChange)){if(t.classList.remove("b-field-updated"),r.clearTimeout("removeUpdatedCls"),i){const{assigningValues:a}=i;(a===!0||(a==null?void 0:a.highlight)===!1)&&(e=!0)}e||r.highlightChanged()}r.syncEmpty(),r.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return this.value==null?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&(e.tagName.toLowerCase()==="textarea"||e.type&&/text|search|password|tel|url/.test(e.type))}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const r=this;r.hasChanged(r._lastValue,r.value)&&r.isValid&&(r.triggerChange(e,!0),r._lastValue=r.value)}triggerChange(e,r=!!this._isUserAction){const t=this,{value:i,_lastValue:n,isValid:s}=t;t.syncHint(),t.triggerFieldChange({value:i,oldValue:n,event:e,userAction:r,valid:s}),t.defaultAction==="change"&&t.trigger("action",{value:i,oldValue:n,event:e,userAction:r,valid:s})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var r;const t=this;t.validateOnInput||t.errorTip.hide(),t.inputting=!0,t.fetchInputValue(),t.inputting=!1,t.trigger("input",{value:t.value,event:e}),(r=t.changeOnKeyStroke)==null||r.call(t,e)}get needsInputSync(){var e;return this.input[this.inputValueAttr]!==String((e=this.inputValue)!=null?e:"")}internalOnKeyEvent(e){const r=this,{value:t}=r;let i=!1;if(e.type==="keydown"&&e.key==="Escape"&&!(r.readOnly||r.disabled)){const n=r.isValid,s="initialValue"in r?r.initialValue:r.valueOnFocus,a=r.hasChanged(s,t),{needsInputSync:o}=r;r.revertOnEscape&&(!n||a||o)&&(a&&(r.value=s),o&&r.syncInputFieldValue(!0),r.clearError(),i=(a||o)&&r.isValid||n!==r.validOnFocus)}r.isDestroyed||(i&&e.stopImmediatePropagation(),r.trigger(e.type,{event:e}))}clear(e){const r=this,{value:t}=r;(t!==r.nullValue||r.input.value.length>0)&&(r.value=r.nullValue,r.clearError(),r.syncInvalid(),r.trigger("clear",{event:e}))}onDisabled(){this.syncInvalid()}syncRequired(){var e;const r=this;!r.isConfiguring&&!r.focusing&&r.required&&r.isEmpty&&!((e=r.parent)!=null&&e.isSettingValues)?r.setError("L{fieldRequired}",r.updatingInvalid):r.clearError("L{fieldRequired}",r.updatingInvalid)}setError(e,r,t){const i=this;if((i.errors||(i.errors={}))[i.optionalL(e)]=1,r||i.syncInvalid(),t){const n=()=>{i.clearError(e),s()},s=i.ion({keydown:n,focusOut:n})}}clearError(e,r){const t=this;t.errors&&(e?delete this.errors[this.optionalL(e)]:t.errors={}),r||t.syncInvalid()}getErrors(){const e=this;if(!e.isValid){const r=e.validity,t=T.keys(r).find(s=>s!=="valid"&&s!=="customError"&&r[s]),i=e.errors&&Object.keys(e.errors);let n;if(i!=null&&i.length?n=i:r.customError?n=[e.input.validationMessage]:t?n=[e.L(t,{min:e.min,max:e.max})]:n=[e.L(e.invalidValueError)],(n==null?void 0:n.length)>0)return n}}createOverflowTwin(e){const r=this,t=super.createOverflowTwin(e);return t.ion({change({value:i}){r._overflowTwinSync=!0,r.value=i,r._overflowTwinSync=!1}}),t}get containerCollapsed(){var e;return(e=this.container)==null?void 0:e.collapsed}set containerCollapsed(e){const{container:r}=this;r&&(r.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,r){e&&(Array.isArray(e)||!("type"in e||"items"in e))&&(e={items:e});const t=this,i=e&&T.merge({owner:t,layout:"box"},t.containerDefaults),n=$.reconfigure(r,e,{owner:t,defaults:i});if(n&&(n.autoLayout=(i==null?void 0:i.layout)==="box",n===r)){n.syncContainer();return}return n}onConfigChange(e){var r,t;super.onConfigChange(e),(t=(r=this.container)==null?void 0:r.syncConfigTriggers)!=null&&t[e.name]&&this.container.syncChildConfigs()}assignValue(e,r){const t=this,{container:i,containValues:n}=t,s=t.getValueName(r),a=e&&s in e;i&&n!==!1?e&&n==="nested"?a&&(e=T.clone(e[s]),super.assignValue({[s]:e&&!("value"in e)||e.value},r),e&&delete e.value,i.assignValue(e,r)):(super.assignValue(e,r),i.assignValue(e,r)):super.assignValue(e,r)}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,r){const t=this,{container:i,containValues:n,valueName:s}=t,a=typeof n;r=r!=null?r:s in e,i&&n!==!1&&(n==="nested"?r&&(e[s]={value:e[s],...i.values}):(n===!0||n==null&&r||a==="string"&&t[n]||a==="function"&&n(t))&&i.gatherValues(e))}updateContainer(e,r){r&&this.detachListeners(r.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}};$e.Trigger=class extends ${static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:$e.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null,weight:null,role:void 0}}get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(r){return r}onClick(r){const t=this,{field:i}=t;i.disabled||i.readOnly||(r.key&&r.preventDefault(),i.trigger("trigger",{trigger:t})!==!1&&t.handler&&i.callback(t.handler,i,[r,t]))}onMousedown(r){const t=this.field;!("key"in r)&&C.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout(()=>t.editable=!0,500)),r.preventDefault(),C.getActiveElement(t.input)!==t.input&&t.focus()}},$e.SpinTrigger=class extends $e.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:{$config:["nullify"],value:!0}}}compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(r){var t;(t=this.clickRepeater)==null||t.destroy(),this.clickRepeater=r?lc.new({element:this.element},r):null}onClick(r){const t=this,{field:i}=t;i.disabled||i.readOnly||(r.target===t.upButton?i.doSpinUp(r.shiftKey):r.target===t.downButton&&i.doSpinDown(r.shiftKey))}},$e.Trigger.initClass(),$e.SpinTrigger.initClass(),$.register($e.Trigger,"trigger"),$.register($e.SpinTrigger,"spintrigger"),$e._$name="Field";var Xi=class extends $e{static get type(){return"textfield"}static get alias(){return"text"}static get configurable(){return{nullValue:""}}static get $name(){return"TextField"}construct(e){(e==null?void 0:e.inputType)==="hidden"&&(e.hidden=!0),super.construct(...arguments)}};Xi.initClass(),Xi._$name="TextField";var ls=class extends Xi{static get $name(){return"PickerField"}static get type(){return"pickerfield"}static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;(e=this.globalTapListener)==null||e.call(this),super.doDestroy()}updateEditable(e){var r;const t=this,{element:i,ariaElement:n,nonEditableClickTarget:s}=t;super.updateEditable(...arguments),i.classList.toggle("b-not-editable",!e),e===!1?(n.removeAttribute("aria-autocomplete"),(r=t.globalTapListener)==null||r.call(t),j.on({element:s,click:a=>{const o=s.getRootNode().elementFromPoint(a.clientX,a.clientY);a.target===s&&o===s&&t.onTriggerClick(a)},thisObj:t})):(n.setAttribute("aria-autocomplete","list"),t.globalTapListener=he.ion({globaltap:"showKeyboard",thisObj:t}))}get nonEditableClickTarget(){return this.input}updateElement(e,r){var t;const i=super.updateElement(e,r),n=this.peekConfig("picker"),s=n?n.isWidget?n.role:(t=this.constructor.resolveType(n.type))==null?void 0:t.$meta.config.role:!1;return this.ariaHasPopup=s,i}changePicker(e,r){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const r=this;r.pickerVisible&&r.picker.requestAnimationFrame(r.picker.realign,null,r.picker),super.onElementResize(e)}internalOnKeyEvent(e){const r=this;let t=!0;if(e.type==="keydown"&&!r.disabled&&!e.shiftKey&&!e.ctrlKey)if(r.pickerVisible){const{picker:i}=r;e.key==="Escape"?(e.preventDefault(),e.stopImmediatePropagation(),r.hidePicker(),t=!1):i.onInternalKeyDown?i.onInternalKeyDown(e):e.key==="ArrowDown"&&i.focusable&&i.focus()}else e.key==="ArrowDown"&&(e.stopImmediatePropagation(),e.preventDefault(),r.onTriggerClick(e));t&&super.internalOnKeyEvent(e)}onFocusIn(e){const r=this;super.onFocusIn(e),r.autoExpand&&(r.minChars=0,r.onTriggerClick(e),r.ignoreTriggerClick=!0,r.setTimeout(()=>r.ignoreTriggerClick=!1,100))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const r=this.input;C.isTouchEvent&&C.getActiveElement(r)===r&&e.target===r&&(he.suspendFocusEvents(),r.blur(),r.focus(),he.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const r=this,{picker:t}=r;r.pickerHideShowListenersAdded||(t.ion({show:"onPickerShow",hide:"onPickerHide",thisObj:r}),r.pickerHideShowListenersAdded=!0),C.setAttributes(r.ariaElement,{"aria-controls":t.id,"aria-expanded":!0}),t.autoClose=r.autoClose,t.show(),t.isVisible&&e&&r.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=he.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=j.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,r;const t=this;t.ariaElement.setAttribute("aria-expanded",!1),t.pickerVisible=!1,t.element.classList.remove("b-open"),t.trigger("togglePicker",{show:!1}),(e=t.pickerTapOutRemover)==null||e.call(t),(r=t.pickerKeyDownRemover)==null||r.call(t)}onPickerTapOut({event:e}){!this.containsFocus&&!this.owns(e.target)&&this.autoClosePicker()}onPickerKeyDown(e){if(e.key==="Tab"&&!this.picker.trapFocus){const r=C.getActiveElement(this.input),t=new KeyboardEvent("keydown",e);this.input.dispatchEvent(t),t.defaultPrevented&&e.preventDefault(),C.getActiveElement(this.input)===r?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;C.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout(()=>e.readOnly=!1,500)),super.focus()}};ls._$name="PickerField";var ci=document.createRange(),di=class extends ${static get $name(){return"List"}static get type(){return"list"}static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:null,navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,selectAllItem:!1,itemTpl(e){let r=L.encodeHtml(e[this.displayField]);return(r==null||r==="")&&(r="&nbsp;"),r},getItemStyle:null,getItemCls:null,groupHeaderTpl:(e,r)=>{let t=L.encodeHtml(r);return(t==null||t==="")&&(t="&nbsp;"),t},allowGroupSelect:!0,selected:{$config:"nullify",value:{}},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"}}}construct(e,...r){var t;const i=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...r);const{element:n}=i,{classList:s}=n;i.multiSelect&&s.add("b-multiselect"),(t=i.store)!=null&&t.count?i.refresh():s.add("b-empty"),j.on({element:n,delegate:i.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:i})}doDestroy(){var e;this.detachListeners("store"),(e=this.navigator)==null||e.destroy(),super.doDestroy()}onFocusIn(e){var r;this.restoreActiveItem((r=e._target)==null?void 0:r.closest(this.itemSelector)),super.onFocusIn(e)}contentTpl(){const e=this,r=e.store.records.map((t,i)=>e.itemWrapperTpl(t,i));return e.multiSelect&&e.selectAllItem!==!1&&r.unshift(e.selectAllItemTpl()),Jt.tpl`${r}`}itemWrapperTpl(e,r){const{selected:t,getItemStyle:i}=this,n=i?`style="${this.callback(i,this,[e])}"`:"";return Jt.tpl`<li ${n} class="${this.getItemClasses(e,r)}" role="option" aria-selected="${t.includes(e)}" data-index="${r}" data-id="${L.encodeHtml(e.id)}" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemContentTpl(e,r)}</li>`}itemContentTpl(e,r){return"groupRowFor"in e.meta?this.groupHeaderTpl(e,L.capitalize(e.groupChildren[0][e.meta.groupField])):`${this.itemIconTpl(e,r)}${this.itemTpl(e,r)}`}itemIconTpl(e,r){return this.multiSelect?`<i class="b-selected-icon b-icon ${this.selectIconCls}"></i>`:""}selectAllItemTpl(){const e=this.allSelected?"b-selected":"";return`<li class="${this.itemCls} b-select-all-item ${e}" data-noselect data-select-all data-id="select-all">${this.itemIconTpl({})}<div>${this.optionalL("Select All")}</div></li>`}getItemClasses(e){var r;const t=this,{getItemCls:i}=t,n=(r=t._navigator)==null?void 0:r.activeItem,s=(n==null?void 0:n.dataset.id)==e.id,a="groupRowFor"in e.meta?"b-list-item-group-header":"",o=t.selected.includes(e),l=i?this.callback(i,this,[e]):"";return`${t.itemCls} ${e.cls||""} ${l} ${o?t.selectedCls:""} ${s?t.navigator.focusCls:""} ${a}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:r,records:t,record:i,changes:n}){const s=this,{selected:a}=s;switch(r){case"dataset":{a.match(e.storage,!s._externallyOwnedSelection);break}case"remove":a.remove(t);break;case"clear":s.deselectAll();break;case"update":{const{id:o}=n;o&&C.setAttributes(s.contentElement.querySelector(L.encodeAttributeSelector("data-id",o.oldValue)),{"data-id":o.value}),s.refreshItem(i);return}}s.refresh()}onStoreRefresh(){this.refresh()}refresh(){var e;const r=this;if(r.isVisible){const t=(e=r.navigator)==null?void 0:e.activeItem;r.paintListener=null;const i=C.createElementFromTemplate(r.contentTpl(),{fragment:!0});r.clearItems().insertNode(i),t&&r.restoreActiveItem(t),r.refreshCount=(r.refreshCount||0)+1,r.element.classList[r.store.count>0?"remove":"add"]("b-empty"),r.updateSelectAllState()}else r.paintListener||(r.paintListener=r.ion({paint:"refresh",thisObj:r,once:!0}))}clearItems(){const e=this,r=e.contentElement.querySelector(e.itemSelector),t=e.contentElement.lastChild;if(r){const i=e.contentElement.querySelectorAll(`${e.itemSelector}:not(.b-mask)`);ci.setStartBefore(r),ci.setEndAfter(i[i.length-1]),ci.deleteContents()}else t?(ci.setStartAfter(t),ci.setEndAfter(t)):(ci.setStart(e.contentElement,0),ci.setEnd(e.contentElement,0));return ci}refreshItem(...e){for(const r of e){const t=this.getItem(r);if(t){const i=this.store.indexOf(r),n=C.createElementFromTemplate(this.itemWrapperTpl(r,i));C.sync(n,t)}}}getItem(e){if(e!=null)return typeof e=="number"?this.contentElement.querySelector(`[data-index="${e<0?this.store.count+e:e}"]`):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),(e==null?void 0:e.id)!=null&&(e=e.id),this.contentElement.querySelector(L.encodeAttributeSelector("data-id",e)))}getRecordFromElement(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){const r=this;r.store&&r.store.autoCreated&&r.store.destroy(),r.store=ee.getStore(e)}updateDisabled(e){super.updateDisabled(...arguments),this.navigator&&(this.navigator.disabled=e)}changeSelected(e,r){if(e){let t;e.isCollection?this._externallyOwnedSelection=!0:(Array.isArray(e)?(t=e,e={}):e.values&&(t=e.values,e={...e,values:[]}),e=new Mt(e)),e.ion({change:"onSelectionChange",thisObj:this}),this.initialSelection=t}else r==null||r.destroy();return e}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}get store(){return this.getConfig("items"),this._store}changeStore(e){const r=this;if(e instanceof ee||(Array.isArray(e)&&(e={data:e}),e=new ee(e)),r.detachListeners("store"),e){const t={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:r};e.readUrl&&(t.beforeLoad="onBeforeStoreLoad",t.afterRequest="onAfterStoreRequest"),e.isGrouped&&(r.element.classList.add("b-grouped"),t.groupchange="onStoreRefresh"),e.ion(t)}return e}updateStore(e){const{initialSelection:r}=this;Array.isArray(r)&&(e.count?(this.select(r),this.selected.count||this.onSelectionChange({action:"clear",removed:[]})):e.ion({refresh:()=>this.select(r),once:!0})),this.refresh()}changeNavigator(e,r){const t=this,{element:i}=t;return i&&(e=qi.reconfigure(r,e?qi.mergeConfigs({ownerCmp:t,disabled:t.disabled,target:i,keyEventTarget:i},e):null,t),(e==null?void 0:e.keyEventTarget)===i&&!t.itemsTabbable&&(i.tabIndex=0)),e}get minAlignHeight(){const e=this.element.lastElementChild,r=this.minHeight;if(r!=null)return e?Math.min(e.offsetTop+e.offsetHeight,r):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator&&(this.navigator.activeItem=null),super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:r}=this.navigator;super.minHeight=this._minHeight;const t=super.show(...arguments);return this.refreshCount===e&&this.restoreActiveItem(r,!0),t}restoreActiveItem(e=this.navigator.previousActiveItem,r="nearest"){const t=this,{navigator:i,lastAlignSpec:n}=t;if(e!=null){if(typeof r!="string"){const s=n?n.zone:1;r=s&1?"nearest":s?"start":"end"}e=t.getItem(e),e&&!t.disabled&&(t.scrollable.scrollIntoView(e,{block:r}),i.activeItem=e)}}onMouseOver(e){const r=this,t=e.currentTarget;!C.isTouchEvent&&t&&r.navigator&&r.activateOnMouseover&&r.setTimeout({fn:"handleMouseOver",delay:30,args:[t],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const r=e.target.closest(this.itemSelector);r&&this.onItemClick(r,e)}onInternalKeyDown(e){const r=this,t=r.navigator.activeItem;if(!r.disabled)switch(e.key){case" ":if(e.target.nodeName.toUpperCase()==="INPUT"&&!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,r){const t=this,i=parseInt(e.dataset.index);let n=t.store.getAt(i);if(!(t.disabled||t.trigger("beforeItem",{item:e,record:n,index:i,event:r,userAction:!0})===!1)){if(t._isUserAction=!0,t.allowGroupSelect||n&&!n.isSpecialRow)if(e.contains(r.target.closest("[data-noselect]")))e.contains(r.target.closest("[data-select-all]"))&&t.onSelectAllClick(e,r);else{const s=t.selected;let a=s.includes(n);t.multiSelect?(t.toggleAllIfCtrlPressed&&r.ctrlKey?n=t.store.records:t.allowGroupSelect&&n.isSpecialRow&&(a=!n.groupChildren.some(o=>!s.includes(o)),n=n.groupChildren),s[a?"remove":"add"](n)):s.splice(0,s.count,n)}t.isDestroyed||(t.lastClicked=n,t.trigger("item",{item:e,record:n,index:i,event:r,userAction:!0}),t._isUserAction=!1)}}onSelectionChange({action:e,removed:r,added:t,replaced:i}){const n=this,{selectedCls:s,unselectedCls:a}=n;let o,l;if(e==="clear")for(l of n.element.querySelectorAll(`.${s}`))l.classList.remove(s),l.setAttribute("aria-selected",!1),a&&l.classList.remove(a);else if(e!=="replaceValues"){for(o of r)l=n.getItem(o),l&&(l.classList.remove(s),l.setAttribute("aria-selected",!1));for(o of t)l=n.getItem(o),l&&(l.classList.add(s),l.setAttribute("aria-selected",!0))}n.selectAllItem&&n.updateSelectAllState()}onSelectAllClick(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var e;(e=this.element.querySelector(".b-select-all-item"))==null||e.classList.toggle(this.selectedCls,this.allSelected)}get allSelected(){const{selected:e,store:r}=this;return e.count&&(r.isFiltered?r.records.every(t=>e.includes(t)):r.count===e.count)}selectAll(e){const r=this;(r.multiSelect||!e)&&(r.selected.add(r.store.records),e&&!r.navigator.activeItem&&(r.navigator.activeItem=r.getItem(-1)))}deselectAll(){this.selected.clear()}select(e){const{store:r}=this,{modelClass:t}=r;e=H.asArray(e).reduce((i,n)=>(n=r.getById(t.asId(n)),n&&i.push(n),i),[]),this.selected.add(e)}deselect(e){const{modelClass:r}=this.store;e=H.asArray(e).reduce((t,i)=>(i=this.selected.get(r.asId(i)),i&&t.push(i),t),[]),this.selected.remove(e)}};di.initClass(),di.prototype.navigatorClass=qi,di._$name="List";var wc=class extends di{static get $name(){return"ChipView"}static get type(){return"chipview"}static get configurable(){return{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,r){const t=this;return Jt.tpl`${t.iconTpl?this.iconTpl(e):""}
            ${t.itemTpl(e,r)}
            ${t.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){const r=this;r.closable&&r.selected.count&&(e.key==="Delete"||e.key==="Backspace")?r.callback(r.closeHandler,r.owner,[r.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator&&(this.navigator.disabled=!e),this.isConfiguring||this.refresh()}onClick(e){const r=this,t=e.target.closest(`.${r.itemCls}`);if(r.closable&&e.target.classList.contains("b-close-icon")){const i=r.store.getAt(parseInt(t.dataset.index));r.callback(r.closeHandler,r.owner,[[i]])}else super.onClick(e)}};wc.initClass(),wc._$name="ChipView";var Qh="L{Field.fieldRequired}",cs="L{Field.validateFilter}",aP="L{Combo.recordNotCommitted}",qe=class extends ls{static get $name(){return"Combo"}static get type(){return"combo"}static get alias(){return"combobox,dropdown"}static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map(r=>r.value),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0},localizeDisplayFields:!1,buildItems:null}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=e.valueField===null,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;T.hasOwn(e,"_value")||(e._value=e.valueField===e.displayField?"":null,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e,_picker:r}=this,t=super.childItems;return e&&t.push(e),r&&t.push(r),t}get innerElements(){var e;const r=(e=this._chipView)==null?void 0:e.element,{input:t,inputElement:i}=this;return r&&q.sync({targetElement:t,domConfig:i}),[r||i]}updateInlinePicker(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(e){return e&&!(e instanceof ee)&&(e=new ee(ee.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,r){r==null||r.destroy()}changeChipView(e,r){const t=this;if(t.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:i}=t;return t.chipStore||(t.chipStore={}),mS.reconfigure(r,e,{defaults:{parent:t,insertBefore:i,store:t.chipStore,closable:!t.readOnly,navigator:{type:"combochipnavigator",keyEventTarget:i}}})}r==null||r.destroy()}updateChipView(e){var r;const t=this;t._chipViewEventDetacher=(r=t._chipViewEventDetacher)==null?void 0:r.call(t),t.chipStore=e==null?void 0:e.store,e&&(e.element.appendChild(t.input),t._chipViewEventDetacher=j.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:t}))}updateMultiSelect(e,r){const t=this,{input:i,element:n}=t,s=!t.isConfiguring;let{value:a}=t;if(n.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:o}=t,{parentNode:l}=i,c=o==null?void 0:o.element;c&&c!==l&&(l.insertBefore(c,i),c.appendChild(i),t.chipView.refresh()),i.value="",s&&(a=H.asArray(a))}else{const o=t._chipView,{parentNode:l}=i,c=o==null?void 0:o.element;c===l&&(c.parentNode.insertBefore(i,c),c.remove(),n.classList.remove("b-uses-chipview")),s&&typeof a!="string"&&(a=a!=null&&a.length?a[0]:null)}s&&(t.value=a)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,r={}){(r.isKeyEvent&&this.input.value===""||!r.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){this.hideTrigger!==!1&&(this.hideTrigger=!!e)}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){this.filterOnInput.delay=e}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateDisabled(e){super.updateDisabled(...arguments),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){const e=this._minChars;return e!=null?e:this.remoteFilter?4:1}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(e){e&&(this.items=e.call(this))}changeItems(e){const r=this;if(e==null){if(r.store&&!r.store.isItemStore)return;e=[]}if(r.buildItems&&!(e!=null&&e.length)&&(e=r.buildItems()),e instanceof ee){r.store=e;return}const t=r.displayField;let i,n=r.valueField,s;if(Array.isArray(e)?s=e.map(a=>{let o=a;return a instanceof ae?(i=a.constructor,n||(r.valueField=n=i.idField)):typeof a=="string"||typeof a=="number"?(n||(r.valueField=n=r.displayField),o={[n]:a,[t]:a}):(n||(r.valueField=n="value"),Array.isArray(a)&&(o={[n]:a[0],[t]:a[1]})),a.selected&&(r.value=o),o}):(n||(r.valueField=n="value"),s=[],Object.entries(e).forEach(([a,o])=>{s.push({[n]:a,[t]:o})})),r.store)r.store.data=s;else{const a=n===t?{name:"value",dataSource:t}:n;if(!i){class o extends ae{static get idField(){return r.valueField}static set idField(c){super.idField=c}static get fields(){return[a,t]}}i=o}r.store=new ee({isItemStore:!0,data:s,idField:n,verifyNoGeneratedIds:!1,modelClass:i})}}get value(){const e=this,{valueCollection:r,valueField:t}=e;if(t==null)return e.multiSelect?r.values.slice():r.first;let i;return e.multiSelect?i=r.count?r.map(n=>n[t]):e._lastValue||[]:i=r.count?r.first[t]:e._lastValue,i}set value(e){super.value=e}get needsInputSync(){return this.usesChipView?!1:!this.editable}changeValue(e,r){var t,i;const n=this;if(e===r){n.syncInputFieldValue(!0);return}if(!n.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");n.triggerConfig("items"),n.inputting||(t=n._chipView)==null||t.selected.clear(),n.store||(n.items=[]);const{valueField:s,displayField:a,store:o,valueCollection:l,_picker:c}=n,{storage:d}=o,u=(i=n.hidePickerOnSelect)!=null?i:!n.multiSelect,h=n._isUserAction||(c==null?void 0:c._isUserAction)||u&&n.pickerVisible||!1;if(!n.remoteFilter&&o.isAjaxStore&&!o.count){o.ion({load:()=>n.value=e,once:!0,thisObj:n}),n._lastValue=e;return}if(n.remoteFilter){if(e!=null){if(T.isObject(e)||e.isModel)n.store.data=[e],n.valueCollection.splice(0,n.valueCollection.count,n.store.first);else{const g=n.isConfiguring;n.primaryFilter.setConfig({value:e,disabled:!1}),o.performFilter(!0).then(()=>{if(n.isDestroyed)return;const{isConfiguring:m}=n;n.isConfiguring=g,l.splice(0,l.count,o.allRecords),n.isConfiguring=m})}return}}else o.filtered&&(n.primaryFilter.disabled=!0,o.filter());let f;if(e!=null){const g=Array.isArray(e),m=g?e.slice():[e];for(let y=0,S=m.length;y<S;y++){let D=m[y];if(D instanceof ae)d.includes(D,!0)||o.add(D);else{const w=T.isObject(D);w&&(D=D[o.modelClass.fieldMap[s].dataSource]),f=d.getBy(a,D)||d.getBy(s,D)||l.getBy(a,D)||l.getBy(s,D),f instanceof Set&&(f=[...f][0]),f?(w&&f.set(m[y]),m[y]=f):(m.splice(y,1),S--,y--)}}const p=!m.length,v=l.generation;l.splice(0,l.count,m),p&&(n._value=g&&e.length===0?null:e,n._lastValue=n._value),(p||l.generation===v)&&n.syncInputFieldValue(),n.syncEmpty(),p&&!n.isConfiguring&&n.triggerFieldChange({value:e,oldValue:r,userAction:h,valid:n.isValid})}else if(l.count)l.clear();else{const g=n._value;n._value=null,n.syncInputFieldValue(),n.syncEmpty(),n.isConfiguring||n.triggerFieldChange({value:e,oldValue:g,userAction:h,valid:n.isValid})}n._lastValue=n._value}hasChanged(e,r){return this.multiSelect?!T.isEqual(e,r):super.hasChanged(...arguments)}onComboStoreChange({action:e}){e!=="filter"&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){var r;this.usesChipView?(r=this.chipView)==null||r.refresh():super.syncInputFieldValue(e)}get usesChipView(){return!!(this.multiSelect&&this._chipView)}get isEmpty(){return this.valueCollection.count===0}get inputValue(){const e=this;let r=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(r=e.callback(e.displayValueRenderer,e,[e.selected,e])),r==null?"":r}get nonEditableClickTarget(){var e;return this.multiSelect&&((e=this.chipView)==null?void 0:e.element)||super.nonEditableClickTarget}changeValueCollection(e,r){if(r==null||r.destroy(),e)return e.isCollection||(e=new Mt({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e.isCollectionFilter?e.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):(typeof e=="function"&&(e={filterBy:e}),e=new it({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive,...e})),e}changeStore(e){const r=this,t=[],{valueCollection:i,keyStrokeFilterDelay:n,filterParamName:s}=r;if(Array.isArray(e)){r.items=e;return}let a;if(e){if(e.isStore){const o=e.filters.get("primary");r.remoteFilter&&(e.filterParamName=s),a=e.remoteFilter||e.restfulFilter,o?r.primaryFilter=o:t.push(r.primaryFilter)}else typeof e=="string"?e=ee.getStore(e):(e=new(e.readUrl?ut:ee)(e),r.destroyStore=!0),a=r.remoteFilter||e.restfulFilter,a&&s&&(e.filterParamName=s,r.encodeFilterParams&&(e.encodeFilterParams=r.encodeFilterParams)),t.push(r.primaryFilter);if(!r.valueField&&!r.usingRecordAsValue&&(r.valueField=e.modelClass.idField),r.filterSelected){const o=l=>!r.containsFocus||!i.includes(l);a?(e.storage.autoFilter=!0,e.storage.addFilter({id:`${r.id}-selected-filter`,filterBy:o})):(t.push(o),e.reapplyFilterOnAdd=!0)}i.addIndex({property:r.displayField,unique:!1}),i.addIndex({property:r.valueField,unique:!0}),t.forEach(o=>e.addFilter(o,!0)),a?r.keyStrokeFilterDelay=Math.max(300,n||0):r.keyStrokeFilterDelay=n!=null?n:10}return e}updateStore(e,r){const t=this,{_picker:i}=t;let n;t.destroyStore&&r&&r.destroy(),i&&(i.store=e),e.storage.addIndex({property:t.displayField,unique:!1}),e.storage.addIndex({property:t.valueField,unique:!0}),n={filter:"onStoreFilter"},t.displayValueRenderer&&((n||(n={})).change="onComboStoreChange"),t.detachListeners("store"),e!=null&&e.storage&&t.valueCollection.match(e.storage),t.syncInputFieldValue(),n&&(n.name="store",n.thisObj=t,e.ion(n))}get remoteFilter(){var e;return!!(this.filterParamName||(e=this._store)!=null&&e.restfulFilter)}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:e}=this;return this.multiSelect?this.valueCollection.values.slice().sort((r,t)=>e.indexOf(r)-e.indexOf(t))[0]:this.valueCollection.first}onEditComplete(){const e=this,r=e.valueCollection.count;super.onEditComplete(),r&&(e.clearError(cs),e.syncInputFieldValue()),e.required&&!r&&e.setError(Qh)}onTriggerClick(e){var r;const t=this,i="key"in e;if(!(t.ignoreTriggerClick||t.remoteFilter&&t.filterOnEnter)){if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled)switch((r=t.triggerAction)==null?void 0:r.toLowerCase()){case"all":t.doFilter(null,i);break;case"last":t.doFilter(t.lastQuery,i);break;default:t.doFilter(t.input.value,i)}}}internalOnInput(e){const r=this;r.syncEmpty(),r.syncInputWidth(),r.filterOnInput(e),r.trigger("input",{value:r.input.value,event:e})}filterOnInput(e){const r=this,{value:t}=e.type==="input"?e.target:r.input,i=t.length;r.inputting=!0,r.inlinePicker||i>=r.minChars&&(!r.filterOnEnter||e.key==="Enter")?r.doFilter(t):(r.validateFilter&&!r.remoteFilter&&r[i?"setError":"clearError"](cs),r.hidePicker()),r.inputting=!1}syncInputWidth(){const e=this;if(e.usesChipView){const r=e.input,t=e._inputPadding||(e._inputPadding=C.getEdgeSize(r,"padding","lr")),i=r.value||"",n=C.measureText(i+"W",r,!1,e.element)+t.width;r.style.flex=`1 1 ${Math.ceil(n)}px`}}doFilter(e,r){var t;const i=this,{store:n,picker:s}=i,a=e==null||e==="";i.lastQuery=e,i.primaryFilter.setConfig({value:e,disabled:a}),i.remoteFilter&&n.clear(!0);const o=()=>{const{navigator:l,isVisible:c}=s;n.count?!a&&l&&(l.activeItem=0):!i.remoteFilter&&!a&&(l&&(l.activeItem=null),i.validateFilter&&i.setError(cs)),c&&s.realign()};(t=i.filterPromise=n.filter())==null||t.then(()=>{i.filterPromise=null,o()}),i.inlinePicker||(s!=null&&s.isVisible?s.lastAlignSpec.zone===0&&s.realign():i.showPicker(r)),i.filterPromise||o()}onStoreFilter({source:e}){const r=this,t=r._picker,i=t==null?void 0:t.element.dataset,{count:n}=e;r.remoteFilter&&(n?t&&(t.navigator.activeItem=0):r.validateFilter&&r.setError(cs),r.filterSelected&&r.valueCollection.count&&(e.storage.onFiltersChanged({action:"splice",oldCount:1}),t&&t.refresh())),i&&(r.createOnUnmatched&&!n?i.addNewValue=r.L("L{addNewValue}")(r.primaryFilter.value):i==null||delete i.addNewValue)}onValueCollectionChange({source:e}){var r,t;const i=this,{multiSelect:n,_picker:s}=i,a=(r=i.hidePickerOnSelect)!=null?r:!n,o=n?e.values.slice():e.first,l=e.values.slice(),c=i._isUserAction||(s==null?void 0:s._isUserAction)||a&&i.pickerVisible||!1,d=i._value;a&&i.hidePicker(),!e.count&&i.required?i.setError(Qh):(i.clearError(Qh),i.clearError(cs)),i.validateFilter&&o&&i.clearError(cs),i.filterSelected&&(i.remoteFilter?(i.store.storage.onFiltersChanged({action:"splice",oldCount:1}),i._picker&&i._picker.refresh()):i.store.filter()),i._value=null,i._lastValue=null;const u=i.cacheCurrentValue(i.value);i.syncInputFieldValue(),i.syncEmpty(),i.isConfiguring||(i.triggerFieldChange({value:u,oldValue:d,userAction:c,valid:i.isValid}),(t=i.trigger)==null||t.call(i,"select",{record:o,records:l,userAction:c}),i.defaultAction==="select"&&i.trigger("action",{value:u,record:o,records:l,userAction:c}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.inlinePicker&&!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){var e;const r=this,{picker:t}=r;r.readOnly||r.inlinePicker||(t.multiSelect=r.multiSelect,super.showPicker(...arguments),r.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),t.restoreActiveItem&&(r.multiSelect?t.restoreActiveItem(((e=t.navigator)==null?void 0:e.previousActiveItem)||r.selected||0,!0):t.restoreActiveItem(r.selected||0,!0)),r.input.focus())}changePicker(e,r){const t=this,i=t.pickerWidth||(e==null?void 0:e.width),n=di.mergeConfigs({owner:t,store:t.store,selected:t.valueCollection,multiSelect:t.multiSelect,cls:t.listCls,displayField:t.displayField,forElement:t[t.pickerAlignElement],align:{matchSize:i==null,anchor:t.overlayAnchor,target:t[t.pickerAlignElement],minHeight:t.inlinePicker?null:Math.min(3,t.store.count)*40},[t.listItemTpl?"itemTpl":void 0]:t.listItemTpl,width:i,navigator:{keyEventTarget:t.input}},e);return t.inlinePicker&&Object.assign(n,{floating:!1,align:null,activateOnMouseover:!1,maxHeight:null,appendTo:t.element}),e=di.reconfigure(r,e?n:null,t),e&&(e.element.classList.add("b-combo-picker"),e.element.dataset.emptyText=t.emptyText?t.L(t.emptyText):t.L("L{noResults}"),e.ion({navigate:"onPickerNavigate",thisObj:t}),j.on({element:e.element,pointerdown:s=>t.onPickerNavigate({event:s}),thisObj:t})),e}onPickerNavigate({event:e}){e.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}async internalOnKeyEvent(e){const r=this,t=r.input[r.inputValueAttr],i=t.length,{key:n}=e,{store:s,_picker:a,multiSelect:o}=r;if(e.type==="keydown"&&(a!=null&&a.isVisible)&&a.navigator){const{activeItem:l}=a.navigator;if(l&&o&&n===r.multiValueSeparator){r.input.value="",r.primaryFilter.setConfig({value:"",disabled:!0}),s.filter(),a.onItemClick(l,e),a.hide(),e.preventDefault();return}if(!l&&r.createOnUnmatched&&(o&&n===r.multiValueSeparator||n==="Enter")){e.preventDefault(),await r.addNewRecord(t);return}}super.internalOnKeyEvent(...arguments),e.type==="keydown"&&n==="Enter"&&r.filterOnEnter&&i>=r.minChars&&(e.stopPropagation(),r.filterOnInput.now(e))}async addNewRecord(e){var r,t;const i=this,{store:n,_picker:s,valueCollection:a,multiSelect:o,primaryFilter:l}=i,c=n.remoteFilter&&n.autoCommit;i.filterPromise&&await i.filterPromise,c||(l.setConfig({value:"",disabled:!0}),n.filter());const[d]=n.add(i.callback(i.createOnUnmatched,i,[e,i]));if(n.isCommitting){let u;try{await n.commitPromise}catch(h){u=(t=(r=h.response)==null?void 0:r.parsedJson)==null?void 0:t.error}d.isPhantom&&(i.clearError(),i.setError(u||aP,!1,!0),n.remove(d),n.removed.remove(d))}c&&(l.setConfig({value:"",disabled:!0}),n.filter()),i.input.value="",n.includes(d)&&a.splice(o?a.count:0,o?0:a.count,d),s==null||s.hide()}changeCreateOnUnmatched(e){return e===!0&&(e=this.defaultRecordCreater),e}defaultRecordCreater(e){return this.store.createRecord({[this.displayField]:e})}updateLocalization(){var e;super.updateLocalization();const r=this,{displayField:t}=r;let{localizedDisplayFieldsMap:i}=r;if(r.localizeDisplayFields===!0){i||(r.localizedDisplayFieldsMap=i=new Map),!r.store&&r.buildItems&&(r.items=r.buildItems());for(const n of r.items)if(n.id){let s=i.get(n.id);!s&&((e=n[t])!=null&&e.startsWith("L{"))&&(s=n[t],i.set(n.id,s)),s&&(n[t]=r.L(s))}r.syncInputFieldValue()}}};R(qe,"delayable",{filterOnInput:0});var mS=class extends wc{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return L.encodeHtml(e[this.owner.displayField])},scrollable:{overflowY:"auto"}}}},oP=class extends qi{static get $name(){return"ComboChipNavigator"}static get type(){return"combochipnavigator"}static get configurable(){return{allowShiftKey:!0}}onTargetClick(e){const r=this,t=e.target.closest(r.itemSelector);t&&!e.target.classList.contains("b-close-icon")&&(!e.shiftKey&&!t.contains(e.target.closest("[data-noselect]"))&&r.ownerCmp.selected.clear(),r.inClickHandler=!0,r.activeItem=t,r.inClickHandler=!1)}onKeyDown(e){e.key!=="Enter"&&!e.target.selectionStart&&!e.target.selectionEnd&&super.onKeyDown(e)}updateActiveItem(e,r){const t=this.ownerCmp;super.updateActiveItem(e,r),e&&!this.inClickHandler&&t.selected.add(t.getRecordFromElement(e))}navigatePrevious(e){const r=this.ownerCmp;r.navigator.activeItem&&!e.shiftKey&&r.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const r=this.ownerCmp;r.navigator.activeItem&&!e.shiftKey&&r.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}};qe.initClass(),mS.initClass(),oP.initClass(),qe._$name="Combo";var Dc=class extends yt{static get $name(){return"UndoRedoBase"}static get type(){return"undoredobase"}static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}}}}afterConstruct(){this.updateUndoRedoControls()}updateStm(e){this.detachListeners("undoredo"),e==null||e.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(e){const{undoBtn:r,redoBtn:t}=e;return this.color&&(r&&(r.color=this.color),t&&(t.color=this.color)),this.text&&(r&&(r.text="L{UndoRedo.Undo}"),t&&(t.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=this.stm.queue.map((r,t)=>[t,r||`Transaction ${t}`]))}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:r}=this,{undoBtn:t,redoBtn:i}=this.widgetMap;t.badge=e.position||(r?"0":""),i.badge=e.length-e.position||(r?"0":""),t.disabled=!e.canUndo,i.disabled=!e.canRedo,this.fillUndoRedoCombo()}transactionsDisplayValueRenderer(e,r){var t;const i=((t=this.stm)==null?void 0:t.position)||0;return`${i} undo actions / ${r.store.count-i} redo actions`}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const r=this.stm,t=e.value;t>=0&&(r.canUndo&&t<r.position?r.undo(r.position-t):r.canRedo&&t>=r.position&&r.redo(t-r.position+1))}};Dc.initClass(),Dc._$name="UndoRedoBase";var ef=class extends qe{static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,r){const t=this;return super.changeStore(new ee({data:[{id:t.positiveValue,text:t.positiveText||t.L("L{Object.Yes}")},{id:t.negativeValue,text:t.negativeText||t.L("L{Object.No}")}]}),r)}};ef.initClass(),ef._$name="BooleanCombo";var pS=class extends yt.mixin(cc){onChildAdd(e){super.onChildAdd(e),e.ion({click:"resetValueCache",toggle:"onItemToggle",thisObj:this,prio:1e4})}onChildRemove(e){e.un({toggle:"resetValueCache",click:"resetValueCache",thisObj:this}),super.onChildRemove(e)}onItemToggle(e){const r=this;r.resetValueCache(),!r.isSettingValue&&(!r.toggleGroup||e.pressed)&&r.triggerFieldChange({value:r.value,userAction:!0,event:e})}resetValueCache(){this._value=null}createWidget(e){const r=this;return r.constructor.resolveType(e.type||"button").isButton&&(r.color&&!e.color&&(e.color=r.color),r.toggleGroup&&!e.toggleGroup&&(typeof r.toggleGroup=="boolean"&&(r.toggleGroup=pS.generateId("toggleGroup")),e.toggleGroup=r.toggleGroup)),r.columns&&(e.width=`${100/r.columns}%`),e=super.createWidget(e),r.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget(r=>{r.rotate!==!1&&(r.rotate=e)})}get value(){if(!this._value){const e=[];this.items.forEach(r=>{r.pressed&&r.value!==void 0&&e.push(r.value)}),this._value=e.join(this.valueSeparator)}return this._value}set value(e){const r=this,t=r.value;Array.isArray(e)||(e==null?e=[]:typeof e=="string"?e=e.split(r.valueSeparator):e=[e]),r._value=e.join(r.valueSeparator),r.isSettingValue=!0,r.items.forEach(i=>{i.value!==void 0&&(i.pressed=e.includes(i.value))}),r.isSettingValue=!1,!r.isConfiguring&&t!==r.value&&r.triggerFieldChange({value:r.value,userAction:!1})}updateDisabled(e){this.items.forEach(r=>r.disabled=e||!r.ignoreParentReadOnly&&this.readOnly)}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}},Vr=pS;R(Vr,"$name","ButtonGroup"),R(Vr,"type","buttongroup"),R(Vr,"configurable",{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value"}),Vr.initClass(),Vr._$name="ButtonGroup";var ds=class extends Nt{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var r;(r=super.onPaint)==null||r.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;(e=this.tip)==null||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const r=parseInt(C.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,r)}updateMinRowHeight(e){this.weekElements.forEach(r=>C.setLength(r,"minHeight",e)),this.scrollable={overflowY:e?"auto":!1}}changeMinColumnWidth(e){const r=parseInt(C.getStyleValue(this.element,"--min-column-width"),10)||75;return e==null?e:Math.max(parseInt(e)||0,r)}updateMinColumnWidth(e){const r=this;r.weekdayCells.forEach(t=>C.setLength(t,"minWidth",e)),r.cellElements.forEach(t=>t.matches(`.${r.dayCellCls}`)&&C.setLength(t,"minWidth",e)),r.scrollable={overflowX:e?"auto":!1},r.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const r=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(r)return b.parseKey(r.dataset.date)}changeTip(e,r){const t=this;return ue.reconfigure(r,e,{owner:t,defaults:{type:"tooltip",owner:t,id:`${t.id}-cell-tip`,forElement:t.bodyElement,forSelector:`.${t.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),e==null||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,r){const t=this;super.updateElement(e,r),t.updateHideNonWorkingDays(t.hideNonWorkingDays),t.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),t.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),t.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),t.cellElements=[];for(let i=0,{length:n}=t.weekDayElements;i<n;i++)t.cellElements.push(t.weekDayElements[i].previousSibling,...t.weekDayElements[i].children)}changeDate(e){if(e=typeof e=="string"?b.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return b.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let r=4;r<11;r++)e.setDate(r),this.shortDayNames.push(b.format(e,this.dayNameFormat))}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(e){const r=this;if(r._month){r.month.weekStartDay=e,r.dayNames=[];for(let t=0;t<7;t++)r.dayNames[t]=r.shortDayNames[r.canonicalDayNumbers[t]];r.refreshCount&&r.refresh()}}updateHideNonWorkingDays(e){var r;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,!!e),(r=this.scrollable)==null||r.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var r;this.element.classList.toggle(this.hideOtherMonthCellsCls,!!e),(r=this.scrollable)==null||r.syncOverflowState()}updateDisableOtherMonthCells(e){var r;this.element.classList.toggle(this.disableOtherMonthCellsCls,!!e),(r=this.scrollable)==null||r.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=b.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=b.weekends)}changeNonWorkingDays(e){return T.assign({},e)}updateNonWorkingDays(e){var r;this._month&&(this.month.nonWorkingDays=e,this.refresh(),(r=this.scrollable)==null||r.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return b.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return b.add(e,1,"day")}changeMonth(e,r){const t=this;if(!(e instanceof os)){if(typeof e=="number"){if(r){r.month=e;return}const i=t.date||b.clearTime(new Date);i.setMonth(e),e={date:i}}e=os.new({weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:t}),e}onMonthDateChange({source:e,newDate:r,oldDate:t,changes:i}){const n=this;n.year=e.year,n.isConfiguring||((!n.getCell(r)||i.m||i.y)&&(n.refresh(),n.animateTimeShift&&n.isVisible&&C.slideIn(n.contentElement,r>t?1:-1)),n.trigger("dateChange",{changes:i,value:r,oldValue:t}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const r=this;r.element.classList[e?"add":"remove"]("b-show-week-column"),r.floating&&(r.isAligning||r.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const r=this,t=r.timeZone!=null?r.timeZone:(e=r.project)==null?void 0:e.timeZone,i=t!=null?pt.toTimeZone(new Date,t):new Date,{weekElements:n,weekDayElements:s,date:a,month:o,dayCellCls:l,dayHeaderCls:c,disabledCls:d,otherMonthCls:u,weekendCls:h,todayCls:f,nonWorkingDayCls:g,nonWorkingDays:m,canonicalDayNumbers:p,sixWeeks:v}=r;if(i.setHours(0,0,0,0),!a){r.date=i;return}r.trigger("beforeRefresh"),r.getConfig("dayNameFormat");for(let w=0;w<7;w++){const E=r.weekdayCells[w],x=r.canonicalDayNumbers[w],M={[c]:1,[h]:b.weekends[x],[g]:m[x]};r.headerRenderer?(E.innerHTML="",r.callback(r.headerRenderer,r,[E,w,x])):C.setInnerText(E,r.shortDayNames[x]),C.syncClassList(E,M),E.dataset.columnIndex=w,E.dataset.cellDay=x}let y=0,S=0,D=6;for(let w=6;w>=0;w--)if(!m[p[w]]){D=w;break}n[4].classList.toggle("b-hide-display",o.weekCount<5&&!v),n[5].classList.toggle("b-hide-display",o.weekCount<6&&!v),o.eachWeek((w,E)=>{const x=s[y],M=[x.previousSibling,...x.children];n[y].dataset.week=`${w[0]},${w[1]}`,r.weekRenderer?r.callback(r.weekRenderer,r,[M[0],w]):M[0].innerText=w[1];for(let I=0;I<7;I++){const P=E[I],_=P.getDay(),A=b.makeKey(P),V=m[_],N=M[I+1],B={[l]:1,[d]:r.isDisabledDate(P),[u]:P.getMonth()!==o.month,[h]:b.weekends[_],[f]:P.getTime()===i.getTime(),[g]:V,"b-last-working-day":I===D,"b-first-visible-cell":!(P-(r.firstVisibleDate||-1)),"b-last-visible-cell":!(P-(r.lastVisibleDate||-1)),[`b-day-of-week-${_}`]:1};C.syncClassList(N,B),N.dataset.date=A,N.dataset.cellIndex=S,N.dataset.columnIndex=I,N.lastDomConfig&&(delete N.lastDomConfig.class,delete N.lastDomConfig.className),r.cellRenderer?r.callback(r.cellRenderer,r,[{cell:N,date:P,day:_,row:n[y],rowIndex:y,cellIndex:S,columnIndex:I,visibleColumnIndex:r.visibleDayColumnIndex[_],week:w,key:A}]):N.innerHTML=P.getDate(),S++}y++}),r.visibleWeekCount=y,r.floating&&(r.isAligning||r.realign()),r.refreshCount=(r.refreshCount||0)+1,r.trigger("refresh")}isDisabledDate(e){const r=e.getDay(),{disabledDates:t,nonWorkingDays:i}=this;if(this.disableWeekends&&i[r])return!0;if(t)return Array.isArray(t)?(e=b.clearTime(e,!0),t.some(n=>!(b.clearTime(n,!0)-e))):this.callback(this.disabledDates,this,[e])}get bodyConfig(){const e=super.bodyConfig,r=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...H.fill(7,{class:this.dayHeaderCls}),C.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:r}];for(let t=0;t<6;t++){const i={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:t},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};r.push(i)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:r}=this.month;return new Date(e,r,1)}for(const e=this,r=e.month.startDate;;r.setDate(r.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[r.getDay()])return r}get lastVisibleDate(){const e=b.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const r=this,t=e;;t.setDate(t.getDate()-1))if(!r.hideNonWorkingDays||!r.nonWorkingDays[t.getDay()])return t}getCell(e,r){typeof e!="string"&&(e=b.makeKey(e));const t=this.weeksElement.querySelector(`[data-date="${e}"]`);if(t&&(!r||!t.classList.contains(this.otherMonthCls)))return t}onTipOverCell({source:e,target:r}){e.date=b.parseKey(r.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}};ds.initClass(),ds._$name="CalendarPanel";var lP=e=>!e.value,Zi=class extends $e{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&(e=T.assign({},e),e.value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:r}=this;r&&(r=r===!0?lP:r,e.collapsed=r(this))}assignFieldValue(e,r,t){this.value=t===this.checkedValue||(t===this.uncheckedValue?!1:null)}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var r;const t=this,i=t.value?t.checkedValue:t.uncheckedValue,n=i!==void 0,{valueName:s}=t;n&&(e[s]=i),t.gatherValues(e,n),i===!0&&((r=e[s])==null?void 0:r.value)===i&&delete e[s].value}changeValue(e){return e==="false"?!1:!!e}updateValue(e){var r;const t=this,i=t.input.checked!==e;t.input.checked=e,(r=t.container)==null||r.syncChildConfigs(),i&&!t.inputting&&!t.isConfiguring&&(t.uncheckToggleGroupMembers(),t.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,r){const t=this.element.classList;r&&t.remove(r),e&&t.add(e)}getToggleGroupMembers(){const e=this,{checked:r,toggleGroup:t,input:i,type:n}=e,s=[];return r&&t&&C.forEachSelector(e.rootElement,`input[type=${n}][data-group=${t}]`,a=>{if(a!==i){const o=$.fromElement(a);o&&s.push(o)}}),s}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const r=this;if(r.readOnly&&r.value!==r.input.checked){r.input.checked=r.value;return}r.value=r.input.checked,r.inputting||(r.inputting=!0,r.triggerChange(!0),r.inputting=!1)}updateInputReadOnly(e){}triggerChange(e){const r=this,{checked:t}=r.input,i={checked:t,value:t,userAction:e,valid:!0};if(!t&&e&&r.toggleGroup&&r.getToggleGroupMembers().filter(s=>s.isVisible&&!s.disabled).length||r.trigger("beforeChange",i)===!1)r.input.checked=r._value=!t;else return r.triggerFieldChange(i,!1),e&&r.uncheckToggleGroupMembers(),r.trigger("action",i),r.trigger("change",i),!0}};Zi.initClass(),Zi._$name="Checkbox";var ui=class extends Nt{construct(e){super.construct({year:new Date().getFullYear(),...e}),j.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const r=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===r?this.trigger("select",{oldValue:r,value:r}):this.year=r}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return T.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,r){const t=this;!t.startYear||e>t.endYear?t.startYear=e:e<t.startYear&&(t.startYear=e-(t.yearButtonCount-1)),t.isConfiguring||t.trigger("select",{oldValue:r,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,r){this.isVisible&&C.slideIn(this.contentElement,Math.sign(e-r))}composeBody(){this.getConfig("year");const{startYear:e}=this,r=super.composeBody(),t=r.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let i=0,n=e;i<this.yearButtonCount;i++,n++)t.push({tag:"button",dataset:{year:n},class:{"b-yearpicker-year":1,"b-selected":n===this.year},text:`000${n}`.slice(-4)});return r}};R(ui,"$name","YearPicker"),R(ui,"type","yearpicker"),R(ui,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),ui.initClass(),ui._$name="YearPicker";var tf=class extends Xi{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):L.encodeHtml(this.value)}}};tf.initClass(),tf._$name="DisplayField";var vS=()=>b.getMonthNames().map((e,r)=>[r,e]),yS=(e,r)=>e.valueOf()-r.valueOf(),cP=Object.freeze([]),dP=class extends qe{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}};dP.initClass();var eo=class extends ds{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:vS(),internalListeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,r)=>e&&e.equals(r)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const r=this;super.construct(e),r.externalCellRenderer=r.cellRenderer,r.cellRenderer=r.internalCellRenderer,r.element.setAttribute("aria-activedescendant",`${r.id}-active-day`),r.weeksElement.setAttribute("role","grid"),r.weekElements.forEach(t=>t.setAttribute("role","row")),r.element.setAttribute("ariaLabelledBy",r.widgetMap.fields.id),j.on({element:r.weeksElement,click:{handler:"onCellClick",delegate:`.${r.dayCellCls}:not(.${r.disabledCls}):not(.${r.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${r.dayCellCls}`},thisObj:r}),r.widgetMap.monthField.readOnly=r.widgetMap.yearButton.disabled=!r.editMonth,r.refresh.flush()}afterHide(){var e;(e=this._yearPicker)==null||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,r;(e=this.yearButton)==null||e.destroy(),(r=this.monthField)==null||r.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,r=e.focusElement,t=b.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=e.date;super.doRefresh(...arguments);const i=b.parseKey(r==null?void 0:r.dataset.date);t-i&&e.syncActiveDate(t,i)}internalCellRenderer({cell:e,date:r}){const t=this,{activeCls:i,selectedCls:n,externalCellRenderer:s}=t,a=t.isSelectedDate(r),o={[i]:i&&t.isActiveDate(r),[n]:a,[t.outOfRangeCls]:t.minDate&&r<t.minDate||t.maxDate&&r>t.maxDate};if(a&&t.multiSelect){const l=!t.isSelectedDate(b.add(r,-1,"d")),c=!t.isSelectedDate(b.add(r,1,"d"));o["b-range-start"]=l,o["b-range-end"]=c,o["b-in-range"]=!l&&!c}C.updateClassList(e,o),e.innerHTML=`<div class="b-datepicker-cell-inner">${r.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",b.format(r,"MMMM D, YYYY")),t.isActiveDate(r)?e.id=`${t.id}-active-day`:e.removeAttribute("id"),s&&(arguments[0].cell=e.firstChild,t.callback(s,this,arguments))}onCellMousedown(e){const r=e.target.closest("[data-date]");e.preventDefault(),r.focus(),this.activeDate=b.parseKey(r.dataset.date)}onCellClick(e){const r=e.target.closest("[data-date]");this.onUIDateSelect(b.parseKey(r.dataset.date),e)}onMonthDateChange({newDate:e,changes:r}){this.getConfig("tbar"),super.onMonthDateChange(...arguments),(r.m||r.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear())}onUIDateSelect(e,r){const t=this,{lastClickedDate:i,multiSelect:n}=t;t.lastClickedDate=e,t.isDisabledDate(e)||(t.activatingEvent=r,n?t.handleMultiSelect(i,e,r):(t.selection=e,t.floating&&t.hide()),t.activatingEvent=null)}handleMultiSelect(e,r,t){const i=this,{multiSelect:n}=i,s=i._selection||(i._selection=new to),a=s.dates,o=n==="range",{size:l,generation:c}=s,d=l&&{[b.makeKey(b.add(a[0],-1,"d"))]:1,[b.makeKey(a[0])]:1,[b.makeKey(a[a.length-1])]:1,[b.makeKey(b.add(a[a.length-1],1,"d"))]:1},u=s.has(r),h=u?"delete":"add",f=o&&(d==null?void 0:d[b.makeKey(r)]);if(t.ctrlKey)(n===!0||!l||f)&&(s[h](r),o&&!s.has(i.rangeStartDate)&&i.rangeStartDate.setDate(i.rangeStartDate.getDate()+(r<a[1]?1:-1)));else if(t.shiftKey&&l){const[m,p]=[new Date(o?i.rangeStartDate||(i.rangeStartDate=a[0]):e),r].sort(yS);o&&s.clear();for(const v=m;v<=p;v.setDate(v.getDate()+1))s.add(v)}else s.has(r)&&s.size===1||(s.clear(),s.add(r));const g=s.size;g===1?i.rangeStartDate=r:g||(i.rangeStartDate=null),s.generation!==c&&i.updateSelection(s)}changeSelection(e){const r=this;let t,i;if(e)if(e.forEach||(e=[e]),e.forEach((n,s)=>e[s]=r.changeDate(n)),i=e[0],e.sort(yS),r.multiSelect==="range"&&e.length===2){t=new to;for(const n=new Date(e[0]);n<=e[1];n.setDate(n.getDate()+1))t.add(n)}else i=e[0],t=new to(e);else t=new to;return i&&(r.activeDate=r.rangeStartDate=b.clearTime(i)),t}updateMultiSelect(e){this.element.classList.toggle("b-multiselect",!!e),e||(this.selection=[...this.selection][0])}updateSelection(e){const r=this,{dates:t}=e,i=r.multiSelect==="range"?[t[0],t[t.length-1]]:t;t.length&&(r.date=t[0]),r.isConfiguring||(r.refresh.now(),r.trigger("selectionChange",{selection:i,userAction:!!r.activatingEvent}))}get selection(){const{_selection:e}=this,r=e?e.dates:cP;return this.multiSelect==="range"&&r.length?[r[0],r[r.length-1]]:r}onInternalKeyDown(e){const r=this,t=e.key.trim()||e.code,i=r.activeDate;let n=new Date(i);if(t==="Escape"&&r.floating)return r.hide();if(i&&r.weeksElement.contains(e.target)){do switch(t){case"ArrowLeft":e.preventDefault(),e.ctrlKey?n=r.gotoPrevMonth():n.setDate(n.getDate()-1);break;case"ArrowUp":e.preventDefault(),n.setDate(n.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?n=r.gotoNextMonth():n.setDate(n.getDate()+1);break;case"ArrowDown":e.preventDefault(),n.setDate(n.getDate()+7);break;case"Enter":return r.onUIDateSelect(i,e)}while(r.isDisabledDate(n)&&!r.focusDisabledDates);if(r.minDate&&n<r.minDate||r.maxDate&&n>r.maxDate)return;r.activeDate=n}}changeMinDate(e){return e&&ds.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=e==null?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&ds.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=e==null?void 0:e.getFullYear()),this.refresh()}changeDate(e){return b.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e){const r=this;r.isConfiguring&&!r.initializingActiveDate&&(r.selection=e),(!r.month.date||e.getMonth()===r.month.month||!r.getCell(e)||r.alwaysRefreshOnMonthChange||r.isNavigating)&&super.updateDate(e)}changeActiveDate(e,r){if(this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:r})!==!1){if(e=e?this.changeDate(e):this.date||(this.date=b.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return b.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,r){const t=this,{isConfiguring:i}=t;(i||!t.getCell(e))&&(t.initializingActiveDate=i,t.date=e,t.initializingActiveDate=!1),!i&&!t.refresh.isPending&&t.syncActiveDate(e,r)}syncActiveDate(e,r){const t=this,{activeCls:i}=t,n=t.getCell(e),s=r&&t.getCell(r),a=C.getActiveElement(t.element);n.setAttribute("tabIndex",0),i&&n.classList.add(i),n.id=`${t.id}-active-day`,t.weeksElement.contains(a)&&n.focus(),s&&s!==n&&(s.removeAttribute("tabIndex"),i&&s.classList.remove(i),s.removeAttribute("id"))}set value(e){const r=this,{selection:t,duration:i}=r;if(e){if(e=r.changeDate(e,r.value),r.multiSelect==="range"&&(t==null?void 0:t.length)===2){b.betweenLesserEqual(e,...t)||(e<t[0]?r.selection=[e,b.add(e,i-1,"d")]:r.selection=[b.add(e,-(i-1),"d"),e]),r.date=r.activeDate=e;return}e!==void 0&&(r.selection=e)}else r.date=new Date,r.selection=null}get value(){return this.selection[this.selection.length-1]}get duration(){return this.multiSelect==="range"?b.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,r){const t=this,{activeDate:i}=t,n=i&&t.getCell(i);let s;r==="month"&&n&&(i==null?void 0:i.getMonth())===t.month.month+e?s=i:s=b.add(n?i:t.date,e,r);const a=new Date(s);a.setDate(1);const o=b.add(b.add(a,1,"month"),-1,"day");if(t.minDate&&e<0&&o<t.minDate||t.maxDate&&e>0&&a>t.maxDate)return;t.isNavigating=!0;const l=t.date=s;return n&&(t.activeDate=s),t.isNavigating=!1,l}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var r;return(r=this._selection)==null?void 0:r.has(e)}onMonthPicked({record:e,userAction:r}){var t;r&&(this.activeDate=b.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),(t=this.focusElement)==null||t.focus())}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:r}){const t=new Date(this.activeDate);t.setFullYear(e),this.activeDate=t,this.focusElement&&C.focusWithoutScrolling(this.focusElement),r.hide()}changeYearPicker(e,r){var t,i;return ui.reconfigure(r,e?ui.mergeConfigs({owner:this,appendTo:this.element,minYear:(t=this.minDate)==null?void 0:t.getFullYear(),maxYear:(i=this.maxDate)==null?void 0:i.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,r=super.childItems;return e&&r.push(e),r}updateLocalization(){const{monthField:e}=this.widgetMap,r=vS();!this.isConfiguring&&!r.every((t,i)=>t[1]===e.store.getAt(i).text)&&(r[e.value].selected=!0,e.items=r),super.updateLocalization()}},to=class extends Set{add(e){return e=b.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=b.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(b.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new to(e)),e.size===this.size&&[...this].every(r=>e.has(r))}get dates(){return[...this].sort().map(e=>b.parseKey(e))}};eo.initClass(),eo._$name="DatePicker";var us=class extends ls{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,r){const t=this,i={owner:t,forElement:t[t.pickerAlignElement],minDate:t.min,maxDate:t.max,weekStartDay:t._weekStartDay,align:{anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},onSelectionChange:({selection:s,source:a})=>{a.isVisible&&(t._isUserAction=t._isPickerInput=!0,t.value=s[0],t._isPickerInput=t._isUserAction=!1,a.hide())}};t.calendarContainerCls&&(i.cls=t.calendarContainerCls),t.value?i.value=t.value:i.activeDate=new Date;const n=eo.reconfigure(r,e,{owner:t,defaults:i});return n==null||n.refresh.flush(),n}get backShiftDate(){return b.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:r}=e;if(!e.readOnly&&e.value){const t=e.backShiftDate;(!r||r.getTime()<=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}get forwardShiftDate(){return b.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:r}=e;if(!e.readOnly&&e.value){const t=e.forwardShiftDate;(!r||r.getTime()>=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const r=this,{_picker:t}=r;if(t){const i={minDate:r.min,maxDate:r.max};r.value?i.value=r.value:t.activeDate||(i.activeDate=new Date),t.setConfig(i)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let r=e.value;if(r){const{min:t,max:i,validateDateOnly:n}=e;if(n&&(r=b.clearTime(r,!1)),t&&r<t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(i&&r>i)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){const r=this;return e!=null&&(b.isDate(e)||(typeof e=="string"?e=b.parse(e,r.format,r.strictParsing)||b.parse(e,r.fallbackFormat,r.strictParsing):e=new Date(e)),b.isValidDate(e))?(!r.min||e-r.min>-b.MS_PER_DAY)&&(!r.max||e<=r.max)?r.transformTimeValue(e):e:null}transformTimeValue(e){const r=this,{keepTime:t}=r;if(e=b.clone(e),!t)b.clearTime(e,!1);else if(t!=="entered"){const i=b.parse(t,r.timeFormat);b.isValidDate(i)?b.copyTimeValues(e,i):b.isValidDate(r.value)&&b.copyTimeValues(e,r.value)}else r._isPickerInput&&b.isValidDate(r.value)&&b.copyTimeValues(e,r.value);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:r,_picker:t}=this;r&&(e==null?r.removeAttribute("min"):r.min=e),t&&(t.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:r,_picker:t}=this;r&&(e==null?r.removeAttribute("max"):r.max=e),t&&(t.maxDate=e),this.syncInvalid()}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:b.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,r){const t=this,i=t.transformDateValue(e);if(e&&!i){t.setError("L{invalidDate}");return}if(t.clearError("L{invalidDate}"),t.hasChanged(r,i))return super.changeValue(i,r);t.inputting||t.syncInputFieldValue()}updateValue(e,r){const t=this._picker;t&&!this.inputting&&(t.value=t.activeDate=e),super.updateValue(e,r)}changeStep(e,r){const t=typeof e;if(!e)return null;if(t==="number"?e={magnitude:Math.abs(e),unit:r?r.unit:"day"}:t==="string"&&(e=b.parseDuration(e)),e&&e.unit&&e.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,r){return e!=null&&e.getTime&&(r!=null&&r.getTime)&&this.keepTime!=="entered"?!b.isEqual(b.clearTime(e),b.clearTime(r)):super.hasChanged(e&&e.getTime(),r&&r.getTime())}get inputValue(){const e=this.value;return e?b.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),e.key==="Enter"&&this.isValid&&this.picker.hide()}};us.initClass(),us._$name="DateField";var rf=class extends $e{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const r=this;r.input.addEventListener("dblclick",()=>{r.select()}),typeof r.changeOnSpin=="number"&&(r.bufferedSpinChange=r.buffer(r.triggerChange,r.changeOnSpin))}acceptValue(e,r){let t=!isNaN(e);if(t&&!this.hasTextSelection){t=!1;const i=this.input.value,n=parseFloat(i);i!==r&&(t=!this.acceptValue(n,i))}return t}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if(e.type==="keydown"){const r=this,t=e.key;let i;if(t==="ArrowUp")r.doSpinUp(e.shiftKey),i=!0;else if(t==="ArrowDown")r.doSpinDown(e.shiftKey),i=!0;else if(!e.altKey&&!e.ctrlKey&&t&&t.length===1){const n=r.getAfterValue(t),s=r.formatter.parseStrict(n);i=!(s===r.value||n==="-"&&(isNaN(r.min)||r.min<0))&&!r.acceptValue(s,n)}t==="Enter"&&r._changedBySilentSpin&&(r.triggerChange(e,!0),r._changedBySilentSpin=!1),i&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const r=this;if(r.readOnly)return;let t=(r.value||0)+(e?r.largeStep:r.step);r.okMin(t)||(t=r.min),r.okMax(t)&&r.applySpinChange(t)}doSpinDown(e=!1){const r=this;if(r.readOnly)return;let t=(r.value||0)-(e?r.largeStep:r.step);r.okMax(t)||(t=r.max),r.okMin(t)&&r.applySpinChange(t)}applySpinChange(e){const r=this;r._isUserAction=!0,r.changeOnSpin!==!0&&(r._changedBySilentSpin=!0,r.silenceChange=!0,r.bufferedSpinChange&&r.bufferedSpinChange(null,!0)),r.value=e,r._isUserAction=!1,r.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var r,t,i;super.onFocusOut(...arguments);const n=this,{input:s}=n,a=s.value,o=n.formatter.truncate(a),l=isNaN(o)?a:n.formatValue(o);(i=(t=(r=n.triggers)==null?void 0:r.spin)==null?void 0:t.clickRepeater)==null||i.cancel(),a!==l&&(s.value=l),n._changedBySilentSpin&&(n.triggerChange(e,!0),n._changedBySilentSpin=!1)}internalOnInput(e){const r=this,{formatter:t,input:i}=r,{parser:n}=t,s=i.value,a=n.decimalPlaces(s);if(t.truncator&&a){let o=s;const l=t.truncate(s);if(!isNaN(l)&&(o=r.formatValue(l),n.decimalPlaces(o)<a)){const c=s.length-r.caretPos;i.value=o,r.caretPos=o.length-c}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const r=this;if(e===""){const{leadingZeroes:t,decimalPrecision:i}=r;e=t?`${t}>9`:null,i!=null?e=`${e||""}9.${"#".repeat(i)}`:e&&(e+=".*")}return e}get formatter(){const e=this,r=e.format;let t=e._formatter;return(!t||e._lastFormat!==r)&&(t=lr.get(e._lastFormat=r),e._formatter=t),t}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||this.step*10}get validity(){const e=this.value,r={};return e!=null&&(r.rangeUnderflow=!this.okMin(e),r.rangeOverflow=!this.okMax(e)),r.valid=!r.rangeUnderflow&&!r.rangeOverflow,r}changeValue(e,r){const t=this;if(e||e===0){let i;typeof e!="number"&&(e=typeof e=="string"?t.formatter.parse(e):Number(e),i=isNaN(e),i&&(e="")),!i&&t.format&&(e=t.formatter.round(e))}else e=void 0;return super.changeValue(e,r)}get inputValue(){let e=this.value;return e!=null&&this.format&&(e=this.formatValue(e)),e}};rf.initClass(),rf._$name="NumberField";var ro=class extends yt{static get $name(){return"TimePicker"}static get type(){return"timepicker"}construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){!this.isConfiguring&&!this.isRefreshing&&(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm=e.ref==="pmButton",this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var r;const t=this;switch(e.key){case"Escape":t.triggerTimeChange(t._initialValue),t.hide(),e.preventDefault();return;case"Enter":t.value=t.pickerToTime(),t.hide(),e.preventDefault();return}(r=super.onInternalKeyDown)==null||r.call(this,e)}pickerToTime(){const e=this,r=e._pm,{hour:t,minute:i,second:n}=e.widgetMap;t.format=e._is24Hour?"2>9":null;let s=t.value,a=new Date(e.value);return e._is24Hour||(r&&s<12&&(s=s+12),!r&&s===12&&(s=0)),a.setHours(s),a.setMinutes(i.value),e.seconds&&a.setSeconds(n.value),e._min&&(a=b.max(e._min,a)),e._max&&(a=b.min(e._max,a)),a}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){return e&&(e=typeof e=="string"?b.parse(e,this.format):e),this.isVisible||(this._initialValue=e),e!=null?e:b.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=b.is24HourFormat(e),this.refresh()}changeMin(e){return typeof e=="string"?b.parse(e,this.format):e}changeMax(e){return typeof e=="string"?b.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:r,minute:t,second:i,amButton:n,pmButton:s}=e.widgetMap,a=e.value,o=e._is24Hour,l=a.getHours(),c=e._pm=l>=12;e.element.classList[o?"add":"remove"]("b-24h"),r.min=o?0:1,r.max=o?23:12,r.value=o?l:l%12||12,t.value=a.getMinutes(),i.value=a.getSeconds(),n.pressed=!c,s.pressed=c,n.hidden=s.hidden=o,e.isRefreshing=!1}}};R(ro,"configurable",{floating:!0,items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),ro.initClass(),ro._$name="TimePicker";var io=class extends ls{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,r){const t=this;return ro.reconfigure(r,e,{owner:t,defaults:{value:t.value,forElement:t[t.pickerAlignElement],owner:t,align:{anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},onTimeChange({time:i}){t._isUserAction=!0,t.value=i,t._isUserAction=!1}}})}onBackClick(){const e=this,{min:r}=e;if(!e.readOnly&&e.value){const t=b.add(e.value,-1*e.step.magnitude,e.step.unit);(!r||r.getTime()<=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:r}=e;if(!e.readOnly&&e.value){const t=b.add(e.value,e.step.magnitude,e.step.unit);(!r||r.getTime()>=t)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let r=e.value;if(r){if(r=r.getTime(),e._min&&e._min.getTime()>r)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,r){return e!=null&&e.getTime&&(r!=null&&r.getTime)?e.getHours()!==r.getHours()||e.getMinutes()!==r.getMinutes()||e.getSeconds()!==r.getSeconds()||e.getMilliseconds()!==r.getMilliseconds():super.hasChanged(e,r)}showPicker(){const e=this,{picker:r,value:t}=e;e.readOnly||(r.value=t,r.format=e.format,r.maxTime=e.max,r.minTime=e.min,t||(e.value=r.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=(e=this.pickerKeyDownRemover)==null?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return e!=null&&(typeof e=="string"?(e=b.parse(e,this.format),this.keepDate&&(e=b.copyTimeValues(new Date(this.value),e))):e=new Date(e),b.isValidDate(e))?this.keepDate?e:b.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:r}=this;r&&(e==null?r.removeAttribute("min"):r.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:r}=this;r&&(e==null?r.removeAttribute("max"):r.max=e),this.syncInvalid()}changeValue(e,r){const t=this,i=t.transformTimeValue(e);if(e&&!i||t.isRequired&&e===""){t.setError("L{invalidTime}");return}if(t.clearError("L{invalidTime}"),t.hasChanged(r,i))return super.changeValue(i,r);t.inputting||t.syncInputFieldValue(!0)}updateValue(e,r){const{expand:t}=this.triggers;t&&e&&(t.element.firstElementChild.style.animationDelay=-((e.getHours()*60+e.getMinutes())/10)+"s"),super.updateValue(e,r)}changeStep(e,r){const t=typeof e;if(!e)return null;if(t==="number"?e={magnitude:Math.abs(e),unit:r?r.unit:"hour"}:t==="string"&&(e=b.parseDuration(e)),e!=null&&e.unit&&(e!=null&&e.magnitude))return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return b.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}};io.initClass(),io._$name="TimeField";var nf=new Date(2e3,0,1),Ji=class extends $e{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const r=this,t=io.new({revertOnEscape:r.revertOnEscape,syncInvalid(...i){const n=r.updatingInvalid;io.prototype.syncInvalid.apply(this,i),r.timeField&&!n&&r.syncInvalid()}},e);return j.on({element:t.element,keydown:"onTimeFieldKeyDown",thisObj:r}),r.readOnly&&(t.readOnly=!0),t}updateTimeField(e){const r=this;e.ion({change({userAction:t,value:i}){if(t&&!r.$settingValue){const n=r.dateField.value;r._isUserAction=!0,r.value=n?b.copyTimeValues(n,i||nf):null,r._isUserAction=!1}},thisObj:r})}changeDateField(e){const r=this,t=(e==null?void 0:e.type)||"datefield",i=$.resolveType(e.type||"datefield"),n=$.create(T.assign({type:t,revertOnEscape:r.revertOnEscape,syncInvalid(...s){const a=r.updatingInvalid;i.prototype.syncInvalid.apply(this,s),r.dateField&&!a&&r.syncInvalid()}},e));return j.on({element:n.element,keydown:"onDateFieldKeyDown",thisObj:r}),r.readOnly&&(n.readOnly=!0),n.ion({keydown:({event:s})=>{var a;s.key==="Tab"&&!s.shiftKey&&((a=this.timeField)!=null&&a.isVisible)&&(s.stopPropagation(),s.cancelBubble=!0)}}),n}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const r=this;e.ion({change({userAction:t,value:i}){t&&!r.$isInternalChange&&(r._isUserAction=!0,r.timeField.value?i&&b.copyTimeValues(i,r.timeField.value||nf):r.timeField.value=i,r.value=i,r._isUserAction=!1)},thisObj:r})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var r,t;return typeof e=="number"?e:(t=(r=this.dateField)==null?void 0:r.weekStartDay)!=null?t:b.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const r=this,{dateField:t,timeField:i}=r,n=t.highlightExternalChange,s=i.highlightExternalChange;!e&&!r.highlightExternalChange&&(e=!0),r.$isInternalChange=!0,t.highlightExternalChange=!1,t.value=null,t.highlightExternalChange=n,e&&(i.highlightExternalChange=t.highlightExternalChange=!1),i.value=t.value=r.inputValue,t.highlightExternalChange=n,i.highlightExternalChange=s,r.$isInternalChange=!1,r.syncInvalid()}onTimeFieldKeyDown(e){const r=this;if(e.key==="Enter"||e.key==="Tab"){const t=r.dateField.value;r._isUserAction=!0,r.value=t?b.copyTimeValues(t,r.timeField.value||nf):null,r._isUserAction=!1}}onDateFieldKeyDown(e){const r=this;e.key==="Tab"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),r.timeField.focus()):e.key==="Enter"&&(r.value=r.dateField.value)}updateRequired(e,r){this.timeField.required=this.dateField.required=e}updateReadOnly(e,r){super.updateReadOnly(e,r),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,r){return!b.isEqual(e,r)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,r){[this.dateField,this.timeField].forEach(t=>t.setError(e,r))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,r){[this.dateField,this.timeField].forEach(t=>t.clearError(e,r))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach(e=>e.updateInvalid()),this.updatingInvalid=!1}};R(Ji,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),R(Ji,"$name","DateTimeField"),R(Ji,"type","datetimefield"),R(Ji,"alias","datetime"),Ji.initClass(),Ji._$name="DateTimeField";var no=class extends Xi{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return typeof e=="string"?new Le(e):e}changeMax(e){return typeof e=="string"?new Le(e):e}changeAllowedUnits(e){return typeof e=="string"&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return this.value==null?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||no.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&this.decimalPrecision!=null?T.round(e,this.decimalPrecision):e}get allowDecimals(){return this.decimalPrecision!==0}get isValid(){const e=this,r=e.value==null||e.value&&e.value.magnitude==null;return super.isValid&&(r&&!e.required||!r&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const r=this,t=r.value,i=r._lastValue;r.hasChanged(i,t)&&(r._lastValue=t,r.triggerFieldChange({value:t,event:e,userAction:!0,valid:r.isValid}))}onFocusOut(e){var r,t,i;return this.syncInputFieldValue(!0),(i=(t=(r=this.triggers)==null?void 0:r.spin)==null?void 0:t.clickRepeater)==null||i.cancel(),super.onFocusOut(e)}set value(e){const r=this;let t,i;if(this.clearError("L{invalidUnit}"),typeof e=="number")t=e,i=r._unit;else if(typeof e=="string")if(/^\s*$/.test(e))t=null;else{const n=b.parseDuration(e,r.allowDecimals,r.unitWithDefault);n&&(!r.allowedUnitsRe||r.allowedUnitsRe.test(n.unit)?(i=n.unit,t=n.magnitude):r.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(i=e.unit,t=e.magnitude):(i=null,t=null);(r._magnitude!==t||r._unit!=i)&&(r._magnitude=t,i&&(r._unit=i),super.value=r.calcValue())}okMax(e){return typeof e=="number"&&(e=new Le({unit:this.unitWithDefault,magnitude:e})),this.max==null||e<=this.max}okMin(e){return typeof e=="number"&&(e=new Le({unit:this.unitWithDefault,magnitude:e})),this.min==null||e>=this.min}get validity(){const e=this.value,r={};return e!=null&&(r.rangeUnderflow=!this.okMin(e),r.rangeOverflow=!this.okMax(e)),r.valid=!r.rangeUnderflow&&!r.rangeOverflow,r}get value(){return super.value}calcValue(e=!1){const r=this;return(!r._unit||r._magnitude==null)&&r.clearable?null:new Le(e?this.roundMagnitude(r._magnitude):this._magnitude,r.unitWithDefault)}hasChanged(e,r){return r&&!e||!r&&e||r&&e&&!e.isEqual(r)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){e.key==="ArrowUp"?this.doSpinUp():e.key==="ArrowDown"&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let r=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(r)||(r=e.min),e.okMax(r)&&(e.value=r),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let r=(e.magnitude||0)-e.step;e.okMax(r)||(r=e.max),e.okMin(r)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}};no.initClass(),no._$name="DurationField";var so=class extends br{};R(so,"$name","Fit"),R(so,"type","fit"),R(so,"configurable",{containerCls:"b-fit-container",itemCls:"b-fit-item"}),so.initClass(),so._$name="Fit";var Qt=class extends yt{afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),j.on({element:e.element,keydown:"onKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide",thisObj:e}),He.ion({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&(e.syncInputFieldValue?e.syncInputFieldValue(!0):e instanceof $e)}render(e){const r=this.element.parentNode,[t]=this.getRenderContext(this,e);t.classList.add("b-editing"),super.render(...arguments),r!=null&&r.classList&&t!==r&&r.classList.remove("b-editing")}async startEdit(e){var r,t,i;const n=this;if(e=T.assignIf(e,{align:n.align,hideTarget:n.hideTarget,matchSize:n.matchSize,matchFont:n.matchFont,fitTargetContent:n.fitTargetContent,focus:!0}),n.trigger("beforeStart",e)!==!1){const{target:s,hideTarget:a,matchSize:o,matchFont:l,fitTargetContent:c,record:d,field:u=n.inputField.name,focus:h}=e,{inputField:f}=n,{input:g}=f,m=C.getStyleValue(s,"font-size"),p=C.getStyleValue(s,"font-family");let{value:v,align:y}=e;if(d&&u&&(n.record=d,n.dataField=u,v===void 0&&(v=d[u])),o&&(s instanceof HTMLElement&&n.updateSize(s,o),s instanceof HTMLElement&&Je.addResizeListener(s,n.onTargetSizeChange)),g&&(l?(g.style.fontSize=m,g.style.fontFamily=p):g.style.fontSize=g.style.fontFamily=""),n.assigningValues=!0,(r=f.clearError)==null||r.call(f),"setValue"in f?await f.setValue(v):f.value=v,n.assigningValues=!1,typeof y=="string"&&(y={align:y}),await n.showBy({target:s,allowTargetOut:!0,...y}),c){const D=g.scrollWidth-g.clientWidth;D>0&&(n.width+=D+C.scrollBarWidth)}h&&((t=f.focus)==null||t.call(f)),s.nodeType===Element.ELEMENT_NODE&&a&&s.classList.add("b-hide-visibility"),n.editing=!0;const S=f.value;return n.trigger("start",{value:S}),Array.isArray(S)&&f.editingRecords&&((i=S[0])!=null&&i.isModel)?n.oldValue=S.map(D=>D.copy(D.id)):(n.oldValue=S,Array.isArray(n.oldValue)&&(n.oldValue=n.oldValue.slice())),f.initialValue=n.oldValue,!0}return!1}async refreshEdit(){if(this.isVisible){const{record:e,dataField:r,inputField:t}=this;if(e&&r){const i=e[r];T.isEqual(t.value,i)||await t.setValue(i)}}}finishEdit(){const{target:e,aligningToElement:r}=this.lastAlignSpec;r&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("finishEdit")}onKeyDown(e){var r;const t=this;switch(e.key){case t.completeKey:t.completeEdit(null,e),e.stopImmediatePropagation();break;case t.cancelKey:t.cancelEdit(e),e.stopImmediatePropagation();break}(r=t.trigger)==null||r.call(t,"keydown",{event:e})}stopMouseEvents(e){this.allowMouseEvents||e.stopPropagation()}onFocusOut(e){super.onFocusOut(e);const r=this;if(!r.isFinishing&&r.editing)switch(r.blurAction){case"cancel":r.cancelEdit(e);break;case"complete":r.completeEdit(null,e)}}async completeEdit(e,r){var t,i,n,s;const a=this,{inputField:o,oldValue:l,record:c}=a,d=o.invalidAction||(o.allowInvalid===!1?"block":a.invalidAction),{value:u}=o;if(a.isVisible){if(!o.isValid&&d!=="allow"){if(d==="block")return(t=o.focus)==null||t.call(o),!1;if(d==="revert")return a.cancelEdit(r),!0}else{if(T.isEqual(u,l))return a.cancelEdit(r),!0;{const h={inputField:o,record:c,value:u,oldValue:l};if(a.trigger("beforeComplete",h)===!1)(i=o.focus)==null||i.call(o);else if(e||(e=h.finalize||((n=h.editorContext)==null?void 0:n.finalize)),e){let f=await e(h);if(f===!0)a.onEditComplete();else{if(o.setError){const g=f||o.invalidValueError,m=()=>{p(),o.clearError(g)},p=o.ion({change:m,input:m});o.setError(g)}d==="block"?(s=o.focus)==null||s.call(o):d==="revert"&&(await o.setValue(l),f=!0),f=!1}return f}else return a.onEditComplete(),!0}}return!1}}cancelEdit(e){var r;const t=this,{inputField:i,oldValue:n}=t,{value:s}=i;t.editing&&!t.isFinishing&&t.trigger("beforeCancel",{value:s,oldValue:n,event:e})!==!1&&((r=i.clearError)==null||r.call(i),t.isFinishing=!0,t.hide(),t.trigger("cancel",{value:s,oldValue:n,event:e}),t.finishEdit(),t.isFinishing=!1)}onEditComplete(){const e=this,{record:r,dataField:t,inputField:i,oldValue:n}=e,{value:s}=i;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),r){const a=`set${L.capitalize(t)}`;r[a]?r[a](s):t.includes(".")?r.set(t,s):r[t]=s}e.trigger("complete",{value:s,oldValue:n}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||$.fromElement(this.element.parentNode)}changeInputField(e,r){const t=this;return r&&r.destroy(),typeof e=="string"&&(e={type:e}),e instanceof $||(e=$.create(e),t.createdInputField=!0),t.completeOnChange&&e.ion({change:"onInputFieldChange",thisObj:t}),e.parent=t,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,r,t){r&&t&&this.updateSize(e)}updateSize(e,r=this.lastMatchSize){const t=this,i=k.inner(e);t.width=r.width===!1?"auto":i.width-t.align.offset[0],t.height=r.height===!1?"auto":i.height,t.lastMatchSize=r}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){this.positioned&&this.element.remove(),Je.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}};R(Qt,"$name","Editor"),R(Qt,"type","editor"),R(Qt,"configurable",{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0}),Qt.initClass(),Qt._$name="Editor";var bS=["number","boolean","string","date","duration"],sf=e=>{var r;return((r=e.column)==null?void 0:r.type)==="duration"},CS="",te=class extends yt{static get $name(){return"FieldFilterPicker"}static get type(){return"fieldfilterpicker"}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${te.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${te.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:r,operatorPicker:t,caseSensitive:i}}=e;r.ion({select:"onPropertySelect",thisObj:e}),t.ion({select:"onOperatorSelect",thisObj:e}),i.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&r.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&t.setConfig(e.operatorFieldConfig),r.cls=e.allPropertyPickerClasses,t.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:r,caseSensitive:t}=this.widgetMap;return[e,r,...this.valueFields,t]}updateDisabled(e){this.allChildInputs.forEach(r=>r.disabled=e)}updateReadOnly(e){const{propertyPicker:r,operatorPicker:t}=this.widgetMap;this.allChildInputs.forEach(i=>i.readOnly=e),r.readOnly=r.readOnly||e,t.readOnly=t.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const r=e!=null?e:te.defaultOperators;return Object.keys(r).reduce((t,i)=>({...t,[i]:r[i].map(n=>({...n,text:this.L(n.text)}))}),{})}changeFields(e){let r=e;return Array.isArray(e)&&(re.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),r=H.keyBy(r,"name")),r}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes((e=this._filter)==null?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new J(`b-${te.type}-property`,(e=this.propertyFieldConfig)==null?void 0:e.cls,{[`b-${te.type}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new J(`b-${te.type}-operator`,(e=this.operatorFieldConfig)==null?void 0:e.cls,{[`b-${te.type}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:r,fieldType:t,_filter:{operator:i},onValueChange:n,filterValues:s,isMultiSelectValueField:a,operatorArgCount:o,getValueFieldConfig:l}=e,c=T.merge({},te.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!t||!i||o===0)return[];let d={type:"textfield",internalListeners:{change:n,input:n,thisObj:e},cls:r,dataset:{type:t},placeholder:e.L(c[a?"list":t])};return a?d={...d,type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(s),value:s!=null?s:[]}:["number","date","boolean"].includes(t)?d.type=`${t}field`:t==="duration"&&(d.type="durationfield"),l&&(d=e.callback(l,e,[e.filter,d])),a?[d]:H.populate(o,u=>[{type:"widget",tag:"div",cls:`b-${te.type}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},{...d,value:s[u]}]).flat().slice(1)}getUniqueDataValues(e=[]){var r;const t=this,{fieldType:i}=t;if(!t.store||!((r=t._filter)!=null&&r.property))return[];const{relatedDisplayField:n}=t.selectedField;let s,a;if(t.fieldIsRelation){const{foreignStore:o}=t.currentPropertyRelationConfig;n?(s=o.allRecords.reduce((l,c)=>(c.id!=null&&l.push({text:c[n],value:c.id}),l),[]),a=s.sort((l,c)=>t.sortStrings(l.text,c.text))):s=o.allRecords.map(l=>l.id)}else s=t.store.allRecords.map(o=>o[t._filter.property]);if(!a){s.push(...e);const o=H.unique(s.reduce((l,c)=>(c!=null&&String(c).trim()!==""&&(i==="date"?l.push(c.valueOf()):i==="duration"?l.push(c.toString()):l.push(c)),l),[]));i==="string"?a=o.sort(t.sortStrings):i==="duration"?a=o.map(l=>new Le(l)).filter(l=>l.isValid).sort(t.sortDurations):a=o.sort(t.sortNumerics),i==="date"?a=a.map(l=>{const c=new Date(l);return{text:b.format(c,t.dateFormat),value:l}}):i==="duration"&&(a=a.map(l=>l.toString()))}return a}sortStrings(e,r){return(e!=null?e:CS).localeCompare(r!=null?r:CS)}sortNumerics(e,r){return e-r}sortDurations(e,r){return e.valueOf()-r.valueOf()}get fieldType(){var e;return(e=this.selectedField)==null?void 0:e.type}get selectedField(){var e,r;return(r=this.fields)==null?void 0:r[(e=this._filter)==null?void 0:e.property]}get propertyOptions(){var e;return Object.entries((e=this.fields)!=null?e:{}).filter(([,r])=>bS.includes(r.type)||sf(r)).map(([r,{title:t}])=>({value:r,text:t!=null?t:r})).sort((r,t)=>r.text.localeCompare(t.text))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return!!this.currentPropertyRelationConfig}get currentPropertyRelationConfig(){var e,r;return(r=(e=this.store)==null?void 0:e.modelRelations)==null?void 0:r.find(({foreignKey:t})=>{var i;return t===((i=this._filter)==null?void 0:i.property)})}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=te.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var r;(r=this._store)==null||r.un(this),e==null||e.ion({refresh:"onStoreRefresh",thisObj:this})}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFieldRow:r}=e.widgetMap;r.removeAll(),r.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,r;const t=this,{fieldType:i,operatorArgCount:n,isMultiSelectValueField:s}=t,a=(e=t._filter)==null?void 0:e.operator,{caseSensitive:o}=t.widgetMap;o.hidden=i!=="string"||!a||s||n===0,o.checked=((r=t._filter)==null?void 0:r.caseSensitive)!==!1}onPropertySelect(e){var r;const t=this,{_filter:i}=t;i.property=((r=e.record)==null?void 0:r.data.value)||null,t.fieldType!==t._fieldType&&(i.operator=null,i.value=null),t._fieldType=i.type=t.fieldType,t.refreshOperatorPicker(),t.refreshValueFields(),t.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var r;const t=this,i=t.isMultiSelectValueField,n=this.operatorArgCount;t._filter.operator=((r=e.record)==null?void 0:r.data.value)||null,t.operatorArgCount!==n&&(t._filter.value=null),t.isMultiSelectValueField&&!i&&(t._filter.value=[]),t.refreshValueFields(),t.triggerChange()}triggerChange(){const{filter:e,isValid:r}=this;this.trigger("change",{filter:e,isValid:r})}onValueChange(){const e=this,{isMultiSelectValueField:r,fieldType:t,_filter:i}=e,n=this.valueFields.map(s=>s.value);r&&t==="date"?i.value=n[0].map(s=>new Date(s)):r&&t==="duration"?i.value=n[0].map(s=>new Le(s)):(t==="date"&&i.operator==="between"&&b.isValidDate(n[1])&&n[1].setHours(23,59,59,999),i.value=n.length===1?n[0]:n),e.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:r,property:t},operatorOptions:i}=this;e.items=i,e.value=r,e.hidden=t===null}populateUIFromFilter(e=!1){const r=this,{filterValues:t,widgetMap:{propertyPicker:i,operatorPicker:n},_filter:{property:s,operator:a,disabled:o},propertyOptions:l,operatorOptions:c,isMultiSelectValueField:d}=r;i.items=l,n.items=c,n.hidden=s===null;let u=e;i.value!==s&&(i.value=s,r.refreshOperatorPicker(),u=!0),n.value!==a&&(a===null||!n.items.find(({value:h})=>h===a)?n.clear():n.value=a,u=!0),u&&r.refreshValueFields(),r.refreshCaseSensitive(),r.valueFields.forEach((h,f)=>{d&&(h.value.length>0||t.length>0)?r.fieldType==="date"?h.value=t.map(g=>g==null?void 0:g.valueOf()):r.fieldType==="duration"?h.value=t.map(g=>g==null?void 0:g.toString()):h.value=t:f>=t.length?h.clear():h.value=t[f]}),r.allChildInputs.forEach(h=>h.disabled=r.disabled||o)}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFieldRow.queryAll(e=>["textfield","datefield","numberfield","durationfield","combo"].includes(e.type)))}get filterValues(){var e;return((e=this._filter)==null?void 0:e.value)==null?[]:H.asArray(this._filter.value)}onFilterChange(){const e=this,r=e.fieldType,t=r!==e._fieldType;e._fieldType=e._filter.type=r,e.populateUIFromFilter(t)}get operatorArgCount(){const{fieldType:e,filter:{operator:r},operatorArgCountLookup:t}=this;return e&&r?t[e][r]:1}get isValid(){const e=this,{filter:r,fieldType:t,filterValues:i,isMultiSelectValueField:n,operatorArgCount:s}=e,{operator:a}=r,o=s>0&&(r==null?void 0:r.value)==null;return t&&a&&!o&&(n&&i.length>0||i.length===s)&&i.every(l=>l!=null&&(t!=="duration"||l.isValid))}},hi=te;R(hi,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}}),R(hi,"defaultOperators",{string:[te.operators.empty,te.operators.notEmpty,te.operators["="],te.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},te.operators.isIncludedIn,te.operators.isNotIncludedIn],number:[te.operators.empty,te.operators.notEmpty,te.operators["="],te.operators["!="],te.operators[">"],te.operators["<"],te.operators[">="],te.operators["<="],te.operators.between,te.operators.notBetween,te.operators.isIncludedIn,te.operators.isNotIncludedIn],date:[te.operators.empty,te.operators.notEmpty,te.operators["="],te.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},te.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},te.operators.isIncludedIn,te.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[te.operators.empty,te.operators.notEmpty,te.operators["="],te.operators["!="],te.operators[">"],te.operators["<"],te.operators[">="],te.operators["<="],te.operators.between,te.operators.notBetween,te.operators.isIncludedIn,te.operators.isNotIncludedIn],relation:[te.operators.isIncludedIn,te.operators.isNotIncludedIn]}),R(hi,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{propertyAndOperator:{type:"container",layout:"box",items:{propertyPicker:{type:"combo",items:{},cls:`b-${te.type}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",items:{},cls:`b-${te.type}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}"}}},valueFieldRow:{type:"container",cls:`b-${te.type}-values`,items:{}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`b-${te.type}-case-sensitive`}},operators:te.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),R(hi,"buildOperatorArgCountLookup",e=>H.keyBy(Object.entries(e),([r])=>r,([,r])=>H.keyBy(r,({value:t})=>t,({argCount:t})=>t===void 0?1:t))),hi.initClass(),hi._$name="FieldFilterPicker";var hs=class extends ${compose(){const{text:e,html:r}=this;return{tag:"label",text:e,html:r}}};R(hs,"$name","Label"),R(hs,"type","label"),R(hs,"configurable",{text:null,localizableProperties:["text"]}),hs.initClass(),hs._$name="Label";var Qi=class extends yt{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:r}=e.widgetMap;r.ion({click:"addFilter",thisObj:e}),r.text=e.L(r.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}get someFiltersNotShown(){return this.store&&this.store.filters.count>this.filters.length}updateFields(e){this.widgetMap.pickers.childItems.forEach(r=>r.fields=e)}updateFilters(e,r){const t=this;r&&r.filter(i=>!e.find(n=>n.id===i.id)).forEach(i=>{var n;return(n=t.store)==null?void 0:n.removeFilter(i.id)}),e.forEach(i=>i.id=i.id||t.nextFilterId),t.widgetMap.pickers.items=(e==null?void 0:e.map(i=>t.getPickerRowConfig(i)))||[]}changeFilters(e){const{canManageFilter:r}=this;return e&&r?e.filter(t=>this.callback(r,this,[t])):e}updateStore(e){const r=this;r.detachListeners("store"),e&&(r.widgetMap.pickers.childItems.forEach(({widgetMap:{filterPicker:{filter:t,isValid:i}}})=>{e.removeFilter(t.id,!0),i&&e.addFilter(t,!0)}),e.filter(),r.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:r})),r.widgetMap.pickers.childItems.forEach(t=>t.store=e)}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e!=null?e:Qi.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach(r=>{var t;const i=e.canManage(r),{property:n,operator:s,value:a,id:o,disabled:l=!1,caseSensitive:c}=r;i&&n&&s&&!((t=e.filters)!=null&&t.find(d=>d.id===o))&&e.appendFilter({id:o,property:n,operator:s,value:a,disabled:l,caseSensitive:c})})}canManage(e){const r=this;return!r.canManageFilter||r.callback(r.canManageFilter,r,[e])===!0}getFilterPickerConfig(e){const r=this,{fields:t,store:i,disabled:n,readOnly:s,valueFieldCls:a,operators:o,limitToProperty:l,dateFormat:c,getFieldFilterPickerConfig:d}=r;return{type:r.constructor.childPickerType,fields:t!=null?t:r.getFieldsFromStore(i),filter:e,store:i,disabled:n,readOnly:s,propertyLocked:!!l,valueFieldCls:a,operators:o,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:r},flex:1,...d?r.callback(d,r,[e]):void 0}}getFieldsFromStore(e){var r,t;return Object.fromEntries((t=(r=e.fields)==null?void 0:r.map(({name:i,type:n})=>[i,{type:n}]))!=null?t:[])}getPickerRowConfig(e){const r=this,{disabled:t,readOnly:i,canDeleteFilter:n}=r;return{type:"container",layout:"box",layoutStyle:{alignItems:"start"},cls:`b-${Qi.type}-row`,dataset:{separatorText:r.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:t,readOnly:i,checked:!e.disabled,internalListeners:{change:"onFilterActiveChange",thisObj:r},cls:`b-${Qi.type}-filter-active`},filterPicker:r.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:t,readOnly:i,hidden:n&&r.callback(n,r,[e])===!1,cls:`b-transparent b-${Qi.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:r}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll(r=>e.includes(r.type))}updateDisabled(e){this.allInputs.forEach(r=>r.disabled=e)}updateReadOnly(e){this.allInputs.forEach(r=>r.readOnly=e)}onFilterActiveChange({source:e,checked:r}){const t=this,i=t.getFilterIndex(e),n=t.filters[i],s=t.getFilterPicker(i);n.disabled=!r,s.onFilterChange(),t.store&&s.isValid&&t.store.addFilter(n,!0),t.updateStoreFilter(),t.triggerChange()}onFilterPickerChange({source:e,filter:r,isValid:t}){const i=this,{store:n}=i,s=i.getFilterIndex(e);n&&(n.removeFilter(r.id,!0),t&&n.addFilter(r,!0),i.updateStoreFilter()),Object.assign(i.filters[s],r),i.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const r=this,t=r.getFilterIndex(e),i=r.filters[t],n=r.getPickerRow(t),s=r.query(a=>a.isFocusable&&a.type!=="container"&&!n.contains(a));s&&s.focus(),r.removeFilterAt(t),r.store&&(r.store.removeFilter(i.id,!0),r.updateStoreFilter()),r.trigger("remove",{filter:i}),r.triggerChange()}addFilter({property:e=null,operator:r=null,value:t=null}={}){var i;const n=this,{filters:s}=n,a={property:n.limitToProperty||e,operator:r,value:t,disabled:!1,id:n.nextFilterId,caseSensitive:!1};n.appendFilter(a),n.getFilterPicker(s.length-1).isValid&&((i=n.store)==null||i.addFilter(a,!0),n.store&&n.updateStoreFilter()),n.trigger("add",{filter:a}),n.triggerChange()}appendFilter(e){const r=this;(!r.limitToProperty||e.property===r.limitToProperty)&&(r.filters.push(e),r.widgetMap.pickers.add(r.getPickerRowConfig(e,r.filters.length-1)))}onStoreFilter(e){const r=this;if(r._isUpdatingStore)return;const{filters:t}=e,i=t.values.reduce((n,s)=>({...n,[s.id]:s}),{});for(let n=r.filters.length-1;n>=0;n--){const s=r.filters[n],a=i[s.id],o=r.getPickerRow(n);if(o){const{filterPicker:l,activeCheckbox:c}=o.widgetMap;if(!a&&l.isValid)r.removeFilterAt(n);else if(a!==void 0){const{operator:d,value:u,property:h,disabled:f,caseSensitive:g}=a;s!==a&&Object.assign(s,{operator:d,value:u,property:h,disabled:f,caseSensitive:g}),l.filter=s,l.onFilterChange(),c.checked=!f}}}r.appendFiltersFromStore(),r.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:r},filters:t}=this;r.remove(r.childItems[e]),t.splice(e,1),this.triggerChange()}updateStoreFilter(){var e;this._isUpdatingStore=!0,(e=this.store)==null||e.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){const{filters:e}=this,r=e.filter((t,i)=>this.getPickerRow(i).widgetMap.filterPicker.isValid);this.trigger("change",{filters:e,validFilters:r})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const r=this,{_filters:t,store:i}=r;t.forEach((n,s)=>{if(e===n.disabled){const{filterPicker:a,activeCheckbox:o}=r.getPickerRow(s).widgetMap;n.disabled=!e,a.onFilterChange(),o.checked=e,e&&i&&a.isValid&&i.addFilter(n,!0)}}),r.updateStoreFilter()}},en=Qi;R(en,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),R(en,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:Qi.addFilterButtonDefaultText,cls:`b-${Qi.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),R(en,"childPickerType","fieldfilterpicker"),en.initClass(),en._$name="FieldFilterPickerGroup";var Ec=class extends Nt.mixin(Xh){static get $name(){return"FieldSet"}static get type(){return"fieldset"}static get configurable(){return{bodyTag:"fieldset",focusable:!1,inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:r}=e,{inlineInternal:t,hasLabel:i,title:n}=this;return delete e.html,r["b-inline"]=t,r["b-fieldset-has-label"]=i,n&&(e.children={legendElement:{tag:"legend",text:n,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:r,labelCls:t,labelWidth:i}=this;return{class:{"b-field":r,"b-vbox":!e},children:{"labelElement > headerElement":(r||null)&&{tag:"label",html:r,class:{"b-label":1,"b-align-start":1,[t]:t},style:{width:C.unitize("width",i)[1]}}}}}syncInlineInternal(){var e;this.inlineInternal=(e=this.inline)!=null?e:this.label!=null&&this.labelPosition==="before"}updateDisabled(e,r){super.updateDisabled(e,r),this.eachWidget(t=>{t.disabled=e},!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}};Ec.initClass(),Ec._$name="FieldSet";var af=class extends $e{static get $name(){return"FileField"}static get type(){return"filefield"}static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}};af.initClass(),af._$name="FileField";var of=class extends yt{static get $name(){return"FilePicker"}static get type(){return"filepicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const r=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),r.button.ion({click:r.onButtonClick,thisObj:r}),r.fileField.ion({change:r.onFileFieldChange,thisObj:r}),r._thisIsAUsedExpression(r.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new ue({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow(){const r=this,t=e.files;return t&&t.length?(r.html=`${Array.from(t).map(i=>i.name).join("<br>")}`,!0):!1}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const r=this;r.button.badge=r.files.length||"",r.triggerFieldChange({files:r.files,valid:e})}};of.initClass(),of._$name="FilePicker";var lf=class extends Xi{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,revertOnEscape:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:r,field:t,filterFunction:i}=this;if(r){const n=`${t||this.id}-Filter`;if(e.length===0)r.removeFilter(n);else{let s;i?s=a=>i(a,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=a=>{var o;return(o=a.get(t))==null?void 0:o.match(new RegExp(e,"i"))}),r.filter({id:n,filterBy:s})}}}}}updateValue(e,r){super.updateValue(e,r),e&&this.isConfiguring&&this.onChange({value:e})}};lf.initClass(),lf._$name="FilterField";var SS=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];Y.isWindows&&SS.reverse();var cf=class extends st{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"\xA0",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:SS}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const r=this.widgetMap.input;return $.reconfigure(r,e),r.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:r="",title:t="\xA0",cancelButton:i,okButton:n,rootElement:s=document.body}){const a=this;return a.rootElement=s,a.getConfig("lazyItems"),a.title=a.optionalL(t),a.widgetMap.message.html=a.optionalL(r),a.showClass=`b-messagedialog-${e}`,n&&(n=typeof n=="string"?{text:n}:n),i&&(i=typeof i=="string"?{text:i}:i),n=Object.assign({},a.widgetMap.okButton.initialConfig,n),i=Object.assign({},a.widgetMap.cancelButton.initialConfig,i),n.text=a.optionalL(n.text),i.text=a.optionalL(i.text),$.reconfigure(a.widgetMap.okButton,n),$.reconfigure(a.widgetMap.cancelButton,i),a.show(),a.promise=new Promise(o=>{a.resolve=o})}show(){const e=C.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:cf.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,r){const{classList:t}=this.element;r&&t.remove(r),e&&t.add(e)}doResolve(e){const r=this,{resolve:t}=r;if(t){const i=r.showClass==="b-messagedialog-prompt";if(i&&e===r.okButton&&!r.widgetMap.input.isValid)return;r.resolve=r.reject=r.promise=null,t(i?{button:e,text:r.widgetMap.input.value}:e),r.hide()}}onInternalKeyDown(e){e.key==="Escape"&&(e.stopImmediatePropagation(),this.onCancelClick()),e.key==="Enter"&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(df.okButton)}onCancelClick(){this.doResolve(df.cancelButton)}};cf.initClass();var df=new Proxy({},{get(e,r){const t=e.instance||(e.instance=new cf({rootElement:document.body})),i=t[r];return typeof i=="function"?i.bind(t):i}}),fi=df,uf=class extends Jn{static get $name(){return"PagingToolbar"}static get type(){return"pagingtoolbar"}static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const r=this;r.detachListeners("store"),r._store=e,e&&(e.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:r}),e.isLoading&&r.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget(e=>e.disable())}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:r,dataSummary:t}=e.widgetMap;let i=0,n=0,s=0,a=0,o=0;if(e.store){const{store:l}=e,{pageSize:c,currentPage:d}=l;i=l.count,n=l.lastPage,o=l.allCount,s=Math.max(0,(d-1)*c+1),a=Math.min(o,s+c-1)}r.html=e.L("L{pageCountTemplate}")({lastPage:n}),t.html=i?e.L("L{summaryTemplate}")({start:s,end:a,allCount:o}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:r,store:t}=e,{count:i,lastPage:n,currentPage:s}=t,{pageNumber:a,pageCount:o,firstPageButton:l,previousPageButton:c,nextPageButton:d,lastPageButton:u,dataSummary:h}=r;e.eachWidget(f=>f.enable()),a.value=s,a.max=n,h.disabled=a.disabled=o.disabled=!i,l.disabled=c.disabled=s<=1||!i,d.disabled=u.disabled=s>=n||!i,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}};uf.initClass(),uf._$name="PagingToolbar";var{dockIsHorz:uP}=zi.maps,hP={top:0,down:0,left:1,bottom:2,up:2,right:3},hf={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}},ff=class extends zi.mixin(ge){static get $name(){return"PanelCollapserOverlay"}static get type(){return"overlay"}static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;(e=this.collapsible)==null||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:r}=this;(r.suspended=e==null||e<0)||(r.delay=e,r.immediate=!e)}changeRecollapseTool(e){const r=this,{panel:t}=r;if(r.isConfiguring||r.isDestroying||!t||t.isDestroying)return e;t.tools={recollapse:e}}beforeCollapse(e){if(super.beforeCollapse(e)===!1)return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,r=!0){var t;(t=this.panel)==null||t.recompose(),super.applyHeaderDock(e,r)}collapseBegin(e){const r=this,{collapseDir:t,innerElement:i}=r,{animation:n}=e,{collapseTool:s,panel:a}=r;r.configuredWidth=a._lastWidth,r.configuredHeight=a._lastHeight,r.applyHeaderDock(!0),r.lockInnerSize(),s==null||s.element.classList.add("b-collapsed"),n&&(a.element.classList.add("b-collapsing"),n.element=i,n.transform=hf[t],e.animation=_e.run(n))}onComplete(e){var r,t;super.onComplete(e);const i=this,{panel:n}=i,{element:s}=n;i.autoCloseLeaveDetacher=(r=i.autoCloseLeaveDetacher)==null?void 0:r.call(i),i.autoCloseClickDetacher=(t=i.autoCloseClickDetacher)==null?void 0:t.call(i),i.doAutoClose.cancel(),e==="reveal"&&i.autoClose&&(n.containsFocus&&(i.autoCloseLeaveDetacher=j.on({element:s,mouseenter:a=>{i.doAutoClose.cancel()},mouseleave:a=>{i.doAutoClose()}})),i.autoCloseClickDetacher=j.on({element:document.body,thisObj:n,mousedown:a=>{var o;!n.owns(a)&&!((o=i.revealer)!=null&&o.contains(a.target))&&i.autoCloseDelay!=null&&i.doAutoClose.now()}}))}expandBegin(e){const r=this,{animation:t}=e,{collapseDir:i,collapseTool:n,innerElement:s,panel:a}=r,{element:o}=a;o.classList.remove("b-collapsed","b-collapsing"),r.restoreConfiguredSize(),r.lockInnerSize(!1),r.lockInnerSize(),n==null||n.element.classList.remove("b-collapsed"),t&&(o.classList.add("b-collapsed","b-expanding"),t.element=s,t.transform={from:hf[i].to,to:hf[i].from},e.animation=_e.run(t))}expandEnd(e){super.expandEnd(e);const{panel:r}=this;e.completed&&(r.revealed=!1),r.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const e=this,{direction:r}=e,t=super.toolsConfig,i=e.recollapseTool;return i?{...t,recollapse:i&&T.assign({direction:r.toLowerCase()},i)}:t}lockInnerSize(e=!0){const r=this,{panel:t}=r,i=e&&t.rectangle(),n=e?[0,0,0,0]:"",s=super.lockInnerSize(e);return e&&(n[hP[r.collapseDir]]=`-${i[r.collapseDim]+10}px`),t.element.style.clipPath=e?`inset(${n.join(" ")})`:"",s}onOverlayTransitionDone(e){const r=this,{panel:t}=r;e.srcElement===t.overlayElement&&r.revealing&&(r.revealing=!1,r.onComplete(t.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}toggleReveal(e){const{panel:r}=this,{element:t}=r;r.collapsed&&(this.revealer=C.getActiveElement(t),e==null&&(e=!r.revealed),r.revealed!==e&&r.trigger("beforeToggleReveal",{reveal:e})!==!1&&(!e&&t.contains(this.revealer)&&r.revertFocus(!0),this.revealing=!0,r.revealed=e))}updateRevealing(e){const r=this,t=/left|right/i,{panel:i}=r,n=t.test(r.collapseDir)?"height":"width";i&&(r.innerElement.style[n]="0px",r.innerElement.style[`min-${n}`]="100%",i.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,r){var t;const i=this,{collapseDir:n,panel:s}=i,{expandedHeaderDock:a,header:o,uiClassList:l}=s,c=(t=s.tools)==null?void 0:t.recollapse,[d,u]=i.splitHeaderItems({as:"element",dock:i.collapseDock}),h=uP[a],f=s.hasHeader?s.title||(o==null?void 0:o.title)||"\xA0":null;return c&&(c.direction=n),["overlayElement",{class:{...l,[`b-panel-overlay-header-${a}`]:1,[`b-panel-overlay-${n}`]:1,[`b-${h?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1},listeners:{transitionend:g=>i.onOverlayTransitionDone(g)},children:{overlayHeaderElement:f&&{tag:"header",class:new J({...l,[`b-dock-${a}`]:1,"b-panel-header":1,"b-panel-overlay-header":1},o==null?void 0:o.cls),children:[...d,{reference:"overlayTitleElement",html:f,class:{...l,[`b-align-${(o==null?void 0:o.titleAlign)||"start"}`]:1,"b-header-title":1}},...u]},[e]:r}}]}};ff.initClass(),ff._$name="PanelCollapserOverlay";var gf=class extends $e{static get type(){return"passwordfield"}static get alias(){return"password"}static get $name(){return"PasswordField"}construct(e={}){e.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}};gf.initClass(),gf._$name="PasswordField";var mf=class extends Zi{static get $name(){return"Radio"}static get type(){return"radio"}static get alias(){return"radiobutton"}static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){super.internalOnClick(e)!==!1&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}};mf.initClass(),mf._$name="Radio";var xc=class extends Ec{static get $name(){return"RadioGroup"}static get type(){return"radiogroup"}static get configurable(){return{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}}get existingOptions(){const{name:e}=this;return this.ensureItems().filter(r=>r.name===e)}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter(e=>e.input.checked)[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach(r=>{r.isConfiguring=this.isConfiguring,r.checked=r.checkedValue===e,r.isConfiguring=!1})}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,r){if(!(e&&r&&T.isDeeplyEqual(r,e)))return e}convertOption(e,r,t){const i=this,{name:n}=i,s={name:n,type:"radio",value:e===i.value,ref:`${i.refPrefix}${e}`,checkedValue:e};return typeof r=="string"?s.text=r:T.assign(s,r),t?$.reconfigure(t,s):s}isOurRadio(e){return e.isRadio&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onRadioItemBeforeChange",change:"onRadioItemChange",click:"onRadioClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onRadioClick(e){const{source:r}=e;r.checked&&this.clearable&&r.clearable==null&&(r.checked=!1)}onRadioItemBeforeChange(e){if(e.checked){const r=this,{lastValue:t}=r;if(!r.reverting&&r.trigger("beforeChange",r.wrapRadioEvent(e))===!1&&t!=null&&t!==r.value)return r.reverting=!0,e.source.uncheckToggleGroupMembers(),r.value=t,r.lastValue=t,r.reverting=!1,!1}}onRadioItemChange(e){const r=this;e.checked&&!r.reverting&&(r.triggerFieldChange(r.wrapRadioEvent(e)),r.lastValue=r.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:r,refPrefix:t}=e,i=e.existingOptions.reduce((l,c)=>(l[c.ref.substring(t.length)]=c,l),{});let n=0,s,a;if(r)for(s in r)a=e.convertOption(s,r[s],i[s]),delete i[s],e.insert(a,n++);const o=Object.values(i);o!=null&&o.length&&(e.remove(o),o.forEach(l=>l.destroy()))}};xc.initClass(),xc._$name="RadioGroup";var fP={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1},pf=class extends ${static get $name(){return"Slider"}static get type(){return"slider"}static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value"}}compose(){const{id:e,min:r,max:t,showValue:i,step:n,text:s,value:a,unit:o="",disabled:l}=this,c=`${e}-input`,d=!!(s||i);return{class:{"b-has-label":d,"b-text":d,"b-disabled":l},children:{input:{tag:"input",type:"range",id:c,reference:"input",disabled:l,min:r,max:t,step:n,value:a,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},label:{tag:"label",for:c,html:i?s?`${s} (${a}${o})`:a+o:s}}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(e){!this.readOnly&&fP[e.key]&&e.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const e=this;if(e.readOnly){e.input.value=e.value;return}e.value=parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e)}onInternalMouseOver(){var e;const r=this,t=r.rtl?100-r.percentProgress:r.percentProgress;(e=r.tooltip)==null||e.showBy({target:k.from(r.input).inflate(r.thumbSize/2,-r.thumbSize/2),align:`b-t${Math.round(t)}`})}onInternalMouseOut(){var e;(e=this.tooltip)==null||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const r=this;r.input&&r._value>e&&(r.value=e,r.trigger("input",{value:r.value}))}updateMin(e){const r=this;r.input&&r._value<e&&(r.value=e,r.trigger("input",{value:r.value}))}changeTooltip(e,r){var t;return e&&(e.owner=this),this.showTooltip?ue.reconfigure(r,e,{owner:this,defaults:{forElement:this.input,html:String(this.value)+((t=this.unit)!=null?t:"")}}):null}changeValue(e){const r=this,{min:t,step:i}=r;return e=Math.min(Math.max(e,t),r.max),e>t?t+T.roundTo(e-t,i):T.roundTo(e,i)}updateValue(e){var r;const t=this,{input:i,_tooltip:n}=t;n&&(n.html=t.value+((r=t.unit)!=null?r:"")),i&&i.value!==String(e)&&(i.value=e,t.triggerChange(!1)),t.updateUI()}updateUI(){var e,r;const t=this;(e=t._tooltip)!=null&&e.isVisible&&((r=t._tooltip)==null||r.alignTo({target:k.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:`b-t${Math.round(t.percentProgress)}`}))}};pf.initClass(),pf._$name="Slider";var vf=class extends Zi{static get $name(){return"SlideToggle"}static get type(){return"slidetoggle"}static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){e!=null&&e.checked&&(e.cls=(e.cls||"")+" "+this.constructor.properties.toggledCls),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}};vf.initClass(),vf._$name="SlideToggle";var wS=["b-horizontal","b-vertical"],yf=e=>C.getStyleValue(e.parentElement,"display")==="flex"&&(parseInt(C.getStyleValue(e,"flex-basis"),10)||parseInt(C.getStyleValue(e,"flex-grow"),10)),gP={horizontal:!1,vertical:!0},bf=class extends ${static get $name(){return"Splitter"}static get type(){return"splitter"}static get configurable(){return{orientation:"auto",vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var e;(e=this.mouseDetacher)==null||e.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:{pointerdown:"onMouseDown",mouseenter:"syncState",...!Y.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"}}}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}getSibling(e=!0){let{element:r}=this,t;for(;!t&&(r=r[`${e?"next":"previous"}ElementSibling`]);)(!r.isConnected||C.isVisible(r))&&(t=r);return t}get nextWidget(){let{element:e}=this,r;for(;!r&&(e=e.nextElementSibling);)r=$.fromElement(e,1);return r}get previousWidget(){let{element:e}=this,r;for(;!r&&(e=e.previousElementSibling);)r=$.fromElement(e,1);return r}updateContainerElement(e){var r;const t=this;t.stateDetector=(r=t.stateDetector)==null?void 0:r.disconnect(),e&&(t.stateDetector=new MutationObserver(()=>t.syncState()),t.stateDetector.observe(e,{attributes:!0,childList:!0}))}updateNextNeighbor(e){this.watchNeighbor(e,"next")}updatePreviousNeighbor(e){this.watchNeighbor(e,"previous")}watchNeighbor(e,r){this.detachListeners(r),e==null||e.ion({name:r,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(e){var r;const t=(r=this.element)==null?void 0:r.classList;t==null||t.add(wS[e?1:0]),t==null||t.remove(wS[e?0:1])}syncState(){var e;const r=this,{element:t,nextWidget:i,previousWidget:n}=r;let s=(e=gP[r.orientation])!=null?e:null;if(r.nextNeighbor=i,r.previousNeighbor=n,r.disabled=i&&(i.collapsible&&i.collapsed||i.hidden)||n&&(n.collapsible&&n.collapsed||n.hidden),s!==null&&i&&n)r.containerElement=null;else if(r.containerElement=t.parentElement,r.rendered&&t.offsetParent){const a=C.getStyleValue(t.parentElement,"flex-direction");if(a)s=!a.startsWith("column");else{const o=t.previousElementSibling,l=t.nextElementSibling;if(!o||!l)return;const c=o.getBoundingClientRect(),d=l.getBoundingClientRect(),u=c.top<d.top?c:d,h=u===d?c:d;s=u.top===h.top}}r.vertical=s}onMouseDown(e){var r;e.preventDefault(),e.touches&&(e=e.touches[0]);const t=this,{element:i,nextNeighbor:n,previousNeighbor:s}=t,a=s?s.element:t.getSibling(!1),o=n?n.element:t.getSibling(),l=yf(a),c=yf(o),d=[];(r=t.mouseDetacher)==null||r.call(t);for(const h of i.parentElement.children)yf(h)&&h!==i&&d.push({element:h,width:h.offsetWidth,height:h.offsetHeight});t.context={startX:e.pageX,startY:e.pageY,prevWidth:a.offsetWidth,prevHeight:a.offsetHeight,nextWidth:o.offsetWidth,nextHeight:o.offsetHeight,prevHasFlex:l,nextHasFlex:c,flexed:d,prev:a,next:o};const u={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:t};Y.supportsPointerEvents||(u.mousemove=u.touchmove="onMouseMove",u.mouseup=u.touchend="onMouseUp"),i.classList.add("b-moving"),t.mouseDetacher=j.on(u)}onMouseMove(e){const r=this,{context:t,nextWidget:i,previousWidget:n}=r,s=t.prev.style,a=t.next.style,o=(e.pageX-t.startX)*(r.rtl?-1:1),l=e.pageY-t.startY;if(e.preventDefault(),Object.assign(t,{deltaX:o,deltaY:l}),t.started||(t.started=!0,r.trigger("dragStart",{context:t,event:e}),t.flexed.forEach(c=>{c.element.style.flexGrow=r.vertical?c.width:c.height,c.element.style.flexBasis="0"})),r.vertical){const c=t.prevWidth+o,d=t.nextWidth-o;t.prevHasFlex?s.flexGrow=c:n?n.width=c:s.width=`${c}px`,t.nextHasFlex?a.flexGrow=d:i?i.width=d:a.width=`${d}px`}else{const c=t.prevHeight+l,d=t.nextHeight-l;t.prevHasFlex?s.flexGrow=c:n?n.height=c:s.height=`${c}px`,t.nextHasFlex?a.flexGrow=d:i?i.height=d:a.height=`${d}px`}r.trigger("drag",{context:t,event:e})}onMouseUp(e){var r;const t=this;(r=t.mouseDetacher)==null||r.call(t),t.mouseDetacher=null,t.element.classList.remove("b-moving"),t.context.started&&t.trigger("drop",{context:t.context,event:e}),t.context=null}render(){super.render(...arguments),this.syncState.now(),this.vertical===null&&this.syncState()}};bf.initClass(),bf._$name="Splitter";var Rc=class extends Ya{static get $name(){return"Tab"}static get type(){return"tab"}static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",role:"tab"}}compose(){const{active:e,cls:r,index:t,isFirst:i,isLast:n}=this,s=this.owner.visibleChildCount;return{tabindex:0,"aria-selected":e,"aria-setsize":s,"aria-posinset":t+1,class:{"b-tabpanel-tab":1,"b-active":e,"b-tab-first":i,"b-tab-last":n,...r},dataset:{index:t}}}updateIndex(e){this.isFirst=!e}updateItem(e,r){var t,i;const n=this;(r==null?void 0:r.tab)===n&&(r.tab=null),e&&(e.tab=n,n[n.titleProperty]=e[n.titleSource],n.itemCls=e.cls,n.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),(t=n.itemChangeDetacher)==null||t.call(n),n.itemChangeDetacher=e&&Te.after(e,"onConfigChange","onItemConfigChange",n,{return:!1}),(i=n.itemHideDetacher)==null||i.call(n),n.itemHideDetacher=e==null?void 0:e.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:n,prio:1e3}),n.syncMinMax()}updateItemCls(e,r){const{element:t}=this,i=t&&J.from(t==null?void 0:t.classList,!0);t&&(i.remove(r).add(e),t.className=i.value)}updateRotate(e,r){!e!=!r&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:r,tabPanel:t}=e;let{_minWidth:i,_minHeight:n,_maxWidth:s,_maxHeight:a}=e;if(t){const{tabMinWidth:o,tabMaxWidth:l}=t;o!=null&&(r?(i===o&&(i=null),n=o):(n===o&&(n=null),i=o)),l!=null&&(r?(s===l&&(s=null),a=l):(a===l&&(a=null),s=l)),e.minWidth=i,e.minHeight=n,e.maxWidth=s,e.maxHeight=a}}onItemBeforeChangeHidden({source:e,hidden:r}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:t}=this;this.hidden=r,r&&e===t.activeItem&&t.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:r}){const{tabPanel:t}=this;this.disabled=r,e===t.activeItem&&t.activateAvailableTab(e)}onItemConfigChange({name:e,value:r}){e===this.titleSource&&(this[this.titleProperty]=r)}};Rc.initClass(),Rc._$name="Tab";var Tc=e=>e.isTab,Cf=class extends Jn{static get $name(){return"TabBar"}static get type(){return"tabbar"}static get configurable(){return{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(Tc)}get tabs(){return H.from(this._items,Tc)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,Tc)}onChildAdd(e){super.onChildAdd(e),e.index==null&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn(){const{activeIndex:e}=this.owner;isNaN(e)||this.tabs[e].focus()}syncTabs(){const{tabs:e}=this;for(let r=0,t=e.length;r<t;++r)e[r].index=r,e[r].isFirst=!r,e[r].isLast=r===t-1}tabAt(e){return this._items.find(Tc,e)||null}};Cf.initClass(),Cf._$name="TabBar";var Mc=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"],ao=class extends br{onChildAdd(e){super.onChildAdd(e);const r=this,{activeItem:t,owner:i}=r,n=i.activeIndex!=null?i.activeIndex:r.activeIndex||0,s=i.items.indexOf(e),a=t!=null?e===t:s===n;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:r}),a?(r._activeIndex=s,r._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const r=this;r._activeItem===e&&r.activateSiblingOf(e),r._activeIndex=r.owner.items.indexOf(r._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:r})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:r}=this,t=r.items.slice(),i=t.indexOf(e);t.splice(i,1),this.activeIndex=Math.min(i,t.length-1)}setActiveItem(e,r=this.activeIndex,t){var i;const n=this,{owner:s}=n,{items:a}=s,o=e instanceof $,l=a[r],c=s.items[e=o?a.indexOf(e):parseInt(e,10)],d=(t==null?void 0:t.animation)!==!1,u=!(t!=null&&t.silent),h={prevActiveIndex:r,prevActiveItem:l};if(c&&!c.$isActivating&&c!==l){const f=l&&l.element,g=c&&c.element;if(n.animateDetacher){const p=n.animateDetacher.event;if(p.activeItem===c)return p.promise;n.animateDetacher(),p.prevActiveItem.element.classList.remove(...Mc),p.activeItem.element.classList.remove(...Mc),n.animateDetacher=null}if(h.activeIndex=e,h.activeItem=c,u&&s.trigger("beforeActiveItemChange",h)===!1)return null;const m=n._activeIndex!==h.activeIndex;m&&(n._activeIndex=h.activeIndex),u&&((i=s.onBeginActiveItemChange)==null||i.call(s,h)),m&&(n._activeIndex=h.prevActiveIndex),d&&f&&s.isVisible&&n.animateCardChange?h.promise=n.cardChangeAnimation=new Promise((p,v)=>{const y=l.monitorResize;l.monitorResize=!1,n.contentElement.style.overflowX="hidden",l._hidden=!0,c.$isActivating=!0,c.show(),c.$isActivating=!1,f.classList.add(e>r?"b-slide-out-left":"b-slide-out-right"),g.classList.add(e<r?"b-slide-in-left":"b-slide-in-right"),s.isAnimating=!0,n.animateDetacher=j.onTransitionEnd({mode:"animation",element:g,thisObj:l,handler(){if(s.isAnimating=n.cardChangeAnimation=!1,!n.animateDetacher){n.setActiveItem(e,r,t);return}n.animateDetacher=null,g.classList.remove(...Mc),f&&(f.classList.remove(...Mc),l.$isDeactivating=!0,l._hidden=!1,l.hide(),l.monitorResize=y,l.$isDeactivating=!1),n.contentElement.style.overflowX="",n.onActiveItemChange(h,p,!u)}}),n.animateDetacher.reject=v,n.animateDetacher.event=h}):(c.$isActivating=!0,c.show(),c.focus(),c.$isActivating=!1,l&&(l.$isDeactivating=!0,l.hide(),l.$isDeactivating=!1),n.onActiveItemChange(h,null,!u))}return h}onActiveItemChange(e,r,t){const i=this;i._activeItem=e.activeItem,i._activeIndex=e.activeIndex,!t&&i.owner.trigger("activeItemChange",e),e.activeItem.focus(),r==null||r(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:r}=this;return r.isConfiguring&&!r._items?e:Math.min(e,r.items.length-1)}updateActiveIndex(e,r){this.owner.isConfiguring||this.setActiveItem(e,r)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return!!this.animateDetacher}};R(ao,"$name","Card"),R(ao,"type","card"),R(ao,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),ao.initClass(),ao._$name="Card";var Sf=class extends Nt{static get $name(){return"TabPanel"}static get type(){return"tabpanel"}static get alias(){return"tabs"}static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:r,items:t,tabBar:i}=this;return t.indexOf((e=i.tabs[r])==null?void 0:e.item)}get bodyConfig(){return T.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const r=this.items[this.activeTab||0];return(r==null?void 0:r.focusElement)||((e=r==null?void 0:r.tab)==null?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:r,layout:t}=e,{activeIndex:i}=t,{tabs:n}=e.tabBar,s=r>=0&&r<n.length&&e.items.indexOf(n[r].item);if(n.length>0&&(s===!1||s<0))throw new Error(`Invalid activeTab ${r} (${n.length} tabs)`);s!==i&&t.setActiveItem(s,i,{animation:!1,silent:!0}),t.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const r=this,{tabBar:t}=r,i=r.makeTabConfig(e),n=i&&(t==null?void 0:t.firstTab),s=n&&t._items,a=n&&H.from(r._items,l=>l.tab||l===e),o=n?a.indexOf(e)+s.indexOf(n):0;i&&t&&(n&&e.weight==null&&o<s.count-1?t.insert(i,o):t.add(i))}}onChildRemove(e){const{tab:r}=e,{items:t}=this;r&&(this.tabBar.remove(r),r.destroy()),e===this.activeItem&&(this._activeTab=null,t.length&&(this.activeTab=t[Math.min(this.activeIndex,t.length-1)])),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:r}=this.tabBar,t=r==null?void 0:r[e];return t&&(t.disabled||t.hidden)}findAvailableTab(e,r=1){const{tabs:t}=this.tabBar,i=t.length,n=Math.max(0,t.indexOf(e.tab));n&&(r=-r);let s;for(let a=1;a<=i&&(s=(n+(r<0?i:0)+a*r)%i,!!this.isDisabledOrHiddenTab(s));++a);return s}activateAvailableTab(e,r=1){this.activeTab=this.findAvailableTab(e,r)}changeActiveTab(e,r){const t=this,{tabBar:i,layout:n}=t,{tabCount:s}=i;if(e.isWidget||T.isObject(e)?(t.items.indexOf(e)===-1&&(e=t.add(e)),e=i.indexOfTab(e.tab)):e=parseInt(e,10),!t.initialItems&&s>0&&(e<-1||e>=s))throw new Error(`Invalid activeTab ${e} (${s} tabs)`);if(t.isDisabledOrHiddenTab(e)&&(e=t.findAvailableTab(e)),n.animateCardChange&&n.cardChangeAnimation)n.cardChangeAnimation.then(a=>{(a==null?void 0:a.activeIndex)!==e&&(t._activeTab=e,t.updateActiveTab(e,r))});else return e}async updateActiveTab(e,r){var t;if(!this.initialItems){const{activeTabItemIndex:i,layout:n}=this;if(i>-1){const s=this.items[r],a=this.items[i];n.activeItem!==a&&(n.animateCardChange&&await this.tabSelectionPromise,s!=null&&s.containsFocus&&s.tab.focus(),this.tabSelectionPromise=(t=n.setActiveItem(a))==null?void 0:t.promise)}}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:r}=e,t={item:e,type:"tab",tabPanel:this,disabled:!!e.disabled,hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return r===!1?null:T.isObject(r)?Rc.mergeConfigs(t,r):t}updateItems(e,r){const t=this,{activeTab:i,initialItems:n}=t;let s=0,a;super.updateItems(e,r),n&&(a=Array.from(e,o=>t.makeTabConfig(o)).filter(o=>{if(o)return o.index=s++,!0}),s&&(a[0].isFirst=!0,a[s-1].isLast=!0,a[i].active=!0,t.tabBar.add(a),t.activeTab=i))}updateTabMinWidth(e){var r;(r=this.tabBar)==null||r.items.forEach(t=>{t.isTab&&(t.minWidth=e)})}updateTabMaxWidth(e){var r;(r=this.tabBar)==null||r.items.forEach(t=>{t.isTab&&(t.maxWidth=e)})}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&he.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:r,activeTab:t,element:i}=e,{animateCardChange:n}=r;r.animateCardChange=!1,e.height=null,e.height=Math.max(...e.items.map(s=>(e.activeTab=s,i.clientHeight)))+1,e.activeTab=t,r.animateCardChange=n,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const r=this.tabBar.tabs,{activeItem:t,prevActiveItem:i}=e;this.activeTab=r.indexOf(t==null?void 0:t.tab),i!=null&&i.tab&&(i.tab.active=!1),t!=null&&t.tab&&(t.tab.active=!0,t.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onPaint(){super.onPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}};Sf.initClass(),Sf._$name="TabPanel";var wf=class extends $e{static get $name(){return"TextAreaField"}static get type(){return"textareafield"}static get alias(){return"textarea"}static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(e){this.input.style.resize=e}};wf.initClass(),wf._$name="TextAreaField";var Pc=class extends ls{static get $name(){return"TextAreaPickerField"}static get type(){return"textareapickerfield"}static get configurable(){return{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null}}startConfigure(e){typeof e.inline=="boolean"&&re.deprecate("Core","6.0.0","TextAreaPickerField.inline config is no longer supported"),super.startConfigure(e)}get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get focusElement(){var e;return(e=this._picker)!=null&&e.isVisible?this.input:this.displayElement}get needsInputSync(){var e;return this.displayElement[this.inputValueAttr]!==String((e=this.inputValue)!=null?e:"")}showPicker(){const e=this,{picker:r}=e;e.inline||(r.width=e.pickerWidth||e[e.pickerAlignElement].offsetWidth,super.showPicker(!0))}focusPicker(){this.input.focus()}onPickerKeyDown(e){const r=this,t=r.input;switch(e.key.trim()||e.code){case"Escape":r.picker.hide();return;case"Enter":e.ctrlKey&&(r.syncInputFieldValue(),r.picker.hide());break}r.input=r.displayElement;const i=super.onPickerKeyDown(e);return r.input=t,i}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return e==null?"":e}changePicker(e,r){var t;const i=this,n=i.pickerWidth||(e==null?void 0:e.width);if(e=Pc.reconfigure(r,e?U.merge({owner:i,forElement:i[i.pickerAlignElement],align:{matchSize:n==null,anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},id:i.id+"-input",style:{resize:i.resize},html:(t=i.value)!=null?t:""},e):null,i),e){const s=i.input=e.element;i.inputListenerRemover=j.on({element:s,thisObj:i,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}};Pc.initClass(),Pc._$name="TextAreaPickerField";var mP=e=>{var r;return r=class extends(e||F){compose(){const{minified:t}=this;return{class:{"b-minified":t}}}get widgetClass(){}},R(r,"$name","Minifiable"),R(r,"configurable",{minifiable:!0,minified:null}),r},pP=[],vP=e=>e[0]!=="*",DS=(e,r)=>{const t=e[r]||null;return delete e[r],t},yP=e=>e.responsiveRoot,ES={number:e=>({width:r})=>r<=e&&e},xS=e=>(delete e.once,{callback:DS(e,"callback"),configs:e,when:DS(e,"when")}),RS=(e,...r)=>{const t=r.flatMap(s=>(s==null?void 0:s.once)||pP),i=e.mergeConfigs(...r),n=xS(i);return n.once=t.length?xS(e.mergeConfigs(...t)):null,n},bP=(e,r)=>{let t,i=Proxy.revocable(e,{get(a,o){return t&&(t[o]=!0),e[o]}}),n=Te.after(e,"onConfigChange",(a,{name:o})=>{t!=null&&t[o]&&r()}),s=e.ion({resize:()=>{r()}});return e.monitorResize=!0,{widget:e,get object(){return i==null?void 0:i.proxy},destroy(){i&&(i.revoke(),n(),s(),i=n=s=null)},reset(){t=Object.create(null)}}},CP=e=>{var r;return r=class extends(e||F).mixin(ge,cS){get isResponsivePending(){return this.responsiveUpdateCount===0&&this.hasConfig("responsive")}get isResponsiveUpdating(){var t;return this._responsiveUpdating||((t=this.responsiveWidget)==null?void 0:t._responsiveUpdating)}updateResponsive(t){var i;const n=this,s=n.constructor,{responsiveDefaults:a}=n,o=Array.from(new Set(T.keys(t).concat(T.keys(a)))).filter(vP);let l=null,c,d,u,h;if(t){l={"*":RS(s,a["*"],t["*"])};for(d of o)u=t[d],u!==null&&u!==!1&&(c=c||u&&"when"in u,l[d]=RS(s,a["*"],a[d],t["*"],u),h=l[d].when,l[d].when=((i=ES[typeof h])==null?void 0:i.call(ES,h))||h)}n.$responsiveStates=l,n.$responsiveWhen=c,n.syncResponsiveWidget()}updateResponsiveState(t,i){var n,s,a,o,l;const c=this,{$responsiveStates:d}=c,u=++c.responsiveStateChanges===1,h=(n=c.element)==null?void 0:n.classList,f=d["*"],g=d[t]||f,m=u&&(g.once||f.once),p=u&&c.isStateful,v=c.responsiveWidget;let y=g.configs,S=m==null?void 0:m.configs;S&&(y=y?c.constructor.mergeConfigs(y,S):S),i&&(h==null||h.remove(`b-responsive-${i.toLowerCase()}`)),t&&(h==null||h.add(`b-responsive-${t.toLowerCase()}`)),p&&(S=c.loadStatefulData(),S&&(y=y?c.constructor.mergeConfigs(y,S):S),c.suspendStateful()),c._responsiveUpdating=!0;try{(s=c.trigger)==null||s.call(c,"beforeResponsiveStateChange",{state:t,oldState:i,target:v}),y&&c.setConfig(y),(a=g.callback)==null||a.call(g,{source:c,state:t,oldState:i,target:v,initial:u}),(o=m==null?void 0:m.callback)==null||o.call(m,{source:c,state:t,oldState:i,target:v,initial:u}),(l=c.trigger)==null||l.call(c,"responsiveStateChange",{state:t,oldState:i,target:v})}finally{c._responsiveUpdating=!1,p&&c.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(t){var i;const n=this,s=t&&n.responsiveUpdate;(i=n.$responsiveWrapper)==null||i.destroy(),n.$responsiveWrapper=t&&bP(t,s),s==null||s.now()}responsiveUpdate(){const t=this,{$responsiveStates:i,$responsiveWrapper:n}=t,s=n==null?void 0:n.widget;if(i&&n){let a=null,o=0,l=i,c,d;s&&s!==t&&!t.$responsiveWhen&&(s.getConfig("responsive"),l=s.$responsiveStates||l),n.reset();for(d in i)d!=="*"&&(c=l[d].when(n.object,Y),c!=null&&c!==!1&&(!a||c<o)&&(a=d,o=c));++t.responsiveUpdateCount,t.responsiveState=a}}syncResponsiveWidget(){var t;const i=this;let n=null,s;if(!i.isDestroying&&i.responsive){if(s=i.responsiveTarget,!(n=s))n=!i.responsiveRoot&&((t=i.up)==null?void 0:t.call(i,yP))||i;else if(typeof s=="string"&&(n=s==="@"?i:s[0]==="@"?i[s.substring(1)]:i.up(s),!n))throw new Error(`No match for responsiveTarget="${s}"`);if(!n.isWidget)throw new Error(`${n.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return i.responsiveWidget=n,n}changeBreakpoints(t){return T.assertObject(t,"breakpoints"),t!=null&&t.width&&Object.keys(t.width).forEach(i=>{t.width[i].maxWidth=i}),t!=null&&t.height&&Object.keys(t.height).forEach(i=>{t.height[i].maxHeight=i}),t}updateBreakpoints(t){t&&(this.monitorResize=!0)}getBreakpoint(t,i){const n=Object.keys(t).map(a=>parseInt(a)).sort(),s=n.find(a=>i<=a);return t[s!=null?s:t["*"]&&"*"]}activateBreakpoint(t,i){var n,s;const a=this,o=a[`current${t}Breakpoint`];i!==o&&(a[`current${t}Breakpoint`]=i,a.setConfig(i.configs),o&&a.element.classList.remove(`b-breakpoint-${o.name.toLowerCase()}`),a.element.classList.add(`b-breakpoint-${i.name.toLowerCase()}`),a.trigger(`responsive${t}Change`,{breakpoint:i,prevBreakpoint:o}),(n=i.callback)==null||n.call(i,{source:a,breakpoint:i,prevBreakpoint:o}),(s=a.recompose)==null||s.call(a))}applyResponsiveBreakpoints(t,i){var n;const s=this,{width:a,height:o}=(n=s.breakpoints)!=null?n:{};if(a){const l=s.getBreakpoint(a,t);s.activateBreakpoint("Width",l)}if(o){const l=s.getBreakpoint(o,i);s.activateBreakpoint("Height",l)}}onInternalResize(t,i,n,s,a){super.onInternalResize(t,i,n,s,a),this.applyResponsiveBreakpoints(i,n)}},R(r,"$name","Responsive"),R(r,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}},breakpoints:null}),R(r,"delayable",{responsiveUpdate:"raf"}),R(r,"fenced",{syncResponsiveWidget:!0}),R(r,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),r},SP=e=>{var r;return r=class extends(e||F){changeCssVarPrefix(t){return T.assertString(t,"prefix"),t&&!t.endsWith("-")&&(t=t+"-"),t||""}changeCss(t){T.assertObject(t,"css");const i=this;if(!globalThis.Proxy)throw new Error("Proxy not supported");const n=new Proxy({},{get(s,a){var o;return(o=getComputedStyle(i.element||document.documentElement).getPropertyValue(`--${i.cssVarPrefix}${L.hyphenate(a)}`))==null?void 0:o.trim()},set(s,a,o){return(i.element||document.documentElement).style.setProperty(`--${i.cssVarPrefix}${L.hyphenate(a)}`,o),!0}});return t&&(i._element?T.assign(n,t):i.$initialCSS=t),n}updateElement(t,...i){super.updateElement(t,...i),this.$initialCSS&&T.assign(this.css,this.$initialCSS)}get widgetClass(){}},R(r,"$name","Styleable"),R(r,"configurable",{cssVarPrefix:"",css:{}}),r},fs="http://www.w3.org/2000/svg",wP={bar:1,outline:2,text:3},DP=(e,r)=>parseInt(e.dataset.order,10)-parseInt(r.dataset.order,10),EP=e=>e.field,xP=()=>!1,Ic=class extends ${static get type(){return"histogram"}static get $name(){return"Histogram"}static get defaultConfig(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:fs,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:fs,tag:"g",reference:"scaledSvgGroup"},{ns:fs,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:null,monitorResize:!0,getRectClass:null,getBarTip:null,getBarText:null,getBarTextRenderData:null,getBarTextTip:null}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}set tip(e){var r;const t=this;(r=t.tip)==null||r.destroy(),e?t._tip=ue.new({owner:t,forElement:t.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):t._tip=null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const r=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:r})}set series(e){const r=this,t=r._series={};for(const i in e)if(e[i]!==!1){const n=t[i]=Object.assign({},e[i]);!n.type&&e[i].type&&(n.type=e[i].type),!n.field&&e[i].field&&(n.field=e[i].field),"order"in t||(n.order=wP[n.type]),n.id=i}r.scheduleRefresh()}get series(){return this._series}set data(e){const r=this;if(r._data=e,!r.topValue){const t=Object.values(r.series).map(EP);for(let i=0,{length:n}=e;i<n;i++)for(let s=0,{length:a}=t;s<a;s++)r.topValue=Math.max(r.topValue||0,e[i][t[s]])}r.scheduleRefresh()}get data(){return this._data}set topValue(e){this._topValue=e,this.scheduleRefresh()}get topValue(){return this._topValue}scheduleRefresh(){}refresh(){const e=this,{series:r,_tip:t}=e,i=[];for(const n in r){const s=r[n],a=e[`draw${L.capitalize(s.type)}`](s);Array.isArray(a)?i.push.apply(i,a):i.push(a)}i.sort(DP),q.syncChildren({domConfig:{children:i},configEquality:xP},e.scaledSvgGroup),q.syncChildren({domConfig:{children:e.drawText()}},e.unscaledSvgGroup),t&&t.isVisible&&e.onBeforeTipShow({source:t})}drawBar(e){const r=this,{topValue:t,data:i,omitZeroHeightBars:n,barStyle:s}=r,{field:a,order:o}=e,l=1/i.length,c=[];let d;for(let u=0,h=0,{length:f}=i;u<f;u++,h+=d){const g=i[u],m=g[a],p=g.height||(m>t?t:m)/t,v=1-p,y=g.rectConfig={ns:fs,tag:"rect",dataset:{}},S=r.callback("getBarTip",r,[e,y,g,u]);d=g.width||l,s?y.style=s:delete y.style,Object.assign(y.dataset,{index:u,order:o}),Object.assign(y,{x:h,y:v,width:d,height:p,class:r.callback("getRectClass",r,[e,y,g,u])}),S?y.dataset.btip=S:delete y.dataset.btip,(p||!n)&&c.push(y)}return c}drawOutline(e){const r=this,{topValue:t,data:i}=r,{field:n,order:s}=e,a=1/i.length,o=["M 0,1"],l=e.outlineElement||(e.outlineElement={ns:fs,tag:"path",dataset:{order:s}});let c,d="M",u="L";for(let h=0,f=0,{length:g}=i;h<g;h++){const m=1-i[h][n]/t;c=i[h].width||a,o.push(`${d} ${f},${m} ${u} ${f+=c},${m}`),d=u=""}return l.d=o.join(" "),l}drawText(){const e=this,{data:r}=e,t=1/r.length,i="100%",n=[];for(let s=0,a,o=0,{length:l}=r;s<l;s++,o+=a){a=r[s].width||t;const c=e.callback("getBarText",e,[r[s],s]);if(c){const d=e.callback("getBarTextRenderData",e,[{ns:fs,tag:"text",className:"b-bar-legend",html:c,x:`${(o+a/2)*100}%`,y:r[s].y!==void 0?r[s].y:i,dataset:{index:s}},r[s],s]),u=e.callback("getBarTextTip",e,[d,r[s],s]);u?d.dataset.btip=u:delete d.dataset.btip,n.push(d)}}return n}getBarText(e,r){return""}getBarTextRenderData(e,r,t){return e}getBarTip(e,r,t,i){}getBarTextTip(e,r,t){}getRectClass(e,r,t,i){return""}};Ic.initClass(),Ic._$name="Histogram";var oo="http://www.w3.org/2000/svg",Ac=class extends ${static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:oo,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:oo,tag:"g",reference:"scaledSvgGroup",children:[{ns:oo,tag:"path",reference:"pathElement"}]},{ns:oo,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,r){this.element.classList.remove(`b-align-${r}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,r){this.element.classList.remove(`b-scale-${r?"horizontal":"vertical"}`),this.element.classList.add(`b-scale-${e?"horizontal":"vertical"}`)}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){const e=this,{horizontal:r,width:t,height:i,align:n,scalePoints:s,scaleMaxPadding:a}=e,o=s[s.length-1].value,l=[],c=[],d=1/(o+a*o);e.scaledSvgGroup.setAttribute("transform",`scale(${r?t:1} ${r?1:i})`);for(const u of s){const h=!!u.text,f=d*u.value;if(h){const g={ns:oo,tag:"text",className:"b-scale-tick-label",html:u.text,dataset:{tick:u.value}};r?(g.x=`${f*100}%`,g.y=n==="top"?"1.6em":i-12):(g.x=n==="left"?"12":`${t-12}`,g.y=`${(1-f)*100}%`),c.push(g)}r?n==="top"?l.push(`M${f},0 L${f},${h?10:5}`):l.push(`M${f},${i} L${f},${i-(h?10:5)}`):n==="left"?l.push(`M0,${1-f} L${h?10:5},${1-f}`):l.push(`M${t},${1-f} L${t-(h?10:5)},${1-f}`)}e.pathElement.setAttribute("d",l.join("")),q.syncChildren({domConfig:{children:c}},e.unscaledSvgGroup)}};Ac.initClass(),Ac._$name="Scale";var gs=class extends F{static get $name(){return"AvatarRendering"}static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;(e=this.tooltip)==null||e.destroy(),super.doDestroy()}updateElement(e){j.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return ue.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar({initials:e,color:r,iconCls:t,imageUrl:i,defaultImageUrl:n,dataset:s={},resourceRecord:a,alt:o=L.encodeHtml(a==null?void 0:a.name)}){const l=this.getImageConfig(e,r,i,n,s,o)||this.getIconConfig(t,s)||this.getResourceInitialsConfig(e,r,s),{size:c}=this;return Object.assign(l.style,{...c?{height:c,width:c}:void 0}),l}getImageConfig(e,r,t,i,n,s){if(t=gs.failedUrls.has(t)?i:t||i,t)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},style:{},alt:s,elementData:{defaultImageUrl:i,imageUrl:t,initials:e,color:r,dataset:n},src:t,dataset:n}}getIconConfig(e,r){if(e)return e&&{tag:"i",style:{},class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:r}}getResourceInitialsConfig(e,r,t){const i=C.isNamedColor(r)&&r,n=!i&&r,{size:s}=this;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${i}`]:i},style:{backgroundColor:n||null,...s?{height:s,width:s}:void 0},children:[e],dataset:t}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:r,initials:t,color:i,imageUrl:n,dataset:s}=e.elementData;if(r&&!e.src.endsWith(r.replace(/^[./]*/gm,"")))e.src=r;else{const a=C.createElement(this.getResourceInitialsConfig(t,i,s));a.elementData=e.elementData,e.parentElement.replaceChild(a,e)}gs.failedUrls.add(n)}};gs._$name="AvatarRendering",window&&!window.bryntum&&(window.bryntum={});var ne=class{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const r=$.fromElement(e,"gridbase"),t=r&&e.closest(r.focusableSelector);if(t){const{dataset:i}=t.parentNode;this.init({grid:r,rowIndex:r.store.includes(i.id)?r.store.indexOf(i.id):i.index||-1,columnId:t.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var r,t;const i=this,n=i.grid=e.grid,{store:s,columns:a}=n,{visibleColumns:o}=a;if(e.target&&(i.actionTargets=[i._target=e.target]),e.record)i._id=e.record.id;else if("id"in e)i._id=e.id,e.id==null&&(i._rowIndex=-1);else{const l=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;i._rowIndex=Math.max(Math.min(Number(l),s.count-1),n.hideHeaders?0:-1),i._id=(r=s.getAt(i._rowIndex))==null?void 0:r.id}if("_rowIndex"in i||(i._rowIndex=s.indexOf(i.id)),i.isSpecialRow=(t=i.record)==null?void 0:t.isSpecialRow,"columnId"in e)i._column=a.getById(e.columnId);else if("field"in e)i._column=a.get(e.field);else{const l=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(l)?i._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(i._columnIndex=Math.min(Number(l),o.length-1),i._column=o[i._columnIndex])}"_columnIndex"in i||(i._columnIndex=o.indexOf(i._column))}get isLocation(){return!0}equals(e,r=!1){const t=this;return(e==null?void 0:e.isLocation)&&e.grid===t.grid&&(r?t.id===e.id&&t._column===e._column:e.record===t.record&&e.column===t.column&&e.target===t.target)}get rowIndex(){const{_id:e}=this,{store:r}=this.grid;return r.includes(e)?r.indexOf(e):Math.min(this._rowIndex,r.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:r}=this;return r===-1?r:Math.max(Math.min(r,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return e!=null&&e.includes(this._column)?this._column:e==null?void 0:e[this.columnIndex]}get columnId(){var e;return(e=this.column)==null?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,((e=this.grid.columns.visibleColumns)==null?void 0:e.length)-1)}move(e){const r=this,{record:t,column:i,grid:n}=r,{store:s}=n,a=n.columns.visibleColumns,o=new ne;let l=s.includes(t)?s.indexOf(t):r.rowIndex,c=a.includes(i)?a.indexOf(i):r.columnIndex;const d=n.hideHeaders?0:-1,u=s.count-1,h=a.length-1,f=l===d,g=l===u,m=c===0,p=c===h;switch(e){case ne.PREV_CELL:m?f||(c=h,l--):c--;break;case ne.NEXT_CELL:p?g||(c=0,l++):c++;break;case ne.UP:f||l--;break;case ne.DOWN:g||(l===-1?l=n.rowManager.firstFullyVisibleRow.dataIndex:l++);break;case ne.FIRST_COLUMN:c=0;break;case ne.LAST_COLUMN:c=h;break;case ne.FIRST_CELL:l=d,c=0;break;case ne.LAST_CELL:l=u,c=h;break;case ne.PREV_PAGE:l=Math.max(d,l-Math.floor(n.scrollable.clientHeight/n.rowHeight));break;case ne.NEXT_PAGE:l=Math.min(u,l+Math.floor(n.scrollable.clientHeight/n.rowHeight));break}return o.init({grid:n,rowIndex:l,columnIndex:c}),o}get cell(){var e,r;const t=this,{grid:i,id:n,_cell:s}=t;if(s)return s;if(n==null)return(e=i.columns.getById(t.columnId))==null?void 0:e.element;{const{row:a}=t;if(a)return a.getCell(t.columnId)||a.getCell((r=i.columns.getAt(t.columnIndex))==null?void 0:r.id)}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:r}=this,{focusableFinder:t}=this.grid;if(e)return r||(t.currentNode=this.grid.focusableFinderCell=e,t.nextNode()||e)}get isActionable(){const{cell:e,_target:r}=this,t=e&&C.getActiveElement(e);return!!(t&&e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY||r&&r!==this.cell)}get isColumnHeader(){return this.cell&&this.rowIndex===-1}get isCell(){return this.cell&&this.record}};ne.UP=1,ne.NEXT_CELL=2,ne.DOWN=3,ne.PREV_CELL=4,ne.FIRST_COLUMN=5,ne.LAST_COLUMN=6,ne.FIRST_CELL=7,ne.LAST_CELL=8,ne.PREV_PAGE=9,ne.NEXT_PAGE=10,ne._$name="Location";var TS=e=>typeof e=="number"||(e==null?void 0:e.endsWith("px")),pe=class extends ae.mixin(Ae,Ve){static get $name(){return"Column"}static get type(){return"column"}static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,r,t){if(!e)return!1;if(e===!0)return!0;const i={};return typeof e=="function"?(i.originalSortFn=e,i.sortFn=e.bind(t)):typeof e=="object"&&(Object.assign(i,e),i.fn&&(i.sortFn=i.fn,delete i.fn)),i}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(e===!0)return!0;const r={columnOwned:!0};return typeof e=="function"?r.filterFn=e:typeof e=="object"&&Object.assign(r,e),r}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,r){var t;const i=this;i.masterStore=r,r&&(i._grid=Array.isArray(r)?r[0].grid:r.grid),i.localizableProperties=Re.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(i.localeClass=e.localeClass),super.construct(...arguments),i.isLeaf&&!("field"in i.data)&&(i.field="_"+(i.type||"")+ ++pe.emptyCount,i.noFieldSpecified=!0),i.hasComplexMapping=(t=i.field)==null?void 0:t.includes("."),!i.width&&!i.flex&&!i.children&&i.set({width:pe.defaultWidth,flex:null},null,!0),i.headerWidgets&&i.initHeaderWidgets(i.headerWidgets),i.isParent&&(i.meta.visibleChildren=new Set,i.collapsible&&(i.collapsible=!0))}shouldSync(e){return e.isColumn&&e.text===this.text&&(e.field===this.field||String(e.renderer)===String(this.renderer))&&(!e.previousSibling&&!this.previousSibling||e.previousSibling.shouldSync(this.previousSibling))}get isCollapsible(){var e;return((e=this.children)==null?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),e.rowIndex!==-1&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){C.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var r,t;!((r=this.location)!=null&&r.isSpecialRow)&&((t=this.location)!=null&&t.cell)&&(e!=null&&e.length||(e=this.location.column.text),C.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,r,t;(t=(r=(e=this.data)==null?void 0:e.editor)==null?void 0:r.destroy)==null||t.call(r),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const r=this.headerWidgetMap={};for(const t of e){const i=$.create({owner:this,...t});r[i.ref||i.id]=i}}destroyHeaderWidgets(){var e;for(const r of Object.values(this.headerWidgetMap||{}))(e=r.destroy)==null||e.call(r)}static generateAutoCls(){const e=[];for(let t=this;t!==pe;t=t.superclass)t.type&&t.type!==t.superclass.type&&e.push(`b-${t.type.toLowerCase()}-cell`);const r=e.join(" ");return(pe.autoClsMap||(pe.autoClsMap=new Map)).set(this,r),r}getCellClass(e){var r,t;const{record:i,column:n}=e,{cellCls:s,internalCellCls:a,grid:o,constructor:l,align:c}=n,d=((r=pe.autoClsMap)==null?void 0:r.get(l))||l.generateAutoCls(),u=e.cell.classList.contains("b-editing"),h={[o.cellCls]:o.cellCls,[d]:d,[s]:s,[a]:a,"b-cell-dirty":i.isFieldModified(n.field)&&(n.compositeField||((t=i.fieldMap[n.field])==null?void 0:t.persist)!==!1),[`b-grid-cell-align-${c}`]:c,"b-selected":o.selectionMode.cell&&o.isCellSelected(e),"b-focused":o.isFocused(e),"b-auto-height":n.autoHeight,"b-editing":u};return i.isSpecialRow&&h["b-checkbox-selection"]&&(h["b-checkbox-selection"]=!1),h}get locked(){return this.data.region==="locked"}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}get editor(){const e=this;let{editor:r}=e.data;if(r&&!r.isWidget){const t=e.grid.processCellEditor({editor:r,field:e.field});t?r=e.data.editor=t.editor:(typeof r=="string"&&(r={type:r}),r=e.data.editor=$.create(T.merge(e.defaultEditor,{owner:e.grid,label:L.encodeHtml(e.text)},r)))}return r}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||((e=this.parent)==null?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||((e=this.grid)==null?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get previousVisibleSibling(){const e=this.region;let r=this.previousSibling;for(;r&&(r.hidden||r.region!==e);)r=r.previousSibling;return r}get nextVisibleSibling(){const e=this.region;let r=this.nextSibling;for(;r&&(r.hidden||r.region!==e);)r=r.nextSibling;return r}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get allowDrag(){return!this.parent.isRoot||!!(this.nextVisibleSibling||this.previousVisibleSibling)}get textWrapper(){return C.getChild(this.element,".b-grid-header-text")}get textElement(){return C.down(this.element,".b-grid-header-text-content")}get contentElement(){return C.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some(e=>e.field===this.field)}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?L.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,r=!1){const t=this,{parent:i}=t;t.hidden||(t.hidden=!0,i&&!i.isRoot&&!i.isTogglingAll&&!i.children.some(s=>s.hidden!==!0)&&!i.hidden&&(e=!0,i.hide()),t.isParent?t.children.forEach(n=>n.hide(!0,!0)):i.isRoot||i.meta.visibleChildren[r?"add":"delete"](t),e||t.stores.forEach(n=>n.trigger("columnHide",{column:t})))}show(e=!1){var r;const t=this,{parent:i}=t;t.hidden&&(t.hidden=!1,i!=null&&i.hidden&&i.show(),t.isParent&&((r=t.meta.visibleChildren)==null||r.forEach(n=>n.show(!0))),e||t.stores.forEach(n=>n.trigger("columnShow",{column:t})))}toggle(e){if(this.hidden&&e===void 0||e===!0)return this.show();if(!this.hidden&&e===void 0||e===!1)return this.hide()}toggleChildren(e=this.children,r=void 0){var t,i;const n=this;(t=n.grid.columns)==null||t.beginBatch(),n.isTogglingAll=!0,e.forEach(s=>s.toggle(r)),n.isTogglingAll=!1,(i=n.grid.columns)==null||i.endBatch()}onCollapseChange(e=void 0){var r,t;const i=this;if(i.collapseMode==="toggleAll")i.toggleChildren();else{const{firstChild:n}=i;n.flex!=null&&i.collapsed?(n.oldFlex=n.flex,n.width=n.element.offsetWidth):!i.collapsed&&n.oldFlex&&(n.flex=n.oldFlex,n.oldFlex=null),(r=i.grid.columns)==null||r.beginBatch(),i.isTogglingAll=!0,i.children.slice(1).forEach(s=>s.toggle(e)),i.isTogglingAll=!1,(t=i.grid.columns)==null||t.endBatch()}}set collapsible(e){const r=this;if(r.set("collapsible",e),r.isParent){const{headerWidgets:t=[]}=r;if(e)t.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:r.collapsed,icon:`b-icon-collapse-${r.grid.rtl?"right":"left"}`,pressedIcon:`b-icon-collapse-${r.grid.rtl?"left":"right"}`,cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:i})=>r.collapsed=i});else{const i=t.findIndex(n=>n.ref==="collapseExpand");i>-1&&t.splice(i,1)}r.headerWidgets=t,r.collapsed&&r.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return pe.generatedIdIndex||(pe.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++pe.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var r;return C.measureSize(e,(r=this.subGrid)==null?void 0:r.element)}get calcMinWidth(){const{width:e,minWidth:r}=this.data;return TS(e)&&TS(r)?Math.max(parseInt(e)||0,parseInt(r)||0):e}get width(){return this.data.width}set width(e){const r={width:e};e&&"flex"in this.data&&(r.flex=null),this.set(r)}set flex(e){const r={flex:e};e&&"width"in this.data&&(r.width=null),this.set(r)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,r=e.measureSize(e.width),t=e.measureSize(e.minWidth);let i=0;return e.children&&(i=e.children.reduce((n,s)=>n+s.calculateMinWidth(),0)),Math.max(r,t,i)}resizeToFitContent(e,r,t=!1){const i=this,{grid:n,element:s,fitMode:a}=i,{rowManager:o,store:l}=n,{count:c}=l;if(c<=0||i.fitMode==="none"||!i.fitMode)return;const[d]=o.rows,{rowElement:u,cellElement:h}=n.beginGridMeasuring(),f=new ne({grid:n,column:i,id:null});let g=0,m,p,v,y,S,D,w={length:0,record:null};if(h._domData={columnId:i.id,row:d,rowElement:u},f._cell=h,f.updatingSingleRow=!0,f.isMeasuring=!0,h.innerHTML="",n.resizeToFitIncludesHeader){if(!n.$headerPadding){const x=globalThis.getComputedStyle(s);n.$headerPadding=parseInt(x.paddingLeft)}const E=s.querySelector(".b-grid-header-text-content");E.style.cssText="flex: none; width: auto",g=E.offsetWidth+n.$headerPadding*2+2,E.style.cssText=""}for(c>1e3?(m=Math.max(Math.min(o.topIndex+Math.round(o.rowCount/2)-500,c-1e3),0),p=m+1e3):(m=0,p=c),v=m;v<p;v++){if(y=l.getAt(v),S=i.getRawValue(y),a==="value")D=String(S).length;else if(f._record=w.record,f._id=y.id,f._rowIndex=v,d.renderCell(f),a==="textContent")D=h.textContent.length;else{const E=h.offsetWidth;E>g&&(g=E)}D>w.length&&(w={record:y,length:D,rowIndex:v})}return w.length>0&&(a==="value"||a==="textContent")&&(f._record=w.record,f._id=w.record.id,f._rowIndex=w.rowIndex,d.renderCell(f),g=Math.max(g,h.offsetWidth)),Array.isArray(e)&&([e,r]=e),g=Math.max(g,e||0),g=Math.min(g,r||1e6),t||n.endGridMeasuring(),i.width=i.maxWidth?g=Math.min(g,i.maxWidth):g,g}getState(){const e=this,r={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(r[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(r.collapsed=e.collapsed),r}applyState(e){const r=this;r.beginBatch(),"locked"in e&&(r.locked=e.locked),"width"in e&&(r.width=e.width),"flex"in e&&(r.flex=e.flex),"width"in e&&r.flex?r.flex=void 0:"flex"in e&&r.width&&(r.width=void 0),"region"in e&&(r.region=e.region),r.endBatch(),"hidden"in e&&r.toggle(e.hidden!==!0),"collapsed"in e&&(r.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:r}=this,t=e&&(r==null?void 0:r.focusedCell);(t==null?void 0:t.columnId)===this.id&&(r.owns(C.getActiveElement(r))?r.navigateRight():r._focusedCell=new ne({grid:r,rowIndex:t.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return this.hasComplexMapping?T.getPath(e,this.field):e[this.field]}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const r=e.isEditable(this.field);if(r!==void 0)return r}return!0}insertChild(e,r=null,t=!1){return e=Array.isArray(e)?e:[e],e.forEach(i=>{const{parent:n}=i;n!=null&&n.collapsed&&i===n.firstChild&&n.children.length>1&&n.children.filter(s=>!s.hidden).length===1&&(i.nextSibling.hidden=!1)}),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(e){var r;const t=super.getCurrentConfig(e);return(r=this.sortable)!=null&&r.originalSortFn&&(t.sortable=this.sortable.originalSortFn),t.renderer===this.internalRenderer&&delete t.renderer,t.headerRenderer===this.internalHeaderRenderer&&delete t.headerRenderer,delete t.ariaLabel,delete t.cellAriaLabel,t}};pe.emptyCount=0,pe.defaultWidth=100,pe.exposeProperties(),pe._$name="Column";var RP={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},TP=[{field:"region"}],De=class extends Ve(ee){static get defaultConfig(){return{modelClass:pe,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:TP,reapplySortersOnAdd:!0}}construct(e){const r=this;e.grid&&(e.grid._columnStore=r,r.id=`${e.grid.id}-columns`,e.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:r})),super.construct(e),r.ion({change:r.onStoreChange,sort:()=>r.updateChainedStores(),thisObj:r,prio:1})}doDestroy(){const e=[];this.isChained||this.traverse(r=>e.push(r)),super.doDestroy(),this.isChained||e.forEach(r=>r.destroy())}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,r=this){this.traverseWhile((t,i)=>e.call(r,t,i),!0)}get totalFixedWidth(){let e=0;for(const r of this)r.hidden||(r.children?r.children.forEach(t=>e+=this.calculateFixedWidth(t)):e+=this.calculateFixedWidth(r));return e}get hasFlex(){return this.visibleColumns.some(e=>e.flex)}calculateFixedWidth(e){return e.flex?e.measureSize(pe.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter(r=>r.isVisible&&(!r.subGrid||!r.subGrid.collapsed))),e._visibleColumns}onStoreChange({action:e,changes:r}){e==="update"&&!("hidden"in r)||this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,(e=this.masterStore)==null||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),(e.action!=="update"||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,r=!0,t=!1){const i=this.visibleColumns,n=e instanceof pe?e:this.getById(e);let s=i.indexOf(n)+(r?1:-1);if(!i[s])if(t)s=r?0:i.length-1;else return null;return i[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var r,t;const{grid:i={}}=this,{store:n}=i,s=(t=(r=n==null?void 0:n.modelClass)==null?void 0:r.fieldMap)==null?void 0:t[e.field];let a=this.modelClass;if(s!=null&&s.column&&(e=U.merge({},s.column,e)),e.type&&(a=De.getColumnClass(e.type),!a))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const o=new a(e,this);if(o.data.region||(o.data.region=i.defaultRegion||"normal"),this.autoAddField&&!o.noFieldSpecified&&n&&!s){let l=o.field;o.constructor.fieldType&&(l={name:o.field,type:o.constructor.fieldType}),n.modelClass.addField(l)}return o}indexOf(e){if(e==null)return-1;const r=super.indexOf(e);return r>-1?r:this.records.findIndex(t=>t.field===e)}get usesAutoHeight(){return this.find(e=>e.autoHeight)}get usesFlexAutoHeight(){return this.find(e=>e.autoHeight&&e.flex!=null)}resolveSyncNode(e){return e.id?super.resolveSyncNode(e):e.field?{id:e.field,node:this.allRecords.find(r=>r.field===e.field)}:e.type?{id:e.type,node:this.allRecords.find(r=>r.type===e.type)}:{id:null,node:null}}static registerColumnType(e,r=!1){e.simpleRenderer=r,(De.columnTypes||(De.columnTypes={}))[e.type]=e}static getColumnClass(e){return De.columnTypes&&De.columnTypes[e]}generateColumnForField(e,r){var t;typeof e=="string"&&this.grid&&(e=(t=this.grid.store)==null?void 0:t.modelClass.fieldMap[e]);let i=e.column||RP[e.type]||{};return typeof i=="string"&&(i={type:i}),i=Object.assign({text:e.text||L.separate(e.name),field:e.name},r,i),e.precision!=null&&(i.format.maximumFractionDigits=e.precision),e.columnType&&(i.type=e.columnType),this.createRecord(i)}},MP=(e,r)=>({update:({store:t,record:i,changes:n})=>{let s=!0;return("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&(s=e.call(r,{store:t,record:i,changes:n})),s}});De.registerColumnType(pe,!0),De._$name="ColumnStore";var tn=class extends pe{get groupHeaderReserved(){return!0}construct(e,r){const t=this;super.construct(...arguments),!e.width&&!e.flex&&t.grid.ion({paint:"updateAutoWidth",thisObj:t}),t.disableIfGridReadOnly&&t.grid.element.classList.add("b-actioncolumn-readonly"),t.externalRenderer=t.renderer,t.renderer=t.internalRenderer}internalRenderer({grid:e,column:r,record:t,callExternalRenderer:i=!0}){var n,s;const a=t&&"groupRowFor"in t.meta,{subGrid:o}=r;return i&&((n=this.externalRenderer)==null||n.call(this,...arguments)),{className:{"b-action-ct":1},children:(s=r.actions)==null?void 0:s.map((l,c)=>{var d;if("visible"in l&&(typeof l.visible=="function"&&l.visible({record:t})===!1||l.visible===!1)||a&&!l.showForGroup||!a&&l.showForGroup)return"";const{tooltip:u,renderer:h}=l,f=typeof u=="function"||(d=u==null?void 0:u.startsWith)!=null&&d.call(u,"up.")?o.callback(u,o,[{record:t}]):u||"";if(h){const g=o.callback(h,o,[{index:c,record:t,column:r,tooltip:f,action:l}]);return typeof g=="string"?{tag:"span",dataset:{...ue.encodeConfig(f),index:c},html:g}:(g.dataset=g.dataset||{},g.dataset.index=c,g)}else return{tag:"button",dataset:{...ue.encodeConfig(f),index:c},"aria-label":f,className:{"b-tool":1,"b-action-item":1,[l.cls]:l.cls}}})}}onCellClick({grid:e,column:r,record:t,target:i}){var n;if(r!==this||!i.classList.contains("b-action-item"))return;let s=i.dataset.index;s||(s=i.parentElement.dataset&&i.parentElement.dataset.index);const a=(n=r.actions)==null?void 0:n[s],o=a&&a.onClick;o&&this.callback(o,r,[{record:t,action:a,target:i}])}updateAutoWidth(){const e=this,r=[],{actions:t}=e;if(!e.element)return;const i=e.actions=[];t==null||t.forEach(s=>{const a={...s};delete a.visible,a.showForGroup?(delete a.showForGroup,r.push(a)):i.push(a)}),r.length>i.length&&(e._actions=r);const n=C.createElement(e.internalRenderer({column:e,callExternalRenderer:!1})).outerHTML;e.width=C.measureText(n,e.element,!0,e.element.parentElement),e.actions=t}};R(tn,"type","action"),R(tn,"fields",[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}]),R(tn,"defaults",{filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30}),De.registerColumnType(tn),tn.exposeProperties(),tn._$name="ActionColumn";var cr=class extends pe{static get defaults(){return{filterType:"number",format:""}}get defaultEditor(){const{format:e,name:r,max:t,min:i,step:n,largeStep:s,align:a}=this;return T.cleanupProperties({type:"numberfield",format:e,name:r,max:t,min:i,step:n,largeStep:s,textAlign:a})}get formatter(){const e=this,{format:r}=e;let t=e._formatter;return(!t||e._lastFormat!==r)&&(e._formatter=t=lr.get(e._lastFormat=r)),t}formatValue(e){return e!=null&&(e=this.formatter.format(e),this.unit&&(e=`${e}${this.unit}`)),e!=null?e:""}defaultRenderer({value:e}){return this.formatValue(e)}};R(cr,"type","number"),R(cr,"fieldType","number"),R(cr,"fields",["format","min","max","step","largeStep","unit"]),De.registerColumnType(cr,!0),cr.exposeProperties(),cr._$name="NumberColumn";var ms=class extends cr{static get defaults(){return{function:"sum",includeParentInChangeSet:!1}}construct(e,r){this.configuredAlign="align"in e,this.configuredEditor="editor"in e,super.construct(...arguments);const{grid:t}=r;this.function==="sum"&&(this.function="sumChildren"),t&&(this.store=t.store)}set store(e){const r=this,t={update:"onRecordUpdate",thisObj:r,prio:1e3},i=r._store;if(e!==i){i&&i.un(t),r._store=e;const{modelClass:n}=e,s=n.fieldMap[r.field];s&&s.type==="number"&&(r.configuredAlign||(r.align="end"),r.configuredEditor||(r.editor="number")),e.ion(t)}}canEdit(e){return e.isLeaf}get store(){return this._store}sumChildren(...e){let r=0;for(let t=0,{length:i}=e;t<i;t++)r+=parseFloat(e[t]||0,10);return r}avg(...e){let r=0;const{length:t}=e;for(let i=0;i<t;i++)r+=parseFloat(e[i]||0,10);return r/t}onRecordUpdate({record:e,changes:r}){const t=this,{rowManager:i}=t.grid;t.field in r&&e.isLeaf&&e.bubble(n=>{const s=i.getRowFor(n);if(s){const a=s.getCell(t.field);a&&s.renderCell(a)}},!0)}getRawValue(e){var r;let t=0;if((r=e.children)!=null&&r.length){const i=this,n=i.function,s=typeof n=="string"&&typeof Math[n]=="function",{handler:a,thisObj:o}=s?{handler:Math[n],thisObj:Math}:i.resolveCallback(n);t=a.apply(o,e.children.map(l=>i.getRawValue(l))),i.includeParentInChangeSet?e.set(i.field,t,!0):e.setData(i.field,t)}else t=e[this.field];return t}canFillValue(){return!1}};R(ms,"type","aggregate"),R(ms,"fields",["function","includeParentInChangeSet"]),De.registerColumnType(ms,!0),ms.exposeProperties(),ms._$name="AggregateColumn";var Nr=class extends pe{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(e,r){const t=this;t.widgetMap={},super.construct(...arguments),t.externalRenderer=t.renderer,t.renderer=t.internalRenderer}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const r of Object.values(this.widgetMap))r.cellInfo.record.readOnly||(r.readOnly=e)}internalRenderer(e){var r;const t=this,{cellElement:i,column:n,record:s,isExport:a}=e,{widgets:o}=n;return!a&&o&&(i.widgets||t.clearCell(i),i.widgets=e.widgets=o.map((l,c)=>{var d,u;let h,f;if(i.widgets&&(h=i.widgets[c],f=h.element.nextElementSibling,l.recreate&&h&&(delete t.widgetMap[h.id],h.destroy(),i.widgets[c]=null)),h||(t.onBeforeWidgetCreate(l,e),l.recomposeAsync=!1,l.owner=t.grid,h=rs.append(l,f?{insertBefore:f}:i)[0],t.widgetMap[h.id]=h,t.onAfterWidgetCreate(h,e),h.name&&h.ion({change:({value:g,userAction:m})=>{m&&(h.cellInfo.record[h.name]=g)}})),h.cellInfo={record:s,column:n},t.grid&&!t.meta.isSelectionColumn&&(h.readOnly=t.grid.readOnly||s.readOnly),((d=t.onBeforeWidgetSetValue)==null?void 0:d.call(t,h,e))!==!1){const g=l.valueProperty||"value"in h&&"value"||h.defaultBindProperty;if(g){const m=h.name?s[h.name]:e.value;h[g]=m}}return(u=t.onAfterWidgetSetValue)==null||u.call(t,h,e),h})),a?null:(r=this.externalRenderer)==null?void 0:r.call(this,e)}onBeforeWidgetCreate(e,r){}onAfterWidgetCreate(e,r){}clearCell(e){e.widgets&&(e.widgets.forEach(r=>{delete this.widgetMap[r.id],r.destroy()}),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}};R(Nr,"$name","WidgetColumn"),R(Nr,"type","widget"),R(Nr,"fields",["widgets"]),De.registerColumnType(Nr),Nr.exposeProperties(),Nr._$name="WidgetColumn";var rn=class extends Nr{construct(e,r){var t;super.construct(...arguments);const i=this;if(Object.assign(i,{externalHeaderRenderer:i.headerRenderer,externalOnBeforeWidgetSetValue:i.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:i.onAfterWidgetSetValue,onBeforeWidgetSetValue:i.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:i.internalOnAfterWidgetSetValue,headerRenderer:i.internalHeaderRenderer}),!i.meta.isSelectionColumn){const n=(t=i.grid)==null?void 0:t.store.modelClass;i.field?n&&!n.fieldMap[i.field]&&!i.constructor.suppressNoModelFieldWarning&&(console.warn(i.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),n.addField({name:i.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var e;(e=this.headerCheckbox)==null||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:r}){let t;return e.classList.add("b-check-header"),r.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),r.headerCheckbox?e.appendChild(r.headerCheckbox.element):r.headerCheckbox=new Zi({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:r}})):t=r.headerText,t=r.externalHeaderRenderer?r.externalHeaderRenderer.call(this,...arguments):t,r.showCheckAll?void 0:t}updateCheckAllState(e){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=e,this.headerCheckbox.resumeEvents())}onCheckAllChange({checked:e}){const r=this;if(r.field){const{store:t}=r.grid;t.beginBatch(),t.forEach(i=>r.updateRecord(i,r.field,e)),t.endBatch()}r.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:r,record:t,cellElement:i}){if(r)return e==null?"":e;const n=super.internalRenderer(...arguments);return t.readOnly&&!this.meta.isSelectionColumn&&(i.widgets[0].readOnly=!0),e?i.widgets[0].input.setAttribute("checked",!0):i.widgets[0].input.removeAttribute("checked"),n}onBeforeWidgetCreate(e,r){e.cls=this.checkCls}onAfterWidgetCreate(e,r){r.cellElement.widget=e,e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var r;e.record=e.cellInfo.record,this.isInitialSet=!0,(r=this.externalOnBeforeWidgetSetValue)==null||r.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var r;this.isInitialSet=!1,(r=this.externalOnAfterWidgetSetValue)==null||r.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:r,userAction:t}){const i=this,{grid:n}=i,{record:s}=e.cellInfo;if(t&&i.field&&(!n.features.cellEdit||n.features.cellEdit.disabled)||i.meta.isSelectionColumn&&!n.isSelectable(s)&&r)return!1;if(!i.isInitialSet)return i.trigger("beforeToggle",{record:s,checked:r})}onCheckboxChange({source:e,checked:r}){if(!this.isInitialSet){const t=this,{record:i}=e.cellInfo,{field:n}=t;n&&(t.updateRecord(i,n,r),r?t.updateCheckAllState(t.grid.store.every(s=>s[n],null,!0)):t.updateCheckAllState(!1)),t.trigger("toggle",{record:i,checked:r})}}updateRecord(e,r,t){const i=`set${L.capitalize(r)}`;e[i]?e[i](t):e.set(r,t)}onCellKeyDown({event:e,cellElement:r}){if(e.key===" "){const t=r.widget;t==null||t.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const r=super.getCurrentConfig(e);return delete r.onBeforeWidgetSetValue,delete r.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(r.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(r.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),r}};R(rn,"$name","CheckColumn"),R(rn,"type","check"),R(rn,"fields",["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),R(rn,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]}),De.registerColumnType(rn,!0),rn._$name="CheckColumn";var gi=class extends pe{static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:r}){e.innerHTML=this.formatValue(r)}formatValue(e){return typeof e=="string"&&(e=b.parse(e,this.format||void 0)),b.format(e,this.format||void 0)}set format(e){const{editor:r}=this.data;this.set("format",e),r&&(r.format=e)}get format(){return this.get("format")}get defaultEditor(){const e=this,{min:r,max:t,step:i,format:n}=e;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:n,max:t,min:r,step:i}}};R(gi,"$name","DateColumn"),R(gi,"type","date"),R(gi,"fieldType","date"),R(gi,"fields",["format","pickerFormat","step","min","max"]),De.registerColumnType(gi,!0),gi.exposeProperties(),gi._$name="DateColumn";var nn=class extends cr{static get defaults(){return{min:0,max:100,showValue:!1,lowThreshold:20,htmlEncode:!1,searchable:!1,summaryRenderer:e=>`${e}%`,fitMode:!1}}constructor(e,r){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return e=e||0,{className:"b-percent-bar-outer",role:"progressbar","aria-Valuemin":0,"aria-Valuemax":100,"aria-Valuenow":e,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":e===0,"b-low":e<this.lowThreshold},style:{width:e+"%"},children:[this.showValue?{tag:"span",text:e+"%"}:void 0]}]}}resizeToFitContent(){}};R(nn,"type","percent"),R(nn,"fieldType","number"),R(nn,"fields",["showValue","lowThreshold"]),nn.sum="average",De.registerColumnType(nn,!0),nn._$name="PercentColumn";var mi=class extends cr{static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1,fitMode:"value"}}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:H.populate(this.max,r=>{const t=r<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":t,"b-empty":!t,[t?this.filledIcon:this.emptyIcon]:!0}}})}}onCellClick({grid:e,column:r,record:t,target:i,event:n}){if(i.classList.contains("b-rating-icon")&&!e.readOnly&&r.editable){let s=[].indexOf.call(i.parentNode.childNodes,i);i.classList.contains("b-filled")&&(n.metaKey||n.shiftKey)&&(s=s-1),t.get(r.field)===1&&s===0&&(s=-1),t.set(r.field,s+1)}}};R(mi,"$name","RatingColumn"),R(mi,"type","rating"),R(mi,"fieldType","number"),R(mi,"fields",["emptyIcon","filledIcon","editable"]),De.registerColumnType(mi,!0),mi.exposeProperties(),mi._$name="RatingColumn";var lo=class extends pe{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:50,width:50,align:"center",text:"#",editor:!1,readOnly:!0}}construct(e){super.construct(...arguments);const r=this,{grid:t}=r;r.internalCellCls="b-row-number-cell",r.externalHeaderRenderer=r.headerRenderer,r.headerRenderer=r.internalHeaderRenderer,t&&(t.ion({bindStore:"bindStore",thisObj:r}),r.bindStore({store:t.store,initial:!0}),t.store.count&&!t.rendered&&t.ion({paint:"resizeToFitContent",thisObj:r,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:r}){const t=this;t.detachListeners("grid"),e.ion({name:"grid",[`change${t.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:t}),r||t.resizeToFitContent()}onStoreChange({action:e,isMove:r}){if(e==="dataset"||e==="add"||e==="remove"||e==="removeall"){if(e==="remove"&&r)return;const t=this,i=t.resizeToFitContent();e==="dataset"&&!i&&t.grid.store.count&&t.grid.rowManager.ion({renderDone(){this.resizeToFitContent()},once:!0,thisObj:t})}}renderer({record:e,grid:r}){return e.isSpecialRow?"":r.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:r}=e,{count:t}=r;if(t&&!this.hidden){const i=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(i){const n=parseInt(C.getStyleValue(i,"padding-left")),s=C.measureText(t,i);return this.width=Math.max(this.minWidth,s+2*n),!0}}return!1}set flex(e){}internalHeaderRenderer({headerElement:e,column:r}){var t;return e.classList.add("b-rownumber-header"),((t=r.externalHeaderRenderer)==null?void 0:t.call(this,...arguments))||r.headerText}};R(lo,"$name","RowNumberColumn"),R(lo,"type","rownumber"),De.registerColumnType(lo,!0),lo._$name="RowNumberColumn";var ps=class extends pe{static get defaults(){return{htmlEncode:!1}}constructor(e,r){super(...arguments);const t=this;if(!t.template)throw new Error("TemplateColumn needs a template");if(typeof t.template!="function")throw new Error("TemplateColumn.template must be a function")}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}};R(ps,"type","template"),R(ps,"fields",["template"]),De.registerColumnType(ps,!0),ps.exposeProperties(),ps._$name="TemplateColumn";var sn=class extends pe{static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:r}){e.innerHTML=this.formatValue(r)}formatValue(e){return typeof e=="string"&&(e=b.parse(e,this.format)),b.format(e,this.format)}set format(e){const{editor:r}=this;this.set("format",e),r&&(r.format=e)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}};R(sn,"type","time"),R(sn,"fieldType","date"),R(sn,"fields",["format"]),De.registerColumnType(sn,!0),sn.exposeProperties(),sn._$name="TimeColumn";var MS=!1,an=class extends pe{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}constructor(e,r){super(...arguments);const t=this;t.shouldHtmlEncode=t.htmlEncode,t.setData("htmlEncode",!1),t.renderer&&(t.originalRenderer=t.renderer),t.renderer=t.treeRenderer.bind(t)}treeRenderer(e){var r,t,i,n;const s=this,{grid:a,column:o,cellElement:l,row:c,record:d,isExport:u}=e,h=d.instanceMeta(a.store),f=!d.isLeaf&&h.collapsed,g={className:"b-tree-cell-value"},m=[g],p={className:{"b-tree-cell-inner":1},tag:d.href?"a":"div",href:d.href,target:d.target,children:m},v={"b-tree-parent-row":0,"b-tree-collapsed":0,"b-tree-expanded":0,"b-loading-children":0};let y,S,{value:D}=e;if(s.originalRenderer){const E=s.originalRenderer(e),x=(r=a.hasFrameworkRenderer)==null?void 0:r.call(a,{cellContent:E,column:o});y=typeof E=="object"&&!x,D=x?"":E===!1?l.innerHTML:E,e.rendererHtml=E}if(y||(D=String(D!=null?D:"")),u)return D;if(d.isLeaf)l.classList.add("b-tree-leaf-cell"),S=e.iconCls||d.iconCls||s.leafIconCls;else{const E=!d.isExpanded(a.store),x=E?s.expandIconCls:s.collapseIconCls,M=E?s.collapsedFolderIconCls:s.expandedFolderIconCls;v["b-tree-parent-row"]=1,v["b-tree-collapsed"]=E,v["b-tree-expanded"]=!E,v["b-loading-children"]=h.isLoadingChildren,l.classList.add("b-tree-parent-cell"),m.unshift({tag:"i",className:{"b-tree-expander":1,[x]:1,"b-empty-parent":!h.isLoadingChildren&&d.children!==!0&&!((t=d.children)!=null&&t.length)}}),MS=S=e.iconCls||d.iconCls||M}if(S&&m.splice(m.length-1,0,{tag:"i",className:{"b-tree-icon":1,[S]:1}}),c.isRow&&(c.assignCls(v),!d.isLeaf))if(c.setAttribute("aria-expanded",!f),f)c.removeAttribute("aria-owns");else for(const E in a.subGrids){const x=c.elements[E];C.setAttributes(x,{"aria-owns":(i=d.children)!=null&&i.length?(n=d.children)==null?void 0:n.map(M=>`${a.id}-${E}-${M.id}`).join(" "):null})}Array.isArray(D)?g.children=D:y?Object.assign(g,D):s.shouldHtmlEncode||!D.includes("<")?(p.className["b-text-value"]=1,g.text=D):g.html=D;const w=d.childLevel*s.indentSize+(d.isLeaf?MS?2:S?.5:.4:0);return p.style=`padding-inline-start:${w}em`,p}getCurrentConfig(e){const r=super.getCurrentConfig(e);return r.renderer=this.originalRenderer,r}};R(an,"$name","TreeColumn"),R(an,"type","tree"),De.registerColumnType(an,!0),an.exposeProperties(),an._$name="TreeColumn";var pi=class extends ae{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}};pi.exposeProperties(),pi._$name="GridRowModel";var co=new Map,vs=new Map,_c="Grid",Fc={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},PP=/\$\d+$/,z=class{static registerFeature(e,r=!1,t=null,i=null){i=L.uncapitalize(i||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name),i=i.replace(PP,""),Array.isArray(t)||(t=[t||_c]),t.forEach(n=>{const s=Fc[n]||n,a=co.get(s)||new Map,o=vs.get(s)||new Map;a.set(i,e),o.set(e,r),co.set(s,a),vs.set(s,o)})}static getTypeNameFeatures(e=_c){const r=Fc[e]||e,t=co.get(r),i={};return t&&t.forEach((n,s)=>i[s]=n),i}static getTypeNameDefaultFeatures(e=_c){const r=Fc[e]||e,t=co.get(r),i=vs.get(r),n={};return t&&i&&t.forEach((s,a)=>{i.get(s)&&(n[a]=s)}),n}static getInstanceFeatures(e){return e.$meta.names.reduce((r,t)=>Object.assign(r,this.getTypeNameFeatures(t)),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce((r,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce((i,[n,s])=>(this.isDefaultFeatureForTypeName(s,t)?i[n]=s:delete i[n],i),r),{})}static isDefaultFeatureForTypeName(e,r=_c){const t=Fc[r]||r,i=vs.get(t);return i&&i.get(e)||!1}static isDefaultFeatureForInstance(e,r){const t=r.$meta.names.slice().reverse();let i=null;for(let n=0,s=t.length;n<s&&i===null;++n){const a=vs.get(t[n]);a&&a.has(e)&&(i=a.get(e))}return i||!1}static reset(){co.clear(),vs.clear()}},ys=class extends X{constructor(){super(...arguments),R(this,"entityName","cell")}afterConstruct(){super.afterConstruct(),this.afterSelectionModeChange()}afterSelectionModeChange(){const e=this;e.client.selectionMode.cell?e._disabledBySelectionMode&&(e.disabled=!1,delete e._disabledBySelectionMode):e.disabled=!0}get copyOnly(){var e;return this._copyOnly==null?!((e=this.client.features.cellEdit)!=null&&e.enabled):!!this._copyOnly}get canCopy(){var e;const{client:r}=this;return!!(!this.disabled&&r.selectedCells.length&&(!r._selectedRows.length||(e=r.features.rowCopyPaste)!=null&&e.disabled||r.focusedCell&&r.isCellSelected(r.focusedCell)))}get canCutPaste(){var e;return this.canCopy&&!this.copyOnly&&!((e=this.client.features.cellEdit)!=null&&e.isEditing)&&!this.client.readOnly}isActionAvailable({actionName:e}){return this.canCopy&&(e==="copy"||this.canCutPaste)}async sendToClipboard(e){var r,t;const i=this;let n=0,s=0,a="";e.sort((o,l)=>o.rowIndex===l.rowIndex?o.columnIndex-l.columnIndex:o.rowIndex-l.rowIndex);for(const o of e){const{record:l,column:c,rowIndex:d,columnIndex:u}=o;d>n?(a.length>0&&(a+=`
`.repeat(d-n)),n=d,s=u):u>s&&(a.length>0&&(a+="	".repeat(u-s)),s=u);let h=(r=c.toClipboardString)==null?void 0:r.call(c,o);h===void 0&&(h=(t=l.get(c.field))==null?void 0:t.toString()),i.toCopyString&&(h=i.toCopyString({currentValue:h,column:c,record:l})),h=h==null?void 0:h.replace(/[\n\t]/," "),a+=h||i.emptyValueChar}return await Y.writeToClipboard(a,this.useNativeClipboard),a}async cut(){await this.copy(!0)}async copy(e){const r=this,{client:t,entityName:i}=r,n=typeof e=="boolean"?e:!1,s=n?t.selectedCells.filter(a=>{var o;return!((o=a.record)!=null&&o.readOnly)}):t.selectedCells;if(s){if((n?!r.canCutPaste:!r.canCopy)||t.trigger("beforeCopy",{cells:s,isCut:n,entityName:i})===!1)return;const a=await r.sendToClipboard(s);if(n===!0)for(const o of s)o.column.readOnly||o.record.set(o.column.field,null);t.trigger("copy",{cells:s,copiedDataString:a,isCut:n,entityName:i})}}async paste(){const e=this,{client:r,entityName:t}=e,i=await Y.readFromClipboard(e.useNativeClipboard),n=r.selectedCells[0];if(!e.canCutPaste||!(i!=null&&i.length)||!n||r.trigger("beforePaste",{clipboardData:i,targetCell:n,entityName:t})===!1)return;const s=new Set,a=e.stringAs2dArray(i),o=[],{_shiftSelectRange:l}=r;if(a!=null&&a.length){if(l!=null&&l.some(c=>c.equals(n))){const c=e.cellSelectorsAs2dArray(l);if((c==null?void 0:c.length)%a.length===0&&c.columnCount%a.columnCount===0)for(let d=0;d<c.length;d+=a.length)for(let u=0;u<c.columnCount;u+=a.columnCount)o.push(c[d][u])}o.length||o.push(n);for(const c of o)for(let d=0;d<a.length;d++){const u=a[d],h=r.store.getAt(c.rowIndex+d);if(h&&!h.readOnly)for(let f=0;f<u.length;f++){const g=r.columns.visibleColumns[c.columnIndex+f],m=g==null?void 0:g.field;let p=u[f];m&&p&&!g.readOnly&&(p===e.emptyValueChar&&(p=null),g.fromClipboardString&&(p=g.fromClipboardString({string:p,record:h})),e.toPasteValue&&(p=e.toPasteValue({currentValue:p,record:h,column:g,field:m})),h.set(m,p,!1,!1,!1,!0),s.add(h))}}r.trigger("paste",{clipboardData:i,targetCell:n,modifiedRecords:[...s],entityName:t})}}cellSelectorsAs2dArray(e){const r=[];let t=null,i;for(const n of e)n.id!==t&&(t=n.id,i=[],r.push(i)),i.push(n);return r.columnCount=r[0].length,r.some(n=>n.length!==r.columnCount)?!1:r}stringAs2dArray(e){const r=[],t=e.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/);for(const i of t){const n=i.split("	");if(r.columnCount&&n.length!==r.columnCount)return!1;r.columnCount=n.length,r.push(n)}return r}populateCellMenu({record:e,items:r}){const t=this;t.canCopy&&(r.cutCell={text:t.cutText,localeClass:t,icon:"b-icon b-icon-cut",weight:115,disabled:e.readOnly||!t.canCutPaste,onItem:()=>t.cut()},r.pasteCell={text:t.pasteText,localeClass:t,icon:"b-icon b-icon-paste",weight:120,disabled:e.readOnly||!t.canCutPaste,onItem:()=>t.paste()},r.copyCell={text:t.copyText,localeClass:t,cls:"b-separator",icon:"b-icon b-icon-copy",weight:110,onItem:()=>t.copy()})}};R(ys,"$name","CellCopyPaste"),R(ys,"pluginConfig",{chain:["populateCellMenu","afterSelectionModeChange"]}),R(ys,"configurable",{copyOnly:null,emptyValueChar:" ",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!re.isTestEnv,toCopyString:null,toPasteValue:null,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}"}),ys._$name="CellCopyPaste",z.registerFeature(ys);var IP={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},kc=class extends ge(X){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,addToCurrentParent:!1,autoEdit:null,editNextOnEnterPress:!0,editorClass:Qt,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:"finishAndEditNextCell","Shift+Tab":"finishAndEditPrevCell"},ignoreCSSSelector:"button,.b-icon,.b-fa,svg"}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,r){super.construct(e,r);const t=this,i={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:t};t.grid=e,t.triggerEvent!=="cellclick"&&(i[t.triggerEvent]="onTriggerEditEvent"),t.autoEdit&&!("editNextOnEnterPress"in r)&&(t.editNextOnEnterPress=!1),e.ion(i),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:t}),t.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let r=!0;return this.editorContext&&(fi.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,r=await fi.confirm(e),fi.owner=null),r===fi.yesButton}doDestroy(){this.grid.columns.allRecords.forEach(e=>{var r;(r=e._cellEditor)==null||r.destroy()}),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return!!(super.disabled||e.disabled||e.readOnly)}get isEditing(){return!!this.editorContext}get activeRecord(){var e;return((e=this.editorContext)==null?void 0:e.record)||null}getEditorForCell({id:e,cell:r,column:t,columnId:i,editor:n}){const s=this,{grid:a,editorClass:o}=s;let l=t.cellEditor,c=0;return t.editTargetSelector&&(c=r.querySelector(t.editTargetSelector).offsetLeft),n.autoSelect=s.autoSelect,l!=null&&l.isEditor||(l=t.data.cellEditor=o.create(o.mergeConfigs({type:o.type,constrainTo:null,cls:"b-cell-editor",inputField:n,blurAction:"none",invalidAction:t.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[c,0]},internalListeners:s.getEditorListeners(),onInternalKeyDown:s.onEditorKeydown.bind(s),allowMouseEvents:n.allowMouseEvents},l))),l.minHeight=a.rowHeight,l.inputField!==n&&(l.remove(l.items[0]),l.add(n)),l.align.offset[0]=c,t.instantUpdate&&!n.cellEditValueSetter&&(T.wrapProperty(n,"value",null,d=>{const{editorContext:u}=s,h=u==null?void 0:u.editor.inputField;u!=null&&u.editor.isValid&&!T.isEqual(u.record[u.column.field],d)&&(!(h!=null&&h.isDateField)||h._isPickerInput)&&(u.record[u.column.field]=d)}),n.cellEditValueSetter=!0),Object.assign(l.element.dataset,{rowId:e,columnId:i,field:t.field}),l.inputField.revertOnEscape=t.revertOnEscape,s.editor=l}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){var r;const t=this,i=t.editorContext=e.cellEditorContext;if(i){const{grid:n}=t;t.triggerEvent!=="cellclick"&&(t.detachListeners("cellClickWhileEditing"),n.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:t})),(r=t.removeEditingListeners)==null||r.call(t),t.removeEditingListeners=he.addListener({globaltap:"onTapOut",thisObj:t}),n.trigger("startCellEdit",{grid:n,editorContext:i})}}onEditorBeforeComplete(e){const{grid:r}=this,t=e.source,i=t.cellEditorContext;return e.grid=r,e.editorContext=i,r.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:r}=this,t=e.cellEditorContext;t.value=e.inputField.value,r.trigger("finishCellEdit",{grid:r,editorContext:t})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:r,muteEvents:t,grid:i}=this;t||i.trigger("cancelCellEdit",{grid:i,editorContext:r,event:e})}onBeforeEditorHide({source:e}){const r=this,{row:t,cell:i}=e.cellEditorContext;i==null||i.classList.remove("b-editing"),t==null||t.removeCls("b-editing"),r.detachListeners("cellClickWhileEditing"),r.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,r){const{grid:t}=this,{store:i,columns:n}=t,{visibleColumns:s}=n;let a=e.id,o=n.getAdjacentVisibleLeafColumn(e.columnId,r);for(;a;)if(o){if(o.editor&&o.canEdit(i.getById(a)))return{id:a,columnId:o.id};o=n.getAdjacentVisibleLeafColumn(o,r)}else{const l=i.getAdjacent(e.id,r,!1,!0);a=l==null?void 0:l.id,l&&(o=r?s[0]:s[s.length-1])}return null}doAddNewAtEnd(){const e=typeof this.addNewAtEnd=="object"?T.clone(this.addNewAtEnd):{},{grid:{store:r,rowManager:t},addToCurrentParent:i}=this;let n;return r.tree&&i?n=r.last.parent.appendChild(e):n=r.add(e)[0],t.getRowFor(n)||t.displayRecordAtBottom(),n}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:r,record:t}=e;if(r!=null&&r.isVisible&&r.editor&&!r.readOnly&&t&&!t.isSpecialRow&&!t.readOnly&&r.canEdit(t)){const i=t&&r.getRawValue(t);return Object.assign(e,{value:i===void 0?null:i,editor:r.editor}),e}else return!1}async startEditing(e={}){var r,t,i;const n=this;if(!n.disabled){const{grid:s}=n;if(e!=null&&e.fromKeyMap&&(e=n.grid.focusedCell),T.isEmpty(e)&&(e.id=s.firstVisibleRow.id),s.store.isTree&&s.features.tree){const u=e.id?s.store.getById(e.id):(r=e.record)!=null?r:s.store.getAt(e.row);if(u)await s.expandTo(u);else return!1}const a=n.getEditingContext(e);if(!a||(n.editorContext&&n.cancelEditing(),(t=s.focusedCell)!=null&&t.equals(a)||s.focusCell(a),s.trigger("beforeCellEditStart",{grid:s,editorContext:a})===!1))return!1;const o=a.editor=n.getEditorForCell(a),{row:l,cell:c,record:d}=a;return o.inputField.highlightExternalChange=!1,o.cellEditorContext=a,o.render(c),c.classList.add("b-editing"),l.addCls("b-editing"),await o.startEdit({target:c,field:o.inputField.name||a.column.field,value:a.value,record:d})||(c.classList.remove("b-editing"),l.removeCls("b-editing")),(i=n.onCellEditStart)==null||i.call(n),!0}return!1}cancelEditing(e=!1,r){var t;const i=this,{editor:n}=i;i.isEditing&&(e.fromKeyMap&&(r=e,e=!1),i.muteEvents=e,n.cancelEdit(r),i.muteEvents=!1,i.finishEditingPromise=!1,(t=i.afterCellEdit)==null||t.call(i))}async finishEditing(){var e;const r=this,{editorContext:t,grid:i}=r;let n=!1;if(r.finishEditingPromise)return r.finishEditingPromise;if(t){const{column:s}=t;r.finishEditingPromise=t.editor.completeEdit(s.bindCallback(s.finalizeCellEdit)),n=await r.finishEditingPromise,await i.waitForAnimations(),r.finishEditingPromise=null,(e=r.afterCellEdit)==null||e.call(r)}return n}async onCellClickWhileEditing({event:e,cellSelector:r}){const t=this;if(!e.target.closest(".b-editor")){if(C.isTouchEvent||e.target.matches(t.ignoreCSSSelector)){await t.finishEditing();return}t.finishEditingPromise||t.editorContext&&!t.editorContext.editor.owns(e.target)&&(t.getEditingContext(r)?await t.finishEditing()?t.continueEditingOnCellClick&&await t.startEditing(r):(t.grid.focusCell(t.editorContext),t.editor.inputField.focus()):await t.finishEditing())}}async onCellClick({source:e,cellSelector:r,target:t,event:i,column:n}){if(n.onCellClick)return;const s=this,{focusedCell:a}=s.client;if(t.closest(".b-tree-expander"))return!1;C.isTouchEvent&&s._lastCellClicked===(a==null?void 0:a.cell)&&i.timeStamp-s.touchEditDelay>s._lastCellClickedTime?await s.startEditing(r):this.triggerEvent==="cellclick"&&await s.onTriggerEditEvent({cellSelector:r,target:t}),s._lastCellClicked=a==null?void 0:a.cell,s._lastCellClickedTime=i.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:r,event:t}){var i;const{editorContext:n,client:s}=this;r.closest(".b-tree-expander")||C.isTouchEvent&&t.type==="dblclick"||t&&((i=s.features.cellMenu)==null?void 0:i.triggerEvent)===t.type||n&&(n.equals(this.grid.normalizeCellContext(e))||!await this.finishEditing())||await this.startEditing(e)}onStoreUpdate({changes:e,record:r}){const{editorContext:t}=this;t!=null&&t.editor.isVisible&&r===t.record&&t.editor.dataField in e&&t.editor.refreshEdit()}onStoreBeforeSort(){var e;const r=(e=this.editorContext)==null?void 0:e.editor;this.isEditing&&!(r!=null&&r.isFinishing)&&!r.isValid&&this.cancelEditing()}onGridRefreshed(){const e=this,{grid:r,editorContext:t}=e;if(t&&r.isVisible&&r.focusedCell){const i=r.getCell(r.focusedCell),{editor:n}=t;i&&C.isInView(i)&&!n.isFinishing?(t._cell=i,he.suspendFocusEvents(),n.render(i),n.showBy(i),n.focus(),he.resumeFocusEvents()):e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable({actionName:e,event:r}){const t=this;if(!t.disabled&&!r.target.closest(".b-grid-header")){if(t.isEditing){if(e==="finishAllSelected")return t.multiEdit&&t.gridSelection.length>1;if(IP[e])return!0}else if(e==="startEditing")return t.grid.focusedCell.cell===r.target}return!1}async finishAllSelected(){const e=this,{dataField:r,record:t}=e.editor;if(await e.finishEditing()&&!e.isDestroyed)for(const i of e.gridSelection)i.isModel?i!==t&&(i[r]=t[r]):i.record.set(i.column.field,t[r])}async finishAndEditNextRow(e,r=!1){const t=this,{grid:i}=t,{record:n}=t.editorContext;let s;if(await t.finishEditing()){if(t.isDestroyed)return;t.isEditing||(r?s=i.internalNextPrevRow(!1,!0,e,!1):(t.addNewAtEnd&&n===i.store.last&&await t.doAddNewAtEnd(),t.isDestroyed||(s=i.internalNextPrevRow(!0,!0,e))),s&&t.editNextOnEnterPress&&!i.touch&&t.startEditing(s))}}finishAndEditPrevRow(e){this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,r=!1){const t=this,{focusedCell:i}=t.grid;if(i){let n=t.getAdjacentEditableCell(i,!r);if(!n&&!r&&t.addNewAtEnd&&await t.finishEditing()===!0&&(await this.doAddNewAtEnd(),n=!t.isDestroyed&&t.getAdjacentEditableCell(i,!r)),n){let s=!0;t.isEditing&&(s=await t.finishEditing()),!t.isDestroyed&&s&&(t.grid.focusCell(n,{animate:t.focusCellAnimationDuration}),await t.startEditing(n)||await t.finishAndEditNextCell(e,r))}}}finishAndEditPrevCell(e){this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const r=this,{grid:t}=r,{focusedCell:i}=t;if(e.handled||!r.autoEdit||r.isEditing||!i||i.isActionable||e.ctrlKey)return;const{key:n}=e,s=e.key==="Delete"||e.key==="Backspace",{gridSelection:a}=s?r:{},o=r.multiEdit&&(a==null?void 0:a.length)>1;if((n.length<=1||s&&!o)&&await r.startEditing(i)){const{inputField:l}=r.editor,{input:c}=l;c&&(l.internalOnKeyEvent(e),e.defaultPrevented||(c.value=s?"":n,l.internalOnInput(e))),e.preventDefault()}else if(o&&t.trigger("beforeCellRangeDelete",{grid:t,gridSelection:a})!==!1)for(const l of a)l.isModel?t.columns.visibleColumns.forEach(c=>{!c.readOnly&&l.set(c.field,null)}):l.column.readOnly||l.record.set(l.column.field,null)}onEditorKeydown(e){if(e.key.length!==1&&this.grid.matchKeyMapEntry(e)&&!this.grid.matchKeyMapEntry(e,this.keyMap))return!e.key.startsWith("Arrow")&&!e.key==="Backspace"&&e.preventDefault(),e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const r=this,{grid:t,editor:i,editorContext:n}=r,s=new ne(e.relatedTarget),a=s.grid===t&&r.getEditingContext(s);n&&!i.isFinishing&&i.owns(e._target)&&(r.blurAction==="cancel"?r.cancelEditing(void 0,e):!r.finishEditingPromise&&(r.triggerEvent==="cellclick"||r.triggerEvent!=="cellclick"&&!a)&&await r.finishEditing())}onEditorFocusIn(e){const r=e.toWidget;r===this.editor.inputField&&this.autoSelect&&r.selectAll&&!r.readOnly&&!r.disabled&&r.selectAll()}async onTapOut({event:e}){const r=this;(!r.grid.bodyContainer.contains(e.target)||e.button)&&(r.editor.owns(e.target)||(r.editingStoppedByTapOutside=!0,r.blurAction==="cancel"?r.cancelEditing(void 0,e):await r.finishEditing(),delete r.editingStoppedByTapOutside))}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}};R(kc,"$name","CellEdit"),kc._$name="CellEdit",z.registerFeature(kc,!0);var uo=class extends es{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const r=this,{cellSelector:t,event:i}=e;r.client.focusCell(t,{doSelect:!r.client.isSelected(t),event:i}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&e.enableCellContextMenu!==!1}getDataFromEvent(e){const r=this.client.getCellDataFromEvent(e);if(r)return T.assign(super.getDataFromEvent(e),r)}beforeContextMenuShow({record:e,items:r,column:t}){if(t.cellMenuItems===!1)return!1;(!e||e.isSpecialRow)&&(r.removeRow=!1)}populateCellMenu({items:e,column:r,record:t}){const{client:i}=this;r!=null&&r.cellMenuItems&&T.merge(e,r.cellMenuItems),i.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:t.readOnly,onItem:()=>i.store.remove(i.selectedRecords.filter(n=>!n.readOnly))})}get showMenu(){return!0}};uo.featureClass="",uo._$name="CellMenu",z.registerFeature(uo,!0,["Grid","Scheduler"]),z.registerFeature(uo,!1,["Gantt"]);var ho=class extends X{construct(e,r){super.construct(e,this.processConfig(r))}initTip(){const e=this;e.tip=ue.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),internalListeners:{pointerOver:"onPointerOver",thisObj:e},listeners:e.configuredListeners},e.initialConfig),e.relayEvents(e.tip,["beforeShow","show"])}onPointerOver({target:e}){const r=this.client.getColumnFromElement(e);return r.tooltipRenderer!==!1&&!!(r.tooltipRenderer||this.tooltipRenderer)}processConfig(e){return typeof e=="function"?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:r,event:t}){const i=this,n=i.client.getRecordFromElement(r),s=i.client.getColumnFromElement(r),a={cellElement:r,record:n,column:s,event:t,tip:e,cellTooltip:i};let o;return!i.forSelector&&n===i.lastRecord&&n.generation===i.lastRecordGeneration&&s===i.lastColumn?i.tip._html:(i.lastRecord=n,i.lastRecordGeneration=n.generation,i.lastColumn=s,s.tooltipRenderer?o=s.tooltipRenderer(a):i.tooltipRenderer&&s.tooltipRenderer!==!1&&(o=i.tooltipRenderer(a)),U.isPromise(o)&&(i.lastRecord=i.lastRecordGeneration=i.lastColumn=null),o||e.hide(),o)}};R(ho,"$name","CellTooltip"),R(ho,"configurable",{tooltipRenderer:null}),ho._$name="CellTooltip",z.registerFeature(ho);var PS="store",Oc=class extends ge(X){static get $name(){return"ColumnAutoWidth"}static get configurable(){return{default:null,delay:0}}static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(e){super.construct(e);const{store:r}=this.client;r&&this.bindStore(r)}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.ion({name:PS,[`change${this.client.asyncEventSuffix}`]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(PS)}get columnAutoWidthPending(){return this.lastSync===null||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if(e!=="move"){const r=this,{cellEdit:t}=r.client.features;++r.storeGeneration,t!=null&&t.isEditing&&!t.editingStoppedByTapOutside?r.syncAutoWidthColumns():r.hasTimeout("syncAutoWidthColumns")||r.setTimeout("syncAutoWidthColumns",r.delay)}}onInternalResize(e,r,t,i){i===0&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){const e=this,r=e.client,t=e.storeGeneration;if(e.lastSync!==t){e.lastSync=t;let i,n;for(const s of r.columns.visibleColumns)i=s.autoWidth,i&&(i===!0&&(i=e.default),r.resizingColumns=n=!0,s.resizeToFitContent(i));n&&(r.resizingColumns=!1,r.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}};Oc.prototype.storeGeneration=0,Oc._$name="ColumnAutoWidth",z.registerFeature(Oc,!0);var Lc=class extends ge(X){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,r){e.features.columnReorder&&e.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,r)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,r=e.grid;r.features.columnReorder&&(e.reorderDetacher=r.features.columnReorder.ion({gridheaderdragstart({context:t}){const i=r.columns.getById(t.element.dataset.columnId);e.showToolbar(i)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const r=this,t=r.grid.getColumnDragToolbarItems(e,[]),i=[];r.clearTimeout(r.buttonHideTimer),t.forEach(n=>{n.text=n.localeClass.L(n.text);let s=i.find(a=>a.text===n.group);s||(s={text:n.localeClass.L(n.group),buttons:[]},i.push(s)),s.buttons.push(n)}),r.element=C.append(r.grid.element,r.template(i)),r.groups=i,r.buttons=t,r.column=e}async hideToolbar(){const e=this,r=e.element;r&&(r.classList.add("b-remove"),await j.waitForTransitionEnd({element:r,mode:"animation",thisObj:e.client}),r.remove(),e.element=null)}onDrag(e){var r;const t=this;if(e.dragProxy.getBoundingClientRect().top-t.grid.element.getBoundingClientRect().top>100?t.element.classList.add("b-closer"):t.element.classList.remove("b-closer"),t.hoveringButton&&(t.hoveringButton.classList.remove("b-hover"),t.hoveringButton=null),(r=e.targetElement)!=null&&r.closest(".b-columndragtoolbar")){t.element.classList.add("b-hover");const i=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");i&&(i.classList.add("b-hover"),t.hoveringButton=i)}else t.element.classList.remove("b-hover")}onDrop(e){const r=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const t=e.targetElement,i=r.buttons.find(n=>n.ref===t.dataset.ref);i&&(t.classList.add("b-activate"),r.buttonHideTimer=r.setTimeout(()=>{r.hideToolbar(),i.onDrop({column:r.column})},100))}else r.hideToolbar()}template(e){return Jt.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map(r=>Jt.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${r.buttons.map(t=>Jt.tpl`
                        <div class="b-target-button" data-ref="${t.ref}" data-disabled="${t.disabled}">
                            <i class="${t.icon}"></i>
                            ${t.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${r.text}</div>
                </div>
            `)}
            </div>`}};Lc.featureClass="b-hascolumndragtoolbar",Lc._$name="ColumnDragToolbar",z.registerFeature(Lc,Y.isTouchDevice);var fo=class extends X{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const r=this,{createColumnsFromModel:t}=r;let i;if(r.groupByRegion)i=r.grid.regions.map(n=>{const s=r.grid.getSubGrid(n).columns.topColumns;return{text:L.capitalize(n),menu:r.buildColumnMenu(s),disabled:s.length===0,region:n}}),t&&i.push({text:r.L("L{newColumns}"),menu:r.createAutoColumnItems()});else if(r.groupByTag){const n={};e.topColumns.forEach(s=>{s.tags&&Array.isArray(s.tags)&&s.hideable!==!1&&s.tags.forEach(a=>{n[a]||(n[a]=1)})}),i=Object.keys(n).sort().map(s=>({text:L.capitalize(s),menu:r.buildColumnMenu(r.getColumnsForTag(s)),tag:s,onBeforeSubMenu:({item:a,itemEl:o})=>{r.refreshTagMenu(a,o)}})),t&&i.push({text:r.L("L{newColumns}"),menu:r.createAutoColumnItems()})}else i=r.buildColumnMenu(e.topColumns),t&&i.items.push(...T.transformNamedObjectToArray(r.createAutoColumnItems()));return i}createAutoColumnItems(){const e=this,{grid:r}=e,{columns:t,store:i}=r,{modelClass:n}=i,{allFields:s}=n,a={};for(let o=0,{length:l}=s;o<l;o++){const c=s[o],d=c.name;t.get(d)||c.internal||(a[d]={text:c.text||L.separate(c.name),checked:!1,onToggle:u=>{const h=t.get(d);h?h[u.checked?"show":"hide"]():t.add(t.generateColumnForField(c,{region:e.forColumn.region})),u.bubbles=!1}})}return a}getColumnsForTag(e){return this.grid.columns.records.filter(r=>r.tags&&Array.isArray(r.tags)&&r.tags.includes(e)&&r.hideable!==!1)}refreshTagMenu(e,r){this.getColumnsForTag(e.tag).forEach(i=>{const n=e.items.find(s=>s.column===i);n&&(n.checked=i.hidden!==!0)})}buildColumnMenu(e){let r=e.length>0&&e[0].region;const{grid:t}=this,i=e.reduce((n,s)=>{const a=t.columns.visibleColumns.filter(o=>o.region===s.region);if(s.hideable!==!1){const o={grid:t,column:s,text:s.headerText,checked:s.hidden!==!0,disabled:s.hidden!==!0&&a.length===1,cls:s.region!==r?"b-separator":""};r=s.region,s.children&&!s.isCollapsible&&(o.menu=this.buildColumnMenu(s.children)),n.push(o)}return n},[]);return{cls:this.menuCls,items:i}}populateHeaderMenu({column:e,items:r}){const t=this,{columns:i}=t.grid;t.forColumn=e,e.showColumnPicker!==!1&&i.some(n=>n.hideable)&&(r.columnPicker={text:"L{columnsMenu}",localeClass:t,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:t.getColumnPickerItems(i),onToggle:t.onColumnToggle,disabled:t.disabled}),e.hideable!==!1&&!e.parent.isCollapsible&&(r.hideColumn={text:"L{hideColumn}",localeClass:t,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!e.allowDrag||t.disabled,onItem:()=>e.hide()})}onColumnToggle({menu:e,item:r,checked:t}){var i,n;if(!!r.column.hidden!=!t){r.column[t?"show":"hide"]();const{grid:s,column:a}=r,{columns:o,features:l}=s,c=e.items,d=o.visibleColumns.filter(f=>f.region===r.column.region),u=((i=l.headerMenu)==null?void 0:i.enabled)&&l.headerMenu.menu.widgetMap.hideColumn;if(d.length===1){const f=c.find(g=>g.column===d[0]);f&&(f.disabled=!0),u&&a.region===r.column.region&&(u.disabled=!0)}else d.forEach(f=>{const g=c.find(m=>m.column===f);g&&(g.disabled=!1)}),u&&a.region===r.column.region&&(u.disabled=!1);(n=r.menu)==null||n.eachWidget(f=>{f.checked=t});const h=e.owner;h&&h.column===a.parent&&(h.checked=c.some(f=>f.checked===!0))}}getColumnDragToolbarItems(e,r){const t=this.grid.columns.visibleColumns.filter(i=>i.region===e.region);return e.hideable!==!1&&t.length>1&&r.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:i})=>i.hide()}),r}};R(fo,"$name","ColumnPicker"),R(fo,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),fo._$name="ColumnPicker",z.registerFeature(fo,!0);var go=class extends X{doDestroy(){var e;(e=this.editor)==null||e.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:e,column:r}){e.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:r.readOnly,onItem:()=>this.startEdit(r)}}startEdit(e){var r;if(e instanceof Event&&(e=(r=this.client.getHeaderDataFromEvent(e))==null?void 0:r.column),e){if(e.readOnly)return!1;const{textWrapper:t}=e;let{editor:i}=this;i||(this.editor=i=new Qt({owner:this.client,align:{align:"t0-t0"}})),i.render(t),i.startEdit({target:t,record:e,field:"text"})}}};R(go,"$name","ColumnRename"),R(go,"configurable",{keyMap:{F2:"startEdit"}}),go._$name="ColumnRename",z.registerFeature(go,!1);var mo=class extends ge(X){constructor(){super(...arguments),R(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}doDestroy(){var e,r;(e=this.dragHelper)==null||e.scrollManager.destroy(),(r=this.dragHelper)==null||r.destroy(),super.doDestroy()}get grid(){return this.client}init(){const e=this,{grid:r}=e,t=r.element,i=C.children(t,".b-grid-headers");i.push(...C.children(t,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=i:(e.dragHelper=new Yi({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:r,rtlSource:r,outerElement:r.headerContainer,monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:Sc.new({direction:"horizontal",element:r.headerContainer}),containers:i,isElementDraggable(n){if(!!n.closest(e.ignoreSelectors.join(","))||e.disabled)return!1;const a=n.closest(this.targetSelector),o=a&&r.columns.getById(a.dataset.columnId),l=(o==null?void 0:o.childLevel)===0&&r.subGrids[o.region].columns.count===1;return!!o&&o.draggable!==!1&&!l},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["onPaint","renderContents"]}}onBeforeDragStart({context:e,event:r}){const{element:t}=e,i=e.column=this.client.columns.getById(t.dataset.columnId);return i.allowDrag&&this.client.trigger("beforeColumnDragStart",{column:i,event:r})}onDragStart({context:e,event:r}){const t=this,{grid:i}=t,{column:n}=e;if(!i.features.columnDragToolbar){const s=i.element.querySelector(".b-grid-header-container").getBoundingClientRect();t.dragHelper.minY=s.top,t.dragHelper.maxY=s.bottom}i.headerContainer.classList.add("b-dragging-header"),e.dragProxy.style.fontSize=C.getStyleValue(e.element,"fontSize"),i.trigger("columnDragStart",{column:n,event:r})}onDrag({context:e,event:r}){const t=this,i=t.client,{insertBefore:n,column:s}=e,a=$.fromElement(r.target,"gridheader");if(i.trigger("columnDrag",{column:s,insertBefore:n,event:r,context:e}),a!=null&&a.subGrid.sealedColumns){e.valid=!1;return}e.valid&&!t.grid.features.columnDragToolbar&&(e.valid=!!r.target.closest(".b-grid-headers"))}onDrop({context:e,event:r}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{grid:i}=t,n=e.dragging,s=e.target.closest(".b-grid-header"),a=e.draggedTo.dataset.region,o=s?i.columns.get(s.dataset.column):i.subGrids[a].columns.last,l=a||o.region,c=e.insertBefore,d=i.columns.getById(n.dataset.columnId),u=d.parent,h=c?i.columns.getById(c.dataset.columnId):i.subGrids[l].columns.last.nextSibling;let f;if(h)f=h.parent;else{const m=s==null?void 0:s.parentElement.closest(".b-grid-header");m?f=i.columns.getById(m.dataset.columnId):f=i.columns.rootNode}i.headerContainer.classList.remove("b-dragging-header"),n.remove();let g=l===d.region&&u===f&&(o===d.previousSibling||h===d.nextSibling);g=g||i.trigger("beforeColumnDropFinalize",{column:d,newParent:f,insertBefore:h,event:r})===!1,g||(g=!f.insertChild(d,h)),e.valid=!g,g||(d.region=l,u.children.length===0&&u.parent.removeChild(u)),i.trigger("columnDrop",{column:d,newParent:f,insertBefore:h,valid:e.valid,event:r})}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}get isReordering(){var e;return!!((e=this.dragHelper)!=null&&e.isDragging)}};R(mo,"$name","ColumnReorder"),mo.featureClass="b-column-reorder",mo._$name="ColumnReorder",z.registerFeature(mo,!0);var Df=class extends X{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,r){const t=this;t.grid=e,super.construct(e,r),t.resizer=new Ka({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,internalListeners:{beforeresizestart:t.onBeforeResizeStart,resizestart:t.onResizeStart,resizing:t.onResizing,resize:t.onResize,cancel:t.onCancel,thisObj:t}})}doDestroy(){var e;(e=this.resizer)==null||e.destroy(),super.doDestroy()}changeLiveResize(e){return e==="auto"?!Y.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:r,resizer:t}=this,i=e.column=r.columns.getById(e.element.dataset.columnId);t.minWidth=i.minWidth,r.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:r}=this,{column:t}=e;r.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(r.resizingColumns=!1,r.afterColumnsResized(t)):t.width=e.newWidth)}onCancel({context:e}){const{grid:r}=this;r.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,r.resizingColumns=!1}};Df._$name="ColumnResize",z.registerFeature(Df,!0);var bs=class extends X.mixin(ge){constructor(){super(...arguments),R(this,"delayable",{handleSelection:"raf"})}afterConstruct(){super.afterConstruct(),this.client.selectionMode.cell||(this.disabled=!0),this._fillListeners={}}onContentChange(){this.handleSelection()}afterColumnsChange(){this.handleSelection()}fixElementHeights(){this.handleSelection()}getCellDataFromEvent(e,r){return r&&(r=!e.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(e,r)}findPatternsIn2dRange(e,r,t){const i={};for(const n of e){const s=r?n.id:n.columnId;let a=n.record[n.column.field];a&&typeof a=="string"&&!isNaN(a)&&(a=parseFloat(a)),i[s]||(i[s]=[]),i[s].push(a)}for(const n in i)i[n].pattern=this.findPatternsIn1dRange(i[n],t);return i}findPatternsIn1dRange(e,r){const t=e[r?0:e.length-1],i={next:()=>t,lastValue:t};if(e.every(n=>typeof n=="number")||e.every(n=>n instanceof Date)){const n=e.map((s,a)=>s-e[a-1]);n.shift(),new Set(n).size===1&&(i.increaseBy=n[0]*(r?-1:1),i.next=()=>(i.lastValue instanceof Date?i.lastValue=new Date(i.lastValue.getTime()+i.increaseBy):i.lastValue+=i.increaseBy,i.lastValue))}else e.length>1&&(i.stringPattern=[...e],i.next=()=>(i.currentIndex===void 0?i.currentIndex=0:(i.currentIndex+=1,i.currentIndex>=i.stringPattern.length&&(i.currentIndex=0)),i.stringPattern[i.currentIndex]));return i}afterSelectionChange(){const e=this;if(e.client.readOnly){e.removeElements();return}he.isMouseDown()?(e.client.delayUntilMouseUp(()=>e.handleSelection(!0)),e.removeElements()):e.handleSelection(!0)}handleSelection(){if(!this._isExtending){const e=this.rangeSelection;e?this.drawFillHandleAndBorder(e[0],e[e.length-1]):this.removeElements()}}onMouseDown(e){const{client:r}=this;r.readOnly||(this._fillListeners.mouseMoveOrUp=j.on({element:globalThis,mouseover:{handler:"onMouseOver",element:r.selectionDragMouseEventListenerElement},mouseup:"onMouseUp",thisObj:this}),e.preventDefault(),e.stopImmediatePropagation(),e.handled=!0)}onMouseUp(){var e,r;const t=this,{client:i,currentRange:n,_isCropping:s}=t,a=t.rangeSelection,o=a&&n&&i.internalSelectRange(n.from,n.to),l=(o==null?void 0:o.selectedCells)||[],c=s?t.croppingCells:l.filter(d=>!a.some(u=>u.equals(d,!0)));if(delete t._isCropping,t._isExtending&&(i.disableScrollingCloseToEdges(i.items),delete t._isExtending),!(c!=null&&c.length)){t.handleSelection();return}if(i.suspendRefresh(),s)c.forEach(d=>d.record.set(d.column.field,null,!1,!1,!1,!0));else{const[d]=c,u=a.some(m=>m.record===d.record),h=u?d.columnIndex<a[0].columnIndex:d.rowIndex<a[0].rowIndex,f=t.findPatternsIn2dRange(a,u,h),g=new Map;h&&c.reverse();for(const m of c){const{column:p,record:v}=m;if(!p.readOnly&&p.canFillValue({range:a,record:v,cell:m})){let y=(e=t.calculateFillValue)==null?void 0:e.call(t,{range:a,column:p,record:v,cell:m}),S=g.get(v);S||(S={},g.set(v,S)),y===void 0&&(y=f[u?m.id:m.columnId].pattern.next()),S[p.field]=((r=p.calculateFillValue)==null?void 0:r.call(p,{value:y,record:v,range:a}))||y}}for(const[m,p]of g)m.set(p,null,null,null,null,!0)}i.resumeRefresh(!0),i.performSelection(o),delete t.currentRange,t.handleSelection()}onMouseOver(e){var r;const t=this,{client:i,rangeSelection:n}=t,s=n[0],a=n[n.length-1],o=i.getCellDataFromEvent(e,!0);let l=o&&i.normalizeCellContext(o.cellSelector);if(((r=l==null?void 0:l._column)==null?void 0:r.region)===s._column.region){const c=n.some(f=>f.equals(l,!0));let d;t._isExtending||i.enableScrollingCloseToEdges(i.items),c?t._isCropping=t.allowCropping&&(l.rowIndex<a.rowIndex||l.columnIndex<a.columnIndex):l.rowIndex>=s.rowIndex&&l.rowIndex<=a.rowIndex?(d=s.columnIndex>l.columnIndex,l=new ne({grid:i,record:d?s.record:a.record,column:l.column})):(d=s.rowIndex>l.rowIndex,l=new ne({grid:i,record:l.record,column:d?s.column:a.column}));const u=d?l:s,h=d||c&&!t._isCropping?a:l;t.currentRange={from:u,to:h},t._isExtending=!0,t.drawFillHandleAndBorder(u,h,!0)}}drawFillHandleAndBorder(e,r,t=!1){var i;const n=this,{client:s,currentRange:a,_fillListeners:o}=n,l=s.subGrids[e.column.region].element,{x:c}=k.from(e.cell||e.column.element,l),{right:d}=k.from(r.cell||r.column.element,l),{y:u}=s.getRecordCoords(e.record,!0),h=s.getRecordCoords(r.record,!0).bottom-1;let{borderElement:f,handleElement:g}=n;if(n.removeElements(t),f||(n.borderElement=f=C.createElement({className:"b-fill-selection-border"}),n.handleElement=g=C.createElement({className:"b-fill-handle"})),C.setRect(f,{y:u,x:c,width:d-c,height:h-u}),l.appendChild(f),C.setTopLeft(g,h,d>=l.scrollWidth?c:d),l.appendChild(g),n.toggleCroppingCls(!1),delete n.croppingCells,n._isCropping&&((i=n.rangeSelection)!=null&&i.length)){const m=s.getRange(a.from,a.to);n.croppingCells=n.rangeSelection.filter(p=>!m.some(v=>v.equals(p,!0))),n.toggleCroppingCls()}o.handleClick||(o.handleClick=j.on({element:s.rootElement,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:n})),n.hasFillElements=!0}toggleCroppingCls(e=!0){var r;(r=this.croppingCells)==null||r.forEach(t=>{var i;return(i=this.client.getCell(t))==null?void 0:i.classList.toggle("b-indicate-crop",e)})}removeElements(e=!1){var r,t;const i=this;(r=i.handleElement)==null||r.remove(),(t=i.borderElement)==null||t.remove(),e||i.removeListeners(),i.hasFillElements=!1}removeListeners(){const e=this;for(const r in e._fillListeners)e._fillListeners[r]();e._fillListeners={}}get rangeSelection(){var e;const{client:r}=this,{selectedCells:t}=r,i=(e=r._shiftSelectRange)!=null?e:t.length===1&&t;return!r._selectedRows.length&&(i!=null&&i.length)&&i.length===t.length&&i.every(n=>t.some(s=>n.equals(s,!0))&&n._column.parent&&n._column.region===i[0]._column.region&&r.store.isAvailable(n.id))?i:null}};R(bs,"$name","FillHandle"),R(bs,"configurable",{calculateFillValue:null,allowCropping:!1}),R(bs,"pluginConfig",{chain:["afterSelectionChange","onContentChange","afterColumnsChange","fixElementHeights"],override:["getCellDataFromEvent"]}),bs._$name="FillHandle",z.registerFeature(bs);var Ef=class extends hi{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){var e;const r=this;if(!r.grid)throw new Error(`${r.constructor.$name} requires 'grid' to be configured.`);r.fields=(e=r.fields)!=null?e:{},super.afterConstruct()}updateGrid(e){var r;if(!((r=e.store)!=null&&r.modelClass))throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getModelClassFields(e){const r=new Set(e.fields.map(({name:t})=>t));return(e==null?void 0:e.allFields.filter(t=>!t.internal&&(bS.includes(t.type)||sf(t))&&(t.definedBy!==ae||r.has(t.name))))||[]}static getColumnFields(e,r,t){var i;const n=H.keyBy(Ef.getModelClassFields(r),"name"),s=t&&new Set(t);return Object.fromEntries((i=e==null?void 0:e.records.filter(({field:a})=>a&&n[a]&&(!s||s.has(a))).map(({field:a,text:o})=>[a,{title:o||a,type:sf(n[a])?"duration":n[a].type}]))!=null?i:[])}changeFields(e){var r;let t=e;return Array.isArray(e)&&(re.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),t=H.keyBy(t,"name")),T.merge({},Ef.getColumnFields(this.grid.columns,(r=this.grid.store)==null?void 0:r.modelClass,this.allowedFieldNames),t)}},$c=Ef;R($c,"configurable",{grid:null,allowedFieldNames:null}),$c.initClass(),$c._$name="GridFieldFilterPicker";var po=class extends en{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:r,allowedFieldNames:t}=this;return{...super.getFilterPickerConfig(e),grid:r,allowedFieldNames:t}}updateGrid(e){this.store=this.grid.store}canManage(e){const r=this;return super.canManage(e)&&(!r.allowedFieldNames||r.allowedFieldNames.includes(e.property))}};R(po,"configurable",{grid:null,allowedFieldNames:null}),R(po,"childPickerType","gridfieldfilterpicker"),po.initClass(),po._$name="GridFieldFilterPickerGroup";var xf={date:"date",int:"number",integer:"number",number:"number",string:"text",duration:"duration"},Rf=class extends X{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},isMulti:!1}}construct(e,r){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const t=this;if(t.grid=e,t.closeFilterEditor=t.closeFilterEditor.bind(t),super.construct(e,r),t.bindStore(e.store),r&&typeof r=="object"){const i=T.clone(r);delete i.prioritizeColumns,delete i.isMulti,delete i.dateFormat,T.isEmpty(i)||e.store.filter(i,null,e.isConfiguring)}}doDestroy(){var e,r;(e=this.filterTip)==null||e.destroy(),(r=this.filterEditorPopup)==null||r.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const r=this,t=r.grid,i=t.headerContainer;i&&(C.children(i,".b-filter-icon.b-latest").forEach(n=>n.classList.remove("b-latest")),r.filterTip||(r.filterTip=new ue({forElement:i,forSelector:".b-filter-icon",getHtml({activeTarget:n}){return n.dataset.filterText}})),t.store.isFiltered||r.filterTip.hide(),t.columns.visibleColumns.forEach(n=>{if(n.filterable!==!1){const s=r.store.filters.allValues.filter(({property:l,disabled:c,internal:d})=>l===n.field&&!c&&!d),a=s.length>0,o=n.element;if(o){const l=n.textWrapper;let c=l==null?void 0:l.querySelector(".b-filter-icon"),d;if(a){const u="&#x2022 ";d=`${r.L("L{filter}")}: `+(s.length>1?"<br/><br/>":"")+s.map(h=>{var f,g,m,p;let v=(f=h.value)!=null?f:"";const y=Array.isArray(v),S=(m=(g=r.store)==null?void 0:g.modelRelations)==null?void 0:m.find(({foreignKey:D})=>D===h.property);if(h.displayValue)v=h.displayValue;else{if(r.isMulti&&S){const{relatedDisplayField:D}=(p=r.isMulti.fields)==null?void 0:p[h.property];if(D){const w=E=>{var x;return(x=S.foreignStore.getById(E))==null?void 0:x[D]};y?v=v.map(w).sort((E,x)=>(E!=null?E:"").localeCompare(x!=null?x:"")):v=w(v)}}else n.formatValue&&v&&(v=y?v.map(D=>n.formatValue(D)):n.formatValue(v));y&&(v=`[ ${v.join(", ")} ]`)}return(s.length>1?u:"")+(typeof h=="string"?h:`${h.operator} ${v}`)}).join("<br/><br/>")}else d=r.L("L{applyFilter}");c?c.dataset.filterText=d:c=C.createElement({parent:l,tag:"div",className:"b-filter-icon",dataset:{filterText:d}}),n.field===r.store.latestFilterField&&c.classList.add("b-latest"),o.classList.add("b-filterable"),o.classList.toggle("b-filter",a)}n.meta.isFiltered=a}}),e&&t.refreshRows())}applyFilter(e,r){const{store:t}=this,{filterFn:i}=e.filterable;e.$filter=t.addFilter({...e.filterable,...r,property:e.field,[i?"filterBy":"_"]:function(n){return i({value:this.value,record:n,operator:this.operator,property:this.property,column:e})}},!0),t.filter()}removeFilter(e){if(this.isMulti)for(const r of this.getCurrentMultiFilters(e))this.store.removeFilter(r);else this.store.removeFilter(e.field)}disableFilter(e){for(const r of this.getCurrentMultiFilters(e))r.disabled=!0,this.store.filter(r);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter(r=>r.property===e.field)}getPopupDateItems(e,r,t,i,n,s,a,o){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:f}){f.key==="Enter"&&s()}function h({source:f,value:g}){g==null?d():(l.clearSiblingsFields(f),l.applyFilter(e,{operator:f.operator,value:g,displayValue:f._value,type:"date"}))}return[T.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="sameDay"?t.value:i,operator:"sameDay",onKeydown:u,onChange:h,onClose:c,onClear:d},o),T.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onKeydown:u,onChange:h,onClose:c,onClear:d},o),T.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onKeydown:u,onChange:h,onClose:c,onClear:d},o)]}getPopupNumberItems(e,r,t,i,n,s,a,o){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:f}){f.key==="Enter"&&s()}function h({source:f,value:g}){g==null?d():(l.clearSiblingsFields(f),l.applyFilter(e,{operator:f.operator,value:g}))}return[T.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="="?t.value:i,operator:"=",onKeydown:u,onChange:h,onEsc:c,onClear:d},o),T.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:c,onClear:d},o),T.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onKeydown:u,onChange:h,onEsc:c,onClear:d},o)]}clearSiblingsFields(e){var r;(r=this.filterEditorPopup)==null||r.items.forEach(t=>{t!==e&&(t==null||t.clear())})}getPopupDurationItems(e,r,t,i,n,s,a,o){const l=this,c=s,d=()=>l.removeFilter(e);function u({source:h,value:f}){f==null?d():(l.clearSiblingsFields(h),l.applyFilter(e,{operator:h.operator,value:f}))}return[T.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="="?t.value:i,operator:"=",onChange:u,onEsc:c,onClear:d},o),T.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onChange:u,onEsc:c,onClear:d},o),T.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onChange:u,onEsc:c,onClear:d},o)]}getPopupStringItems(e,r,t,i,n,s,a,o){const l=this;return[T.assign({type:r,cls:"b-last-row",placeholder:"L{filter}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t?t.value||t:i,operator:"*",onChange({source:c,value:d}){d===""?a():(l.applyFilter(e,{operator:c.operator,value:d,displayValue:c.displayField&&c.records?c.records.map(u=>u[c.displayField]).join(", "):void 0}),c.multiSelect||s())},onClose:s,onClear:a},o)]}getPopupItems(e,r,t,i,n,s,a,o){const l=this;if(l.isMulti)return l.getMultiFilterPopupItems(...arguments);switch(r){case"date":return l.getPopupDateItems(...arguments);case"number":return l.getPopupNumberItems(...arguments);case"duration":return l.getPopupDurationItems(...arguments);default:return l.getPopupStringItems(...arguments)}}getMultiFilterPopupItems(e){var r;const{grid:t,isMulti:i}=this,n=(r=t.store)==null?void 0:r.filters.find(s=>s.property===e.field);return[{...typeof i=="object"?i:void 0,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:t,filters:n?[]:[{property:e.field}],propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",width:"400px"}]}showFilterEditor(e,r){e=this.grid.columns.getById(e);const t=this,{store:i,isMulti:n}=t,s=e.element,a=i.filters.getBy("property",e.field),o=t.getFilterType(e);if(e.filterable===!1)return;t.closeFilterEditor();const l=t.getPopupItems(e,o,a!=null&&a.internal?null:a,r,i,t.closeFilterEditor,()=>{t.removeFilter(e),t.closeFilterEditor()},e.filterable.filterField,n);l.forEach(c=>c.placeholder=c.placeholder?this.L(c.placeholder):c.placeholder),t.filterEditorPopup=rs.openPopup(s,{owner:t.grid,cls:"b-filter-popup",scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:l})}closeFilterEditor(){var e;(e=this.filterEditorPopup)==null||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){const r=e.field,t=this.client.store.modelClass.getFieldDefinition(r),i=e.filterType;return i?xf[i]:xf[e.type]||t&&xf[t.type]||"text"}populateCellMenuWithDateItems({column:e,record:r,items:t}){const i=e.field;if(this.getFilterType(e)==="date"){const s=this,a=r[i],o=l=>{s.applyFilter(e,{operator:l,value:a,displayValue:e.formatValue?e.formatValue(a):a,type:"date"})};t.filterDateEquals={text:"L{on}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>o("=")},t.filterDateBefore={text:"L{before}",localeClass:s,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:s.disabled,onItem:()=>o("<")},t.filterDateAfter={text:"L{after}",localeClass:s,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:s.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:r,items:t}){const i=e.field;if(this.getFilterType(e)==="number"){const s=this,a=r[i],o=l=>{s.applyFilter(e,{operator:l,value:a})};t.filterNumberEquals={text:"L{equals}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>o("=")},t.filterNumberLess={text:"L{lessThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:s.disabled,onItem:()=>o("<")},t.filterNumberMore={text:"L{moreThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:s.disabled,onItem:()=>o(">")}}}populateCellMenuWithDurationItems({column:e,record:r,items:t}){if(this.getFilterType(e)==="duration"){const n=this,s=e.getFilterableValue(r),a=o=>{n.applyFilter(e,{operator:o,value:s})};t.filterDurationEquals={text:"L{equals}",localeClass:n,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:n.disabled,onItem:()=>a("=")},t.filterDurationLess={text:"L{lessThan}",localeClass:n,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:n.disabled,onItem:()=>a("<")},t.filterDurationMore={text:"L{moreThan}",localeClass:n,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:n.disabled,onItem:()=>a(">")}}}populateCellMenuWithStringItems({column:e,record:r,items:t}){var i,n;const s=this.getFilterType(e);if(!/(date|number|duration)/.test(s)){const a=this,o=e.getFilterableValue(r),l=(n=(i=e.filterable.filterField)==null?void 0:i.operator)!=null?n:"*";t.filterStringEquals={text:"L{equals}",localeClass:a,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:a.disabled,onItem:()=>a.applyFilter(e,{value:o,operator:l})}}}populateCellMenu({column:e,record:r,items:t}){const i=this;e.filterable!==!1&&!r.isSpecialRow&&(i.populateCellMenuWithDateItems(...arguments),i.populateCellMenuWithNumberItems(...arguments),i.populateCellMenuWithDurationItems(...arguments),i.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(t.filterRemove={text:"L{removeFilter}",localeClass:i,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:400,disabled:i.disabled||i.isMulti&&!i.columnHasRemovableFilters(e),onItem:()=>i.removeFilter(e)}),i.isMulti&&(t.filterDisable={text:"L{disableFilter}",localeClass:i,icon:"b-fw-icon b-icon-filter-disable",cls:"b-separator",weight:400,disabled:i.disabled||!i.columnHasEnabledFilters(e),onItem:()=>i.disableFilter(e)}))}columnHasRemovableFilters(e){const r=this;return!!r.getCurrentMultiFilters(e).find(t=>!r.canDeleteFilter||r.callback(r.canDeleteFilter,r,[t])!==!1)}columnHasEnabledFilters(e){return!!this.getCurrentMultiFilters(e).find(r=>!r.disabled)}populateHeaderMenu({column:e,items:r}){const t=this;e.meta.isFiltered?(r.editFilter={text:"L{editFilter}",localeClass:t,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:t.disabled,onItem:()=>t.showFilterEditor(e)},r.removeFilter={text:"L{removeFilter}",localeClass:t,weight:110,icon:"b-fw-icon b-icon-remove",disabled:t.disabled||t.isMulti&&!t.columnHasRemovableFilters(e),onItem:()=>t.removeFilter(e)},t.isMulti&&(r.disableFilter={text:"L{disableFilter}",localeClass:t,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:t.disabled||!t.columnHasEnabledFilters(e),onItem:()=>t.disableFilter(e)})):e.filterable!==!1&&(r.filter={text:"L{filter}",localeClass:t,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:t.disabled,onItem:()=>t.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){var r;const{columns:t}=this.client;for(let i=0;i<e.count;i++){const n=e.getAt(i);if(!n.internal){const s=(n.columnOwned||this.prioritizeColumns)&&t.find(a=>a.filterable!==!1&&a.field===n.property);(r=s==null?void 0:s.filterable)!=null&&r.filterFn&&(s.$filter||(s.$filter=new it({columnOwned:!0,property:n.property,operator:n.operator,value:n.value,filterBy(a){return s.filterable.filterFn({value:this.value,record:a,operator:this.operator,property:this.property,column:s})}})),s.$filter.value=n.value,s.$filter.displayValue=n.displayValue,s.$filter.operator=n.operator,e.splice(i,1,s.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const r=e.closest(".b-grid-header");return this.showFilterEditor(r.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const r=e.matches(".b-grid-header")&&e;return r&&this.showFilterEditor(r.dataset.columnId),!!r}isActionAvailable({event:e}){const r=e.target.closest(".b-grid-header"),t=r&&this.client.columns.find(i=>i.id===r.dataset.columnId);return!!(t!=null&&t.filterable)}};Rf._$name="Filter",z.registerFeature(Rf);var AP={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null},jc=class extends X{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,r){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const t=this;t.grid=e,t.onColumnFilterFieldChange=t.onColumnFilterFieldChange.bind(t),super.construct(e,Array.isArray(r)?{filter:r}:r),t.bindStore(e.store),t.filter&&e.store.filter(t.filter),t.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:t})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),(e=this.gridDetacher)==null||e.call(this),super.doDestroy()}doDisable(e){const{columns:r}=this.grid;r==null||r.forEach(t=>{const i=this.getColumnFilterField(t);i&&(i.disabled=e)}),super.doDisable(e)}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const r in this._columnFilters){const t=this._columnFilters[r];t.placeholder=e?t.column.headerText:null}}destroyFilterBar(){var e;(e=this.grid.columns)==null||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const r=this;r.clearStoreFiltersOnHide&&r.suspendStoreTracking(),(e=r.grid.columns)==null||e.forEach(t=>r.hideColumnFilterField(t,!0)),r.grid.store.filter(),r.clearStoreFiltersOnHide&&r.resumeStoreTracking(),r.hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(),this.resumeStoreTracking(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach(e=>this.renderColumnFilterField(e)),this.rendered=!0)}renderColumnFilterField(e){const r=this,{grid:t}=r,i=r.getColumnFilterable(e);if(i&&e.isVisible){const n=e.element,s=t.store.filters.get(e.id)||t.store.filters.getBy("property",e.field);let a=r.getColumnFilterField(e);if(a)r.onColumnFilterFieldChange({source:a,value:a.value}),a.render(n),a.show();else{const o=`${e.filterType||"text"}field`,{filterField:l}=i,c=l==null?void 0:l.cls;c&&delete i.filterField.cls,a=rs.append(T.assign({type:o,cls:{[r.filterFieldCls]:1,[c]:c},dataset:{column:e.field},column:e,owner:t,clearable:!0,name:e.field,value:s&&!s._filterBy&&!s.internal?r.buildFilterValue(s):"",inputCls:r.filterFieldInputCls,keyStrokeChangeDelay:r.keyStrokeFilterDelay,onChange:r.onColumnFilterFieldChange,onClear:r.onColumnFilterFieldChange,disabled:r.disabled,placeholder:r.compactMode?e.headerText:null,format:e.format},l),n)[0],l!=null&&l.hasOwnProperty("min")||Object.defineProperty(a,"min",{get:()=>{var u;return(u=e.editor)==null?void 0:u.min},set:()=>null}),l!=null&&l.hasOwnProperty("max")||Object.defineProperty(a,"max",{get:()=>{var u;return(u=e.editor)==null?void 0:u.max},set:()=>null}),l!=null&&l.hasOwnProperty("strictParsing")||Object.defineProperty(a,"strictParsing",{get:()=>{var u;return(u=e.editor)==null?void 0:u.strictParsing},set:()=>null}),a.element.retainElement=!0,r.setColumnFilterField(e,a);const d=(l==null?void 0:l.store)&&(l.store.readUrl||l.store.data||l.store.isChained);if(a.isCombo&&!d&&a.store.count===0){const u=a.value,h=()=>{a.store.readUrl||a.store.isChained||(a.store.data=t.store.getDistinctValues(e.field,!0).map(f=>t.store.modelClass.new({id:f,[e.field]:f})))};a.value=null,a.store.isSorted||a.store.sort({field:e.field,ascending:!0}),a.picker.ion({beforeShow:h}),h(),a.value=u}!r.filter&&a.value&&t.store.autoLoad!==!1&&r.onColumnFilterFieldChange({source:a,value:a.value})}n.classList.add(r.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:r,store:t}=e.grid;let i,n;e._updatingFields=!0;for(const s of r.visibleColumns)i=e.getColumnFilterField(s),i&&(n=t.filters.get(s.id)||t.filters.getBy("property",s.field),n&&!n.internal?n._filterBy?i.value=n.value:i.value=e.buildFilterValue(n):i.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&e.filterable!==!1&&e.field&&e.isLeaf)return typeof e.filterable=="function"&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const r=this.getColumnFilterField(e);r&&(this.hideColumnFilterField(e,!0),r.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,r){const t=this,{store:i}=t.grid,n=e.element,s=t.getColumnFilterField(e);if(s){t.isDestroying||s.hide();const{$filter:a}=e;!i.isDestroyed&&t.clearStoreFiltersOnHide&&a&&i.removeFilter(a,r),n==null||n.classList.remove(t.filterableColumnCls)}}getColumnFilterField(e){var r;return(r=this._columnFilters)==null?void 0:r[e.id]}setColumnFilterField(e,r){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=r}parseFilterValue(e,r,t){var i;if(Array.isArray(r))return{value:r};if(T.isDate(r))return{operator:t.isDateField?"sameDay":t.isTimeField?"sameTime":"=",value:r};const n=String(r).match(this.filterParseRegExp);return{operator:n[1]||((i=e.filterable)==null?void 0:i.operator)||"*",value:n[2]}}buildFilterValue({operator:e,value:r}){return r instanceof Date||Array.isArray(r)?r:(e in AP?"":e)+r}onStoreBeforeFilter({filters:e}){var r;const{columns:t}=this.client;for(let i=0;i<e.count;i++){const n=e.getAt(i),s=(n.columnOwned||this.prioritizeColumns)&&t.find(a=>a.filterable!==!1&&a.field===n.property);(r=s==null?void 0:s.filterable)!=null&&r.filterFn&&(s.$filter||(s.$filter=new it({columnOwned:!0,property:n.property,id:s.id,filterBy(a){return s.filterable.filterFn({value:this.value,record:a,property:this.property,column:s})}})),s.$filter.value=n.value,e.splice(i,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({action:e,changes:r,column:t,columns:i}){!this.hidden&&(r!=null&&r.hidden)&&(r.hidden.value?this.destroyColumnFilterField(t):this.renderColumnFilterField(t)),e==="remove"&&i.forEach(n=>this.destroyColumnFilterField(n))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))e==null||e.element.remove()}disableGridNavigation(e){return e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:r}){var t,i;const n=this,{column:s}=e,{filterFn:a}=s.filterable,{store:o}=n.grid,l=s.$filter||o.filters.find(d=>(d.id===s.id||d.property===s.field)&&!d.internal);if(n._updatingFields)return;const c=r==null||r===""||Array.isArray(r)&&r.length===0;if(o.removeFilter(l,!0),s.$filter=null,c){if(!l)return}else s.$filter=o.addFilter({property:e.name,...n.parseFilterValue(s,r,e),[typeof((t=s.filterable)==null?void 0:t.caseSensitive)=="boolean"?"caseSensitive":void 0]:(i=s.filterable)==null?void 0:i.caseSensitive,[a?"filterBy":"_"]:function(d){return a({value:this.value,record:d,operator:this.operator,property:this.property,column:s})}},!0);o.filter()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}};jc.featureClass="b-filter-bar",jc._$name="FilterBar",z.registerFeature(jc);var Bc=class extends X{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}construct(e,r){const t=this;e.features.tree||(t._thisIsAUsedExpression(e.features.groupSummary),r=t.processConfig(r),t.grid=e,super.construct(e,r),t.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:t}))}processConfig(e){return typeof e=="string"?{field:e,ascending:null}:e}setConfig(e){e===null?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",thisObj:this}),this.onStoreGroup({groupers:e.groupers})}updateRenderer(e){this.groupRenderer=e}updateField(e){this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:r}=this;if(e&&r.isGrouped){const{sorters:t}=r;t.unshift(...r.groupers),this.currentGroupers=r.groupers,r.clearGroupers(),r.sort(t)}else!e&&this.currentGroupers&&(r.group(this.currentGroupers[0]),this.currentGroupers=null);super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}toggleCollapse(e,r){this.internalToggleCollapse(e,r)}internalToggleCollapse(e,r,t=!1,i){const n=this,{store:s,grid:a}=n,o=s.getById(e);o.isGroupHeader&&(r=r===void 0?!o.meta.collapsed:r,a.trigger("beforeToggleGroup",{groupRecord:o,collapse:r,domEvent:i})!==!1&&(r?s.collapse(o):s.expand(o),t||(a.rowManager.rowCount>a.store.count?a.rowManager.renderFromRow():a.rowManager.renderFromRecord(o)),a.trigger("toggleGroup",{groupRecord:o,collapse:r}),a.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(r=>e.internalToggleCollapse(r,!0,!0)),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(r=>e.internalToggleCollapse(r,!1,!0)),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const r=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(r==null?void 0:r.isGroupHeader)}renderCell(e){var r;const t=this,{cellElement:i,row:n,column:s}=e,{meta:a}=e.record,o={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in a){if(s.type==="action")return;s.clearCell(i),o["b-grid-group-collapsed"]=a.collapsed,o["b-group-row"]=1,t.buildGroupHeader(e),s===t.groupHeaderColumn&&(C.createElement({parent:i,tag:"i",className:"b-group-state-icon",nextSibling:i.firstChild}),i.classList.add("b-group-title"),i.$groupHeader=i._hasHtml=!0)}else i.$groupHeader&&((r=i.querySelector(".b-group-state-icon"))==null||r.remove(),i.classList.remove("b-group-title"),i.$groupHeader=!1);n.assignCls(o)}buildGroupHeader(e){const r=this,{record:t,cellElement:i,column:n,persist:s}=e,{grid:a}=r,o=t.meta,{groupRowFor:l}=o,{groupSummary:c}=a.features,d=o.childCount-(c&&c.target!=="header"?1:0);let u=null,h=!0;if(s||n){const f=a.columns.get(o.groupField),g=e.isFirstColumn=n===r.groupHeaderColumn;f!=null&&f.groupRenderer?g&&(u=f.groupRenderer({...e,groupRowFor:l,groupRecords:t.groupChildren,groupColumn:f,count:d}),h=!1):r.groupRenderer&&(u=r.groupRenderer({...e,groupRowFor:l,groupRecords:t.groupChildren,groupColumn:f,count:d,isFirstColumn:g})),g&&u==null&&h&&C.getChildElementCount(i)===0&&(u=L.encodeHtml(`${l==="__novalue__"?"":l} (${d})`))}else r.groupRenderer&&(u=r.groupRenderer(e));return typeof u=="string"?i.innerHTML=u:typeof u=="object"&&q.sync({targetElement:i,domConfig:{onlyChildren:!0,children:H.asArray(u)}}),C.getChildElementCount(i)>0&&(i._hasHtml=!0),i.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find(e=>!e.groupHeaderReserved)}renderHeader(e){const{store:r,grid:t}=this;if(r.isGrouped)for(const i of r.groupers){const n=t.columns.get(i.field),s=n&&t.getHeaderElement(n.id);s==null||s.classList.add("b-group",i.ascending?"b-asc":"b-desc")}}populateHeaderMenu({column:e,items:r}){const t=this;e.groupable!==!1&&(r.groupAsc={text:"L{groupAscending}",localeClass:t,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:t.disabled,onItem:()=>t.store.group(e.field,!0)},r.groupDesc={text:"L{groupDescending}",localeClass:t,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:t.disabled,onItem:()=>t.store.group(e.field,!1)}),t.store.isGrouped&&(r.groupRemove={text:"L{stopGrouping}",localeClass:t,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:t.disabled,onItem:()=>t.store.clearGroupers()})}getColumnDragToolbarItems(e,r){var t;const i=this,{store:n,disabled:s}=i;r.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:i,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:o})=>n.group(o.field,!0)}),r.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:i,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:o})=>n.group(o.field,!1)});const a=((t=n.groupers)==null?void 0:t.some(o=>o.field===e.field))&&!s;return r.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:i,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!a,weight:110,onDrop:({column:o})=>n.removeGrouper(o.field)}),r}onStoreGroup({groupers:e}){const{grid:r}=this,{element:t}=r,i=t&&C.children(t,".b-grid-header.b-group");if(t){for(const n of i)n.classList.remove("b-group","b-asc","b-desc");if(e)for(const n of e){const s=r.getHeaderElementByField(n.field);s&&s.classList.add("b-group",n.ascending?"b-asc":"b-desc")}}}onStoreChange({action:e,records:r}){const{client:t}=this,{rowManager:i,store:n}=t;if(n.isGrouped&&e==="move"){const{field:s}=n.groupers[0],a=Math.min(...r.reduce((o,l)=>{if(o.push(n.indexOf(l.instanceMeta(n).groupParent)),s in l.meta.modified){const c=n.groupRecords.find(d=>d.meta.groupRowFor===l.meta.modified[s]);c&&o.push(n.indexOf(c))}return o},[]));i.renderFromRow(i.getRow(a))}}onElementTouchStart(e){const r=this,{target:t}=e,i=t.closest(".b-grid-header"),n=i&&r.grid.getColumnFromElement(i);e.touches.length>1&&n&&n.groupable!==!1&&!r.disabled&&r.store.group(n.field)}onElementClick(e){var r;const t=this,{store:i}=t,{target:n}=e,s=n.closest(".b-group-row"),a=n.closest(".b-grid-header"),o=a==null?void 0:a.dataset.column;if(!(n.classList.contains("b-resizer")||t.disabled||n.classList.contains("b-action-item")||e.handled)){if(a&&o){const l=(r=i.groupers)==null?void 0:r.find(c=>c.field===o);if(l&&!e.shiftKey)return l.ascending=!l.ascending,i.group(),!1;e.shiftKey&&t.grid.columns.get(o).groupable!==!1&&(e.altKey?i.removeGrouper(o):i.group(o))}if(s&&(t.toggleOnRowClick||e.target.classList.contains("b-group-state-icon")))return t.internalToggleCollapse(ze.get(s).id,void 0,void 0,e),!1}}toggleGroup(e){var r;const{grid:t}=this,{focusedCell:i}=t;return!this.disabled&&!i.isActionable&&((r=i.record)!=null&&r.isGroupHeader)?(this.internalToggleCollapse(i.id),!0):!1}};Bc._$name="Group",z.registerFeature(Bc,!0,["Grid","Scheduler"]),z.registerFeature(Bc,!1,["TreeGrid"]);var IS=e=>class extends(e||F){static get $name(){return"SummaryFormatter"}generateHtml(t,i,n,s,a,o){const l=this.store,c=t.summaries||(t.sum?[{sum:t.sum,renderer:t.summaryRenderer}]:[]);let d=`<table class="${n}">`;return c.forEach(u=>{let h=u.sum,f=null;switch(h===!0&&(h="sum"),h){case"sum":case"add":f=l.sum(t.field,i);break;case"max":f=l.max(t.field,i);break;case"min":f=l.min(t.field,i);break;case"average":case"avg":f=l.average(t.field,i);break;case"count":f=i.length;break;case"countNotEmpty":f=i.reduce((g,m)=>{const p=m[t.field];return g+(p!=null?1:0)},0);break}if(typeof h=="function"&&(f=i.reduce(h,"seed"in u?u.seed:0)),f!==null){const g="b-grid-summary-value",m=u.label?`<td class="b-grid-summary-label">${u.label}</td>`:"";let p=u.renderer?u.renderer({config:u,sum:f}):f,v;p==null&&(p=""),String(p).includes("<td>")?v=p:v=m?`${m}<td class="${g}">${p}</td>`:`<td colspan="2" class="${g}">${p}</td>`,d+=`<tr>${v}</tr>`}}),d+"</table>"}},vo=class extends IS(X){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(e,r){if(this.grid=e,super.construct(e,r),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.updateTarget(this.target),super.doDisable(e)}changeTarget(e){return T.assertString(e,"target"),e}updateTarget(e){this.store.useGroupFooters=!this.disabled&&e==="footer",this.isConfiguring||this.store.group()}changeCollapseToHeader(e){return T.assertBoolean(e,"collapseToHeader"),e}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:r}){e.isGroupFooter&&!("groupFooterFor"in r.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!r.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:r,row:t,record:i,size:n,isFirstColumn:s}){const a=this,{meta:o}=i,{rowHeight:l}=a.grid,c="groupRowFor"in o,d="groupFooterFor"in o,u=a.target==="header",h={"b-group-footer":0,"b-header-summary":0},f=c&&(u||a.collapseToHeader&&o.collapsed)&&!s||d&&!u;if((c||d)&&(n.height=c&&n.height||l),a.store.isGrouped&&f&&!a.disabled){e.clearCell(r);const g=c?i:o.groupRecord;t.isGroupFooter=d,t.isGroupHeader=c,d?h["b-group-footer"]=1:h["b-header-summary"]=1;const m=a.updateSummaryHtml(r,e,g),p=typeof m=="number"?m:m.count;p>1&&(n.height+=o.collapsed&&!u?0:p*l*.1),m.height&&(n.height+=m.height)}t.assignCls(h)}updateSummaryHtml(e,r,t){const i=t.groupChildren.slice();i[i.length-1].isGroupFooter&&i.pop();const n=this.generateHtml(r,i,"b-grid-group-summary",t,t.meta.groupField,t.meta.groupRowFor);return e.children.length?C.sync(n,e.firstElementChild):e.innerHTML=n,r.summaries?r.summaries.length:r.sum?1:0}onStoreUpdate({source:e,changes:r}){if(!this.disabled&&e.isGrouped){if(r&&e.groupers.find(i=>i.field in r))return;Object.keys(r).some(i=>{const n=this.grid.columns.get(i);return!!n&&(!!n.sum||!!n.summaries)})&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach(e=>{this.hasSummary(e)&&this.grid.refreshColumn(e)})}hasSummary(e){return e.sum||e.summaries}};vo.featureClass="b-group-summary",vo._$name="GroupSummary",z.registerFeature(vo);var yo=class extends es{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:r}=e;return r&&r.enableHeaderContextMenu!==!1&&r!==this.client.timeAxisColumn}getDataFromEvent(e){return T.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:r}){const t=this;if(r){if(r.headerMenuItems&&T.merge(e,r.headerMenuItems),r.isCollapsible){const{collapsed:i}=r,n=i?t.client.rtl?"left":"right":t.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${n}`,text:t.L(i?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>r.collapsed=!i}}if(t.moveColumns){const i=t.getColumnToMoveBefore(r),n=t.getColumnToMoveAfter(r);i&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:t.L("L{moveBefore}",L.encodeHtml(i.text)),onItem:()=>{var s;const{parent:a}=r;i.parent.insertChild(r,i)&&(r.region=i.region,(s=a.children)!=null&&s.length||a.remove())}}),n&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:t.L("L{moveAfter}",L.encodeHtml(n.text)),onItem:()=>{var s;const{parent:a}=r;n.parent.insertChild(r,n.nextSibling)&&(r.region=n.region,(s=a.children)!=null&&s.length||a.remove())}})}}return e}getColumnToMoveBefore(e){const{previousSibling:r,parent:t}=e;if(r)return r.children&&!e.children?r.children[r.children.length-1]:r;if(!t.isRoot)return t}getColumnToMoveAfter(e){const{nextSibling:r,parent:t}=e;if(r)return r;if(!t.isRoot)return t}};yo.featureClass="",yo._$name="HeaderMenu",z.registerFeature(yo,!0);var _P={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",pointerover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"},bo=class extends X{constructor(){super(...arguments),R(this,"mergedRanges",[]),R(this,"mergedMap",{})}static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const e=this,{client:r}=e;r.eachSubGrid(t=>e.setupSubGrid(t)),r.rowManager.ion({renderDone:"onRenderDone",thisObj:e}),e.bindStore(r.store)}setupSubGrid(e){e.$mergedCellsElement=C.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}})}doDisable(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(e)}updatePassthrough(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}beforeRenderCell(e){const{column:r,record:t,cellElement:i}=e,n=this.client.subGrids[r.region];if(!this.disabled&&r.mergeCells&&r.isSorted&&!t.isSpecialRow&&!n.collapsed){const s=this.getMergeRange(t,r);s!=null&&s.use&&(i.classList.add("b-merged-cell"),i.innerHTML="",e.cellElement=s.cellElement)}}afterRenderRow({row:e,oldId:r,oldHeight:t}){r===e.id&&t!==e.height&&(this.heightChanged=!0)}afterColumnsChange({action:e,changes:r,column:t}){if(!this.disabled){if(e==="update"&&r.mergeCells&&!t.mergeCells){for(const i of this.mergedRanges.slice())i.column===t&&this.removeRange(i);this.syncDom();return}this.refreshBounds()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}afterSelectionChange(){if(!this.passthrough){const{client:e}=this,r=e.selectedRecords.map(i=>e.store.indexOf(i));let t=!1;for(const i of this.mergedRanges){let n=!0;for(let s=i.fromIndex;s<=i.toIndex&&n;s++)n=r.includes(s);i.isSelected!==n&&(i.isSelected=n,t=!0)}t&&this.syncDom()}}getRecordFromElement(e){var r;return(r=e.elementData)!=null&&r.range?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}getColumnFromElement(e){var r;return(r=e.elementData)!=null&&r.range?e.elementData.range.column:this.overridden.getColumnFromElement(e)}populateHeaderMenu({column:e,items:r}){e.mergeable!==!1&&(r.mergeCells={text:"L{MergeCells.mergeCells}",icon:`b-fw-icon ${e.mergeCells?"b-icon-checked":"b-icon-unchecked"}`,tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>e.mergeCells=!e.mergeCells})}async handleEvent(e){var r;if(!this.passthrough){const t=e.target.closest(".b-grid-merged-cells");if(t){const{client:i}=this,{range:n}=t.elementData,{cellEdit:s}=i.features,{column:a}=n,o=L.capitalize((r=_P[e.type])!=null?r:e.type),l={grid:i,records:[],column:a,cellElement:t.firstElementChild,target:e.target,event:e};for(let c=n.fromIndex;c<=n.toIndex;c++)l.records.push(i.store.getAt(c));if(i.trigger(`mergedCell${o}`,l),(s==null?void 0:s.triggerEvent.toLowerCase())===`cell${o}`.toLowerCase()){const c=i.rowManager.getRowAt(e.clientY);await s.startEditing({id:c.id,columnId:a.id})}else e.type==="click"&&this.onRangeClick({range:n})}}}onRangeClick({range:e}){const r=[];for(let t=e.fromIndex;t<=e.toIndex;t++)r.push(this.client.store.getAt(t));this.client.selectedRecords=r}onStoreChange(){!this.disabled&&this.reset()}onStoreRefresh({action:e}){e!=="filter"&&e!=="dataset"&&!this.disabled&&this.reset(!1)}createRangeElement(e){var r,t,i;const n=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,s=`${e.fromIndex}-@-${e.column.id}`;let a=(i=(r=n.syncIdMap)==null?void 0:r[s])!=null?i:(t=n.releasedIdMap)==null?void 0:t[s];return n.releasedIdMap&&delete n.releasedIdMap[s],a||(a=C.createElement(this.createRangeDomConfig(e))),q.addChild(n,a,s),e.element=a,e.cellElement=a.firstElementChild,a}createRangeDomConfig(e){var r;const{column:t,fromIndex:i,toIndex:n,top:s,left:a,width:o,height:l}=e,{type:c}=t,d=this.client.store.getAt(i),u={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:s,left:a,height:l,width:o},dataset:{syncId:`${i}-@-${t.id}`,fromIndex:i,toIndex:n,column:t.field,columnId:t.id},children:[{className:new J(this.client.cellCls).assign({[`b-${c==null?void 0:c.toLowerCase()}-cell`]:c,[t.cellCls]:t.cellCls,[t.internalCellCls]:t.internalCellCls}).assign(t.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:t.field,columnId:t.id},style:{height:this.client.rowManager.rowHeight}}]};return(r=t.mergedRenderer)==null||r.call(t,{domConfig:u,value:t.getRawValue(d),record:d,column:t,fromIndex:i,toIndex:n}),u}buildMergedCellsConfig(e,r,t){var i,n;const s=this,{client:a}=s,{rowManager:o}=a;e=e!=null?e:(i=o.topRow)==null?void 0:i.dataIndex,r=r!=null?r:(n=o.bottomRow)==null?void 0:n.dataIndex;const l=a.regions.reduce((c,d)=>(c[d]={className:{"b-grid-merged-cells-container":1},children:[]},c),{});for(const c of s.mergedRanges)c.use&&c.fromIndex<=r&&c.toIndex>=e&&(s.updateRange(c,s.heightChanged,t),l[c.column.region].children.push(s.createRangeDomConfig(c)));return l}syncDom(e=!1){const r=this,{client:t}=r,{rowManager:i}=t;if(!e&&!i.topRow||r.disabled&&!r.isDisabling)return;const n=this.buildMergedCellsConfig();t.eachSubGrid(s=>{q.sync({targetElement:s.$mergedCellsElement,syncIdField:"syncId",domConfig:n[s.region]})}),r.heightChanged=!1}onRenderDone(){this.syncDom()}removeRange(e){H.remove(this.mergedRanges,e);for(let r=e.fromIndex;r<=e.toIndex;r++)delete this.mergedMap[`${r}-@-${e.column.id}`]}reset(e=!0){const r=this,t=r.client.columns.visibleColumns.filter(n=>n.mergeCells&&n.isSorted,!0),i=r.mergedRanges.length;if(r.mergedRanges=[],r.mergedMap={},e&&!r.client.refreshSuspended){for(const n of r.client.rowManager.rows)for(const s of t)n.renderCell(n.getCell(s.id));r.syncDom(i&&!r.client.rowManager.rowCount)}}refreshBounds(){const{mergedRanges:e}=this,r=new Map;for(const t of e.slice()){const{column:i}=t,{element:n}=i;if(n){let s=r.get(i);s||r.set(i,s=k.from(n,n.parentElement)),t.left=s.left,t.width=s.width}else this.removeRange(t)}this.syncDom()}updateRange(e,r,t=null){const{store:i,rowManager:n}=this.client,{topRendered:s,bottomRendered:a}=e,{rowOffsetHeight:o}=n;let{fromIndex:l,toIndex:c}=e,d,u;if(r=t?t.length>0:r,!(!r&&s&&a)){if(!s||r){if(t){const f=t.findIndex(g=>g.dataIndex>=l);d=t[f],l=d.dataIndex}else do d=n.getRowById(i.getAt(l));while(!d&&l++<c);e.topRendered=l===e.fromIndex;const h=l-e.fromIndex;e.top=d.top-h*(t?d.offsetHeight:o)}if(!a||r){if(t){const f=t.findIndex(g=>g.dataIndex===c);u=t[f===-1?t.length-1:f],l=u.dataIndex}else do u=n.getRowById(i.getAt(c));while(!u&&c-- >l);e.bottomRendered=c===e.toIndex;const h=e.toIndex-c;e.bottom=u.bottom+h*(t?u.offsetHeight:o)}e.height=e.bottom-e.top}}getMergeRange(e,r){if(e.isSpecialRow)return;const t=this,{mergedMap:i}=t,{store:n}=t.client,s=r.id,a=n.indexOf(e),o=`${a}-@-${s}`;let l=i[o];if(!l){const c=r.getRawValue(e);l=i[o]={column:r},t.mergedRanges.push(l);let d,u,h=a;do d=n.getAt(--h),u=d&&r.getRawValue(d),u===c&&(i[`${h}-@-${s}`]=l);while(d&&u===c);let f,g,m=a;do f=n.getAt(++m),g=f&&r.getRawValue(f),g===c&&(i[`${m}-@-${s}`]=l);while(f&&g===c);if(l.fromIndex=h+1,l.toIndex=m-1,l.toIndex-l.fromIndex>0){const p=k.from(r.element,r.element.parentElement);l.left=p.left,l.width=p.width,l.use=!0}}return!l.element&&l.use&&t.createRangeElement(l),l}};R(bo,"$name","MergeCells"),R(bo,"configurable",{passthrough:!0}),bo._$name="MergeCells",z.registerFeature(bo);var Hc=class extends X{static get $name(){return"QuickFind"}static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(e,r){super.construct(e,r),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,C.NodeFilter.SHOW_TEXT,()=>C.NodeFilter.FILTER_ACCEPT)})}isActionAvailable(){const{focusedCell:e}=this.grid;return!this.disabled&&(e==null?void 0:e.record)&&!e.isActionable&&this.find.length>0}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,r=e.grid.getHeaderElement(e.columnId);if(r){if(!e.headerField){const[t,i,n]=C.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});e.mode==="header"?r.appendChild(t):(t.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(t)),e.headerField={header:t,field:i,badge:n,colHeader:r}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,r.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.ion({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this,{grid:r,headerField:t}=e;for(const i of e.prevFound||e.found){const n=r.getRowById(i.id);if(n){n.forceInnerHTML=!0;const s=n.getCell(e.columnId);s._content=null,n.renderCell(s),n.forceInnerHTML=!1}}t&&(t.header.parentNode.removeChild(t.header),t.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(r.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),r.trigger("hideQuickFind")}search(e,r=this.columnId){const t=this,{grid:i}=t,n=i.columns.getById(r)||i.columns.get(r),s=t.store.findByField(n.field,e,n.mergeCells&&n.isSorted);let a=1;Object.assign(t,{foundMap:{},prevFound:t.found,found:s,find:e,columnId:n.id,findRe:new RegExp(`(\\s+)?(${L.escapeRegExp(String(e))})(\\s+)?`,"ig")}),e?t.showQuickFind():t.hideQuickFind();for(const o of C.children(i.element,`.${t.hitCls}`))o.classList.remove(t.hitCls,t.hitCellCls),o._originalContent&&(o.innerHTML=o._originalContent,o._originalContent=null);if(s){s.length>0&&t.gotoClosestHit(i.focusedCell,s);for(const o of s){t.foundMap[o.id]=a++;const l=i.getRowById(o.data.id);if(l==null||l.renderCell(l.getCell(n.id)),a>1e3)break}i.trigger("quickFind",{find:e,found:s})}}clear(){var e;(this.find||(e=this.found)!=null&&e.length)&&this.search("")}get foundCount(){var e,r;return(r=(e=this.found)==null?void 0:e.length)!=null?r:0}gotoHit(e){const r=this.found[e];return r&&this.grid.focusCell({columnId:this.columnId,id:r.id},{doSelect:!0}),!!r}gotoClosestHit(e,r){const t=e?this.grid.store.indexOf(e.id):0,i=r.slice().sort((n,s)=>Math.abs(n.index-t)-Math.abs(s.index-t));this.gotoHit(r.indexOf(i[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e,r,t;const i=this,{grid:n}=i,s=(t=(e=n._focusedCell)==null?void 0:e.id)!=null?t:(r=n.lastFocusedCell)==null?void 0:r.id,a=n.store.indexOf(s)||0,o=i.found.find(l=>l.index>a);o?n.focusCell({columnId:i.columnId,id:o.id},{doSelect:!0}):i.gotoFirstHit()}gotoPrevHit(){var e,r,t;const i=this,{grid:n,found:s}=i,a=(t=(e=n._focusedCell)==null?void 0:e.id)!=null?t:(r=n.lastFocusedCell)==null?void 0:r.id,o=n.store.indexOf(a)||0;let l;if(s.length){for(let c=s.length-1;c--;c>=0)if(s[c].index<o){l=s[c];break}l?n.focusCell({columnId:i.columnId,id:l.id},{doSelect:!0}):i.gotoLastHit()}}renderCell({cellElement:e,column:r,record:t}){var i;const n=this,{classList:s}=e,{treeWalker:a,findRe:o,hitTextCls:l}=n,c=n.columnId===r.id&&((i=n.foundMap)==null?void 0:i[t.id]);if(c){s.add(n.hitCls),e.isQuickHit=!0,e._originalContent=e.innerHTML;const d=a.currentNode=C.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;for(let u=a.nextNode();u&&d.contains(u);){const h=u,f=u.nodeValue,g=["<span>"];u=a.nextNode();let m=o.lastIndex;for(let p=o.exec(f);p;p=o.exec(f)){const v=f.substring(m,p.index),y=p[1]?"\xA0":"",S=p[2],D=p[3]?"\xA0":"";g.push(`${L.encodeHtml(v)}${y}<span class="${l}">${S}</span>${D}`),m=o.lastIndex}g.push(L.encodeHtml(f.substring(m)),"</span>"),h.parentNode.insertBefore(C.createElementFromTemplate(g.join(""),{fragment:!0}),h),h.remove()}C.createElement({parent:e,className:n.hitCellBadgeCls,text:c})}}onBackspace(e){const r=this;return r.find?(r.find=r.find.substr(0,r.find.length-1),r.search(r.find),!0):!1}clearSearch(){return this.find?(this.find="",this.search(this.find),!0):!1}showFilterEditor(){const e=this,{filter:r}=e.client.features;r&&e.columnId&&e.foundCount&&(e.clear(),r.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}onElementKeyPress(e){var r;const t=this,{grid:i}=t,{focusedCell:n}=i;if(!e.handled&&!t.disabled&&(n!=null&&n.record)&&!n.isActionable&&((r=e.key)==null?void 0:r.length)===1){const s=i.columns.getById(i._focusedCell.columnId);s&&s.searchable!==!1&&(t.columnId=i._focusedCell.columnId,t.find+=e.key,t.search(t.find))}}onCellNavigate(e,r,t){const i=this;i.find&&(!t||t.columnId!==i.columnId)&&i.clear()}};R(Hc,"configurable",{mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}}),Hc._$name="QuickFind",z.registerFeature(Hc);var Co=class extends X{static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const r=this,{client:t}=r,i=e.target.closest(".b-grid-splitter-collapsed");if(i&&!r.expanding){r.expanding=!0;let n=i.dataset.region,s=t.getSubGrid(n);s.collapsed||(n=t.getLastRegions()[1],s=t.getSubGrid(n)),s.expand().then(()=>r.expanding=!1)}}startMove(e,r){const t=this,{client:i}=t,n=e.dataset.region,s=i.element,a=i.regions[i.regions.indexOf(n)+1],o=i.getSubGrid(a),l=i.getSubGrid(n);let c=l,d=1;if(c.flex!=null&&o.flex==null&&(c=o,d=-1),i.rtl&&(d*=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const u=c.element.offsetWidth+o.element.offsetWidth;t.dragContext={element:e,headerEl:c.header.element,subGridEl:c.element,subGrid:c,splitterSubGrid:l,originalWidth:c.element.offsetWidth,originalX:r,minWidth:c.minWidth||0,maxWidth:Math.min(u,c.maxWidth||u),flip:d},s.classList.add("b-moving-splitter"),l.toggleSplitterCls("b-moving"),t.pointerDetacher=j.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:t})}endMove(){const e=this,{dragContext:r}=e;r&&(e.pointerDetacher(),e.client.element.classList.remove("b-moving-splitter"),r.splitterSubGrid.toggleSplitterCls("b-moving",!1),e.dragContext=null)}onCollapseClick(e,r,t){const i=this,{client:n}=i,s=r.dataset.region,a=n.getLastRegions();if(n.trigger("splitterCollapseClick",{subGrid:e,domEvent:t})!==!1){if(a[0]===s){const o=n.getSubGrid(a[1]);if(o.collapsed){o.expand();return}}e.collapse()}}onExpandClick(e,r,t){const i=this,{client:n}=i,s=r.dataset.region,a=n.getLastRegions();if(n.trigger("splitterExpandClick",{subGrid:e,domEvent:t})!==!1){if(a[0]===s&&!e.collapsed){n.getSubGrid(a[1]).collapse();return}e.expand()}}updateMove(e){const{dragContext:r}=this;if(r){const t=e-r.originalX,i=Math.max(Math.min(r.maxWidth,r.originalWidth+t*r.flip),0);r.subGrid.width=Math.max(i,r.minWidth)}}onElementPointerDown(e){const r=this,{target:t}=e,i=e.button===0&&t.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),n=i&&r.client.getSubGrid(i.dataset.region);let s;i&&(t.closest(".b-grid-splitter-button-collapse")?r.onCollapseClick(n,i,e):t.closest(".b-grid-splitter-button-expand")?r.onExpandClick(n,i,e):(r.startMove(i,e.clientX),s=i)),e.pointerType==="touch"&&r.toggleTouchSplitter(s)}onPointerMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&e.preventDefault()}onPointerUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse({subGrid:e}){const r=this.client.resolveSplitter(e);this.client.getLastRegions()[1]===e.region&&r.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:e}){this.client.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(e){const r=this,{touchedSplitter:t}=r;e&&t&&e.dataset.region!==t.dataset.region&&r.toggleTouchSplitter();const i=r.client.getSubGrid(e?e.dataset.region:t==null?void 0:t.dataset.region);i&&(i.toggleSplitterCls("b-touching",!!e),e?i.startSplitterButtonSyncing():i.stopSplitterButtonSyncing()),r.touchedSplitter=e}render(){const{regions:e,subGrids:r}=this.client;e.length>2&&(r[e[0]].splitterElement.classList.add("b-left-only"),r[e[1]].splitterElement.classList.add("b-right-only"))}};R(Co,"$name","RegionResize"),Co.featureClass="b-split",Co._$name="RegionResize",z.registerFeature(Co);var dr=class extends X{constructor(){super(...arguments),R(this,"clipboardRecords",[]),R(this,"entityName","row")}construct(e,r){super.construct(e,r),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}onBeforeRenderRow({row:e,record:r}){e.cls["b-cut-row"]=this._isCut&&this.clipboardRecords.includes(r)}isActionAvailable({event:e}){var r;const{grid:t}=this,{cellEdit:i}=t.features,{target:n}=e;return!this.disabled&&globalThis.getSelection().toString().length===0&&(!i||!i.isEditing)&&((r=t.selectedRecords)==null?void 0:r.length)>0&&(!n||!!n.closest(".b-gridbase:not(.b-schedulerbase) .b-grid-subgrid,.b-grid-subgrid:not(.b-timeaxissubgrid)"))}copy(){this.copyRows()}cut(){this.copyRows(!0)}paste(e){this.pasteRows(e!=null&&e.isModel?e:null)}copyRows(e=!1){const r=this,{client:t,entityName:i}=r,n=r.selectedRecords.filter(s=>!s.readOnly||!e);!n.length||t.readOnly||t.trigger("beforeCopy",{records:n,isCut:e,entityName:i})===!1||(r._isCut=e,r.clipboardRecords.forEach(s=>{var a;return(a=t.rowManager.getRowById(s))==null?void 0:a.removeCls("b-cut-row")}),r.clipboardRecords=n.slice(),t.store.forEach(s=>{s.meta.isCut=r._isCut&&r.clipboardRecords.includes(s)}),n.forEach(s=>this.onRowCutOrCopy(s,e)),t.trigger("copy",{records:n,isCut:e,entityName:i}))}onRowCutOrCopy(e,r){var t;(t=this.client.rowManager.getRowById(e))==null||t.toggleCls("b-cut-row",r)}pasteRows(e){var r,t;const i=this,n=i.clipboardRecords,{client:s,entityName:a}=i,{store:o}=s,l=e||s.selectedRecord;if(s.readOnly||s.isTreeGrouped||!n.length||o.tree&&i._isCut&&n.some(u=>u.contains(l,!0))||s.trigger("beforePaste",{records:n,referenceRecord:l,isCut:i._isCut,entityName:a})===!1)return[];i.sortByIndex(n);const c={},d=i.extractParents(n,c);return i.insertCopiedRecords(d,l),i._isCut?i.clearClipboard():s.selectedRecords=d,s.trigger("paste",{records:d,originalRecords:n,isCut:i._isCut,referenceRecord:l,entityName:a}),(t=(r=s.getRowFor(d[d.length-1]))==null?void 0:r.cells)==null||t[0].focus(),d}clearClipboard(){this._isCut&&this.clipboardRecords.forEach(e=>{var r;return(r=this.client.rowManager.getRowById(e))==null?void 0:r.removeCls("b-cut-row")}),this._isCut=!1,this.clipboardRecords=[]}generateNewName(e){const r=e[this.nameField];let t=2;for(;this.client.store.findRecord(this.nameField,`${r} - ${t}`);)t++;return`${r} - ${t}`}insertCopiedRecords(e,r){const{store:t}=this.client,i=t.indexOf(r)+1;if(t.tree)return r.parent.insertChild(e,r.nextSibling,!1,{orderedBeforeNode:r.nextOrderedSibling});if(this._isCut)t.move(e,t.getAt(i));else return t.insert(i,e)}get selectedRecords(){const e=[...this.client.selectedRecords];return this.client.selectedCells.forEach(r=>{e.includes(r.record)||e.push(r.record)}),e}getMenuItemText(e,r=!1){const t=this;let i=t[e+"RecordText"];return r&&(i+=` (${t.selectedRecords.length>1?t.rowSpecifierTextPlural:t.rowSpecifierText})`),i}populateCellMenu({record:e,items:r,cellSelector:t}){var i;const n=this,{client:s,rowOptionsOnCellContextMenu:a}=n,o=((i=s.features.cellCopyPaste)==null?void 0:i.enabled)===!0,l=o&&s.isCellSelected(t);!s.readOnly&&!s.isTreeGrouped&&(e==null?void 0:e.isSpecialRow)===!1&&(o?s.selectedRows.length:s.selectedRecords.length)&&(!l||n.rowOptionsOnCellContextMenu)&&(r.cut={text:n.getMenuItemText("cut",l&&a),localeClass:n,icon:"b-icon b-icon-cut",weight:135,disabled:e.readOnly,onItem:()=>n.cut()},r.copy={text:n.getMenuItemText("copy",l&&a),localeClass:n,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:()=>n.copy()},r.paste={text:n.getMenuItemText("paste",l&&a),localeClass:n,icon:"b-icon b-icon-paste",weight:140,disabled:!n.clipboardRecords.length,onItem:()=>n.paste(e)})}sortByIndex(e){const{store:r}=this.client;return e.sort((t,i)=>{const n=t.indexPath,s=i.indexPath;if(!e.includes(t.parent)&&!e.includes(i.parent))return r.indexOf(t)-r.indexOf(i);if(n.length===s.length){for(let a=0;a<n.length;a++){if(n[a]<s[a])return-1;if(n[a]>s[a])return 1}return 0}else return n.length-s.length})}extractParents(e,r){const t=this,{client:i,_isCut:n}=t;i.store.tree&&e.forEach(a=>{a.traverse(o=>{const l=o.getTopParent(!0);!e.includes(o)&&(!n||!e.some(c=>l.includes(c)))&&e.push(o)})});const s=e.reduce((a,o)=>{let l;const c=o.parentId||o.meta.modified;return n?(l=o,l.meta.isCut=!1):(l=o.copy(),l[t.nameField]=t.generateNewName(l),l.data.expanded=o.isExpanded(i.store)),r[o.id]=l,o.parent===i.store.rootNode?a.push(l):c in r?r[c].appendChild(l,!0):a.push(l),a},[]);return s.forEach(a=>{a.sortOrderedChildren(!0,!0)}),s}};R(dr,"$name","RowCopyPaste"),R(dr,"type","rowCopyPaste"),R(dr,"pluginConfig",{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}),R(dr,"configurable",{nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1}),dr.featureClass="b-row-copypaste",dr._$name="RowCopyPaste",z.registerFeature(dr,!0,"Grid"),z.registerFeature(dr,!1,"Gantt"),z.registerFeature(dr,!1,"SchedulerPro"),z.registerFeature(dr,!1,"ResourceHistogram");var FP={remove:1,filter:1,dataset:1,replace:1},So=class extends X{static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",recordStateMap:new Map,collapsingRecords:new Set}}static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore"],override:["onGridBodyFocusIn"]}}afterConstruct(){const e=this,{client:r}=e;if(!e.renderer){console.warn("RowExpander requires implementing the renderer function.");return}r.isGanttBase&&r.fixedRowHeight!==!1&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to false."),e.bindStore(r.store),e.triggerEvent&&r.ion({[e.triggerEvent]:"onTriggerEvent",thisObj:e}),e.addColumn()}bindStore(e){const r=this;r.recordStateMap.clear(),r.collapsingRecords.clear(),r.detachListeners("clientStoreChange"),e.ion({name:"clientStoreChange",change:r.onStoreChange,thisObj:r})}doDisable(e){const{client:r}=this;e&&(this.recordStateMap.clear(),this.collapsingRecords.clear()),r.isConfiguring||r.rowManager.renderFromRow(),super.doDisable(e)}changeLoadingIndicatorText(e){return e&&this.L(e)}onGridBodyFocusIn(e){var r,t;(t=(r=this.client.lastMousedownEvent)==null?void 0:r.target)!=null&&t.closest(".b-rowexpander-body")||this.overridden.onGridBodyFocusIn(e)}get isAnimating(){return this.client.isAnimating}set isAnimating(e){const{client:r}=this,t=r.isAnimating;r.isAnimating=e,r.isAnimating!==t&&r.element.classList.toggle("b-rowexpander-animating")}afterColumnsChange(){this.addColumn()}changeColumn(e){return e==null?e:{type:"action",actions:[{cls:"b-icon b-icon-collapse-down",tooltip:({record:r})=>this.L(this.recordStateMap.has(r)?"L{RowExpander.collapse}":"L{RowExpander.expand}"),onClick:({record:r})=>this.toggleExpand(r)}],width:40,hideable:!1,align:"center",region:this.client.regions[0],...e,field:"expanderActionColumn"}}addColumn(){const e=this,{column:r}=e,{columns:t}=e.client;!e._isAddingExpanderColumn&&r&&(!e._expander||!t.includes(e._expander))&&(e._isAddingExpanderColumn=!0,e.columnPosition==="last"?[e._expander]=t.add(r):[e._expander]=t.insert(0,r),e._isAddingExpanderColumn=!1)}onTriggerEvent({target:e}){this.disabled||e!=null&&e.closest(".b-action-cell")||!e.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(e))}toggleExpand(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}onStoreChange({action:e,source:r,records:t}){const i=this,{recordStateMap:n,collapsingRecords:s}=i;if(!i.disabled){if(e==="removeAll")n.clear(),s.clear();else if(FP[e])for(const[a]of n)r.includes(a)||(n.delete(a),s.delete(a));else if(i.refreshOnRecordChange&&(t!=null&&t.length)){if(e==="update"){const a=n.get(t[0]);a!=null&&a.isCreated&&(a.isCreated=!1,i.client.rowManager.renderFromRecord(t[0]))}else if(e==="updatemultiple"){let a,o;for(const l of t){const c=n.get(l);if(c!=null&&c.isCreated){c.isCreated=!1;const d=r.records.indexOf(l);(!o||a>d)&&(a=d,o=l)}}o&&i.client.rowManager.renderFromRecord(o)}}}}processRowHeight(e,r){var t;const i=this.recordStateMap.get(e);if(i){if(!i.isCreated&&i.isRenderingAsync)return this.loadingIndicatorHeight+r;if(!i.expanderBodyHeight)for(const n of this.client.regions){const s=i.expandElements[n].offsetHeight;s>i.expanderBodyHeight&&(i.expanderBodyHeight=s)}}return((t=i==null?void 0:i.expanderBodyHeight)!=null?t:0)+r}beforeRenderRow({row:e,record:r}){const t=this,{regions:i}=t.client,{expandedRowClass:n}=t;e.cls.toggle("b-rowexpander-disabled",t.disabled),e.cls[n]?t.enableAnimations&&t.isAnimating&&t.collapsingRecords.has(r)?t.waitForTransition(e,()=>{t.collapsingRecords.has(r)&&t.removeExpander(e)}):t.removeExpander(e):t.collapsingRecords.delete(r);const s=t.recordStateMap.get(r);if(!t.disabled&&s){s.isCreated||t.renderExpander(r,e,s),e.cls.add(n);for(const a of i){const o=e.getElement(a);s.isCreated?o.appendChild(s.expandElements[a]):t.renderLoadingIndicator(o,s),t.lockCellHeight(o,s.cellHeight,!1)}t._shouldScrollIntoView&&(t._shouldScrollIntoView=!1,C.isInView(s.expandElements[i[0]],!0)||t.client.rowManager.ion({once:!0,thisObj:t,renderDone:()=>t.scrollRowIntoView(e,r)}))}}scrollRowIntoView(e,r){this.isAnimating?this.waitForTransition(e,()=>this.client.scrollRowIntoView(r)):this.client.scrollRowIntoView(r)}waitForTransition(e,r){j.onTransitionEnd({element:e.element,property:"height",handler:r,thisObj:this})}removeExpander(e){e.cls.remove(this.expandedRowClass);for(const r of this.client.regions){const t=e.getElement(r);t.classList.remove(this.expandedRowClass),C.removeEachSelector(t,"."+this.expanderBodyClass),this.lockCellHeight(t,null,!1)}}renderLoadingIndicator(e,r){C.createElement({parent:e,className:this.expanderBodyClass+" b-rowexpander-loading",style:{top:r.cellHeight,height:this.loadingIndicatorHeight},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]})}renderExpander(e,r,t){var i;const n=this,s=(i=r.cells[0])==null?void 0:i.offsetHeight,a={},o=[],l=(c,d,u)=>{c!=null&&(typeof c=="string"?d.innerHTML=c:(c=C.createElement(c),d.appendChild(c))),a[u]=d};if(!t.isRenderingAsync){Object.assign(t,{cellHeight:s,expandElements:a,expanderBodyHeight:0});for(const c of n.client.regions){const d=r.getElement(c);r.addCls(n.expandedRowClass);const u=C.createElement({parent:d,tabIndex:-1,className:n.expanderBodyClass,style:{top:s+"px"}}),h=n.renderer({record:e,expanderElement:u,rowElement:d,region:c});U.isPromise(h)?o.push(h.then(f=>l(f,u,c))):l(h,u,c)}o.length?(t.isRenderingAsync=!0,Promise.all(o).then(()=>{var c;t.isCreated=!0,(c=n.renderRowsWithAnimation)==null||c.call(n,e),t.isRenderingAsync=!1})):t.isCreated=!0}}renderRowsWithAnimation(e){const r=this;if(r.enableAnimations){const t=r.client.rowManager.getRowById(e);t&&(r.isAnimating=!0,r.collapsingRecords.has(e)&&t.addCls("b-row-is-collapsing"),r.waitForTransition(t,()=>{var i;r.isAnimating=!1,t.isDestroyed||(i=t.removeCls)==null||i.call(t,"b-row-is-collapsing")}))}r.client.rowManager.renderFromRecord(e)}lockCellHeight(e,r,t){for(let i=0;i<e.children.length;i++){const n=e.children[i];n.classList.contains(this.expanderBodyClass)||(n.style.height=t?"":r+"px")}}async expand(e){const r=this;r.disabled||await r.trigger("beforeExpand",{record:e})!==!1&&(r.recordStateMap.set(e,{isCreated:!1}),r.collapsingRecords.delete(e),r._shouldScrollIntoView=!0,r.renderRowsWithAnimation(e))}async collapse(e){const r=this;r.disabled||await r.trigger("beforeCollapse",{record:e})!==!1&&(r.recordStateMap.delete(e),r.collapsingRecords.add(e),r.renderRowsWithAnimation(e))}};R(So,"$name","RowExpander"),R(So,"configurable",{renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0}),So._$name="RowExpander",z.registerFeature(So);var vi=class extends ge(X){static get deprecatedEvents(){return{gridRowBeforeDragStart:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowBeforeDragStart` event is deprecated, listen on this event on the Grid instead."},gridRowDragStart:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDragStart` event is deprecated, listen on this event on the Grid instead."},gridRowDrag:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDrag` event is deprecated, listen on this event on the Grid instead."},gridRowBeforeDropFinalize:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowBeforeDropFinalize` event is deprecated, listen on this event on the Grid instead."},gridRowDrop:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowDrop` event is deprecated, listen on this event on the Grid instead."},gridRowAbort:{product:"Grid",invalidAsOfVersion:"6.0.0",message:"`gridRowAbort` event is deprecated, listen on this event on the Grid instead."}}}construct(e,r){this.grid=e,super.construct(...arguments)}doDestroy(){var e;(e=this.dragHelper)==null||e.destroy(),super.doDestroy()}init(){const e=this,{grid:r}=e;e.dragHelper=Yi.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!0,dragWithin:r.bodyContainer,allowDropOutside:!0,scrollManager:r.scrollManager,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e.isElementDraggable.bind(e),monitoringConfig:{scrollables:[{element:r.scrollable.element,direction:"vertical"}]},setXY(t,i,n){const{context:s}=this;if(!s.started){const a=k.from(s.element,this.dragWithin),o=s.startPageY-globalThis.pageYOffset-s.element.getBoundingClientRect().top;n=a.top+o+this.proxyTopOffset}C.setTranslateXY(t,i,n)},ignoreSamePositionDrop:!1,createProxy(t){const i=t.cloneNode(!0),n=document.createElement("div");if(n.classList.add("b-row-reorder-proxy"),i.removeAttribute("id"),i.style.transform="",i.style.width="",n.appendChild(i),r.selectedRecords.length>1){const s=i.cloneNode(!0);s.classList.add("b-row-dragging-multiple"),n.appendChild(s)}return C.removeClsGlobally(n,"b-selected","b-hover","b-focused"),n},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onReset",prio:1e4,thisObj:e}},e.dragHelperConfig),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),r.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),e.dropIndicator=C.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}get targetSubGridElement(){const e=this.grid.regions[0];return this.grid.subGrids[e].element}isElementDraggable(e,r){if(!e.closest(".b-grid-cell .b-widget"))if(this.gripOnly){const t=e.closest(".b-grid-cell:first-child");if(t){const i=getComputedStyle(t,":before"),n=this.grid.rtl?t.getBoundingClientRect().width-r.borderOffsetX:r.borderOffsetX,s=C.roundPx(n)<=C.roundPx(parseFloat(i.width));return s&&(this.client.preventDragSelect=!0),s}}else return!0}onBeforeDragStart({event:e,source:r,context:t}){const i=this,{grid:n}=i,s=i.targetSubGridElement;if(i.disabled||n.readOnly||n.isTreeGrouped||!s.contains(t.element))return!1;const a=t.startRecord=n.getRecordFromElement(t.element);if(a.readOnly||a.isSpecialRow)return!1;t.originalRowTop=n.rowManager.getRowFor(a).top,n.selectionMode.checkboxOnly||(r.startEvent.pointerType==="touch"?n.isSelected(a)||n.selectRow({record:a,addToSelection:!1}):!n.isSelected(a)&&!e.shiftKey&&!e.ctrlKey&&n.selectRow({record:a}));const o=n.selectedRecords.filter(l=>!l.readOnly);return t.records=[a],o.includes(a)&&(t.records.push(...o.filter(l=>l!==a)),t.records.sort((l,c)=>n.store.indexOf(l)-n.store.indexOf(c))),!0}onDragStart({context:e}){var r,t;const i=this,{grid:n}=i,{cellEdit:s,cellMenu:a,headerMenu:o}=n.features;s&&(i.cellEditDisabledState=s.disabled,s.disabled=!0),(r=a==null?void 0:a.hideContextMenu)==null||r.call(a,!1),(t=o==null?void 0:o.hideContextMenu)==null||t.call(o,!1),n.element.classList.add("b-row-reordering");const l=e.element.querySelector(".b-focused");l==null||l.classList.remove("b-focused"),e.element.firstElementChild.classList.remove("b-selected","b-hover"),n.bodyContainer.appendChild(i.dropIndicator)}onDrag({context:e,event:r}){var t;const i=this,{grid:n}=i,{store:s,rowManager:a}=n,{clientY:o}=r;let l=!0,c=a.getRowAt(o),d,u,h,f,g;if(c){const m=c.top+n.scrollable.element.getBoundingClientRect().top-n.scrollable.y,p=c.height/4,v=m+p,y=m+c.height/2,S=m+p*3;u=c.dataIndex,d=s.getAt(u),s.tree?f=(d.isParent||i.dropOnLeaf)&&o>v&&o<S:s.isGrouped&&(f=d.isGroupHeader&&d.meta.collapsed),h=!f&&r.clientY>=y}else r.pageY<n._bodyRectangle.y?(u=0,d=s.first,h=!1):(u=s.count-1,d=s.last,h=!0),c=n.rowManager.getRow(u);if(d===i.overRecord&&i.after===h&&i.over===f){e.valid=i.reorderValid;return}i.overRecord!==d&&((t=a.getRowById(i.overRecord))==null||t.removeCls(i.dropOverTargetCls)),i.overRecord=d,i.after=h,i.over=f,(d===e.startRecord||!h&&!f&&u===0&&s.isGrouped||h&&d.isGroupHeader&&d.meta.collapsed&&s.indexOf(d)===s.count-1)&&(l=!1),s.tree?(g=h?d.nextSibling:d,e.records.some(m=>m.contains(d))&&(l=!1),e.parent=l&&f?d:d.parent,i.clearTimeout(i.hoverTimer),d&&d.isParent&&!d.isExpanded(s)&&(i.hoverTimer=i.setTimeout(()=>n.expand(d),i.hoverExpandTimeout))):g=h?s.getAt(u+1):d,c.toggleCls(i.dropOverTargetCls,l&&f),!f&&u===s.indexOf(e.startRecord)+(h?-1:1)&&e.parent&&e.startRecord.parent===e.parent&&(l=!1),c&&C.setTranslateY(i.dropIndicator,Math.max(c.top+(h?c.element.getBoundingClientRect().height:0),1)),i.dropIndicator.style.visibility=f?"hidden":"visible",i.dropIndicator.classList.toggle("b-drag-invalid",!l),e.insertBefore=g,e.valid=i.reorderValid=l}async onDrop(e){const r=this,{client:t}=r,{context:i}=e;if(i.valid=i.valid&&r.reorderValid,i.valid){i.async=!0,t.store.tree&&(i.oldPositionContext=i.records.map(s=>{var a;return{record:s,parentId:(a=s.parent)==null?void 0:a.id,parentIndex:s.parentIndex}}));let n=await r.trigger("gridRowBeforeDropFinalize",e);n===!1&&(i.valid=!1),n=await t.trigger("gridRowBeforeDropFinalize",e),n===!1&&(i.valid=!1),await r.dragHelper.animateProxyTo(r.dropIndicator,{align:"l0-l0"}),await r.finalizeReorder(i)}r.clearTimeout(r.hoverTimer),r.overRecord=r.after=r.over=null,r.trigger("gridRowDrop",e),t.trigger("gridRowDrop",e)}async finalizeReorder(e){var r,t;const i=this,{grid:n}=i,{store:s,focusedCell:a}=n;let{records:o}=e;if(e.valid=e.valid&&!o.some(l=>!s.includes(l)),e.valid){let l;s.tree?(o=o.filter(c=>!c.parent||c.bubbleWhile(d=>!o.includes(d),!0)),l=await e.parent.tryInsertChild(o,i.over?(r=e.parent.children)==null?void 0:r[0]:e.insertBefore),n.rowManager.forEach(c=>c.removeCls(i.dropOverTargetCls)),!e.parent.isExpanded()&&((t=e.parent.children)!=null&&t.length)&&n.expand(e.parent),e.valid=l!==!1):s.isGrouped&&i.over?s.move(o,s.getAt(s.indexOf(e.insertBefore)+1)):s.move(o,e.insertBefore),(a==null?void 0:a._rowIndex)>=0&&(n._focusedCell=null,n.focusCell({grid:n,record:a.record,columnId:a.columnId})),s.clearSorters()}e.finalize(e.valid),n.element.classList.remove("b-row-reordering")}onReset(){const e=this,{grid:r}=e,t=r.features.cellEdit;r.element.classList.remove("b-row-reordering"),t&&(t.disabled=e.cellEditDisabledState),e.dropIndicator.remove(),C.removeClsGlobally(r.element,...e.dropOverTargetCls)}onPaint({firstPaint:e}){e&&this.init()}updateShowGrip(e){this.grid.element.classList.toggle("b-row-reorder-with-grip",e)}};R(vi,"$name","RowReorder"),R(vi,"configurable",{showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:!1,dragHelperConfig:null}),R(vi,"pluginConfig",{after:["onPaint"]}),vi.featureClass="",vi._$name="RowReorder",z.registerFeature(vi,!1),z.registerFeature(vi,!0,"Gantt");var Vc=class extends ge(X){static get $name(){return"Search"}static get configurable(){return{limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}}}static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(e,r){const t=this;super.construct(e,r),Object.assign(t,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,C.NodeFilter.SHOW_TEXT,()=>C.NodeFilter.FILTER_ACCEPT)}),e.ion({expandNode:"onTreeNodeExpand",thisObj:t})}isActionAvailable(){return!!this.text}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}async search(e,r=!0,t=!1,i){const n=this;if(!e)return n.clear();if(!t&&e===n.text||n.disabled)return;const{grid:s,store:a}=n,o=s.columns.visibleColumns.filter(u=>u.searchable!==!1),l=[];i=i||o.map(u=>{var h;return l.push((h=u.formatValue)==null?void 0:h.bind(u)),u.field});const c=a.search(e,i,l);a.isTree&&c.length&&await s.expandTo(c.map(u=>u.id));for(const u of o)if(u.mergeCells&&u.isSorted){let h=null,f=null;for(const g of c)if(g.field===u.field){const m=g.data[g.field];m===h&&(g.belongsTo=f),h=m,f=`${g.field}-${g.id}`}}let d=1;if(Object.assign(n,{foundMap:{},prevFound:n.found,found:c,text:e,findRe:new RegExp(`(\\s+)?(${L.escapeRegExp(String(e))})(\\s+)?`,"ig")}),n.clearHits(),!!c){for(const u of c)if(n.foundMap[`${u.field}-${u.id}`]=u.belongsTo?n.foundMap[u.belongsTo]:d++,d>n.limit)break;return n.listenersInitialized||(s.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:n}),a.ion({name:"storeRefresh",[`refresh${s.asyncEventSuffix}`]:"onStoreRefresh",thisObj:n}),n.listenersInitialized=!0),s.refreshRows(),s.trigger("search",{grid:s,find:e,found:c}),r&&!n.isHitFocused&&n.gotoNextHit(!0),c}}clearHits(){for(const e of C.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls,this.hitCellCls);const r=ze.get(e).row;r&&(r.forceInnerHTML=!0,r.renderCell(e),r.forceInnerHTML=!1)}}clear(e=!1){const r=this,{grid:t}=r;r.foundMap&&delete r.foundMap,r.text=null,r.clearHits(),r.listenersInitialized&&(this.detachListeners("renderCell"),this.detachListeners("storeRefresh"),r.listenersInitialized=!1),e||t.trigger("clearSearch",{grid:t})}get foundCount(){var e,r;return(r=(e=this.found)==null?void 0:e.length)!=null?r:0}get isHitFocused(){var e;const r=this,{grid:t}=r,{focusedCell:i}=t;if((e=i==null?void 0:i.cell)!=null&&e.contains(C.getActiveElement(t.element))){const{rowIndex:n,column:s}=i;return n!==-1&&r.found.some(a=>a.index===n&&s&&a.field===s.field)}}gotoNextHit(e=!1){var r;const t=this;if(!((r=t.found)!=null&&r.length))return;const{grid:i,store:n}=t,s=i.focusedCell||i.lastFocusedCell,a=s&&e!==!0?n.indexOf(s.record,void 0,!0):-1,o=t.found.findIndex(l=>l.index>a);o!==-1&&t.gotoHit(o)}gotoPrevHit(){var e;const r=this,{store:t}=r;if(!((e=r.found)!=null&&e.length))return;const{grid:i,found:n}=r,s=i.focusedCell||i.lastFocusedCell,a=s?t.indexOf(s.record,void 0,!0):0;for(let o=n.length-1;o--;o>=0)if(n[o].index<a){r.gotoHit(o);break}}gotoHit(e){const{grid:r}=this,t=this.found[e];return t&&r.focusCell({field:t.field,id:t.id}),!!t}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:r,record:t,value:i}){var n,s;const a=this,{treeWalker:o,findRe:l,hitTextCls:c,showHitIndex:d}=a,u=(n=a.foundMap)==null?void 0:n[r.field+"-"+t.id];if(u){e.classList.add(a.hitCls),d&&((s=e.querySelector(`.${a.hitCellBadgeCls}`))==null||s.remove());const h=C.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;if(String(i).toLowerCase()===String(a.text).toLowerCase())h.innerHTML=`<span class="${a.hitTextCls}">${h.innerHTML}</span>${d?`<div class="${a.hitCellBadgeCls}">${u}</div>`:""}`;else{o.currentNode=h;for(let f=o.nextNode();f&&h.contains(f);){const g=f,m=f.nodeValue,p=["<span>"];f=o.nextNode();let v=l.lastIndex;for(let y=l.exec(m);y;y=l.exec(m)){const S=m.substring(v,y.index),D=y[1]?"\xA0":"",w=y[2],E=y[3]?"\xA0":"";p.push(`${L.encodeHtml(S)}${D}<span class="${c}">${w}</span>${E}`),v=l.lastIndex}p.push(L.encodeHtml(m.substring(v)),"<span>"),g.parentNode.insertBefore(C.createElementFromTemplate(p.join(""),{fragment:!0}),g),g.remove()}d&&C.createElement({parent:e,className:a.hitCellBadgeCls,text:u})}a.hitEls.push(e)}}populateCellMenu({column:e,record:r,items:t,cellElement:i}){const n=this;e.searchable&&(t.search={text:"L{searchForValue}",localeClass:n,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:n.disabled,onItem:()=>{let s=globalThis.getSelection().toString();s||(s=i.innerText),n.search(s)}})}onStoreRefresh(){this.search(this.text,!1,!0)}};Vc.featureClass="b-search",Vc._$name="Search",z.registerFeature(Vc);var Nc=class extends X{static get $name(){return"Sort"}static get configurable(){return{multiSort:!0,prioritizeColumns:!1,toggleOnHeaderClick:!0}}static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,r){r=this.processConfig(r),this.grid=e,this.bindStore(this.store),super.construct(e,r)}processConfig(e){return typeof e=="string"||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this})}set field(e){const r=this.grid.columns.get(e);r&&typeof r.sortable=="object"&&(r.sortable.field=r.sortable.property||e,e=r.sortable),this.store.sort(e,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){var e;const r=this,{grid:t}=r;if(!t.hideHeaders&&t.isPainted){const i=r.store.sorters,n=i.length,s=new J;let a;for(const o of t.columns.visibleColumns){if(!o.sortable)continue;const l=o.element,c=o.textWrapper,d=c==null?void 0:c.dataset;let u="none";d!=null&&d.sortIndex&&delete d.sortIndex,s.value=l.classList,o.sortable===!1?(s.remove(r.sortableCls),(e=c==null?void 0:c.querySelector(".b-sort-icon"))==null||e.remove()):(c!=null&&c.querySelector(".b-sort-icon")||C.createElement({parent:c,className:"b-sort-icon"}),s.add(r.sortableCls),a=i.find(h=>h.field===o.field||h.sortFn&&h.sortFn===o.sortable.sortFn),a?(n>1&&d&&(d.sortIndex=i.indexOf(a)+1),s.add(r.sortedCls),a.ascending?(s.add(r.sortedAscCls),s.remove(r.sortedDescCls),u="ascending"):(s.add(r.sortedDescCls),s.remove(r.sortedAscCls),u="descending")):(s.remove(r.sortedCls),s["b-group"]||(s.remove(r.sortedAscCls),s.remove(r.sortedDescCls)))),C.syncClassList(l,s),C.setAttributes(l,{"aria-sort":u})}}}populateHeaderMenu({column:e,items:r}){const t=this,{store:i}=t,n={...e.sortable,field:e.field,columnOwned:!0};if(e.sortable!==!1&&(r.sortAsc={text:"L{sortAscending}",localeClass:t,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:t.disabled,onItem:()=>i.sort(n,!0)},r.sortDesc={text:"L{sortDescending}",localeClass:t,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:t.disabled,onItem:()=>i.sort(n,!1)},t.multiSort&&t.grid.columns.records.some(s=>s.sortable))){const s=i.sorters.find(a=>a.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===a.sortFn);r.multiSort={text:"L{multiSort}",localeClass:t,icon:"b-fw-icon b-icon-sort",weight:320,disabled:t.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:t,icon:"b-fw-icon b-icon-sort-asc",disabled:s&&(s==null?void 0:s.ascending),weight:330,onItem:()=>i.addSorter(n,!0)},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:t,icon:"b-fw-icon b-icon-sort-desc",disabled:s&&!s.ascending,weight:340,onItem:()=>i.addSorter(n,!1)},removeSorter:{text:"L{removeSorter}",localeClass:t,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!s,onItem:()=>{i.removeSorter(n.field)}}}}}}getColumnDragToolbarItems(e,r){const t=this,{store:i,disabled:n}=t;if(e.sortable!==!1){const s=i.sorters.find(a=>a.field===e.field);r.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:t,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:n,onDrop:({column:a})=>i.sort(a.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:t,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:n,onDrop:({column:a})=>i.sort(a.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:n||s&&s.ascending,weight:105,onDrop:({column:a})=>i.addSorter(a.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:n||s&&!s.ascending,weight:105,onDrop:({column:a})=>i.addSorter(a.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:n||!s,onDrop:({column:a})=>i.removeSorter(a.field)})}return r}onStoreBeforeSort({sorters:e}){var r;const{columns:t}=this.client;for(let i=0;i<e.length;i++){const n=e[i],s=(n.columnOwned||this.prioritizeColumns)&&t.get(n.field);(r=s==null?void 0:s.sortable)!=null&&r.sortFn&&(e[i]={...n,...s.sortable,columnOwned:!0})}}onElementClick(e){const r=this,{store:t}=r,{target:i}=e,n=i.closest(".b-grid-header.b-sortable"),s=n==null?void 0:n.dataset.column;if(!(r.ignoreRe.test(i.className)||r.disabled||e.handled)&&n&&s&&(r.toggleOnHeaderClick||i.closest(".b-sort-icon"))){const a=r.grid.columns.getById(n.dataset.columnId);if(t.isGrouped&&t.groupers.find(l=>l.field===s)&&!e.shiftKey)return;if(a.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)t.removeSorter(a.field);else{const l={columnOwned:!0,field:a.field};typeof a.sortable=="object"&&T.assign(l,a.sortable),t.sort(l,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}};Nc.featureClass="b-sort",Nc._$name="Sort",z.registerFeature(Nc,!0);var Tf=class extends X{static get $name(){return"StickyCells"}static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,r){super.construct(e,r),e.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,C.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:r,element:t,contentElement:i}=e,n=k.client(r.bodyContainer).roundPx(),s=r.rowManager.getRowAt(n.y),a=s!==e.currentTopRow;if(s){a&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),i.innerHTML="",i.appendChild(e.updateStickyContent()));const o=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[o?"add":"remove"]("b-hide-visibility"),e.currentTopRow[o?"addCls":"removeCls"]("b-not-enough-height"),n.y+=e.stickyContentTop,C.alignTo(t,e.stickyEls[0],{align:"t0-t0",constrainTo:n},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:r,removeClasses:t}=e,i={"b-grid-sticky-row":1},n={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),a=e.stickyEls||(e.stickyEls=[]);for(a.forEach(o=>{o.classList.remove("b-sticky-content-el")}),a.length=0,r.eachElement(o=>{a.push(...o.querySelectorAll(e.contentSelector))});s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,a.map(o=>{o.closest(".b-grid-cell").classList.forEach(d=>n[d]=1),o.closest(".b-grid-row").classList.forEach(d=>i[d]=1),Object.assign(n,t),Object.assign(i,t);const l=o.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,l),o.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-o.offsetTop+l),o.style.alignSelf="";const c=o.cloneNode(!0);return o.classList.add("b-sticky-content-el"),s.appendChild(c),c}),n["b-focused"]=!1,C.syncClassList(e.contentElement,n),C.syncClassList(e.element,i),s}};Tf._$name="StickyCells",z.registerFeature(Tf,!1);var Mf=class extends X{static get $name(){return"Stripe"}construct(e,r){super.construct(e,r),e.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:r}=this,t=e.dataIndex%2===0;e.assignCls({"b-even":!r&&t,"b-odd":!r&&!t})}};Mf._$name="Stripe",z.registerFeature(Mf);var wo=class extends IS(X){static get configurable(){return{selectedOnly:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static get $name(){return"Summary"}construct(e,r){this.grid=e,super.construct(e,r),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e);const{client:r}=this;e?r.element.classList.add("b-summary-disabled"):(this.updateSummaries(),r.element.classList.remove("b-summary-disabled"),r.eachSubGrid(t=>t.scrollable.syncPartners()))}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:r,store:t}=e,i=C.children(r.element,".b-grid-footer"),n=e.selectedOnly&&r.selectedRecords.length>0,s=(t.isFiltered?t.storage.values:t.allRecords).filter(a=>!a.isSpecialRow&&(!n||r.isSelected(a)));r.columns.forEach(a=>{var o;(o=a.summaries)==null||o.forEach(l=>{"seed"in l&&("initialSeed"in l||(l.initialSeed=l.seed),["number","string","date"].includes(typeof l.initialSeed)?l.seed=l.initialSeed:l.seed=Object.assign({},l.initialSeed))})}),i.forEach(a=>{if(!a.dataset.column)return;const o=r.columns.get(a.dataset.column),l=e.generateHtml(o,s,"b-grid-footer-summary");(o.summaries?o.summaries.length:o.sum)&&(a.children.length?C.sync(l,a.firstElementChild):a.innerHTML=l)})}onStoreChange({action:e,changes:r}){let t=!0;this.disabled||(e==="update"&&(t=Object.keys(r).some(i=>{const n=this.grid.columns.get(i);return!!n&&(!!n.sum||!!n.summaries)})),t&&this.updateSummaries())}updateSelectedOnly(e){const r=this;r.detachListeners("selectionChange"),e&&r.grid.ion({name:"selectionChange",selectionChange:r.refresh,thisObj:r}),r.refresh()}refresh(){this.updateSummaries()}};wo.featureClass="b-summary",wo._$name="Summary",z.registerFeature(wo);var kP=Promise.resolve(),yi=class extends X.mixin(ge){static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementPointerUp","onElementClick","bindStore"]}}construct(e,r){super.construct(e,r),this.treeColumn||console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),e.store&&this.bindStore(e.store)}doDisable(e){if(e)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const e=this,{columns:r}=e.client;return(!e._treeColumn||!r.includes(e._treeColumn))&&(e._treeColumn=r.find(t=>t.isTreeColumn)),e._treeColumn}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,r){if(e==null)throw new Error("Tree#toggleCollapse must be passed a record");const t=this,{store:i,client:n}=t,{rowManager:s}=n,a=i.getById(e),o=a.instanceMeta(i);if(await i.toggleCollapse(a,r)){const l=s.getRowFor(a);if(l&&a.ancestorsExpanded()){const c=t.treeColumn&&!t.treeColumn.subGrid.collapsed&&l.getCell(t.treeColumn.id);c&&l.renderCell(c)}t.isTogglingNode||(n.element.classList.add("b-toggling-node"),t.isTogglingNode=!0,t.requestAnimationFrame(()=>{n.element.classList.remove("b-toggling-node"),t.isTogglingNode=!1})),n.trigger(o.collapsed?"collapseNode":"expandNode",{record:a}),n.trigger("toggleNode",{record:a,collapse:o.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:r}){this.client.trigger("beforeToggleNode",{record:e,collapse:r})}onBeforeLoadChildren({source:e,params:r}){const t=e.getById(r[e.modelClass.idField]),i=this.client.rowManager.getRowFor(t);i==null||i.addCls("b-loading-children")}onLoadChildren({source:e,params:r}){const t=e.getById(r[e.modelClass.idField]),i=this.client.rowManager.getRowFor(t);i==null||i.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const r=this.client.rowManager.getRowFor(e);r==null||r.removeCls("b-loading-children")}async expandOrCollapseAll(e=!0,r=this.store.rootNode){const{client:t,store:i}=this,n=[],s=[];return t.trigger("beforeToggleAllNodes",{collapse:e}),i.suspendEvents(),i.traverse(a=>{const o=a.instanceMeta(i);a.isLeaf||(e&&!o.collapsed?(this.toggleCollapse(a,!0),s.push(...a.children)):!e&&o.collapsed&&(Array.isArray(a.children)&&s.push(...a.children),n.push(this.toggleCollapse(a,!1))))},r,r===i.rootNode),i.resumeEvents(),(e?kP:Promise.all(n)).then(()=>{t.refreshRows(e),s.length&&(e?i.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):i.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),t.trigger("toggleAllNodes",{collapse:e})})}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e,r=!0){var t,i,n,s;const a=this,{store:o,client:l}=a;if(Array.isArray(e)){if(e.length>0){l.suspendRefresh();for(let d=e.length-1;d>=0;d--){const u=o.getById(e[d]);d===0&&((t=l.resumeRefresh)==null||t.call(l),l.rowManager.refresh()),await((i=a.expandTo)==null?void 0:i.call(a,u,d===0))}}return}const c=o.getById(e);if(c.instanceMeta(a.store).hiddenByCollapse!==!1){if(!c.ancestorsExpanded()){const d=[];for(let u=c.parent;u&&!u.isRoot;u=u.parent)u.isExpanded(o)||d.unshift(u);l.suspendRefresh();for(const u of d)a.isDestroyed||await a.toggleCollapse(u,!1);(n=l.resumeRefresh)==null||n.call(l),(s=l.refreshRows)==null||s.call(l)}!a.isDestroyed&&r&&await l.scrollRowIntoView(c)}}onElementPointerUp(e){const r=this,t=e.target,i=r.client.getCellDataFromEvent(e);(t.closest(".b-tree-expander")||r.expandOnCellClick&&(i!=null&&i.record.isParent))&&r.toggleCollapse(i.record)}onElementClick(e){e.target.closest(".b-tree-expander")&&e.preventDefault()}toggleCollapseByKey(){const{focusedCell:e}=this.client;return(e==null?void 0:e.rowIndex)>-1&&!e.isActionable?(this.toggleCollapse(e.id),!0):!1}expandIfSingleColumn(){return this.client.columns.count===1?this.expandByKey():!1}expandByKey(){const e=this,{client:r}=e,{focusedCell:t}=r,i=t==null?void 0:t.record;return i&&(t!=null&&t.column.tree)&&i.isParent&&i.instanceMeta(r.store).collapsed?(e.expand(i),!0):!1}collapseIfSingleColumn(){return this.client.columns.count===1?this.collapseByKey():!1}collapseByKey(){const e=this,{client:r}=e,{focusedCell:t}=r,i=t==null?void 0:t.record;if(t!=null&&t.column.tree&&i){if(i.isParent&&!i.instanceMeta(r.store).collapsed)return e.collapse(i),!0;if(i.parent&&!i.parent.isRoot)return r.deselectAll(),r.focusCell({record:i.parent,column:t.column}),!0}return!1}};R(yi,"$name","Tree"),R(yi,"configurable",{expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"}}),yi.featureClass="b-tree",yi._$name="Tree",z.registerFeature(yi,!1,"Grid"),z.registerFeature(yi,!0,"TreeGrid");var on=class extends X{construct(e,r){if(super.construct(e,r),!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled")}processParentData(e){this.parentCls&&(e.cls=this.parentCls)}processTransformedData(e){}async waitForReadiness(){if(this.originalStore.isLoading&&(await this.originalStore.await("load",!1),this.isDestroyed))return;const{crudManager:e}=this.client;if(e){if((e.isLoadingOrSyncing||e._autoLoadPromise)&&(await e.await("requestDone"),this.isDestroyed))return;await this.client.project.commitAsync()}}async applyLevels(e){var r;const t=this,{client:i}=t,n=i.columns.find(o=>o instanceof an);let{store:s}=i,a=null;if(t._levels=e,t.isApplying++,i.suspendRefresh(),e&&!t.originalStore&&(t.originalStore=s,s=new s.constructor({tree:!0,modelClass:s.modelClass,load:(r=s.load)==null?void 0:r.bind(s),commit:s.commit.bind(s)}),i.store=s,t.originalStore.ion({name:"originalStore",refresh:t.onOriginalStoreRefresh,add:t.onOriginalStoreChanged,remove:t.onOriginalStoreChanged,removeAll:t.onOriginalStoreChanged,thisObj:t})),await t.waitForReadiness(),!t.isDestroyed)return e?(s.data=t.originalStore.allRecords.flatMap(o=>o.isLeaf?[o.link()]:[]),a=s.treeify(e,o=>{T.setPath(o,s.modelClass.getFieldDataSource(n.field),o.key),t.processParentData(o)}),t.processTransformedData(a),s.data=a.children):(i.store=t.originalStore,t.detachListeners("originalStore"),t.originalStore=null),t.isApplying--,i.resumeRefresh(),i.rowManager.reinitialize(),a}onOriginalStoreChanged(){this.applyLevels(this._levels)}onOriginalStoreRefresh({action:e}){e==="dataset"&&this.applyLevels(this.levels)}updateLevels(e){(e||!this.isConfiguring)&&this.applyLevels(e)}async group(e){T.assertArray(e,"group()"),await this.applyLevels(e)}async clearGroups(){this.isGrouped&&await this.applyLevels(null)}get isGrouped(){return!!this._levels}};R(on,"$name","TreeGroup"),R(on,"configurable",{levels:null,parentCls:"b-generated-parent"}),R(on,"pluginConfig",{assign:["group","clearGroups"]}),R(on,"properties",{isApplying:0,originalStore:null}),on._$name="TreeGroup",z.registerFeature(on);var ht={all:"all",visible:"visible"},Do={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},Cs={portrait:"portrait",landscape:"landscape"},zc={pdf:"pdf",png:"png"},OP={pdf:"application/pdf",png:"image/png"},Pf=class extends qe{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const e=this;return[{id:ht.all,text:e.L("L{all}")},{id:ht.visible,text:e.L("L{visible}")}]}};Pf.initClass(),Pf._$name="ExportRowsCombo";var If=class extends qe{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const e=this;return[{id:Cs.portrait,text:e.L("L{portrait}")},{id:Cs.landscape,text:e.L("L{landscape}")}]}};If.initClass(),If._$name="ExportOrientationCombo";function AS(e,r=t=>t){return Object.keys(e).map(t=>({id:t,text:r(t)}))}var Eo=class extends st{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",editable:!1,value:"singlepage",displayField:"text",buildItems(){const e=this.parent;return e.exporters.map(r=>({id:r.type,text:e.optionalL(r.title,this)}))},onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden=e==="singlepage",this.owner.widgetMap.repeatHeaderField.hidden=e!=="multipagevertical"},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:e,oldValue:r}){const t=this.parent;if(t.hidePNGMultipageOption){const i=t.widgetMap.exporterTypeField,n=i.store.find(s=>s.id==="singlepage");e===zc.png&&n?(this._previousDisabled=i.disabled,i.disabled=!0,this._previousValue=i.value,i.value="singlepage"):r===zc.png&&this._previousValue&&(i.disabled=this._previousDisabled,i.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(e={}){const r=this,{client:t}=e;if(!t)throw new Error("`client` config is required");r.columnsStore=t.columns.chain(i=>i.isLeaf&&i.exportable,null,{excludeCollapsedRecords:!1}),r.applyInitialValues(e),super.construct(e),He.ion({locale:"onLocaleChange",prio:-1,thisObj:r})}applyInitialValues(e){const r=this,t=e.items=e.items||{};e.width=e.width||r.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||r.L("L{ExportDialog.labelWidth}"),t.columnsField=t.columnsField||{},t.fileFormatField=t.fileFormatField||{},t.paperFormatField=t.paperFormatField||{},t.fileFormatField.items=AS(zc,i=>i.toUpperCase()),t.paperFormatField.items=AS(Do),t.columnsField.store=r.columnsStore}onBeforeShow(){var e;const{columnsField:r,alignRowsField:t,exporterTypeField:i,repeatHeaderField:n}=this.widgetMap;this.autoSelectVisibleColumns&&(r.value=this.columnsStore.query(s=>!s.hidden)),t.hidden=i.value==="singlepage",n.hidden=i.value!=="multipagevertical",(e=super.onBeforeShow)==null||e.call(this,...arguments)}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget(r=>{r instanceof $e&&(r.labelWidth=e)})}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,r={};return this.eachWidget(t=>{e.test(t.ref)&&(r[t.ref.replace(e,"")]=t instanceof Zi?t.checked:t.value)}),r}};Eo.initClass(),Eo._$name="ExportDialog";var Af=document.createRange(),Ss=class extends F{static get configurable(){return{cls:{$config:{equal:(e,r)=>(e==null?void 0:e.isDomClassList)&&(r==null?void 0:r.isDomClassList)&&e.isEqual(r)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new ne({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),this.grid.positionMode==="position"&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement(r=>{r.dataset.index=e,r.ariaRowIndex=this.grid.hideHeaders?e+1:e+2}))}get id(){return this._id}set id(e){const r=this,t={id:e},i=r.rowManager.idMap;(r._id!==e||i[e]!==r)&&(i[r._id]===r&&delete i[r._id],i[e]=r,r._id=e,r.eachElement(n=>{ze.assign(n,t),n.dataset.id=e}),r.eachCell(n=>ze.assign(n,t)))}addElement(e,r){const t=this;let i=r.firstElementChild;for(t._elements[e]=r,t._elementsArray.push(r),t._regions.push(e),ze.assign(r,{index:t.index}),t._cells[e]=[];i;)t._cells[e].push(i),t._allCells.push(i),ze.set(i,{column:i.dataset.column,columnId:i.dataset.columnId,rowElement:i.parentNode,row:t}),i=i.nextElementSibling;r.dataset.index=t.index,r.ariaRowIndex=t.grid.hideHeaders?t.index+1:t.index+2}getElement(e){return this._elements[e]}getRectangle(e){return k.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e,r=!1){return this._allCells.find(t=>{const i=ze.get(t);return i.columnId==e||!r&&i.column==e})}removeElements(e=!1){const r=this;r.rowManager.trigger("removeRow",{row:r}),e||r.eachElement(t=>t.remove()),r._elements={},r._cells={},r._elementsArray.length=r._regions.length=r._allCells.length=r.lastHeight=r.height=0,r.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const r=this;e||r.rowManager.storeKnownHeight(r.id,r.height),r.lastHeight!==r.height&&(this.eachElement(t=>t.style.height=`${r.offsetHeight}px`),r.lastHeight=r.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,r){this.updateCls(this.cls[r?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return e!=null&&e.isDomClassList?e:new J(e)}updateCls(e){this.eachElement(r=>C.syncClassList(r,e))}setAttribute(e,r){this.eachElement(t=>t.setAttribute(e,r))}removeAttribute(e){this.eachElement(r=>r.removeAttribute(e))}get isFirst(){return this.dataIndex===0}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,r){this._top!==e&&(this._top=e,this.translateElements(r))}setBottom(e,r){this.setTop(e-this.offsetHeight,r)}translate(e,r=!1){return this.setTop(e,r),e+this.offsetHeight}translateElements(e){const r=this,{top:t,_elementsArray:i}=r;if(r.lastTop!==t){for(let n=0,{length:s}=i;n<s;n++)i[n].style.transform=`translate(0,${t}px)`;!e&&r.rowManager.trigger("translateRow",{row:r}),r.lastTop=t}}positionElements(e){const r=this,{top:t,_elementsArray:i}=r;if(r.lastTop!==t){for(let n=0,{length:s}=i;n<s;n++)i[n].style.top=`${t}px`;!e&&r.rowManager.trigger("translateRow",{row:r}),r.lastTop=t}}offset(e){let r=this._top+e;return r<0&&(e-=r,r=0),this.setTop(r),e}render(e,r,t=!0,i=!1,n=!1){var s,a,o;const l=this,{cellContext:c,cls:d,elements:u,grid:h,rowManager:f,height:g,_id:m}=l,p=ze.get(l._elementsArray[0]),v=f._rowHeight,{store:y}=h,{isTree:S}=y;let D=0,w;if(!r&&r!==!1&&(r=h.store.getById(p.id),e=h.store.indexOf(r)),!r)return;const E=r==null?void 0:r.cls,x=E?E.isDomClassList?E:new J(E):null;d.assign({"b-grid-row-updating":t&&h.transitionDuration&&!n,"b-selected":h.isSelected(r==null?void 0:r.id),"b-readonly":r.readOnly,"b-linked":r.isLinked,"b-original":r.hasLinks}),l.lastRecordCls&&d.remove(l.lastRecordCls),x?(d.add(x),l.lastRecordCls=Object.assign({},x)):l.lastRecordCls=null,f.trigger("beforeRenderRow",{row:l,record:r,recordIndex:e,oldId:m}),h.beforeRenderRow({row:l,record:r,recordIndex:e,oldId:m}),l.updateCls(d),t&&h.transitionDuration&&!n&&h.setTimeout(()=>{l.isDestroyed||(d.remove("b-grid-row-updating"),l.updateCls(d))},h.transitionDuration),l.id=r.id,l.dataIndex=e;const M=!h.fixedRowHeight&&h.getRowHeight(r)||v;let I=l.maxRequestedHeight=null;if(S)for(const _ in u){const A=u[_];A.id=`${h.id}-${_}-${l.id}`,C.setAttributes(A,{"aria-level":r.childLevel+1,"aria-setsize":r.parent.children.length,"aria-posinset":r.parentIndex+1}),r.isExpanded(y)?C.setAttributes(A,{"aria-expanded":!0,"aria-owns":(s=r.children)!=null&&s.length?(a=r.children)==null?void 0:a.map(V=>`${h.id}-${_}-${V.id}`).join(" "):null}):(r.isLeaf?A.removeAttribute("aria-expanded"):A.setAttribute("aria-expanded",!1),A.removeAttribute("aria-owns"))}for(c._record=r,c._id=r.id,c._rowIndex=e,D=0;D<h.columns.visibleColumns.length;D++){const _=h.columns.visibleColumns[D];c._columnId=_.id,c._column=_,c._columnIndex=D,c._cell=l.getCell(_.id,!0),c.height=M,c.maxRequestedHeight=I,c.updatingSingleRow=t,w=l.renderCell(c),f.fixedRowHeight||w.height!=null&&(I=Math.max(I,w.height),w.transient||(l.maxRequestedHeight=I))}const P=I!=null?I:M;l.height=(o=h.processRowHeight(r,P))!=null?o:P,l.updateElementsHeight(n),t&&!n&&(g!==l.height&&f.translateFromRow(l,i),f.trigger("updateRow",{row:l,record:r,recordIndex:e,oldId:m}),f.trigger("renderDone")),h.afterRenderRow({row:l,record:r,recordIndex:e,oldId:m,oldHeight:g,isExport:n}),f.trigger("renderRow",{row:l,record:r,recordIndex:e,oldId:m,isExport:n}),g&&l.height!==g&&f.trigger("rowRowHeight",{row:l,record:r,height:l.height,oldHeight:g}),l.forceInnerHTML=!1}renderCell(e){var r,t,i,n;e.isLocation||(e=new ne(e));let{cell:s,record:a}=e;const o=this,{grid:l,column:c,height:d,maxRequestedHeight:u,updatingSingleRow:h=!0,isMeasuring:f=!1}=e,g=(r=l.features)==null?void 0:r.cellEdit,m=ze.get(s),p=m.rowElement,v=ze.get(p);if(!a&&(a=e._record=l.store.getById(v.id),!a))return;let y=c.getRawValue(a);const S=a.fieldMap[c.field],D={configuredHeight:d,height:null,maxRequestedHeight:u},w=c.getCellClass(e),E={cellElement:s,dataField:S,rowElement:p,value:y,record:a,column:c,size:D,grid:l,row:m.row,updatingSingleRow:h,isMeasuring:f},x=c.renderer||c.defaultRenderer;l.beforeRenderCell(E),E.cellElement!==s&&(s=E.cellElement),C.syncClassList(s,w);let M=!0;x?(y=c.callback(x,c,[E]),y===void 0&&c.alwaysClearCell===!1&&(M=!1)):S&&(y=S.print(y));const I=(t=l.hasFrameworkRenderer)==null?void 0:t.call(l,{cellContent:y,column:c});I&&a.isSpecialRow&&(y="");const P=I&&!c.data.tree&&!a.isSpecialRow;if(M&&!P){let _=s;(i=g==null?void 0:g.editorContext)!=null&&i.equals(e)&&!g.editor.isFinishing&&(_=o.moveContentFromCell(s,g.editor.element));const A=y!=null&&typeof y=="object",V=typeof y=="string",N=A||y==null?"":String(y);if(o.forceInnerHTML&&(_.innerHTML="",delete _._content,s.lastDomConfig=null),!A&&c.htmlEncode&&!c.disableHtmlEncode?s._hasHtml?(_.innerText=N,s._hasHtml=!1):C.setInnerText(_,N):c.autoSyncHtml&&(!V||C.getChildElementCount(_))?V?C.sync(N,_.firstElementChild):A&&q.sync({domConfig:y,targetElement:_}):A?q.sync({targetElement:_,domConfig:{onlyChildren:!0,children:H.asArray(y)}}):_._content!==N&&(_.innerHTML=_._content=N),_!==s){const{firstChild:B}=s;for(const Z of _.childNodes)s.insertBefore(Z,B)}}return a.isSpecialRow||(n=l.processCellContent)==null||n.call(l,{cellElementData:m,rendererData:E,rendererHtml:E.rendererHtml||y}),c.autoHeight&&D.height==null&&(s.classList.add("b-measuring-auto-height"),D.height=Math.max(s.offsetHeight,l.rowHeight),s.classList.remove("b-measuring-auto-height")),f||o.rowManager.trigger("renderCell",E),D}moveContentFromCell(e,r){Af.setStart(e,0),Af.setEndBefore(r);const t=document.createElement("div");return t.appendChild(Af.extractContents()),t}};R(Ss,"$name","Row"),Ss.initClass(),Ss._$name="Row";var ws=class extends ge(Ae(Ve(F))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:e=>e}}pageTpl(e){const{title:r,header:t,footer:i,styles:n,htmlClasses:s,bodyStyle:a,bodyClasses:o=[],paperHeight:l,paperWidth:c,html:d}=e;return o.push(`b-${this.constructor.type}`),C.scrollBarWidth?o.push("b-visible-scrollbar"):o.push("b-overlay-scrollbar"),Y.isChrome?o.push("b-chrome"):Y.isSafari?o.push("b-safari"):Y.isFirefox&&o.push("b-firefox"),Jt.tpl`
            <!DOCTYPE html>
            <html class="${s}" style="width: ${c}in; height: ${l}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${r}</title>
                    ${n.join("")}
                </head>
                <body class="b-export ${o.join(" ")}" style="width: ${c}in; height: ${l}in; ${a}">
                    <div class="b-export-content">
                        ${t&&`<div class="b-export-header" style="width: 100%">${t}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${i&&`<div class="b-export-footer" style="width: 100%">${i}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const r=e.translateURLsToAbsolute,t=globalThis.origin,i=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),n=[];return i.forEach(s=>{if(s=s.cloneNode(!0),r&&s.href){let o;r===!0?o=s.href:this.keepPathName?o=s.href.replace(t,r):o=new URL(s.getAttribute("href"),r),s.setAttribute("href",o)}let a=s.outerHTML;if(r&&/style/i.test(s.tagName)){const o=e.getStyleTagURLConverter(r);a=a.replace(/url\(['"]?(.+?)['"]?\)/g,o)}n.push(a)}),n.push(`<style>
                body, html {
                    overflow: auto;
                }
                body {
                    position: relative;
                    margin: 0;
                }
            </style>`),e._stylesheets=e.filterStyles(n)}set stylesheets(e){this._stylesheets=e&&this.filterStyles(e)}getStyleTagURLConverter(e){return function(r,t){let i;try{let n;/^#/.test(t)?i=r:(e===!0?n=globalThis.location.href:this.keepPathName?n=globalThis.location.href.replace(globalThis.location.origin,e):n=e,i=`url('${new URL(t,n).href}')`)}catch(n){i=r}return i}.bind(this)}saveState({client:e}){this.state=e.state}async restoreState({client:e}){const r=[],t=new Set;t.add(e.scrollable.ion({scroll(){r.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid(({header:i,scrollable:n})=>{t.add(n.ion({scroll(){r.push(n.await("scrollEnd"))}})),t.add(i.scrollable.ion({scroll(){r.push(i.scrollable.await("scrollEnd"))}}))}),e.state=this.state,await Promise.all(r),t.forEach(i=>i())}beforeExport(){this.element=document.createElement("div")}cloneElement(e,r=this.element,t=!0){t&&(r.innerHTML=""),r.appendChild(e.cloneNode(!0)),C.removeEachSelector(r,".b-grid-row,.b-grid-merged-cells-container");const i=r.querySelector(".b-gridbase > .b-mask");i&&i.remove()}createPlaceholder(e,r=!0,t={}){return r&&(e.innerHTML=""),C.createElement(Object.assign({parent:e,id:ji.generateId("export")},t))}prepareElement({client:e}){const{tbar:r,bbar:t}=e;r&&this.element.querySelector(`#${r.id}`).remove(),t&&this.element.querySelector(`#${t.id}`).remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const r=C.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),t=r.offsetHeight-2;return r.remove(),t}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const r=C.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),t=r.querySelectorAll("img");for(let n=0,s=t.length;n<s;n++)t[n].setAttribute("src",t[n].src);const i=r.innerHTML;return r.remove(),i}getVirtualScrollerHeight(e){let r=0;return e.eachSubGrid(t=>{t.overflowingHorizontally&&(r=C.scrollBarWidth)}),r===0?r:r+1}inchToPx(e){return e*96}getScaleValue(e,r){return Math.floor(e*1e4/r)/1e4}getVisibleRowsCount(e){const r=e.rowManager,t=r.rows.indexOf(r.firstVisibleRow),i=r.rows.indexOf(r.lastVisibleRow);let n;return t!==-1?i===-1?n=e.store.count-t:n=i-t+1:n=e.store.count,n}async export(e){const r=this;let t;r.beforeExport(),r.saveState(e),await r.prepareComponent(e);try{t=await r.getPages(e)}finally{await r.restoreComponent(e),r.stylesheets=null,await new Promise(i=>r.requestAnimationFrame(i)),await r.restoreState(e)}return t}async getPages(e){const r=this.pagesExtractor(e),t=[];let i;for(;(i=await r.next())&&!i.done;)t.push(i.value);return t}adjustRowBuffer(e){const{contentHeight:r}=this.exportMeta,{rowManager:t}=e;this.oldRowManagerConfig={prependRowBuffer:t.prependRowBuffer,appendRowBuffer:t.appendRowBuffer};const i=Math.ceil(r/t.rowOffsetHeight);t.prependRowBuffer=i,t.appendRowBuffer=i,e.renderRows(),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const r=this,{client:t,columns:i,rowsRange:n,keepRegionSizes:s,enableDirectRendering:a}=e,{rowManager:o}=t,l=r.exportMeta={enableDirectRendering:a,totalWidth:0,totalHeight:0-(a?0:r.getVirtualScrollerHeight(t)),subGrids:{}};t.columns.forEach(u=>{i.includes(u.id)?u.show():u.hide()}),await new Promise(u=>t.requestAnimationFrame(u)),t.rowManager.rowCount>0&&(n===ht.all?l.firstVisibleDataIndex=o.rows[0].dataIndex:(l.firstVisibleDataIndex=o.firstVisibleRow.dataIndex,e.alignRows=!0),a||await t.scrollRowIntoView(t.store.getAt(l.firstVisibleDataIndex),{block:"start"}));const{element:c}=r;r.cloneElement(t.element),r.prepareElement(e);let d;a&&(l.fakeRow=d=new Ss({cls:t.rowCls,rowManager:t.rowManager,grid:t,index:-10,dataIndex:-10})),t.eachSubGrid(u=>{var h,f,g;d&&(u.onAddRow({rows:[d],isExport:!0}),d.element.dataset.ownerCmp=t.id);const m=r.createPlaceholder(c.querySelector(`[id="${u.id}"]`),!1);let p;s!=null&&s[u.region]?p=u.element.offsetWidth:p=u.columns.visibleColumns.reduce((y,S)=>(typeof S.width=="number"?y+=S.width:y+=(t.hideHeaders?t.rowManager.rows[0].getCell(S.id):S.element).offsetWidth,y),0),l.totalWidth+=p;const v=((h=u.splitterElement)==null?void 0:h.offsetWidth)||0;l.totalWidth+=v,l.subGrids[u.region]={id:u.id,headerId:((f=u.header)==null?void 0:f.id)||null,footerId:((g=u.footer)==null?void 0:g.id)||null,rows:[],splitterWidth:v,placeHolder:m,width:p}})}prepareExportElement(){const e=this,{element:r,exportMeta:t}=e;return Object.values(t.subGrids).forEach(({width:i,id:n,headerId:s,footerId:a})=>{[n,s,a].forEach(o=>{if(o){const l=r.querySelector(`[id="${o}"]`);l&&(l.style.width=`${i}px`,l.style.flex="")}})}),r.innerHTML}async restoreComponent(e){this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}async scrollRowIntoView(e,r){await e.scrollRowIntoView(e.store.getAt(r),{block:"start"}),await new Promise(t=>this.requestAnimationFrame(t))}collectRow(e){const r=this.exportMeta.subGrids,t=/data-owner-cmp=".+?"/;Object.entries(e.elements).forEach(([i,n])=>{r[i].rows.push([n.outerHTML.replace(t,""),e.top,e.offsetHeight,new Map])})}renderMergedCells(e,r,t,i){const n=this,{client:s}=e,{subGrids:a}=n.exportMeta,o=s.features.mergeCells.buildMergedCellsConfig(r,t,i);for(const l in a){const c=a[l],d=document.createElement("div");q.sync({targetElement:d,domConfig:{children:o[l].children}}),d.childNodes.length&&(d.childNodes.forEach(u=>{const{syncId:h}=u.dataset,f=s.features.mergeCells.mergedRanges.find(g=>{var m;return((m=g.cellElement)==null?void 0:m.parentNode.dataset.syncId)===h});f&&(u.innerHTML=f.cellElement.outerHTML)}),c.mergedCellsHtml=[d.innerHTML])}}};ws.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},ws._$name="Exporter";var Ds=class extends ws{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e,rowsRange:r,enableDirectRendering:t}){const{exportMeta:i}=this;++i.currentPage,++i.verticalPosition,delete i.lastExportedRowBottom,i.verticalPosition>=i.verticalPages&&(Object.assign(i,{verticalPosition:0,horizontalPosition:i.horizontalPosition+1,currentPageTopMargin:0,lastTop:0,lastRowIndex:r===ht.visible?e.rowManager.firstVisibleRow.dataIndex:0}),delete i.lastRowDataIndex,t||await this.scrollRowIntoView(e,i.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:o,enableDirectRendering:l}=e,c=Do[e.paperFormat],d=e.orientation===Cs.portrait,u=d?c.width:c.height,h=d?c.height:c.width,f=r.inchToPx(u),g=r.inchToPx(h),m=o===ht.visible,p=Math.ceil(t.totalWidth/f);let v=g;n&&(v-=r.measureElement(n({totalWidth:t.totalWidth,totalPages:-1,currentPage:-1}))),s&&(v-=r.measureElement(s({totalWidth:t.totalWidth,totalPages:-1,currentPage:-1})));let y,S,D=i.store.count;if(m?(D=r.getVisibleRowsCount(i),y=t.totalHeight+i.headerHeight+i.footerHeight+i.bodyHeight):y=t.totalHeight+i.headerHeight+i.footerHeight+i.scrollable.scrollHeight,a&&!m){const w=i.rowManager.rowOffsetHeight,E=Math.floor((v-i.headerHeight)/w),x=Math.floor(v/w),M=D-E;S=1+Math.ceil(M/x)}else S=Math.ceil(y/v);Object.assign(t,{paperWidth:u,paperHeight:h,pageWidth:f,pageHeight:g,horizontalPages:p,verticalPages:S,totalHeight:y,contentHeight:v,totalRows:D,totalPages:p*S,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:m?i.rowManager.firstVisibleRow.dataIndex:0}),l||this.adjustRowBuffer(i)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,rowsRange:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,contentHeight:c,totalRows:d,lastRowDataIndex:u}=t,{rowManager:h}=i,{rows:f}=h,g=s===ht.visible,m=i.hasActiveFeature("mergeCells");let p,v;g&&u!=null?u===f[f.length-1].dataIndex?v=f.length-1:v=f.findIndex(x=>x.dataIndex===u):v=g?f.findIndex(x=>x.bottom>Math.ceil(i.scrollable.y)):f.findIndex(x=>x.bottom+o+i.headerHeight>0);const y=v,S=g||l===0?0:f[v].top+o+i.headerHeight;p=c-S,l===0&&(p-=i.headerHeight);let D,w=0;for(;p>0;){const x=f[v];n&&p<x.offsetHeight?(w=-p,p=0,r.exportMeta.lastExportedRowBottom=f[v-1].bottom):(r.collectRow(x),p-=x.offsetHeight,D=x.dataIndex,(++v===f.length&&p>0||g&&v-y===d)&&(p=0))}if(m)for(const x in a){const M=a[x],I=i.subGrids[x].element.querySelectorAll(".b-grid-merged-cells");M.mergedCellsHtml=[];for(const P of I)M.mergedCellsHtml.push(P.outerHTML)}const E=f[v-1];if(E&&(t.exactGridHeight=E.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight,t.lastRowDataIndex=E.dataIndex+1),await r.onRowsCollected(f.slice(y,v),e),g)t.exactGridHeight-=t.scrollableTopMargin=i.scrollable.y;else{const x=h.ion({offsetRows:({offset:M})=>w+=M});await r.scrollRowIntoView(i,D+1),x()}return w}async renderRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,rowsRange:s}=e,{currentPageTopMargin:a,verticalPosition:o,contentHeight:l,totalRows:c,lastRowIndex:d,fakeRow:u}=t,{store:h}=i,f=i.hasActiveFeature("mergeCells"),g=s===ht.visible;let m=d,{lastTop:p}=t,v;const y=m,S=g||o===0?0:p+a+i.headerHeight,D=[];v=l-S,o===0&&(v-=i.headerHeight);let w,E,x=0;for(;v>0;)u.render(m,h.getAt(m),!0,!1,!0),n&&v<u.offsetHeight?(x=-v,v=0,r.exportMeta.lastExportedRowBottom=p):(E=p,w=m,p=u.translate(p),v-=u.offsetHeight,r.collectRow(u),D.push({top:u.top,bottom:u.bottom,offsetHeight:u.offsetHeight,dataIndex:u.dataIndex}),(++m===h.count&&v>0||g&&m-y===c)&&(v=0));return f&&r.renderMergedCells(e,y,m,D),t.lastRowIndex=n?m:w,t.lastTop=n?p:E,u&&(t.exactGridHeight=u.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight),await r.onRowsCollected(D,e),x}async buildPage(e){const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:c,subGrids:d}=t;Object.values(d).forEach(m=>m.rows=[]),e.rowsRange===ht.all&&(t.totalHeight=i.height-i.bodyHeight+i.scrollable.scrollHeight-r.getVirtualScrollerHeight(i));let u,h;n&&(u=r.prepareHTML(n({totalWidth:o,totalPages:l,currentPage:c}))),s&&(h=r.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:c})));let f;return a?f=await r.renderRows(e):f=await r.collectRows(e),{html:r.buildPageHtml(e),header:u,footer:h,offset:f}}async onRowsCollected(){}buildPageHtml(){const e=this,{subGrids:r}=e.exportMeta;let t=e.prepareExportElement();return Object.values(r).forEach(({placeHolder:i,rows:n,mergedCellsHtml:s})=>{const a=i.outerHTML;let o=n.reduce((l,c)=>(l+=c[0],l),"");s!=null&&s.length&&(o+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),t=t.replace(a,o)}),t}prepareExportElement(){const e=this,{element:r,exportMeta:t}=e;return t.scrollableTopMargin&&(r.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${t.scrollableTopMargin}px`),super.prepareExportElement()}};Ds.prototype.pagesExtractor=async function*(r){const t=this,{exportMeta:i,stylesheets:n}=t,{totalWidth:s,totalPages:a,paperWidth:o,paperHeight:l,contentHeight:c}=i;let d;for(;(d=i.currentPage)<a;){t.trigger("exportStep",{text:t.L(Ds.exportingPageText,{currentPage:d,totalPages:a}),progress:Math.round((d+1)/a*90)});const{html:u,header:h,footer:f,offset:g}=await t.buildPage(r),m=[...n,`
                <style>
                    #${r.client.id} {
                        height: ${i.exactGridHeight}px !important;
                        width: ${s}px !important;
                    }
                    .b-export-body .b-export-viewport {
                        margin-inline-start : ${-o*i.horizontalPosition}in;
                        margin-top  : ${i.currentPageTopMargin}px;
                    }
                </style>
            `];i.currentPageTopMargin-=c+g,await t.stateNextPage(r),yield{html:t.pageTpl({html:u,header:h,footer:f,styles:m,paperWidth:o,paperHeight:l})}}},Ds._$name="MultiPageExporter";var Es=class extends ws{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:r}=this,{totalRows:t,processedRows:i,totalPages:n}=r;++r.currentPage,++r.verticalPosition,r.currentPage===n&&i.size!==t&&(++r.totalPages,++r.verticalPages)}estimateTotalPages(e){const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:o,repeatHeader:l,enableDirectRendering:c}=e,{pageWidth:d,pageHeight:u,totalWidth:h}=t,f=r.getScaleValue(d,h);let g=0-r.getVirtualScrollerHeight(i)+i.height-i.bodyElement.offsetHeight+i.scrollable.scrollHeight,m=u/f,p=i.store.count,v=0,y=g,S;if(n&&(m-=r.measureElement(n({totalWidth:h,totalPages:-1,currentPage:-1}))),s&&(m-=r.measureElement(s({totalWidth:h,totalPages:-1,currentPage:-1}))),l&&(m-=i.headerHeight+i.footerHeight,g-=i.headerHeight+i.footerHeight),o===ht.visible){const D=i.rowManager,w=D.firstVisibleRow,E=D.lastVisibleRow;c||(v=w.top),p=r.getVisibleRowsCount(i),c?(g=i.headerHeight+i.footerHeight+E.bottom-w.top,y=E.bottom-w.top):y=g=g-i.scrollable.scrollHeight+E.bottom-w.top,t.lastRowIndex=w.dataIndex,t.finishRowIndex=E.dataIndex}else t.finishRowIndex=i.store.count-1;if(a&&!l&&o!==ht.visible){const D=i.rowManager.rowOffsetHeight,w=Math.floor((m-i.headerHeight)/D),E=Math.floor(m/D),x=p-w;S=1+Math.ceil(x/E)}else S=Math.ceil(y/m);Object.assign(t,{scale:f,contentHeight:m,totalRows:p,totalHeight:g,verticalPages:S,initialScroll:v,horizontalPages:1,totalPages:S})}async prepareComponent(e){await super.prepareComponent(e);const r=this,{exportMeta:t}=r,{client:i}=e,n=Do[e.paperFormat],s=e.orientation===Cs.portrait,a=s?n.width:n.height,o=s?n.height:n.width,l=r.inchToPx(a),c=r.inchToPx(o);Object.assign(t,{paperWidth:a,paperHeight:o,pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:0,processedRows:new Set}),r.estimateTotalPages(e),e.enableDirectRendering||r.adjustRowBuffer(i)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,repeatHeader:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,totalRows:c,contentHeight:d}=t,u=s?0:i.headerHeight,{rowManager:h}=i,{rows:f}=h,g=e.rowsRange===ht.visible,m=i.hasActiveFeature("mergeCells");let p=g?f.findIndex(x=>x.bottom>i.scrollable.y):f.findIndex(x=>x.bottom+o+u>0),v;const y=p,S=l===0?0:f[p].top+o+u;v=d-S,l===0&&(v-=u);let D,w=0;for(;v>0;){const x=f[p];n&&v<x.offsetHeight?(w=-v,v=0):(r.collectRow(x),v-=x.offsetHeight,v>0&&t.processedRows.add(x.dataIndex),D=x.dataIndex,(++p===f.length&&v>0||g&&p-y===c)&&(v=0))}if(m)for(const x in a){const M=a[x],I=i.subGrids[x].element.querySelectorAll(".b-grid-merged-cells");M.mergedCellsHtml=[];for(const P of I)M.mergedCellsHtml.push(P.outerHTML)}const E=f[p-1];if(E&&(t.exactGridHeight=E.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight),await r.onRowsCollected(f.slice(y,p),e),g)t.scrollableTopMargin=i.scrollable.y;else{const x=h.ion({offsetRows:({offset:M})=>w+=M});await r.scrollRowIntoView(i,D+1),x()}return w}async renderRows(e){const r=this,{exportMeta:t}=r,{client:i,alignRows:n,repeatHeader:s}=e,{currentPageTopMargin:a,verticalPosition:o,totalRows:l,contentHeight:c,lastRowIndex:d,finishRowIndex:u,fakeRow:h}=t,f=s?0:i.headerHeight,{store:g}=i,m=i.hasActiveFeature("mergeCells"),p=e.rowsRange===ht.visible;let v=d,{lastTop:y}=t,S;const D=v,w=o===0?0:y+a+f,E=[];S=c-w,o===0&&(S-=f);let x,M,I=0;for(;S>0;)h.render(v,g.getAt(v),!0,!1,!0),n&&S<h.offsetHeight?(I=-S,S=0):(M=y,x=v,y=h.translate(y),S-=h.offsetHeight,r.collectRow(h),E.push({top:h.top,bottom:h.bottom,offsetHeight:h.offsetHeight,dataIndex:h.dataIndex}),S>0&&t.processedRows.add(v),(v===u||++v-D===l&&p)&&(S=0));return m&&r.renderMergedCells(e,D,v,E),t.lastRowIndex=x,t.lastTop=M,h&&(t.exactGridHeight=h.bottom+i.footerContainer.offsetHeight+i.headerContainer.offsetHeight),await r.onRowsCollected(E,e),I}async buildPage(e){const r=this,{exportMeta:t}=r,{client:i,headerTpl:n,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:c,subGrids:d}=t;Object.values(d).forEach(m=>m.rows=[]),e.rowsRange===ht.all&&(t.totalHeight=i.headerHeight+i.footerHeight+i.scrollable.scrollHeight,a||(t.totalHeight-=r.getVirtualScrollerHeight(i)));let u,h,f;return n&&(u=r.prepareHTML(n({totalWidth:o,totalPages:l,currentPage:c}))),s&&(h=r.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:c}))),a?f=await r.renderRows(e):f=await r.collectRows(e),{html:r.buildPageHtml(e),header:u,footer:h,offset:f}}async onRowsCollected(){}buildPageHtml(){const e=this,{subGrids:r}=e.exportMeta;let t=e.prepareExportElement();return Object.values(r).forEach(({placeHolder:i,rows:n,mergedCellsHtml:s})=>{const a=i.outerHTML;let o=n.reduce((l,c)=>(l+=c[0],l),"");s!=null&&s.length&&(o+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),t=t.replace(a,o)}),t}};Es.prototype.pagesExtractor=async function*(r){const t=this,{exportMeta:i,stylesheets:n}=t,{totalWidth:s,paperWidth:a,paperHeight:o,contentHeight:l,scale:c,initialScroll:d}=i;let{totalPages:u}=i,h;for(;(h=i.currentPage)<u;){t.trigger("exportStep",{text:t.L(Es.exportingPageText,{currentPage:h,totalPages:u}),progress:Math.round((h+1)/u*90)});const{html:f,header:g,footer:m,offset:p}=await t.buildPage(r),v=[...n,`
                <style>
                    #${r.client.id} {
                        width: ${s}px !important;
                    }
                    .b-export .b-export-content {
                        transform: scale(${c});
                        transform-origin: top left;
                        height: auto;
                    }
                </style>
            `];if(r.repeatHeader){const y=i.exactGridHeight?`${i.exactGridHeight+i.currentPageTopMargin}px`:"100%";v.push(`
                <style>
                    #${r.client.id} {
                        height: ${y} !important;
                    }
                    .b-export .b-export-content {
                        height: ${100/c}%;
                    }
                    .b-export-body {
                        height: 100%;
                        display: flex;
                    }
                    .b-export-viewport {
                        height: 100%;
                    }
                    .b-grid-vertical-scroller {
                        margin-top: ${i.currentPageTopMargin-d}px;
                    }
                </style>
                `)}else{const y=i.exactGridHeight||l-i.currentPageTopMargin;v.push(`
                <style>
                    #${r.client.id} {
                        height: ${y}px !important;
                    }
                    .b-export-body {
                        overflow: hidden;
                    }
                    .b-export .b-export-content {
                        height: ${100/c}%;
                    }
                    .b-export-body .b-export-viewport {
                        margin-top: ${i.currentPageTopMargin}px;
                    }
                    .b-grid-vertical-scroller {
                        margin-top: -${d}px;
                    }
                </style>
                `)}i.currentPageTopMargin-=l+p,await t.stateNextPage(r),{totalPages:u}=i,yield{html:t.pageTpl({html:f,header:g,footer:m,styles:v,paperWidth:a,paperHeight:o})}}},Es._$name="MultiPageVerticalExporter";var xo=class extends ws{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e,r){if(r.enableDirectRendering)return e.map(t=>t[0]);{let t=0;return e.map(([i,,n])=>{const s=i.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${t}px)`);return t+=n,s})}}async collectRows(e){const r=this,{client:t}=e,{rowManager:i,store:n}=t,s=t.hasActiveFeature("mergeCells"),{subGrids:a}=r.exportMeta,o=e.rowsRange===ht.visible&&n.count?r.getVisibleRowsCount(t):n.count;let{totalHeight:l}=r.exportMeta,c=0,d=-1;if(i.rows.length>0){if(e.rowsRange===ht.visible&&(d=i.firstVisibleRow.dataIndex-1),s)for(const u of Object.values(a))u.mergedCellsHtml=[];for(;c<o;){const u=i.rows,h=u[u.length-1],f=c;if(u.forEach(p=>{p.dataIndex>d&&c<o&&(++c,l+=p.offsetHeight,r.collectRow(p))}),s)for(const p in a){const v=a[p],y=t.subGrids[p].element.querySelectorAll(".b-grid-merged-cells");for(const S of y)v.mergedCellsHtml.push(S.outerHTML)}const g=u.findIndex(p=>p.dataIndex===d+1),m=g+(c-f);await r.onRowsCollected(u.slice(g,m),e),c<o&&(d=h.dataIndex,await r.scrollRowIntoView(t,d+1))}}return l}async renderRows(e){const r=this,{client:t,rowsRange:i}=e,{rowManager:n,store:s}=t,a=t.hasActiveFeature("mergeCells"),o=i===ht.visible;let{totalHeight:l}=r.exportMeta;if(s.count){const{fakeRow:c}=r.exportMeta,{firstVisibleRow:d}=n,u=o?d.dataIndex:0,h=o?n.lastVisibleRow.dataIndex:s.count-1,f=[];let g=0;if(c.cells.length){for(let m=u;m<=h;m++)c.render(m,s.getAt(m),!0,!1,!0),g=c.translate(g),r.collectRow(c),f.push({top:c.top,bottom:c.bottom,offsetHeight:c.offsetHeight,dataIndex:c.dataIndex});await r.onRowsCollected(f,e)}l+=g,a&&r.renderMergedCells(e,u,h,f)}return l}buildPageHtml(e){const r=this,{subGrids:t}=r.exportMeta;let i=r.prepareExportElement();return Object.values(t).forEach(({placeHolder:n,rows:s,mergedCellsHtml:a})=>{const o=n.outerHTML;let l=r.positionRows(s,e).join("");a!=null&&a.length&&(l+=`<div class="b-grid-merged-cells-container">${a.join("")}</div>`),i=i.replace(o,l)}),i}};xo.prototype.pagesExtractor=async function*(r){const t=this,{client:i}=r,{totalWidth:n}=t.exportMeta,s=t.stylesheets,a=r.orientation===Cs.portrait,o=Do[r.paperFormat],l=a?o.width:o.height,c=a?o.height:o.width;let d,u,h;r.enableDirectRendering?(d=await t.renderRows(r),d+=i.headerHeight+i.footerHeight):(d=await t.collectRows(r),d+=i.height-i.bodyHeight);const f=t.buildPageHtml(r),g=d;if(r.headerTpl){u=t.prepareHTML(r.headerTpl({totalWidth:n}));const y=t.measureElement(u);d+=y}if(r.footerTpl){h=t.prepareHTML(r.footerTpl({totalWidth:n}));const y=t.measureElement(h);d+=y}const m=Math.min(1,t.getScaleValue(t.inchToPx(l),n)),p=Math.min(1,t.getScaleValue(t.inchToPx(c),d)),v=Math.min(m,p);s.push(`<style>
                #${i.id} {
                    height: ${g}px !important;
                    width: ${n}px !important;
                }
                .b-export-content {
                    ${t.centerContentHorizontally?"left: 50%;":""}
                    transform: scale(${v}) ${t.centerContentHorizontally?"translateX(-50%)":""};
                    transform-origin: top left;
                    height: ${v===1?"inherit":"auto !important"};
                }
            </style>`),Y.isIE11&&s.push(`<style>
                .b-export-body {
                   min-height: ${g}px !important;
                }
         </style>`),yield{html:t.pageTpl({html:f,header:u,footer:h,styles:s,paperWidth:l,paperHeight:c})}},xo._$name="SinglePageExporter";var Wc=class extends X{static get $name(){return"PdfExport"}static get configurable(){return{dialogClass:Eo,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[xo,Ds,Es],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:e=>e,enableDirectRendering:!0}}updateEnableDirectRendering(e){e||re.deprecate("Grid","6.0.0","Indirect rendering is deprecated")}doDestroy(){var e;(e=this.exportDialog)==null||e.destroy(),this.exportersMap.forEach(r=>r.destroy()),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const r=this,{exportersMap:t}=r,{type:i}=e;let n;if(t.has(i))n=t.get(i),Object.assign(n,e);else{const s=this.exporters.find(a=>a.type===i);if(!s)throw new Error(`Exporter type ${i} is not found. Make sure you've configured it`);e=T.clone(e),delete e.type,n=new s(e),n.relayAll(r),t.set(i,n)}return n}buildExportConfig(e={}){const r=this,{client:t,exportServer:i,clientURL:n,fileFormat:s,fileName:a,paperFormat:o,rowsRange:l,alignRows:c,repeatHeader:d,keepRegionSizes:u,orientation:h,translateURLsToAbsolute:f,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:v,filterStyles:y,enableDirectRendering:S}=r;e.columns||(e.columns=t.columns.visibleColumns.filter(w=>w.exportable).map(w=>w.id));const D=T.assign({client:t,exportServer:i,clientURL:n,fileFormat:s,paperFormat:o,rowsRange:l,alignRows:c,repeatHeader:d,keepRegionSizes:u,orientation:h,translateURLsToAbsolute:f,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:v,enableDirectRendering:S,exporterType:r.exporterType,fileName:a||t.$$name},e);return D.columns=e.columns.slice(),D.exporterType!=="multipagevertical"&&(D.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(D.alignRows=!0),D.exporterConfig=T.assign({type:D.exporterType,translateURLsToAbsolute:D.translateURLsToAbsolute,keepPathName:D.keepPathName,filterStyles:y},D.exporterConfig||{}),delete D.exporterType,delete D.translateURLsToAbsolute,delete D.keepPathName,D}async export(e={}){var r,t;const i=this,{client:n,pagesPerRequest:s}=i;e=i.buildExportConfig(e);let a;if(n.trigger("beforePdfExport",{config:e})!==!1){n.isExporting=!0,n.mask(i.exportMask);try{const o=i.getExporter(e.exporterConfig);if(s===0){const l=await o.export(e);if(i.isDestroying)return;(r=i.exportDialog)==null||r.close(),n.unmask(),i.trigger("exportStep",{progress:90,text:i.exportProgressMask,contentGenerated:!0});const c=i.receiveExportContent(l,e);i.toast=i.showLoadingToast(c);const d=await c;a={response:d},await i.processExportContent(d,e)}}catch(o){throw o instanceof Response?a={response:o}:a={error:o},o}finally{i.toast&&!i.toast.isDestroying&&i.toast.hide(),i.isDestroying||((t=i.exportDialog)==null||t.close(),n.unmask(),i.showErrorToast&&(a.error?a.error.name!=="AbortError"&&At.show({html:i.L("L{Export failed}"),rootElement:i.rootElement}):a.response.ok||At.show({html:i.L("L{Server error}"),rootElement:i.rootElement})),n.trigger("pdfExport",a),n.isExporting=!1)}}return a}receiveExportContent(e,r){return mr.fetch(r.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:r.orientation,format:r.paperFormat,fileFormat:r.fileFormat,fileName:r.fileName,clientURL:r.clientURL,sendAsBinary:r.sendAsBinary})},this.fetchOptions))}async processExportContent(e,r){const t=this;if(e.ok&&t.openAfterExport){e=e.clone();const i=e.headers.get("content-type");if(i.match(/application\/octet-stream/)){const n=OP[r.fileFormat],s=await t.responseBlobToObjectURL(e,n);t.getDownloadLink(r.fileName,s).click()}else if(i.match(/application\/json/)){const n=await e.json();n.success?t.getDownloadLink(r.fileName,n.url).click():At.show({html:n.msg,rootElement:this.rootElement})}}}async responseBlobToObjectURL(e,r){const t=await e.blob();return URL.createObjectURL(t.slice(0,t.size,r))}getDownloadLink(e,r){const t=document.createElement("a");return t.download=e,t.href=r,this.openInNewTab&&(t.target="_blank"),t}get defaultExportDialogConfig(){return T.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}changeExportDialog(e,r){const t=this;if(r==null||r.destroy(),e){const i=t.dialogClass.mergeConfigs({rootElement:t.rootElement,client:t.client,items:{rowsRangeField:{value:t.rowsRange},exporterTypeField:{value:t.exporterType},orientationField:{value:t.orientation},paperFormatField:{value:t.paperFormat},repeatHeaderField:{value:t.repeatHeader},fileFormatField:{value:t.fileFormat},alignRowsField:{checked:t.alignRows}}},t.defaultExportDialogConfig,e);e=t.dialogClass.new(i),e.ion({export:t.onExportButtonClick,thisObj:t})}return e}async showExportDialog(){return this.exportDialog.show()}onExportButtonClick({values:e}){const r=this,t=r.exportDialog.mask({progress:0,maxProgress:100,text:r.exportMask}),i=r.ion({exportstep({progress:n,text:s,contentGenerated:a}){a?(r.exportDialog.unmask(),i()):(t.progress=n,s!=null&&(t.text=s))}});r.currentExportPromise=r.export(e),r.currentExportPromise.catch(()=>{}).finally(()=>{var n;i(),(n=r.exportDialog)==null||n.unmask(),r.currentExportPromise=null})}showLoadingToast(e){const r=At.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`
    <span class="b-mask-icon b-icon b-icon-spinner"></span>
    <span>${this.L("L{Waiting for response from server}")}</span>
    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return j.on({element:r.element,click(){var t;(t=e.abort)==null||t.call(e)}}),r}};Wc._$name="PdfExport",z.registerFeature(Wc,!1,"Grid");var Uc=class extends F{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"\xA0\xA0\xA0\xA0"}}export(e={}){const r=this;return e=T.assign({},r.config,e),r.normalizeColumns(e),r.generateExportData(e)}generateExportData(e){const r=this,t=r.generateColumns(e);return{rows:r.generateRows(e),columns:t}}normalizeColumns(e){const r=e.columns||this.target.columns.visibleColumns.filter(t=>t.exportable!==!1);e.columns=r.map(t=>typeof t=="string"?this.target.columns.find(i=>i.field===t)||{field:t}:t)}generateColumns(e){return e.columns.map(r=>this.processColumn(r,e))}generateRows(e){const{columns:r,rows:t}=e;if(r.length===0||(t==null?void 0:t.length)===0)return[];const i=this,{target:n}=i;return(t||n.store).map(s=>i.processRecord(s,r,e)).filter(s=>s==null?void 0:s.length)}getColumnType(e,r=this.target.store){let t=e.exportedType||"object";if(e.exportedType===void 0&&e.field){const i=r.modelClass.getFieldDefinition(e.field);i&&i.type!=="auto"&&(t=i.type)}return t}processColumn(e,r){const t=this,{target:i}=t,{defaultColumnWidth:n}=r;let{field:s,text:a,width:o,minWidth:l}=e;if(s in i.store.modelClass.fieldMap||(s=""),!a||!o){const c=i.columns.find(d=>d.field===s);a||(a=c&&c.text||s),o==null&&(o=c&&c.width||n)}return o=Math.max(o||n,l||n),{field:s,value:a,width:o,type:t.getColumnType(e)}}processRecord(e,r,t){const{target:i}=this,{showGroupHeader:n,indent:s,indentationSymbol:a}=t;let o;return e?e.isSpecialRow?n&&e.meta.groupRowFor&&(o=r.map(l=>i.features.group.buildGroupHeader({cellElement:C.createElement(),grid:i,record:e,column:l}))):o=r.map(l=>{var c;let d=(c=l.field)!=null&&c.includes(".")?e.get(l.field):e[l.field];const u=l.renderer||l.defaultRenderer;return u&&!(d&&l.isDateColumn&&t.exportDateAsInstance)&&(d=u.call(l,{value:d,record:e,column:l,grid:i,isExport:!0})),s&&l.tree&&(d=`${a.repeat(e.childLevel)}${d}`),d}):o=r.map(()=>""),o}};Uc._$name="TableExporter";var _S=class{constructor(e){this._value=e}get value(){return this._value}toString(){return this.value?"\u2713":""}};_S._$name="BooleanUnicodeSymbol";var Gc=class extends X{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:Uc,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return e==null||Number.isNaN(e)||typeof e=="function"||typeof e=="object"&&String(e)==="[object Object]"?"":e}generateExportData(e){const r=this,{rows:t,columns:i}=r.exporter.export(e.exporterConfig);return{rows:t.map(n=>n.map((s,a)=>{var o;s instanceof Date?s=b.format(s,e.dateFormat):typeof s=="boolean"&&(s=new _S(s)),r.convertEmptyValueToEmptyString&&(s=r.processValue(s));const l=((o=i[a])==null?void 0:o.type)==="number"?"number":"string";return{value:s,type:l}})),columns:i.map(n=>{let{field:s,value:a,width:o,type:l}=n;return l="string",{field:s,value:a,width:o,type:l}})}}export(e={}){const r=this,t=r.zipcelx||globalThis.zipcelx;if(!t)throw new Error('ExcelExporter: "zipcelx" library is required');if(r.disabled)return;e=T.assign({},r.config,e),e.filename||(e.filename=r.client.$$name);const{filename:i}=e,{rows:n,columns:s}=r.generateExportData(e);return t({filename:i,sheet:{data:[s].concat(n),cols:s}})}construct(e,r){super.construct(e,r),this.zipcelx||typeof zipcelx!="undefined"&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}};Gc._$name="ExcelExporter",z.registerFeature(Gc,!1,"Grid");var Ro=class extends ${static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:r}=e.columns;let t;e.columns.traverse(i=>{const n=e.getBarCellElement(i.id),s=C.setLength(i.width),a=C.setLength(i.minWidth),o=C.setLength(i.maxWidth);if(n){if(t=s,n.style.maxWidth=o,i.isParent&&i.width==null&&i.flex==null){const l=i.children.reduce((c,d)=>c+=!d.hidden&&d.flex||0,0);n.style.flex=l>0?`${l} 0 auto`:"",n.style.minWidth=null,l>0&&i.traverse(c=>c.data.minWidth=null)}else if(parseInt(i.minWidth)>=0&&(n.style.minWidth=a),n.style.flex=n.style.flexBasis=n.style.width="",i.flex)!isNaN(parseInt(i.flex))&&i.children?n.style.flex=`${i.flex} 0 auto`:n.style.flex=i.flex;else if(parseInt(i.width)>=0){const l=i.parent;e.isHeader&&!l.isRoot&&!l.width?n.style.width=s:n.style.flexBasis=t}i.height>=0&&(n.style.height=C.setLength(i.height))}}),e.scrollable.element.classList.toggle("b-has-flex",r)}getLrPadding(e){if(!this.cellLrPadding){const r=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(r.getPropertyValue("padding-left"))+parseInt(r.getPropertyValue("padding-right"))+parseInt(r.getPropertyValue("border-left-width"))+parseInt(r.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}};Ro.initClass(),Ro._$name="Bar";var Yc=class extends Ro{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return Jt.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map(r=>Jt.tpl`
                <div
                    class="b-grid-footer ${r.align?`b-grid-footer-align-${r.align}`:""} ${r.cls||""}"
                    data-column="${r.field||""}" data-column-id="${r.id}" data-all-index="${r.allIndex}"
                    role="presentation">
                    ${r.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}};Yc.initClass(),Yc._$name="Footer";var qc=class extends X{static get pluginConfig(){return{chain:["destroy"],assign:["rowHeight","topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach(e=>e.destroy()),super.doDestroy()}initWithHeight(e,r=!1){const t=this;return t.autoHeight&&(e=t.store.allCount*t.preciseRowOffsetHeight),t.viewHeight=e,t.calculateRowCount(r),e}reinitialize(e=!1){const r=this;r.calculateRowCount(!1,!0,!0),r.topIndex+r.rowCount-1>r.store.count&&(e=!0);const t=r.topRow&&!e?r.topRow.top:0;r.scrollTargetRecordId=null,e&&(r.topIndex=r.lastScrollTop=0);const{topRow:i}=r;i&&(i.dataIndex=r.topIndex,i.setTop(t,!0)),r.estimateTotalHeight(),r.renderFromRow(i)}matchRowCount(e=!1){var r,t;const i=this,{rows:n,grid:s}=i,a=n.length,o=a-i.rowCount;if(o)if(o<0){const l=[];for(let c=a,d=a?n[a-1].dataIndex+1:0;c<i.rowCount;c++,d++)l.push(new Ss({cls:s.rowCls,rowManager:i,grid:s,index:c,dataIndex:d}));n.push.apply(n,l),i.trigger("addRows",{rows:l}),e||i.renderFromRow(n[Math.max(0,a-1)])}else{const{focusedCell:l}=s,c=(l==null?void 0:l.id)!=null&&((r=l==null?void 0:l.cell)==null?void 0:r.contains(C.getActiveElement(s))),d=n.splice(a-o,o);c&&(o===a?s.onFocusedRowDerender():((t=i.getRowFor(l._record))==null?void 0:t.index)>=n.length&&n[n.length-1].cells[l.columnIndex].focus()),i.trigger("removeRows",{rows:d}),d.forEach(u=>u.destroy())}}calculateRowCount(e=!1,r=!0,t=!1){var i,n;const s=this,{store:a}=s,o=Math.ceil(s.viewHeight/s.minRowOffsetHeight),l=o+s.prependRowBuffer+s.appendRowBuffer;if(!((i=s.grid.columns)!=null&&i.count)||isNaN(o))return s.rowCount=0,0;if(l<s.rowCount&&!r)return s.rowCount;if(s.visibleRowCount=o,s.rowCount=Math.min(a.count,l),!e){if(s.rows&&s.rowCount!==s.rows.length){if(s.matchRowCount(t),((n=s.bottomRow)==null?void 0:n.dataIndex)>=a.count&&s.topRow.dataIndex!==0){const c=s.bottomRow.dataIndex-a.count+1;for(const d of s.rows)d.dataIndex-=c;s.topIndex-=c}}else s.rowCount||s.trigger("changeTotalHeight",{totalHeight:s.totalHeight});s.grid.toggleEmptyText()}return s.rowCount}removeAllRows(){const e=this,{topRow:r}=e,t=r?e.refreshDetails={topRowIndex:r.dataIndex,topRowTop:r.top}:e.refreshDetails,i=e.rows.slice();return e.trigger("removeRows",{rows:i}),e.rows.forEach(n=>n.destroy()),e.rows.length=0,e.idMap={},t}setPosition(e){const{topRow:r}=this,{topRowIndex:t,topRowTop:i}=e;r.setTop(i),r.dataIndex=t}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return e=e.closest(".b-grid-row"),e&&this.getRow(e.dataset.index)}getRowAt(e,r=!1){return r||(e-=k.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=C.roundPx(e),this.rows.find(t=>e>=t.top&&e<t.bottom)}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const r=typeof e=="number"?e:e.index;return this.getRow((r+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find(e=>e.bottom>Math.ceil(this.grid.scrollable.y))}get firstFullyVisibleRow(){return this.rows.find(e=>e.top>=Math.ceil(this.grid.scrollable.y))}get lastVisibleRow(){const{grid:e}=this;return H.findLast(this.rows,r=>r.top<e.scrollable.y+e.bodyHeight)}get lastFullyVisibleRow(){const{grid:e}=this;return H.findLast(this.rows,r=>r.bottom<e.scrollable.y+e.bodyHeight)}offsetRows(e){if(e!==0){const{rows:r}=this,{length:t}=r;for(let i=0;i<t;i++)r[i].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const r=this,{grid:t,fixedRowHeight:i}=r,n=r.rowHeight;if(n!==e){if(T.assertNumber(e,"rowHeight"),e<10&&(e=10),r.trigger("beforeRowHeight",{height:e}),r.minRowHeight=r._rowHeight=e,i&&(r.averageRowHeight=e),r.rows.length){const s=t.scrollable.y,a=r.getRowAt(s,!0),o=a?a.top-s:0;let l,c;i?(l=e,c=n):(c=l=r.averageRowHeight,r.clearKnownHeights(),l*=e/n),r.calculateRowCount(!1,!0,!0),r.topRow.setTop(r.topRow.dataIndex*(l+t._rowBorderHeight),!0),r.refresh(),s*(l/c)!==s&&t.scrollRowIntoView(a.id,{block:"start",edgeOffset:o})}r.trigger("rowHeight",{height:e,oldHeight:n})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,r){const t=this,{heightMap:i}=t;t.fixedRowHeight||(i.has(e)&&(t.totalKnownHeight-=i.get(e)),i.set(e,r),t.totalKnownHeight+=r,r<t.minRowHeight&&(t.minRowHeight=r),t.averageRowHeight=t.totalKnownHeight/i.size)}getOffsetHeight(e){const r=this;return(e&&r.heightMap.get(e.id)||e&&r.grid.getRowHeight(e)||r.averageRowHeight||r.rowHeight)+r.grid._rowBorderHeight}invalidateKnownHeight(e){const r=this;if(!r.fixedRowHeight){const{heightMap:t}=r;e=H.asArray(e),e.forEach(i=>{i&&t.has(i.id)&&(r.totalKnownHeight-=t.get(i.id),t.delete(i.id))}),r.averageRowHeight=r.totalKnownHeight/t.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:r}=this;let t=0;for(let i=0;i<e;i++){const n=r.getAt(i);t+=this.getOffsetHeight(n)}return Math.floor(t)}getRecordCoords(e,r=!1,t=!1){const i=this,n=i.getRowById(e);let s=i.client._bodyRectangle;return r||(s=i.client.refreshBodyRectangle()),n?new k(s.x,Math.round(r?n.top:n.top+s.y-i.client.scrollable.y),s.width,n.offsetHeight):i.getRecordCoordsByIndex(i.store.indexOf(e),r,t)}getRecordCoordsByIndex(e,r=!1,t=!1){const i=this,{topRow:n,bottomRow:s}=i,a=i.client._bodyRectangle,{id:o}=i.store.getAt(e),l=i.preciseRowOffsetHeight,c=n.dataIndex,d=s.dataIndex,u=e>d?{index:e-d-1,y:s.bottom,from:"bottomRow"}:e>c/2?{index:e-c,y:n.top,from:"topRow"}:{index:e,y:0,from:"top"},h=i.allHeightsKnown&&!t?i.calculateTop(e):Math.floor(u.y+u.index*l),f=new k(a.x,r?h:h+a.y-i.client.scrollable.y,a.width,Math.floor(i.heightMap.get(o)||l));return f.virtual=!0,f.block=f.bottom<a.y?"start":f.y>a.bottom?"end":"nearest",f}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,r){const t=new ne({grid:this.grid,record:e,columnId:r});return!!(t.cell&&t.row.renderCell(t))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const r=this.getRowById(e.id);r&&this.renderFromRow(r)}renderFromRow(e=null){const r=this,{rows:t,store:i}=r,n=i.count;if(r.calculateRowCount(!1,n<t.length,!0)===0){r.estimateTotalHeight(!0);return}const s=e?t.indexOf(e):0;let a=e?e.dataIndex:t[0].dataIndex;const o=n-a-1,l=Math.min(t.length-1,s+o);let c=t.length-l-1,d=s>0?t[s-1].bottom:t[s].top,u;for(let h=s;h<=l;h++)u=t[h],u.dataIndex=a,u.setTop(d,!0),u.render(a,i.getAt(a++),!1),d+=u.offsetHeight;for(;c-- >0;)r.displayRecordAtTop();r.bottomRow.bottom<r.viewHeight&&r.calculateRowCount(),r.estimateTotalHeight(!0),r.trigger("renderDone")}renderRows(e){let r,t=!1;e=Array.from(e),e.sort((i,n)=>i.dataIndex-n.dataIndex);for(const i of e)r=i.height,i.render(null,null,!1),t|=i.height!==r;t&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,r=!1){const t=this;let i=e.bottom,n,s;for(s=e.dataIndex+1,n=t.getRow(s);n;n=t.getRow(++s))i=n.translate(i);r||t.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:r}=e;!r||e.grid.refreshSuspended||(e.idMap={},e.renderFromRow(r),e.trigger("refresh"))}jumpToPosition(e,r){const t=this,{store:i,heightMap:n}=t,s=i.count;if(t.allHeightsKnown&&!t.fixedRowHeight){const a=e-t.prependBufferHeight,o=t.grid._rowBorderHeight;let l=0,c=0;for(;l<a;){const u=i.getAt(c);l+=n.get(u.id)+o,c++}const d=Math.max(Math.min(c,s-t.rowCount),0);t.lastScrollTop=e,t.topRow.dataIndex=t.topIndex=d,t.topRow.setTop(t.calculateTop(d),!1),t.refresh()}else{const a=t.preciseRowOffsetHeight,o=r==null?Math.floor(e/a)-t.prependRowBuffer:r-Math.floor(t.rowCount/2),l=Math.max(Math.min(o,s-t.rowCount),0),c=t.client.scrollable.y,d=Math.min(t.client._bodyRectangle.height+c+t.appendBufferHeight,t.totalHeight);if(t.lastScrollTop=e,t.topRow.dataIndex=t.topIndex=l,t.topRow.setTop(Math.floor(l*a),!1),t.refresh(),t.bottomRow.bottom<d)for(t.calculateRowCount(!1,!1,!1);t.bottomRow.bottom<d&&t._rows[t.prependRowBuffer].top<c&&t.bottomRow.dataIndex<s-1;)t.displayRecordAtBottom();t.estimateTotalHeight()}if(r!=null){const{scrollable:a}=t.grid,o=t.getRow(r),l=o&&k.from(o._elementsArray[0]).center.y,c=a.viewport.center.y;o&&(a.y=e=Math.floor(a.y+(l-c)))}return e}warpIfNeeded(e){const r=this,t={newScrollTop:e,deltaTop:e-r.lastScrollTop};if(Math.abs(t.deltaTop)>r.rowCount*r.rowOffsetHeight*3){let i;r.scrollTargetRecordId&&(i=r.store.indexOf(r.scrollTargetRecordId)),r.grid.onFocusedRowDerender(),t.newScrollTop=r.jumpToPosition(e,i),t.deltaTop=0}return t}updateRenderedRows(e,r,t=!1){const i=this,n=i.client._bodyRectangle;if(i.rowCount===0)return 0;let s=i.totalHeight;if(r||Math.abs(e-i.lastScrollTop)>=i.rowOffsetHeight||i.topRow.top>e||i.bottomRow.bottom<e+n.height){const a=i.warpIfNeeded(e);i.scrollTargetRecordId=null,i.lastScrollTop=a.newScrollTop,a.deltaTop>0?i.fillBelow(a.newScrollTop):a.deltaTop<0&&i.fillAbove(a.newScrollTop),!i.fixedRowHeight&&!t&&i.correctError(a,n,e),s=i.estimateTotalHeight()}return s}correctError(e,r,t){const i=this;let n=0;(i.allHeightsKnown||e.deltaTop<0&&t<r.height*2||e.deltaTop>0&&t>i.totalHeight-r.height*2-3)&&(n=i.topRow.top-i.calculateTop(i.topRow.dataIndex)),n&&(i.offsetRows(-n),i.grid.scrollable.y=i.lastScrollTop=i.grid.scrollable.y-n)}fillAbove(e){const r=this,t=e-r.topRow.top-r.prependBufferHeight;let i=0;for(;i>t&&r.topIndex>0;)i-=r.displayRecordAtTop();r.trigger("renderDone")}fillBelow(e){const r=this,t=e-r.topRow.top-r.prependBufferHeight,i=r.store.count,n=r.rowCount;let s=0;for(;s<t&&r.topIndex+n<i&&r.topRow.top+r.topRow.offsetHeight<e;)s+=r.displayRecordAtBottom();r.trigger("renderDone")}estimateTotalHeight(e=!1){const r=this;if(r.grid.renderingRows)return;const t=r.store.count,i=t-r.heightMap.size,{bottomRow:n}=r;let s;if(r.fixedRowHeight)s=t*r.rowOffsetHeight;else{if(s=r.totalKnownHeight+r.heightMap.size*r.grid._rowBorderHeight+i*r.preciseRowOffsetHeight,n&&i){const a=n.bottom;(a>s||r.topIndex+r.rowCount>=t&&s>a&&a>0)&&(s=a,n.dataIndex<t-1&&(s+=(t-1-n.dataIndex)*r.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==r.totalHeight&&r.trigger("changeTotalHeight",{totalHeight:s,immediate:e})!==!1&&(r._totalHeight=s),s}displayRecordAtTop(){var e;const r=this,{grid:t}=r,i=r.topIndex-1,n=r.store.getAt(i),s=r.bottomRow,a=s.top;return r.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((e=t.focusedCell)==null?void 0:e.rowIndex)&&t.onFocusedRowDerender(),s._top=r.topRow.top-r.getOffsetHeight(n),s.estimatedTop=!r.fixedRowHeight,s.render(i,n,!1),s._top=a,s.setBottom(r.topRow.top),s.estimatedTop=!1,r.topIndex--,r._rows.unshift(r._rows.pop()),s.offsetHeight}displayRecordAtBottom(){var e;const r=this,{grid:t}=r,i=r.topIndex+r.rowCount,n=r.store.getAt(i),s=r.topRow;return r.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((e=t.focusedCell)==null?void 0:e.rowIndex)&&t.onFocusedRowDerender(),s.dataIndex=i,s.setTop(r.bottomRow.bottom),s.render(i,n,!1),r.topIndex++,r._rows.push(r._rows.shift()),s.offsetHeight}};qc.featureClass="",qc._$name="RowManager";var LP={x:1},FS=e=>e.isSubGrid,kS=class extends or{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,r=LP){if(typeof r=="string"&&(r={[r]:1}),r.x){e.owner.initScroll();const t=this.widget.items.filter(FS),i=e.widget.items.filter(FS);for(let n=0,{length:s}=t;n<s;n++)t[n].scrollable.addPartner(i[n].scrollable,"x")}r.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach((r,t)=>{r.isDestroyed||r.removePartner(e.xScrollers[t])}),super.removePartner(e)}updateOverflowX(e){var r;const t=e===!1;(r=this.xScrollers)==null||r.forEach(i=>i.overflowX=t?"hidden":"hidden-scroll"),this.widget.virtualScrollers.classList.toggle("b-hide-display",t)}scrollIntoView(e,r){if(e.nodeType===Element.ELEMENT_NODE&&this.element.contains(e)){for(const t of this.xScrollers)if(t.element.contains(e))return t.scrollIntoView(e,r)}else return super.scrollIntoView(e,r)}hasOverflow(e="y"){return e==="y"?this.scrollHeight>this.clientHeight:!1}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}};kS._$name="GridScroller";var ln=class extends Ro{get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return(e=this.subGrid)==null?void 0:e.region}changeElement(e,r){const{region:t}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${t}`]:t},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${t}`]:t},dataset:{region:t,reference:"headersElement",maxDepth:this.maxDepth}}]},r)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:r,align:t,resizable:i,isLeaf:n,isParent:s,isLastInSubGrid:a,cls:o,childLevel:l,field:c,tooltip:d,children:u,isFocusable:h,grid:f}=e,g=f==null?void 0:f.focusedCell,m=(g==null?void 0:g.rowIndex)===-1&&(g==null?void 0:g.column)===e;if(e.isVisible)return{className:{"b-grid-header":1,"b-grid-header-parent":s,[`b-level-${l}`]:1,[`b-depth-${e.meta.depth}`]:1,[`b-grid-header-align-${t}`]:t,"b-grid-header-resizable":i&&n,[o]:o,"b-collapsible":e.collapsible,"b-last-parent":s&&a,"b-last-leaf":n&&a},role:h?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[h?"tabIndex":""]:m?0:-1,dataset:{...ue.encodeConfig(d),columnId:r,[c?"column":""]:c},children:[{className:"b-grid-header-text",children:[{[f&&h?"id":""]:`${f==null?void 0:f.id}-column-${e.id}`,className:"b-grid-header-text-content"}]},u?{className:"b-grid-header-children",children:u.map(p=>this.getColumnConfig(p)),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach(r=>{e+=r.calculateMinWidth()}),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse(r=>{const t=e.getBarCellElement(r.id);if(t){let i=r.headerText;r.headerRenderer&&(i=r.headerRenderer.call(r.thisObj||e,{column:r,headerElement:t})),r.headerWidgetMap&&Object.values(r.headerWidgetMap).forEach(s=>{s.render(r.textWrapper)}),r.icon&&(i=`<i class="${L.encodeHtml(r.icon)}"></i>`+(i||""));const n=t.querySelector(".b-grid-header-text-content");n&&(n.innerHTML=i||"")}}),e.fixHeaderWidths()}get columns(){const e=this,r=super.columns;return e.columnsDetacher||(e.columnsDetacher=r.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),r}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,r=null){const t=this;let i=0;r!=null&&r.meta&&r.meta.depth++;for(const n of e){const{meta:s}=n;s.depth=0,n.children&&(t.initDepths(n.children.filter(t.columns.chainedFilterFn),n),s.depth&&r&&(r.meta.depth+=s.depth)),s.depth>i&&(i=s.depth)}return r||(t.maxDepth=i),i}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;q.sync({domConfig:{children:e.columns.topColumns.map(r=>e.getColumnConfig(r)),onlyChildren:!0},targetElement:e.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}};R(ln,"$name","Header"),R(ln,"type","gridheader"),ln.initClass(),ln._$name="Header";var _f={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},OS=["pageX","pageY","clientX","clientY","screenX","screenY"];function To(e,r=!0){e==null||e.classList.toggle("b-hover",r)}function Kc(e,r,t=!0){r&&e&&To(r.getCell(e),t)}var LS=e=>class extends(e||F){static get $name(){return"GridElementEvents"}static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const t=Object.keys(_f),i=t.length,n={element:this.bodyElement,thisObj:this};for(let s=0;s<i;s++){const a=t[s];n[a]={handler:"handleEvent"},a.startsWith("touch")&&(n[a].passive=!1)}j.on(n),j.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(t,i=!1){var n;const s=this,{columns:a}=s,{target:o}=t;let l=o.closest(".b-grid-cell");if(!l&&i&&!o.classList.contains("b-grid-row")&&!o.classList.contains("b-grid-subgrid")){const{top:c,left:d,right:u,bottom:h}=s.bodyContainer.getBoundingClientRect();let f,{x:g,y:m}=t;g>=d&&g<=u?m=f=Math.ceil(s[`${m<c?"first":"last"}FullyVisibleRow`].element.getBoundingClientRect().y):m>=c&&m<=h&&(g=f=Math.ceil(a.visibleColumns[g<d?0:a.visibleColumns.length-1].element.getBoundingClientRect().x)),f!==void 0&&(l=(n=C.childFromPoint(t.target,t.offsetX,t.offsetY))==null?void 0:n.closest(".b-grid-cell"))}if(l){const c=ze.get(l),{id:d,columnId:u}=c,h=s.store.getById(d),f=a.getById(u);return h?{cellElement:l,cellData:c,columnId:u,id:d,record:h,column:f,cellSelector:{id:d,columnId:u}}:null}}getHeaderDataFromEvent(t){const i=t.target.closest(".b-grid-header");if(i){const n=T.assign({},i.dataset),{columnId:s}=n,a=this.columns.getById(s);return a?{headerElement:i,headerData:n,columnId:s,column:a}:null}}handleEvent(t){!this.disabled&&_f[t.type]&&this[_f[t.type]](t)}onElementTouchStart(t){const i=this,n=i.getCellDataFromEvent(t);C.isTouchEvent=!0,t.touches.length===1&&(i.longPressTimeout=i.setTimeout(()=>{i.onElementLongPress(t),t.preventDefault(),i.longPressPerformed=!0},i.longPressTime)),n&&!t.defaultPrevented&&i.onFocusGesture(t)}onElementTouchMove(t){const i=this,{lastTouchTarget:n}=i,s=t.changedTouches[0],{pageX:a,pageY:o}=s,l=document.elementFromPoint(a,o);if(i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null),l!==n){if(n){const c=new MouseEvent("mouseout",T.copyProperties({relatedTarget:l,pointerType:"touch",bubbles:!0},s,OS));c.preventDefault=()=>t.preventDefault(),n==null||n.dispatchEvent(c)}if(l){const c=new MouseEvent("mouseover",T.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},s,OS));c.preventDefault=()=>t.preventDefault(),l==null||l.dispatchEvent(c)}}i.lastTouchTarget=l}onElementTouchEnd(t){const i=this;i.longPressPerformed&&(t.cancelable&&t.preventDefault(),i.longPressPerformed=!1),i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null)}onElementLongPress(t){}triggerCellMouseEvent(t,i,n=this.getCellDataFromEvent(i)){var s;const a=this;if(n){const o=a.columns.getById(n.columnId),l={grid:a,record:n.record,column:o,cellSelector:n.cellSelector,cellElement:n.cellElement,target:i.target,event:i};a.trigger("cell"+L.capitalize(t),l),t==="click"&&((s=o.onCellClick)==null||s.call(o,l))}}onElementMouseDown(t){const i=this,n=i.getCellDataFromEvent(t);i.skipFocusSelection=!0,i.isScrollbarOrRowBorderOrSplitterClick(t)?t.preventDefault():(i.triggerCellMouseEvent("mousedown",t,n),n&&!t.defaultPrevented&&i.onFocusGesture(t))}isScrollbarOrRowBorderOrSplitterClick({target:t,x:i,y:n}){if(t.closest(".b-grid-splitter")||t.matches(".b-grid-row, .b-virtual-width"))return!0;if(t.matches(".b-vertical-overflow")){const s=t.getBoundingClientRect();return i>s.right-C.scrollBarWidth}else if(t.matches(".b-horizontal-overflow")){const s=t.getBoundingClientRect();return n>s.bottom-C.scrollBarWidth-1}}onElementMouseMove(t){this.mouseMoveEvent=t}onElementMouseUp(t){}onElementPointerDown(t){}onElementPointerUp(t){}onHandleElementClick(t){this.trigger("beforeElementClick",{event:t})!==!1&&this.onElementClick(t)}onElementClick(t){const i=this,n=i.getCellDataFromEvent(t);n&&i.triggerCellMouseEvent("click",t,n)}onFocusGesture(t){var i;const n=this,{navigationEvent:s}=n,{target:a}=t,o=t.button===2,l=!o&&a.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),c=!document.hasFocus()&&Y.isMac&&o;if(l||c)t.preventDefault();else{n.navigationEvent=t;const d=new ne(a);if(o||(i=n.focusedCell)!=null&&i.equals(d)){let u;globalThis.TouchEvent&&t instanceof MouseEvent&&s instanceof TouchEvent&&a===s.target&&(u={doSelect:!1}),n.focusCell(d,u)}}}onElementDblClick(t){const{target:i}=t;if(this.triggerCellMouseEvent("dblClick",t),i.classList.contains("b-grid-header-resize-handle")){const n=i.closest(".b-grid-header");this.columns.getById(n.dataset.columnId).resizeToFitContent()}}onElementMouseOver(t){var i;if(!this.scrolling){const n=this,{hoveredCell:s}=n,a=(typeof t.buttons!="number"||t.buttons===0)&&t.pointerType!=="touch";let o=t.target.closest(".b-grid-cell");!o&&t.target.classList.contains("b-grid-row")&&(o=(i=C.childFromPoint(t.target,t.offsetX,t.offsetY-2))==null?void 0:i.closest(".b-grid-cell")),o&&(a&&(n.hoveredCell=o),!s&&n.hoveredCell&&n.triggerCellMouseEvent("mouseOver",t)),n.trigger("mouseOver",{event:t})}}onElementMouseOut(t){var i;const n=this,{hoveredCell:s}=n,{target:a,relatedTarget:o}=t;o!=null&&o.closest(".b-grid-cell")&&a.matches(".b-grid-row")||(o&&a.matches(".b-grid-cell")&&!a.contains(o)?o!=null&&o.matches(".b-grid-row")||(n.hoveredCell=o.closest(".b-grid-cell")):!(o!=null&&o.matches(".b-grid-row,.b-grid-cell"))&&!((i=n.hoveredCell)!=null&&i.contains(o))&&(n.hoveredCell=null)),n.scrolling||(s&&!n.hoveredCell&&n.triggerCellMouseEvent("mouseOut",t),n.trigger("mouseOut",{event:t}))}updateHoveredCell(t,i){var n,s,a,o;const l=this,{selectionMode:c}=l,d=c.rowNumber&&((n=l.columns.find(h=>h.type=="rownumber"))==null?void 0:n.id),u=c.checkbox&&((s=l.checkboxSelectionColumn)==null?void 0:s.id);if(i){To(i,!1);const h=ze.get(i),{row:f}=h;f&&!f.isDestroyed&&(Kc(d,f,!1),Kc(u,f,!1)),h!=null&&h.columnId&&To((a=l.columns.getById(h.columnId))==null?void 0:a.element,!1)}if(l._hoveredRow&&!l._hoveredRow.isDestroyed&&l._hoveredRow.removeCls("b-hover"),l._hoveredRow=null,t&&!l.scrolling){const h=ze.get(t),{row:f}=h;f?c.cell&&h.columnId!==d&&h.columnId!==u?(To(t),Kc(u,f),Kc(d,f),To((o=l.columns.getById(h.columnId))==null?void 0:o.element)):(l._hoveredRow=f,f.addCls("b-hover")):l.hoveredCell=null}}keyMapOnKeyDown(t){this.onElementKeyDown(t),super.keyMapOnKeyDown(t)}onElementKeyDown(t){var i,n;if(t.handled)return;const s=this,a=s.focusedCell;if(a!=null&&a.isCell&&!a.isActionable){const o=a.cell;(n=(i=s.columns.getById(o.dataset.columnId)).onCellKeyDown)==null||n.call(i,{event:t,cellElement:o})}}undoRedoKeyPress(t){var i;const{stm:n}=this.store;return n&&this.enableUndoRedoKeys&&!((i=this.features.cellEdit)!=null&&i.isEditing)?(n.onUndoKeyPress(t),!0):!1}clickCellByKey(t){const i=this,n=i.focusedCell,s=n==null?void 0:n.cell,a=i.columns.getById(s.dataset.columnId);return n!=null&&n.isCell&&!n.isActionable&&a.onCellClick?(a.onCellClick({grid:i,column:a,record:i.store.getById(n.id),cellElement:s,target:t.target,event:t}),!0):!1}onElementKeyPress(t){}onElementKeyUp(t){}onElementContextMenu(t){const i=this,n=i.getCellDataFromEvent(t);n&&(i.triggerCellMouseEvent("contextMenu",t,n),C.isTouchEvent&&i.onFocusGesture(t))}onInternalResize(t,i,n,s,a){const o=this;o._devicePixelRatio&&o._devicePixelRatio!==globalThis.devicePixelRatio&&C.resetScrollBarWidth(),o._devicePixelRatio=globalThis.devicePixelRatio,o._bodyRectangle=k.client(o.bodyContainer),super.onInternalResize(...arguments),n!==a&&(o._bodyHeight=o.bodyContainer.offsetHeight,o.isPainted&&o.rowManager.initWithHeight(o._bodyHeight)),o.refreshVirtualScrollbars(),i!==s&&o.setTimeout(()=>{o.isDestroyed||o.updateResponsive(i,s)},0)}get widgetClass(){}},$P={string:1,object:1,function:1},$S=e=>class extends(e||F){static get $name(){return"GridFeatures"}set features(t){const i=this,n=z.getInstanceDefaultFeatures(this);t=i._features=T.assign({},t),n&&Object.keys(n).forEach(a=>{a in t||(t[a]=!0)});const s=z.getInstanceFeatures(this);for(const a of Object.keys(t)){const o=t[a];if(o){const l=!globalThis.__bryntum_code_editor_changed;if(L.uncapitalize(a)!==a){const d=`Invalid feature name '${a}', must start with a lowercase letter`;if(l)throw new Error(d);console.error(d),i._errorDuringConfiguration=d}const c=s[a];if(!c){const d=`Feature '${a}' not available, make sure you have imported it`;if(l)throw new Error(d);console.error(d),i._errorDuringConfiguration=d;return}Reflect.defineProperty(t,a,i.createFeatureInitializer(t,a,c,o))}}}get features(){return this._features}createFeatureInitializer(t,i,n,s){const a=[this],o=n.prototype.construct;return s===!0&&(s={}),$P[typeof s]&&(a[1]=s),{configurable:!0,get(){return delete t[i],n.prototype.construct=function(...l){t[i]=this,o.apply(this,l),n.prototype.construct=o},new n(...a)}}}hasFeature(t){const{features:i}=this;if(i){const n=Object.getOwnPropertyDescriptor(this.features,t);if(n)return!!(n.value||n.get)}return!1}hasActiveFeature(t){var i,n;return!!((i=this.features)!=null&&i[t]&&!((n=this.features)!=null&&n[t].disabled))}getConfigValue(t,i){var n,s;if(t==="features"){const a={};for(const o in this.features){const l=(s=(n=this.features[o])==null?void 0:n.getCurrentConfig)==null?void 0:s.call(n,i);l?T.isEmpty(l)?z.isDefaultFeatureForInstance(this.features[o].constructor,this)||(a[o]=!0):a[o]=l:a[o]=!1}return a}return super.getConfigValue(t,i)}get widgetClass(){}},jP=Object.freeze({}),BP=Object.freeze({x:!1,y:!1}),HP=function(e){return this.focusableFinderCell.contains(e)?C.isFocusable(e)&&!e.disabled?C.NodeFilter.FILTER_ACCEPT:C.NodeFilter.FILTER_SKIP:C.NodeFilter.FILTER_REJECT},VP=e=>{var r;return r=class extends(e||F){static get $name(){return"GridNavigation"}onStoreRecordIdChange(t){var i;(i=super.onStoreRecordIdChange)==null||i.call(this,t);const{focusedCell:n}=this,{oldValue:s,value:a}=t;n&&n.id===s&&(n._id=a)}onFocusedRowDerender(){const t=this,{focusedCell:i}=t;if((i==null?void 0:i.id)!=null&&i.cell){const n=i.cell.contains(C.getActiveElement(t));if(t.hideHeaders)n&&t.revertFocus();else{const s=t.normalizeCellContext({rowIndex:-1,columnIndex:n?i.columnIndex:0});n?t.focusCell(s):s.cell.tabIndex=0}i.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(ne.FIRST_CELL)}navigateFirstColumn(){this.focusCell(ne.FIRST_COLUMN)}navigateLastCell(){this.focusCell(ne.LAST_CELL)}navigateLastColumn(){this.focusCell(ne.LAST_COLUMN)}navigatePrevPage(){this.focusCell(ne.PREV_PAGE)}navigateNextPage(){this.focusCell(ne.NEXT_PAGE)}activateHeader(t){var i;if(t.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){const{column:n}=this.focusedCell;(i=n.onKeyDown)==null||i.call(n,t),this.getHeaderElement(n.id).click()}return!1}onEscape(t){const{focusedCell:i}=this;!t.target.closest(".b-dragging")&&(i!=null&&i.isActionable)&&(t.stopImmediatePropagation(),this._focusedCell=null,this.focusCell({rowIndex:i.rowIndex,column:i.column},{disableActionable:!0}))}onTab(t){const{target:i}=t,{focusedCell:n,bodyElement:s}=this,{isActionable:a,actionTargets:o}=n;if(a&&C.isEditable(i)&&!i.readOnly&&i===o[o.length-1])t.preventDefault(),this.navigateRight(t);else if(!a||i===o[o.length-1])return s.style.display="none",this.requestAnimationFrame(()=>s.style.display=""),!1}onShiftTab(t){const i=this,{target:n}=t,{focusedCell:s,bodyElement:a}=i,{cell:o,isActionable:l,actionTargets:c}=s,d=l&&C.isEditable(n)&&!n.readOnly,u=s.columnIndex===0&&s.rowIndex===(i.hideHeaders?0:-1);if(!u&&d&&n===c[0])t.preventDefault(),i.navigateLeft(t);else if(!l||n===c[0]){const h=!u&&!i.hideHeaders&&i.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return h?(h.cell.tabIndex=-1,o.tabIndex=0,i._focusedCell=s):(a.style.display="none",i.requestAnimationFrame(()=>a.style.display="")),!1}}onSpace(t){return this.focusedCell.isActionable||t.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var t;return(t=this._focusedCell)==null?void 0:t.isActionable}set focusedCell(t){this.focusCell(t)}get focusedRecord(){var t;return(t=this._focusedCell)==null?void 0:t.record}get cellCSSSelector(){const t=this._focusedCell;return t?`[data-index=${t.rowIndex}] [data-column-id=${t.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(t){var i;return!!((i=this._focusedCell)!=null&&i.equals(this.normalizeCellContext(t)))}get focusElement(){var t;if(!this.isDestroying){let i;this.store.count&&this._focusedCell?i=this._focusedCell.target:i=this.normalizeCellContext({rowIndex:-1,columnIndex:((t=this._focusedCell)==null?void 0:t.columnIndex)||0}).target;const n=super.focusElement;return n&&(!i||i.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_PRECEDING)?n:i}}onPaint({firstPaint:t}){var i;const n=this;(i=super.onPaint)==null||i.call(this,...arguments);const s=this.normalizeCellContext({rowIndex:n.hideHeaders?0:-1,column:n.hideHeaders?0:n.columns.find(a=>!a.hidden&&a.isFocusable)});if(s.cell){n._focusedCell=s;const{target:a}=s;a===s.cell&&(s.cell.tabIndex=0)}}onGridBodyFocusIn(t){var i,n,s;const a=this,{bodyElement:o}=a,l=a.focusedCell,c=(l==null?void 0:l.initialTarget)||(l==null?void 0:l.target),{target:d,relatedTarget:u}=t,h=d.closest(a.focusableSelector);if(h&&(!he.currentMouseDown||he.isMouseDown(0)||he.isMouseDown(2))){const f=new ne(d),{cell:g}=f,m=l==null?void 0:l.cell,p=f.actionTargets=a.findFocusables(h),v=(!a._fromFocusCell||a.selectOnFocus)&&(d===g||a._selectActionCell)&&!(d!=null&&d._isRevertingFocus);if(!a.store.getById(h.parentNode.dataset.id)&&g!==h){g.focus({preventScroll:!0});return}if(d.matches(a.focusableSelector)){if(a.disableActionable)f._target=g;else if(p.length){a._selectActionCell=((i=he.currentMouseDown)==null?void 0:i.target)===d,p[0].focus(),delete a._selectActionCell;return}}else{if(l!=null&&l.target&&u&&(!he.isMouseDown()||!o.contains((n=he.currentMouseDown)==null?void 0:n.target))&&!o.contains(u)&&!f.equals(l)){c.focus();return}f._target=d}if(m&&(m.classList.remove("b-focused"),m.tabIndex=-1),g&&(g.classList.add("b-focused"),f.column.onCellFocus(f),g===d&&(g.tabIndex=0),g.contains(t.relatedTarget)&&c===d))return;a._focusedCell=f,(s=a.onCellNavigate)==null||s.call(a,a,l,f,v),a.trigger("navigate",{lastFocusedCell:l,focusedCell:f,event:t})}else d.closest(".b-rowexpander-body")||c==null||c.focus()}findFocusables(t){const{focusableFinder:i}=this,n=[];i.currentNode=this.focusableFinderCell=t;for(let s=i.nextNode();s;s=i.nextNode())n.push(s);return n}get focusableFinder(){const t=this;return t._focusableFinder||(t._focusableFinder=t.setupTreeWalker(t.bodyElement,C.NodeFilter.SHOW_ELEMENT,{acceptNode:HP.bind(t)})),t._focusableFinder}restoreActiveItem(t=this._focusedCell){if(this.rowManager.count)return isNaN(t)?t.isModel||(t=this.store.getById(t)):t=this.store.getAt(t),this.focusCell(t)}focusCell(t,i=jP){var n,s;const a=this,{_focusedCell:o}=a,{scroll:l,disableActionable:c}=i;if((t==null?void 0:t.rowIndex)===-1&&a.hideHeaders){a.revertFocus();return}t=typeof t=="number"&&(o!=null&&o.isLocation)?o.move(t):a.normalizeCellContext(t);const d="doSelect"in i?i.doSelect:!t.isActionable||t.initialTarget===t.cell;if(t.equals(o))return(n=a.onCellNavigate)==null||n.call(a,a,o,t,d),o;const u=a.getSubGridFromColumn(t.columnId),{cell:h}=t,f=h||a.getCell({rowIndex:a.rowManager.topIndex,columnId:t.columnId}),g=k.from(u.element),m=k.from(a.bodyElement),p=k.from(f).moveTo(null,g.y);return l===!1||t.rowIndex===-1?i=Object.assign({},i,BP):(i=Object.assign({},i,l),p.width>g.width||p.height>m.height?i.x=i.y=!1:i.column=t.columnId,a.scrollRowIntoView(t.id,i)),(a._hoveredRow||a.hoveredCell)&&(a.hoveredCell=null),a.disableActionable=c,a.selectOnFocus=d,a._fromFocusCell=!0,(s=t[c?"cell":"target"])==null||s.focus({preventScroll:!0}),a.disableActionable=a.selectOnFocus=!1,delete a._fromFocusCell,t}blurCell(t){const i=this,n=i.getCell(t);n&&n.classList.remove("b-focused")}clearFocus(t){const i=this;i._focusedCell&&(i.lastFocusedCell=t?null:i._focusedCell,i.blurCell(i._focusedCell),i._focusedCell=null)}internalNextPrevCell(t=!0){const i=this,n=i._focusedCell;return n?i.focusCell({id:n.id,columnId:i.columns.getAdjacentVisibleLeafColumn(n.columnId,t,!0).id}):null}navigateRight(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(this.rtl?ne.PREV_CELL:ne.NEXT_CELL):(arguments[0]&&re.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(this.rtl?ne.NEXT_CELL:ne.PREV_CELL):(arguments[0]&&re.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!!this.rtl))}internalNextPrevRow(t,i=!0,n=!0){const s=this,a=s._focusedCell;if(!a)return!1;const o=s.store[`get${t?"Next":"Prev"}`](a.id,!1,i);if(o)return s.focusCell({id:o.id,columnId:a.columnId,scroll:{x:!1}});if(!t&&n&&!a.isColumnHeader)return this.clearFocus(),this.getHeaderElement(a.columnId).focus()}navigateDown(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(ne.DOWN):(arguments[0]&&re.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(ne.UP):(arguments[0]&&re.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},R(r,"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1},Tab:{handler:"onTab",preventDefault:!1}," ":{handler:"onSpace",preventDefault:!1}}}),r},jS=e=>class extends(e||F){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(t){const i=this,n=Object.keys(T.assign({},i.responsiveLevels));let s=null,a=99995,o=null;return n.forEach(l=>{let c=i.responsiveLevels[l];if(["number","string"].includes(typeof c)||(c=c.levelWidth),c==="*")o=l;else if(t<c){const d=c-t;d<a&&(a=d,s=l)}}),s||o}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(t,i){const n=this,s=n.getClosestBiggerLevel(i),a=n.getClosestBiggerLevel(t);if(i===0||s!==a){const o=n.responsiveLevels[a];["number","string"].includes(typeof o)||n.applyState(o),n.columns.forEach(l=>{const c=l.responsiveLevels;c&&(c[a]?l.applyState(c[a]):c["*"]&&l.applyState(c["*"]))}),n.element.classList.remove("b-responsive-"+s),n.element.classList.add("b-responsive-"+a),n.trigger("responsive",{level:a,width:t,oldLevel:s,oldWidth:i})}}get widgetClass(){}},NP={string:1,number:1},zP={dataset:1,batch:1},BS=e=>{var r;return r=class extends(e||F){static get $name(){return"GridSelection"}construct(t){this._selectedCells=[],this._selectedRows=[],super.construct(t),t!=null&&t.selectedRecords&&(this.selectedRecords=t.selectedRecords)}getDefaultGridSelection(t){if(t.$name==="GridSelection")return t.configurable.selectionMode;if(t.superclass)return this.getDefaultGridSelection(t.superclass)}changeSelectionMode(t){const i=this;return i.selectionMode?(T.assign(i.selectionMode,t),i.selectionMode):(i.$defaultGridSelection=i.getDefaultGridSelection(i.constructor),new Proxy(t,{set(n,s,a){const o=T.assign({},n);return n[s]=a,i.updateSelectionMode(n,o),!0}}))}updateSelectionMode(t,i=this.$defaultGridSelection){var n,s;const a=this,{columns:o,checkboxSelectionColumn:l}=a,c={},{rowReorder:d}=a.features;for(const u in t)t[u]!=i[u]&&(c[u]=t[u]);t.rowCheckboxSelection&&!t.checkboxOnly&&(t.checkboxOnly=!0,delete t.rowCheckboxSelection),c.column&&(t.cell=!0,t.multiSelect=!0),c.cell&&(t.checkboxOnly=!1),c.cell===!1&&(t.column=!1),c.checkboxOnly&&(t.checkbox||(t.checkbox=!0),t.cell=!1),c.checkbox===!1&&(c.checkboxOnly=!1,c.showCheckAll=!1),c.showCheckAll&&(t.checkbox=t.checkbox||!0,t.multiSelect=!0),(c.includeChildren||c.includeParents)&&(t.multiSelect=!0),c.multiSelect===!1&&(t.column=t.showCheckAll=t.dragSelect=t.includeChildren=t.includeParents=!1),c.dragSelect&&(d!=null&&d.enabled&&d.gripOnly!==!0&&(d.showGrip=d.gripOnly=!0),t.multiSelect=!0,a._selectionListenersDetachers={}),c.dragSelect===!1&&a._selectionListenersDetachers&&((s=(n=a._selectionListenersDetachers).selectiondrag)==null||s.call(n),delete a._selectionListenersDetachers.selectiondrag),i&&(c.cell!==void 0||c.deselectFilteredOutRecords!==void 0||c.multiSelect!==void 0)&&a.deselectAll(),c.rowNumber?o.findRecord("type","rownumber")||(o.insert(0,{...typeof t.rowNumber=="object"?t.rowNumber:{},type:"rownumber"}),a._selectionAddedRowNumberColumn=!0):c.rowNumber===!1&&a._selectionAddedRowNumberColumn&&(o.remove(o.findRecord("type","rownumber")),delete a._selectionAddedRowNumberColumn),(t.checkbox!==(i==null?void 0:i.checkbox)||t.checkbox&&t.showCheckAll!==(i==null?void 0:i.showCheckAll))&&(i&&a.deselectAll(),a.isConfiguring?a.shouldInitCheckboxSelection=!0:a.initCheckboxSelection()),i&&t.checkbox&&i.checkbox&&t.checkboxIndex!==i.checkboxIndex&&l&&l.parent.insertChild(l,o.getAt(a.checkboxSelectionColumnInsertIndex)),a.trigger("selectionModeChange",T.clone(t)),a.afterSelectionModeChange(t)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){var t,i;const n=this,{selectionMode:s,columns:a,checkboxSelectionColumn:o}=n,{checkbox:l}=s;if(o&&(n.checkboxSelectionColumn=null,a.remove(o)),l){const c=De.getColumnClass("check"),d=l===!0?null:l;if(!c)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const u=n.checkboxSelectionColumn=new c(T.assign({id:`${n.id}-selection-column`,width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:(i=(t=n.items)==null?void 0:t[0])==null?void 0:i.region,showCheckAll:s.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},d),a,{isSelectionColumn:!0});u.meta.depth=0,u._grid=n;const h=u.renderer;u.renderer=f=>{f.value=n.isSelected(f.record),h.call(u,f)},u.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:n}),a.insert(n.checkboxSelectionColumnInsertIndex,u)}}get checkboxSelectionColumnInsertIndex(){const{columns:t}=this;let{checkboxIndex:i}=this.selectionMode;return i?typeof i=="string"&&(i=t.indexOf(t.getById(i))):i=t.indexOf(t.findRecord("type","rownumber"))+1,i}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(t){return t instanceof Mt?t:new Mt(t)}updateSelectedRecordCollection(t){t.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:t=[],removed:i}){this.selectedRecordCollection._fromSelection||(t=t.filter(n=>this.isSelectable(n)),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:t,deselectedRecords:i}))}changeSelectedRecordCollectionSilent(t){this.selectedRecordCollection._fromSelection=!0;const i=t(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,i}bindStore(t){var i;this.detachListeners("selectionStoreFilter"),t.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),(i=super.bindStore)==null||i.call(this,t)}unbindStore(t){this.detachListeners("selectionStoreFilter"),super.unbindStore(t)}onStoreFilter({source:t}){const i=this,n=[];for(const a of i.selectedRows)t.includes(a)||n.push(a);const s=i.prepareSelection(i.selectionMode.deselectFilteredOutRecords?n:[]);if(i.isCellSelectionMode){const{deselectedCells:a}=i.prepareSelection(i.getSelectedCellsForRecords(n));a!=null&&a.length&&(s.deselectedCells=(s.deselectedCells||[]).concat(a))}(s.deselectedCells.length||s.deselectedRecords.length)&&(i.performSelection(s,!1),i.updateCheckboxHeader())}onStoreRecordIdChange({record:t,oldValue:i}){var n;(n=super.onStoreRecordIdChange)==null||n.call(this,...arguments),this.selectedRecordCollection.get(i)===t&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(t){var i;if((i=super.onStoreRemove)==null||i.call(this,t),!t.isCollapse){const n=this,s=t.records.filter(a=>this.isSelected(a));if(s.length){const a=n.prepareSelection(s);if(n.isCellSelectionMode){const{deselectedCells:o}=n.prepareSelection(n.getSelectedCellsForRecords(s));o!=null&&o.length&&(a.deselectedCells=(a.deselectedCells||[]).concat(o))}n.performSelection(a)}}}onStoreDataChange({action:t,source:i}){var n;const s=this,{selectionMode:a}=s;let o;if((n=super.onStoreDataChange)==null||n.call(this,...arguments),t==="pageLoad")a.preserveSelectionOnPageChange||(o=s.prepareSelection(null,null,!0)),s.updateCheckboxHeader();else if(zP[t]){const l=[];if(a.preserveSelectionOnDatasetChange===!1)o=s.prepareSelection(null,null,!0);else{l.push(...s.changeSelectedRecordCollectionSilent(c=>c.match(i.storage)));for(const c of s._selectedCells)i.getById(c.id)||l.push(c);o=s.prepareSelection(l)}}o&&(o.deselectAll||o.deselectedCells.length||o.deselectedRecords.length||o.selectedCells.length||o.selectedRecords.length)&&(s.performSelection(o,!1),s.updateCheckboxHeader())}onStoreRemoveAll(){var t;(t=super.onStoreRemoveAll)==null||t.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:t,record:i}){const n=this,s=!n.selectionMode.multiSelect&&t,a=!s&&!t?[i]:null,o=t?[i]:null;t&&!he.shiftKeyDown&&(n._lastSelectionChecked=i),t&&n._lastSelectionChecked&&he.shiftKeyDown?n.performSelection(n.internalSelectRange(n._lastSelectionChecked,i,!0)):n.performSelection(n.prepareSelection(a,o,s,!0))}updateCheckboxHeader(){const{selectionMode:t,checkboxSelectionColumn:i,store:n}=this;if(t.checkbox&&t.showCheckAll&&(i!=null&&i.headerCheckbox)){const s=n.count&&!n.some(a=>!this.isSelected(a));i.headerCheckbox.checked!==s&&(i.suspendEvents(),i.headerCheckbox.checked=s,i.resumeEvents())}}onCheckAllChange({checked:t}){this[t?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}get selectionDragMouseEventListenerElement(){return globalThis}onSelectionDrag(t){var i,n;const s=this,{_selectionStartCell:a}=s;if(he.isMouseDown()||s.onSelectionEnd(),!a)return;const{items:o,_lastSelectionDragRegion:l}=s,c=s.getCellDataFromEvent(t,!0),d=c==null?void 0:c.column.region,u=(c==null?void 0:c.cellSelector)&&s.normalizeCellContext(c.cellSelector);if(u&&!u.equals(s._lastSelectionDragCell,!0)){if(s._isSelectionDragging||s.enableScrollingCloseToEdges(o),s._clearSelectionOnSelectionDrag&&!a.equals(u,!0)&&(s.deselectAll(),delete s._clearSelectionOnSelectionDrag),l&&d!==l){const f=s.subGrids[l],g=s.subGrids[d],m=f.scrollable,p=g.scrollable,v=o.indexOf(f)-o.indexOf(g)<0;if(p.x=v?0:p.maxX,v?m.x<m.maxX-1:m.x>1)return;(n=(i=s.scrollManager._activeScroll)==null?void 0:i.horizontal)==null||n.stopScroll()}s._lastSelectionDragRegion=d,s._lastSelectionDragCell=u,s._isSelectionDragging=!0;const h=s._lastSelectionDragChange=s.internalSelectRange(a,u,s.isRowNumberSelecting(u)||s.isRowNumberSelecting(a));h.deselectedCells=h.deselectedCells.filter(f=>!s.isCellSelected(f)),h.deselectedRecords=h.deselectedRecords.filter(f=>!s.isSelected(f)),s.refreshGridSelectionUI(h),s.trigger("dragSelecting",h)}}onSelectionEnd(){var t,i;const n=this,s=n._lastSelectionDragChange;n._isSelectionDragging&&!n._selectionStartCell.equals(n._lastSelectionDragCell,!0)&&s&&n.performSelection(s,!1),n.disableScrollingCloseToEdges(n.items),n._isSelectionDragging=!1,n._lastSelectionDragChange=n._lastSelectionDragCell=n._lastSelectionDragRegion=null,(i=(t=n._selectionListenersDetachers).selectiondrag)==null||i.call(t),delete n._selectionListenersDetachers.selectiondrag}onHandleElementClick(t){const i=this;i.selectionMode.rowNumber&&t.target.closest(".b-rownumber-header")?(t.handled=!0,i.store.count&&i.store.some(n=>!i.isSelected(n))?i.selectAll():i.deselectAll()):i.selectionMode.column&&t.target.closest(".b-grid-header")&&(t.handled=!0,i.selectColumn(t,t.ctrlKey)),super.onHandleElementClick(t)}selectColumn(t,i=!1){const n=this,{store:s}=n,{columnId:a}=n.getHeaderDataFromEvent(t);n._shiftSelectRange=null,t.shiftKey||(n._shiftSelectColumn=a);const o=t.shiftKey&&n._shiftSelectColumn||a,l=n.internalSelectRange(n.normalizeCellContext({id:s.first.id,columnId:o}),n.normalizeCellContext({id:s.last.id,columnId:a}));i&&!l.selectedCells.some(c=>!n.isCellSelected(c))&&(l.deselectedCells=l.selectedCells,l.selectedCells=[]),i||(l.deselectedCells=n._selectedCells),n.cleanSelectionChange(l),n.performSelection(l)}isSelected(t){return t!=null&&t.id&&(t=t.id),NP[typeof t]?this.selectedRows.some(i=>i.id===t):!1}isCellSelected(t,i){return t=this.normalizeCellContext(t),this.isCellSelectionMode&&this._selectedCells.some(n=>t.equals(n,!0))||i&&this.isSelected(t)}isSelectable(t){return this.normalizeCellContext({id:t.id||t}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(t){this.selectRow({record:t})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(t){this.selectRows(t)}get selectedRows(){return[...this._selectedRows]}set selectedRows(t){this.selectRows(t)}spliceSelectedRecords(t,i,n){const s=this;if(typeof i=="number"){const a=[...s.selectedRecords];a.splice(t,i,...H.asArray(n)),s.performSelection(s.prepareSelection(null,a,!0,!0))}else s.performSelection(s.prepareSelection(i,n,!1,!0))}selectRow(t){(typeof t=="number"||t.isModel||!("record"in t))&&(t={records:[t]}),T.assignIf(t,{scrollIntoView:!0}),this.selectRows(t)}selectRows(t){(!t||Array.isArray(t)||t.isModel||typeof t=="number"||!("records"in t)&&!("record"in t))&&(t={records:H.asArray(t)||[]});const i=this,{store:n}=i,s=[],{records:a=t.record?[t.record]:[],column:o=i.columns.visibleColumns[0],scrollIntoView:l,addToSelection:c=arguments[1]}=t;for(let d of a)d=n.getById(d),d&&s.push(d);c||(i._shiftSelectRange=null),i.performSelection(i.prepareSelection(null,s,!c,!0)),s.length&&l&&i.scrollRowIntoView(s[0].id,{column:o})}selectAll(t=!1){const{store:i}=this,n=(i.isGrouped?i.allRecords:i.records).filter(s=>!s.isSpecialRow);this.performSelection(this.prepareSelection(null,n,!1,!0),!0,t)}deselectAll(t=!1,i=!1){const{store:n}=this,s=t?(n.isGrouped?n.allRecords:n.records).filter(a=>!a.isSpecialRow):null;this.performSelection(this.prepareSelection(s,null,!t),!0,i)}deselectRow(t){this.deselectRows(t)}deselectRows(t){const{store:i}=this,n=H.asArray(t).map(s=>i.getById(s)).filter(s=>s);this.performSelection(this.prepareSelection(n))}selectRange(t,i,n=!1){const s=this,{store:a}=s,o=s.internalSelectRange(a.getById(t),a.getById(i),!0);s._shiftSelectRange=null,s.performSelection(o)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(t){this.selectCells([t])}get selectedCells(){return[...this._selectedCells]}set selectedCells(t){this.selectCells(t)}get selectedCellCSSSelector(){const t=this.selectedCell,i=t&&this.getRowById(t.id);return!t||!i?"":`[data-index=${i.dataIndex}] [data-column-id=${t.columnId}]`}selectCell(t){var i;return"id"in t&&(t={cell:t},t=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},t)),(i=this.selectCells(t))==null?void 0:i[0]}selectCells(t){Array.isArray(t)&&(t={cells:t});const i=this,{cells:n=t.cell?[t.cell]:[],scrollIntoView:s=!0,addToSelection:a=!1,silent:o=!1}=t,l=i.prepareSelection(null,n,!a);return a||(i._shiftSelectRange=null),i.performSelection(l,!0,o),s&&i.scrollRowIntoView(n[0].id,{column:n[0].columnId}),i.isCellSelectionMode?l.selectedCells:l.selectedRecords}deselectCell(t){var i;return(i=this.deselectCells([t]))==null?void 0:i[0]}deselectCells(t){const i=this.prepareSelection(t);return this.performSelection(i),this.isCellSelectionMode?i.deselectedCells:i.deselectedRecords}toggleSelection(t){const i=this,{_focusedCell:n,selectionMode:s}=i,a=i.isRowNumberSelecting(n),o=i.isCellSelected(n,!0);if(s.selectOnKeyboardNavigation===!0||n.isActionable)return!1;i.performSelection(i.prepareSelection(o?n:null,o?null:n,!s.multiSelect,a)),t.preventDefault()}selectCellRange(t,i){this.performSelection(this.internalSelectRange(t,i))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(t){const{deselectedRecords:i,selectedRecords:n,deselectedCells:s,selectedCells:a,deselectedCellRecords:o,selectedCellRecords:l}=t;return i!=null&&i.length&&(n!=null&&n.length)&&(t.deselectedRecords=i.filter(c=>!n.some(d=>c===d))),s!=null&&s.length&&(a!=null&&a.length)&&(t.deselectedCells=s.filter(c=>!a.some(d=>c.equals(d,!0)))),o.length&&(l!=null&&l.length||n!=null&&n.length)&&(t.deselectedCellRecords=o.filter(c=>!l.some(d=>c.id===d.id)&&!n.some(d=>c.id===d.id))),t}getSelectedCellsForRecords(t){return this._selectedCells.filter(i=>i.id&&t.some(n=>n.id===i.id))}delayUntilMouseUp(t){const i=j.on({element:globalThis,blur:n=>t(n,i),mouseup:n=>t(n,i),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return this.selectionMode.cell===!0}isRowNumberSelecting(...t){return this.selectionMode.rowNumber&&!t.some(i=>i.column.type!=="rownumber")}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(t){this._isKeyboardRangeSelecting=!0,this["navigate"+t](),this._isKeyboardRangeSelecting=!1}onCellNavigate(t,i,n,s){var a;const{selectionMode:o,_selectionListenersDetachers:l}=t,{multiSelect:c,deselectOnClick:d,dragSelect:u}=o,{ctrlKeyDown:h,shiftKeyDown:f}=he,g=he.isMouseDown(),m=he.isMouseDown(2),p=he.currentMouseDown||he.currentKeyDown;if(n=t.normalizeCellContext(n),!s||n.rowIndex===-1||(a=n.record)!=null&&a.isGroupHeader||p!=null&&p.fromKeyMap&&!o.selectOnKeyboardNavigation||t.columns.getById(n.columnId)===t.checkboxSelectionColumn||o.checkboxOnly||(p==null?void 0:p.handled)===!0)return;f||(t._isAddingToSelection=h&&c,t._selectionStartCell=n),c&&u&&g&&!l.selectiondrag&&!t.preventDragSelect&&(l.selectiondrag=j.on({name:"selectiondrag",element:t.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:globalThis},mousemove:"onSelectionDrag",thisObj:t})),t.preventDragSelect=!1;const v=t._selectionStartCell,y=t._isAddingToSelection;if((f&&g||t._isKeyboardRangeSelecting)&&v&&c)t.performSelection(t.internalSelectRange(v,n,t.isRowNumberSelecting(v,n)));else{let S=!1,D=!0,w;if(t.isCellSelected(n,!0)){if(m)return;if(y||d)w=d?null:[n],D=!1;else if(t.selectedRecords.length+(t.isCellSelectionMode?t._selectedCells.length:0)<=1)return;S=d||c}!w&&!y&&(w=null,u&&S&&l.selectiondrag&&(t._clearSelectionOnSelectionDrag=!0));const E=(x,M)=>{var I;if(M==null||M(),((I=x==null?void 0:x.target)==null?void 0:I.nodeType)===Node.ELEMENT_NODE){const P=new ne(x.target);if(P!=null&&P.grid&&!P.equals(n,!0))return}f||(t._shiftSelectRange=null),t.performSelection(t.prepareSelection(w,D&&[n],w===null,D&&t.isRowNumberSelecting(n)))};S?t.delayUntilMouseUp(E):E()}}prepareSelection(t,i,n=!1,s=!1){var a,o;const l=this,c=l._isSelectionDragging,{includeParents:d,selectRecordOnCell:u}=l.selectionMode,h=[],f=[];let g=[],m=[],p=[],v=[];if(n)g=l._selectedCells,m=l._selectedRows,v=l.selectedRecords.filter(y=>!m.some(S=>S.id===y.id));else if(t)for(const y of H.asArray(t)){const S=l.normalizeCellContext(y),D=(S==null?void 0:S.record)||(y.isModel?y:l.store.getById(S.id));if(!S.isSpecialRow&&(g.push(S),D&&!m.some(w=>w.id===D.id)&&(c||l.isSelected(D)?m.push(D):u&&l.selectedRecordCollection.get(D.id)&&!v.some(w=>w.id===D.id)&&v.push(D),l.selectionMode.includeChildren&&l.selectionMode.multiSelect&&!D.isLeaf&&((a=D.allChildren)!=null&&a.length))))for(const w of D.allChildren)!m.some(E=>E.id===w.id)&&(c||l.isSelected(w))&&m.push(w)}if(i){for(const y of H.asArray(i)){const S=l.normalizeCellContext(y),D=(S==null?void 0:S.record)||(y.isModel?y:l.store.getById(S.id));if(!(!D||S.isSpecialRow)&&(l.isCellSelectionMode&&!s&&f.push(S),(l.isRowSelectionMode||s)&&!h.some(w=>w.id===D.id)&&(h.push(D),l.selectionMode.includeChildren&&l.selectionMode.multiSelect&&!D.isLeaf&&((o=D.allChildren)!=null&&o.length))))for(const w of D.allChildren)h.some(E=>E.id===w.id)||h.push(w)}u&&f.length&&(p=H.unique(f.map(y=>y.record)).filter(y=>!h.some(S=>S.id===y.id)))}if(d&&(m.length||h.length)){const y=[...m,...h];H.unique(y.filter(D=>D.parent&&!D.allChildren.some(w=>y.includes(w))).map(D=>D.parent)).forEach(D=>l.toggleParentSelection(D,h,m))}return l.cleanSelectionChange({selectedCells:f,selectedRecords:h,deselectedCells:g,deselectedRecords:m,deselectAll:n,action:h!=null&&h.length||f!=null&&f.length?"select":"deselect",selectedCellRecords:p,deselectedCellRecords:v})}toggleParentSelection(t,i,n){if(!t||t.isRoot)return;const s=this.isSelected(t),a=i.includes(t),o=n.includes(t),l=c=>this.isSelected(c)&&!n.includes(c)||i.includes(c);this.selectionMode.includeParents==="some"?t.allChildren.some(l)?(!s||o)&&!a&&i.push(t):s&&!o&&n.push(t):s?!o&&!a&&t.allChildren.some(c=>n.includes(c))&&n.push(t):a||t.allChildren.every(l)&&i.push(t),t.parent&&this.toggleParentSelection(t.parent,i,n)}internalSelectRange(t,i,n=!1){const s=this,a=s.isRowSelectionMode||n,o=s.prepareSelection(s._shiftSelectRange,s.getRange(t,i,a),!1,n);return s._shiftSelectRange=o[`selected${a?"Records":"Cells"}`],o}getRange(t,i,n=!1){const s=this,{store:a}=s,o=s.normalizeCellContext(t),l=s.normalizeCellContext(i),c=Math.min(o.rowIndex,l.rowIndex),d=Math.max(o.rowIndex,l.rowIndex),u=[],h=Math.min(o.columnIndex,l.columnIndex),f=Math.max(o.columnIndex,l.columnIndex);if(c===-1||d===-1)throw new Error("Record not found in selectRange");if(n){const g=a.getRange(c,d+1,!1);l.rowIndex<o.rowIndex&&g.reverse(),u.push(...g)}else for(let g=c;g<=d;g++)for(let m=h;m<=f;m++)u.push({rowIndex:g,columnIndex:m});return u.map(g=>s.normalizeCellContext(g))}performSelection(t,i=!0,n=!1){const s=this,{selectedRecords:a=[],selectedCells:o=[],selectedCellRecords:l=[],deselectedRecords:c=[],deselectedCells:d=[],deselectedCellRecords:u=[],action:h}=t,f=[...a,...l],g=[...c,...u],m=s.isRowSelectionMode;if(s.trigger("beforeSelectionChange",{mode:m?"row":"cell",action:h,selected:f,deselected:g,selection:s.selectedRecords,selectedCells:o,deselectedCells:d,cellSelection:s.selectedCells})!==!1){if(s._selectedCells===d)s._selectedCells=[];else{const p=[];for(const v of s._selectedCells)d.some(y=>v.equals(y,!0))||p.push(v);s._selectedCells=p}if(t.deselectedRecords=[...t.deselectedRecords],c===s._selectedRows)s.changeSelectedRecordCollectionSilent(p=>p.clear()),s._selectedRows.length=0;else{const p=[],v=[];for(const y of s.selectedRecords)g.some(S=>y.id===S.id)||(s.isSelected(y)?p.push(y):v.push(y));s.changeSelectedRecordCollectionSilent(y=>y.values=[...p,...v]),s._selectedRows=p}if(o.length)for(const p of o)s._selectedCells.some(v=>v.equals(p,!0))||s._selectedCells.push(p);a.length&&(s.changeSelectedRecordCollectionSilent(p=>p.add(...a)),s._selectedRows.push(...a.filter(p=>!s._selectedRows.some(v=>v.id===p.id)))),l.length&&s.changeSelectedRecordCollectionSilent(p=>p.add(...l)),i&&s.refreshGridSelectionUI(t),s.afterSelectionChange(t),n||s.triggerSelectionChangeEvent(t)}}refreshGridSelectionUI({selectedRecords:t,selectedCells:i,deselectedRecords:n,deselectedCells:s}){const a=this,{checkboxSelectionColumn:o}=a;o==null||o.suspendEvents(),a.updateGridSelectionRecords(t,!0),a.updateGridSelectionRecords(n,!1),a.updateCheckboxHeader(),o==null||o.resumeEvents(),a.isCellSelectionMode&&(a.updateGridSelectionCells(i,!0),a.selectionMode.column&&a.updateGridSelectionColumns(i)),a.updateGridSelectionCells(s,!1)}updateGridSelectionRecords(t,i){const{checkboxSelectionColumn:n}=this;if(t!=null&&t.length)for(let s=0;s<t.length;s++){const a=this.getRowFor(t[s]);a&&(a.toggleCls("b-selected",i),a.setAttribute("aria-selected",i),n&&!n.hidden&&!t[s].isSpecialRow&&(a.getCell(n.id).widget.checked=i))}}updateGridSelectionCells(t,i){if(t!=null&&t.length)for(let n=0;n<t.length;n++){const s=this.getCell(t[n]);s&&(s.setAttribute("aria-selected",i),s.classList.toggle("b-selected",i))}}updateGridSelectionColumns(t){var i;const{count:n}=this.store;for(const s of this.columns.visibleColumns)(i=s.element)==null||i.classList.toggle("b-selected",(t==null?void 0:t.filter(a=>a.columnId===s.id).length)===n)}triggerSelectionChangeEvent(t){const{selectedRecords:i=[],selectedCells:n=[],selectedCellRecords:s=[],deselectedRecords:a=[],deselectedCells:o=[],deselectedCellRecords:l=[]}=t,c=[...i,...s],d=[...a,...l],u=this.isRowSelectionMode;this.trigger("selectionChange",{mode:u?"row":"cell",action:t.action,selected:c,deselected:d,selection:this.selectedRecords,selectedCells:n,deselectedCells:o,cellSelection:this.selectedCells})}doDestroy(){var t;(t=this.selectedRecordCollection)==null||t.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const i in this._selectionListenersDetachers)this._selectionListenersDetachers[i]();super.doDestroy()}get widgetClass(){}},R(r,"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{}}),r},WP=e=>e.columns.suspendEvents(),UP=e=>e.columns.resumeEvents(),GP=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},Ff=(e,r)=>e.stateSortIndex-r.stateSortIndex,HS=e=>class extends(e||F){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScroll","stateChange"]}}updateStore(t,i){var n;(n=super.updateStore)==null||n.call(this,t,i),this.detachListeners("stateStoreListeners"),t==null||t.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(t,i){var n;(n=super.updateColumns)==null||n.call(this,t,i),this.detachListeners("stateColumnListeners"),t.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(t,i){var n;(n=super.updateRowManager)==null||n.call(this,t,i),this.detachListeners("stateRowManagerListeners"),t.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const t=this,i=t.element.style.cssText,n={rowHeight:t.rowHeight};if(i&&(n.style=i),t.selectedCell){const{id:s,columnId:a}=t.selectedCell;n.selectedCell={id:s,columnId:a}}return n.selectedRecords=t.selectedRecords.map(s=>s.id),n.columns=t.columns.allRecords.map(s=>s.getState()),n.store=t.store.state,n.scroll=t.storeScroll(),n.subGrids={},t.eachSubGrid(s=>{var a;const o=n.subGrids[s.region]=n.subGrids[s.region]||{};s.isPainted?s.flex==null&&(o.width=s.width):s.config.width!=null?o.width=s.config.width:o.flex=s.config.flex,o.collapsed=(a=s.collapsed)!=null?a:!1,o.collapsed&&(o._beforeCollapseState=s._beforeCollapseState)}),n}applyState(t){const i=this;if(i.suspendRefresh(),"columns"in t){let n=!1,s=!1;i.columns.suspendEvents(),i.eachSubGrid(WP),t.columns.forEach((a,o)=>{const l=i.columns.getById(a.id);if(l){const c=l.generation;"region"in a&&!(a.region in i.subGrids)&&(delete a.region,delete a.locked),l.applyState(a),n=n||l.generation!==c,l.stateSortIndex=o,l.allIndex!==o&&(s=n=!0)}}),n&&i.eachSubGrid(GP),s&&(i.eachSubGrid(a=>{a.columns.records.sort(Ff),a.columns.allRecords.sort(Ff)}),i.columns.sort({fn:Ff,ascending:!0})),i.isPainted&&n&&i.renderContents(),i.columns.resumeEvents(),i.eachSubGrid(UP)}"subGrids"in t&&i.eachSubGrid(n=>{if(n.region in t.subGrids){const s=t.subGrids[n.region];"width"in s?n.width=s.width:"flex"in s&&(n.flex=s.flex),"collapsed"in s&&(n.collapsed=s.collapsed,n._beforeCollapseState=s._beforeCollapseState)}n.clearWidthCache()}),"rowHeight"in t&&(i.rowHeight=t.rowHeight),"style"in t&&(i.style=t.style),"selectedCell"in t&&(i.selectedCell=t.selectedCell),"store"in t&&(i.store.state=t.store),"selectedRecords"in t&&(i.selectedRecords=t.selectedRecords),i.resumeRefresh(!0),i.whenVisible(()=>i.applyScrollState(t))}applyScrollState(t){const i=this;i.eachSubGrid(n=>n.refreshFakeScroll()),"scroll"in t&&(i.restoreScroll(t.scroll),t.scroll.scrollTop&&i.element.querySelectorAll(".b-resize-monitored").forEach(n=>{const s=rs.fromElement(n);s&&s.onElementResize(n)}))}get widgetClass(){}},kf=Promise.resolve(),YP={block:"nearest"},Of=class extends or{updateYScroller(e){e==null||e.addScroller(this)}scrollIntoView(e,r=YP){const t=this,{xDelta:i,yDelta:n}=t.getDeltaTo(e,r),s=i||n?t.scrollBy(i,n,r):kf;return(r.highlight||r.focus)&&s.then(()=>{r.highlight&&(e instanceof k?e.translate(-i,-n).highlight():C.highlight(e)),r.focus&&e.focus&&e.focus()}),s}scrollBy(e,r,t){const i=r&&this.yScroller.scrollBy(0,r,t),n=e&&super.scrollBy(e,0,t);if(n&&n.cancel&&i&&i.cancel){const s=n.cancel,a=i.cancel;return n.cancel=i.cancel=()=>{s(),a()},Promise.all([n,i])}return n||i||kf}scrollTo(e,r,t){const i=r!=null&&this.yScroller.scrollTo(null,r,t),n=e!=null&&super.scrollTo(e,null,t);if(t&&t.animate||this.syncPartners(),n&&n.cancel&&i&&i.cancel){const s=n.cancel,a=i.cancel;return n.cancel=i.cancel=()=>{s(),a()},Promise.all([n,i])}return n||i||kf}get viewport(){const e=k.from(this.element);return e.intersect(k.from(this.yScroller.element))||new k(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}};R(Of,"configurable",{propagate:!1,overflowX:"hidden-scroll",yScroller:null}),Of._$name="SubGridScroller";var qP=(e,r)=>e+r.getBoundingClientRect().width,cn=class extends ${static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:Of,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(e){const r=this;if(super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),Y.isFirefox){const{element:t}=r,i=r.grid.scrollable;let n=0;t.addEventListener("wheel",({ctrlKey:s,deltaY:a,deltaX:o})=>{const l=Math.abs(a)>Math.abs(o);!s&&l&&!r.scrollEndDetacher&&i.y!==n&&(t.style.pointerEvents="none",n=i.y,r.scrollEndDetacher=i.ion({scrollEnd:async()=>{n=i.y,t.style.pointerEvents="",r.scrollEndDetacher=null},once:!0}))})}re.isTestEnv&&(r.hideOverlayScroller.delay=50)}doDestroy(){var e;const r=this;r.header.destroy(),r.footer.destroy(),(e=r.fakeScroller)==null||e.destroy(),r.virtualScrollerElement.remove(),r.splitterElements.forEach(t=>t.remove()),super.doDestroy()}get barConfig(){const e=this,{width:r,flex:t}=e.element.style,i={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return t?i.flex=t:r&&(i.width=r),i}changeHeader(e){return new this.headerClass(T.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(T.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,r=!0){this.splitterElements.forEach(t=>t==null?void 0:t.classList[r?"add":"remove"](e))}hideSplitter(){this.splitterElements.forEach(e=>e.classList.add("b-hide-display")),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach(e=>e.classList.remove("b-hide-display")),this.$showingSplitter=!0}changeElement(e,r){const{region:t}=this;return super.changeElement({"aria-label":t,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${t}`]:t,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:t}},r)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map((r,t)=>({role:"gridcell","aria-colindex":t+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:r.field||"",columnId:r.id}}))}}changeVirtualScrollerElement(){const e=C.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=C.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[Y.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[Y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[Y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[Y.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return C.createElement(this.splitterConfig)}changeScrollerSplitter(){return C.createElement(this.splitterConfig)}changeFooterSplitter(){return C.createElement(this.splitterConfig)}render(...e){const r=this;super.render(...e),r.grid&&(r.updateHasFlex(),r.element.parentNode.insertBefore(r.splitterElement,r.element.nextElementSibling),r.splitterElements.forEach(t=>j.on({element:t,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:r})),r._collapsed&&r.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;(e=this.footer)==null||e.refreshContent()}eachWidget(e,r=!0){const t=this,i=[t.header,t.footer];for(let n=0;n<i.length;n++){const s=i[n];if(e(s)===!1)return;r&&s.eachWidget&&s.eachWidget(e,r)}}fixCellWidths(e){const{visibleColumns:r}=this.columns;let t=e.firstElementChild,i=0;for(;t;){const n=r[i],{element:s}=n;n.minWidth&&(t.style.minWidth=C.setLength(n.minWidth)),n.maxWidth&&(t.style.maxWidth=C.setLength(n.maxWidth)),n.flex?n.childLevel&&s?(t.style.flex=`0 0 ${s.getBoundingClientRect().width}px`,t.style.width=""):(t.style.flex=n.flex,t.style.width=""):n.width?t.style.width=C.setLength(n.width):t.style.flex=t.style.width=t.style.minWidth="",t=t.nextElementSibling,i++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:r,header:t,footer:i}=e;if(!e.collapsed){if(e.flex)t.flex=e.flex,i&&(i.flex=e.flex),r.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some(s=>!s.hidden&&s.flex)&&e.totalFixedWidth!==e.width){e.width=e.totalFixedWidth,e.hasCalculatedWidth=!0;return}let n=e.width;if(!n&&e.hasCalculatedWidth){n=0;for(const s of e.columns)!s.flex&&!s.hidden&&(n+=s.width)}r.style.width=`${n}px`,t.width=n,i&&(i.width=n)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(Y.isSafari){const e=this,{region:r,header:t}=e,i=t.calculateMinWidthForSafari();e.rowManager.forEach(n=>{const s=n.getElement(r);s&&(s.style.width=`${i}px`)}),t.headersElement.style.width=`${i}px`}}set width(e){const r=this;r.hasCalculatedWidth=!1,super.width=e,r.header.width=e,r.footer.width=e,r.isPainted&&r.onElementResize()}get width(){return super.width}set flex(e){const r=this;r.hasCalculatedWidth=!1,r.header.flex=e,r.footer.flex=e,super.flex=e,r.isPainted&&r.onElementResize()}get flex(){return super.flex}onInternalResize(e,r,t,i,n){const s=this,{grid:a}=s;super.onInternalResize(...arguments),a!=null&&a.isPainted&&(s.syncSplitterButtonPosition(),r!==i&&(a.trigger("horizontalScroll",{grid:a,subGrid:s,scrollLeft:s.scrollable.element.scrollLeft,scrollX:s.scrollable.x}),s.fakeScroller&&s.refreshFakeScroll(),a.syncFlexedSubCols(),s.fixRowWidthsInSafariEdge()),t!==n&&a.onHeightChange(),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const r=this,{grid:t}=r;if(r.splitterElement&&r.$showingSplitter)r.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const i=t.getSubGrid(t.getPreviousRegion(r.region));i&&i.splitterElement&&i.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:r}=e;!e.collapsed&&(!r||!r.collapsed)&&e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:r}=e;e.toggleSplitterCls("b-hover",!1),!e.collapsed&&(!r||!r.collapsed)&&e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new k(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach(r=>C.toggleClasses(r,["b-disabled"],!e))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach(e=>{e.resizeToFitContent(null,null,!0)}),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&this.scrollable.hasOverflow("x")}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:r,virtualScrollerElement:t,virtualScrollerWidth:i,header:n,footer:s,scrollable:a}=e,o=[...n.contentElement.children].reduce(qP,0);a.scrollWidth=o,t.style.width=r.style.width,t.style.flex=r.style.flex,t.style.minWidth=r.style.minWidth,t.style.maxWidth=r.style.maxWidth,n.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(i.style.width=`${a.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):i.style.width=0)}initScroll(){const e=this,{scrollable:r,virtualScrollerElement:t}=e;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),Y.isFirefox&&r.element.addEventListener("wheel",i=>{i.deltaX&&(r.x+=i.deltaX,i.preventDefault())}),e.fakeScroller=new or({element:t,overflowX:!0,widget:e}),r.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),r.addPartner(e.fakeScroller,"x"),r.addPartner(e.header.scrollable,"x"),r.addPartner(e.footer.scrollable,"x"),e.refreshFakeScroll()}onSubGridScrollEnd(){const e=this;e.forceScrollUpdate||e.syncScrollingPartners(),e.scrolling=!1,C.scrollBarWidth||(e.grid.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller())}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const r=this,{grid:t}=r;!r.scrolling&&e&&(r.scrolling=!0,C.scrollBarWidth||(t.virtualScrollers.classList.add("b-scrolling"),r.showOverlayScroller())),t.trigger("horizontalScroll",{subGrid:r,grid:t,scrollLeft:r.scrollable.element.scrollLeft,scrollX:r.scrollable.x})}scrollColumnIntoView(e,r){const{columns:t,header:i}=this,n=i.scrollable;if(e=e instanceof pe?e:t.get(e)||t.getById(e)||t.getAt(e),e){const s=i.getHeader(e.id);if(s)return n.scrollIntoView(k.from(s,null,!0),r)}}onAddRow({rows:e,isExport:r}){const t=this,i=t.rowElementConfig,n=document.createDocumentFragment();e.forEach(s=>{const a=C.createElement(i);n.appendChild(a),s.addElement(t.region,a),t.fixCellWidths(a)}),r||(t.fixRowWidthsInSafariEdge(),t.element.insertBefore(n,t.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),r=document.createRange();e.length&&(r.setStartBefore(e[0]),r.setEndAfter(e[e.length-1]),r.deleteContents())}addNewRowElement(){const e=C.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return(e=this.grid)==null?void 0:e.rowManager}toggleTransitionClasses(e=!1){const r=this,t=r.grid,i=t.getSubGrid(t.getNextRegion(r.region)),n=t.resolveSplitter(i);i.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),i.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,{grid:r,element:t}=e,i=r.getSubGrid(r.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;let{_beforeCollapseState:s}=e,a=0;if(!(r.rendered&&e._collapsed===!0))return r.eachSubGrid(o=>{o!==e&&!o._collapsed&&++a}),a===0&&await i.expand(),new Promise(o=>{if(s)o();else{s=e._beforeCollapseState={};let l=!1;e.width&&(l=!0,e.ion({afterinternalresize:()=>{o(e)},thisObj:e,once:!0})),s.width=e.width,s.elementWidth=t.style.width,i.element.style.flex===""&&(s.nextRegionWidth=i.width,i.width="",i.flex="1"),t.style.flex!==""&&(s.flex=t.style.flex,e.header.element.style.flex=t.style.flex=""),t.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e._collapsed=!0,e.width="",l||(e.syncParallelSplitters(!0),o(!1))}r.trigger("subGridCollapse",{subGrid:e}),r.afterToggleSubGrid({subGrid:e,collapsed:!0})}).then(o=>{var l;e.isDestroyed||o!==!1&&(r.refreshVirtualScrollbars(),e.syncParallelSplitters(!0),(l=n.startSplitterButtonSyncing)==null||l.call(n))})}async expand(){const e=this,{grid:r,_beforeCollapseState:t}=e,i=r.getSubGrid(r.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;if(!(r.rendered&&e._collapsed!==!0))return new Promise(s=>{if(t!=null){let a=!1;e.width!==t.elementWidth&&(a=!0,e.ion({afterinternalresize(){e.setTimeout(()=>s(e),10)},thisObj:e,once:!0})),t.nextRegionWidth&&(i.width=t.nextRegionWidth,i.flex=null),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),t.flex?(e.width=t.width,e.header.flex=e.flex=t.flex,e.footer.flex=t.flex,e._width=null):e.width=t.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,a?(n.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1)):s(!1),delete e._beforeCollapseState}else s();r.trigger("subGridExpand",{subGrid:e}),r.afterToggleSubGrid({subGrid:e,collapsed:!1})})}hide(){var e,r;return(e=this.header)==null||e.hide(),(r=this.footer)==null||r.hide(),this.hideSplitter(),super.hide()}show(){var e,r;return(e=this.header)==null||e.show(),(r=this.footer)==null||r.show(),this.showSplitter(),super.show()}};R(cn,"delayable",{hideOverlayScroller:1e3}),cn.initClass(),cn._$name="SubGrid";var VS=e=>class extends(e||F){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(t){const i=this,n=new Set;for(const s of i.columns){const{region:a}=s;a&&(t[a]||(t[a]={}),n.add(a))}t.normal&&T.isEmpty(t.normal)&&(t.normal=xs.defaultConfig.subGridConfigs.normal);for(const s of n)i.createSubGrid(s,t[s]);return i.items=i.subGrids,t}createSubGrid(t,i=null){const n=this,s=n.columns.makeChained(c=>c.region===t,["region"]),a=T.assign({type:"subgrid",id:`${n.id}-${t}Subgrid`,parent:n,grid:n,region:t,headerClass:n.headerClass,footerClass:n.footerClass,columns:s,weight:t,scrollable:{yScroller:n.scrollable}},i||n.subGridConfigs[t]);let o=!1;!a.flex&&!a.width&&(a.width=s.totalFixedWidth,o=!0);const l=n.subGrids[t]=cn.create(a);return l.hasCalculatedWidth=o,t===n.regions[0]&&(l.isFirstRegion=!0),l}onChildAdd(t){if(t.isSubGrid){const i=this,{items:n,headerContainer:s,virtualScrollers:a,footerContainer:o}=i,l=n.indexOf(t)*2;i.hideHeaders||(C.insertAt(s,t.headerSplitter,l),C.insertAt(s,t.header.element,l)),C.insertAt(a,t.scrollerSplitter,l),C.insertAt(a,t.virtualScrollerElement,l),C.insertAt(o,t.footerSplitter,l),C.insertAt(o,t.footer.element,l),n.forEach((c,d)=>{d<n.length-1&&c.showSplitter()}),l===0&&i.emptyTextEl&&t.element.appendChild(i.emptyTextEl)}return super.onChildAdd(t)}onChildRemove(t){if(super.onChildRemove(t),t.isSubGrid){const{items:i}=this;delete this.subGrids[t.region],H.remove(this.regions,t.region),t.destroy(),i.length&&i[i.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid(t=>t.destroy()),super.doDestroy()}eachSubGrid(t,i=null){this.items.forEach((n,s)=>{n.isSubGrid&&t.call(i||n,n,s++)})}callEachSubGrid(t,...i){let n=null;return this.items.forEach((s,a)=>{if(s.isSubGrid&&s[t]){const o=s[t](...i);a===0&&(n=o)}}),n}get regions(){return this.items.map(t=>t.region)}getLastRegions(){const t=this.regions.slice(-2);return t.length===2?t:[t[0],t[0]]}getNextRegion(t){const i=this.regions;return i[i.indexOf(t)+1]||i[i.length-2]}getPreviousRegion(t){return this.regions[this.regions.indexOf(t)-1]}getSubGrid(t){return this.subGrids[t]}getSubGridFromColumn(t){return t=t instanceof pe?t:this.columns.getById(t)||this.columns.get(t),this.getSubGrid(t.region)}resolveSplitter(t){const i=this.getLastRegions();let n=t instanceof cn?t.region:t;return i[1]===n&&(n=i[0]),this.subGrids[n].splitterElement}get widgetClass(){}},KP=new String,XP={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:e=>`Move before "${e}"`,moveAfter:e=>`Move after "${e}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Column:{columnLabel:e=>`${e.text?`${e.text} column. `:""}SPACE for context menu${e.sortable?", ENTER to sort":""}`,cellLabel:KP},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:e=>{var r;return`${e.text?e.text:""} ${(r=e.location)!=null&&r.record?`rating : ${e.location.record[e.field]||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:e=>`Move column to ${e}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:r})=>`Exporting page ${e}/${r}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:r})=>`Exporting page ${e}/${r}`},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"}},TF=ct.publishLocale(XP),NS=new Promise(e=>e()),Lf="GridBase:store",ZP={block:"nearest",inline:"nearest"},JP={dataset:1,pageLoad:1,filter:1},xs=class extends Nt.mixin(sh,Xl,LS,$S,VP,jS,BS,HS,VS,Wh){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideFooters:!0,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store"}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,hideHeaders:null,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:ln,footerClass:Yc,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:kS,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const r=this,{initScroll:t}=r;r.initScroll=()=>!r.scrollInitialized&&t.call(r),re.isTestEnv&&(r.bufferedAfterColumnsResized.delay=50,r.bufferedElementResize.delay=50),super.finishConfigure(e),He.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:r}),He.ion({locale:"onLocaleChange",prio:-1,thisObj:r}),he.ion({theme:"onThemeChange",thisObj:r}),r.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:r}),r.bufferedFixElementHeights=r.buffer("fixElementHeights",r.fixElementHeightsBuffer,r),r.setGridClassList(r.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,r){return r==null||r.destroy(),e?Sc.new({element:this.element,owner:this},e):null}doDestroy(){var e,r;const t=this;t.detachListeners(Lf),(e=t.scrollManager)==null||e.destroy();for(const i of Object.values(t.features))(r=i.destroy)==null||r.call(i);t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach(t=>{if(t.disabled)return;let i;Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?i=t.constructor.featureClass:i=`b-${t instanceof F?t.$$name:t.constructor.name}`,i&&e.add(i.toLowerCase())})}compose(){const{autoHeight:e,enableSticky:r,enableTextSelection:t,fillLastColumn:i,positionMode:n,showDirty:s}=this;return{class:{[`b-grid-${n}`]:1,"b-enable-sticky":r,"b-grid-notextselection":!t,"b-autoheight":e,"b-fill-last-column":i,"b-show-dirty":s}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:r,hideHeaders:t}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":t}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:Y.isFirefox&&C.scrollBarWidth?{height:`${C.scrollBarWidth}px`}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":r}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideFooters(e){var r;(r=this.footerContainer)==null||r.classList[e?"add":"remove"]("b-hidden")}changeColumns(e,r){const t=this;if(!e&&r)return t.isDestroying?r.owner===t&&r.destroy():r.removeAll(),r;if(e.isStore)return(r==null?void 0:r.owner)===t&&r.destroy(),e.grid=t,e;if(Array.isArray(e)){if(r){const i=r.allRecords.slice();r.data=e;for(const n of i)r.includes(n)||n.destroy();return r}e={data:e}}if(r)throw new Error("Replacing ColumnStore is not supported");return De.new({grid:t,owner:t},e)}updateColumns(e,r){var t,i;const n=this;(t=super.updateColumns)==null||t.call(this,e,r),e.ion({refresh:n.onColumnsChanged,change:n.onColumnsChanged,sort:n.onColumnsChanged,thisObj:n}),e.ion(MP(n.onColumnsResized,n)),Y.isTouchDevice&&(n.touch=!0,e.forEach(s=>{const{touchConfig:a}=s;a&&s.applyState(a)})),(i=n.bodyElement)==null||i.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:r,changes:t,record:i,records:n,isMove:s}){var a;const o=this,{columns:l,checkboxSelectionColumn:c}=o,d=t&&Object.keys(t).length===1;if(e==="refresh"&&r!=="batch"||r==="update"&&d&&"parentIndex"in t||r==="sort"&&l.isSyncingDataOnLoad)return;const u=r==="add"&&n.some(h=>h.region&&!o.subGrids[h.region]);if(!(o.isConfiguring||!u&&(!o.isPainted||s&&r==="remove"))){if(r==="add")for(const h of n){const{region:f}=h;o.subGrids[f]||o.add(o.createSubGrid(f,(a=o.subGridConfigs)==null?void 0:a[f]))}if(r==="update"){if(("width"in t||"minWidth"in t||"maxWidth"in t||"flex"in t)&&!("region"in t)){const{region:h}=i;l.visibleColumns.forEach(f=>{f.region===h&&f.repaintOnResize&&o.refreshColumn(f)}),o.afterColumnsChange({action:r,changes:t,column:i});return}if("text"in t&&d){i.subGrid.refreshHeader();return}if("hidden"in t){const h=o.getSubGridFromColumn(i.id);h.header.fixHeaderWidths(),h.footer.fixFooterWidths(),h.updateHasFlex()}}if(r==="dataset"||r==="batch"||r==="update"&&"region"in t){const h=l.getDistinctValues("region",!0),{toRemove:f,toAdd:g}=H.delta(h,o.regions,!0);o.remove(f.map(m=>o.getSubGrid(m))),o.add(g.map(m=>o.createSubGrid(m,o.subGridConfigs[m])))}if(c&&!l.includes(c)){const h=l.indexOf(l.findRecord("type","rownumber"))+1;l.insert(h,c,!0)}o._suspendRenderContentsOnColumnsChanged||o.renderContents(),o.syncFlexedSubCols(),o.bodyElement.setAttribute("aria-colcount",l.visibleColumns.length),o.afterColumnsChange({action:r,changes:t,column:i,columns:n})}}onColumnsResized({changes:e,record:r}){var t;const i=this;if(i.isConfiguring)return;const n=C.setLength(r.width),s=C.setLength(r.minWidth),a=C.setLength(r.maxWidth),o=i.getSubGridFromColumn(r.id);if(o.header.fixHeaderWidths(),o.footer.fixFooterWidths(),o.updateHasFlex(),!(r.flex&&r.childLevel)){(!i.cellEls||r!==i.lastColumnResized)&&(i.cellEls=C.children(i.element,`.b-grid-cell[data-column-id="${r.id}"]`),i.lastColumnResized=r);for(const l of i.cellEls)"width"in e&&(l.style.width=n),"minWidth"in e&&(l.style.minWidth=s),"maxWidth"in e&&(l.style.maxWidth=a),"flex"in e&&(l.style.flex=(t=r.flex)!=null?t:null)}i.resizingColumns||i.afterColumnsResized(r),i.syncFlexedSubCols()}afterColumnsResized(e){const r=this;r.eachSubGrid(t=>{!t.collapsed&&(!e||e.region===t.region)&&(t.fixWidths(),t.fixRowWidthsInSafariEdge())}),r.lastColumnResized=r.cellEls=null,r.bufferedAfterColumnsResized(e),r.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query(r=>r.flex&&r.childLevel&&r.element);if(e)for(const r of e){const t=r.element.getBoundingClientRect().width,i=C.children(this.element,`.b-grid-cell[data-column-id="${r.id}"]`);for(const n of i)n.style.flex=`0 0 ${t}px`}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid(r=>{!r.collapsed&&(!e||e.region===r.region)&&r.refreshFakeScroll()})}bufferedElementResize(){this.refreshRows()}onInternalResize(e,r,t,i,n){C.scrollBarWidth&&r<i&&this.eachSubGrid(s=>{s.flex&&s.onElementResize(s.element)}),super.onInternalResize(...arguments),this.isPainted&&r!==i&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,r){const t=this;if(t._isRowMeasured||t.measureRowHeight(),r==null||r.destroy(),e){const i=qc.new({grid:t,rowHeight:t.rowHeight,rowScrollMode:t.rowScrollMode||"move",autoHeight:t.autoHeight,fixedRowHeight:t.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:t}},e);return t.relayEvents(i,["beforeRenderRow","renderRow"]),t._rowManager=null,i}}getRowHeight(e){return e.rowHeight}processRowHeight(e,r){}bindStore(e){const r=this.asyncEventSuffix;e.ion({name:Lf,[`refresh${r}`]:"onStoreDataChange",[`add${r}`]:"onStoreAdd",[`remove${r}`]:"onStoreRemove",[`replace${r}`]:"onStoreReplace",[`removeAll${r}`]:"onStoreRemoveAll",[`move${r}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",loadSync:"onStoreLoadSync",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(Lf),this.destroyStore&&e.destroy()}changeStore(e){var r;return e==null?null:(typeof e=="string"&&(e=ee.getStore(e)),e.isStore||(e=T.assign({data:this.data,tree:!!((r=this.initialConfig.features)!=null&&r.tree)},e),e.data||delete e.data,e.modelClass||(e.modelClass=pi),e=new(e.readUrl?ut:ee)(e)),e)}updateStore(e,r){var t,i;const n=this;(t=super.updateStore)==null||t.call(this,e,r),r&&n.unbindStore(r),e&&(r&&n.deselectAll(),n.bindStore(e)),n.trigger("bindStore",{store:e,oldStore:r}),!n.isDestroying&&n.isPainted&&!n.refreshSuspended&&((i=n._rowManager)==null||i.reinitialize())}onStoreLoadSync(){this.rowManager.renderFromRow(this.topRow)}onStoreUpdateRecord({source:e,record:r,changes:t}){const i=this;if(!(i.refreshSuspended||e.isSyncingDataOnLoad))if(i.forceFullRefresh)i.rowManager.refresh(),i.forceFullRefresh=!1;else{let n;if(r.isFieldModified("id")&&(n=i.getRowFor(r.meta.modified.id)),n=n||i.getRowFor(r),!n)return;if(i.fullRowRefresh||r.isSpecialRow){const s=e.indexOf(r);s!==-1&&n.render(s,r)}else i.columns.visibleColumns.forEach(s=>{const a=s.field;if(!(s.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(s.data,"renderer"))||t[a]){const l=n.getCell(a);l&&n.renderCell(l)}})}}refreshFromRowOnStoreAdd(e,r){const t=this,{rowManager:i}=t;i.renderFromRow(e),i.trigger("changeTotalHeight",{totalHeight:i.totalHeight}),t.store.count===1&&t.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:r,index:t,oldIndex:i,isChild:n,oldParent:s,parent:a,isMove:o,isExpandAll:l}){var c;const d=this,{rowManager:u}=d;if(!d.isPainted||l||d.refreshSuspended||e.isSyncingDataOnLoad||(c=e.project)!=null&&c.applyingChangeset)return;const h=o&&r.some(D=>{if(o[D.id]){const w=e.getById(D.meta.modified.parentId);return(w==null?void 0:w.isExpanded(e))&&(w==null?void 0:w.ancestorsExpanded(e))}});if(n&&!r[0].ancestorsExpanded(e)&&!h){if(!a.isLeaf){const D=u.getRowById(a);D&&u.renderRows([D])}return}u.calculateRowCount(!1,!0,!0),e.isFiltered&&(t=e.indexOf(r[0]));const{topIndex:f,rows:g,rowCount:m}=u,p=u.topIndex+u.rowCount-1,v=t,y=t+r.length-1,S=p>=e.count-r.length-1;s||i>-1||n&&o&&Object.values(o).some(D=>D)?u.refresh():v>=f&&v<f+m?d.refreshFromRowOnStoreAdd(g[v-f],...arguments):y>=f&&y<f+m?u.refresh():(S&&t>p&&u.fillBelow(d._scrollTop||0),u.estimateTotalHeight(!0))}onStoreException({action:e,type:r,response:t,exceptionType:i,error:n}){var s;const a=this;let o;switch(r){case"server":o=t.message||a.L("L{unspecifiedFailure}");break;case"exception":o=i==="network"?a.L("L{networkFailure}"):(n==null?void 0:n.message)||((s=t==null?void 0:t.parsedJson)==null?void 0:s.message)||a.L("L{parseFailure}");break}a.applyMaskError(`<div class="b-grid-load-failure">
                <div class="b-grid-load-fail">${a.L(e==="read"?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>
                ${t!=null&&t.url?`<div class="b-grid-load-fail">${t.url}</div>`:""}
                <div class="b-grid-load-fail">${a.L("L{serverResponse}")}</div>
                <div class="b-grid-load-fail">${o}</div>
            </div>`)}onStoreDataChange({action:e,changes:r,source:t,syncInfo:i}){var n;(n=super.onStoreDataChange)==null||n.call(this,...arguments);const s=this;if(s.refreshSuspended||!s.rowManager||t.isSyncingDataOnLoad||e==="dataset"&&(s.rowManager.clearKnownHeights(),t.isTree&&t.isFiltered))return;const a=t.isGrouped&&r&&t.groupers.some(o=>o.field in r);s.isPainted&&!a&&s.renderRows(!!(!(e in JP)||s.preserveScrollOnDatasetChange)),s.toggleEmptyText()}onStoreRecordIdChange(){var e;(e=super.onStoreRecordIdChange)==null||e.call(this,...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){const r=this._features;return(r==null?void 0:r.group)&&!r.group.disabled||(r==null?void 0:r.groupSummary)&&!r.groupSummary.disabled||this.store.tree&&!e&&this.store.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:e,records:r,isCollapse:t,isChild:i,isMove:n,isCollapseAll:s}){var a;if(!this.isPainted||n||s)return;(a=super.onStoreRemove)==null||a.call(this,...arguments);const o=this,{rowManager:l}=o;if(l.invalidateKnownHeight(r),!e.isSyncingDataOnLoad){if(o.animateRemovingRows&&!t&&!i){const c=r.reduce((d,u)=>{const h=l.getRowById(u.id);return h&&d.push(h),d},[]);if(c.length){const d=c[0];o.isAnimating=!0,j.onTransitionEnd({element:d._elementsArray[0],property:"left",duration:o.transitionDuration,thisObj:o,handler:()=>{o.isAnimating=!1,c.forEach(u=>!u.isDestroyed&&u.removeCls("b-removing")),l.refresh(),o.trigger("rowRemove"),o.afterRemove(arguments[0])}}),c.forEach(u=>u.addCls("b-removing"));return}}if(o.needsFullRefreshOnStoreRemove(...arguments))l.refresh(),o.afterRemove(arguments[0]);else{const c=l.topIndex;if(l.calculateRowCount(!1,!0,!0),l.topIndex!==c)l.renderFromRow(l.topRow);else{const{rows:d}=l,u=r.reduce((h,f)=>{const g=l.getRowById(f.id);return g&&(h=Math.min(h,d.indexOf(g))),h},d.length);d[u]?!o.refreshSuspended&&l.renderFromRow(d[u]):l.trigger("changeTotalHeight",{totalHeight:l.totalHeight})}o.trigger("rowRemove",{isCollapse:t}),o.afterRemove(arguments[0])}}}onFlatStoreMove({from:e,to:r}){const{rowManager:t,store:i}=this,{topIndex:n,rowCount:s}=t,[a,o]=[e,r].sort((d,u)=>d-u),l=i.indexOf(i.getAt(a,!0)),c=i.indexOf(i.getAt(o,!0));l>=n&&l<n+s?t.renderFromRow(t.rows[l-n]):c>=n&&c<n+s&&t.refresh()}onStoreReplace({records:e,all:r}){const{rowManager:t}=this;if(r)t.clearKnownHeights(),t.refresh();else{const i=e.reduce((n,[,s])=>{const a=this.getRowFor(s);return a&&n.push(a),n},[]);t.invalidateKnownHeight(e),t.renderRows(i)}}relayStoreDataChange(e){if(this.ariaElement.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...e,store:e.source,source:this})}onStoreRemoveAll(){var e;(e=super.onStoreRemoveAll)==null||e.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const r=[];e.modified.forEach(t=>{const i=this.rowManager.getRowFor(t);i&&r.push(i)}),this.rowManager.renderRows(r)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:r}){const t=this,{subGrids:i,regions:n}=t,{parent:s}=e;let a=!0;Object.entries(i).forEach(([o,l])=>{if(!l.sealedColumns&&e.draggable&&o!==e.region&&(!s&&i[e.region].columns.count>1||s&&s.children.length>1)){const c=l.element.compareDocumentPosition(i[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,d=t.rtl?!c:c,u=n.length>2?t.L("L{moveColumnTo}",t.optionalL(o)):t.L(d?"L{moveColumnRight}":"L{moveColumnLeft}");r[`${o}Region`]={targetSubGrid:o,text:u,icon:"b-fw-icon b-icon-column-move-"+(d?"right":"left"),separator:a,disabled:!e.allowDrag,onItem:({item:h})=>{e.traverse(f=>f.region=o),t.columns.insert(t.columns.indexOf(i[h.targetSubGrid].columns.last)+1,e),t.scrollColumnIntoView(e)}},a=!1}})}populateCellMenu({record:e,items:r}){}getColumnDragToolbarItems(e,r){return r}normalizeCellContext(e){const r=this,{columns:t}=r;return e.isLocation?e:e.isModel?new ne({grid:r,id:e.id,columnId:t.visibleColumns[0].id}):new ne(T.assign({grid:r},e))}getCell(e){const{store:r,columns:t}=this,{visibleColumns:i}=this.columns,n=isNaN(e.row)?isNaN(e.rowIndex)?r.indexOf(e.record||e.id):e.rowIndex:e.row,s=isNaN(e.column)?isNaN(e.columnIndex)?i.indexOf(e.column||t.getById(e.columnId)||t.get(e.field)||i[0]):e.columnIndex:e.column;return n>-1&&n<r.count&&s>-1&&s<i.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const r=this.columns.get(e);return r?this.getHeaderElement(r):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return!!((e=this.features.treeGroup)!=null&&e.isGrouped)}getRecordFromElement(e){const r=e.closest(".b-grid-row");return r?this.store.getAt(r.dataset.index):null}getColumnFromElement(e){const r=e.closest(".b-grid-cell, .b-grid-header");if(!r)return null;if(r.matches(".b-grid-header"))return this.columns.getById(r.dataset.columnId);const t=ze.get(r);return this.columns.getById(t.columnId)}updateAutoHeight(e){T.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){T.assertBoolean(e,"columnLines"),C.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let r=0,{length:t}=e;r<t;r++)e[r].setAttribute("aria-colindex",r+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:r}){return this.refreshTotalHeight(e,r)}refreshTotalHeight(e=this.rowManager.totalHeight,r=!1){const t=this;if(t.renderingRows||!t.isVisible)return!1;const i=t.scrollable,n=Math.abs(t.virtualScrollHeight-e),s=t._bodyRectangle.height,a=e-s;if(n){const o=a-t._scrollTop<s*2||t._verticalScrollHeight&&t._verticalScrollHeight-s<t._scrollTop;i.scrollHeight=t.virtualScrollHeight=e,t.isPainted&&(t.scrolling&&!o||n<100)&&!r?t.bufferedFixElementHeights():(t.virtualScrollHeightDirty&&t.virtualScrollHeightDirty(),t.bufferedFixElementHeights.cancel(),t.fixElementHeights())}}fixElementHeights(){const e=this,r=e.virtualScrollHeight,t=`${r}px`;e._verticalScrollHeight=r,e.verticalScroller.style.height=t,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=t,e._bodyHeight=r,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=k.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...H.asArray(e||[]).map(r=>({element:(typeof r=="string"?this.subGrids[r]:r).scrollable.element}))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...H.asArray(e||[]).map(r=>(typeof r=="string"?this.subGrids[r]:r).element)])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:r}=e;e.scrollInitialized||(e.scrollInitialized=!0,r.contentElement=e.contentElement,r.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),Y.isMobileSafari&&(r.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const r=this,{y:t}=e;t!==r._scrollTop&&(r._scrollTop=t,r.scrolling||(r.scrolling=!0,r.eachSubGrid(i=>i.suspendResizeMonitor=!0)),r.rowManager.updateRenderedRows(t),r.afterScroll({scrollTop:t}),r.trigger("scroll",{scrollTop:t}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid(e=>e.suspendResizeMonitor=!1)}async scrollRowIntoView(e,r=ZP){var t;const i=this,n=r.block||"nearest",{rowManager:s}=i,a=i.store.getById(e);if(a){let o;if(i.store.indexOf(a)===-1)return NS;let l=i.scrollable,c=i.getRecordCoords(a);const d=k.from(l.element);if(c.virtual){const u=c.block,h=n!=="nearest"?r:{block:u};if(o=l.scrollIntoView(c,{block:"center"}),s.scrollTargetRecordId=a,s.updateRenderedRows(l.y,!0),c=i.getRecordCoords(a),s.lastScrollTop=l.y,c.virtual)return NS;r.animate?(l.suspendEvents(),n==="end"||n==="nearest"&&u==="end"?l.y-=d.bottom-c.bottom:(n==="start"||n==="nearest"&&u==="start")&&(l.y+=c.y-d.y),s.updateRenderedRows(l.y,!1,!0),u==="end"?l.y-=s.appendRowBuffer*s.rowHeight-1:l.y+=s.prependRowBuffer*s.rowHeight-1,l.scrollIntoView(i.getRecordCoords(a),Object.assign({},r,h)),l.resumeEvents()):(r.recursive||await o,await((t=i.scrollRowIntoView)==null?void 0:t.call(i,a,Object.assign({recursive:!0},r,h))))}else{let{column:u}=r;if(u){if(u.isModel||(u=i.columns.getById(u)||i.columns.get(u)),u){l=i.getSubGridFromColumn(u).scrollable;const h=k.from(s.getRowFor(a).getCell(u.id));c.x=h.x,c.width=h.width}}else r.x=!1;return l.scrollIntoView(c,r)}}}scrollColumnIntoView(e,r){return e=e instanceof pe?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,r)}scrollCellIntoView(e,r){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},typeof r=="boolean"?{animate:r}:r))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,r=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid(t=>{r.scrollLeft[t.region]=t.scrollable.x}),r}restoreScroll(e=this.storedScrollState){const r=this;r.eachSubGrid(t=>{var i;const n=e.scrollLeft[t.region];n!=null&&(t.scrollable.updateX(n),t.header.scrollable.updateX(n),t.footer.scrollable.updateX(n),(i=t.fakeScroller)==null||i.updateX(n))}),r.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=C.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:Y.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const r=e.appendTo||e.insertBefore||document.body,t=C.getRootElement(typeof r=="string"?document.getElementById(r):r)||document.body;(!e.adopt||!t.contains(e.element))&&(t.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:r}=e.beginGridMeasuring(),t=C.getStyleValue(r,["height","border-top-width","border-bottom-width"]),i=parseInt(t.height),n=Y.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,s=t["border-top-width"]?Math.round(n*parseFloat(t["border-top-width"])):0,a=t["border-bottom-width"]?Math.round(n*parseFloat(t["border-bottom-width"])):0;(e.rowHeight==null||e.rowHeight===e._rowHeightFromStyle)&&(e.rowHeight=!isNaN(i)&&i?i:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=s+a,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:r,rowManager:t}=this;r.classList.add("b-notransition"),e?t.returnToTop():t.refresh(),r.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach(r=>r.renderCell(r.getCell(e.id))):e.children.forEach(r=>this.refreshColumn(r)))}refreshVirtualScrollbars(){const e=this,{headerContainer:r,footerContainer:t,virtualScrollers:i,scrollable:n,hasVerticalOverflow:s}=e,{classList:a}=i,o=!a.contains("b-hide-display"),l=Object.values(e.subGrids).some(d=>d.overflowingHorizontally),c=l!==o;if(c&&i.classList.toggle("b-hide-display",!l),C.scrollBarWidth){const d=s||n.overflowY==="scroll";r.classList.toggle("b-show-yscroll-padding",d),t.classList.toggle("b-show-yscroll-padding",d),i.classList.toggle("b-show-yscroll-padding",d),c&&(l&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,r=e.rowManager;e.isVisible?(r.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const r=this,t=e&&r.storeScroll();r.refreshSuspended||(r.trigger("beforeRenderRows"),r.renderingRows=!0,r.element.classList.add("b-grid-refreshing"),e||(r.scrollable.y=r._scrollTop=0),r.rowManager.reinitialize(!e),r.trigger("renderRows"),r.renderingRows=!1,r.onContentChange(),e&&r.restoreScroll(t),r.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:r,headerContainer:t,footerContainer:i,rowManager:n}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",t),e.callEachSubGrid("refreshFooter",i),e.renderHeader(t,r),e.renderFooter(i,r),e.fixSizes();const s=n.removeAllRows();n.calculateRowCount(!1,!0,!0),n.rowCount&&(n.setPosition(s),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){var r;const t=this;if(t.ariaElement.setAttribute("aria-rowcount",t.store.count+1),(r=super.onPaint)==null||r.call(this,...arguments),t.onPaintOverride()||!e)return;const{rowManager:i,store:n,element:s,headerContainer:a,bodyContainer:o,footerContainer:l}=t,c=C.scrollBarPadElement;let d,u=0;t.role=n!=null&&n.isTree?"treegrid":"grid",t.columns.ion({change:()=>d=!0,once:!0}),t.updateResponsive(t.width,0),d&&(t.callEachSubGrid("refreshHeader",a),t.callEachSubGrid("refreshFooter",l)),t.renderHeader(a,s),t.renderFooter(l,s),C.append(a,c),C.append(l,c),C.append(t.virtualScrollers,c),t.refreshBodyRectangle();const h=t.bodyContainer.offsetHeight;if(t.autoHeight?(t._bodyHeight=i.initWithHeight(s.offsetHeight-a.offsetHeight-l.offsetHeight,!0),o.style.height=t.bodyHeight+"px"):(t._bodyHeight=h,i.initWithHeight(t._bodyHeight,!0)),t.eachSubGrid(f=>{f.header.maxDepth>u&&(u=f.header.maxDepth)}),a.dataset.maxDepth=u,t.fixSizes(),(n.count||!n.isLoading)&&t.renderRows(),t.columns.usesAutoHeight){const{fonts:f}=document;(f==null?void 0:f.status)!=="loaded"&&f.ready.then(()=>!t.isDestroyed&&t.refreshRows())}t.initScroll(),t.initInternalEvents()}render(){const e=this;e.requireSize=!!e.owner,super.render(...arguments),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),!("minHeight"in e.initialConfig)&&!("height"in e.initialConfig)&&parseInt(globalThis.getComputedStyle(e.element).minHeight)===e.height&&console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,r){}renderFooter(e,r){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}syncMaskCover(e=this.masked){if(e){const r=e.cover==="body"&&this.rectangleOf("bodyContainer"),t=r&&this.rectangleOf("virtualScrollers"),{style:i}=e.element;i.marginTop=r?`${r.y}px`:"",i.height=r?`${r.height+((t==null?void 0:t.height)||0)}px`:""}}maskBody(e){let r;return this.bodyContainer&&(this.masked=It.mergeConfigs(this.loadMaskDefaults,e),r=this.masked),r}unmaskBody(){this.masked=null}updateEmptyText(e){var r,t;(r=this.emptyTextEl)==null||r.remove(),this.emptyTextEl=C.createElement({parent:(t=this.firstItem)==null?void 0:t.element,className:"b-empty-text",[e!=null&&e.includes("<")?"html":"text"]:e})}toggleEmptyText(){const{bodyContainer:e,store:r}=this;e==null||e.classList.toggle("b-grid-empty",!(r.count>0||r.isLoading||r.isCommitting))}updateReadOnly(e,r){var t;if(super.updateReadOnly(e,r),!this.isConfiguring)for(const i of this.columns.bottomColumns)(t=i.updateReadOnly)==null||t.call(i,e)}getCurrentConfig(e){const r=super.getCurrentConfig(e),{store:t}=this,i=t.getInlineData(e),n=t.getCurrentConfig(e)||r.store;return i.length&&(r.data=i),n&&t.originalModelClass===pi&&delete n.modelClass,T.isEmpty(n)||(r.store=n),r.store&&delete r.store.data,r}};xs.initClass(),re.setVersion("grid","5.3.7"),xs._$name="GridBase";var Xc=class extends xs{static get $name(){return"Grid"}static get type(){return"grid"}};Xc.initClass(),Xc._$name="Grid";var Zc=class extends Xc{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}static get configurable(){return{store:{tree:!0}}}updateStore(e,r){if(e&&!e.tree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,r)}};Zc.initClass(),Zc._$name="TreeGrid";var Rs=class extends qe{configure(e){super.configure(e);const r=this;r.ion({change(){r.picker.selectedRecords=r.value}})}changePicker(e,r){const t=this;return super.changePicker(T.assign({},e,{type:"treegrid",minWidth:"35em",readOnly:t.readOnly,disableGridRowModelWarning:!0,selectedRecords:t.value.map(i=>t.store.getById(i)),selectionMode:{row:!0,multiSelect:t.multiSelect,rowCheckboxSelection:!0},internalListeners:{selectionChange({selection:i}){t.value=i}}}),r)}};R(Rs,"$name","TreeCombo"),R(Rs,"type","treecombo"),R(Rs,"configurable",{multiSelect:!0,chipView:{itemTpl(e){return L.xss`${e.name}`},scrollable:{overflowX:"hidden-scroll"}}}),Rs.initClass(),Rs._$name="TreeCombo";var zS=(e,r)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+r,e.getMilliseconds()),$f=function(){"use strict";var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(r){"use strict";if(this==null)throw new TypeError;var t=Object(this),i=t.length>>>0;if(i===0)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:n!=0&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var s=n>=0?n:Math.max(i-Math.abs(n),0);s<i;s++)if(s in t&&t[s]===r)return s;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(r,t){r.sort(function(i,n){return+i-+n}),t&&r[0]===0&&r.push(r.shift())},e.array.next=function(r,t,i){for(var n,s=i[0]!==0,a=0,o=t.length-1;o>-1;--o){if(n=t[o],n===r)return n;if(n>r||n===0&&s&&i[1]>r){a=o;continue}break}return t[a]},e.array.nextInvalid=function(r,t,i){for(var n=i[0],s=i[1],a=t.length,o=t[a-1]===0&&n!==0?s:0,l=r,c=t.indexOf(r),d=l;l===(t[c]||o);)if(l++,l>s&&(l=n),c++,c===a&&(c=0),l===d)return;return l},e.array.prev=function(r,t,i){for(var n,s=t.length,a=i[0]!==0,o=s-1,l=0;l<s;l++){if(n=t[l],n===r)return n;if(n<r||n===0&&a&&i[1]<r){o=l;continue}break}return t[o]},e.array.prevInvalid=function(r,t,i){for(var n=i[0],s=i[1],a=t.length,o=t[a-1]===0&&n!==0?s:0,l=r,c=t.indexOf(r),d=l;l===(t[c]||o);)if(l--,l<n&&(l=s),c--,c===-1&&(c=a-1),l===d)return;return l},e.day=e.D={name:"day",range:86400,val:function(r){return r.D||(r.D=e.date.getDate.call(r))},isValid:function(r,t){return e.D.val(r)===(t||e.D.extent(r)[1])},extent:function(r){if(r.DExtent)return r.DExtent;var t=e.M.val(r),i=e.DAYS_IN_MONTH[t-1];return t===2&&e.dy.extent(r)[1]===366&&(i=i+1),r.DExtent=[1,i]},start:function(r){return r.DStart||(r.DStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)))},end:function(r){return r.DEnd||(r.DEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)))},next:function(r,t){t=t>e.D.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.D,e.M),n=e.D.extent(i)[1];return t=t>n?1:t||n,e.date.next(e.Y.val(i),e.M.val(i),t)},prev:function(r,t){var i=e.date.prevRollover(r,t,e.D,e.M),n=e.D.extent(i)[1];return e.date.prev(e.Y.val(i),e.M.val(i),t>n?n:t||n)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(r){return r.dc||(r.dc=Math.floor((e.D.val(r)-1)/7)+1)},isValid:function(r,t){return e.dc.val(r)===t||t===0&&e.D.val(r)>e.D.extent(r)[1]-7},extent:function(r){return r.dcExtent||(r.dcExtent=[1,Math.ceil(e.D.extent(r)[1]/7)])},start:function(r){return r.dcStart||(r.dcStart=e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,(e.dc.val(r)-1)*7+1||1)))},end:function(r){return r.dcEnd||(r.dcEnd=e.date.prev(e.Y.val(r),e.M.val(r),Math.min(e.dc.val(r)*7,e.D.extent(r)[1])))},next:function(r,t){t=t>e.dc.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.dc,e.M),n=e.dc.extent(i)[1];t=t>n?1:t;var s=e.date.next(e.Y.val(i),e.M.val(i),t===0?e.D.extent(i)[1]-6:1+7*(t-1));return s.getTime()<=r.getTime()?(i=e.M.next(r,e.M.val(r)+1),e.date.next(e.Y.val(i),e.M.val(i),t===0?e.D.extent(i)[1]-6:1+7*(t-1))):s},prev:function(r,t){var i=e.date.prevRollover(r,t,e.dc,e.M),n=e.dc.extent(i)[1];return t=t>n?n:t||n,e.dc.end(e.date.prev(e.Y.val(i),e.M.val(i),1+7*(t-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(r){return r.dw||(r.dw=e.date.getDay.call(r)+1)},isValid:function(r,t){return e.dw.val(r)===(t||7)},extent:function(){return[1,7]},start:function(r){return e.D.start(r)},end:function(r){return e.D.end(r)},next:function(r,t){return t=t>7?1:t||7,e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t-e.dw.val(r))+(t<=e.dw.val(r)?7:0))},prev:function(r,t){return t=t>7?7:t||7,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)+(t-e.dw.val(r))+(t>=e.dw.val(r)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(r){return r.dy||(r.dy=Math.ceil(1+(e.D.start(r).getTime()-e.Y.start(r).getTime())/e.DAY))},isValid:function(r,t){return e.dy.val(r)===(t||e.dy.extent(r)[1])},extent:function(r){var t=e.Y.val(r);return r.dyExtent||(r.dyExtent=[1,t%4?365:366])},start:function(r){return e.D.start(r)},end:function(r){return e.D.end(r)},next:function(r,t){t=t>e.dy.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.dy,e.Y),n=e.dy.extent(i)[1];return t=t>n?1:t||n,e.date.next(e.Y.val(i),e.M.val(i),t)},prev:function(r,t){var i=e.date.prevRollover(r,t,e.dy,e.Y),n=e.dy.extent(i)[1];return t=t>n?n:t||n,e.date.prev(e.Y.val(i),e.M.val(i),t)}},e.hour=e.h={name:"hour",range:3600,val:function(r){return r.h||(r.h=e.date.getHour.call(r))},isValid:function(r,t){return e.h.val(r)===t},extent:function(){return[0,23]},start:function(r){return r.hStart||(r.hStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r)))},end:function(r){return r.hEnd||(r.hEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r)))},next:function(r,t){t=t>23?0:t;var i=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t<=e.h.val(r)?1:0),t);return!e.date.isUTC&&i.getTime()<=r.getTime()&&(i=e.date.next(e.Y.val(i),e.M.val(i),e.D.val(i),t+1)),i},prev:function(r,t){return t=t>23?23:t,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)+(t>=e.h.val(r)?-1:0),t)}},e.minute=e.m={name:"minute",range:60,val:function(r){return r.m||(r.m=e.date.getMin.call(r))},isValid:function(r,t){return e.m.val(r)===t},extent:function(r){return[0,59]},start:function(r){return r.mStart||(r.mStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r)))},end:function(r){return r.mEnd||(r.mEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r)))},next:function(r,t){var i=e.m.val(r),n=e.s.val(r),s=t>59?60-i:t<=i?60-i+t:t-i,a=new Date(r.getTime()+s*e.MIN-n*e.SEC);return!e.date.isUTC&&a.getTime()<=r.getTime()&&(a=new Date(r.getTime()+(s+120)*e.MIN-n*e.SEC)),a},prev:function(r,t){return t=t>59?59:t,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r)+(t>=e.m.val(r)?-1:0),t)}},e.month=e.M={name:"month",range:2629740,val:function(r){return r.M||(r.M=e.date.getMonth.call(r)+1)},isValid:function(r,t){return e.M.val(r)===(t||12)},extent:function(){return[1,12]},start:function(r){return r.MStart||(r.MStart=e.date.next(e.Y.val(r),e.M.val(r)))},end:function(r){return r.MEnd||(r.MEnd=e.date.prev(e.Y.val(r),e.M.val(r)))},next:function(r,t){return t=t>12?1:t||12,e.date.next(e.Y.val(r)+(t>e.M.val(r)?0:1),t)},prev:function(r,t){return t=t>12?12:t||12,e.date.prev(e.Y.val(r)-(t>=e.M.val(r)?1:0),t)}},e.second=e.s={name:"second",range:1,val:function(r){return r.s||(r.s=e.date.getSec.call(r))},isValid:function(r,t){return e.s.val(r)===t},extent:function(){return[0,59]},start:function(r){return r},end:function(r){return r},next:function(r,t){var i=e.s.val(r),n=t>59?60-i:t<=i?60-i+t:t-i,s=new Date(r.getTime()+n*e.SEC);return!e.date.isUTC&&s.getTime()<=r.getTime()&&(s=new Date(r.getTime()+(n+7200)*e.SEC)),s},prev:function(r,t,i){return t=t>59?59:t,e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r)+(t>=e.s.val(r)?-1:0),t)}},e.time=e.t={name:"time",range:1,val:function(r){return r.t||(r.t=e.h.val(r)*3600+e.m.val(r)*60+e.s.val(r))},isValid:function(r,t){return e.t.val(r)===t},extent:function(){return[0,86399]},start:function(r){return r},end:function(r){return r},next:function(r,t){t=t>86399?0:t;var i=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t<=e.t.val(r)?1:0),0,0,t);return!e.date.isUTC&&i.getTime()<r.getTime()&&(i=e.date.next(e.Y.val(i),e.M.val(i),e.D.val(i),e.h.val(i),e.m.val(i),t+7200)),i},prev:function(r,t){return t=t>86399?86399:t,e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)+(t>=e.t.val(r)?-1:0),0,0,t)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(r){return r.wm||(r.wm=(e.D.val(r)+(e.dw.val(e.M.start(r))-1)+(7-e.dw.val(r)))/7)},isValid:function(r,t){return e.wm.val(r)===(t||e.wm.extent(r)[1])},extent:function(r){return r.wmExtent||(r.wmExtent=[1,(e.D.extent(r)[1]+(e.dw.val(e.M.start(r))-1)+(7-e.dw.val(e.M.end(r))))/7])},start:function(r){return r.wmStart||(r.wmStart=e.date.next(e.Y.val(r),e.M.val(r),Math.max(e.D.val(r)-e.dw.val(r)+1,1)))},end:function(r){return r.wmEnd||(r.wmEnd=e.date.prev(e.Y.val(r),e.M.val(r),Math.min(e.D.val(r)+(7-e.dw.val(r)),e.D.extent(r)[1])))},next:function(r,t){t=t>e.wm.extent(r)[1]?1:t;var i=e.date.nextRollover(r,t,e.wm,e.M),n=e.wm.extent(i)[1];return t=t>n?1:t||n,e.date.next(e.Y.val(i),e.M.val(i),Math.max(1,(t-1)*7-(e.dw.val(i)-2)))},prev:function(r,t){var i=e.date.prevRollover(r,t,e.wm,e.M),n=e.wm.extent(i)[1];return t=t>n?n:t||n,e.wm.end(e.date.next(e.Y.val(i),e.M.val(i),Math.max(1,(t-1)*7-(e.dw.val(i)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(r){if(r.wy)return r.wy;var t=e.dw.next(e.wy.start(r),5),i=e.dw.next(e.Y.prev(t,e.Y.val(t)-1),5);return r.wy=1+Math.ceil((t.getTime()-i.getTime())/e.WEEK)},isValid:function(r,t){return e.wy.val(r)===(t||e.wy.extent(r)[1])},extent:function(r){if(r.wyExtent)return r.wyExtent;var t=e.dw.next(e.wy.start(r),5),i=e.dw.val(e.Y.start(t)),n=e.dw.val(e.Y.end(t));return r.wyExtent=[1,i===5||n===5?53:52]},start:function(r){return r.wyStart||(r.wyStart=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r)-(e.dw.val(r)>1?e.dw.val(r)-2:6)))},end:function(r){return r.wyEnd||(r.wyEnd=e.date.prev(e.Y.val(r),e.M.val(r),e.D.val(r)+(e.dw.val(r)>1?8-e.dw.val(r):0)))},next:function(r,t){t=t>e.wy.extent(r)[1]?1:t;var i=e.dw.next(e.wy.start(r),5),n=e.date.nextRollover(i,t,e.wy,e.Y);e.wy.val(n)!==1&&(n=e.dw.next(n,2));var s=e.wy.extent(n)[1],a=e.wy.start(n);return t=t>s?1:t||s,e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1))},prev:function(r,t){var i=e.dw.next(e.wy.start(r),5),n=e.date.prevRollover(i,t,e.wy,e.Y);e.wy.val(n)!==1&&(n=e.dw.next(n,2));var s=e.wy.extent(n)[1],a=e.wy.end(n);return t=t>s?s:t||s,e.wy.end(e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(t-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(r){return r.Y||(r.Y=e.date.getYear.call(r))},isValid:function(r,t){return e.Y.val(r)===t},extent:function(){return[1970,2099]},start:function(r){return r.YStart||(r.YStart=e.date.next(e.Y.val(r)))},end:function(r){return r.YEnd||(r.YEnd=e.date.prev(e.Y.val(r)))},next:function(r,t){return t>e.Y.val(r)&&t<=e.Y.extent()[1]?e.date.next(t):e.NEVER},prev:function(r,t){return t<e.Y.val(r)&&t>=e.Y.extent()[0]?e.date.prev(t):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(r){return r.fd||(r.fd=r.getTime())},isValid:function(r,t){return e.fd.val(r)===t},extent:function(){return[0,3250368e7]},start:function(r){return r},end:function(r){return r},next:function(r,t){return e.fd.val(r)<t?new Date(t):e.NEVER},prev:function(r,t){return e.fd.val(r)>t?new Date(t):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(r,t){var i=t[0];return{name:"after "+r.name,range:(r.extent(new Date)[1]-i)*r.range,val:r.val,isValid:function(n,s){return this.val(n)>=i},extent:r.extent,start:r.start,end:r.end,next:function(n,s){return s!=i&&(s=r.extent(n)[0]),r.next(n,s)},prev:function(n,s){return s=s===i?r.extent(n)[1]:i-1,r.prev(n,s)}}},e.modifier.before=e.modifier.b=function(r,t){var i=t[t.length-1];return{name:"before "+r.name,range:r.range*(i-1),val:r.val,isValid:function(n,s){return this.val(n)<i},extent:r.extent,start:r.start,end:r.end,next:function(n,s){return s=s===i?r.extent(n)[0]:i,r.next(n,s)},prev:function(n,s){return s=s===i?i-1:r.extent(n)[1],r.prev(n,s)}}},e.compile=function(r){var t=[],i=0,n;for(var s in r){var a=s.split("_"),o=a[0],l=a[1],c=r[s],d=l?e.modifier[l](e[o],c):e[o];t.push({constraint:d,vals:c}),i++}t.sort(function(h,f){var g=h.constraint.range,m=f.constraint.range;return m<g?-1:m>g?1:0}),n=t[i-1].constraint;function u(h){return h==="next"?function(f,g){return f.getTime()>g.getTime()}:function(f,g){return g.getTime()>f.getTime()}}return{start:function(h,f){for(var g=f,m=e.array[h],p=1e3,v;p--&&!v&&g;){v=!0;for(var y=0;y<i;y++){var S=t[y].constraint,D=S.val(g),w=S.extent(g),E=m(D,t[y].vals,w);if(!S.isValid(g,E)){g=S[h](g,E),v=!1;break}}}return g!==e.NEVER&&(g=h==="next"?n.start(g):n.end(g)),g},end:function(h,f){for(var g,m=e.array[h+"Invalid"],p=u(h),v=i-1;v>=0;v--){var y=t[v].constraint,S=y.val(f),D=y.extent(f),w=m(S,t[v].vals,D),E;w!==void 0&&(E=y[h](f,w),E&&(!g||p(g,E))&&(g=E))}return g},tick:function(h,f){return new Date(h==="next"?n.end(f).getTime()+e.SEC:n.start(f).getTime()-e.SEC)},tickSafe:function(h,f){return h==="next"?zS(n.end(f),1):zS(n.start(f),-1)},tickStart:function(h){return n.start(h)}}},e.schedule=function(r){if(!r)throw new Error("Missing schedule definition.");if(!r.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],i=r.schedules.length,n=[],s=r.exceptions?r.exceptions.length:0,a=0;a<i;a++)t.push(e.compile(r.schedules[a]));for(var o=0;o<s;o++)n.push(e.compile(r.exceptions[o]));function l(w,E,x,M,I){var P=S(w),_=E,A=1e6,V=[],N=[],B,Z,K=[],se=w==="next",xe,gr=se?0:1,le=se?1:0;if(x=x?new Date(x):new Date,!x||!x.getTime())throw new Error("Invalid start date.");for(d(w,t,V,x),h(w,n,N,x);A--&&_&&(B=D(V,P))&&!(M&&P(B,M));){if(s&&(f(w,n,N,B),Z=p(w,N,B))){u(w,t,V,Z);continue}if(I){var Xe=v(N,P);Z=y(w,t,V,B,Xe);var ie=se?[new Date(Math.max(x,B)),Z?new Date(M?Math.min(Z,M):Z):void 0]:[Z?new Date(M?Math.max(M,Z.getTime()+e.SEC):Z.getTime()+e.SEC):void 0,new Date(Math.min(x,B.getTime()+e.SEC))];if(xe&&ie[gr].getTime()===xe[le].getTime()?(xe[le]=ie[le],_++):(xe=ie,K.push(xe)),!Z)break;u(w,t,V,Z)}else K.push(se?new Date(Math.max(x,B)):m(t,V,B,M)),g(w,t,V,B);_--}for(var ce=0,_i=K.length;ce<_i;ce++){var gt=K[ce];K[ce]=Object.prototype.toString.call(gt)==="[object Array]"?[c(gt[0]),c(gt[1])]:c(gt)}return K.length===0?e.NEVER:E===1?K[0]:K}function c(w){if(w instanceof Date&&!isNaN(w.valueOf()))return new Date(w)}function d(w,E,x,M){for(var I=0,P=E.length;I<P;I++)x[I]=E[I].start(w,M)}function u(w,E,x,M){for(var I=S(w),P=0,_=E.length;P<_;P++)x[P]&&!I(x[P],M)&&(x[P]=E[P].start(w,M))}function h(w,E,x,M){for(var I=S(w),P=0,_=E.length;P<_;P++){var A=E[P].start(w,M);A?x[P]=[A,E[P].end(w,A)]:x[P]=e.NEVER}}function f(w,E,x,M){for(var I=S(w),P=0,_=E.length;P<_;P++)if(x[P]&&!I(x[P][0],M)){var A=E[P].start(w,M);A?x[P]=[A,E[P].end(w,A)]:x[P]=e.NEVER}}function g(w,E,x,M){for(var I=0,P=E.length;I<P;I++)if(x[I]&&x[I].getTime()===M.getTime()){const _=E[I].start(w,E[I].tick(w,M));_!==e.NEVER&&_.getTime()===x[I].getTime()?x[I]=E[I].start(w,E[I].tickSafe(w,M)):x[I]=_}}function m(w,E,x,M){for(var I,P=0,_=E.length;P<_;P++)if(E[P]&&E[P].getTime()===x.getTime()){var A=w[P].tickStart(x);if(M&&A<M)return M;(!I||A>I)&&(I=A)}return I}function p(w,E,x){for(var M=S(w),I,P=0,_=E.length;P<_;P++){var A=E[P];A&&!M(A[0],x)&&(!A[1]||M(A[1],x))&&(!I||M(A[1],I))&&(I=A[1])}return I}function v(w,E){for(var x,M=0,I=w.length;M<I;M++)w[M]&&(!x||E(x,w[M][0]))&&(x=w[M][0]);return x}function y(w,E,x,M,I){for(var P=S(w),_,A=0,V=E.length;A<V;A++){var N=x[A];if(N&&N.getTime()===M.getTime()){var B=E[A].end(w,N);if(I&&(!B||P(B,I)))return I;(!_||P(B,_))&&(_=B)}}return _}function S(w){return w==="next"?function(E,x){return!x||E.getTime()>x.getTime()}:function(E,x){return!E||x.getTime()>E.getTime()}}function D(w,E){for(var x=w[0],M=1,I=w.length;M<I;M++)w[M]&&E(x,w[M])&&(x=w[M]);return x}return{isValid:function(w){return l("next",1,w,w)!==e.NEVER},next:function(w,E,x){return l("next",w||1,E,x)},prev:function(w,E,x){return l("prev",w||1,E,x)},nextRange:function(w,E,x){return l("next",w||1,E,x,!0)},prevRange:function(w,E,x){return l("prev",w||1,E,x,!0)}}},e.setTimeout=function(r,t){var i=e.schedule(t),n;r&&s();function s(){var a=Date.now(),o=i.next(2,a);if(!o[0]){n=void 0;return}var l=o[0].getTime()-a;l<1e3&&(l=o[1]?o[1].getTime()-a:1e3),l<2147483647?n=setTimeout(r,l):n=setTimeout(s,2147483647)}return{isDone:function(){return!n},clear:function(){clearTimeout(n)}}},e.setInterval=function(r,t){if(!r)return;var i=e.setTimeout(s,t),n=i.isDone();function s(){n||(r(),i=e.setTimeout(s,t))}return{isDone:function(){return i.isDone()},clear:function(){n=!0,i.clear()}}},e.date={},e.date.timezone=function(r){e.date.build=r?function(n,s,a,o,l,c){return new Date(n,s,a,o,l,c)}:function(n,s,a,o,l,c){return new Date(Date.UTC(n,s,a,o,l,c))};var t=r?"get":"getUTC",i=Date.prototype;e.date.getYear=i[t+"FullYear"],e.date.getMonth=i[t+"Month"],e.date.getDate=i[t+"Date"],e.date.getDay=i[t+"Day"],e.date.getHour=i[t+"Hours"],e.date.getMin=i[t+"Minutes"],e.date.getSec=i[t+"Seconds"],e.date.isUTC=!r},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=e.SEC*60,e.HOUR=e.MIN*60,e.DAY=e.HOUR*24,e.WEEK=e.DAY*7,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(r,t,i,n,s,a){return e.date.build(r,t!==void 0?t-1:0,i!==void 0?i:1,n||0,s||0,a||0)},e.date.nextRollover=function(r,t,i,n){var s=i.val(r),a=i.extent(r)[1];return(t||a)<=s||t>a?new Date(n.end(r).getTime()+e.SEC):n.start(r)},e.date.prev=function(r,t,i,n,s,a){var o=arguments.length;return t=o<2?11:t-1,i=o<3?e.D.extent(e.date.next(r,t+1))[1]:i,n=o<4?23:n,s=o<5?59:s,a=o<6?59:a,e.date.build(r,t,i,n,s,a)},e.date.prevRollover=function(r,t,i,n){var s=i.val(r);return t>=s||!t?n.start(n.prev(r,n.val(r)-1)):n.start(r)},e.parse={},e.parse.cron=function(r,t){var i={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},n={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(y,S,D){return isNaN(y)?i[y]||null:Math.min(+y+(S||0),D||9999)}function o(y){var S={},D;for(D in y)D!=="dc"&&D!=="d"&&(S[D]=y[D].slice(0));return S}function l(y,S,D,w,E){var x=D;for(y[S]||(y[S]=[]);x<=w;)y[S].indexOf(x)<0&&y[S].push(x),x+=E||1;y[S].sort(function(M,I){return M-I})}function c(y,S,D,w){(S.d&&!S.dc||S.dc&&S.dc.indexOf(w)<0)&&(y.push(o(S)),S=y[y.length-1]),l(S,"d",D,D),l(S,"dc",w,w)}function d(y,S,D){var w={},E={};D===1?(l(S,"D",1,3),l(S,"d",i.MON,i.FRI),l(w,"D",2,2),l(w,"d",i.TUE,i.FRI),l(E,"D",3,3),l(E,"d",i.TUE,i.FRI)):(l(S,"D",D-1,D+1),l(S,"d",i.MON,i.FRI),l(w,"D",D-1,D-1),l(w,"d",i.MON,i.THU),l(E,"D",D+1,D+1),l(E,"d",i.TUE,i.FRI)),y.exceptions.push(w),y.exceptions.push(E)}function u(y,S,D,w,E,x){var M=y.split("/"),I=+M[1],P=M[0];if(P!=="*"&&P!=="0"){var _=P.split("-");w=a(_[0],x,E),E=a(_[1],x,E)||E}l(S,D,w,E,I)}function h(y,S,D,w,E,x){var M,I,P=S.schedules,_=P[P.length-1];y==="L"&&(y=w-1),(M=a(y,x,E))!==null?l(_,D,M,M):(M=a(y.replace("W",""),x,E))!==null?d(S,_,M):(M=a(y.replace("L",""),x,E))!==null?c(P,_,M,w-1):(I=y.split("#")).length===2?(M=a(I[0],x,E),c(P,_,M,a(I[1]))):u(y,_,D,w,E,x)}function f(y){return y.indexOf("#")>-1||y.indexOf("L")>0}function g(y,S){return f(y)&&!f(S)?1:y-S}function m(y){var S={schedules:[{}],exceptions:[]},D=y.replace(/(\s)+/g," ").split(" "),w,E,x,M;for(w in s)if(E=s[w],x=D[E[0]],x&&x!=="*"&&x!=="?"){M=x.split(",").sort(g);var I,P=M.length;for(I=0;I<P;I++)h(M[I],S,w,E[1],E[2],E[3])}return S}function p(y){var S=y.toUpperCase();return n[S]||S}var v=p(r);return m(t?v:"0 "+v)},e.parse.recur=function(){var r=[],t=[],i,n=r,s,a,o,l,c,d,u,h;function f(g,m,p){if(g=l?g+"_"+l:g,i||(n.push({}),i=n[0]),i[g]||(i[g]=[]),s=i[g],o){for(a=[],u=m;u<=p;u+=o)a.push(u);h={n:g,x:o,c:s.length,m:p}}a=c?[m]:d?[p]:a;var v=a.length;for(u=0;u<v;u+=1){var y=a[u];s.indexOf(y)<0&&s.push(y)}a=o=l=c=d=0}return{schedules:r,exceptions:t,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(g){return o=g||1,this},after:function(g){return l="a",a=[g],this},before:function(g){return l="b",a=[g],this},first:function(){return c=1,this},last:function(){return d=1,this},time:function(){for(var g=0,m=a.length;g<m;g++){var p=a[g].split(":");p.length<3&&p.push(0),a[g]=+p[0]*3600+ +p[1]*60+ +p[2]}return f("t"),this},second:function(){return f("s",0,59),this},minute:function(){return f("m",0,59),this},hour:function(){return f("h",0,23),this},dayOfMonth:function(){return f("D",1,d?0:31),this},dayOfWeek:function(){return f("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return f("dc",1,d?0:5),this},dayOfYear:function(){return f("dy",1,d?0:366),this},weekOfMonth:function(){return f("wm",1,d?0:5),this},weekOfYear:function(){return f("wy",1,d?0:53),this},month:function(){return f("M",1,12),this},year:function(){return f("Y",1970,2450),this},fullDate:function(){for(var g=0,m=a.length;g<m;g++)a[g]=a[g].getTime();return f("fd"),this},customModifier:function(g,m){var p=e.modifier[g];if(!p)throw new Error("Custom modifier "+g+" not recognized!");return l=g,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(g){var m=e[g];if(!m)throw new Error("Custom time period "+g+" not recognized!");return f(g,m.extent(new Date)[0],m.extent(new Date)[1]),this},startingOn:function(g){return this.between(g,h.m)},between:function(g,m){return i[h.n]=i[h.n].splice(0,h.c),o=h.x,f(h.n,g,m),this},and:function(){return i=n[n.push({})-1],this},except:function(){return n=t,i=null,this}}},e.parse.text=function(r){var t=e.parse.recur,i=0,n="",s,a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(w,E,x,M){return{startPos:w,endPos:E,text:x,type:M}}function c(w){var E=w instanceof Array?w:[w],x=/\s+/,M,I,P,_,A,V;for(E.push(x),A=i;!M||M.type===x;){V=-1,I=n.substring(A),M=l(A,A,n.split(x)[0]);var N,B=E.length;for(N=0;N<B;N++)_=E[N],P=_.exec(I),P&&P.index===0&&P[0].length>V&&(V=P[0].length,M=l(A,A+V,I.substring(0,V),_));M.type===x&&(A=M.endPos)}return M}function d(w){var E=c(w);return i=E.endPos,E}function u(w){for(var E=+S(w),x=v(a.through)?+S(w):E,M=[],I=E;I<=x;I++)M.push(I);return M}function h(w){for(var E=u(w);v(a.and);)E=E.concat(u(w));return E}function f(w){var E,x,M,I;v(a.weekend)?w.on(o.sun,o.sat).dayOfWeek():v(a.weekday)?w.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(E=S(a.rank),w.every(E),x=p(w),v(a.start)?(E=S(a.rank),w.startingOn(E),y(x.type)):v(a.between)&&(M=S(a.rank),v(a.and)&&(I=S(a.rank),w.between(M,I))))}function g(w){v(a.first)?w.first():v(a.last)?w.last():w.on(h(a.rank)),p(w)}function m(w){i=0,n=w,s=-1;for(var E=t();i<n.length&&s<0;){var x=y([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]);switch(x.type){case a.every:f(E);break;case a.after:c(a.time).type!==void 0?(E.after(S(a.time)),E.time()):c(a.fullDate).type!==void 0?(E.after(S(a.fullDate)),E.fullDate()):(E.after(S(a.rank)),p(E));break;case a.before:c(a.time).type!==void 0?(E.before(S(a.time)),E.time()):c(a.fullDate).type!==void 0?(E.before(S(a.fullDate)),E.fullDate()):(E.before(S(a.rank)),p(E));break;case a.onthe:g(E);break;case a.on:E.on(h(a.dayName)).dayOfWeek();break;case a.of:E.on(h(a.monthName)).month();break;case a.in:E.on(h(a.yearIndex)).year();break;case a.at:for(E.on(S(a.time)).time();v(a.and);)E.on(S(a.time)).time();break;case a.and:break;case a.also:E.and();break;case a.except:E.except();break;default:s=i}}return{schedules:E.schedules,exceptions:E.exceptions,error:s}}function p(w){var E=y([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(E.type){case a.second:w.second();break;case a.minute:w.minute();break;case a.hour:w.hour();break;case a.dayOfYear:w.dayOfYear();break;case a.dayOfWeek:w.dayOfWeek();break;case a.dayInstance:w.dayOfWeekCount();break;case a.day:w.dayOfMonth();break;case a.weekOfMonth:w.weekOfMonth();break;case a.weekOfYear:w.weekOfYear();break;case a.month:w.month();break;case a.year:w.year();break;default:s=i}return E}function v(w){var E=c(w).type===w;return E&&d(w),E}function y(w){var E=d(w);return E.type?E.text=D(E.text,w):s=i,E}function S(w){return y(w).text}function D(w,E){var x=w;switch(E){case a.time:var M=w.split(/(:|am|pm)/),I=M[3]==="pm"&&M[0]<12?parseInt(M[0],10)+12:M[0],P=M[2].trim();x=(I.length===1?"0":"")+I+":"+P;break;case a.rank:x=parseInt(/^\d+/.exec(w)[0],10);break;case a.monthName:case a.dayName:x=o[w.substring(0,3)];break;case a.fullDate:x=new Date(w.toUpperCase());break}return x}return m(r.toLowerCase())},e}();$f.date.localTime();var _t=$f;function WS(e){const r=[],t=[];let i;const n=function*(){for(i||(i=e[Symbol.iterator]());r.length&&(yield*r,r.length=0),!!i;){const{value:a,done:o}=i.next();if(o){i=null,e=null;break}t.push(a),yield a}},s=function*(){for(i||(i=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!i;){const{value:a,done:o}=i.next();if(o){i=null,e=null;break}r.push(a),yield a}};return[n(),s()]}function*QP(e,r){if(r<0)throw new Error("Batch size needs to a natural number");r=r|0;const t=[];for(const i of e)t.length===r&&(yield t,t.length=0),t.push(i);t.length>0&&(yield t)}function*eI(e,r){let t=0;for(const i of e)r(i,t++)&&(yield i)}function*tI(e,r){let t=0;for(const i of e)++t>r&&(yield i)}function rI(e,r){let t=0;for(const i of e)if(!r(i,t++))return!1;return!0}function iI(e,r){let t=0;for(const i of e)if(r(i,t++))return!0;return!1}function*Jc(e,r){let t=0;for(const i of e)yield r(i,t++)}function nI(e,r,t){let i=0,n=t;for(const s of e)n=r(n,s,i++);return n}function*US(e){const r=new Set;for(const t of e)r.has(t)||(r.add(t),yield t)}function*sI(e,r){const t=new Set;for(const i of e){const n=r(i);t.has(n)||(t.add(n),yield i)}}function*aI(e,r){let t=0;for(const i of e)if(r(i,t++))yield i;else return}function*GS(...e){for(let r=0;r<e.length;r++)yield*e[r]}function*YS(e){for(const r of e)yield*r}var Ts=class{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new Ts(e)}copy(){const[e,r]=WS(this.iterable);return this.iterable=r,new Ts(e)}split(){const[e,r]=WS(this.iterable);return[new Ts(e),this.derive(r)]}inBatchesBySize(e){return this.derive(QP(this.iterable,e))}filter(e){return this.derive(eI(this.iterable,e))}drop(e){return this.derive(tI(this.iterable,e))}map(e){return this.derive(Jc(this.iterable,e))}reduce(e,r){return nI(this,e,r)}concat(){return this.derive(YS(this.iterable))}uniqueOnly(){return this.derive(US(this.iterable))}uniqueOnlyBy(e){return this.derive(sI(this.iterable,e))}every(e){return rI(this,e)}some(e){return iI(this,e)}takeWhile(e){return this.derive(aI(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new qS(this)}},oI=e=>new Ts(e),ot=oI,qS=class extends Ts{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new Ts(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let r=this.$iterator,t=e.length;for(t>0&&(yield*e);;){if(e.length>t){for(let s=t;s<e.length;s++)yield e[s];t=e.length}if(!r)break;const{value:i,done:n}=r.next();n?(r=this.$iterator=null,this.$iterable=null):(e.push(i),t++,yield i)}}else yield*e}},lI=e=>new qS(e),KS=lI,Qc=Symbol("MixinIdentity"),Mo=Symbol("MixinStateProperty"),cI=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=KS(this.linearizedByTopoLevels())}static new(e){const r=new this;return e&&Object.assign(r,e),r}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((e,r)=>e-r)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,r){let t=e.get(r);return t||(t=[],e.set(r,t)),t}buildElementsByTopoLevel(){let e=0;const r=this.baseEl?ot(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,t=ot(this.sourceEl.requirements).map(i=>i.walkDepthState.elementsByTopoLevel).concat().reduce((i,[n,s])=>(n>e&&(e=n),this.getOrCreateLevel(i,n).push(s),i),new Map);return this.getOrCreateLevel(t,e+1).push([this.sourceEl]),ot(t).map(([i,n])=>[i,ot(n).concat().uniqueOnly().filter(s=>!r.has(s)).sort((s,a)=>s.id-a.id)]).toMap()}*linearizedByTopoLevels(){yield*ot(this.topoLevels).map(e=>this.elementsByTopoLevel.get(e)).concat()}},XS=1,dI=e=>class extends e{},ed=class{},jf=class{constructor(){this.id=XS++,this.requirements=[],this.baseClass=ed,this.identitySymbol=void 0,this.mixinLambda=dI,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const r=new this;e&&Object.assign(r,e),r.walkDepthState=cI.new({sourceEl:r,baseEl:hI(r.baseClass)});const t=r.mixinLambda,i=r.identitySymbol=Symbol(t.name),n=Object.assign(function(s){const a=t(s);return a.prototype[i]=!0,a},{[Qc]:i,[Mo]:r});return Object.defineProperty(n,Symbol.hasInstance,{value:JS}),r.mixinLambda=n,r}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const r=this.constructor,t=r.baseClassesIds.get(e);if(t!==void 0)return t;const i=XS++;return r.baseClassesIds.set(e,i),i}buildMinimalClass(){const e=this.constructor;let r=this.baseClass;const t=this.walkDepthState.linearizedByTopoLevelsSource.reduce((n,s)=>{const{cls:a,hash:o}=n,l=o+String.fromCharCode(s.id);let c=e.minimalClassesByLinearHash.get(l);return c||(c=s.mixinLambda(a),s.name=c.name,e.minimalClassesByLinearHash.set(l,c)),n.cls=c,n.hash=l,n},{cls:r,hash:String.fromCharCode(this.getBaseClassMixinId(r))}).cls,i=Object.assign(t,{[Qc]:this.identitySymbol,[Mo]:this,mix:this.mixinLambda,derive:n=>G([i,n],s=>class extends s{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(i,Symbol.hasInstance,{value:JS}),i}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((e,r)=>`${r.name}(${e})`,this.baseClass.name)}};jf.minimalClassesByLinearHash=new Map,jf.baseClassesIds=new Map;var uI=e=>Object.getPrototypeOf(e.prototype).constructor.hasOwnProperty(Mo),hI=e=>Object.getPrototypeOf(e.prototype).constructor[Mo],ZS=(e,r)=>{let t;if(e.length>0){const s=e[e.length-1];!uI(s)&&s!==ed&&(t=s)}const i=[];return e.forEach((s,a)=>{const o=s[Mo];if(o!==void 0){const l=o.baseClass;if(l!==ed)if(t){if(t!==l){const c=l.prototype.isPrototypeOf(t.prototype),d=t.prototype.isPrototypeOf(l.prototype);if(!c&&!d)throw new Error("Base class mismatch");t=d?l:t}}else t=l;i.push(o)}else if(a!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),jf.new({requirements:i,mixinLambda:r,baseClass:t||ed}).minimalClass},JS=function(e){return!!(e&&e[this[Qc]])},Ft=(e,r)=>!!(e&&e[r[Qc]]),G=ZS,QS=ZS,We=class{initialize(e){e&&Object.assign(this,e)}static new(e){const r=new this;return r.initialize(e),r}},Q;(function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"})(Q||(Q={}));var be;(function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"})(be||(be={}));var je;(function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"})(je||(je={}));var zr;(function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"})(zr||(zr={}));var bi;(function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"})(bi||(bi={}));var dn;(function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"})(dn||(dn={}));var Ci;(function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"})(Ci||(Ci={}));var Ue;(function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"})(Ue||(Ue={}));var bt;(function(e){e.Start="Start",e.End="End"})(bt||(bt={}));var ft=new Date(-864e13),Qe=new Date(864e13),un=e=>{if(!e)return!1;const r=e.getTime();return r!==ft.getTime()&&r!==Qe.getTime()},Cr;(function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"})(Cr||(Cr={}));var Ct;(function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"})(Ct||(Ct={}));var Bf=class{constructor(e){this.cacheFilledStartDate=Qe,this.cacheFilledEndDate=ft,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=Q.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,r,t){e.ensureCacheFilledForInterval(r,t),this.intervalCache.includeWrappingRange(e.intervalCache,r,t)}ensureCacheFilledForInterval(e,r){const t=this.cacheFilledStartDate.getTime(),i=this.cacheFilledEndDate.getTime();if(t!==Qe.getTime()){const n=e.getTime(),s=r.getTime();if(t<=n&&s<=i)return;if(s<=t)r=new Date(t-1);else if(n>=i)e=new Date(i);else if(t<=n&&n<=i)e=new Date(i+1);else if(t<=s&&s<=i)r=new Date(t-1);else{this.ensureCacheFilledForInterval(e,new Date(t-1)),this.ensureCacheFilledForInterval(new Date(i+1),r);return}}(t===Qe.getTime()||e.getTime()<i)&&(this.cacheFilledStartDate=e),(i===ft.getTime()||i<r.getTime())&&(this.cacheFilledEndDate=r),this.fillCache(e,r)}fillCache(e,r){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=Qe,this.cacheFilledEndDate=ft,this.intervalCache.clear()}forEachAvailabilityInterval(e,r,t){var i;t=t||this;const n=e.startDate,s=e.endDate,a=n&&n.getTime(),o=s&&s.getTime(),l=(i=e.maxRange)!=null?i:this.maxRange,c=e.isForward!==!1;if(c?!n:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const d=this.intervalCache;let u=c?n:s,h=c?n:s;const f=h.getTime();for(let g=1;g<this.maxCacheExtendCycles;g++){c?this.ensureCacheFilledForInterval(u,s||b.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(n||b.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let m=d.getIntervalOf(h,c?Cr.Left:Cr.Right);for(;m;){const p=m.startDate,v=m.endDate;if(c&&o&&p.getTime()>=o||!c&&a&&v.getTime()<=a)return Ct.FullRangeIterated;if(c&&p.getTime()-f>=l||!c&&f-v.getTime()>=l)return Ct.MaxRangeReached;if(c&&p.getTime()>=this.cacheFilledEndDate.getTime()||!c&&v.getTime()<=this.cacheFilledStartDate.getTime())break;h=c?v:p;const y=a&&p.getTime()<a?n:p,S=o&&v.getTime()>o?s:v;if(r.call(t,y,S,m.cacheInterval)===!1)return Ct.StoppedByIterator;m=c?d.getNextInterval(m):d.getPrevInterval(m)}if(c&&h.getTime()===Qe.getTime()||!c&&h.getTime()===ft.getTime())return Ct.FullRangeIterated;u=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return Ct.MaxCacheExtendCyclesReached}},Ms=e=>Array.from(new Set(e)),td=class{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(this.intervals.indexOf(e)==-1){const r=this.intervals.slice();return r.push(e),new td({intervals:r,calendar:this.calendar})}else return this}combineWith(e){return new td({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const r=Ms(e);return r.sort((t,i)=>i.getPriorityField()-t.getPriorityField()),r}},Hf=class{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const r=this.intervalGroups.slice();return r.push([e.calendar,e]),new Hf({intervalGroups:r})}getIsWorkingForEvery(){if(this.isWorkingForEvery!=null)return this.isWorkingForEvery;for(let[e,r]of this.getGroups())if(!r[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(this.isWorkingForSome!=null)return this.isWorkingForSome;for(let[e,r]of this.getGroups())if(r[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[r,t]of this.getGroups())e.set(r,t[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[r,t]of this.getGroups())t[0].isWorking&&e.push(r);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[r,t]of this.getGroups())t[0].isWorking||e.push(r);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],r=new Map;return this.intervalGroups.forEach(([t,i])=>{let n=r.get(t);n||(e.push(t),n=[],r.set(t,n)),n.push.apply(n,i.intervals)}),r.forEach((t,i)=>{const n=Ms(t);n.sort((s,a)=>a.getPriorityField()-s.getPriorityField()),r.set(i,n)}),this.intervalsByCalendar=r}},Po=(e,r,t=(i,n)=>i-n)=>{let i=0,n=r.length;for(;i<n;){const s=(i+n)/2|0,a=t(e,r[s]);if(a===0)return{found:!0,index:s};a<0?n=s:i=s+1}return{found:!1,index:n}},hn;(function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"})(hn||(hn={}));var ew=class{constructor(e){this.keys=[],this.values=[],this.comparator=e||((r,t)=>r-t)}set(e,r){const t=Po(e,this.keys,this.comparator);return t.found?this.values[t.index]=r:(this.keys.splice(t.index,0,e),this.values.splice(t.index,0,r)),t.index}insertAt(e,r,t){this.keys.splice(e,0,r),this.values.splice(e,0,t)}setValueAt(e,r){this.values[e]=r}get(e){const r=Po(e,this.keys,this.comparator);return r.found?this.values[r.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const r=Po(e,this.keys,this.comparator);r.found&&this.deleteAt(r.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const r=Po(e,this.keys,this.comparator);return{found:r.found?hn.Exact:hn.Next,index:r.index}}map(e){const r=this.keys,t=this.values,i=[];for(let n=0;n<r.length;n++)i.push(e(t[n],r[n],n));return i}getAllEntries(){return this.map((e,r)=>({value:e,key:r}))}clear(){this.keys.length=0,this.values.length=0}},Vf=class{constructor(e){if(this.points=new ew((r,t)=>r.getTime()-t.getTime()),this.leftInfinityKey=ft,this.rightInfinityKey=Qe,Object.assign(this,e),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,r=Cr.Left){let{found:t,index:i}=this.indexOf(e),n;return r===Cr.Left?n=t===hn.Exact?i:i-1:n=i-1,this.getIntervalWithStartDateIndex(n)}getPrevInterval(e){return e.startDateIndex===0?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,r,t){const i=this.points,{found:n,index:s}=i.indexOfKey(e);let a,o;if(n==hn.Exact){const l=t(o=i.getValueAt(s));i.setValueAt(s,l),a=s+1}else{const l=t(o=i.getValueAt(s-1));i.insertAt(s,e,l),a=s+1}for(;a<i.size()&&!(i.getKeyAt(a).getTime()>=r.getTime());){const c=t(o=i.getValueAt(a));i.setValueAt(a,c),a++}a===i.size()?i.insertAt(i.size(),r,this.emptyInterval):i.getKeyAt(a).getTime()===r.getTime()||i.insertAt(a,r,o)}includeWrappingRange(e,r,t){let i=e.getIntervalOf(r);for(;i&&(this.addInterval(i.startDate,i.endDate,n=>this.combineIntervalsFn(n,i.cacheInterval)),!(i.endDate.getTime()>t.getTime()));)i=e.getNextInterval(i)}getSummary(){return this.points.map((e,r)=>({label:e,date:r}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}},Nf=class extends Bf{constructor(e){super(e),this.calendarCaches=Ms(this.calendarCaches),this.intervalCache=new Vf({emptyInterval:new Hf,combineIntervalsFn:(r,t)=>r.combineWith(t)})}fillCache(e,r){this.calendarCaches.forEach(t=>{t.fillCache(e,r),this.includeWrappingRangeFrom(t,e,r)})}},fI=new Map,gI=e=>{const r=Ms(e);if(r.length===0)throw new Error("No calendars to combine");r.sort((a,o)=>a.internalId<o.internalId?-1:1);const t=r.map(a=>a.internalId+"/").join(""),i=r.map(a=>a.version+"/").join("");let n=fI.get(t),s;return n&&n.versionsHash===i?s=n.cache:s=new Nf({calendarCaches:r.map(a=>a.calendarCache)}),s},tw=class extends Bf{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new Vf({emptyInterval:new td({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(r,t)=>r.combineWith(t)})}fillCache(e,r){var t;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,r);const i=e.getTime(),n=r.getTime(),s=(t=this.calendar.project)==null?void 0:t.timeZone;if(i>n)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(a=>{const o=a.getStartDateSchedule(),l=a.getEndDateSchedule();let c=o.prev(1,e),d;if(l==="EOD"){const f=o.next(1,r);f!==_t.NEVER?d=b.getStartOfNextDay(f,!0):d=_t.NEVER}else d=l.next(1,r);if(c!==_t.NEVER&&c.getTime()===i){const f=o.prev(2,e);f!==_t.NEVER&&f.length===2&&(c=f[1])}if(d!==_t.NEVER&&d.getTime()===n){const f=l.next(2,r);f!==_t.NEVER&&f.length===2&&(d=f[1])}const u=o.next(1/0,c!==_t.NEVER?c:e,d!==_t.NEVER?new Date(d.getTime()-1):r);if(u===_t.NEVER)return;const h=l==="EOD"?u.map(f=>b.getStartOfNextDay(f,!0)):l.next(1/0,new Date(u[0].getTime()+1),d!==_t.NEVER?d:r);h!==_t.NEVER&&(h.length>u.length?h.length=u.length:h.length<u.length&&(u.length=h.length),u.forEach((f,g)=>{let m=f,p=h[g];s!=null&&(m=pt.toTimeZone(m,s),p=pt.toTimeZone(p,s)),this.intervalCache.addInterval(m,p,v=>v.includeInterval(a))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(e=>{var r;const t=(r=this.calendar.project)==null?void 0:r.timeZone;let{startDate:i,endDate:n}=e;t!=null&&(i=pt.toTimeZone(i,t),n=pt.toTimeZone(n,t)),this.intervalCache.addInterval(i,n,s=>s.includeInterval(e))})}forEachStaticInterval(e){this.intervalStore.forEach(r=>{r.isStatic()&&e(r)})}forEachRecurrentInterval(e){this.intervalStore.forEach(r=>{r.isRecurrent()&&e(r)})}},Io=class extends G([],e=>{const r=e.prototype;class t extends e{async commitAsync(){return this.project.commitAsync()}set project(n){this.$project=n}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(n){return this.project=n}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const n=this.getProject();return n==null?void 0:n.assignmentStore}getDependencyStore(){const n=this.getProject();return n==null?void 0:n.dependencyStore}getEventStore(){const n=this.getProject();return n==null?void 0:n.eventStore}getResourceStore(){const n=this.getProject();return n==null?void 0:n.resourceStore}getCalendarManagerStore(){const n=this.getProject();return n==null?void 0:n.calendarManagerStore}}return t}){},zt=class extends G([Io,ee],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}construct(n={}){return n.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},r.construct.call(this,n)}trigger(n,s){const a=this,{asyncEvents:o,project:l}=a,c=o==null?void 0:o[n];return c&&(c===!0||c[s.action])?(r.trigger.call(a,`${n}PreCommit`,{...s}),!l||l.isEngineReady()&&!l.isWritingData?r.trigger.call(a,n,s):!a.eventsSuspended&&l&&(l.dataReadyDetacher||(l.queuedDataReadyEvents=[],l.dataReadyDetacher=l.ion({dataReady(){this.queuedDataReadyEvents.forEach(([u,h,f,g])=>{u.trigger.call(h,f,g)}),l.queuedDataReadyEvents=null,l.dataReadyDetacher(),l.dataReadyDetacher=null},once:!0})),l.queuedDataReadyEvents.push([r,a,n,s])),!0):r.trigger.call(a,n,s)}calculateProject(){return this.project}setStoreData(n){var s;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,r.setStoreData.call(this,n),this.isLoadingData=!1,(s=this.project)==null||s.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),r.doAutoCommit.call(this)}async addAsync(n,s){const a=this.add(n,s);return await this.project.commitAsync(),a}async insertAsync(n,s,a){const o=this.insert(n,s,a);return await this.project.commitAsync(),o}async loadDataAsync(n){this.data=n,await this.project.commitAsync()}performFilter(){var n;return this.project&&(this.isLoadingData||(n=this.rootNode)!=null&&n.isLoading)&&this.project.commitAsync().then(()=>this.filter()),super.performFilter(...arguments)}}return t}){},Ps=class extends G([Io,ae],e=>{const r=e.prototype;class t extends e{joinStore(n){let s=null;if(Ft(n,zt)){const a=n.getProject();a&&!this.getProject()&&(this.setProject(a),s=a)}r.joinStore.call(this,n),s&&!s.isRepopulatingStores&&this.joinProject()}unjoinStore(n,s=!1){r.unjoinStore.call(this,n,s);const{project:a}=this,o=Ft(n,zt)&&!n.isFillingFromMaster&&a===(n.isChained&&n.project?n.masterStore.project:n.project);a&&!a.isDestroying&&!a.isRepopulatingStores&&o&&(this.leaveProject(s),this.setProject(null)),o&&(this.graph=null)}joinProject(){}leaveProject(n=!1){}calculateProject(){const n=this.stores.find(s=>Ft(s,zt)&&!!s.getProject());return n==null?void 0:n.getProject()}async setAsync(n,s,a){var o;const l=this.set(n,s,a);return await((o=this.project)==null?void 0:o.commitAsync()),l}async getAsync(n){var s;return await((s=this.project)==null?void 0:s.commitAsync()),this.get(n)}get isStmRestoring(){const n=this.getProject();return(n==null?void 0:n.isRestoringData)||(n==null?void 0:n.stm.isRestoring)||!1}}return t}){},Ao=class extends G([Ps],e=>{const r=e.prototype;class t extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let n=1e4+this.getCalendar().getDepth()*100,s=this.priority;return s==null&&(s=this.isRecurrent()?20:30),this.priorityField=n+s}isRecurrent(){return!!(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return!!(this.startDate&&this.endDate)}parseDateSchedule(n){let s=n;if(n&&n!==Object(n)&&(s=_t.parse.text(n),s!==Object(s)||s.error>=0))try{s=JSON.parse(n)}catch(a){return null}return s}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const n=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=_t.schedule(n)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const n=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=_t.schedule(n)}}return t}){},zf=class extends G([zt],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:Ao}}}return t}){},rw=class extends G([Ao],e=>{const r=e.prototype;class t extends e{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return t}){},rd=class extends G([Io],e=>{const r=e.prototype;class t extends e{get eventStore(){var n;return(n=this.project)==null?void 0:n.eventStore}get resourceStore(){var n;return(n=this.project)==null?void 0:n.resourceStore}get assignmentStore(){var n;return(n=this.project)==null?void 0:n.assignmentStore}get dependencyStore(){var n;return(n=this.project)==null?void 0:n.dependencyStore}get calendarManagerStore(){var n;return(n=this.project)==null?void 0:n.calendarManagerStore}getEventById(n){var s;return(s=this.eventStore)==null?void 0:s.getById(n)}getDependencyById(n){var s;return(s=this.dependencyStore)==null?void 0:s.getById(n)}getResourceById(n){var s;return(s=this.resourceStore)==null?void 0:s.getById(n)}getAssignmentById(n){var s;return(s=this.assignmentStore)==null?void 0:s.getById(n)}getCalendarById(n){var s;return(s=this.calendarManagerStore)==null?void 0:s.getById(n)}}return t}){},Wf=class extends G([Ps],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return zf}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(n){n.storeClass=this.intervalStoreClass,n.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,n.calendar=this}processIntervalsStoreData(n){this.bumpVersion()}isDefault(){const n=this.getProject();return n?this===n.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(n,s,a){var o;const l=(o=this.getProject())==null?void 0:o.maxCalendarRange;return l&&(n=Object.assign({maxRange:l},n)),this.calendarCache.forEachAvailabilityInterval(n,s,a)}accumulateWorkingTime(n,s,a){var o,l;if(s===0)return{finalDate:new Date(n),remainingDurationInMs:0};if(isNaN(s))throw new Error("Invalid duration");let c=n;const d=(l=(o=this.getProject())==null?void 0:o.adjustDurationToDST)!=null?l:!1;return this.forEachAvailabilityInterval(a?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(u,h,f)=>{let g=!0;if(f.getIsWorking()){let m=h.getTime()-u.getTime();if(s<=m){if(d){const p=a?u.getTimezoneOffset()-new Date(u.getTime()+s).getTimezoneOffset():new Date(h.getTime()-s).getTimezoneOffset()-h.getTimezoneOffset();s-=p*60*1e3}c=a?new Date(u.getTime()+s):new Date(h.getTime()-s),s=0,g=!1}else{if(d){const p=u.getTimezoneOffset()-h.getTimezoneOffset();m+=p*60*1e3}c=a?h:u,s-=m}}return g}),{finalDate:new Date(c),remainingDurationInMs:s}}calculateDurationMs(n,s,a=!1){let o=0;const l=n.getTime()<=s.getTime()||!a?1:-1;l<0&&([n,s]=[s,n]);const c=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:n,endDate:s},(d,u,h)=>{if(h.getIsWorking()&&(o+=u.getTime()-d.getTime(),c)){const f=d.getTimezoneOffset()-u.getTimezoneOffset();o+=f*60*1e3}}),o*l}calculateEndDate(n,s){const a=s>=0,o=this.accumulateWorkingTime(n,Math.abs(s),a);return o.remainingDurationInMs===0?o.finalDate:null}calculateStartDate(n,s){const a=s<=0,o=this.accumulateWorkingTime(n,Math.abs(s),a);return o.remainingDurationInMs===0?o.finalDate:null}skipNonWorkingTime(n,s=!0){let a;const o=this.forEachAvailabilityInterval(s?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(l,c,d)=>{if(d.getIsWorking())return a=s?l:c,!1});return o===Ct.MaxRangeReached||o===Ct.FullRangeIterated?"empty_calendar":a?new Date(a):new Date(n)}addInterval(n){return this.addIntervals([n])}addIntervals(n){return this.bumpVersion(),this.intervalStore.add(n)}removeInterval(n){return this.removeIntervals([n])}removeIntervals(n){return this.bumpVersion(),this.intervalStore.remove(n)}clearIntervals(n){return n||this.bumpVersion(),this.intervalStore.removeAll(n)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const n=new rw({isWorking:this.unspecifiedTimeIsWorking});return n.calendar=this,this.$calendarCache=new tw({calendar:this,unspecifiedTimeInterval:n,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(n=>{n.intervalStore.forEach(s=>s.resetPriority())})}insertChild(n,s,a){let o=r.insertChild.call(this,...arguments);return Array.isArray(o)||(o=[o]),o.forEach(l=>{l.bumpVersion(),l.resetPriorityOfAllIntervals()}),o}joinProject(){r.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){r.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(n){const s=b.clearTime(n),a=b.getNext(n,Q.Day);let o=!1;return this.forEachAvailabilityInterval({startDate:s,endDate:a,isForward:!0},(l,c,d)=>(o=d.getIsWorking(),!o)),!o}getDailyHolidaysRanges(n,s){const a=[];for(n=b.clearTime(n);n<s;)this.isDayHoliday(n)&&a.push({startDate:n,endDate:b.getStartOfNextDay(n,!0,!0)}),n=b.getNext(n,Q.Day);return a}getWorkingTimeRanges(n,s){const a=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(o,l,c)=>{if(c.getIsWorking()){const d=c.intervals[0];a.push({name:d.name,startDate:o,endDate:l})}}),a}getNonWorkingTimeRanges(n,s){const a=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(o,l,c)=>{if(!c.getIsWorking()){const d=c.intervals[0];a.push({name:d.name,iconCls:d.iconCls,cls:d.cls,startDate:o,endDate:l})}}),a}isWorkingTime(n,s,a){if(a){let o;const l=this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(c,d,u)=>{if(u.getIsWorking()&&c<=n&&d>=s)return o=!0,!1});return l===Ct.MaxRangeReached||l===Ct.FullRangeIterated?!1:o}else{const o=this.skipNonWorkingTime(n);return o&&o!=="empty_calendar"?s?o<s:o.getTime()===n.getTime():!1}}}return t}){},Uf=class extends G([Ps],e=>{const r=e.prototype;class t extends e{getAssignmentFor(n){var s;for(const a of(s=this.assigned)!=null?s:[])if(a.resource===n)return a;return null}isAssignedTo(n){return!!this.getAssignmentFor(n)}async assign(n){const s=this.project.assignmentStore.modelClass;return this.addAssignment(new s({event:this,resource:n})),this.commitAsync()}async unassign(n){const s=this.getAssignmentFor(n);return this.removeAssignment(s),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const n=this.getEventStore();this.assigned.forEach(s=>n.assignmentsForRemoval.add(s))}r.leaveProject.call(this,...arguments)}remove(){if(this.parent){const n=this.getEventStore();r.remove.call(this),n&&n.afterEventRemoval()}else return r.remove.call(this)}addAssignment(n){return this.getProject().assignmentStore.add(n),n}removeAssignment(n){return this.getProject().assignmentStore.remove(n),n}}return t}){},Is=class extends G([Ps,rd,ae],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(n=!1){var s;r.leaveProject.call(this,n),(s=this.project)==null||s.bufferedCommitAsync()}invalidate(){var n;(n=this.project)==null||n.invalidate(this)}getCurrentOrProposed(n){var s;return n in this.$changed&&this.$changed[n]!==!0?this.$changed[n]:(s=this.get(n))!=null?s:null}hasCurrentOrProposed(n){return n in this.$changed&&this.$changed[n]!=!0||this.get(n)!=null}propose(n){var s;if(this.project||(s=this.recurringTimeSpan)!=null&&s.project){const a=Object.keys(n);for(let o=0;o<a.length;o++){const l=a[o];this.$changed[l]=n[l]}this.invalidate()}else this.set(n)}setChanged(n,s,a=!0,o=!1){const l=this;l.$changed[n]=s,o&&(n in l.$beforeChange||(l.$beforeChange[n]=l.get(n)),l.setData(n,s)),a&&l.invalidate()}calculateInvalidated(){}finalizeInvalidated(n=!1){const s=this;s.$isCalculating=!0,n?s.setData(s.$changed):(s.setData(s.$beforeChange),s.set(s.$changed)),s.$changed={},s.$beforeChange={},s.$isCalculating=!1}}return t}){},iw=e=>Number(e)!==e,Gf=e=>e instanceof Set||e instanceof Array?ot(e):ot([e]),nw=e=>new Promise(r=>setTimeout(r,e)),Wr=(e,...r)=>e.replace(/{(\d+)}/g,(t,i)=>typeof r[i]!="undefined"?r[i]:t),Yf=class extends G([zt],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(n,s){this.assignmentsForRemoval=Gf(n).toSet();const a=r.remove.call(this,n,s);return this.assignmentsForRemoval.clear(),a}removeAll(n){this.allAssignmentsForRemoval=!0;const s=r.removeAll.call(this,n);return this.allAssignmentsForRemoval=!1,s}}return t}){},qf=class extends G([zt],e=>{const r=e.prototype;class t extends e{doDestroy(){var n;const s=[];(n=this.rootNode)!=null&&n.isDestroyed||this.traverse(a=>s.push(a)),super.doDestroy(),s.forEach(a=>a.destroy())}}return t}){},Kf=class extends G([zt],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(n,s){this.dependenciesForRemoval=Gf(n).toSet();const a=r.remove.call(this,n,s);return this.dependenciesForRemoval.clear(),a}removeAll(n){this.allDependenciesForRemoval=!0;const s=r.removeAll.call(this,n);return this.allDependenciesForRemoval=!1,s}}return t}){},mI={splice:1,clear:1},Xf=class extends G([zt],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(n){var s;const a=mI[n.action];super.onDataChange(n),a&&((s=n.removed)!=null&&s.length)&&this.afterEventRemoval()}remove(n,s){const a=r.remove.call(this,n,s);return this.afterEventRemoval(),a}removeAll(n){const s=r.removeAll.call(this,n);return this.afterEventRemoval(),s}onNodeRemoveChild(n,s,a,o){const l=r.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),l}afterEventRemoval(){const{assignmentsForRemoval:n,dependenciesForRemoval:s}=this;if(!n)return;const a=this.getAssignmentStore();if(a&&!a.allAssignmentsForRemoval&&n.size){const l=[...n].filter(c=>!a.assignmentsForRemoval.has(c));l.length>0&&a.remove(l)}n.clear();const o=this.getDependencyStore();if(o&&!o.allDependenciesForRemoval&&s.size){const l=[...s].filter(c=>!o.dependenciesForRemoval.has(c));l.length>0&&o.remove(l)}s.clear()}processRecord(n,s=!1){var a;if(!((a=this.project)!=null&&a.isRepopulatingStores)){const o=this.getById(n.id);if(o&&o!==n&&o.assigned)for(const c of o.assigned)c.event=n}return n}}return t}){},pI={splice:1,clear:1},Zf=class extends G([zt],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(n){var s;const a=pI[n.action];super.onDataChange(n),a&&((s=n.removed)!=null&&s.length)&&this.afterResourceRemoval()}remove(n,s){const a=r.remove.call(this,n,s);return this.afterResourceRemoval(),a}removeAll(n){const s=r.removeAll.call(this,n);return this.afterResourceRemoval(),s}afterResourceRemoval(){const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval){const s=[...this.assignmentsForRemoval].filter(a=>!n.assignmentsForRemoval.has(a));s.length>0&&n.remove(s)}this.assignmentsForRemoval.clear()}processRecord(n,s=!1){const a=this.getById(n.id);if(a&&a!==n)for(const l of a.assigned||[])l.resource=n;return n}}return t}){},Ur=class extends G([Is],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var n,s;return(s=(n=this._startDate)!=null?n:this.get("startDate"))!=null?s:null}get endDate(){var n,s;return(s=(n=this._endDate)!=null?n:this.get("endDate"))!=null?s:null}get duration(){var n,s;return(s=(n=this._duration)!=null?n:this.get("duration"))!=null?s:null}set startDate(n){this.proposeStartDate(n)}set endDate(n){this.proposeEndDate(n)}set duration(n){this.proposeDuration(n)}inSet(n,s,a,o,l){const c=this;return c.project&&!c.project.isWritingData&&typeof n!="string"&&!l&&("startDate"in n&&!("startDate"in c.$changed)&&(c.$changed.startDate=!0,c.invalidate()),"endDate"in n&&!("endDate"in c.$changed)&&(c.$changed.endDate=!0,c.invalidate())),r.inSet.call(c,n,s,a,o,l)}getStartDate(){return this.startDate}proposeStartDate(n,s=!("endDate"in this.$changed)){var a;(this.inSetting||(n==null?void 0:n.getTime())!==((a=this.startDate)==null?void 0:a.getTime()))&&(this._startDate=n,this.propose({startDate:n,keepDuration:s}))}async setStartDate(n,s=!0){var a;return this.proposeStartDate(n,s),(a=this.project)==null?void 0:a.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(n,s=!1){var a;(this.inSetting||(n==null?void 0:n.getTime())!==((a=this.endDate)==null?void 0:a.getTime()))&&(this._endDate=n,this.propose({endDate:n,keepDuration:s}))}async setEndDate(n,s=!1){var a;return this.proposeEndDate(n,s),(a=this.project)==null?void 0:a.commitAsync()}getDuration(){return this.duration}proposeDuration(n,s,a=!0){this._duration=n,this.propose({duration:n,keepStart:a}),s&&this.propose({durationUnit:s})}async setDuration(n,s,a=!0){var o;return this.proposeDuration(n,s,a),(o=this.project)==null?void 0:o.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var n,s;const a=this,o=a.$changed,l=a.getCurrentOrProposed("startDate"),c=a.getCurrentOrProposed("endDate"),d=a.getCurrentOrProposed("duration");if(l!=null&&(o.startDate=a._startDate=l),c!=null&&(o.endDate=a._endDate=c),d!=null&&(o.duration=a._duration=d),a.eventStore&&!a.eventStore.isLoadingData){const u=(n=a.assignmentStore)==null?void 0:n.storage.findItem("event",null);if(u){const h=(s=a.assignmentStore)==null?void 0:s.storage.findItem("eventId",a.id);if(h)for(const f of h)f.setChanged("event",a);else for(const f of u)f.getCurrentOrProposed("event")===a.id&&f.setChanged("event",a)}}r.joinProject.call(a)}applyValue(n,s,a,o,l){var c;if((this.project||(c=this.recurringTimeSpan)!=null&&c.project)&&l){const{name:d}=l;(d==="startDate"||d=="duration"||d==="endDate")&&(n=!0,this["_"+d]=a),o&&(n=!1)}r.applyValue.call(this,n,s,a,o,l)}afterChange(n,s,a,o,l){!this.$isCalculating&&!l&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),r.afterChange.call(this,n,s,a,o,l)}calculateInvalidated(){const n=this,s=n.$changed,a="startDate"in s,o="endDate"in s,l="duration"in s,{startDate:c,endDate:d,duration:u,keepDuration:h,keepStart:f}=s;let g=null;a&&!o&&!l?c===null?s.endDate=null:n.hasCurrentOrProposed("endDate")&&c>n.getCurrentOrProposed("endDate")&&!h?(s.endDate=c,s.duration=0):n.hasCurrentOrProposed("duration")&&(h||!n.hasCurrentOrProposed("endDate"))?g="endDate":n.hasCurrentOrProposed("endDate")&&(g="duration"):!a&&o&&!l?d===null?s.startDate=null:n.hasCurrentOrProposed("startDate")&&!h&&d!==!0&&d<n.getCurrentOrProposed("startDate")?(s.startDate=d,s.duration=0):n.hasCurrentOrProposed("duration")&&(h||!n.hasCurrentOrProposed("startDate"))?g="startDate":n.hasCurrentOrProposed("startDate")&&(g="duration"):!a&&!o&&l?u===null?s.endDate=null:n.hasCurrentOrProposed("startDate")&&(f||!n.hasCurrentOrProposed("endDate"))?(f&&s.duration<0&&(s.duration=0),g="endDate"):n.hasCurrentOrProposed("endDate")&&(g="startDate"):a&&o&&!l?c===null&&d===null?s.duration=null:g="duration":a&&!o&&l?g="endDate":!a&&o&&l?g="startDate":a&&o&&l&&(u==null?g="duration":c==null?g="startDate":g="endDate");const m=n.getCurrentOrProposed("startDate"),p=n.getCurrentOrProposed("endDate"),v=n.getCurrentOrProposed("duration"),y=n.getCurrentOrProposed("durationUnit");let S,D;switch(g){case"startDate":s.startDate=b.add(p,-v,y);break;case"endDate":S=b.as("hour",v,y),D=b.as(y,S,"h"),s.endDate=b.add(m,D,y);break;case"duration":S=b.diff(m,p,"h"),s.duration=b.as(y,S,"h");break}"startDate"in s&&s.startDate!==!0&&(this._startDate=s.startDate),"endDate"in s&&s.endDate!==!0&&(this._endDate=s.endDate),"duration"in s&&s.duration!==!0&&(this._duration=s.duration),s.startDate===!0&&delete s.startDate,s.endDate===!0&&delete s.endDate,delete s.keepDuration,delete s.keepStart}}return t}){},As=class extends G([Is],e=>{const r=e.prototype;class t extends e{get assigned(){var n;return(n=this.project)==null?void 0:n.assignmentStore.getResourcesAssignments(this)}joinProject(){var n;this.resourceStore&&!this.resourceStore.isLoadingData&&((n=this.assignmentStore)==null||n.query(s=>s.get("resource")===this.id).forEach(s=>s.setChanged("resource",this))),r.joinProject.call(this)}leaveProject(n=!1){var s;if(this.assigned&&!n&&!((s=this.resourceStore)!=null&&s.isLoadingData)){const a=this.resourceStore;this.assigned.forEach(o=>a.assignmentsForRemoval.add(o))}r.leaveProject.call(this)}applyValue(n,s,a,o,l){(l==null?void 0:l.name)==="id"&&this.assigned.forEach(c=>{c.set("resourceId",a)}),r.applyValue.call(this,n,s,a,o,l)}}return t}){};function id(e){return e!=null&&e.isModel?e.id:e}var nd=class extends G([Is],e=>{const r=e.prototype;class t extends e{static get fields(){return[{name:"resource",isEqual:(n,s)=>n===s,persist:!1},{name:"event",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){const{assignmentStore:o,eventStore:l,resourceStore:c,project:d}=this;let u=!1;if(n==="event"){const h=Ft(s,Ur)?s:l==null?void 0:l.$master.getById(s);h&&(u=!0),s=h||s}if(n==="resource"){const h=Ft(s,As)?s:c==null?void 0:c.$master.getById(s);h&&(u=!0),s=h||s}r.setChanged.call(this,n,s,a,!0),o&&u&&!d.isPerformingCommit&&!o.isLoadingData&&!c.isLoadingData&&!o.skipInvalidateIndices&&o.invalidateIndices()}joinProject(){r.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var n,s;let{event:a=this.event,resource:o=this.resource}=this.$changed;if(a!==null&&!Ft(a,Ur)){const l=(n=this.eventStore)==null?void 0:n.getById(a);l&&this.setChanged("event",l,!1)}if(o!==null&&!Ft(o,As)){const l=(s=this.resourceStore)==null?void 0:s.getById(o);l&&this.setChanged("resource",l,!1)}}finalizeInvalidated(n){const s=this.$changed;"resource"in s&&(s.resourceId=id(s.resource)),"event"in s&&(s.eventId=id(s.event)),r.finalizeInvalidated.call(this,n)}set event(n){this.setChanged("event",n),this.setChanged("eventId",id(n))}get event(){const n=this.get("event");return(n==null?void 0:n.id)!=null?n:null}set resource(n){this.setChanged("resource",n),this.setChanged("resourceId",id(n))}get resource(){const n=this.get("resource");return(n==null?void 0:n.id)!=null?n:null}}return t}){},_s=class extends G([zt,rd,ee],e=>{const r=e.prototype;class t extends e{setProject(n){const s=r.setProject.call(this,n);return n&&this.joinProject(n),s}joinProject(n){}onCommitAsync(){}}return t}){},sw=new Set,Jf=class extends G([Yf,_s],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:nd,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(n){this.allAssignmentsForRemoval=!0,super.data=n,this.allAssignmentsForRemoval=!1}getEventsAssignments(n){return this.storage.findItem("event",n,!0)||sw}getResourcesAssignments(n){return this.storage.findItem("resource",n.$original,!0)||sw}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(n,s){n=n.masterStore||n;const a=this.count&&this.storage.findItem(s,null,!0);if(a){for(const o of a){const l=n.getById(o.getCurrentOrProposed(s));l&&o.setChanged(s,l)}this.invalidateIndices()}}unlinkAssignments(n){this.forEach(s=>{var a,o,l;return s.setChanged(n,(l=(o=(a=s[n])==null?void 0:a.id)!=null?o:s==null?void 0:s.getData(n))!=null?l:s[n+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},Qf=class extends G([Wf,Is],e=>{const r=e.prototype;class t extends e{}return t}){},aw=class extends G([qf,_s],e=>{const r=e.prototype;class t extends e{static get defaultConfig(){return{tree:!0,modelClass:Qf}}}return t}){},sd=class extends G([Is],e=>{const r=e.prototype;class t extends e{static get fields(){return[{name:"fromEvent",isEqual:(n,s)=>n===s,persist:!1},{name:"toEvent",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){var o,l,c;let d=!1;if(n==="fromEvent"||n==="toEvent"){const u=Ft(s,Ur)?s:(o=this.eventStore)==null?void 0:o.getById(s);u&&(d=!0),s=u||s}r.setChanged.call(this,n,s,a,!0),d&&!this.project.isPerformingCommit&&!((l=this.dependencyStore)!=null&&l.isLoadingData)&&((c=this.dependencyStore)==null||c.invalidateIndices())}joinProject(){r.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var n,s;let{fromEvent:a,toEvent:o}=this.$changed;if(a!==null&&!Ft(a,Ur)){const l=(n=this.eventStore)==null?void 0:n.getById(a);l&&(this.$changed.fromEvent=l)}if(o!==null&&!Ft(o,Ur)){const l=(s=this.eventStore)==null?void 0:s.getById(o);l&&(this.$changed.toEvent=l)}}set fromEvent(n){this.setChanged("fromEvent",n)}get fromEvent(){const n=this.get("fromEvent");return(n==null?void 0:n.id)!=null?n:null}set toEvent(n){this.setChanged("toEvent",n)}get toEvent(){const n=this.get("toEvent");return(n==null?void 0:n.id)!=null?n:null}}return t}){},ow=new Set,eg=class extends G([Kf,_s],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:sd,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(n){return this.storage.findItem("toEvent",n)||ow}getOutgoingDepsForEvent(n){return this.storage.findItem("fromEvent",n)||ow}set data(n){this.allDependenciesForRemoval=!0,super.data=n,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},lw=class extends G([Ur,Uf],e=>{const r=e.prototype;class t extends e{get assigned(){var n,s;return(s=(n=this.project)==null?void 0:n.assignmentStore.getEventsAssignments(this))!=null?s:this.$cachedAssignments}leaveProject(n=!1){this.$cachedAssignments=this.assigned,super.leaveProject(n)}applyValue(n,s,a,o,l){var c;s==="id"&&((c=this.assigned)==null||c.forEach(d=>d.set("eventId",a))),r.applyValue.call(this,n,s,a,o,l)}copy(n=null,s=null){const a=r.copy.call(this,n,s);return(T.isObject(s)&&!s.skipFieldIdentifiers||!T.isObject(s))&&(a.$cachedAssignments=this.assigned),a}}return t}){},cw=class extends G([Ur],e=>{const r=e.prototype;class t extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const n=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),this.incomingDeps&&this.incomingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),r.leaveProject.call(this)}}return t}){},ad=class extends G([Ur,lw,cw],e=>{const r=e.prototype;class t extends e{}return t}){},tg=class extends G([Xf,_s],e=>{const r=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:ad}}joinProject(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"event")}afterLoadData(){var n;this.afterEventRemoval(),(n=this.assignmentStore)==null||n.linkAssignments(this,"event")}}return t}){},rg=class extends G([Zf,_s],e=>{const r=e.prototype;class t extends e{static get defaultConfig(){return{modelClass:As}}joinProject(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"resource")}afterLoadData(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"resource")}clear(n){var s;r.clear.call(this,n),(s=this.assignmentStore)==null||s.unlinkAssignments("resource")}}return t}){},vI=class extends G([],Ae){},yI=class extends G([],ge){},dw=class extends G([vI,yI,ae],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(n={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const s="silenceInitialCommit"in n?n.silenceInitialCommit:!0,a="adjustDurationToDST"in n?n.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in n?n.maxCalendarRange:15768e7,delete n.maxCalendarRange,delete n.silenceInitialCommit,delete n.adjustDurationToDST,r.construct.call(this,n),this.silenceInitialCommit=s,this.adjustDurationToDST=a}repopulateStore(n){}repopulateReplica(){}deferUntilRepopulationIfNeeded(n,s,a){s(...a)}attachStore(n){}detachStore(n){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return t}){},uw=class extends G([],ge){},hw=class extends G([dw,rd,uw,ae],e=>{const r=e.prototype;class t extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:ad,assignmentModelClass:nd,resourceModelClass:As,dependencyModelClass:sd,calendarModelClass:Qf,eventStoreClass:tg,assignmentStoreClass:Jf,resourceStoreClass:rg,dependencyStoreClass:eg,calendarManagerStoreClass:aw,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(n={}){var s;const a=this;if(a.$invalidated=new Set,a.isPerformingCommit=!1,a.silenceInitialCommit=!0,a.ongoing=Promise.resolve(),n.eventStore&&!n.assignmentStore){const f=n.eventStore.masterStore||n.eventStore,g=f.assignmentStore||((s=f.crudManager)==null?void 0:s.assignmentStore);g!=null&&g.isAssignmentStore&&(n.assignmentStore=g,a.isSharingAssignmentStore=!0)}r.construct.call(a,n),a.defaultCalendar=new a.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:a.unspecifiedTimeIsWorking}),a.defaultCalendar.project=a;const{calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:d,assignmentsData:u}=a;!!(o||l||c||d||u)?(a.loadInlineData({calendarsData:o,eventsData:l,dependenciesData:c,resourcesData:d,assignmentsData:u}),delete a.calendarsData,delete a.eventsData,delete a.dependenciesData,delete a.resourcesData,delete a.assignmentsData):a.bufferedCommitAsync()}doDestroy(){var n,s,a,o,l,c;const d=this;(n=d.eventStore)==null||n.destroy(),(s=d.dependencyStore)==null||s.destroy(),(a=d.assignmentStore)==null||a.destroy(),(o=d.resourceStore)==null||o.destroy(),(l=d.calendarManagerStore)==null||l.destroy(),d.defaultCalendar.destroy(),(c=d.stm)==null||c.destroy(),r.doDestroy.call(this)}async loadInlineData(n){const s=this;s.isLoadingInlineData=!0,n.calendarsData&&(s.calendarManagerStore.data=n.calendarsData),n.resourcesData&&(s.resourceStore.data=n.resourcesData),n.assignmentsData&&(s.assignmentStore.data=n.assignmentsData),n.eventsData&&(s.eventStore.data=n.eventsData),n.tasksData&&(s.eventStore.data=n.tasksData),n.dependenciesData&&(s.dependencyStore.data=n.dependenciesData),await s.commitLoad(),s.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(n){const s=a=>{a.setProject(this),a.joinProject()};n.rootNode?n.rootNode.traverse(s):n.forEach(s)}unJoinStoreRecords(n){const s=a=>{a.leaveProject(),a.setProject(this)};n.rootNode?n.rootNode.traverse(a=>{a!==n.rootNode&&s(a)}):n.forEach(s)}resolveStoreAndModelClass(n,s){const a=(s==null?void 0:s.storeClass)||this[`${n}StoreClass`];let o=s==null?void 0:s.modelClass;return o||(this.getDefaultConfiguration()[`${n}ModelClass`]!==a.getDefaultConfiguration().modelClass?o=a.getDefaultConfiguration().modelClass:o=this[`${n}ModelClass`]),{storeClass:a,modelClass:o}}setEventStore(n){this.eventStore=n}changeEventStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),n instanceof ee)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("event",n);n=new l(T.assign({modelClass:c,project:a,stm:o},n))}if(s&&o.hasStore(s)){o.removeStore(s),a.unJoinStoreRecords(s);const{assignmentsForRemoval:l}=s;l.forEach(c=>{const d=c.event;if(d){const u=n.getById(d.id);u&&(c.event=u,l.delete(c))}}),s.afterEventRemoval()}return n.setProject(a),n}updateEventStore(n,s){this.attachStore(n),this.trigger("eventStoreChange",{store:n})}setAssignmentStore(n){this.assignmentStore=n}changeAssignmentStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),s&&o.hasStore(s)&&(o.removeStore(s),a.unJoinStoreRecords(s)),n instanceof ee)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("assignment",n);n=new l(T.assign({modelClass:c,project:a,stm:o},n))}return n.setProject(a),n}updateAssignmentStore(n,s){this.attachStore(n),this.trigger("assignmentStoreChange",{store:n})}setResourceStore(n){this.resourceStore=n}changeResourceStore(n,s){const a=this,{stm:o}=a;if(a.detachStore(s),n instanceof ee)n.project=a,o.addStore(n),a.joinStoreRecords(n);else{const{storeClass:l,modelClass:c}=a.resolveStoreAndModelClass("resource",n);n=new l(T.assign({modelClass:c,project:a,stm:o},n))}if(s&&o.hasStore(s)){o.removeStore(s),a.unJoinStoreRecords(s);const{assignmentsForRemoval:l}=s;l.forEach(c=>{const d=c.resource;if(d){const u=n.getById(d.id);u&&(c.resource=u,l.delete(c))}}),s.afterResourceRemoval()}return n.setProject(a),n}updateResourceStore(n,s){this.attachStore(n),this.trigger("resourceStoreChange",{store:n})}setDependencyStore(n){this.dependencyStore=n}changeDependencyStore(n,s){const a=this;if(a.detachStore(s),n instanceof ee)n.project=a,a.stm.addStore(n),a.joinStoreRecords(n);else{const{storeClass:o,modelClass:l}=a.resolveStoreAndModelClass("dependency",n);n=new o(T.assign({modelClass:l,project:a,stm:a.stm},n))}return n}updateDependencyStore(n,s){this.attachStore(n),this.trigger("dependencyStoreChange",{store:n})}setCalendarManagerStore(n){this.calendarManagerStore=n}changeCalendarManagerStore(n,s){const a=this;if(a.detachStore(s),n instanceof ee)a.stm.addStore(n);else{const o=(n==null?void 0:n.storeClass)||a.calendarManagerStoreClass,l=(n==null?void 0:n.modelClass)||o.getDefaultConfiguration().modelClass||a.calendarModelClass;n=new o(T.assign({modelClass:l,project:a,stm:a.stm},n))}return n.setProject(a),n}updateCalendarManagerStore(n,s){this.attachStore(n),this.trigger("calendarManagerStoreChange",{store:n})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(n){this.$calendar=n}get effectiveCalendar(){return this.calendar}async addEvent(n){return this.eventStore.add(n),this.commitAsync()}async addAssignment(n){return this.assignmentStore.add(n),this.commitAsync()}async addResource(n){return this.resourceStore.add(n),this.commitAsync()}async addDependency(n){return this.dependencyStore.add(n),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const n=this;if(n.isPerformingCommit=!0,n.unScheduleAutoCommit(),await nw(0),!n.isDestroyed){for(const c of n.$invalidated)c.calculateInvalidated();const{isInitialCommit:s,silenceInitialCommit:a}=n,o=s&&a;n.assignmentStore.onCommitAsync(),n.dependencyStore.onCommitAsync(),n.isInitialCommitPerformed=!0,n.hasLoadedDataToCommit=!1,n.isPerformingCommit=!1;const l=[n.assignmentStore,n.dependencyStore,n.eventStore,n.resourceStore,n.calendarManagerStore];if(l.forEach(c=>{var d;return(d=c.suspendAutoCommit)==null?void 0:d.call(c)}),n.isWritingData=!0,n.trigger("refresh",{isInitialCommit:s,isCalculated:!0}),o)for(const c of n.$invalidated)c.finalizeInvalidated(!0);else{for(const c of n.$invalidated)c.beginBatch(!0),c.finalizeInvalidated();for(const c of n.$invalidated)c.endBatch(!1,!0)}return n.isWritingData=!1,n.$invalidated.clear(),n.trigger("dataReady"),l.forEach(c=>{var d;return(d=c.resumeAutoCommit)==null?void 0:d.call(c)}),n.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(n){this.$invalidated.add(n),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(n){n=this.$stm=new Xn(T.assign({disabled:!0},n)),n.ion({restoringStop:async()=>{n.disable(),await this.commitAsync(),this.isDestroyed||(n.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return t.applyConfigs=!0,t}){},ig=class extends cr{constructor(){super(...arguments),R(this,"compositeField",!0)}static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,r){const t=e[this.field],i=r[this.field];return t-i}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...r)=>e.call(this,...r)}get defaultEditor(){const{max:e,min:r,step:t,largeStep:i}=this;return T.cleanupProperties({type:"duration",name:this.field,max:e,min:r,step:t,largeStep:i})}get durationUnitField(){return`${this.field}Unit`}roundValue(e){const r=typeof this.grid.durationDisplayPrecision=="number"?this.grid.durationDisplayPrecision:this.decimalPrecision,t=Math.pow(10,r);return Math.round(e*t)/t}formatValue(e,r){return e instanceof Le&&(r=e.unit,e=e.magnitude),e=this.roundValue(e),e+" "+b.getLocalizedNameOfUnit(r,e!==1)}defaultRenderer({record:e,isExport:r}){const t=e[this.field],i=typeof t,n=i==="number"?t:t==null?void 0:t.magnitude,s=i==="number"?e[this.durationUnitField]:t==null?void 0:t.unit;return typeof n!="number"?r?"":null:this.formatValue(n,s)}toClipboardString({record:e}){return e[this.field].toString()}fromClipboardString({string:e,record:r}){const t=b.parseDuration(e,!0,this.durationUnit);return t&&"magnitude"in t?t:r.fullDuration}calculateFillValue({value:e,record:r}){return this.fromClipboardString({string:e,record:r})}};De.registerColumnType(ig),ig._$name="DurationColumn";var ng=class extends pe{static get $name(){return"ResourceCollapseColumn"}static get type(){return"resourceCollapse"}static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e})=>({tag:"i",class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":e.eventLayout!=="none"}})}}onCellClick({record:e,event:r}){r.preventDefault(),e.eventLayout=e.eventLayout!=="none"?"none":"stack"}};De.registerColumnType(ng),ng._$name="ResourceCollapseColumn";var sg=class extends pe{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:re.isTestEnv?!1:"text"}}construct(...e){super.construct(...e),this.avatarRendering=new gs({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){const r=this.grid.resourceImagePath||"",t=r.split("//"),i=t.length>1?t[1]:r,n=L.joinPaths([i||"",e||""]);return t.length>1?t[0]+"//"+n:n}template(e,r){const t=this,{showImage:i,showRole:n,showMeta:s,showEventCount:a,grid:o}=t,{timeAxis:l,resourceImageExtension:c="",defaultResourceImageName:d}=o,u=typeof n=="string"?n:"role",h=a&&e.eventStore.getEvents({includeOccurrences:o.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length;let f;if(i&&e.image!==!1)if(e.imageUrl)f=e.imageUrl;else{const g=typeof i=="string"?i:e.image||r&&t.useNameAsImageName&&r.toLowerCase()+c||d||"";f=g&&t.getImageURL(g),f&&!g.includes(".")&&(!t.validNames||t.validNames.includes(g))&&(f+=c)}return{class:"b-resource-info",children:[i&&t.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:f,defaultImageUrl:d&&this.getImageURL(d)}),n||a||s?{tag:"dl",children:[{tag:"dt",text:r},n?{tag:"dd",class:"b-resource-role",text:e[u]}:null,a?{tag:"dd",class:"b-resource-events",html:t.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:t.showMeta(e)}:null]}:r]}}defaultRenderer({grid:e,record:r,cellElement:t,value:i,isExport:n}){let s;return r.isSpecialRow?s="":n?s=i:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?t.style.fontSize=e.rowHeight/40+"em":t.style.fontSize="",s=this.template(r,i)),s}};De.registerColumnType(sg),sg._$name="ResourceInfoColumn";function bI(e,r){return e===r.length-1}function CI(e,r){return r===e.cells[e.cells.length-1]}var _o=class extends ${constructor(){super(...arguments),R(this,"startDate",null),R(this,"endDate",null),R(this,"levels",[]),R(this,"size",null)}set range({startDate:e,endDate:r}){const t=this;(t.startDate-e||t.endDate-r)&&(t.startDate=e,t.endDate=r,t.refresh())}buildCells(e=this.startDate,r=this.endDate){var t;const i=this,{sizeProperty:n}=i,{stickyHeaders:s,isVertical:a}=i.client||{},o=[],{length:l}=i.levels,c=i.levels.map((d,u)=>{var h;const f=s&&(a||u<l-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${d.position}`]:1,"b-sch-header-row-main":u===i.model.viewPreset.mainHeaderLevel,"b-lowest":bI(u,i.levels),"b-sticky-header":f},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${u}`,headerPosition:d.position},children:(h=d.cells)==null?void 0:h.filter(g=>g.start<r&&g.end>e).map((g,m)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[g.headerCellCls]:g.headerCellCls,[`b-align-${g.align}`]:g.align,"b-last":CI(d,g)},dataset:{tickIndex:g.index,...globalThis.DEBUG&&{date:g.start.getTime()}},style:{[i.positionProperty]:g.coord,[n]:g.width,[`min-${n}`]:g.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":f},html:g.value}]}))}});return(t=i.client)==null||t.getHeaderDomConfigs(o),c.push(...o),{className:i.widgetClassList,syncOptions:{releaseThreshold:0},children:c}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const r=this,{columnConfig:t}=r.model,{levels:i}=r,n=i.length;if(e){i.length=0,t.forEach((a,o)=>i[o]={position:o,cells:a}),r.size=i[0].cells.reduce((a,o)=>a+o.width,0);const{parentElement:s}=r.element;s&&(i.length!==n||e)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${n}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${i.length}`))}!r.startDate||!r.endDate||(q.sync({domConfig:r.buildCells(),targetElement:r.element,syncIdField:"headerFeature"}),r.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}};R(_o,"$name","TimeAxisBase"),R(_o,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),_o._$name="TimeAxisBase";var Fs=class extends _o{get positionProperty(){var e;return(e=this.owner)!=null&&e.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),e==null||e.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}};R(Fs,"$name","HorizontalTimeAxis"),R(Fs,"type","horizontaltimeaxis"),R(Fs,"configurable",{model:null,sizeProperty:"width"}),Fs._$name="HorizontalTimeAxis";var ks=class extends ${constructor(){super(...arguments),R(this,"firstResource",-1),R(this,"lastResource",-1)}construct(e){const r=this;e.scheduler._resourceColumns=r,super.construct(e),r.imagePath!=null&&r.element.classList.add("b-has-images"),j.on({element:r.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:r})}changeShowAvatars(e){var r;return(r=this.avatarRendering)==null||r.destroy(),e&&(this.avatarRendering=new gs({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const r=this;r.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:r}),e.count&&r.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const r=this;r.getConfig("fillWidth"),r.getConfig("fitWidth"),r.updateWidthCache();const{element:t}=r,i=r.totalWidth;r.scheduler.variableColumnWidths?r._fillWidth=r._fitWidth=!1:(r._fillWidth=r.configuredFillWidth,r._fitWidth=r.configuredFitWidth),i!==r.width&&(C.setLength(t,"width",i),r.column.set("width",i,r.column.grid.isConfiguring)),e==="removeall"&&(t.innerHTML=""),(e==="remove"||e==="add"||e==="filter"||r.fitWidth||r.fillWidth)&&r.refreshWidths(),r.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:r}=this;return r.variableColumnWidths=!1,r.resourceStore.forEach(t=>{t.instanceMeta(r).insetStart=e,t.instanceMeta(r).insetEnd=e+(t.columnWidth||r.resourceColumnWidth),t.columnWidth==null?e+=r.resourceColumnWidth:(e+=t.columnWidth,r.variableColumnWidths=!0)}),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,r){const t=this;t.refreshingWidths||t.refreshWidths(),t.isConfiguring||(t.resourceStore.isGrouped&&t.updateWidthCache(),t.refresh(),t.trigger("columnWidthChange",{width:e,oldWidth:r}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return L.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const r=this,{availableWidth:t,configuredColumnWidth:i}=r,n=(e=r.resourceStore)==null?void 0:e.count;if(!t||!n||r.scheduler.variableColumnWidths)return;r.refreshingWidths=!0;const s=r.fitWidth||r.fillWidth&&i*n<t,a=s?Math.floor(t/n):i,o=r.column.grid.enableEventAnimations&&Math.abs(r._columnWidth-a)>30;C.addTemporaryClass(r.element,"b-animating",o?300:0,r),r.columnWidth=a,r.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:r}){this.firstResource=e,this.lastResource=r,this.updateWidthCache(),this.refresh()}refresh(){var e;const r=this,{firstResource:t,scheduler:i,resourceStore:n,lastResource:s}=r,{variableColumnWidths:a}=i,o=n.isGrouped&&n.groupers[0].field,l=[];if(r.element.classList.toggle("b-grouped",!!o),!r.column.grid.isConfiguring&&t>-1&&s>-1&&s<n.count){let c;for(let d=t;d<=s;d++){const u=n.allResourceRecords[d],h=u.instanceMeta(n).groupParent,f=h==null?void 0:h.groupChildren;if(o&&h.id!==(c==null?void 0:c.dataset.resourceId)){const y=f[0].instanceMeta(i).insetStart,S=f[f.length-1].instanceMeta(i).insetEnd-y;c={className:"b-resourceheader-group-cell",dataset:{resourceId:h.id},style:{left:y,width:S},children:[{tag:"span",html:L.encodeHtml(f[0][o])},{className:"b-resourceheader-group-children",children:[]}]},l.push(c)}const g=u.instanceMeta(i),m=u.columnWidth||r.columnWidth,p=o?g.insetStart-c.style.left:a?g.insetStart:d*r.columnWidth,v={className:new J({"b-resourceheader-cell":1}),dataset:{resourceId:u.id},style:{[i.rtl?"right":"left"]:p,width:m},children:[]};if(r.headerRenderer){const y=r.headerRenderer({elementConfig:v,resourceRecord:u});y!=null&&(v.html=y)}else{let y;if(u.imageUrl)y=u.imageUrl;else if(r.imagePath!=null&&u.image!==!1){const S=u.image||((e=u.name)==null?void 0:e.toLowerCase())+r.imageExtension;y=r.getImageURL(S)}v.children.push(r.showAvatars&&r.avatarRendering.getResourceAvatar({resourceRecord:u,initials:u.initials,color:u.eventColor,iconCls:u.iconCls,defaultImageUrl:r.defaultImageName&&r.getImageURL(r.defaultImageName),imageUrl:y}),{tag:"span",className:"b-resource-name",html:L.encodeHtml(u.name)})}o?c.children[1].children.push(v):l.push(v)}}q.sync({domConfig:{onlyChildren:!0,children:l},targetElement:r.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const r=e.target.closest(".b-resourceheader-cell"),t=this.resourceStore.getById(r.dataset.resourceId);this.trigger("resourceHeader"+L.capitalize(e.type),{resourceRecord:t,event:e})}getCurrentConfig(e){const r=super.getCurrentConfig(e);return delete r.resourceStore,delete r.column,delete r.type,r}};R(ks,"$name","ResourceHeader"),R(ks,"type","resourceheader"),R(ks,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),ks._$name="ResourceHeader";var od=class extends Ae(Nr){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const r=this;super.construct(...arguments),r.thisObj=r,r.timeAxisViewModel=r.grid.timeAxisViewModel,r.mode=r.mode,r.grid.ion({paint:"onTimelinePaint",thisObj:r,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,r;(e=this.resourceColumns)==null||e.destroy(),(r=this.timeAxisView)==null||r.destroy(),super.doDestroy()}set mode(e){const r=this,{grid:t}=r;r.set("mode",e),e==="horizontal"?r.timeAxisView=new Fs({model:r.timeAxisViewModel,compactCellWidthThreshold:r.compactCellWidthThreshold,owner:t,client:t}):e==="vertical"&&(r.resourceColumns=ks.new({column:r,scheduler:t,resourceStore:t.resourceStore,imagePath:t.resourceImagePath,imageExtension:t.resourceImageExtension,defaultImageName:t.defaultResourceImageName},t.resourceColumns||{}),r.relayEvents(r.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const r=this;r.grid.timeAxisSubGrid.collapsed||(r.mode==="horizontal"?(r.refreshHeader(!0),r.width=e.totalSize,r.grid.refresh(),r.subGrid.refreshFakeScroll()):r.mode==="vertical"&&r.grid.refreshRows())}onTimelinePaint({firstPaint:e}){var r;const t=this;t.subGrid.insertRowsBefore&&e&&(t.subGridElement.classList.add("b-timeline-subgrid"),t.mode==="vertical"&&(t.refreshHeader(),(r=t.grid)==null||r.onHeightChange()))}refreshHeader(e){const r=this,{element:t}=r;t&&(r.mode==="horizontal"?(!e&&r.timeAxisViewModel.update(void 0,void 0,!0),r.timeAxisView.rendered?r.timeAxisView.refresh(!0):(t.innerHTML="",r.timeAxisView.render(t))):r.mode==="vertical"&&(r.resourceColumns.currentElement||(t.innerHTML="",r.resourceColumns.render(t))))}internalRenderer(e){const{grid:r}=this;if(r.project.isInitialCommitPerformed||r.project.isDelayingCalculation)return r.currentOrientation.renderer(e),super.internalRenderer(e)}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const r=this;r.detachListeners("tavm"),e==null||e.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:r}),r._timeAxisViewModel=e,r.timeAxisView&&(r.timeAxisView.model=e)}getState(){const e=super.getState();return delete e.width,delete e.flex,e}};R(od,"$name","TimeAxisColumn"),De.registerColumnType(od),od._$name="TimeAxisColumn";var fw=class extends _o{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:r}=e,t=r==null?void 0:r.stickyHeaders,i=[],n=e.levels.reduce((s,a,o)=>{var l;return a.cells&&s.push(...(l=a.cells)==null?void 0:l.filter(c=>c.start<e.endDate&&c.end>e.startDate).map((c,d,u)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[c.headerCellCls]:c.headerCellCls,[`b-align-${c.align}`]:c.align,"b-last":d===u.length-1,"b-lowest":o===e.levels.length-1},dataset:{tickIndex:c.index,cellId:`${o}-${c.index}`,headerPosition:o,...globalThis.DEBUG&&{date:c.start.getTime()}},style:{top:c.coord,height:c.width,minHeight:c.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":t},html:c.value}]}))),s},[]);return r==null||r.getHeaderDomConfigs(i),n.push(...i),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:n}}get height(){return this.size}};fw._$name="VerticalTimeAxis";var ld=class extends pe{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1}}get isFocusable(){return!1}construct(e){super.construct(...arguments),this.view=new fw({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:e,size:r}){this.view.render(e),r.height=this.view.height}getCurrentConfig(e){const r=super.getCurrentConfig(e);return delete r.id,delete r.region,delete r.type,delete r.field,delete r.ariaLabel,delete r.cellAriaLabel,r}};R(ld,"$name","VerticalTimeAxisColumn"),De.registerColumnType(ld),ld._$name="VerticalTimeAxisColumn";var gw=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,i,n){const s=[],{storeId:a}=t,o=this.crudLoadValidationMandatoryStores,l={[a]:{}};return i?i.rows||(s.push(`- "${a}" store section should have a "rows" property with an array of the store records.`),l[a].rows=["..."]):o!=null&&o.includes(a)&&(s.push(`- No "${a}" store section found. It should contain the store data.`),l[a].rows=["..."]),s.length&&Object.assign(n,l),s}getLoadResponseWarnings(t){const i=[],n={};return this.skipSuccessProperty||(n.success=!0),this.forEachCrudStore((s,a,o)=>{i.push(...this.getStoreLoadResponseWarnings(o,t==null?void 0:t[a],n))}),i.length&&(i.push(`Please adjust your response to look like this:
`+JSON.stringify(n,null,4).replace(/"\.\.\."/g,"...")),i.push(this.disableValidationNote)),i}validateLoadResponse(t){const i=this.getLoadResponseWarnings(t);i.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+i.join(`
`))}getStoreSyncResponseWarnings(t,i,n,s){const a=[],o=[],l=[],{storeId:c}=t,d={[c]:{}},u=t.phantomIdField||this.phantomIdField,{modelClass:h}=t.store,{idField:f}=h,g=(n==null?void 0:n.rows)||[],m=(n==null?void 0:n.removed)||[];let p=!1;if(i!=null&&i.added&&(o.push(...i.added.filter(v=>!g.find(y=>y[u]==v[u])&&!m.find(y=>y[u]==v[u]||y[f]==v[u])).map(v=>({[u]:v[u],[f]:"..."}))),o.length)){const v=o.map(y=>"#"+y[u]).join(", ");a.push(`- "${c}" store "rows" section should mention added record(s) ${v} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!o.length&&n&&((typeof n!="object"||Array.isArray(n))&&(a.push(`- "${c}" store section should be an Object.`),d[c]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(a.push(`- "${c}" store "rows" section should be an array`),o.push("...")),n.removed&&!Array.isArray(n.removed)&&(a.push(`- "${c}" store "removed" section should be an array:`),l.push("...")));else{if(i!=null&&i.updated){const v=i.updated.filter(y=>!g.find(S=>S[f]==y[f])).map(y=>({[f]:y[f]}));if(o.push(...v),v.length){const y=v.map(S=>"#"+S[f]).join(", ");a.push(`- "${c}" store "rows" section should mention updated record(s) ${y} sent in the request. It should contain the updated record identifiers.`),p=!0}}if(o.length&&o.push("..."),i!=null&&i.removed&&(l.push(...i.removed.filter(v=>!g.find(y=>y[f]==v[f])).map(v=>({[f]:v[f]}))),l.length)){const v=l.map(y=>"#"+y[f]).join(", ");a.push(`- "${c}" store "removed" section should mention removed record(s) ${v} sent in the request. It should contain the removed record identifiers.`),d[c].removed=l,l.push("..."),p=!0}}return o.length&&(d[c].rows=o),a.length||delete d[c],Object.assign(s,d),{messages:a,showSupportShortSyncResponseNote:p}}getSyncResponseWarnings(t,i){const n=[],s={},a=i.pack;this.skipSuccessProperty||(s.success=!0);let o=!1;return this.forEachCrudStore((l,c,d)=>{const u=this.getStoreSyncResponseWarnings(d,a==null?void 0:a[c],t[c],s);o=o||u.showSupportShortSyncResponseNote,n.push(...u.messages)}),n.length&&(n.push(`Please adjust your response to look like this:
`+JSON.stringify(s,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&n.push(this.supportShortSyncResponseNote),n.push(this.disableValidationNote)),n}validateSyncResponse(t,i){const n=this.getSyncResponseWarnings(t,i);n.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+n.join(`
`))}},SI=class extends Error{},mw=class extends SI{constructor(e={}){var r,t;super(e.message||e.request&&L.capitalize((r=e.request)==null?void 0:r.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=(t=this.request)==null?void 0:t.type}},pw=function(e,r,t){return e.store&&(e=e.store),r.store&&(r=r.store),e=e[t]||0,r=r[t]||0,e<r?-1:e>r?1:0},wI=function(e,r){return pw(e,r,"loadPriority")},DI=function(e,r){return pw(e,r,"syncPriority")},ag=e=>{var r;e.$$meta=e.$meta;const t=[];return e.isEvents||t.push(Ae),e.isDelayable||t.push(ge),t.push(gw),r=class extends(e||F).mixin(...t){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(i={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(i)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var i,n;return(n=(i=this.transport)==null?void 0:i.load)==null?void 0:n.url}updateLoadUrl(i){T.setPath(this,"transport.load.url",i)}get syncUrl(){var i,n;return(n=(i=this.transport)==null?void 0:i.sync)==null?void 0:n.url}updateSyncUrl(i){T.setPath(this,"transport.sync.url",i)}getStoreDescriptor(i){return i?i instanceof ee?this.crudStores.find(n=>n.store===i):typeof i=="object"?this.crudStoresIndex[i.storeId]:this.crudStoresIndex[i]||this.getStoreDescriptor(ee.getStore(i)):null}fillStoreDescriptor(i){const{store:n}=i,{storeIdProperty:s=this.storeIdProperty,modelClass:a}=n;return i.storeId||(i.storeId=n[s]||n.id),i.idField||(i.idField=a.idField),i.phantomIdField||(i.phantomIdField=a.phantomIdField),i.phantomParentIdField||(i.phantomParentIdField=a.phantomParentIdField),"writeAllFields"in i||(i.writeAllFields=n.writeAllFields),i}updateCrudStoreIndex(){const i=this.crudStoresIndex={};this.crudStores.forEach(n=>n.storeId&&(i[n.storeId]=n))}getCrudStore(i){const n=this.getStoreDescriptor(i);return n==null?void 0:n.store}forEachCrudStore(i,n=this){if(!i)throw new Error("Iterator function must be provided");this.crudStores.every(s=>i.call(n,s.store,s.storeId,s)!==!1)}set crudStores(i){this._crudStores=[],this.addCrudStore(i);for(const n of this._crudStores)n.loadPriority=n.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(i){return this._orderedCrudStores=i}set syncApplySequence(i){this._syncApplySequence=[],this.addStoreToApplySequence(i)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(i){const n=this;let s;return i instanceof ee?s={store:i}:typeof i=="object"?(i.store||(i={storeId:i.id,store:new ee(i)}),s=i):s={store:ee.getStore(i)},n.fillStoreDescriptor(s),i=s.store,i.setCrudManager?i.setCrudManager(n):i.crudManager=n,i.pageSize=null,(n.loadUrl||n.syncUrl)&&(i.autoCommit=!1,i.autoLoad=!1,(i.createUrl||i.updateUrl||i.deleteUrl||i.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),n.bindCrudStoreListeners(i),s}addCrudStore(i,n,s){if(i=H.asArray(i),!(i!=null&&i.length))return;const a=this,o=i.map(a.internalAddCrudStore,a);typeof n=="undefined"?a.crudStores.push(...o):(s&&((s instanceof ee||typeof s!="object")&&(s=a.getStoreDescriptor(s)),n+=a.crudStores.indexOf(s)),a.crudStores.splice(n,0,...o)),a.orderedCrudStores.push(...o),a.updateCrudStoreIndex()}addPrioritizedStore(i){const n=this;n.hasCrudStore(i)||n.addCrudStore(i,H.findInsertionIndex(i,n.crudStores,wI)),n.hasApplySequenceStore(i)||n.addStoreToApplySequence(i,H.findInsertionIndex(i,n.syncApplySequence,DI))}hasCrudStore(i){var n;return(n=this.crudStores)==null?void 0:n.some(s=>s===i||s.store===i||s.storeId===i)}removeCrudStore(i){const n=this,s=n.crudStores,a=s.find(o=>o===i||o.store===i||o.storeId===i);if(a)n.unbindCrudStoreListeners(a.store),delete n.crudStoresIndex[a.storeId],H.remove(s,a),n.syncApplySequence&&n.removeStoreFromApplySequence(i);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(i){i.ion({name:i.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(i){this.detachListeners(i.id)}addStoreToApplySequence(i,n,s){if(!i)return;i=H.asArray(i);const a=this,o=i.reduce((c,d)=>{const u=a.getStoreDescriptor(d);return u&&c.push(u),c},[]);if(typeof n=="undefined")a.syncApplySequence.push(...o);else{let c=n;s&&((s instanceof ee||typeof s!="object")&&(s=a.getStoreDescriptor(s)),c+=a.syncApplySequence.indexOf(s)),a.syncApplySequence.splice(c,0,...o)}const l=a.syncApplySequence.map(({storeId:c})=>c);a.orderedCrudStores=[...a.syncApplySequence],a.crudStores.forEach(c=>{l.includes(c.storeId)||a.orderedCrudStores.push(c)})}removeStoreFromApplySequence(i){const n=this.syncApplySequence.findIndex(s=>s===i||s.store===i||s.storeId===i);n>-1&&(this.syncApplySequence.splice(n,1),this.orderedCrudStores.splice(n,1))}hasApplySequenceStore(i){return this.syncApplySequence.some(n=>n===i||n.store===i||n.storeId===i)}onCrudStoreDestroy({source:i}){this.removeCrudStore(i)}onCrudStoreChange(i){const n=this;n.crudIgnoreUpdates||(n.crudStoreHasChanges(i==null?void 0:i.source)?(n.trigger("hasChanges"),n.autoSync&&n.scheduleAutoSync()):n.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(i=!0){const n=this;n.autoSyncSuspendCounter--,n.autoSyncSuspendCounter<=0&&(n.autoSyncSuspendCounter=0,i&&n.autoSync&&n.crudStoreHasChanges()&&n.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const i=this;!i.hasTimeout("autoSync")&&!i.isAutoSyncSuspended&&i.setTimeout({name:"autoSync",fn:()=>{i.sync().catch(n=>{})},delay:i.autoSyncTimeout})}async triggerFailedRequestEvents(i,n,s,a){const{options:o,type:l}=i;this.trigger("requestFail",{requestType:l,response:n,responseText:s,responseOptions:a}),this.trigger(l+"Fail",{response:n,responseOptions:a,responseText:s,options:o})}async internalOnResponse(i,n,s){const a=this,o=n?a.decode(n):null,{options:l,type:c}=i;if(n&&!o&&console.error("Failed to parse response: "+n),!o||(a.skipSuccessProperty?o.success===!1:!o.success))a.triggerFailedRequestEvents(i,o,n,s);else if(a.trigger("beforeResponseApply",{requestType:c,response:o})!==!1&&a.trigger(`before${L.capitalize(c)}Apply`,{response:o,options:l})!==!1){if(a.crudRevision=o.revision,await a.applyResponse(i,o,l),a.isDestroyed)return;a.trigger("requestDone",{requestType:c,response:o,responseOptions:s}),a.trigger(c,{response:o,responseOptions:s,options:l}),(c==="load"||!a.crudStoreHasChanges())&&(a.trigger("noChanges"),c==="load"&&a.emitCrudStoreEvents(i.pack.stores,"afterRequest"))}return o}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(i){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!i&&this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(i){return i?this.isCrudStoreDirty(this.getCrudStore(i)):this.crudStores.some(n=>this.isCrudStoreDirty(n.store))}isCrudStoreDirty(i){return!!i.changes}doAutoLoad(){return this.load().catch(i=>{})}emitCrudStoreEvents(i,n,s){const a={action:"read"+n,...s};for(const o of this.crudStores)i.includes(o.storeId)&&o.store.trigger(n,a)}getLoadPackage(i){const n={type:"load",requestId:this.requestId},s=this.crudStores,a=Object.assign({},i);return delete a.request,n.stores=s.map(o=>{var l;const c=a==null?void 0:a[o.storeId],d=o.pageSize||((l=o.store)==null?void 0:l.pageSize);if(c||d){const u=Object.assign({storeId:o.storeId,page:1},c);return d&&(u.pageSize=d),o.currentPage=u.page,c&&delete a[o.storeId],u}return o.storeId}),Object.assign(n,a),n}loadCrudStore(i,n,s){const a=n==null?void 0:n.rows;s!=null&&s.append||n!=null&&n.append?i.add(a):i.data=a,i.trigger("load",{data:a})}loadDataToCrudStore(i,n,s){const a=i.store,o=n==null?void 0:n.rows;a.__loading=!0,o&&this.loadCrudStore(a,n,s,i),a.__loading=!1}loadCrudManagerData(i,n={}){this.suspendChangesTracking(),this.crudStores.forEach(s=>{const a=s.storeId,o=i[a];o&&this.loadDataToCrudStore(s,o,n[a])}),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(i){typeof i=="string"&&(i={request:{url:i}});const n=this,s=n.getLoadPackage(i);return n._autoLoadPromise=null,new Promise((a,o)=>{if(n.trigger("beforeLoad",{pack:s})!==!1){const{load:l}=n.activeRequests;l&&(n.cancelRequest(l.desc,l.reject),n.trigger("loadCanceled",{pack:s}));const c=U.assign({id:s.requestId,data:n.encode(s),type:"load",success:n.onCrudRequestSuccess,failure:n.onCrudRequestFailure,thisObj:n},i==null?void 0:i.request);n.activeRequests.load={type:"load",options:i,pack:s,resolve:a,reject(...d){c.success=c.failure=null,o(...d)},id:s.requestId,desc:n.sendRequest(c)},n.emitCrudStoreEvents(s.stores,"loadStart"),n.trigger("loadStart",{pack:s})}else n.trigger("loadCanceled",{pack:s}),o({cancelled:!0})})}getActiveCrudManagerRequest(i){let n=this.activeRequests[i];return!n&&this.trackResponseType&&(n=Object.values(this.activeRequests)[0]),n}prepareAddedRecordData(i,n){const s=this,{store:a}=n,{isTree:o}=a,l=n.phantomIdField||s.phantomIdField,c=n.phantomParentIdField||s.phantomParentIdField,d=a.modelClass.allFields.filter(f=>f.subStore),u=i.constructor,h=Object.assign(i.persistableData,{[l]:i.id});if(o){const{parent:f}=i;f&&!f.isRoot&&f.isPhantom&&(h[c]=f.id)}return s.resetIdsBeforeSync&&T.deletePath(h,u.idField),d.forEach(f=>{const g=i.get(f.name);g.allCount&&(h[f.dataSource]={added:g.getRange().map(m=>s.prepareAddedRecordData(m,{store:g}))})}),h}prepareAdded(i,n){return i.filter(s=>s.isValid).map(s=>this.prepareAddedRecordData(s,n))}prepareUpdated(i,n){const{store:s}=n,{isTree:a}=s,o=n.writeAllFields||n.writeAllFields!==!1&&this.writeAllFields,l=n.phantomParentIdField||this.phantomParentIdField,c=s.modelClass.allFields.filter(d=>d.subStore);if(n.store.tree){const d=n.store.rootNode;i=i.filter(u=>u!==d)}return i.filter(d=>d.isValid).reduce((d,u)=>{let h;if(o?h=u.persistableData:h=u.modificationDataToWrite,a){const{parent:f}=u;f&&!f.isRoot&&f.isPhantom&&(h[l]=f.id)}return c.forEach(f=>{const g=u.get(f.name);h[f.dataSource]=this.getCrudStoreChanges({store:g})}),T.isEmpty(h)||d.push(h),d},[])}prepareRemoved(i){return i.map(n=>{const s=n.constructor;return T.setPath({},s.idField,n.id)})}getCrudStoreChanges(i){const{store:n}=i;let{added:s=[],modified:a=[],removed:o=[]}=n.changes||{},l;return s.length&&(s=this.prepareAdded(s,i)),a.length&&(a=this.prepareUpdated(a,i)),o.length&&(o=this.prepareRemoved(o)),(s.length||a.length||o.length)&&(l={},s.length&&(l.added=s),a.length&&(l.updated=a),o.length&&(l.removed=o)),l}getChangesetPackage(){const{changes:i}=this;return i||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...i}:null}get changes(){const i={};return this.crudStores.forEach(n=>{const s=this.getCrudStoreChanges(n);s&&(i[n.storeId]=s)}),Object.keys(i).length>0?i:null}getRowsToApplyChangesTo({store:i,storeId:n},s,a){var o,l;const c=this,{modelClass:d}=i,u=d.idField,{updated:h,removed:f}=a||{};let g,m,p;if(s){p=!0;const v={};g=((o=s.rows)==null?void 0:o.slice())||[],m=((l=s.removed)==null?void 0:l.slice())||[],[...g,...m].forEach(y=>{const S=T.getPath(y,u);v[S]=!0}),c.supportShortSyncResponse&&(h==null||h.forEach(y=>{const S=T.getPath(y,u);v[S]||g.push({[u]:S})}),f==null||f.forEach(y=>{const S=T.getPath(y,u);v[S]||m.push({[u]:S})}))}else(h||f)&&(p=!1,g=h,m=f);return g=g!=null&&g.length?g:null,m=m!=null&&m.length?m:null,{rows:g,removed:m,remote:p}}applyChangesToStore(i,n,s){var a;const o=this,l=i.phantomIdField||o.phantomIdField,{store:c}=i,d=c.modelClass.getFieldDataSource("id"),u=c.modelClass.allFields.filter(S=>S.subStore),{rows:h,removed:f,remote:g}=o.getRowsToApplyChangesTo(i,n,s),m=[],p=[];if(h)for(const S of h)c.getById((a=S[l])!=null?a:S[d])?p.push(S):m.push(S);const v=[];p.length&&u.length&&p.forEach(S=>{var D,w,E;const x=c.getById((D=S[l])!=null?D:S[d]),M=((w=s.added)==null?void 0:w.find(P=>P[l]==S[l]))||((E=s.updated)==null?void 0:E.find(P=>P[d]==S[d])),I={};u.forEach(P=>{const _=x.get(P.name);o.applyChangesToStore({store:_},S[P.dataSource],M==null?void 0:M[P.dataSource]),I[P.dataSource]="foo",delete S[P.dataSource]}),v.push([x,I])});const y=c.applyChangeset({removed:f,added:m,updated:p},null,l,g,!0);return v.forEach(([S,D])=>Object.assign(y.get(S.id),D)),y}applySyncResponse(i,n){var s;const a=this,o=a.orderedCrudStores;a.applyingChangeset=a.applyingSyncResponse=!0,a.suspendChangesTracking();for(const l of o)a.applyChangesToStore(l,i[l.storeId],(s=n==null?void 0:n.pack)==null?void 0:s[l.storeId]);a.resumeChangesTracking(!0),a.applyingChangeset=a.applyingSyncResponse=!1}applyLoadResponse(i,n){this.applyingLoadResponse=!0,this.loadCrudManagerData(i,n),this.applyingLoadResponse=!1}async applyResponse(i,n,s){const a=this;switch(a.trackResponseType&&n.type||i.type){case"load":a.validateResponse&&a.validateLoadResponse(n),a.applyLoadResponse(n,s);break;case"sync":a.validateResponse&&a.validateSyncResponse(n,i),a.applySyncResponse(n,i);break}}applyChangeset(i,n=null,s,a=!1){const o=this,l=a?new Map:void 0;o.suspendAutoSync(),o.suspendChangesTracking();for(const{store:c,phantomIdField:d}of o.orderedCrudStores)if(i[c.id]){const u=c.applyChangeset(i[c.id],n,d||o.phantomIdField,!0,a);u&&l.set(c.id,u)}return o.resumeChangesTracking(!0),o.resumeAutoSync(!1),l}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const i=this;return i.clearTimeout("autoSync"),i.activeRequests.sync?(i.trigger("syncDelayed"),i.activeSyncPromise=i.activeSyncPromise.finally(()=>i.sync())):i.activeSyncPromise=new Promise((n,s)=>{const a=i.getChangesetPackage();if(!a){n(null);return}i.trigger("beforeSync",{pack:a})!==!1?(i.trigger("syncStart",{pack:a}),i.activeRequests.sync={type:"sync",pack:a,resolve:n,reject:s,id:a.requestId,desc:i.sendRequest({id:a.requestId,data:i.encode(a),type:"sync",success:i.onCrudRequestSuccess,failure:i.onCrudRequestFailure,thisObj:i})}):(i.trigger("syncCanceled",{pack:a}),s({cancelled:!0}))}).catch(n=>{if(n&&!n.cancelled)throw n;return n})}async onCrudRequestSuccess(i,n,s){const a=this,{type:o,id:l}=s;if(a.isDestroyed)return;let c="";s=a.activeRequests[o];try{c=await i.text()}catch(u){}if(a.isDestroyed)return;if((s==null?void 0:s.id)!==l)throw new Error(`Interleaved ${o} operation detected`);a.activeRequests[o]=null;const d=await a.internalOnResponse(s,c,n);if(!a.isDestroyed){if(!d||(a.skipSuccessProperty?(d==null?void 0:d.success)===!1:!(d!=null&&d.success))){const u={rawResponse:i,response:d,request:s};d!=null&&d.message&&(u.message=d.message),s.reject(new mw(u))}a["crud"+L.capitalize(s.type)+"ed"]=!0,s.resolve({response:d,rawResponse:i,responseText:c,request:s})}}async onCrudRequestFailure(i,n,s){var a;const o=this;if(o.isDestroyed)return;s=o.activeRequests[s.type];const l=(a=n==null?void 0:n.abortController)==null?void 0:a.signal;if(!!!(l!=null&&l.aborted)){let d,u="";try{u=await i.text(),d=o.decode(u)}catch(h){}if(o.isDestroyed||(o.triggerFailedRequestEvents(s,d,u,n),o.isDestroyed))return;s.reject(new mw({rawResponse:i,request:s}))}o.activeRequests[s.type]=null}acceptChanges(){this.crudStores.forEach(i=>i.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:i}=this.eventStore;this.orderedCrudStores.forEach(({store:n})=>(!n.isAssignmentStore||!i)&&n.revertChanges())}doDestroy(){const i=this,{load:n,sync:s}=i.activeRequests;for(n&&i.cancelRequest(n.desc,n.reject),s&&i.cancelRequest(s.desc,s.reject);i.crudStores.length>0;)i.removeCrudStore(i.crudStores[0]);super.doDestroy&&super.doDestroy()}},R(r,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),R(r,"delayable",{doAutoLoad:"raf"}),r},og=class extends F.mixin(ag){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return L.safeJsonStringify(this)}set json(e){typeof e=="string"&&(e=L.safeJsonParse(e)),this.forEachCrudStore(r=>{const t=`${r.storeId}Data`;e[t]&&(r.data=e[t])})}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore((r,t)=>e[`${t}Data`]=r.toJSON()),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}};og._$name="AbstractCrudManager";var lg=e=>class Cx extends(e||F){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,i){var n;(n=t.abort)==null||n.call(t),this.isDestroying||i({cancelled:!0})}shouldUseBodyForRequestData(t,i,n){return!(i==="HEAD"||i==="GET")&&!n}sendRequest(t){const i=this,{data:n}=t,s=i.transport[t.type]||{},a=U.assign({},s,s.requestConfig);t.url&&(a.url=t.url),a.method=a.method||Cx.defaultMethod[t.type],a.params=U.assign(a.params||{},t.params);let{paramName:o}=a;if(i.shouldUseBodyForRequestData(s,a.method,o)?(a.body=n,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(o=o||"data",a.params[o]=n),!a.url)throw new Error("Trying to request without URL specified");delete a.requestConfig,delete a.paramName;let l,c;function d(){a.queryParams=a.params,delete a.params;let h=!1;const f=U.assign({},a,a.fetchOptions);return l=mr.fetch(a.url,f),l.catch(g=>{var m,p;l.done=!0,(m=i.trigger)==null||m.call(i,"responseReceived",{success:!1});const v=(p=f.abortController)==null?void 0:p.signal;return v&&(h=v.aborted,h||console.warn(g)),{error:g,cancelled:h}}).then(g=>{var m;l.done=!0,(m=i.trigger)==null||m.call(i,"responseReceived",{success:!!(g!=null&&g.ok)});const p=g!=null&&g.ok?t.success:t.failure;return p==null?void 0:p.call(t.thisObj||i,g,f,t)})}const u=i.trigger("beforeSend",{params:a.params,requestType:t.type,requestConfig:a,config:t});return U.isPromise(u)?c=u.then(d):c=d(),c.abort=()=>{var h;l.done||(h=l.abort)==null||h.call(l)},c}},cg=e=>class extends(e||F){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(t){var i;return t=Object.assign({},(i=this.encoder)==null?void 0:i.requestData,t),L.safeJsonStringify(t)}decode(t){return L.safeJsonParse(t)}},vw=e=>{var r;return r=class extends e.mixin(Wh){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:t,project:i}=this;this.loadMask&&(t||i).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:t}=this;t&&(this.masked=It.mergeConfigs(this.loadMaskDefaults,t))}bindCrudManager(t){this.detachListeners("crudManager"),t==null||t.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",thisObj:this})}onCrudManagerBeforeSend({params:t}){var i;(i=this.applyStartEndParameters)==null||i.call(this,t)}onCrudManagerLoadStart(){var t;this.applyLoadMask(),(t=this.toggleEmptyText)==null||t.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){var t;(t=this.suspendRefresh)==null||t.call(this)}onCrudManagerApplyResponse(){var t;(t=this.resumeRefresh)==null||t.call(this,!0)}onCrudManagerRequestFinalize(t=!0,i,n){var s;const a=this;t?(s=a.toggleEmptyText)==null||s.call(a):(a.masked||a.applyLoadMask(),a.applyMaskError(`<div class="b-grid-load-failure">
                    <div class="b-grid-load-fail">${a.L(`L{GridBase.${i}FailedMessage}`)}</div>
                    ${n&&n.message?`<div class="b-grid-load-fail">${a.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}
                </div>`))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:t,response:i}){this.onCrudManagerRequestFinalize(!1,t,i)}onAjaxTransportResponseReceived(){const t=this;t.clearMaskDelay!=null?t.setTimeout(()=>t.masked=null,t.clearMaskDelay):t.masked=null}get widgetClass(){}},R(r,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),r},Gr=e=>class extends(e||F){static get $name(){return"PartOfProject"}},dg=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...i){t=t||{};const{fieldMap:n}=this,s=n.eventId.dataSource,a=n.resourceId.dataSource,o=n.event.dataSource,l=n.resource.dataSource,c=t[s],d=t[a],u=t[o],h=t[l];c!=null?t[o]=c:u!=null&&(t[s]=u.isModel?u.id:u),d!=null?t[l]=d:h!=null&&(t[a]=h.isModel?h.id:h),super.construct(t,...i)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,i){let n,s;return t?n=t.isModel?t.id:t:n=this.internalId,i?s=i.isModel?i.id:i:s=this.internalId,`${n}-${s}`}buildIndexKey({event:t,resource:i}){return this.buildEventResourceKey(t,i)}set(t,i,...n){var s,a;const o=this.fieldToKeys(t,i);return"resource"in o?((s=o.resource)==null?void 0:s.id)!==void 0&&(o.resourceId=o.resource.id):"resourceId"in o&&this.constructor.isProAssignmentModel&&(o.resource=o.resourceId),"event"in o?((a=o.event)==null?void 0:a.id)!==void 0&&(o.eventId=o.event.id):"eventId"in o&&this.constructor.isProAssignmentModel&&(o.event=o.eventId),super.set(o,null,...n)}afterChange(t,i,n,s,a){var o,l;const c=this;return!c.constructor.isProAssignmentModel&&(i!=null&&i.resourceId)&&((o=c.resource)==null?void 0:o.id)!==i.resourceId.value?c.resource=i.resourceId.value:c.constructor.isProAssignmentModel&&((l=c.project)!=null&&l.propagatingSyncChanges)&&(i!=null&&i.eventId)&&!(i!=null&&i.event)&&(t.event.value===i.eventId.value||t.event.value.id===i.eventId.value)&&(delete i.eventId,delete c.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:i}=this;i!=null&&i.isModel&&i.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var t,i;return(i=(t=this.resource)==null?void 0:t.id)!=null?i:this.get("resourceId")}set eventId(t){const{event:i}=this;i!=null&&i.isModel&&i.id===t?this.set("eventId",t):this.event=t}get eventId(){var t,i;return(i=(t=this.event)==null?void 0:t.id)!=null?i:this.get("eventId")}get eventName(){var t;return(t=this.event)==null?void 0:t.name}get resourceName(){var t;return(t=this.resource)==null?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var t;const{event:i,resource:n,unjoinedStores:s,assignmentStore:a}=this,o=a==null?void 0:a.crudManager;let l;return a?l=this.isValid&&i.isPersistable&&(o||!i.hasGeneratedId&&!n.hasGeneratedId):l=!this.isPhantom&&!!s[0],l&&super.isPersistable&&!((t=this.event)!=null&&t.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,i,n){var s,a;if(!super.shouldRecordFieldChange(t,i,n))return!1;if(t==="event"||t==="eventId"){const o=(s=this.project)==null?void 0:s.eventStore;if(o&&o.oldIdMap[i]===o.getById(n))return!1}if(t==="resource"||t==="resourceId"){const o=(a=this.project)==null?void 0:a.resourceStore;if(o&&o.oldIdMap[i]===o.getById(n))return!1}return!0}},EI=nd,Fo=class extends dg(Gr(EI.derive(ae))){static get $name(){return"AssignmentModel"}};Fo.exposeProperties(),Fo._$name="AssignmentModel";var xI=e=>class extends e{static get $name(){return"PartOfBaseProject"}get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},ug=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(t,...i){var n;t=H.asArray(t);for(let s=0;s<t.length;s++){let a=t[s];if(a instanceof ae||(t[s]=a=this.createRecord(a)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",a.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${a.eventId} to resource: ${a.resourceId}`);(n=a.event)!=null&&n.isCreating&&(a.isCreating=!0)}return super.add(t,...i)}includesAssignment(t,i){return this.storage.findIndex("eventResourceKey",`${t}-${i}`,!0)!==-1}setStoreData(t){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,i){if(!t||!(i!=null&&i.isOccurrence))return t;const n=this;return{id:`${i.id}:a${t.id}`,event:i,resource:t.resource,eventId:i.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(s){return n.occurrenceInstanceMeta(this,s)}}}occurrenceInstanceMeta(t,i){const n=this,s=i.id||i,{id:a}=t;let{occurrenceMeta:o}=n;return o||(o=n.occurrenceMeta={}),o[a]||(o[a]={}),o[a][s]||(o[a][s]={})}mapAssignmentsForEvent(t,i,n){t=this.eventStore.getById(t);const s=!!i,a=!!n;return s||a?t.assignments.reduce((o,l)=>{const c=s?i(l):l;return(!a||n(c))&&o.push(c),o},[]):t.assignments}mapAssignmentsForResource(t,i,n){t=this.resourceStore.getById(t);const s=!!i,a=!!n;return s||a?t.assignments.reduce((o,l)=>{const c=s?i(l):l;return(!a||n(c))&&o.push(c),o},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){return t=this.resourceStore.getById(t),t==null?void 0:t.events}assignEventToResource(t,i,n=null,s=!1){var a,o;const l=this,c=s?new Set(t.assignments):null;if(i=H.asArray(i).map(u=>{var h;return(h=u.$original)!=null?h:u}),(a=l.eventStore)!=null&&a.usesSingleAssignment){if((o=t.assignments)!=null&&o.length)return l.isEventAssignedToResource(t,i[0])||(t.resource=i[0]),[];t.resourceId=i[0].id}let d=[];return l.suspendAutoCommit(),i.forEach(u=>{var h;const f=l.getAssignmentForEventAndResource(t,u);if(f)s&&c.delete(f);else{const g={event:t,resource:u};d.push((h=n==null?void 0:n(g))!=null?h:g)}}),d=l.add(d),s&&l.remove(Array.from(c)),l.resumeAutoCommit(),d}unassignEventFromResource(t,i){const n=this,s=[];if(!i)return n.removeAssignmentsForEvent(t);i=H.asArray(i);for(let a=0;a<i.length;a++)n.isEventAssignedToResource(t,i[a])&&s.push(n.getAssignmentForEventAndResource(t,i[a]));return n.remove(s)}isEventAssignedToResource(t,i){return!!this.getAssignmentForEventAndResource(t,i)}getAssignmentForEventAndResource(t,i){let n;return!(t=this.eventStore.getById(t))||!(n=t.assignments)||!(i=this.resourceStore.$master.getById(i))?null:this.getOccurrence(n.find(s=>{var a;return((a=s.resource)==null?void 0:a.$original)===i.$original}),t)}},RI=Gr(Jf.derive(ut)),ko=class extends ug(RI){static get defaultConfig(){return{modelClass:Fo}}};R(ko,"$name","AssignmentStore"),ko._$name="AssignmentStore";var hg=e=>class extends(e||F){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:i,value:n}){super.onRecordIdChange({record:t,oldValue:i,value:n}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:i}){return this.query(n=>this.eventStore.isDateRangeAvailable(t,i,null,n))}},fg=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,i)=>(i.event&&t.push(i.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){t.forEach(i=>{i.resource=this})}getEvents(){return re.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const i=t.split(" "),n=i[0][0],s=i.length>1?i[i.length-1][0]:"";return n+s}isWorkingTime(t){var i,n;const s=this.effectiveCalendar||((i=this.project)==null?void 0:i.calendar);return!s||((n=s.isWorkingTime)==null?void 0:n.call(s,t))}},TI=As,Os=class extends fg(Gr(TI.derive(pi))){};R(Os,"$name","ResourceModel"),Os.exposeProperties(),Os._$name="ResourceModel";var MI=Gr(rg.derive(ut)),cd=class extends hg(MI){static get defaultConfig(){return{modelClass:Os}}};cd._$name="ResourceStore";var gg=e=>class extends(e||F){static get $name(){return"EventStoreMixin"}construct(t){super.construct(t),this.autoTree=!0}set filtersFunction(t){super.filtersFunction=t}get filtersFunction(){const t=super.filtersFunction;return t&&t!==Te.returnTrue?i=>i.isCreating||t(i):t}getEventCounts(t){const i=this,{filtersFunction:n,added:s}=i,a=i.getEvents({...t,storeFilterFn:i.isFiltered?i.reapplyFilterOnAdd?n:o=>s.includes(o)?i.indexOf(o)>-1:n(o):null,dateMap:t.dateMap||!0});return a.forEach((o,l)=>a.set(l,o.length)),a}forEachScheduledEvent(t,i=this){this.forEach(n=>{const{startDate:s,endDate:a}=n;if(s&&a)return t.call(i,n,s,a)})}getTotalTimeSpan(){let t=new Date(9999,0,1),i=new Date(0);return this.forEach(n=>{n.startDate&&(t=b.min(n.startDate,t)),n.endDate&&(i=b.max(n.endDate,i))}),t=t<new Date(9999,0,1)?t:null,i=i>new Date(0)?i:null,this.lastTotalTimeSpan={startDate:t||null,endDate:i||t||null}}isEventPersistable(t){return t.isPersistable}isDateRangeAvailable(t,i,n,s){if(s.data.generatedParent)return!1;const a=new Set(this.getEventsForResource(s));if(n!=null&&n.isAssignment&&n.event.resources.forEach(c=>{c.id!==n.resourceId&&this.getEventsForResource(c).forEach(d=>a.add(d))}),n){const o=n.isAssignment?n.event:n;a.delete(o)}return!Array.from(a).some(o=>o.isScheduled&&b.intersectSpans(t,i,o.startDate,o.endDate))}filterEventsForResource(t,i,n=this){return t.getEvents(this).filter(i.bind(n))}getResourcesForEvent(t){return t.isOccurrence&&(t=t.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(t)}getEventsForResource(t){return this.assignmentStore.getEventsForResource(t)}getAssignmentsForEvent(t){return this.assignmentStore.getAssignmentsForEvent(t)||[]}getAssignmentsForResource(t){return this.assignmentStore.getAssignmentsForResource(t)||[]}assignEventToResource(t,i,n=!1){return this.assignmentStore.assignEventToResource(t,i,void 0,n)}unassignEventFromResource(t,i){this.assignmentStore.unassignEventFromResource(t,i)}reassignEventFromResourceToResource(t,i,n){const s=this,a=ae.asId(n),o=s.assignmentStore.getAssignmentForEventAndResource(t,i);o?o.resourceId=a:s.assignmentStore.assignEventToResource(t,n)}isEventAssignedToResource(t,i){return this.assignmentStore.isEventAssignedToResource(t,i)}removeAssignmentsForEvent(t){this.assignmentStore.removeAssignmentsForEvent(t)}removeAssignmentsForResource(t){this.assignmentStore.removeAssignmentsForResource(t)}},PI=()=>!0,II=e=>!e.isRecurring,mg=e=>{var r;return r=class extends e{getEvents({filter:t,date:i,startDate:n,endDate:s,startOnly:a,includeOccurrences:o,allowPartial:l,onlyAssigned:c=!1,dateMap:d=!1,dayTime:u=null,getDateIndex:h}){const f=this,g=arguments[0],{lastDateRange:m,added:p,filtersFunction:v}=f,y=t;if(c&&(g.filter=y?D=>y(D)&&D.resources.length:D=>D.resources.length),"startDate"in g||(n=g.startDate=i),"includeOccurrences"in g||(o=g.includeOccurrences=!0),"allowPartial"in g||(l=g.allowPartial=!a),g.storeFilterFn=f.isFiltered&&!g.ignoreFilters?f.reapplyFilterOnAdd?v:D=>p.includes(D)?f.indexOf(D)>-1:v(D):null,!s)if(n)s=g.endDate=b.clearTime(n),s.setDate(s.getDate()+1);else{if(o)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");g.dateFilter=PI}g.dateFilter||(a?g.dateFilter=D=>{const w=D.hasBatchedChange("startDate")?D.get("startDate"):D.startDate;return w&&!(b.clearTime(w)-n)}:l?g.dateFilter=D=>{const w=D.hasBatchedChange("startDate")?D.get("startDate"):D.startDate,E=D.hasBatchedChange("endDate")?D.get("endDate"):D.endDate||w,x=!(w-E);return w&&(x?b.betweenLesserEqual(w,n,s):b.intersectSpans(w,E,n,s))}:g.dateFilter=D=>{const w=D.hasBatchedChange("startDate")?D.get("startDate"):D.startDate,E=D.hasBatchedChange("endDate")?D.get("endDate"):D.endDate||w;return w&&w>=n&&E<=s});const S={startDate:n,endDate:s};return f.processConfiguredListeners(),f.trigger("loadDateRange",{old:m||{},new:U.clone(S),changed:!!(!m||m.startDate-S.startDate||m.endDate-S.endDate)}),f.lastDateRange=U.clone(S),d?f.getEventsAsMap(g):f.getEventsAsArray(g)}getEventsAsArray({filter:t,date:i,resourceRecord:n,startDate:s=i,endDate:a,startOnly:o,includeOccurrences:l=!0,dayTime:c=null,dateFilter:d,storeFilterFn:u,getDateIndex:h}){const f=this,g=[];if(u?f.count:f.allCount){let p=n?f.getEventsForResource(n):null;if(!n){const v=f.useDayIndex(c),y=new Set,S=o?"startDate":"date";f.recurringEvents.forEach(D=>{v.dayTime.startOfDay(D.startDate)<=s&&y.add(D)});for(const D=new Date(s);D<a;D.setDate(D.getDate()+1)){const w=v.get(h?h(D):S,D);w==null||w.forEach(E=>y.add(E))}p=[...y]}u&&(p=p.filter(u));for(let v=0,{length:y}=p;v<y;v++){const S=p[v];l&&S.isRecurring?g.push.apply(g,S.getOccurrencesForDateRange(s,a).filter(d)):d(S)&&g.push(S)}}return t?g.filter(t):g}getEventsAsMap({filter:t,date:i,resourceRecord:n,startDate:s=i,endDate:a,startOnly:o,includeOccurrences:l=!0,dateMap:c,dayTime:d=null,storeFilterFn:u,getDateIndex:h}){var f;const g=this;if(c!=null&&c.clear?c.clear():c=new Map,g.count){const m=g.useDayIndex(d),p=o?"startDate":"date",v=[],y=D=>(!t||t(D))&&(!u||u(D)),S=D=>II(D)&&y(D);if(d=m.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");(f=g.recurringEvents)==null||f.forEach(D=>{d.startOfDay(D.startDate)<a&&v.push(D)});for(const D=new Date(s);D<a;D.setDate(D.getDate()+1)){let[w,E]=m.get(h?h(D):p,D,!0);w!=null&&w.size&&(w=[...w].filter(S),w.length&&(c.get(E)||c.set(E,[]).get(E)).push(...w))}for(let D=0,{length:w}=v;D<w;D++){const E=v[D],x=(l?E.getOccurrencesForDateRange(s,a):[E]).filter(y),M=b.add(a,1,"day");for(let I,P=0,{length:_}=x;P<_;P++){const A=x[P],V=d.startOfDay(A.startDate),N=h?h(V):o?"startDate":"date",B=N==="startDate"||!A.durationMS?b.add(V,1,"day"):b.min(A.endDate||b.add(A.startDate,A.duration,A.durationUnit),M);for(;V<B;V.setDate(V.getDate()+1)){const Z=d.dateKey(V);(I=c.get(Z))||c.set(Z,I=[]),I.push(A)}}}}return c}},R(r,"$name","GetEventsMixin"),r},dd={date:"_dateIndex",startDate:"_startDateIndex"},pg=Object.values(dd),yw=Object.freeze([]),{MILLIS_PER_DAY:bw}=at,ud=class{constructor(e,r){this.dayTime=r||at.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,r,t){const i=this[dd[e]],n=this.dayTime.dateKey(r);(i[n]||(i[n]=new Set)).add(t)}addEvent(e){var r,t,i;let n=(r=this.dayTime.startOfDay(e.startDate))==null?void 0:r.getTime(),s;if(n){s=(i=(t=e.endDate)==null?void 0:t.getTime())!=null?i:n,this.add("startDate",n,e);do this.add("date",n,e),n+=bw;while(n<s)}}clear(){pg.forEach(e=>this[e]=Object.create(null))}get(e,r,t){!this.initialized&&this.initialize();let i=this[dd[e]],n;return r&&(n=this.dayTime.dateKey(r),i=t?[i[n],n]:i[n]),i}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,pg.forEach(e=>this[e]=null)}matches(e){return this.dayTime.startShift===e.startShift}remove(e,r,t){const i=this[dd[e]],n=this.dayTime.dateKey(r),s=i[n];s&&s.delete(t)}removeEvent(e,r,t){var i,n;let s=(i=this.dayTime.startOfDay(r))==null?void 0:i.getTime(),a;if(s){a=(n=t==null?void 0:t.getTime())!=null?n:s,this.remove("startDate",s,e);do this.remove("date",s,e),s+=bw;while(s<a)}}sync(e,r,t,i,n){var s,a;r=r||yw,t=t||yw;const o=this,l=r.length,c=t.length,d=i==null?void 0:i.length;let u,h,f;if(o.initialized)switch(e){case"clear":o.clear();break;case"splice":if(d)for(r=r.slice(),t=t.slice(),u=0;u<d;u++)t.push(i[u][0]),r.push(i[u][1]);if(c)for(u=0;u<c;u++)f=t[u],o.removeEvent(f,f.startDate,f.endDate);if(l)for(u=0;u<l;u++)h=r[u],h.isScheduled&&!h.isParent&&o.addEvent(h);break;case"reschedule":f=r[0],o.removeEvent(f,((s=n.startDate)==null?void 0:s.oldValue)||f.startDate,((a=n.endDate)==null?void 0:a.oldValue)||f.endDate),o.sync("splice",r);break}}register(e){this.users.push(e)}unregister(e){const{users:r}=this,t=r.indexOf(e);return t>-1&&r.splice(t,1),!r.length}},Cw=ud.prototype;pg.forEach(e=>Cw[e]=null),Cw.initialized=!1,ud._$name="EventDayIndex";var{MIDNIGHT:Sw}=at,ww=e=>{var r;return r=class extends e{construct(t){super.construct(t),this.dayIndices=null}afterLoadData(){var t;this.syncIndices("splice",this.storage.allValues),(t=super.afterLoadData)==null||t.call(this)}onDataChange({action:t,added:i,removed:n,replaced:s}){this.syncIndices(t,i,n,s),super.onDataChange(...arguments)}onDataReplaced(t,i){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(t,i)}onModelChange(t,i,n,s,a){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[t],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var t;(t=this.dayIndices)==null||t.forEach(i=>i.invalidate())}registerDayIndex(t){const i=this,n=i.dayIndices||(i.dayIndices=[]);let s,a;for(a=0;!s&&a<n.length;++a)n[a].matches(t)&&(s=n[a]).register(t);return!s&&n.push(s=new ud(i,t)),s}syncIndices(...t){var i;(i=this.dayIndices)==null||i.forEach(n=>n.sync(...t))}unregisterDayIndex(t){const i=this,{dayIndices:n}=i;for(let s=n==null?void 0:n.length;s-- >0;)if(n[s].matches(t)){n[s].unregister(t)&&n.splice(s,1);break}}useDayIndex(t){const i=this,{dayIndices:n}=i;t=t||Sw;for(let s=0;n&&s<n.length;++s)if(n[s].matches(t))return n[s];if(t.startShift)throw new Error(`No day index registered for ${t} on ${i.id}`);return i.registerDayIndex(Sw)}},R(r,"$name","DayIndexMixin"),r},vg=e=>class extends e{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(t){if(super.construct(t,!0),this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}append(t){return this.add(t)}get project(){return super.project}set project(t){var i;super.project=t,this.detachListeners("project"),t&&((i=t.assignmentStore)!=null&&i.isAssignmentStore&&this.attachToAssignmentStore(t.assignmentStore),t.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(t){this._usesSingleAssignment=t}processRecords(t){var i;const{assignmentStore:n}=this,s=[];return n&&(n.skipInvalidateIndices=!0),t=super.processRecords(t,n&&!((i=this.stm)!=null&&i.isRestoring)&&(a=>{const o=a.get("resourceId");!a.reassignedFromReplace&&o!=null&&(n.includesAssignment(a.id,o)||s.push({id:n.modelClass.generateId(""),resourceId:o,eventId:a.id})),a.reassignedFromReplace=!1})||void 0),n&&(n.storage.invalidateIndices(),n.skipInvalidateIndices=!1,n.add(s)),t}joinRecordsToStore(t){const{assignmentStore:i}=this;i?(i.skipInvalidateIndices=!0,super.joinRecordsToStore(t),i.storage.invalidateIndices(),i.skipInvalidateIndices=!1):super.joinRecordsToStore(t)}processRecord(t,i=!1){t=super.processRecord(t,i);const n=t.get("resourceId");if(n!=null&&!t.meta.skipEnforcingSingleAssignment){const s=this,{assignmentStore:a}=s,o=s.getById(t.id);if(o&&o!==t&&!i){const c=a.find(d=>d.eventId===t.id);c&&(c.resource=n,t.reassignedFromReplace=!0)}else s.$processResourceIds=!0;s.usesSingleAssignment=!0}return t}processResourceIds(){var t,i,n;const s=this,a=(i=s.assignmentStore)!=null?i:(t=s.crudManager)==null?void 0:t.assignmentStore;if(s.$processResourceIds&&(a!=null&&a.isAssignmentStore)&&!((n=s.project)!=null&&n.isSharingAssignmentStore&&s.isChained)){const o=[];s.forEach(l=>{const{resourceId:c,id:d}=l;c!=null&&o.push({id:a.modelClass.generateId(""),resourceId:c,eventId:d})}),a.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},a.usesSingleAssignment=!1,a.verifyNoGeneratedIds=!1,a.data=o,a.usesSingleAssignment=!0,s.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:t}){var i;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&!((i=n.stm)!=null&&i.isRestoring)&&!n.usesSingleAssignment&&!n.assignmentStore.isSyncingDataOnLoad&&!n.resourceStore.isSyncingDataOnLoad){const s=new Set;t.forEach(a=>{const{event:o}=a;o&&!o.isRemoved&&o.assignments.every(l=>t.includes(l))&&s.add(o)}),s.size&&n.remove([...s])}}onProjectAssignmentStoreChange({store:t}){this.attachToAssignmentStore(t)}attachToAssignmentStore(t){const i=this;i.detachListeners("assignmentStore"),t&&(i.processResourceIds(),t.ion({name:"assignmentStore",addPreCommit({records:n}){i.usesSingleAssignment&&!i.isSettingData&&!i.isAssigning&&n.forEach(s=>{const{event:a}=s;a!=null&&a.isEvent&&a.resourceId!==s.resourceId&&(a.meta.isAssigning=!0,a.set("resourceId",s.resourceId),a.meta.isAssigning=!1)})},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:n}){i.usesSingleAssignment&&n.forEach(s=>{var a;(a=i.getById(s.eventId))==null||a.set("resourceId",null)})},removeAllPreCommit(){i.usesSingleAssignment&&!i.isSettingData&&i.allRecords.forEach(n=>n.set("resourceId",null))},update({record:n,changes:s}){if(i.usesSingleAssignment&&"resourceId"in s){const{event:a}=n;a.meta.isAssigning=!0,a.set("resourceId",s.resourceId.value),a.meta.isAssigning=!1}},thisObj:i}))}set data(t){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=t,this.isSettingData=!1}trigger(t,i){var n;const{changes:s}=i||{};return s&&"resourceId"in s&&Object.keys(s).length===1&&!((n=this.stm)!=null&&n.isRestoring)&&(i.isAssign=!0),super.trigger(...arguments)}remove(t,...i){var n,s;const a=super.remove(t,...i);if(a.length&&this.usesSingleAssignment)for(const o of a)o.isOccurrence||(s=this.assignmentStore||((n=this.crudManager)==null?void 0:n.assignmentStore))==null||s.remove(o.assignments,!0);return a}},Dw=Object.freeze([]),yg=e=>class extends(e||F){static get $name(){return"RecurringTimeSpansMixin"}construct(...t){const i=this;i.globalOccurrences=new Map,i.recurringEvents=new Set,super.construct(...t)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:t,added:i,removed:n,replaced:s}){this.refreshRecurringEventsCache(t,i,n,s),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,i=Dw,n=Dw,s){const a=this,{recurringEvents:o}=a,l=s==null?void 0:s.length;switch(t){case"clear":o.clear();break;case"splice":{if(l){i=i.slice(),n=n.slice();for(let u=0;u<l;u++)n.push(s[u][0]),i.push(s[u][1])}const c=i.length,d=n.length;if(d&&o.size)for(let u=0;u<d;u++)o.delete(n[u]);if(c)for(let u=0;u<c;u++){const h=i[u];h.isRecurring&&o.add(h)}break}}}getById(t){let i=super.getById(t);return i||(i=this.globalOccurrences.get(this.modelClass.asId(t))),i}onModelChange(t,i,n,s,a){const o=!s&&this.isRecurrenceRelatedFieldChange(t,n);if(o&&t.removeOccurrences(),super.onModelChange(...arguments),o){const l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}isRecurrenceRelatedFieldChange(t,i){return t.isRecurring||"recurrenceRule"in i}getOccurrencesForTimeSpan(t,i,n){const s=[];return t.isRecurring&&t.recurrence.forEachOccurrence(i,n,a=>s.push(a)),s}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},bg=e=>class extends yg(e||F){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}},Cg={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},Ew=e=>{var r;return r=class extends(e||St){get timeZone(){return this.getData("timeZone")}set timeZone(t){this.setData("timeZone",t)}setLocalDate(t,i){this.set(t,this.timeZone!=null?pt.toTimeZone(i,this.timeZone):i,!0),this.data[t]=this[t]}getLocalDate(t){return this.timeZone!=null&&this[t]?pt.fromTimeZone(this[t],this.timeZone):this[t]}applyChangeset(t){if(this.timeZone!=null)for(const i in Cg)t[i]&&(this.setLocalDate(i,new Date(t[i])),delete t[i]);return super.applyChangeset(...arguments)}getFieldPersistentValue(t){var i,n;if(this.timeZone!=null){const s=(n=(i=t==null?void 0:t.field)!=null?i:t==null?void 0:t.name)!=null?n:t;if(Cg[s])return this.getLocalDate(s)}return super.getFieldPersistentValue(t)}convertToTimeZone(t){const i=this,n={...i.meta.modified},s={...Cg};i.isTask&&!i.manuallyScheduled&&(delete s.startDate,delete s.endDate);for(const a in s)i[a]!=null?(s[a]=i[a],i.timeZone!=null&&(s[a]=i.getLocalDate(a),n[a]&&(n[a]=pt.fromTimeZone(n[a],i.timeZone)))):delete s[a];i.timeZone=t;for(const a in s)i.setLocalDate(a,s[a],!1),s[a]=1,i.timeZone!=null&&n[a]&&(n[a]=pt.toTimeZone(n[a],i.timeZone));i.clearChanges(!0,!0,s),T.isEmpty(n)||(i.meta.modified=n,i.stores.forEach(a=>a.modified.add(i)))}},R(r,"$name","TimeZonedDatesMixin"),R(r,"fields",[{name:"timeZone",persist:!1}]),r},St=class extends ae.mixin(Ew){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"}},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}construct(e,...r){if(e!=null&&e.fullDuration){const{magnitude:t,unit:i}=e.fullDuration;e.duration=t,e.unit=i,delete e.fullDuration}super.construct(e,...r),this.normalize()}get eventStore(){var e;const r=this;return r.isOccurrence?r.recurringTimeSpan.eventStore:(r._eventStore||(r._eventStore=(e=r.stores)==null?void 0:e.find(t=>t.isEventStore)),r._eventStore)}normalize(){const e=this,{startDate:r,endDate:t,duration:i,durationUnit:n}=e,s=i!=null;r&&t&&!s?e.setData("duration",b.diff(r,t,n,!0)):r&&!t&&s?e.setData("endDate",b.add(r,i,n)):!r&&t&&s&&e.setData("startDate",b.add(t,-i,n))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new J(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return e!=null&&e.isDomClassList?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new J(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:r,startDate:t}=e;return r||b.add(t,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,r=this.durationUnit){e=parseFloat(e),this.set({duration:e,durationUnit:r,...this.updateDatesFromDuration(e,r)})}updateDatesFromDuration(e,r,t=this.startDate,i=this.endDate){const n={};return t?n.endDate=b.add(t,e,r):i&&(n.startDate=b.add(i,-e,r)),n}getDurationInUnit(e,r){const t=this;return t.startDate&&t.endDate?b.getDurationInUnit(t.startDate,t.endDate,e,r):b.as(e,t.duration,t.durationUnit)}get fullDuration(){return new Le({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){typeof e=="string"&&(e=b.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,r=!0){const t=this,i={startDate:e};if(e){let n;if(r)n=t.duration!=null;else if(t.endDate){if(i.duration=b.diff(e,t.endDate,t.durationUnit,!0),i.duration<0)throw new Error("Negative duration")}else n=this.duration!=null;n&&(i.endDate=b.add(e,t.getDurationInUnit("h"),"h"))}else i.duration=null;t.set(i)}setEndDate(e,r=!1){const t=this,i={endDate:e};if(e){let n;if(r===!0)n=t.duration!=null;else if(t.startDate){if(i.duration=b.diff(t.startDate,e,t.durationUnit,!0),i.duration<0)throw new Error("Negative duration")}else n=this.duration!=null;n&&(i.startDate=b.add(e,-t.duration,t.durationUnit))}t.set(i)}setStartEndDate(e,r,t){this.set({startDate:e,endDate:r},null,t)}get dates(){const e=[],r=b.startOf(this.startDate,"day"),t=this.endDate;for(let i=r;i<t;i=b.add(i,1,"day"))e.push(i);return e}get startDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)==null?void 0:e.getTime()}get endDateMS(){var e;return(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)==null?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:r}=this;return e&&r?e-r:b.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(e){if(typeof e!="string"){let{startDate:r,endDate:t,duration:i,durationUnit:n=this.durationUnit}=e;typeof r=="string"&&(r=this.getFieldDefinition("startDate").convert(r)),typeof t=="string"&&(t=this.getFieldDefinition("endDate").convert(t)),"duration"in e?(r&&!t&&(t=b.add(r,i,n,!0,!0)),!r&&t&&(r=b.add(t,-i,n,!0,!0))):r&&t&&(i=b.as(n,b.diff(r,t,"h",!0),"h"));const s=Object.isFrozen(e)?T.clone(e):e;return r&&(s.startDate=r),t&&(s.endDate=t),i!=null&&(s.duration=i),s}}fieldToKeys(e,r){var t,i;const n=super.fieldToKeys(e,r);if(n.fullDuration){const{magnitude:s,unit:a}=n.fullDuration;n.duration=s,n.durationUnit=a}return!this.isEventModel&&!this.isTaskModel&&("duration"in n||n.durationUnit)&&!(n.startDate&&n.endDate)&&Object.assign(n,this.updateDatesFromDuration((t=n.duration)!=null?t:this.duration,(i=n.durationUnit)!=null?i:this.durationUnit,n.startDate,n.endDate)),n}inSet(e,r,t,i,n,s){return n||(e=this.inSetNormalize(e)||e),super.inSet(e,r,t,i,n,s)}applyValue(e,r,t,i,n){r==="cls"&&this.updateInternalCls(t),r==="fullDuration"&&(this[r]=t),super.applyValue(e,r,t,i,n)}forEachDate(e,r){return this.dates.forEach(e.bind(r))}get isScheduled(){const{startDateMS:e,endDateMS:r}=this;return r-e>=0}get isValid(){const{startDate:e,endDate:r}=this;return!e||!r||r-e>=0}shift(e,r=this.durationUnit){if(typeof e=="string"){const t=e;e=r,r=t}return this.setStartDate(b.add(this.startDate,e,r,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,r){const t=this.startDate,i=this.endDate;return t&&i&&b.intersectSpans(t,i,e,r)}split(e=.5){const r=this,t=r.copy(),{fullDuration:i,eventStore:n,assignmentStore:s}=r,a=new Le(i),o=new Le(i);let l,c;return typeof e=="string"?(l=new Le(e),l.unit===a.unit?o.magnitude-=l.magnitude:(o.magnitude=b.as(l.unit,a)-l.magnitude,o.unit=l.unit,c=!0)):(l=new Le(e>1?e:r.duration*e,r.durationUnit),o.magnitude-=l.magnitude),t.startDate=b.add(r.startDate,l.magnitude,l.unit),c?(t.fullDuration=o,r.fullDuration=l):(t.duration=o.magnitude,r.duration=l.magnitude),n&&(n.add(t),s&&!n.usesSingleAssignment&&s.add(r.assignments.map(d=>{const u=Object.assign({},d.data,{eventId:t.id,event:null,resource:null});return delete u.id,u}))),t}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:r,endDate:t}=this,i=e.DTSTAMP||b.format(new Date,"uu");delete e.DTSTAMP;let n={};this.allDay?n={"DTSTART;VALUE=DATE":b.format(r,"u"),"DTEND;VALUE=DATE":b.format(t,"u")}:n={DTSTART:b.format(r,"uu"),DTEND:b.format(t,"uu")};const s=re.scheduler&&re.getVersion("scheduler")||re.calendar&&re.getVersion("calendar")||"",a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${s} //EN`,END:"VCALENDAR"},o={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:i,...n,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},l=Object.keys(a).map(d=>`${d}:${a[d]}`),c=Object.keys(o).map(d=>`${d}:${o[d]}`);return l.splice(l.length-1,0,...c),l.join(`
`)}exportToICS(e){if(this.isScheduled){const r=new Blob([this.toICSString(e)],{type:"text/calendar"});Y.downloadBlob(r,(this.name||"Event")+".ics")}}isEditable(e){return this.getFieldDefinition(e)?!0:void 0}isFieldModified(e){return e==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}};St._$name="TimeSpan";var AI=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,xw=["SU","MO","TU","WE","TH","FR","SA"],kt=class extends F{static decodeDay(e){let r,t;return(r=AI.exec(e))&&(t=[xw.indexOf(r[2])],r[1]&&(r[1]=parseInt(r[1],10),t.push(r[1]))),t}static encodeDay(e){let r;return Array.isArray(e)&&([e,r]=e),(r?r.toString():"")+xw[e]}static decode(e){const r=[];let t;if(e)for(let i=0;i<e.length;i++)(t=this.decodeDay(e[i]))&&r.push(t);return r}static encode(e){const r=[];let t;if(e)for(let i=0;i<e.length;i++)(t=this.encodeDay(e[i]))&&r.push(t);return r}};kt._$name="RecurrenceDayRuleEncoder";var _I=/ly$/i,Sg=e=>{const r=e.replace(_I,"");return r==="DAI"?"DAY":r},FI=(e,r,t,i)=>i.buildOccurrence(e,t),kI=e=>wg=e,wg,Yr=class extends F{static processIterationConfig(e){const{recurrence:r}=e,{frequency:t,interval:i,timeSpan:n,endDate:s,count:a}=r;if(!e.syncingStartDate&&!n.meta.isSyncedWithRule){const u=b.add(n.startDate,i,Sg(t)),h=b.min(u,e.endDate||u);this.forEachDate({syncingStartDate:!0,startDate:n.startDate,endDate:h,recurrence:r,fn:FI})}const o=n.startDate;let{startDate:l=o,endDate:c=s}=e;l<o&&(l=o),s?(!c||c>s)&&(c=s):a&&l>o&&(this.forEachDate({recurrence:r,fn:kI}),(!c||c>wg)&&(c=new Date(wg.getTime()+1)));const d=l;return e.startOnly||(l=new Date(b.max(b.add(l,-i,Sg(t)),o))),Object.assign({extraArgs:[],startOnly:!n.durationMS},e,{startDate:l,endDate:c,timeSpan:n,timeSpanStart:o,earliestVisibleDate:d,endDateMS:c==null?void 0:c.getTime(),timeSpanStartMS:o.getTime(),earliestVisibleDateMS:d.getTime(),durationMS:n.durationMS,spansStart:l<=o&&c>o})}static getOccurrenceIndex(e){if(e.isOccurrence)return b.diff(e.recurringTimeSpan.startDate,e.startDate,Sg(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,r,t,i){let n,s,a;if(i){i>0?(s=1,a=e):(s=-1,a=r);const o=t-a.getDay();s*o<0&&(i+=s),n=new Date(a),n.setDate(a.getDate()+(i-s)*7+o),(n<e||n>r)&&(n=null)}return n}static buildDate(e,r,t){const i=new Date(e,r,t);if(i.getFullYear()===e&&i.getMonth()===r&&i.getDate()===t)return i}static isValidPosition(e){return!!e}static forEachDateAtPositions(e,r,t,i){const n=e.length,s={};for(let a=0;a<r.length;a++){const o=r[a];if(this.isValidPosition(o)){const l=o>0?e[o-1]:e[n+o];if(l&&!s[l.getTime()]&&(s[l.getTime()]=!0,t.call(i,l)===!1))return!1}}}static isInView(e,r,t,i,n){return(e?r>=t:r.valueOf()+i>t)&&!n.hasException(r)}static isInViewMS(e,r,t,i,n,s){return(e?t>=i:t+n>i)&&!s.hasException(r)}};R(Yr,"frequency","NONE"),R(Yr,"MAX_OCCURRENCES_COUNT",1e6),Yr._$name="AbstractRecurrenceIterator";var hd=class extends Yr{static forEachDate(e){const{startOnly:r,startDate:t,endDate:i,endDateMS:n,timeSpan:s,timeSpanStart:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g}=d,m=t-a,p=g*864e5,v=Math.floor(m/p);let{count:y}=d,S=0,D=b.add(a,v*g,"day"),w=D.getTime();for(!i&&!y&&(y=this.MAX_OCCURRENCES_COUNT);!n||w<n;){const E=this.isInViewMS(r,D,w,o,l,s);if(S++,E&&(n&&w>n||u.apply(f,[D,S,S===1&&c,s,...h])===!1||y&&S>=y))break;D=b.add(D,g,"day"),w=D.getTime()}}};R(hd,"frequency","DAILY"),hd._$name="DailyRecurrenceIterator";var fd=class extends Yr{static forEachDate(e){const{startOnly:r,startDate:t,endDateMS:i,timeSpan:n,timeSpanStart:s,timeSpanStartMS:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:f=this}=this.processIterationConfig(e),{interval:g,days:m}=d,{weekStartDay:p}=b,v=s.getHours(),y=s.getMinutes(),S=s.getSeconds(),D=s.getMilliseconds();let w=0,{count:E}=d,x=kt.decode(m),M,I;if(x!=null&&x.length||(x=[[s.getDay()]]),p>0)for(let P=0;P<x.length;P++)p>x[P][0]?x[P][0]=7-p-x[P][0]:x[P][0]-=p;for(x.sort((P,_)=>P[0]-_[0]),M=b.getNext(E||g>1?s:t,"week",0),!i&&!E&&(E=this.MAX_OCCURRENCES_COUNT);!i||M.getTime()<i;){for(let P=0;P<x.length;P++){I=new Date(M.getFullYear(),M.getMonth(),M.getDate()+x[P][0],v,y,S,D);const _=I.getTime();if(_>=a){const A=this.isInViewMS(r,I,_,o,l,n);if(w++,A&&(i&&_>=i||u.apply(f,[I,w,w===1&&c,n,...h])===!1||E&&w>=E))return}}M=b.getNext(M,"week",g)}}};R(fd,"frequency","WEEKLY"),fd._$name="WeeklyRecurrenceIterator";var gd=class extends Yr{static getNthDayOfMonth(e,r){const t=b.daysInMonth(e);let i=null;return r&&Math.abs(r)<=t&&(i=new Date(e.getFullYear(),e.getMonth(),r<0?t+r+1:r)),i}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:r,startDate:t,endDate:i,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:f,days:g,count:m,positions:p}=c,v=kt.decode(g),y=p&&p.length,S={};let{monthDays:D}=c,w=0,E,x,M,I,P,_;for(x=b.startOf(m||f>1?s:t,"month"),M=new Date(b.getNext(x,"month",1)-1),!(D&&D.length)&&!(v&&v.length)&&(D=[s.getDate()]),v&&v.length&&v.forEach(A=>{A[1]&&(E=E||{},E[A[0]]=A[1])});(!i||i>x)&&(!m||w<m);){if(I=[],v&&v.length){if(v.forEach(A=>{const V=A[0];let N=1,B=53;for(A[1]&&(N=B=A[1]),_=N;_<=B;_++)(P=this.getNthDayInPeriod(x,M,V,_))&&(P=b.copyTimeValues(P,s),S[P.getTime()]||(S[P.getTime()]=!0,I.push(P)))}),I.sort((A,V)=>A-V),!y){for(_=0;_<I.length;_++)if(P=I[_],P>=s){const A=this.isInView(r,P,a,o,n);if(w++,A&&(i&&P>=i||d.apply(h,[P,w,w===1&&l,n,...u])===!1||m&&w>=m))return!1}}}else{const A=[];for(_=0;_<D.length;_++)(P=this.getNthDayOfMonth(x,D[_]))&&!S[P.getTime()]&&(S[P.getTime()]=!0,A.push(P));for(A.sort((V,N)=>V-N),_=0;_<A.length;_++)if(P=b.copyTimeValues(A[_],s),y)I.push(P);else if(P>=s){const V=this.isInView(r,P,a,o,n);if(w++,V&&(i&&P>i||d.apply(h,[P,w,w===1&&l,n,...u])===!1||m&&w>=m))return}}y&&I.length&&this.forEachDateAtPositions(I,p,A=>{if(A>=s){const V=r?A>=a:A.valueOf()+o>a&&!n.hasException(A);if(w++,V&&(!i||A<=i)&&(d.apply(h,[A,w,w===1&&l,n,...u])===!1||m&&w>=m))return!1}}),x=b.getNext(x,"month",f),M=new Date(b.getNext(x,"month",1)-1)}}};R(gd,"frequency","MONTHLY"),gd._$name="MonthlyRecurrenceIterator";var md=class extends Yr{static forEachDate(e){const{startOnly:r,startDate:t,endDate:i,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:f,days:g,count:m,positions:p}=c,v=kt.decode(g),y=p&&p.length,S={};let{months:D}=c,w=0,E,x,M,I,P,_;for(I=b.startOf(m||f>1?s:t,"year"),P=new Date(b.getNext(I,"year",1)-1),D&&D.sort((A,V)=>A-V),!(D&&D.length)&&!(v&&v.length)&&(D=[s.getMonth()+1]),v&&v.length&&v.forEach(A=>{A[1]&&(_=_||{},_[A[0]]=A[1])});(!i||i>I)&&(!m||w<m);){if(M=[],v&&v.length){if(v.forEach(A=>{const V=A[0];let N=1,B=53;for(A[1]&&(N=B=A[1]),E=N;E<=B;E++)(x=this.getNthDayInPeriod(I,P,V,E))&&(x=b.copyTimeValues(x,s),S[x.getTime()]||(S[x.getTime()]=!0,M.push(x)))}),M.sort((A,V)=>A-V),!y){for(E=0;E<M.length;E++)if(x=M[E],x>=s){const A=this.isInView(r,x,a,o,n);if(w++,A&&(i&&x>=i||d.apply(h,[x,w,w===1&&l,n,...u])===!1||m&&w>=m))return}}}else for(E=0;E<D.length;E++)if((x=this.buildDate(I.getFullYear(),D[E]-1,s.getDate()))&&(x=b.copyTimeValues(x,s),!S[x.getTime()])){if(S[x.getTime()]=!0,y)M.push(x);else if(x>=s){const A=r?x>=a:x.valueOf()+o>a&&!n.hasException(x);if(w++,A&&(i&&x>=i||d.apply(h,[x,w,w===1&&l,n,...u])===!1||m&&w>=m))return}}y&&M.length&&this.forEachDateAtPositions(M,p,A=>{if(A>=s){const V=r?A>=a:A.valueOf()+o>a&&!n.hasException(A);if(w++,V&&(!i||A<i)&&(d.apply(h,[A,w,w===1&&l,n,...u])===!1||m&&w>=m))return!1}}),I=b.getNext(I,"year",f),P=new Date(b.getNext(I,"year",1)-1)}}};R(md,"frequency","YEARLY"),md._$name="YearlyRecurrenceIterator";var Rw={};[hd,fd,gd,md].forEach(e=>{Rw[e.frequency]=e});function Dg(e){return e?typeof e=="string"&&(e=e.split(",").map(r=>parseInt(r,10))):e=null,e}function OI(e){return e?typeof e=="string"&&(e=e.split(",")):e=null,e}function pd(e,r){return String(e)===String(r)}function Tw(e){return this.defaultValue&&e===void 0?this.defaultValue:this.allowNull&&e==null?null:(e=parseInt(e),isNaN(e)?void 0:e)}var Eg=class extends ae{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:Tw},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:Tw},{name:"days",convert:OI,isEqual:pd},{name:"monthDays",convert:Dg,isEqual:pd},{name:"months",convert:Dg,isEqual:pd},{name:"positions",convert:Dg,isEqual:pd}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return Rw[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,r=[];return e.frequency&&(r.push(`FREQ=${e.frequency}`),e.interval>1&&r.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&r.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&r.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&r.push("BYMONTH="+e.months.join(",")),e.count&&r.push(`COUNT=${e.count}`),e.endDate&&r.push("UNTIL="+b.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&r.push("BYSETPOS="+e.positions.join(","))),r.join(";")}set rule(e){const r=this,t={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(r.beginBatch(),e){const i=e.split(";");for(let n=0,s=i.length;n<s;n++){const a=i[n].split("="),o=a[1];switch(a[0]){case"FREQ":t.frequency=o;break;case"INTERVAL":t.interval=o;break;case"COUNT":t.count=o,t.until=null;break;case"UNTIL":o?t.endDate=b.parse(o,r.dateFormat):t.endDate=null,t.count=null;break;case"BYDAY":t.days=o;break;case"BYMONTHDAY":t.monthDays=o;break;case"BYMONTH":t.months=o;break;case"BYSETPOS":t.positions=o;break}}}r.set(t),e&&r.sanitize(),r.endBatch()}construct(e={}){const r=this,{rule:t,timeSpan:i}=e;r._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),t&&(r.suspendTimeSpanNotifying(),r.rule=t,r.resumeTimeSpanNotifying()),r.timeSpan=i}forEachOccurrence(e,r,t){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:r,fn(i,n,s,a){return t(a.buildOccurrence(i,s),s,n,i)}})}sanitize(){var e,r;const t=this,i=(e=t.timeSpan)==null?void 0:e.startDate,n={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":n.positions=null,n.days=null,n.monthDays=null,n.months=null;break;case"WEEKLY":{n.positions=null,n.monthDays=null,n.months=null;const{days:s}=t;i&&(s==null?void 0:s.length)===1&&s[0]===kt.encodeDay(i.getDay())&&(n.days=null);break}case"MONTHLY":{(r=t.monthDays)!=null&&r.length&&(n.positions=null,n.days=null),n.months=null;const{monthDays:s}=t;i&&(s==null?void 0:s.length)===1&&s[0]===i.getDate()&&(n.monthDays=null);break}case"YEARLY":{n.monthDays=null;const{months:s}=t;i&&(s==null?void 0:s.length)===1&&s[0]===i.getMonth()+1&&(n.months=null);break}}t.set(n),t.isSanitizing=!1}copy(...e){const r=super.copy(...e);return r.dateFormat=this.dateFormat,r.timeSpan=this.timeSpan,r}afterChange(e,r,t){const i=super.afterChange(e,r,t),{timeSpan:n}=this;return this.isSanitizing||this.sanitize(),n&&(n.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||n.onRecurrenceChanged()),i}set(e,r,...t){const i=typeof e=="object"?e:{[e]:r};i.count?i.endDate=null:i.endDate&&(i.count=null),super.set(i,void 0,...t)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}};Eg._$name="RecurrenceModel";function LI(e){const r={},{dateFormat:t}=this;return e&&(e=typeof e=="string"?e.split(","):H.asArray(e),e.forEach(i=>{typeof i=="string"&&(i=b.parse(i,t)),isNaN(i)||(r[b.makeKey(i)]=1)})),r}function $I(e){const r=[],{dateFormat:t}=this;for(const i in e)e[i]&&r.push(b.format(b.parseKey(i),t));return r}var jI=[],vd=e=>class extends(e||St){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:LI,serialize:$I,internal:!0}]}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:i}=t;t.cancelBatch(),i.beginBatch(),t.detachFromRecurringEvent(),i.endBatch()}else return super.remove(...arguments)}get eventStore(){var t;let i=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!i&&((t=this.firstStore)!=null&&t.isRecurringTimeSpansMixin)&&(i=this.firstStore),i}get recurrenceModel(){return this._recurrenceModel||Eg}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,i,n){const s=this;let a;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},i&&(t.interval=i),n&&(n instanceof Date?t.endDate=n:t.count=n)),t=new s.recurrenceModel(t)),t.timeSpan=s,a=t.rule),s.recurrence=t,s.recurrenceRule=a}get recurrence(){const t=this,i=t.recurrenceRule;return!t._recurrence&&i&&(t._recurrence=new t.recurrenceModel({rule:i,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const i=this;i._recurrence=t,t?(t.timeSpan=i,i.recurrenceRule=t.rule):i.isOccurrence?i.setData("recurrenceRule",null):i.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,i=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,i)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(i=>{i!==this&&t.push(i)}),t}return jI}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t){var i;const n=t.isTimeSpan?t.occurrenceDate:t;(i=this.eventStore)==null||i.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(b.makeKey(n))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((i,n)=>{b.parseKey(n)>=t&&this.removeOccurrence(i)})}removeOccurrences(){[this,...this.occurrences].forEach(t=>this.removeOccurrence(t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)==null?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const i=b.clearTime(t.endDate),{exceptionDates:n}=this;if(this.removeOccurrencesFrom(i),n)for(const s in n)b.parseKey(s)>=i&&delete n[s]}}get occurrenceDate(){var t;return((t=this.meta.modified)==null?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return Yr.getOccurrenceIndex(this)}buildOccurrence(t,i){var n;const s=this,{occurrenceMap:a,recurrence:o,meta:l}=s,c=(n=s.eventStore)==null?void 0:n.globalOccurrences,d=b.makeKey(t),u=s.createRecurrenceKey(t,d),h=!(t-s.startDate),{fieldMap:f}=s.constructor;let g=c==null?void 0:c.get(u),{duration:m}=s;s.endDate&&(s.allDay||!m)&&(m=b.as(s.durationUnit,s.endDate.getTime()-s.startDate.getTime()));const p=m!==void 0?b.add(t,m,s.durationUnit):void 0;return g||(i||h?(g=s,h||(s.setStartEndDate(t,p,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),l.isSyncedWithRule=!0):(g=s.copy({[f.id.dataSource]:u,[f.startDate.dataSource]:t,[f.endDate.dataSource]:p,[f.duration.dataSource]:m,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),g.recurringTimeSpan=s),c==null||c.set(u,g),a.set(d,g)),g}createRecurrenceKey(t=this.startDate,i=null){return`_generated:${this.id}:${i||b.makeKey(t)}`}convertToRealEvent(t,i){var n;if(!this.isOccurrence)return;const s=this,{recurringTimeSpan:a,resource:o,occurrenceIndex:l,recurrence:c}=s,d=c&&a.recurrence.count,u=((n=t==null?void 0:t.resourceRecords)==null?void 0:n.value)||s.data.newResource;a.beginBatch(),s.detachFromRecurringEvent(),s.clearChanges(),s.setData("id",s.generateId(a.eventStore)),u&&delete s.data.resourceId,a.eventStore.add(s,i),d&&(s.recurrence.count=d-l),(u||o)&&s.assign(u||o),u&&delete s.data.resourceRecords,t&&delete t.resourceRecords,a.endBatch()}afterChange(t,i,n,...s){const a=this,{eventStore:o}=a;return"recurrenceRule"in i&&(a._recurrence=null,o==null||o.recurringEvents[i.recurrenceRule.value?"add":"delete"](a)),a.isOccurrence?a.convertToRealEvent(i,n):"newExceptionDate"in i&&(a.meta.modified.exceptionDates=!0,delete a.meta.modified.newExceptionDate,a.removeOccurrence(i.newExceptionDate.value)),super.afterChange(t,i,n,...s)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:i,occurrenceDate:n,startDate:s}=t;t.recurringTimeSpan=null,i.addExceptionDate(n),t.recurrenceRule&&(i.recurrence.endDate=b.add(s,-1,"minute"))}set newExceptionDate(t){if(t){const i=this.exceptionDates||(this.exceptionDates={});i[b.makeKey(t)]=1}}addExceptionDate(t){return this.set({newExceptionDate:t})}hasException(t){var i;return(i=this.exceptionDates)==null?void 0:i[b.makeKey(t)]}},BI=1e3*60*60*24,yd=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce((t,{resource:i})=>(i&&t.push(i.$original),t),[])}set resources(t){t=H.asArray(t);const i=this,n=t.map(i.constructor.asId);if(i.usesSingleAssignment)i.set("resourceId",n[0]);else{const s=i.assignments.map(l=>l.resource.id),{onlyInA:a,onlyInB:o}=H.delta(n,s);i.assignmentStore.add(a.map(l=>({resource:l,event:i}))),i.assignmentStore.remove(o.map(l=>i.assignments.find(c=>c.resource.id===l)))}}forEachResource(t,i=this){for(const n of this.resources)if(t.call(i,n)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){var t;let i;return this.isOccurrence?i=this.get("startDate"):i=(t=this._startDate)!=null?t:super.startDate,this.allDay&&(i=this.constructor.getAllDayStartDate(i)),i}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){var t;let i;return this.isOccurrence?i=this.get("endDate"):i=(t=this._endDate)!=null?t:super.endDate,this.allDay&&(i=this.constructor.getAllDayEndDate(i)),i}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const t=this,{isPersistable:i,meta:{batchChanges:n}}=t;if(n&&("endDate"in n&&(delete t._endDate,t.postamble&&(t.wrapEndDate=null)),"startDate"in n&&(delete t._startDate,t.preamble&&(t.wrapStartDate=null))),super.endBatch(...arguments),t.isPersistable&&!i&&!t.ignoreBag&&t.assigned)for(const s of t.assigned)s.stores.forEach(a=>a.updateModifiedBagForRecord(s))}get isCreating(){return super.isCreating}set isCreating(t){super.isCreating=t,this.assignments.forEach(i=>i.isCreating=t)}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const i=super.copy(...t);return this.usesSingleAssignment||(i.resourceId=null),i}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.resource)==null?void 0:t.id}set resourceId(t){this.applyResourceId(t)}get $linkedResources(){var t,i;return(i=(t=this.resources)==null?void 0:t.flatMap(n=>[n,...n.$links]))!=null?i:[]}applyResourceId(t,i=!1){var n;const s=this,{eventStore:a,assignments:o}=s;if(a){const l=a.assignmentStore||((n=a.crudManager)==null?void 0:n.assignmentStore);if(t!=null)if(s.meta.skipEnforcingSingleAssignment||(a.usesSingleAssignment=!0),o!=null&&o.length&&t!==o[0].resourceId){const c=!!a.eventsSuspended;c&&l.suspendEvents(),o[0].resource=t,c&&l.resumeEvents()}else l.assignEventToResource(s,t);else l.remove(o)}else i||s.set({resourceId:t})}applyValue(t,i,n,s,a){if(a&&a.name==="resourceId"&&!this.meta.isAssigning){const{eventStore:o}=this;o&&(o.isAssigning=!0),this.applyResourceId(n,!0),o&&(o.isAssigning=!1)}super.applyValue(t,i,n,s,a)}get assignments(){return[...this.assigned||[]]}assign(t,i=!1){const{eventStore:n}=this;n&&!n.usesSingleAssignment?n.assignEventToResource(this,t,i):(this.resourceId=this.constructor.asId(t),n||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(t,i=!1){var n;const s=this;t=s.constructor.asId(t),s.meta.removingResource=i,(n=s.eventStore)==null||n.unassignEventFromResource(s,t),s.meta.removingResource=null}reassign(t,i){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,i)}isAssignedTo(t){const i=this.constructor.asId(t);return this.assignments.some(n=>n.resourceId===i)}get predecessors(){var t;return[...(t=this.incomingDeps)!=null?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!=null?t:[]]}get dependencies(){var t,i;return[...(t=this.incomingDeps)!=null?t:[],...(i=this.outgoingDeps)!=null?i:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=BI||!t&&this.allDay)return!0;const{endDate:i,startDate:n}=this,s=b.clearTime(n);if(n&&i)return s.setDate(s.getDate()+1),(i||b.add(n,t))>s}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=b.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=b.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),b.clearTime(t,!0)}static getAllDayDisplayEndDate(t,i){return t&&t.isEvent&&(i=t.get("endDate"),t=t.get("startDate")),i&&(t=this.constructor.getAllDayDisplayStartDate(t),b.clearTime(i,!0).valueOf()===i.valueOf()?i=b.add(i,b.DAY,-1):t.valueOf()!==i.valueOf()&&(i=b.clearTime(i,!0))),i}isEditable(t){switch(t){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(t)}},HI=ad,Oo=class extends HI.derive(St).mixin(vd,Gr,yd){static get $name(){return"EventModel"}};Oo.exposeProperties(),Oo._$name="EventModel";var VI=Gr(tg.derive(ut)),Lo=class extends VI.mixin(vg,bg,gg,ww,mg){static get defaultConfig(){return{modelClass:Oo}}};R(Lo,"$name","EventStore"),Lo._$name="EventStore";var NI=["SS","SF","FS","FF"],wt=class extends ae{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const r=e[this.fieldMap.from.dataSource],t=e[this.fieldMap.to.dataSource];r!=null&&(e.fromEvent=r),t!=null&&(e.toEvent=t),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||((e=this.unjoinedStores[0])==null?void 0:e.eventStore)}set from(e){const{fromEvent:r}=this;r!=null&&r.isModel&&r.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:r}=this;r!=null&&r.isModel&&r.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let r;return e!==this.hardType&&(r=this.set({type:e,fromSide:null,toSide:null})),r}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,r=this.lagUnit){if(arguments.length===1){typeof e=="number"?this.lag=e:(e=b.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}));return}e=parseFloat(e),this.set({lag:e,lagUnit:r})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${b.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new Le({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){typeof e=="string"?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:r,unjoinedStores:t}=e,i=r[0];let n;if(i){const{fromEvent:s,toEvent:a}=e,o=i.crudManager;n=s&&(o||!s.hasGeneratedId)&&a&&(o||!a.hasGeneratedId)}else n=!!t[0];return n&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:r}=this;if(e!=null&&e.isScheduled&&(r!=null&&r.isScheduled)){const t=wt.Type;let i,n;switch(this.type){case t.StartToStart:i=e.startDateMS,n=r.startDateMS;break;case t.StartToEnd:i=e.startDateMS,n=r.endDateMS;break;case t.EndToEnd:i=e.endDateMS,n=r.endDateMS;break;case t.EndToStart:i=e.endDateMS,n=r.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(i,n),end:Math.max(i,n)}}return null}highlight(e){var r,t;const i=(t=(r=this.highlighted)==null?void 0:r.split(" "))!=null?t:[];i.includes(e)||(this.highlighted=i.concat(e).join(" "))}unhighlight(e){const{highlighted:r}=this;if(r){const t=r.split(" "),i=t.indexOf(e);i>=0&&(t.splice(i,1),this.highlighted=t.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const r=NI[this.type];return e?r:this.type===wt.Type.EndToStart?"":r}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:r,type:t}=this;return typeof t=="number"&&e&&r&&e!==r}get fromEventName(){var e;return((e=this.fromEvent)==null?void 0:e.name)||""}get toEventName(){var e;return((e=this.toEvent)==null?void 0:e.name)||""}shouldRecordFieldChange(e,r,t){var i;if(!super.shouldRecordFieldChange(e,r,t))return!1;if(e==="from"||e==="to"||e==="fromEvent"||e==="toEvent"){const n=(i=this.project)==null?void 0:i.eventStore;if(n&&n.oldIdMap[r]===n.getById(t))return!1}return!0}};wt.exposeProperties(),wt._$name="DependencyBaseModel";var zI=sd,Dt=class extends Gr(zI.derive(wt)){static get $name(){return"DependencyModel"}getTypeFromSides(e,r,t){const i=wt.Type,n=t?"right":"left",s=t?"left":"right";return e===n?r===n?i.StartToStart:i.StartToEnd:r===s?i.EndToEnd:i.EndToStart}};Dt.exposeProperties(),Dt._$name="DependencyModel";var xg=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(t,i,n,s=!0,a){return a=a||(o=>this.getEventDependencies(o)),t=H.asArray(t),t.reduce((o,l)=>{l.children&&!s?l.traverse(c=>{o=a(c).reduce(i,o)}):o=a(l).reduce(i,o)},n),n}mapEventDependencies(t,i,n,s,a){return this.reduceEventDependencies(t,(o,l)=>(n(l)&&o.push(l),o),[],s,a)}mapEventPredecessors(t,i,n,s){return this.reduceEventPredecessors(t,(a,o)=>(n(o)&&a.push(o),a),[],s)}mapEventSuccessors(t,i,n,s){return this.reduceEventSuccessors(t,(a,o)=>(n(o)&&a.push(o),a),[],s)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,i){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(i=>t==this.constructor.makeDependencySourceTargetCompositeKey(i.from,i.to))}getDependencyForSourceAndTargetEvents(t,i){return t=ae.asId(t),i=ae.asId(i),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,i))}getEventsLinkingDependency(t,i){return this.getDependencyForSourceAndTargetEvents(t,i)||this.getDependencyForSourceAndTargetEvents(i,t)}async isValidDependency(t,i,n){let s=t,a=i;return t==null?!1:(t.isDependencyModel&&({fromEvent:s,toEvent:a}=t),s=this.eventStore.getById(s),a=this.eventStore.getById(a),s&&a?!s.project||!a.project?!1:this.project.isValidDependency(s,a,n):t!==i)}isValidDependencyToCreate(t,i,n){return this.isValidDependency(t,i,n)}getHighlightedDependencies(t){return this.records.reduce((i,n)=>(n.isHighlightedWith(t)&&i.push(n),i),[])}static makeDependencySourceTargetCompositeKey(t,i){return`source(${t})-target(${i})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}},WI=Gr(eg.derive(ut)),bd=class extends xg(WI.derive(ut)){static get defaultConfig(){return{modelClass:Dt}}};bd._$name="DependencyStore";var Rg=e=>class extends(e||F).mixin(ag,lg,cg){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const i=this,{project:n}=i;i.applyingProjectResponse=!0;const s=n.fieldMap.startDate,a=n.fieldMap.endDate,o=T.getPath(t,s.dataSource),l=T.getPath(t,a.dataSource);typeof o=="string"&&T.setPath(t,s.dataSource,s.convert(o)),typeof l=="string"&&T.setPath(t,a.dataSource,a.convert(l)),Object.assign(n,t),i._changesToClear.set(i,t),i.applyingProjectResponse=!1}loadCrudManagerData(t,i={}){const n=this,{project:s}=n;n.suspendChangesTracking(),super.loadCrudManagerData(...arguments),t!=null&&t.project&&(s.delayEnteringReplica?s.ion({recordsUnlinked:()=>{n.suspendChangesTracking(),n.applyProjectResponse(t.project),n.resumeChangesTracking()},once:!0}):n.applyProjectResponse(t.project)),n.resumeChangesTracking()}async sync(){const{project:t}=this;if(this.suspendAutoSync(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(t,i,n){var s,a,o,l,c,d;const u=this;if(!(u.isDestroyed||(s=u.project)!=null&&s.isDestroyed)){if(u.trigger("beforeApplyResponse"),await super.applyResponse(t,i,n),(i!=null&&i.project||u.supportShortSyncResponse&&((a=t==null?void 0:t.pack)!=null&&a.project))&&u.applyProjectResponse(i.project||((o=t==null?void 0:t.pack)==null?void 0:o.project)),u.project){let h=t.type;u.trackResponseType&&(h=i.type||h);const f=`propagating${L.capitalize(h)}Changes`;u.suspendAutoSync(),u[f]=!0;const g=u.project.isInitialCommit&&!u.project.silenceInitialCommit;await u.project.commitAsync(),u[f]=!1,(l=u.resumeAutoSync)==null||l.call(u,g),(c=u.commitRespondedChanges)==null||c.call(u)}(d=u.trigger)==null||d.call(u,"applyResponse")}}applySyncResponse(...t){var i;const n=this,s=(i=n.project)==null?void 0:i.stm.disabled;s===!1&&n.ignoreRemoteChangesInSTM&&n.project.stm.disable(),super.applySyncResponse(...t),s===!1&&n.project.stm.enable()}shouldClearRecordFieldChange(t,i,n){const s=t[i];return i=t.getFieldDefinition(i),i!=null&&i.isEqual?i.isEqual(s,n):T.isEqual(s,n)}commitRespondedChanges(){this._changesToClear.forEach((t,i)=>{Object.entries(t).forEach(([n,s])=>{this.shouldClearRecordFieldChange(i,n,s)&&delete i.meta.modified[n]})}),this._changesToClear.clear()}applyChangesToStore(t,i,n,...s){const a=super.applyChangesToStore(t,i,n,...s);if(a.size&&this.project)for(const[o,l]of a){const c=t.store.getById(o);c&&this._changesToClear.set(c,l)}return a}},Mw=e=>{var r;return r=class extends(e||ae){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.allRecords}updateAssignments(t){this.assignmentStore.data=t}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(t){this.dependencyStore.data=t}get resources(){return this.resourceStore.allRecords}updateResources(t){this.resourceStore.data=t}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(t,i){const n=this.timeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(t,i)):a.startDate<i&&t<a.endDate&&s.push(a);return s}updateTimeRanges(t){this.timeRangeStore.data=t}getResourceTimeRanges(t,i){const n=this.resourceTimeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(t,i)):a.startDate<i&&t<a.endDate&&s.push(a);return s}},R(r,"$name","ProjectModelCommon"),r},Sr=class extends St.mixin(vd){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}};R(Sr,"$name","ResourceTimeRangeModel"),R(Sr,"fields",["resourceId","timeRangeColor"]),R(Sr,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),R(Sr,"domIdPrefix","resourcetimerange"),Sr._$name="ResourceTimeRangeModel";var $o=class extends ut.mixin(yg){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:Sr,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:r,endDate:t}){return e.timeRanges.flatMap(n=>n.supportsRecurring?n.getOccurrencesForDateRange(r,t):n.intersectsRange(r,t)?n:[]).sort((n,s)=>n.startDate-s.startDate)}};R($o,"$name","ResourceTimeRangeStore"),$o._$name="ResourceTimeRangeStore";var Pw=e=>{var r;return r=class extends(e||ae){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(t=>t)}overrideStoreProcessRecord(t){this._storesWithDates.includes(t)&&!t.$originalProcessRecord&&(t.$originalProcessRecord=Te.before(t,"processRecord",(i,n)=>{(n||t.isLoadingData)&&this.convertRecordToTimeZone(i)}))}attachStore(t){super.attachStore(t),t&&this.timeZone!=null&&this._storesWithDates.includes(t)&&(this.convertStoresToTimeZone([t]),this.overrideStoreProcessRecord())}detachStore(t){if(super.detachStore(t),t&&!t.isDestroyed){const{$originalProcessRecord:i}=t;i&&(i(),t.$originalProcessRecord=null,this.convertStoresToTimeZone([t],null))}}relayStoreChange({source:t,action:i,records:n,replaced:s}){const a=this;a.timeZone!=null&&a._storesWithDates.includes(t)&&["add","replace"].includes(i)&&(!(n!=null&&n.length)&&(s!=null&&s.length)&&(n=s),n.length&&n.forEach(o=>o.timeZone=a.timeZone))}convertStoresToTimeZone(t,i=this.timeZone){var n;const s=this,a=(n=s.stm)==null?void 0:n.autoRecord;a&&(s.stm.autoRecord=!1);for(const o of t)o==null||o.forEach(l=>s.convertRecordToTimeZone(l,i));a&&(s.stmAutoRecord=a)}convertRecordToTimeZone(t,i=this.timeZone){var n;if(t.timeZone!==i){if(t.$ignoreChange=!0,(n=t.baselines)!=null&&n.count)for(const s of t.baselines)t.timeZone!==s.timeZone&&(s.timeZone=t.timeZone),s.convertToTimeZone(i);t.convertToTimeZone(i),t.$ignoreChange=!1}}updateTimeZone(t,i){const n=this,s=n._isConfiguringTimeZone||n.isConfiguring;if(n.trigger("beforeTimeZoneChange",{timeZone:t,oldTimeZone:i,isConfiguring:s}),n.calendarManagerStore.forEach(a=>a.bumpVersion()),n.convertStoresToTimeZone(n._storesWithDates),n._storesWithDates.forEach(a=>n.overrideStoreProcessRecord(a)),n.startDate){const a=i!=null?pt.fromTimeZone(n.startDate,i):n.startDate;n.startDate=t!=null?pt.toTimeZone(a,t):a}n.ignoreRecordChanges=!0,n.commitAsync().then(()=>{n.isDestroyed||n.trigger("timeZoneChange",{timeZone:t,oldTimeZone:i,isConfiguring:s}),delete n._isConfiguringTimeZone})}},R(r,"$name","ProjectModelTimeZoneMixin"),R(r,"configurable",{timeZone:{$config:"lazy",value:null}}),r},Tg=e=>{var r;return r=class extends(e||ae).mixin(Mw,Pw){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:St,resourceTimeRangeModelClass:Sr,timeRangeStoreClass:ee,resourceTimeRangeStoreClass:$o,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return L.safeJsonParse(super.json)}set inlineData(t){this.json=t}construct(t={}){super.construct(...arguments),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const t=this;!t.timeRangeStore.stm&&t.stm.addStore(t.timeRangeStore),!t.resourceTimeRangeStore.stm&&t.stm.addStore(t.resourceTimeRangeStore)}attachStore(t){t&&t.ion({name:t.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(t)}detachStore(t){t&&(this.detachListeners(t.$$name),super.detachStore(t))}relayStoreChange(t){return super.relayStoreChange(t),this.trigger("change",{store:t.source,...t,source:this})}updateTimeRangeStore(t,i){this.detachStore(i),this.attachStore(t)}setTimeRangeStore(t){this.timeRangeStore=t}changeTimeRangeStore(t){return t&&!t.isStore&&(t=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},t)),t}updateResourceTimeRangeStore(t,i){this.detachStore(i),this.attachStore(t)}changeResourceTimeRangeStore(t){return t&&!t.isStore&&(t=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},t)),t}setResourceTimeRangeStore(t){this.resourceTimeRangeStore=t}get events(){return this.eventStore.allRecords}updateEvents(t){this.eventStore.data=t}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(t){this.resourceTimeRangeStore.data=t}async loadInlineData(t){return this.isLoadingInlineData=!0,t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),super.loadInlineData(t)}toJSON(){const t=this,i={eventsData:t.eventStore.toJSON(),resourcesData:t.resourceStore.toJSON(),dependenciesData:t.dependencyStore.toJSON(),timeRangesData:t.timeRangeStore.toJSON(),resourceTimeRangesData:t.resourceTimeRangeStore.toJSON()};return t.eventStore.usesSingleAssignment||(i.assignmentsData=t.assignmentStore.toJSON()),i}get json(){return super.json}changeJson(t){return typeof t=="string"&&(t=L.safeJsonParse(t)),t}updateJson(t){t&&this.loadInlineData(t)}afterChange(t,i){super.afterChange(...arguments),i.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},R(r,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:St},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),r},UI=e=>class extends e{getCurrentConfig(t){const i=this,n=super.getCurrentConfig(t);if(n){for(const s of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const a=i[s];if(a){a.count&&(n[a.id+"Data"]=a.getInlineData(t));const o=a.getCurrentConfig(t);o&&Object.keys(o).length>0?n[s]=Object.assign(n[s]||{},o):n[s]&&Object.keys(n[s]).length===0&&delete n[s]}}return n.timeRangeStore&&((i.timeRangeStore.originalModelClass===i.timeRangeModelClass||i.timeRangeStore.originalModelClass.$name==="TimeSpan")&&delete n.timeRangeStore.modelClass,n.timeRangeStore.storeId==="timeRanges"&&delete n.timeRangeStore.storeId,Object.keys(n.timeRangeStore).length===1&&delete n.timeRangeStore),i.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}},Iw=class extends F{set eventStore(e){const r=this;r.eventStoreDetacher&&r.eventStoreDetacher(),r._eventStore=e,e&&e.autoCommit&&(r.eventStoreDetacher=e.ion({beforecommit:r.onEventStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const r=this;r.resourceStoreDetacher&&r.resourceStoreDetacher(),r._resourceStore=e,e&&e.autoCommit&&(r.resourceStoreDetacher=e.ion({beforecommit:r.onResourceStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const r=this;r.assignmentStoreDetacher&&r.assignmentStoreDetacher(),r._assignmentStore=e,e&&e.autoSync&&(r.assignmentStoreDetacher=e.ion({beforecommit:r.onAssignmentStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const r=this;r.dependencyStoreDetacher&&r.dependencyStoreDetacher(),r._dependencyStore=e,e&&e.autoSync&&(r.dependencyStoreDetacher=e.ion({beforecommit:r.onDependencyStoreBeforeSync,thisObj:r,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){const r=this;return r.removeNonPersistableRecordsToCreate(e),r.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const r=e.added||[];let t,i;for(i=r.length-1;i>=0;--i)t=r[i],t.isPersistable||r.splice(r.indexOf(t),1);r.length===0&&(e.added.length=0)}shallContinueSync(e){return!!(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}};Iw._$name="ModelPersistencyManager";var GI=hw,Ls=class extends UI(Tg(GI)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:Oo,dependencyModelClass:Dt,resourceModelClass:Os,assignmentModelClass:Fo,eventStoreClass:Lo,dependencyStoreClass:bd,resourceStoreClass:cd,assignmentStoreClass:ko}}construct(...e){super.construct(...e),re.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new Iw({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}};Ls.applyConfigs=!0,Ls.initClass(),Ls._$name="ProjectModel";var Cd=class extends og.mixin(Rg,lg,cg){static get defaultConfig(){return{projectClass:Ls,resourceStoreClass:cd,eventStoreClass:Lo,assignmentStoreClass:ko,dependencyStoreClass:bd,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return T.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const r=this;e!==r._project&&(r.detachListeners("beforeDataReady"),r.detachListeners("afterDataReady"),r._project=e,e&&(r.eventStore=e.eventStore,r.resourceStore=e.resourceStore,r.assignmentStore=e.assignmentStore,r.dependencyStore=e.dependencyStore,r.timeRangeStore=e.timeRangeStore,r.resourceTimeRangeStore=e.resourceTimeRangeStore,e.ion({name:"beforeDataReady",dataReady:()=>r.suspendChangesTracking(),prio:100,thisObj:r}),e.ion({name:"afterDataReady",dataReady:()=>r.resumeChangesTracking(),prio:-100,thisObj:r})),r.eventStore||(r.eventStore={}),r.resourceStore||(r.resourceStore={}),r.assignmentStore||(r.assignmentStore={}),r.dependencyStore||(r.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var e;return(e=this._timeRangeStore)==null?void 0:e.store}set timeRangeStore(e){var r;this.setFeaturedStore("_timeRangeStore",e,(r=this.project)==null?void 0:r.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return(e=this._resourceTimeRangeStore)==null?void 0:e.store}set resourceTimeRangeStore(e){var r;this.setFeaturedStore("_resourceTimeRangeStore",e,(r=this.project)==null?void 0:r.resourceTimeRangeStoreClass)}get resourceStore(){var e;return(e=this._resourceStore)==null?void 0:e.store}set resourceStore(e){const r=this;r.setFeaturedStore("_resourceStore",e,r.resourceStoreClass)}get eventStore(){var e;return(e=this._eventStore)==null?void 0:e.store}set eventStore(e){const r=this;r.setFeaturedStore("_eventStore",e,r.eventStoreClass)}get assignmentStore(){var e;return(e=this._assignmentStore)==null?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return(e=this._dependencyStore)==null?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,r,t){var i;const n=this,s=(i=n[e])==null?void 0:i.store;return s!==r&&(r=ee.getStore(r,(r==null?void 0:r.storeClass)||t),s&&n.removeStore(s),n[e]=r&&{store:r}||null,n.addPrioritizedStore(n[e])),n[e]}getChangesetPackage(){const e=super.getChangesetPackage();return e&&this.eventStore.usesSingleAssignment&&(delete e[this.assignmentStore.storeId],!this.crudStores.some(r=>e[r.storeId]))?null:e}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}};R(Cd,"$name","CrudManager"),Cd._$name="CrudManager";var Si=class extends ae{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(e){const r=this,{headers:t}=r,i=[];let n=Object.getPrototypeOf(r.data).id;if(!n){for(let{length:s}=t,a=s-1;a>=0;a--){const{unit:o,increment:l}=t[a],c=l>1;i.push(`${c?l:""}${a?o:L.capitalize(o)}${c?"s":""}`)}n=i.join("And")}return e.count&&e.includes(n)&&(n+=`-${r.tickWidth}by${r.tickHeight||r.tickWidth}`,e.includes(n)&&(n+=`-${r.bottomHeader.increment}`,e.includes(n)&&(n=ji.generateId(`${n}-`)))),n}normalizeUnits(){const e=this,{timeResolution:r,headers:t,shiftUnit:i}=e;if(t)for(let n=0,{length:s}=t;n<s;n++){const a=t[n];a.unit=b.normalizeUnit(a.unit),a.splitUnit&&(a.splitUnit=b.normalizeUnit(a.splitUnit)),"increment"in a||(t[n]=Object.assign({increment:1},a))}r&&(r.unit=b.normalizeUnit(r.unit)),i&&(e.shiftUnit=b.normalizeUnit(i))}static normalizeHeaderConfig(e){const{headerConfig:r,columnLinesFor:t,mainHeaderLevel:i}=e,n=e.headers=[];if(r.top&&(t==="top"&&(e.columnLinesFor=0),i==="top"&&(e.mainHeaderLevel=0),n[0]=r.top),r.middle)t==="middle"&&(e.columnLinesFor=n.length),i==="middle"&&(e.mainHeaderLevel=n.length),n.push(r.middle);else throw new Error("ViewPreset.headerConfig must be configured with a middle");r.bottom&&(e.mainHeaderLevel=n.length-1,t==null?e.columnLinesFor=n.length-1:t==="bottom"&&(e.columnLinesFor=n.length),i==null&&(e.mainHeaderLevel=n.length-1),i==="bottom"&&(e.mainHeaderLevel=n.length),n.push(r.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:r}=this,{length:t}=r;switch(t){case 1:e.middle=r[0];break;case 2:this.mainHeaderLevel===0?(e.middle=r[0],e.bottom=r[1]):(e.top=r[0],e.middle=r[1]);break;case 3:e.top=r[0],e.middle=r[1],e.bottom=r[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:this.data.headers.length===3?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(b.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let r=!0;for(const t of e.headers)r=r&&!!b.normalizeUnit(t.unit);return e.timeResolution&&(r=r&&b.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(r=r&&b.normalizeUnit(e.shiftUnit)),r}};R(Si,"$name","ViewPreset"),Si._$name="ViewPreset";var YI={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:e=>e+" event"+(e!==1?"s":"")},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>`Weekly on ${e}`,"Monthly on {1}":({days:e})=>`Monthly on ${e}`,"Yearly on {1} of {2}":({days:e,months:r})=>`Yearly on ${e} of ${r}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:r})=>`Every ${e} weeks on ${r}`,"Every {0} months on {1}":({interval:e,days:r})=>`Every ${e} months on ${r}`,"Every {0} years on {1} of {2}":({interval:e,days:r,months:t})=>`Every ${e} years on ${r} of ${t}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:r})=>`${e} ${r}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>`Summary for ${e}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}},UF=ct.publishLocale(YI),Sd=class extends Ve(ee){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:Si,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter((r,t)=>{const i=r.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-r.msPerPixel||Kt[i.unit]-Kt[n.unit]||i.increment-n.increment)*this.zoomOrder})}get storage(){return super.storage}getById(e){return super.getById(e)||!this.isPresetManager&&$s.getById(e)}createRecord(e,...r){let t;if(e.isViewPreset)return e;if(typeof e=="string")t=this.getById(e);else if(typeof e=="number")t=this.getAt(e);else return e.base&&(e=this.copyBaseValues(e)),super.createRecord(e,...r);if(!t)throw new Error(`ViewPreset ${e} does not exist`);return t}updateLocalization(){super.updateLocalization();const e=this;let r=e.allRecords;e.isPresetManager&&(r=new Set(r.concat(Object.values(e.basePresets)))),r.forEach(t=>{let i=e.optionalL(`L{PresetManager.${t.id}}`,null,!0);typeof i=="string"&&t.baseId&&(i=e.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),i&&typeof i=="object"&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),t.mainHeaderLevel===0&&i.topDateFormat&&(i.middleDateFormat=i.middleDateFormat||i.topDateFormat),t.setData("displayDateFormat",i.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach(n=>{const s=t.headerConfig[n],a=i[n+"DateFormat"];s&&(s.originalDateFormat||(s.originalDateFormat=s.dateFormat),a&&s.renderer&&(s.renderer=null),s.dateFormat=a||s.originalDateFormat)}),i.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",i.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))})}getCurrentConfig(e){return super.getCurrentConfig(e).data}copyBaseValues(e){let r=this.getById(e.base);if(!r)throw new Error(`ViewPreset base '${e.base}' does not exist.`);return r=T.clone(r.data),delete r.id,delete r.name,T.merge(r,e)}add(e){return e=Array.isArray(e)?e:[e],e.forEach(r=>{r.isViewPreset&&r.base&&(r.data=this.copyBaseValues(r.originalData))}),super.add(...arguments)}};Sd._$name="PresetStore";var qI=class extends Sd{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(e){return`
                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${b.format(e,"HH")}</span>
                                    <span class="b-sch-calendarcolumn-minutes">${b.format(e,"mm")}</span></div>
                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(e){return`
                                    <div class="sch-calendarcolumn-ct">
                                    <span class="sch-calendarcolumn-hours">${b.format(e,"HH")}</span>
                                    <span class="sch-calendarcolumn-minutes">${b.format(e,"mm")}</span>
                                    </div>
                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(e){return b.getShortNameOfUnit("week")+"."+b.format(e,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(e,r,t){return b.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,r)=>e.getFullYear()+" - "+r.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(e){const r=this._basePresets={};for(const t in e)e[t].id=t,r[t]=this.createRecord(e[t])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let r=0,{length:t}=e;r<t;r++){const i=e[r],n=typeof i=="string",s=n?i:i.base;let a;if(n)a=this.basePresets[s];else{const o=Object.setPrototypeOf(T.clone(this.basePresets[s].data),{id:s}),{timeResolution:l}=o,c=o.headers[o.headers.length-1];o.id=void 0,"width"in i&&(o.tickWidth=i.width),"height"in i&&(o.tickHeight=i.height),"increment"in i&&(c.increment=i.increment),"resolution"in i&&(l.increment=i.resolution),"resolutionUnit"in i&&(l.unit=b.getUnitByName(i.resolutionUnit)),a=this.createRecord(o),a.baseId=s}this.add(a)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,r){const t=this.createRecord(Object.assign({id:e},r)),i=this.find(n=>n.equals(t));if(i)return i;if(t.isValid)this.add(t);else throw new Error("Invalid preset, please check your configuration");return t}getPreset(e){return typeof e=="number"&&(e=this.getAt(e)),typeof e=="string"?e=this.getById(e):e instanceof Si||(e=this.createRecord(e)),e}normalizePreset(e){const r=this;if(!(e instanceof Si)){if(typeof e=="string"){if(e=r.getPreset(e),!e)throw new Error("You must define a valid view preset. See PresetManager for reference")}else if(typeof e=="object"){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=T.merge(T.clone(t.data),e)}e.id?e=r.createRecord(e):(e=r.createRecord(T.assign({},e)),e.id=e.generateId(e))}}return e}deletePreset(e){typeof e=="string"?e=this.getById(e):typeof e=="number"&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}},$s=new qI,KI=class extends St{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}},Mg=class extends ee{static get defaultConfig(){return{modelClass:KI,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const r=this;if(super.construct(e),r.originalContinuous=r.continuous,r.ion({change:({action:t})=>{t!=="filter"&&r.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>r.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:t=>r.trigger("reconfigure",t)}),r.startDate)r.internalOnReconfigure(),r.trigger("reconfigure");else if(r.viewPreset){const t=r.getAdjustedDates(new Date);r.startDate=t.startDate,r.endDate=t.endDate}}get isTimeAxis(){return!0}reconfigure(e,r=!1,t=!1){const i=this,n=i.getAdjustedDates(e.startDate,e.endDate),s={};if(i.trigger("beforeReconfigure",{startDate:n.startDate,endDate:n.endDate,config:e})!==!1){i.trigger("beginReconfigure"),i._configuredStartDate=e.startDate,i._configuredEndDate=e.endDate;for(const o in e)s[o]=i[o];const a=e.viewPreset&&e.viewPreset!==i.viewPreset;if(a&&(t=i.isFiltered,i.filters.forEach(o=>o.disabled=!1)),Object.assign(i,e),i.internalOnReconfigure(t,a)===!1)return!1;i.trigger("endReconfigure",{suppressRefresh:r,config:e,oldConfig:s})}}internalOnReconfigure(e=!1,r){const t=this;t.isConfigured=!0;const i=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),s=n.startDate,a=n.endDate;if(s>=a)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${a}.`);const{unit:o,increment:l=1}=t,c=t.generateTicks(s,a,o,l);t.suspendEvents(),t.maintainFilter=e,t.data=c,t.maintainFilter=!1;const{count:d}=t;if(d===0){if(e)return r&&t.disableFilters(),t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=i.startDate,t.adjustedEnd=b.getNext(d>1?c[d-1].startDate:i.startDate,o,l,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:r,unit:t,startDate:i,endDate:n,weekStartDay:s,increment:a=1}=e,o=b.getNormalizedUnitDuration(i,t)*a,l=b.getNormalizedUnitDuration(n,t)*a;do e.visibleTickStart=(i-e.adjustedStart)/o,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=b.getNext(e.adjustedStart,t,a,s));while(e.visibleTickStart>=1);do e.visibleTickEnd=r-(e.adjustedEnd-n)/l,r-e.visibleTickEnd>=1&&(e.adjustedEnd=b.getNext(e.adjustedEnd,t,-1,s));while(r-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===r}get viewPreset(){return this._viewPreset}set viewPreset(e){const r=this;if(e=$s.getPreset(e),!(e instanceof Si))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");r._viewPreset=e,Object.assign(r,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){var e;return(e=this._weekStartDay)!=null?e:b.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,r,t=!1){r&&e-r===0&&(r=null);const i=this,{startDate:n,endDate:s}=i.getAdjustedDates(e,r);if(i.startDate-n!==0||i.endDate-s!==0)return i.reconfigure({startDate:n,endDate:s},!1,t)}shift(e,r=this.shiftUnit){const t=this;let{startDate:i,endDate:n}=t;t.isFiltered&&(i=t.allRecords[0].startDate,n=t.allRecords[t.allCount-1].endDate);let s=0;do i=b.add(i,e,r),n=b.add(n,e,r);while(s++<t.maxTraverseTries&&t.setTimeSpan(i,n,{preventThrow:!0})===!1)}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,r=this){this.filters.clear(),super.filterBy((i,n)=>e.call(r,i.data,n))}filter(){const e=this,r=super.filter(...arguments);return!e.maintainFilter&&e.count===0&&(e.resumeEvents(),e.trigger("invalidFilter"),e.disableFilters()),r}disableFilters(){this.filters.forEach(e=>e.disabled=!0),this.filter()}triggerFilterEvent(e){const r=this;e.filters.count?r.continuous=!1:r.continuous=r.originalContinuous,r.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return this.continuous!==!1&&!this.isFiltered}getAdjustedDates(e,r,t=!1){const i=this;return r&&e-r===0&&(r=null),e=e||i.startDate,r=r||b.add(e,i.defaultSpan,i.mainUnit),i.autoAdjust||t?{startDate:i.floorDate(e,!1,i.autoAdjust?i.mainUnit:i.unit,1),endDate:i.ceilDate(r,!1,i.autoAdjust?i.mainUnit:i.unit,1)}:{startDate:e,endDate:r}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=b.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=b.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,r,t,i){r=r!==!1;const n=this,s=r?b.clone(n.startDate):null,a=i||n.resolutionIncrement,o=t||(r?n.resolutionUnit:n.mainUnit),l=(d,u)=>Math.floor(d/u)*u;if(r){const d=l(b.diff(s,e,o),a);return b.add(s,d,o,!1)}const c=b.clone(e);if(o==="week"){const d=c.getDay()||7,u=n.weekStartDay||7;b.add(b.startOf(c,"day",!1),d>=u?u-d:-(7-u+d),"day",!1),c.getDay()!==u&&c.getHours()===23&&b.add(c,1,"hour",!1)}else{b.startOf(c,o,!1);const d=["day","year"].includes(o)?1:0,u=o==="day"?"date":o,h=l(b.get(c,u)-d,a)+d;b.set(c,u,h)}return c}roundDate(e,r,t=this.resolutionUnit,i=this.resolutionIncrement||1){const n=this,s=b.clone(e);switch(r=b.clone(r||n.startDate),t){case"week":{b.startOf(s,"day",!1);let a=s.getDay()-n.weekStartDay,o;return a<0&&(a=7+a),Math.round(a/7)===1?o=7-a:o=-a,b.add(s,o,"day",!1)}case"month":{const a=b.diff(r,s,"month")+b.as("month",s.getDay()/b.daysInMonth(s)),o=Math.round(a/i)*i;return b.add(r,o,"month",!1)}case"quarter":return b.startOf(s,"month",!1),b.add(s,3-s.getMonth()%3,"month",!1);default:{const a=b.as(t,b.diff(r,s)),o=b.as(t,r.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),l=Math.round((a+o)/i)*i;return b.add(r,l-o,t,!1)}}}ceilDate(e,r,t,i){const n=this;r=r!==!1,i=i||(r?n.resolutionIncrement:1);const s=t||(r?n.resolutionUnit:n.mainUnit),a=b.clone(e);let o=!1;switch(s){case"minute":o=!b.isStartOf(a,"minute");break;case"hour":o=!b.isStartOf(a,"hour");break;case"day":case"date":o=!b.isStartOf(a,"day");break;case"week":b.startOf(a,"day",!1),o=a.getDay()!==n.weekStartDay||!b.isEqual(a,e);break;case"month":b.startOf(a,"day",!1),o=a.getDate()!==1||!b.isEqual(a,e);break;case"quarter":b.startOf(a,"day",!1),o=a.getMonth()%3!==0||a.getDate()!==1||!b.isEqual(a,e);break;case"year":b.startOf(a,"day",!1),o=a.getMonth()!==0||a.getDate()!==1||!b.isEqual(a,e);break}return o?b.getNext(a,s,i,n.weekStartDay):a}get include(){return this._include}set include(e){const r=this;r._include=e,r.continuous=!e,r.isConfiguring||(r.startDate=r._configuredStartDate,r.endDate=r._configuredEndDate,r.internalOnReconfigure(),r.trigger("includeChange"))}processExclusion(e,r,t){const{include:i}=this;return i?Object.entries(i).some(([n,s])=>{if(!s)return!1;const{from:a,to:o}=s;if(b.compareUnits("day",t)>=0&&b.getLargerUnit(n)===t&&(a&&b.set(e,n,a),o)){let l=t;t==="day"&&(l="date"),b.set(r,{[l]:b.get(r,l)-1,[n]:o})}if(b.compareUnits(n,t)>=0){const l=n==="day"?e.getDay():b.get(e,n);if(a&&l<a||o&&l>=o)return!0}}):!1}initExclusion(){Object.entries(this.include).forEach(([e,r])=>{if(r){const{from:t,to:i}=r;r.lengthFactor=b.getUnitToBaseUnitRatio(e,b.getLargerUnit(e))/(i-t),r.lengthFactorExcl=b.getUnitToBaseUnitRatio(e,b.getLargerUnit(e))/(i-t-1),r.center=t+t/(r.lengthFactor-1)}})}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,r,t=this.unit,i=this.increment){const n=this,s=[],a=!!n.include;let o,l,c,d=0,{startDate:u,endDate:h}=n.getAdjustedDates(e,r);for(n.tickCache={},a&&n.initExclusion();u<h;){if(o=b.getNext(u,t,i,n.weekStartDay),!n.autoAdjust&&o>h&&(o=h),t==="hour"&&i>1&&s.length>0&&d===0){const f=s[s.length-1];d=(f.startDate.getHours()+i)%24-f.endDate.getHours(),d!==0&&(o=b.add(o,d,"hour"))}c=!1,a?(l=new Date(o.getTime()),c=n.processExclusion(u,o,t)):l=o,c||(s.push({id:s.length+1,startDate:u,endDate:o}),n.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var r,t;const i=this,n=i.records,s=(t=(r=e.getTime)==null?void 0:r.call(e))!=null?t:e;let a=0,o=n.length-1,l,c,d,u;if(!n.length||s<n[0].startDateMS||s>n[o].endDateMS)return-1;if(i.isContinuous){for(;a<o;)l=a+o+1>>1,s>n[l].endDateMS?a=l+1:s<n[l].startDateMS?o=l-1:a=l;return c=n[a],d=c.startDateMS,s>d&&(u=c.endDateMS,a+=(s-d)/(u-d)),Math.min(Math.max(a,i.visibleTickStart),i.visibleTickEnd)}else for(let h=0;h<=o;h++)if(u=n[h].endDateMS,s<=u)return d=n[h].startDateMS,c=h+(s>d?(s-d)/(u-d):0),c}getDateFromTick(e,r){const t=this;if(e===t.visibleTickEnd)return t.endDate;const i=Math.floor(e),n=e-i,s=t.getAt(i);if(!s)return null;const a=i===0&&t.isContinuous?t.adjustedStart:s.startDate,o=i===t.count-1&&t.isContinuous?t.adjustedEnd:s.endDate;let l=b.add(a,n*(o-a),"millisecond");return r&&(l=t[r+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const r=this;r.count?(r._start=r.first.startDate,r._end=r.last.endDate,r._startMS=r.startDate.getTime(),r._endMS=r.endDate.getTime()):r._start=r._end=r._startMs=r._endMS=null,e||(r.tickCache={},r.forEach((t,i)=>r.tickCache[t.startDate.getTime()]=i))}dateInAxis(e,r=!1){const t=this,i=t.startDate,n=t.endDate;if(t.isContinuous)return r?b.betweenLesserEqual(e,i,n):b.betweenLesser(e,i,n);{const s=t.getCount();let a,o,l;for(let c=0;c<s;c++)if(l=t.getAt(c),a=l.startDate,o=l.endDate,r&&e<=o||!r&&e<o)return e>=a}return!1}timeSpanInAxis(e,r){const t=this;return!r||r.getTime()===e.getTime()?this.dateInAxis(e,!0):t.isContinuous?b.intersectSpans(e,r,t.startDate,t.endDate):e<t.startDate&&r>t.endDate||t.getTickFromDate(e)!==t.getTickFromDate(r)}isTimeSpanInAxis(e){var r;const t=this,{startMS:i,endMS:n}=t,{startDateMS:s}=e,a=(r=e.endDateMS)!=null?r:e.meta.endDateCached;if(!s||!a)return!1;if(a===s)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return a>i&&s<n;const o=t.getTickFromDate(e.startDate),l=t.getTickFromDate(e.endDate);return o===t.count&&b.isEqual(e.startDate,t.last.endDate)||l===0&&b.isEqual(e.endDate,t.first.startDate)?!1:s<i&&a>n||o!==l}forEachAuxInterval(e,r=1,t,i=this){const n=this.endDate;let s=this.startDate,a=0,o;if(s>n)throw new Error("Invalid time axis configuration");for(;s<n;)o=b.min(b.getNext(s,e,r,this.weekStartDay),n),t.call(i,s,o,a,o>=n),s=o,a++}};Mg._$name="TimeAxis";var Pg=class extends Ve(){static get $name(){return"RecurrenceLegend"}static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter((e,r)=>!b.nonWorkingDays[r]).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter((e,r)=>b.nonWorkingDays[r]).join(",")}static getLegend(e,r){const t=this,{timeSpan:i,interval:n,days:s,monthDays:a,months:o,positions:l}=e,c=r||i.startDate,d={interval:n};let u;switch(e.frequency){case"DAILY":return n===1?t.L("L{Daily}"):t.L("L{Every {0} days}",d);case"WEEKLY":return s&&s.length?d.days=t.getDaysLegend(s):c&&(d.days=b.getDayName(c.getDay())),t.L(n===1?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return s&&s.length&&l&&l.length?d.days=t.getDaysLegend(s,l):a&&a.length?(a.sort((h,f)=>h-f),d.days=t.arrayToText(a)):c&&(d.days=c.getDate()),t.L(n===1?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return s&&s.length&&l&&l.length?d.days=t.getDaysLegend(s,l):d.days=c.getDate(),o&&o.length?(o.sort((h,f)=>h-f),o.length>2?u=h=>b.getMonthShortName(h-1):u=h=>b.getMonthName(h-1),d.months=t.arrayToText(o,u)):d.months=b.getMonthName(c.getMonth()),t.L(n===1?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,r){const t=this,i={position:""};let n;if(r&&r.length&&(i.position=t.arrayToText(r,s=>t.L(`L{position${s}}`))),e.length)switch(e.sort((s,a)=>kt.decodeDay(s)[0]-kt.decodeDay(a)[0]),e.join(",")){case t.allDaysValue:i.days=t.L("L{day}");break;case t.workingDaysValue:i.days=t.L("L{weekday}");break;case t.nonWorkingDaysValue:i.days=t.L("L{weekend day}");break;default:e.length>2?n=s=>b.getDayShortName(kt.decodeDay(s)[0]):n=s=>b.getDayName(kt.decodeDay(s)[0]),i.days=t.arrayToText(e,n)}return t.L("L{daysFormat}",i)}static arrayToText(e,r){return r&&(e=e.map(r)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}};Pg._$name="RecurrenceLegend";var er=e=>class extends e{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){super.afterConstruct();const t=this,i=t.client||t.grid,{project:n}=i;i.projectSubscribers.push(t),n&&(t.attachToProject(n),t.attachToResourceStore(n.resourceStore),t.attachToEventStore(n.eventStore),t.attachToAssignmentStore(n.assignmentStore),t.attachToDependencyStore(n.dependencyStore),t.attachToCalendarManagerStore(n.calendarManagerStore))}attachToProject(t){this.detachListeners("project"),this._project=t}attachToEventStore(t){this.detachListeners("eventStore")}attachToResourceStore(t){this.detachListeners("resourceStore")}attachToAssignmentStore(t){this.detachListeners("assignmentStore")}attachToDependencyStore(t){this.detachListeners("dependencyStore")}attachToCalendarManagerStore(t){this.detachListeners("calendarManagerStore")}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}},Aw=["assignmentStore","dependencyStore","eventStore","resourceStore"],_w=e=>{var r,t;return t=class extends(e||F){constructor(){super(...arguments),Ex(this,r,void 0)}static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:Ls,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(i){this.getConfig("project"),super.startConfigure(i)}changeProject(i,n){const s=this,{projectStoreNames:a,projectDataNames:o}=s.constructor;if(s.projectCallbacks=new Set,i){if(s.buildingProjectConfig=!0,!i.isModel){if(s.isConfiguring){s._project=i;const{crudManager:d}=s;if(d){const{isCrudManager:u}=d;for(const h of a)d[h]&&(s[h]=d[h],u||delete d[h])}s.getConfig("projectStores");for(const u of o)s.getConfig(u)}const{eventStore:l}=i;let{_sharedProject:c}=s;if(l&&!l.isEventStoreMixin&&l.autoLoad&&!l.count&&(l.autoLoad=!1,s.delayAutoLoad=!0),c&&Aw.some(d=>i[d]&&i[d]!==c[d])){for(const d of Aw)i[d]&&i[d]===c[d]&&(i[d]=i[d].chain());c=null}i=c||new s.projectModelClass(i),delete s._project}s.buildingProjectConfig=!1}return i}updateProject(i,n){var s;const a=this,{projectListeners:o,crudManager:l}=a;if(a.detachListeners("projectConsumer"),delete a._crudManager,i){o.thisObj=a,i.ion(o),i.isCrudManager?a.crudManager=i:l&&(l.project=i,a.crudManager=l),a.projectSubscribers.forEach(c=>c.attachToProject(i));for(const c of a.constructor.projectStoreNames)a[c]=i[c];a.delayAutoLoad&&(i.eventStore.autoLoad=!0,i.eventStore.load()),(s=i.stm)==null||s.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:a})}a.trigger("projectChange",{project:i})}changeCrudManager(i){if(this.buildingProjectConfig)this._crudManager=i.isCrudManager?i:Object.assign({},i);else return super.changeCrudManager(i)}onProjectDataReady(){const i=this;i.whenVisible(()=>{i.projectCallbacks.size&&(i.projectCallbacks.forEach(n=>n()),i.projectCallbacks.clear())},null,null,"onProjectDataReady")}onProjectRestoringStart({stm:i}){const{rawQueue:n}=i;n.length&&n[n.length-1].length>1&&(Lv(this,r,!0),this.suspendRefresh())}onProjectRestoringStop(){Dx(this,r)&&(Lv(this,r,!1),this.resumeRefresh(!0))}onBeforeTimeZoneChange(){}onTimeZoneChange({timeZone:i,oldTimeZone:n}){const s=this;if(s.startDate&&s.timeAxis.timeZone!==i){const a=n!=null?pt.fromTimeZone(s.startDate,n):s.startDate;s.startDate=i!=null?pt.toTimeZone(a,i):a,s.timeAxis.timeZone=i}}whenProjectReady(i){this.isEngineReady?i():this.projectCallbacks.add(i)}get isEngineReady(){var i,n;return!!((n=(i=this.project).isEngineReady)!=null&&n.call(i))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:i}=this.constructor;return i.map(n=>this[n])}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce((i,n)=>{const{dataName:s}=this.projectStores[n];return s&&i.push(s),i},[])}static setupProjectStores(i,n){const{projectStores:s}=i;if(s){const a={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange"},o={projectListeners:a};let l;for(const c in s){const{dataName:d}=s[c];o[c]=o[d]=null,d&&(Object.defineProperty(n.class.prototype,d,{configurable:!0,get(){var u;return(u=this.project[c])==null?void 0:u.records}}),this.createDataUpdater(c,d,l,n)),this.createStoreDescriptor(n,c,s[c],a),l=d}this.setupConfigs(n,o)}}static createDataUpdater(i,n,s,a){a.class.prototype[`update${L.capitalize(n)}`]=function(o){const{project:l}=this;s&&this.getConfig(s),this.buildingProjectConfig?l[`${n}Data`]=o:l[i].data=o}}static createStoreDescriptor(i,n,{listeners:s},a){const{prototype:o}=i.class,l=L.capitalize(n);a[`${n}Change`]=function({store:c}){this[n]=c},o[`change${l}`]=function(c,d){const u=this,{project:h}=u,f=c==null?void 0:c.project;if(u.buildingProjectConfig){f!=null&&f.isProjectModel&&(u._sharedProject=f),h[n]=c;return}return u.initializingProject||h[n]!==c&&(h[`set${l}`](c),c=h[n]),c!==d&&(s&&(s.thisObj=u,s.name=`${n}Listeners`,u.detachListeners(s.name),c.ion(s)),u[`_${n}`]=c,u.projectSubscribers.forEach(g=>{var m;(m=g[`attachTo${l}`])==null||m.call(g,c)}),u[`_${n}`]=null),c}}relayProjectDataChange(i){if(!((i.isExpand||i.isCollapse)&&!i.records[0].fieldMap.expanded.persist))return this.trigger("dataChange",{project:i.source,...i,source:this})}get widgetClass(){}},r=new WeakMap,t},Ig=class extends F{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}applyLayout(e,r){return this.nbrOfBandsByResource[r.id]=this.layoutEventsInBands(e,r)}layoutEventsInBands(e,r){throw new Error("Implement in subclass")}};Ig._$name="HorizontalLayout";var Ag=e=>class extends(e||F){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(t,i){return this.grouped?t.group===i.group:!0}packEventsInBands(t,i){const n=this,{coordProp:s,sizeProp:a}=n;let o,l,c,d;for(let u=0,h=t.length;u<h;u++){if(l=t[u],o=n.findStartSlot(t,l),c=n.getCluster(t,u),c.length>1){for(l[s]=o.start,l[a]=o.end-o.start,d=1;d<c.length-1&&c[d+1].start-l.start===0;)d++;const m=n.findStartSlot(t,c[d]);m&&m.start<.8&&(c.length=d)}const f=c.length,g=(o.end-o.start)/f;for(d=0;d<f;d++)i(c[d],d,o,g);u+=f-1}return 1}findStartSlot(t,i){const{inBandSizeProp:n,inBandCoordProp:s,coordProp:a,sizeProp:o}=this,l=this.getPriorOverlappingEvents(t,i);let c;if(l.length===0)return{start:0,end:1};for(c=0;c<l.length;c++){const d=l[c],u=s in d?s:a,h=n in d?n:o;if(c===0&&d[u]>0)return{start:0,end:d[u]};if(d[u]+d[h]<(c<l.length-1?l[c+1][u]:1))return{start:d[u]+d[h],end:c<l.length-1?l[c+1][u]:1}}return!1}getPriorOverlappingEvents(t,i){const n=i.start,s=i.end,a=[];for(let o=0,l=t.indexOf(i);o<l;o++){const c=t[o];this.isSameGroup(c,i)&&b.intersectSpans(n,s,c.start,c.end)&&a.push(c)}return a.sort(this.sortOverlappers.bind(this)),a}sortOverlappers(t,i){const{coordProp:n}=this;return t[n]-i[n]}getCluster(t,i){const n=t[i],s=[n];if(i>=t.length-1)return s;let{start:a,end:o}=n;for(let l=i+1,c=t.length;l<c;l++){const d=t[l];if(!this.isSameGroup(d,n)||!b.intersectSpans(a,o,d.start,d.end))break;s.push(d),a=b.max(a,d.start),o=b.min(d.end,o)}return s}},wd=class extends Ig.mixin(Ag){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(e){const r=this.packEventsInBands(e,(t,i,n,s)=>{t.height=s,t.top=n.start+i*s});return e.forEach(t=>{Object.assign(t,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t.top,t.height,t.eventRecord,t.resourceRecord))}),r}};wd._$name="HorizontalLayoutPack";var Dd=class extends Ig{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(e,r,t=!1){let i=0;do{let n=0,s=e[0];for(;s;)t||(s.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,i,s.eventRecord,s.resourceRecord)),e.splice(n,1),n=this.findClosestSuccessor(s,e),s=e[n];i++}while(e.length>0);return i}findClosestSuccessor(e,r){const{endMS:t,group:i}=e,n=e.eventRecord&&e.eventRecord.duration===0;let s=1/0,a,o,l;for(let c=0,d=r.length;c<d;c++)if(l=r[c],o=l.startMS-t,o>=0&&o<s&&(o>0||l.endMS-l.startMS>0||!n)){if(this.grouped&&i!==l.group)break;a=c,s=o}return a}};Dd._$name="HorizontalLayoutStack";var fn=class extends F{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">
                    <div class="b-sch-clock">
                        <div class="b-sch-hour-indicator">${b.format(e.date,"MMM")}</div>
                        <div class="b-sch-minute-indicator">${b.format(e.date,"D")}</div>
                        <div class="b-sch-clock-dot"></div>
                    </div>
                    <span class="b-sch-clock-text">${L.encodeHtml(e.text)}</span>
                </div>`}}}generateContent(e){return this.div.innerHTML=this.template(e)}updateDateIndicator(e,r){const t=e==null?void 0:e.querySelector(".b-sch-hour-indicator"),i=e==null?void 0:e.querySelector(".b-sch-minute-indicator");r&&t&&i&&Y.isBrowserEnv&&(this.mode==="hour"?(t.style.transform=`rotate(${r.getHours()%12*30}deg)`,i.style.transform=`rotate(${r.getMinutes()*6}deg)`):(t.style.transform="none",i.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=b.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,r=b.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&r?"hour":"day"}set template(e){this._template=e}get template(){return this._template}};fn._$name="ClockTemplate";var _g=class extends X{static get defaultConfig(){return{tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onPaint"]}}internalSnapToPosition(e){var r;const{dragData:t}=this;(r=this.snapToPosition)==null||r.call(this,{assignmentRecord:t.assignmentRecord,eventRecord:t.eventRecord,resourceRecord:t.newResource||t.resourceRecord,startDate:t.startDate,endDate:t.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:r,constrainDragToTimeline:t,constrainDragToResource:i,constrainDragToTimeSlot:n,dragHelperConfig:s={}}=e,{timeAxisViewModel:a,isHorizontal:o}=r,l=o?i:n,c=o?n:i;return e.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),U.merge({name:e.constructor.name,positioning:"absolute",lockX:c,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!t,removeProxyAfterDrop:!1,dragWithin:t?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:r.timeAxisSubGridElement,targetSelector:r.eventSelector,scrollManager:t?r.scrollManager:null,createProxy:d=>e.createProxy(d),snapCoordinates:({element:d,newX:u,newY:h})=>{const{dragData:f}=e;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||a.snap)){const m=f.draggedEntities[0],p=e.getCoordinate(m,d,[u,h]),v=a.getDateFromPosition(p,"round"),{calendar:y}=m;if(!y||v&&y.isWorkingTime(v,b.add(v,m.fullDuration))){const S=v&&a.getPositionFromDate(v);v&&v>=r.startDate&&S!=null&&(o?u=S:h=S)}}const g={x:u,y:h};return e.internalSnapToPosition(g),g},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},s,{isElementDraggable:(d,u)=>(!s||!s.isElementDraggable||s.isElementDraggable(d,u))&&e.isElementDraggable(d,u)})}onPaint({firstPaint:e}){var r;const t=this,{client:i}=t;(r=t.drag)==null||r.destroy(),t.drag=Yi.new(t.buildDragHelperConfig()),e&&i.rowManager.ion({changeTotalHeight:()=>{var n;return t.updateYConstraint((n=t.dragData)==null?void 0:n[`${i.scheduledEventName}Record`])},thisObj:t}),t.showTooltip&&(t.clockTemplate=new fn({scheduler:i}))}doDestroy(){var e,r,t;(e=this.drag)==null||e.destroy(),(r=this.clockTemplate)==null||r.destroy(),(t=this.tip)==null||t.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,r){const t=this;if(e){const i=ue.reconfigure(r,ue.mergeConfigs({forElement:t.element,id:t.tipId,getHtml:t.getTipHtml.bind(t),cls:t.tooltipCls,owner:t.client},e),{owner:t.client,defaults:{type:"tooltip"}});return i.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:t}),i}else r==null||r.destroy()}createProxy(e){const r=e.cloneNode(!0);return delete r.id,r.classList.add(`b-sch-${this.client.mode}`),r}onBeforeDragStart({context:e,event:r}){var t;const i=this,{client:n}=i,s=i.getMinimalDragData(e,r),a=s==null?void 0:s[`${n.scheduledEventName}Record`],o=s.resourceRecord;if(n.readOnly||i.disabled||!a||a.isDraggable===!1||a.readOnly||o!=null&&o.readOnly)return!1;e.pointerStartDate=n.getDateFromXY([e.startClientX,e.startPageY],null,!1);const l=i.triggerBeforeEventDrag(`before${n.capitalizedEventName}Drag`,{...s,event:r,context:{...e,...s}})!==!1;return l&&(i.updateYConstraint(a,o),(t=n[`before${n.capitalizedEventName}DragStart`])==null||t.call(n,e,s)),l}onAfterDragStart({context:e,event:r}){}get isDragging(){var e;return(e=this.drag)==null?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:r}){var t,i,n;const s=this,a=(t=s.findClientFromTarget(r,e))!=null?t:s.client;s.currentOverClient=a,s.drag.unifiedProxy=s.unifiedDrag,s.onMouseOverNewTimeline(a,!0);const o=s.dragData=s.getDragData(e);if(s.suspendElementRedrawing(e.element),s.showTooltip&&s.tip){const u=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;s.tip.showBy(u)}s.triggerDragStart(o),(i=a[`after${a.capitalizedEventName}DragStart`])==null||i.call(a,e,o);const{eventMenu:l,taskMenu:c}=a.features,d=l||c;(n=d==null?void 0:d.hideContextMenu)==null||n.call(d,!1)}updateDateIndicator(){const{startDate:e,endDate:r}=this.dragData,{tip:t,clockTemplate:i}=this,n=t.element.querySelector(".b-sch-tooltip-enddate");i.updateDateIndicator(t.element,e),n&&i.updateDateIndicator(n,r)}findClientFromTarget(e,r){let{target:t}=e;if(/^touch/.test(e.type)){const n=k.from(r.element,null,!0).center;t=C.elementFromPoint(n.x,n.y)}const i=$.fromElement(t,"timelinebase");return i!=null&&i.isResourceHistogram?null:i}onDrag({context:e,event:r}){const t=this,i=t.dragData,n=i.startDate;let s;if(t.constrainDragToTimeline?s=t.client:s=t.findClientFromTarget(r,i.context),t.updateDragContext(e,r),!!s){if(s!==t.currentOverClient&&t.onMouseOverNewTimeline(s),i.dirty||!t.throttleDragEvent){const a=i.valid;t.triggerEventDrag(i,n),a!==i.valid&&(i.context.valid=i.externalDragValidity=i.valid)}t.showTooltip&&t.tip&&(t.tip.lastAlignSpec.allowTargetOut=!i.valid,t.tip.realign())}}onMouseOverNewTimeline(e,r){const t=this,{drag:{lockX:i,lockY:n}}=t,s=[];t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),r||t.currentOverClient.scrollManager.stopMonitoring(),i||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s,callback:t.drag.onScrollManagerScrollCallback}),t.currentOverClient=e}triggerBeforeEventDropFinalize(e,r,t){t.trigger(e,r)}onDrop({context:e,event:r}){var t;const i=this,{currentOverClient:n,dragData:s}=i;let a=!1;if((t=i.tip)==null||t.hide(),e.valid=e.valid&&i.isValidDrop(s),i.drag.removeProxyAfterDrop=!!s.externalDropTarget,e.valid&&s.startDate&&s.endDate){let o=!1;s.finalize=async l=>{o||s.async?await i.finalize(l):e.valid=e.valid&&l},i.triggerBeforeEventDropFinalize(`before${n.capitalizedEventName}DropFinalize`,{context:s,domEvent:r},n),o=!0,e.async=s.async,!e.async&&!s.externalDropTarget&&(a=s.startDate-s.origStart!==0||s.newResource!==s.resourceRecord)}e.async||i.finalize(s.valid&&e.valid&&a)}onDragAbort({context:e}){var r;const t=this;t.client.currentOrientation.onDragAbort({context:e,dragData:t.dragData}),t.resetDraggedElements(),(r=t.tip)==null||r.hide(),t.triggerDragAbort(t.dragData)}onDragAbortFinalized({context:e}){var r,t;const i=this;i.triggerDragAbortFinalized(i.dragData),(t=(r=i.client)[`after${i.client.capitalizedEventName}DragAbortFinalized`])==null||t.call(r,e,i.dragData)}onDragReset({source:e}){var r;const t=this,i=t.currentOverClient;i==null||i.scrollManager.stopMonitoring(),(r=e.context)!=null&&r.started&&(t.resetDraggedElements(),i.trigger(`${i.scheduledEventName}DragReset`)),i==null||i.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),t.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:r,draggedEntities:t}=e;this.resumeRecordElementRedrawing(e.record),t.forEach((i,n)=>{this.resumeRecordElementRedrawing(i),r[n].classList.remove(this.drag.draggingCls),r[n].retainElement=!1}),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var r;const t=this,{context:i}=t.drag;(r=t.tip)==null||r.hide(),t.triggerAfterDrop(t.dragData,!1),i.valid=!1,e&&t.drag.abort()}async finalize(e){const r=this,{dragData:t}=r;if(!t||r.finalizing)return;const{context:i,draggedEntities:n,externalDropTarget:s}=t;let a;return r.finalizing=!0,n.forEach((o,l)=>{r.resumeRecordElementRedrawing(o),t.eventBarEls[l].classList.remove(r.drag.draggingCls),t.eventBarEls[l].retainElement=!1}),i.element.retainElement=!1,s&&t.valid||e?(a=r.updateRecords(t),!s&&U.isPromise(a)&&(i.async=!0,await a),t.valid?(i.async&&i.finalize(),s&&r.client.refreshRows(!1),r.triggerAfterDrop(t,!0)):r.onInternalInvalidDrop(!0)):r.onInternalInvalidDrop(i.async||t.async),r.finalizing=!1,a}updateDragContext(e,r){var t,i,n;const s=this,{drag:a}=s,o=s.dragData,l=s.currentOverClient,{isHorizontal:c}=l,[d]=o.draggedEntities,u=d.isAssignment?d.event:d,h=o.startDate,f=s.constrainDragToTimeSlot||(c?a.lockX:a.lockY);if(o.browserEvent=r,Object.assign(o,s.getProductDragContext(o)),f)o.timeDiff=0;else{let m;if(l.timeAxis.isContinuous){const p=l.isHorizontal?(t=e.pageX)!=null?t:e.startPageX:(i=e.pageY)!=null?i:e.startPageY,v=l.getDateFromCoordinate(p,null,!1,!0);m=o.timeDiff=v-e.pointerStartDate}else{const p=s.resolveStartEndDates(e.element);o.valid=!!(p.startDate&&p.endDate),o.valid&&(m=p.startDate-o.origStart)}m!==null&&(o.startDate=s.adjustStartDate(o.origStart,m),o.endDate=b.add(o.startDate,u.fullDuration),o.valid&&(o.timeDiff=o.startDate-o.origStart))}const g=o.dirty=o.dirty||h-o.startDate!==0;if(o.valid)if(s.constrainDragToTimeline&&(o.endDate<=l.timeAxis.startDate||o.startDate>=l.timeAxis.endDate))o.valid=!1,o.context.message=s.L("L{EventDrag.noDropOutsideTimeline}");else if(g||o.externalDropTarget){const m=o.externalDragValidity=!r||e.pageX&&s.checkDragValidity(o,r);!m||typeof m=="boolean"?(o.valid=m!==!1,o.context.message=""):(o.valid=m.valid!==!1,o.context.message=m.message)}else o.valid=o.externalDragValidity!==!1&&((n=o.externalDragValidity)==null?void 0:n.valid)!==!1;else o.valid=!1;o.context.valid=o.valid}suspendRecordElementRedrawing(e,r=!0){this.suspendElementRedrawing(this.getRecordElement(e),r),e.instanceMeta(this.client).retainElement=r}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,r=!0){e&&(e.retainElement=r)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const r=this,{client:t,drag:i}=r,n=r.setupProductDragData(e),{record:s,eventBarEls:a,draggedEntities:o}=n,{startEvent:l}=i,c=s.isAssignment?s.event:s,d=c.startDate,u=c.endDate,h=t.timeAxis,f=d<h.startDate,g=u>h.endDate,m=t.isSchedulerBase?t.multiEventSelect:t.selectionMode.multiSelect,p=r.getCoordinate(c,e.element,[e.elementStartX,e.elementStartY]),v=r.getCoordinate(c,e.element,[e.startClientX,e.startClientY]);r.suspendRecordElementRedrawing(s),o.forEach(S=>r.suspendRecordElementRedrawing(S)),s.isAssignment?t.selectAssignment(s,l.ctrlKey&&m):t.selectEvent(s,l.ctrlKey&&m);const y={context:e,...n,sourceDate:f?d:t.getDateFromCoordinate(p),screenSourceDate:t.getDateFromCoordinate(v,null,!1),startDate:d,endDate:u,timeDiff:0,origStart:d,origEnd:u,startsOutsideView:f,endsOutsideView:g,duration:u-d,browserEvent:l};return a.forEach(S=>S.classList.remove("b-sch-event-hover","b-active")),a.length>1&&(e.relatedElements=a.slice(1)),y}setupConstraints(e,r,t,i){const n=this,s=!n.showExactDropPosition&&t>1?t:0,a=0;i?n.setXConstraint(e.left,e.right-r.width,s):n.setXConstraint(!0,!0,s),n.setYConstraint(e.top,e.bottom-r.height,a)}updateYConstraint(e,r){const t=this,{client:i}=t,{context:n}=t.drag,s=i.timeAxisViewModel.snapPixelAmount;if(n&&!t.drag.lockY){let a;if(t.constrainDragToTimeline)a=i.getScheduleRegion(r,e);else{t.setYConstraint(null,null,s);return}t.setYConstraint(a.top,a.bottom-n.element.offsetHeight,s)}else t.setYConstraint(null,null,s)}setXConstraint(e,r,t){const{drag:i}=this;i.minX=e,i.maxX=r}setYConstraint(e,r,t){const{drag:i}=this;i.minY=e,i.maxY=r}adjustStartDate(e,r){const t=this.client.timeAxis.roundDate(new Date(e-0+r),this.client.snapRelativeToEventStartDate?e:!1);return this.constrainStartDate(t)}resolveStartEndDates(e){const r=this.currentOverClient,{timeAxis:t}=r,i=k.from(e.querySelector(r.eventInnerSelector),r.timeAxisSubGridElement),n=this.dragData,[s]=n.draggedEntities,a=s.isAssignment?s.event:s,{fullDuration:o}=a,l=r.fillTicks&&r.snapRelativeToEventStartDate;let{start:c,end:d}=r.getStartEndDatesFromRectangle(i,l?null:"round",o,!0);if(c&&d){if(l){const u=a.startDate-b.startOf(a.startDate,t.unit),h=d-c,f=u/h*i.width;i.deflate(f,0,0,f);const g=i.getStart(r.rtl,!r.isVertical);c=r.getDateFromCoordinate(g,null,!0),c=t.roundDate(c,a.startDate)}if(c=this.adjustStartDate(c,0),n.startsOutsideView)n.endsOutsideView||(c=d&&b.add(d,-o));else{if(!t.dateInAxis(c,!1)){const u=t.getTickFromDate(c);u>=0&&(c=t.getDateFromTick(u))}d=c&&b.add(c,o)}}return{startDate:c,endDate:d}}getTipHtml(){const e=this,{dragData:r,client:t,tooltipTemplate:i}=e,{startDate:n,endDate:s,draggedEntities:a}=r,o=t.getFormattedDate(n),l=t.getFormattedEndDate(s,n),{valid:c,message:d,element:u,dragProxy:h}=r.context,f=h?h.firstChild:u,g=a[0],m=g.isTask?g:g.event;return e.tip.lastAlignSpec.target=f,i({valid:c,startDate:n,endDate:s,startText:o,endText:l,dragData:r,message:d||"",[t.scheduledEventName+"Record"]:m,startClockHtml:e.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:m.isMilestone?"":e.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(e){const r=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[r]=e)}updateConstrainDragToResource(e){const r=this;if(r.drag){const{constrainDragToTimeSlot:t}=r,{isHorizontal:i}=r.client;e&&(r.constrainDragToTimeline=!0),r.drag.lockY=i?e:t,r.drag.lockX=i?t:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}constrainStartDate(e){const{dragData:r}=this,{dateConstraints:t}=r,i=r.eventRecord||r.taskRecord||r.draggedEntities[0];return t!=null&&t.start&&(e=b.max(t.start,e)),t!=null&&t.end&&(e=b.min(new Date(t.end-i.durationMS),e)),e}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,r){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,r){throw new Error("Implement in subclass")}getCoordinate(e,r,t){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}};_g._$name="DragBase";var Fw={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"},js=class extends X.mixin(zh,sS){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),(e=this.dragging)==null||e.destroy()}render(){const e=this,{client:r}=e;e.dragSelector=e.dragItemSelector=r.eventSelector,e.dragRootElement=e.dropRootElement=r.timeAxisSubGridElement,e.dragLock=r.isVertical?"y":"x"}isEventElementDraggable(e,r,t,i){const n=this,s=r==null?void 0:r.resizable;return n.disabled||!s||r.isMilestone?!0:(s!==!0&&s!=="start"||!n.isOverStartHandle(i,e))&&(s!==!0&&s!=="end"||!n.isOverEndHandle(i,e))}onEventDataGenerated({eventRecord:e,wrapperCls:r,cls:t}){var i,n;e===((n=(i=this.dragging)==null?void 0:i.context)==null?void 0:n.eventRecord)&&(r["b-active"]=r[this.draggingItemCls]=r["b-over-resize-handle"]=t["b-resize-handle"]=t[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var r;const{client:t,dragging:i}=this,{visibleDateRange:n,isHorizontal:s}=t,a=s&&t.rtl,o=s?"X":"Y",l=globalThis[`page${o}Offset`],c=e[`page${o}`]+(((r=i.context)==null?void 0:r.offset)||0),d=k.from(t.timeAxisSubGridElement,null,!0),u=d.getStart(a,s),h=d.getEnd(a,s);let f=t.getDateFromCoord({coord:c,local:!1});a?c-l>u?f=n.startDate:c<h&&(f=n.endDate):c-l<u?f=n.startDate:c-l>h&&(f=n.endDate),i.clientStartCoord=u,i.clientEndCoord=h,i.date=f,super.onDragPointerMove(e)}get isResizing(){return!!this.dragging}beforeDrag(e){const{client:r}=this,t=r.resolveTimeSpanRecord(e.itemElement),i=!r.isGanttBase&&r.resolveResourceRecord(r.isVertical?e.startEvent:e.itemElement);return this.disabled||r.readOnly||i!=null&&i.readOnly||t&&(t.readOnly||!(t.project||t.isOccurrence))||super.beforeDrag(e)===!1?!1:(e.mousedownDate=e.date=r.getDateFromCoordinate(e.event[`page${r.isHorizontal?"X":"Y"}`],null,!1),this.triggerBeforeResize(e))}dragStart(e){var r,t;const i=this,{client:n,tip:s}=i,{startEvent:a,itemElement:o}=e,l=n.scheduledEventName,c=n.resolveEventRecord(o),{isBatchUpdating:d,wrapStartDate:u,wrapEndDate:h}=c,f=(r=n.features.eventBuffer)==null?void 0:r.enabled,g=d?c.get("startDate"):c.startDate,m=d?c.get("endDate"):c.endDate,p=i.dragLock==="x",v=p&&n.rtl,y=i.isOverEndHandle(a,o),S=y?"endDate":"startDate",D=f?y?"wrapEndDate":"wrapStartDate":null,w=y?"startDate":"endDate",E=y?"setEndDate":"setStartDate",x=y?"setStartDate":"setEndDate",M=k.from(o),I=p?a.clientX:a.clientY,P=y?M.getEnd(v,p):M.getStart(v,p),_=e.context={eventRecord:c,element:o,timespanRecord:c,taskRecord:c,owner:i,valid:!0,oldValue:y?m:g,startDate:g,endDate:m,offset:f?0:P-I,edge:p?y?"right":"left":y?"bottom":"top",finalize:i.finalize,event:e.event,originalStartDate:g,originalEndDate:m,wrapStartDate:u,wrapEndDate:h,draggingEnd:y,toSet:S,wrapToSet:D,otherEnd:w,setMethod:E,setOtherMethod:x};c.meta.isResizing=!0,n.element.classList.add(...i.dragActiveCls.split(" ")),n.listenToBatchedUpdates||n.beginListeningForBatchedUpdates(),d||i.beginEventRecordBatch(c),i.setupProductResizeContext(_,a),i.triggerEventResizeStart(`${l}ResizeStart`,{[`${l}Record`]:c,event:a,...i.getResizeStartParams(_)},_),_.resizedRecord=((t=n.resolveAssignmentRecord)==null?void 0:t.call(n,_.element))||c,s&&(s.show(),s.align=Fw[_.edge],s.showBy(i.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:r}=this,t=r.resolveTimeSpanRecord(e.itemElement);return r.trigger(`before${r.capitalizedEventName}Resize`,{[`${r.scheduledEventName}Record`]:t,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,r,t){var i,n;this.client.trigger(e,r),(n=(i=this.client)[`after${L.capitalize(e)}`])==null||n.call(i,t,r)}triggerEventResizeEnd(e,r){this.client.trigger(e,r)}triggerEventPartialResize(e,r){this.client.trigger(e,r)}triggerBeforeEventResizeFinalize(e,r){this.client.trigger(e,r)}dragEnter(e){var r;return((r=e.context)==null?void 0:r.owner)===this}resizeEventPartiallyInternal(e,r){var t;const{client:i}=this,{toSet:n}=r;if((t=i.features.eventBuffer)!=null&&t.enabled){if(n==="startDate"){const s=r.startDate.getTime()-r.originalStartDate.getTime();e.wrapStartDate=new Date(r.wrapStartDate.getTime()+s)}else if(n==="endDate"){const s=r.endDate.getTime()-r.originalEndDate.getTime();e.wrapEndDate=new Date(r.wrapEndDate.getTime()+s)}}e.set(n,r[n])}applyDateConstraints(e,r,t){var i,n;const s=(i=t.dateConstraints)==null?void 0:i.start,a=(n=t.dateConstraints)==null?void 0:n.end;return(s||a)&&(e=b.constrain(e,s,a),t.snappedDate=b.constrain(t.snappedDate,s,a)),e}moveDrag(e){const r=this,{client:t,tip:i}=r,n=r.dragLock==="x",s=n?"X":"Y",a=t.scheduledEventName,{visibleDateRange:o,enableEventAnimations:l,timeAxis:c,weekStartDay:d}=t,u=n&&t.rtl,{resolutionUnit:h,resolutionIncrement:f}=c,{event:g,context:m}=e,{eventRecord:p}=m,v=m.offset*(u?-1:1),{isOccurrence:y}=p,S=p.get("startDate"),D=p.get("endDate"),w=g[`client${s}`]+v,E=k.from(t.timeAxisSubGridElement,null,!0),x=E.getStart(u,n),M=E.getEnd(u,n);m.event=g,g.isScroll&&(e.date=t.getDateFromCoordinate(g[`page${s}`]+v,null,!1));let I,P,{date:_}=e,{toSet:A,otherEnd:V,draggingEnd:N}=m;u?w>x?_=e.date=o.startDate:w<M&&(_=e.date=o.endDate):w<x?_=e.date=o.startDate:w>M&&(_=e.date=o.endDate),A==="endDate"?_<S&&(I=-1):_>D&&(I=1),I&&r.onDragEndSwitch&&(r.onDragEndSwitch(m,_,I),V=m.otherEnd,A=m.toSet),t.snapRelativeToEventStartDate&&(_=c.roundDate(_,m.oldValue)),m.snappedDate=b.round(_,c.resolution,null,d);const B=b.diff(_,m[V],h)*(N?-1:1);if(r.isEventDragCreate)m.tooNarrow=B<f/2;else if(B<f)if(r.allowResizeToZero)m.snappedDate=_=m[V];else{const Z=V==="startDate"?1:-1;m.snappedDate=_=c.roundDate(b.add(p.get(V),f*Z,h)),P=!0}if(_=r.applyDateConstraints(_,p,m),(!m.date||_-m.date||P)&&(m.date=_,m[A]=r.showExactResizePosition||t.timeAxisViewModel.snap?m.snappedDate:_,m.valid=r.allowResizeToZero||m[A]-m[A==="startDate"?"endDate":"startDate"]!==0,p.get(A)-m[A])){if(m.valid=r.checkValidity(m,g),m.message="",m.valid&&typeof m.valid!="boolean"&&(m.message=m.valid.message,m.valid=m.valid.valid),m.valid=m.valid!==!1,m.valid){const Z={[`${a}Record`]:p,startDate:S,endDate:D,element:e.itemElement,context:m};Z[A]=m[A],r.triggerEventPartialResize(`${a}PartialResize`,Z),y&&p.stores.push(t.eventStore),t.enableEventAnimations=!1,this.resizeEventPartiallyInternal(p,m),t.enableEventAnimations=l,y&&(p.stores.length=0)}m.tooNarrow&&(m.valid=!1)}i&&(i.align=Fw[m.edge],i.alignTo(r.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:r}=e;r&&(r.event=e.event),e.aborted?r==null||r.finalize(!1):!this.isEventDragCreate&&!e.started&&!j.getPagePoint(e.event).equals(j.getPagePoint(e.startEvent))&&(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:r}){var t;e[e.toSet]=e.snappedDate;const{client:i}=this,{startDate:n,endDate:s}=e;let a;(t=this.tip)==null||t.hide(),e.valid=n&&s&&(this.allowResizeToZero||s-n>0)&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(this.triggerBeforeEventResizeFinalize(`before${i.capitalizedEventName}ResizeFinalize`,{context:e,event:r,[`${i.scheduledEventName}Record`]:e.eventRecord}),a=!0),e.async||await e.finalize(a)}async finalize(e){const r=this.owner,t=this,{eventRecord:i,oldValue:n,toSet:s}=t,{snapRelativeToEventStartDate:a,timeAxis:o}=r.client;let l=!1;e?(a&&(t[s]=t.snappedDate=o.roundDate(t.date,n)),l=await r.internalUpdateRecord(t,i)):(r.cancelEventRecordBatch(i),i.isOccurrence&&i.resources.forEach(c=>r.client.repaintEventsForResource(c))),r.cleanup(t,l)}cleanup(e,r){var t;const i=this,{client:n}=i,{element:s,eventRecord:a}=e,o=n.scheduledEventName;a.meta.isResizing=!1,n.endListeningForBatchedUpdates(),(t=i.tip)==null||t.hide(),i.unHighlightHandle(s),n.element.classList.remove(...i.dragActiveCls.split(" ")),i.triggerEventResizeEnd(`${o}ResizeEnd`,{changed:r,[`${o}Record`]:a,...i.getResizeEndParams(e)})}async internalUpdateRecord(e,r){var t;const{client:i}=this,{generation:n}=r;if(r.isOccurrence)i.endListeningForBatchedUpdates(),r[r.batching>1?"endBatch":"cancelBatch"](),r.set(St.prototype.inSetNormalize.call(r,{startDate:e.startDate,endDate:e.endDate}));else{const s={[e.toSet]:e[e.toSet]};if(r.isEntity){const{startDate:a,endDate:o,draggingEnd:l}=e;e.duration=s.duration=r.run("calculateProjectedDuration",a,o),s[e.toSet]=r.run("calculateProjectedXDateWithDuration",l?a:o,l,e.duration);const c=!r[e.otherEnd];c&&(s[e.otherEnd]=e[e.otherEnd]),r.set(s),i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),(t=i.features.eventBuffer)!=null&&t.enabled&&(r[e.wrapToSet]=null);const d=[];c&&d.push(r[e.setOtherMethod](s[e.otherEnd],!1)),d.push(r[e.setMethod](s[e.toSet],!1)),await Promise.all(d),r.endBatch()}else{const a=Object.assign({},r.meta.batchChanges);delete a[e.toSet],i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),r.set(a),r[e.setMethod](s[e.toSet],!1)}}return await i.project.commitAsync(),r.generation!==n}onDragItemMouseMove(e){e.pointerType!=="touch"&&!this.handleSelector&&this.checkResizeHandles(e)}checkResizeHandles(e){const r=this,{overItem:t}=r;if(t&&!r.client.readOnly&&(!r.allowResize||r.allowResize(t,e))){const i=r.client.resolveTimeSpanRecord(t);if(i!=null&&i.readOnly)return;r.isOverAnyHandle(e,t)?r.highlightHandle():r.unHighlightHandle()}}onDragItemMouseLeave(e,r){this.unHighlightHandle(r)}highlightHandle(){var e,r;const{overItem:t,client:i}=this;((r=(e=t.syncIdMap)==null?void 0:e[i.scheduledEventName])!=null?r:t.querySelector(i.eventInnerSelector)).classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){var r,t;if(e){const i=this,n=(t=(r=e.syncIdMap)==null?void 0:r[i.client.scheduledEventName])!=null?t:e.querySelector(i.client.eventInnerSelector);n&&n.classList.remove("b-resize-handle",i.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",i.draggingItemCls)}}isOverAnyHandle(e,r){return this.isOverStartHandle(e,r)||this.isOverEndHandle(e,r)}isOverStartHandle(e,r){var t;return(t=this.getHandleRect("start",e,r))==null?void 0:t.contains(j.getPagePoint(e))}isOverEndHandle(e,r){var t;return(t=this.getHandleRect("end",e,r))==null?void 0:t.contains(j.getPagePoint(e))}getHandleRect(e,r,t){if(this.overItem){if(t=r.target.closest(`.${this.client.eventCls}`)||t.querySelector(`.${this.client.eventCls}`),!t)return;const i=this,n=e==="start",{client:s}=i,a=!!s.rtl,o=i.dragLock,l=o==="x",c=l?"width":"height",d=`${l?n&&!a?"left":"right":n?"top":"bottom"}Handle`,{offsetWidth:u}=t,h=s.resolveTimeSpanRecord(t),f=h==null?void 0:h.isResizable,g=k.from(t),m=g.clone(),p=globalThis.getComputedStyle(t,":before"),v=!i.handleSelector&&!Y.isHoverableDevice?i.touchHandleSize:void 0,y=v||i.handleSize||parseFloat(p[c]),S=i.handleVisibilityThreshold||2*i.handleSize,D=i.dynamicHandleSize?i.reservedSpace/2:0,w=[0,0,0,0];if(!i.disabled&&i[d]&&(u>=S||i.dynamicHandleSize)&&(f===!0||f===e)&&(!l&&!n||l&&a===n?(m[o]+=g[c]-y,w[l?3:0]=g[c]/2+D):w[l?1:2]=g[c]/2+D,g.deflate(...w),m[c]=y,m.constrainTo(g),m[c]))return m}}setupDragContext(e){const r=this;if(r.overItem&&r.isOverAnyHandle(e,r.overItem)&&r.isElementResizable(r.overItem,e)){const t=super.setupDragContext(e);return t.scrollManager=r.client.scrollManager,t}}changeHandleSize(){re.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){re.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(e,r){var t;const i=this;return i.showTooltip?(e?(e.isTooltip?e.owner=i:e=ue.reconfigure(r,ue.mergeConfigs({id:i.tipId},e,{getHtml:i.getTipHtml.bind(i),owner:i.client},i.tip),{owner:i,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:i}),i.clockTemplate=new fn({scheduler:i.client})):r&&(r.destroy(),(t=i.clockTemplate)==null||t.destroy()),e):null}isElementResizable(e,r){var t;const i=this,{client:n}=i,s=n.resolveTimeSpanRecord(e);if(n.readOnly)return!1;let a=s==null?void 0:s.isResizable;const o=(t=e==null?void 0:e.syncIdMap[n.scheduledEventName])!=null?t:e,l=r.target.closest('[class$="-handle"]');if(!a||l&&l!==o||(e=r.target.closest(i.dragSelector),!e))return!1;const c=e.classList.contains("b-sch-event-startsoutside"),d=e.classList.contains("b-sch-event-endsoutside");if(a===!0){if(c&&d)return!1;if(c)a="end";else if(d)a="start";else return i.isOverStartHandle(r,e)||i.isOverEndHandle(r,e)}return c&&a==="start"||d&&a==="end"?!1:!!(i.isOverStartHandle(r,e)&&a==="start"||i.isOverEndHandle(r,e)&&a==="end")}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:r,draggingEnd:t,snappedDate:i}=this.dragging.context,n=t?r.get("startDate"):i,s=t?i:r.get("endDate"),{element:a}=this.tip;e.updateDateIndicator(a.querySelector(".b-sch-tooltip-startdate"),n),e.updateDateIndicator(a.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget({itemElement:e,context:r}){const t=this,{rtl:i}=t.client,n=k.from(e,null,!0);return t.dragLock==="x"?(!i&&r.edge==="right"||i&&r.edge==="left"?n.x=n.right-1:n.x-=t.tip.anchorSize[0]/2,n.width=t.tip.anchorSize[0]/2):(r.edge==="bottom"&&(n.y=n.bottom-1),n.height=t.tip.anchorSize[1]/2),{target:n}}basicValidityCheck(e,r){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,r)}getTipHtml({tip:e}){const r=this,{startDate:t,endDate:i,toSet:n,snappedDate:s,valid:a,message:o="",timespanRecord:l}=r.dragging.context;if(!t||!i)return e.html;const c={record:l,valid:a,message:o,startDate:t,endDate:i,[n]:s};return c.startText=r.client.getFormattedDate(c.startDate),c.endText=r.client.getFormattedDate(c.endDate),c.startClockHtml=r.clockTemplate.template({date:c.startDate,text:c.startText,cls:"b-sch-tooltip-startdate"}),c.endClockHtml=r.clockTemplate.template({date:c.endDate,text:c.endText,cls:"b-sch-tooltip-enddate"}),r.tooltipTemplate(c)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:r}=this;return{resourceRecord:r.resolveResourceRecord(r.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,r){var t,i,n;const{client:s}=this,{element:a}=e,o=s.resolveEventRecord(a),l=(t=s.resolveResourceRecord)==null?void 0:t.call(s,a),c=(i=s.resolveAssignmentRecord)==null?void 0:i.call(s,a);Object.assign(e,{eventRecord:o,taskRecord:o,resourceRecord:l,assignmentRecord:c,dateConstraints:(n=s.getDateConstraints)==null?void 0:n.call(s,l,o)})}checkValidity({startDate:e,endDate:r,eventRecord:t,resourceRecord:i}){const{client:n}=this;return!n.allowOverlap&&t.resources.some(s=>!n.isDateRangeAvailable(e,r,t,s))?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return`${this.client.id}-event-resize-tip`}};js._$name="EventResize",z.registerFeature(js,!0,"Scheduler"),z.registerFeature(js,!1,"ResourceHistogram");var jo=e=>class extends(e||F){static get $name(){return"TaskEditStm"}captureStm(t=!1){const i=this,n=i.project,s=n.getStm();i.hasStmCapture||(i.hasStmCapture=!0,i.stmInitiallyDisabled=s.disabled,i.stmInitiallyAutoRecord=s.autoRecord,i.stmInitiallyDisabled?(s.enable(),s.autoRecord=!1):(i.stmInitiallyAutoRecord&&(s.autoRecord=!1),s.isRecording&&s.stopTransaction()),t&&this.startStmTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const t=this,i=t.project.getStm();if(!t.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");i.enabled&&(i.stopTransaction(),t.stmInitiallyDisabled&&i.resetQueue())}async rejectStmTransaction(){var t;const i=this.project.getStm(),{client:n}=this;if(!this.hasStmCapture)throw new Error("Does not have STM capture, no transaction to reject");i.enabled&&((t=i.transaction)!=null&&t.length?(n.suspendRefresh(),i.rejectTransaction(),await n.resumeRefresh(!0)):i.stopTransaction())}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}freeStm(t=null){t===!0?this.commitStmTransaction():t===!1&&this.rejectStmTransaction();const i=this,n=i.project.getStm();i.hasStmCapture&&(n.disabled=i.stmInitiallyDisabled,n.autoRecord=i.stmInitiallyAutoRecord,i.hasStmCapture=!1)}},XI=function(e){var r,t;return(t=(r=this.source)==null?void 0:r.client.features.taskEdit)!=null&&t._canceling?!1:j.getDistanceBetween(this.startEvent,e)},Bo=class extends jo(js){construct(e,r){(r==null?void 0:r.showTooltip)===!1&&(r.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:r}=e;e.dragRootElement=e.dropRootElement=r.timeAxisSubGridElement,e.dragLock=r.isVertical?"y":"x"}onDragEndSwitch(e){const{client:r}=this,{enableEventAnimations:t}=r,{eventRecord:i,draggingEnd:n}=e,s=this.dragLock==="x",{initialDate:a}=this.dragging;r.enableEventAnimations=!1,i.set({startDate:a,endDate:a}),n?Object.assign(e,{endDate:a,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"}):Object.assign(e,{startDate:a,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!n,r.enableEventAnimations=t}beforeDrag(e){const r=this,t=super.beforeDrag(e),{pan:i,eventDragSelect:n}=r.client.features;return t!==!1&&(r.preventMultiple&&!r.isRowEmpty(e.rowRecord)||r.disabled||i&&!i.disabled||n&&!n.disabled)?!1:(r.client.preventDragSelect=!0,t)}startDrag(e){const r=super.startDrag(e);if(r!==!1){const{context:t}=e;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return r}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){var r;const{client:t}=this;if(t.matchScheduleCell(e.target)){const i=(r=t.resolveResourceRecord(e))==null?void 0:r.$original;if(i&&!i.isSpecialRow){const n=zh().prototype.setupDragContext.call(this,e),s=[];return t.isVertical?s.push({element:t.scrollable.element,direction:"vertical"}):s.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=t.scrollManager,n.monitoringConfig={scrollables:s},n.resourceRecord=n.rowRecord=i,n.getDistance=XI,n}}}async dragDrop({context:e,event:r}){var t;e[e.toSet]=e.snappedDate;const{client:i}=this,{startDate:n,endDate:s,eventRecord:a}=e,{generation:o}=a;let l;(t=this.tip)==null||t.hide(),await i.project.commitAsync(),a.generation!==o&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=n&&s&&s-n>0&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(i.trigger("beforeDragCreateFinalize",{context:e,event:r,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,r){return super.changeTip(!e||e.isTooltip?e:T.assign({id:`${this.client.id}-drag-create-tip`},e),r)}async finalize(e){var r;if(this.finalized)return;this.finalized=!0;const t=this.owner,i=this,n=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:i.element,eventElement:i.element,eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),t.cleanup(i))};e?(await t.finalizeDragCreate(i),n()):(await t.cancelDragCreate(i),(r=t.onAborted)==null||r.call(t,i),n())}async cancelDragCreate(e){}async finalizeDragCreate(e){var r;await this.internalUpdateRecord(e,e.eventRecord);const t={stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1};return this.client.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element,stmCapture:t}),(r=this.client)==null||r.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),t.transferred}cleanup(e){var r;const{client:t}=this,{eventRecord:i}=e;i.meta.isResizing=!1,t.endListeningForBatchedUpdates(),(r=this.tip)==null||r.hide(),t.element.classList.remove(...this.dragActiveCls.split(" ")),e.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,r,t,i=!1){return{...e,async:i,event:r,finalize:t}}onEventDataGenerated(e){var r,t;((t=(r=this.dragging)==null?void 0:r.context)==null?void 0:t.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,r){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,r){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}};R(Bo,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:e=>`
            <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                ${e.startClockHtml}
                ${e.endClockHtml}
                <div class="b-sch-tip-message">${e.message}</div>
            </div>
        `,dragActiveCls:"b-dragcreating"}),R(Bo,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}),Bo._$name="DragCreateBase";var gn=b,ZI=["startDate","endDate","resource","recurrenceRule"],kw=e=>{if(e.length===1)return e[0].value;if(e.length===2){const[r,t]=e[0]instanceof us?e:e.reverse(),i=gn.parse(r.value);return i&&t.value&&i.setHours(t.value.getHours(),t.value.getMinutes(),t.value.getSeconds(),t.value.getMilliseconds()),i?b.clone(i):null}return null},JI=(e,r)=>{const t=new Date(e.getTime());return t.setHours(r.getHours(),r.getMinutes()),t},Fg=(e,r,t)=>{if(e&&r&&t.endDateField&&t.endTimeField){const i=gn.add(JI(t.startDateField.value,t.startTimeField.value),t.eventRecord.durationMS,"milliseconds");t.endDateField.value=i,t.endTimeField.value=gn.clone(i)}},kg=class extends X{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(e,r){const t=this;e.eventEdit=t,super.construct(e,T.assign({weekStartDay:e.weekStartDay},r)),t.clientListenersDetacher=e.ion({[t.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:t})}doDestroy(){var e;this.clientListenersDetacher(),(e=this._editor)==null||e.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(e){const{items:r}=this;return r&&(e=U.clone(e),e.items=Re.merge(r,e.items)),e}changeItems(e){return this.cleanItemsConfig(e),e}cleanItemsConfig(e){for(const r in e){const t=e[r];t===!0?delete e[r]:t!=null&&t.items&&this.cleanItemsConfig(t.items)}}onDatesChange(e){var r,t,i,n;const s=this,a=e.source,o=e.value;switch(s.startDateField&&s.endDateField&&(s.endDateField.min=s.startDateField.value),s.endTimeField&&(gn.isEqual(gn.clearTime((r=s.startDateField)==null?void 0:r.value),gn.clearTime((t=s.endDateField)==null?void 0:t.value))?s.endTimeField.min=s.startTimeField.value:s.endTimeField.min=null),a.ref){case"startDateField":(i=s.startTimeField)!=null&&i.value&&Fg(o,s.startTimeField.value,s);break;case"startTimeField":(n=s.startDateField)!=null&&n.value&&Fg(s.startDateField.value,o,s);break}}async save(){throw new Error("Implement in subclass")}get values(){const e=this,{editor:r}=e,t=[],i=[],{values:n}=r;return ZI.forEach(s=>delete n[s]),r.eachWidget(s=>{var a;const{name:o}=s;if(!o||s.hidden||s.up(l=>l===e.recurrenceEditor)){delete n[o];return}switch(o){case"startDate":t.push(s);break;case"endDate":i.push(s);break;case"resource":n[o]=s.record;break;case"recurrenceRule":n[o]=((a=r.widgetMap.recurrenceCombo)==null?void 0:a.value)==="none"?"":s.value;break}},!0),n.allDay&&!e.eventRecord.allDay&&(t.push(e.startTimeField),i.push(e.endTimeField)),t.length&&(n.startDate=kw(t)),i.length&&(n.endDate=kw(i)),"startDate"in n&&"endDate"in n&&(n.duration=gn.diff(n.startDate,n.endDate,e.editor.record.durationUnit,!0)),n}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:r}=this;return this.assignmentStore&&delete r.resource,e.set(r)}onBeforeEditorShow(){const{eventRecord:e,editor:r}=this.editingContext,{nameField:t}=r.widgetMap;t&&e.isCreating&&(r.assigningValues=!0,t.value="",r.assigningValues=!1,t._configuredPlaceholder=t.placeholder,t.placeholder=e.name)}resetEditingContext(){var e;const r=this;if(!r.editingContext)return;const{client:t}=r,{editor:i,eventRecord:n}=r.editingContext,{eventStore:s}=t,{nameField:a}=i.widgetMap;n.isCreating&&(t.isTimelineBase&&((e=r.editingContext.eventElement)==null||e.closest("[data-event-id]").classList.add("b-released")),s.remove(n),n.isCreating=!1),a&&(a.placeholder=a._configuredPlaceholder),t.element.classList.remove("b-eventeditor-editing"),r.targetEventElement=r.editingContext=i._record=null}onPopupKeyDown({event:e}){const r=this;!r.readOnly&&e.key==="Enter"&&r.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"&&(e.preventDefault(),e.target.name==="startDate"&&r.startTimeField&&Fg(r.startDateField.value,r.startTimeField.value,r),r.onSaveClick())}async finalizeStmCapture(e){}async onSaveClick(){this.editor.focus(),this.isFinalizingEventSave=!0;const e=await this.save();return this.isFinalizingEventSave=!1,e&&(await this.finalizeStmCapture(!1),this.editor.close(),this.client.trigger("afterEventEdit")),e}async onDeleteClick(){this.isDeletingEvent=!0;const e=await this.deleteEvent();if(this.isDeletingEvent=!1,e){await this.finalizeStmCapture(!1);const{editor:r}=this;(!r.autoClose||r.containsFocus)&&r.close(),this.client.trigger("afterEventEdit")}}async onCancelClick(){this.isCancelingEdit=!0,this.editor.close(),this.isCancelingEdit=!1,this.hasStmCapture&&await this.finalizeStmCapture(!0),this.client.trigger("afterEventEdit")}};kg._$name="EditBase";var mn=class extends X.mixin(er){static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some(r=>e.isTimeSpanInAxis(r))}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}updateTabIndex(){this.isConfiguring||this.client.refresh()}getEventsToRender(e,r){throw new Error("Implement in subclass")}onEventDataGenerated(e){const r=this,{eventRecord:t,iconCls:i}=e;r.shouldInclude(t)&&(r.client.isVertical?e.width=e.resourceRecord.columnWidth||r.client.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls["b-sch-resourcetimerange"]=1,r.rangeCls&&(e.wrapperCls[r.rangeCls]=1),e.wrapperCls[`b-sch-color-${t.timeRangeColor}`]=t.timeRangeColor,e.eventContent.text=t.name,e.children.push(e.eventContent),e.tabIndex=r.tabIndex!=null?String(r.tabIndex):null,(i==null?void 0:i.length)>0&&e.children.unshift({tag:"i",className:i.toString()}),e.eventId=r.generateElementId(t))}generateElementId(e){return e.domId}resolveResourceTimeRangeRecord(e){var r;return(r=e==null?void 0:e.closest(`.${this.rangeCls}`))==null?void 0:r.elementData.eventRecord}getElementFromResourceTimeRangeRecord(e){return this.client.foregroundCanvas.syncIdMap[e.domId]}resolveResourceRecord(e){var r;return this.overridden.resolveResourceRecord(...arguments)||((r=this.resolveResourceTimeRangeRecord(e.target||e))==null?void 0:r.resource)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){(e.action==="removeall"||e.action==="dataset")&&(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}matchScheduleCell(e){let r=this.overridden.matchScheduleCell(e);if(!r&&this.enableMouseEvents){const{client:t}=this,i=e.closest(`.${this.rangeCls}`);r=i&&t.getCell({record:t.isHorizontal?i.elementData.resource:t.store.first,column:t.timeAxisColumn})}return r}handleRangeMouseEvent(e){var r;const t=this,i=e.target.closest(`.${t.rangeCls}`);if(i){const n=(r=j.eventNameMap[e.type])!=null?r:L.capitalize(e.type),s=t.resolveResourceTimeRangeRecord(i);t.client.trigger(t.entityName+n,{feature:t,[`${t.entityName}Record`]:s,resourceRecord:t.client.resourceStore.getById(s.resourceId),domEvent:e})}}updateEnableMouseEvents(e){var r;const t=this,{client:i}=t;if((r=t.mouseEventsDetacher)==null||r.call(t),t.mouseEventsDetacher=null,e){let n=function(){t.mouseEventsDetacher=j.on({element:i.foregroundCanvas,delegate:`.${t.rangeCls}`,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:t})};i.whenVisible(n)}i.element.classList.toggle("b-interactive-resourcetimeranges",!!e)}};R(mn,"configurable",{tabIndex:null,entityName:"resourceTimeRange"}),mn.featureClass="",mn._$name="ResourceTimeRangesBase";var Ed=class extends es{};Ed._$name="TimeSpanMenuBase";var Og=class extends X{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,r){const t=this;r=t.processConfig(r),super.construct(e,r),t.forSelector||(t.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy)`),t.clockTemplate=new fn({scheduler:e}),e.ion({[`before${e.scheduledEventName}drag`]:()=>{var i;(i=t.tooltip)==null||i.hide()}})}processConfig(e){return typeof e=="function"?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onPaint({firstPaint:e}){var r;if(e){const t=this,{client:i}=t,n=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${i.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map(a=>`:not(${a})`).join("");(r=t.tooltip)==null||r.destroy();const s=t.tooltip=new ue({axisLock:"flexible",id:t.tipId||`${t.client.id}-event-tip`,cls:t.tipCls,forSelector:`.b-timelinebase${n} .b-grid-body-container:not(.b-scrolling) ${t.forSelector}`,scrollAction:"realign",forElement:i.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:t.getTipHtml.bind(t),disabled:t.disabled,...t.config,internalListeners:t.configuredListeners});s.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:t}),Object.keys(s.$meta.configs).forEach(a=>{Object.defineProperty(this,a,{set:o=>s[a]=o,get:()=>s[a]})})}}processConfiguredListeners(){}addListener(...e){var r;const t=super.addListener(...e),i=(r=this.tooltip)==null?void 0:r.addListener(...e);if(t||i)return()=>{t==null||t(),i==null||i()}}removeListener(...e){var r;super.removeListener(...e),(r=this.tooltip)==null||r.removeListener(...e)}updateDateIndicator(){const e=this,r=e.tooltip,t=r.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(r.element,e.record.startDate),t&&e.clockTemplate.updateDateIndicator(t,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:r}){const t=this,{client:i}=t,n=t.recordType||`${i.scheduledEventName}Record`,s=t.resolveTimeSpanRecord(r);if((s==null?void 0:s.startDate)instanceof Date){const{startDate:a,endDate:o}=s,l=i.getFormattedDate(a),c=i.getDisplayEndDate(o,a),d=i.getFormattedDate(c);return e.eventRecord=s,t.template({tip:e,[`${n}`]:s,startDate:a,endDate:o,startText:l,endText:d,startClockHtml:t.clockTemplate.template({date:a,text:l,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":t.clockTemplate.template({date:c,text:d,cls:"b-sch-tooltip-enddate"})})}else return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({change:e.onRecordUpdate,buffer:300,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,(e=this.updateListener)==null||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){this.tooltip.eventRecord=this.resolveTimeSpanRecord(e)}onRecordUpdate({record:e}){const{tooltip:r}=this;r!=null&&r.isVisible&&e===this.record&&(r.updateContent(),r.lastAlignSpec.aligningToElement?r.realign():r.internalOnPointerOver(this.client.lastPointerEvent))}};Og._$name="TooltipBase";var pn=class extends X.mixin(ge){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,tooltipTemplate:null,dragTipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    <div class="b-sch-tip-name">${L.encodeHtml(e.name)||""}</div>
                    ${e.startClockHtml}
                    ${e.endClockHtml||""}
                </div>
            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(e,r){const t=this;super.construct(e,r),e.isVertical&&e.ion({renderRows:t.onUIReady,thisObj:t,once:!0}),t.cls=t.cls||`b-sch-${t.constructor.$$name.toLowerCase()}`,t.baseSelector=`.${t.baseCls}.${t.cls}`,t.enableResizing&&(t.showHeaderElements=!0)}doDestroy(){var e,r,t,i;const n=this;n.detachListeners("timeAxisViewModel"),n.detachListeners("timeAxis"),(e=n.clockTemplate)==null||e.destroy(),(r=n.tip)==null||r.destroy(),(t=n.drag)==null||t.destroy(),(i=n.resize)==null||i.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e}),e.updateLineBuffer()}onUIReady(){const e=this,{client:r}=e;r.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),r.hideHeaders||(e.headerContainerElement&&j.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=Yi.new({name:"rangeDrag",lockX:r.isVertical,lockY:r.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(t,i)=>!r.readOnly&&e.isElementDraggable(t,i),rtlSource:r,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=Ka.new({direction:r.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:(t,i)=>!t.matches(".b-dragging,.b-readonly")&&!i.target.matches(".b-fa"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new ue({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const i=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:i})},forSelector:"."+e.baseCls+(e.cls?"."+e.cls:"")}))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,r){const t=this,i=[],n=[];if(!t.disabled){t._labelRotationMap={};for(const s of t.timeRanges){const a=t.renderRange(s,e,r);a&&(i.push(a.bodyConfig),n.push(a.headerConfig))}}return[i,n]}renderRanges(){const e=this,{client:r}=e,{foregroundCanvas:t}=r;if(t&&r.isPainted&&!r.timeAxisSubGrid.collapsed){const{headerContainerElement:i}=e,n=[],[s,a]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=C.createElement({className:`b-timeranges-canvas ${e.cls}-canvas`,parent:t,retainElement:!0})),q.sync({targetElement:e.bodyCanvas,childrenOnly:!0,domConfig:{children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:o,action:l})=>{(l==="reuseElement"||l==="newElement"||l==="reuseOwnElement")&&n.push(o)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=C.createElement({className:`${e.cls}-canvas`,parent:i,retainElement:!0})),e.headerCanvas&&q.sync({targetElement:e.headerCanvas,childrenOnly:!0,domConfig:{children:a,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const o of n)e.cacheRotation(o.elementData.timeRange,o);for(const o of n)e.applyRotation(o.elementData.timeRange,o)}}get timeRanges(){return[]}shouldRenderRange(e,r=this.client.visibleDateRange.startDate,t=this.client.visibleDateRange.endDate){const{timeAxis:i}=this.client,{startDate:n,endDate:s,duration:a}=e;return!!(n&&(i.isContinuous||i.isTimeSpanInAxis(e))&&b.intersectSpans(r,t,n,a?s:b.add(n,this._lineBufferDurationMS)))}getRangeDomConfig(e,r,t,i=0){const n=this,{client:s}=n,{rtl:a}=s,o=s.getCoordinateFromDate(b.max(e.startDate,r),{respectExclusion:!0})-i,l=e.endDate?s.getCoordinateFromDate(b.min(e.endDate,t),{respectExclusion:!0,isEnd:!0})-i:o,c=Math.abs(l-o),d=c>0,u=a?`calc(${o}px - 100%)`:`${o}px`;return{className:{[n.baseCls]:1,[n.cls]:n.cls,[n.rangeCls]:d,[n.lineCls]:!d,[e.cls]:e.cls,"b-narrow-range":d&&c<n.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":a},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${u}); ${d?`height:${c}px`:""};`:`transform: translateX(${u}); ${d?`width:${c}px`:""};`}}renderRange(e,r,t){const i=this,{client:n}=i,{timeAxis:s}=n;if(i.shouldRenderRange(e,r,t)&&s.startDate){const a=i.getRangeDomConfig(e,s.startDate,s.endDate),o=e.iconCls&&L.xss`<i class="${e.iconCls}"></i>`,l=e.name&&L.encodeHtml(e.name),c=l||o?`<label>${o||""}${l||"&nbsp;"}</label>`:"",d={...a,style:a.style+(e.style||""),html:i.bodyRenderer?i.bodyRenderer({timeRange:e}):i.showHeaderElements&&!i.showLabelInBody?"":c};let u;return i.showHeaderElements&&(u={...a,html:i.headerRenderer?i.headerRenderer({timeRange:e}):i.showLabelInBody?"":c}),{bodyConfig:d,headerConfig:u}}}cacheRotation(e,r){if(!e.iconCls&&!e.name||!e.duration)return;const t=r.firstElementChild;t&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?t.offsetHeight<r.offsetHeight:t.offsetWidth>r.offsetWidth)}applyRotation(e,r){var t,i,n;const s=this._labelRotationMap[(i=(t=e.recurringTimeSpan)==null?void 0:t.id)!=null?i:e.id];(n=r.firstElementChild)==null||n.classList.toggle("b-vertical",!!s)}getBodyElementByRecord(e){const r=typeof e=="string"?e:e==null?void 0:e.id;return r!=null&&q.getChild(this.bodyCanvas,r)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:r,timeView:t,timeAxisColumn:i}=e.client;return e._headerContainerElement||(r&&t.element?e._headerContainerElement=t.element.parentElement:r||(e._headerContainerElement=i.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:r}=this;this.isConfiguring||(r.element.classList.toggle("b-sch-timeranges-with-headerelements",!!e),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:r}){}onPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:e}=this.client;this._lineBufferDurationMS=e.getDateFromPosition(300)-e.getDateFromPosition(0)}onInternalResize(e,r,t,i,n){this.client.isVertical&&n!==t&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(e){const r=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${L.capitalize(e.type)}`,{event:e,domEvent:e,timeRangeRecord:r})}showTip(e){const r=this;r.showTooltip&&(r.clockTemplate=new fn({scheduler:r.client}),r.tip=new ue(T.assign({id:`${r.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>r.getTipHtml(e.record,e.element)},r.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"),e&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:r,drag:t}=this;r.isVertical?(t.minY=0,t.maxY=r.timeAxisViewModel.totalSize-e.element.offsetHeight,t.minX=0,t.maxX=Number.MAX_SAFE_INTEGER):(t.minX=0,t.maxX=r.timeAxisViewModel.totalSize-e.element.offsetWidth,t.minY=0,t.maxY=Number.MAX_SAFE_INTEGER),r.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}onDrag(){}onDragReset(){}onResizeStart(){}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){}getTipHtml(e,r){const t=this,{client:i}=t,n=k.from(r),s=n.getStart(i.rtl,i.isHorizontal),a=n.getEnd(i.rtl,i.isHorizontal),o=i.getDateFromCoordinate(s,"round",!1),l=e.endDate&&i.getDateFromCoordinate(a,"round",!1),c=i.getFormattedDate(o),d=l&&i.getFormattedEndDate(l,o);return t.dragTipTemplate({name:e.name||"",startDate:o,endDate:l,startText:c,endText:d,startClockHtml:t.clockTemplate.template({date:o,text:c,cls:"b-sch-tooltip-startdate"}),endClockHtml:d&&t.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}};R(pn,"configurable",{showHeaderElements:!0}),R(pn,"pluginConfig",{chain:["onPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}),pn._$name="AbstractTimeRanges";var QI=Object.freeze({}),Lg=class extends X.mixin(er,ge){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(e,r){e.useBackgroundCanvas=!0,super.construct(e,r)}attachToResourceStore(e){const{client:r}=this;super.attachToResourceStore(e),r.isVertical&&r.resourceStore.ion({name:"resourceStore",group({groupers:t}){t.length===0&&this.refresh()},thisObj:this})}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,r){var t,i;const n=this,{client:s}=n,{rtl:a}=s,o=a?-1:1,{timeAxisViewModel:l,isHorizontal:c,resourceStore:d,variableColumnWidths:u}=s,{columnConfig:h}=l,f=l.columnLinesFor,g=Math.max(f-1,0),m=e.getTime(),p=r.getTime(),v=[],y=new Set,S=c?"X":"Y";if(!n.disabled){const D=(w,E)=>{const x=w.start.getTime();x>m&&x<p&&!y.has(x)&&(y.add(x),v.push({role:"presentation",className:E?"b-column-line-major":"b-column-line",style:{transform:`translate${S}(${w.coord*o}px)`},dataset:{line:E?`major-${w.index}`:`line-${w.index}`}}))};if(f!==g)for(let w=1;w<=h[g].length-1;w++)D(h[g][w],!0);for(let w=1;w<=h[f].length-1;w++)D(h[f][w],!1);if(!c&&s.columnLines){const{columnWidth:w}=s.resourceColumns;let{first:E,last:x}=s.currentOrientation.getResourceRange(!0),M=0;if(E>-1)for(let I=E;I<x+1;I++){const P=d.getAt(I);if(P.isGroupHeader){x++,M++;continue}const _=P.instanceMeta(d),A=u?_.insetStart+P.columnWidth-1:(I-M+1)*w-1;v.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":d.isGrouped&&((i=_.groupParent)==null?void 0:i.groupChildren[((t=_.groupParent)==null?void 0:t.groupChildren.length)-1])===P},style:{transform:`translateX(${A*o}px)`},dataset:{line:`resource-${I}`}})}}}return v}refresh(){const e=this,{client:r}=e,{timeAxis:t}=r,{startDate:i,endDate:n}=r.visibleDateRange||QI;if(!t.startDate||!i||e.client.timeAxisSubGrid.collapsed)return;e.element||(e.element=C.createElement({parent:r.backgroundCanvas,className:"b-column-lines-canvas"}));const a=e.getColumnLinesDOMConfig(i,n);q.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:a,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:r}){this.refresh()}updateCanvasSize(){this.refresh()}};Lg._$name="ColumnLines",z.registerFeature(Lg,!0,["Scheduler","Gantt"]);var Ow=e=>class extends(e||F){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(t,i){super.construct(t,i);const n=this;n.view=t,n.eventName=t.scheduledEventName,t.ion({readOnly:()=>n.updateCreateListeners()}),n.updateCreateListeners(),n.chain(t,"onElementTouchMove","onElementTouchMove")}doDestroy(){var t,i;const n=this;n.detachListeners("view"),n.creationData=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(i=n.creationTooltip)==null||i.destroy(),super.doDestroy()}updateCreateListeners(){const t=this;t.view&&(t.detachListeners("view"),t.isCreateAllowed&&t.view.ion({name:"view",[`${t.eventName}mouseenter`]:"onTimeSpanMouseEnter",[`${t.eventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:t}))}set allowCreate(t){this._allowCreate=t,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:t,source:i,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:s}){if(!n.isCreating&&!n.readOnly&&(!this.client.features.nestedEvents||n.parent.isRoot)){const a=this,{creationData:o}=a,l=C.down(s,i.eventInnerSelector);n!==(o==null?void 0:o.source)&&(a.showTerminals(n,l),o&&t.target.closest(a.client.eventSelector)&&(o.timeSpanElement=l,a.onOverTargetEventBar(t)))}}onTimeSpanMouseLeave(t){var i;const n=this,{creationData:s}=n,a=t[`${n.eventName}Element`],o=C.down(a,n.view.eventInnerSelector),l=(i=t.event)==null?void 0:i.relatedTarget,c=s==null?void 0:s.timeSpanElement;l&&((!s||!c||!l||!C.isDescendant(c,l))&&(t.event.isTrusted||o!==(s==null?void 0:s.sourceElement))&&n.hideTerminals(a),s&&!s.finalizing&&(s.timeSpanElement=null,n.onOverNewTargetWhileCreating(void 0,void 0,t)))}onTerminalMouseOver(t){this.creationData&&this.onOverTargetEventBar(t)}onTerminalMouseOut(t){const i=this,{creationData:n}=i,s=t.target.closest(i.view.eventSelector);s&&(!i.showingTerminalsFor||!C.isDescendant(s,i.showingTerminalsFor))&&(!n||s!==n.timeSpanElement)&&(i.hideTerminals(s),i.view.unhover(s,t)),n&&i.onOverNewTargetWhileCreating(t.relatedTarget,n.target,t)}onTerminalPointerDown(t){var i;const n=this;if(t.button===0&&!n.creationData){const s=n.view,a=s.timeAxisSubGridElement,o=t.target,l=o.closest(s.eventInnerSelector),c=k.from(s.element,document.body);t.stopPropagation(),n.creationData={sourceElement:l,source:s.resolveTimeSpanRecord(l).$original,fromSide:o.dataset.side,startPoint:k.from(o,a).center,startX:t.pageX-c.x+s.scrollLeft,startY:t.pageY-c.y+s.scrollTop,valid:!1,sourceResource:(i=s.resolveResourceRecord)==null?void 0:i.call(s,t),tooltip:n.creationTooltip},n.pointerUpMoveDetacher=j.on({pointerup:{element:s.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:a,handler:"onMouseMove",passive:!1},thisObj:n}),n.documentPointerUpDetacher=j.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:d})=>{d==="Escape"&&n.abort()}},thisObj:n})}}onElementTouchMove(t){var i;(i=super.onElementTouchMove)==null||i.call(this,t),this.connector&&t.preventDefault()}onMouseMove(t){const i=this,{view:n,creationData:s}=i,a=k.from(n.element,document.body),o=t.pageX-a.x+n.scrollLeft-s.startX,l=t.pageY-a.y+n.scrollTop-s.startY,c=Math.round(Math.sqrt(o*o+l*l))-3,d=Math.atan2(l,o);let{connector:u}=i;if(!u){if(i.onRequestDragCreate(t)===!1)return;u=i.connector}u.style.width=`${c}px`,u.style.transform=`rotate(${d}rad)`,i.lastMouseMoveEvent=t}onRequestDragCreate(t){const i=this,{view:n,creationData:s}=i;if(n.trigger("beforeDependencyCreateDrag",{data:s,source:s.source})===!1)return i.abort(),!1;if(n.element.classList.add("b-creating-dependency"),i.createConnector(s.startPoint.x,s.startPoint.y),n.trigger("dependencyCreateDragStart",{data:s,source:s.source}),i.showCreationTooltip){const a=i.creationTooltip||(i.creationTooltip=i.createDragTooltip());i.creationData.tooltip=a,a.disabled=!1,a.show(),a.onMouseMove(t)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:()=>i.lastMouseMoveEvent&&i.onMouseMove(i.lastMouseMoveEvent)})}onOverTargetEventBar(t){const i=this,{view:n,creationData:s,allowDropOnEventBar:a}=i,{target:o}=t;let l=n.resolveTimeSpanRecord(o).$original;l!=null&&l.isEventSegment&&(l=l.event),!(U.isPromise(s.valid)||!a&&!o.classList.contains(i.terminalCls))&&l!==s.source&&i.onOverNewTargetWhileCreating(o,l,t)}async onOverNewTargetWhileCreating(t,i,n){var s,a;const o=this,{view:l,creationData:c,allowDropOnEventBar:d,connector:u}=o;if(!U.isPromise(c.valid)&&!c.finalizing&&u){if(u.classList.remove("b-valid","b-invalid"),c.timeSpanElement&&C.removeClsGlobally(c.timeSpanElement,"b-sch-terminal-active"),!i||i===c.source||!d&&!t.classList.contains(o.terminalCls))c.target=c.toSide=null,c.valid=!1,u.classList.add("b-invalid");else{const h=c.target=i,{source:f}=c;let g=t.dataset.side;d&&!t.classList.contains(o.terminalCls)&&(g=o.getTargetSideFromType(o.dependencyStore.modelClass.fieldMap.type.defaultValue||wt.Type.EndToStart)),l.resolveResourceRecord&&(c.targetResource=l.resolveResourceRecord(n));let m;c.toSide=g;const p=c.fromSide,v=D=>{o.isDestroyed||(c.valid=D,t.classList.add(D?"b-valid":"b-invalid"),u.classList.add(D?"b-valid":"b-invalid"),l.trigger("dependencyValidationComplete",{data:c,source:f,target:h,dependencyType:m}))};switch(!0){case(p==="start"&&g==="start"):m=wt.Type.StartToStart;break;case(p==="start"&&g==="end"):m=wt.Type.StartToEnd;break;case(p==="end"&&g==="start"):m=wt.Type.EndToStart;break;case(p==="end"&&g==="end"):m=wt.Type.EndToEnd;break}l.trigger("dependencyValidationStart",{data:c,source:f,target:h,dependencyType:m});let y=c.valid=o.dependencyStore.isValidDependency(f,h,m);U.isPromise(y)&&(y=await y),v(y);const S=y?"b-valid":"b-invalid";u.classList.add(S),(a=(s=c.timeSpanElement)==null?void 0:s.querySelector(`.b-sch-terminal[data-side=${g}]`))==null||a.classList.add("b-sch-terminal-active",S)}o.updateCreationTooltip()}}async onMouseUp(){var t;const i=this,n=i.creationData;if(n.finalizing=!0,(t=i.pointerUpMoveDetacher)==null||t.call(i),n.valid)if(await i.view.trigger("beforeDependencyCreateFinalize",n)===!1?n.valid=!1:U.isPromise(n.valid)&&(n.valid=await n.valid),n.valid){let a=i.createDependency(n);a!==null&&(U.isPromise(a)&&(a=await a),n.dependency=a,i.view.trigger("dependencyCreateDrop",{data:n,source:n.source,target:n.target,dependency:a}),i.doAfterDependencyDrop(n))}else i.doAfterDependencyDrop(n);else n.valid=!1,i.doAfterDependencyDrop(n);i.abort()}doAfterDependencyDrop(t){this.view.trigger("afterDependencyCreateDrop",{data:t,...t})}onDocumentMouseUp({target:t}){this.view.timeAxisSubGridElement.contains(t)||this.abort()}abort(){var t,i;const n=this,{view:s,creationData:a}=n;if(a){const{source:o,sourceResource:l,target:c,targetResource:d}=a;if(o){const u=s.getElementFromEventRecord(o,l);u&&n.hideTerminals(u)}if(c){const u=s.getElementFromEventRecord(c,d);u&&n.hideTerminals(u)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(i=n.documentPointerUpDetacher)==null||i.call(n),n.removeConnector()}createConnector(t,i){const n=this,{view:s}=n;n.clearTimeout(n.removeConnectorTimeout),n.connector=C.createElement({parent:s.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${t}px;top:${i}px`}),s.element.classList.add("b-creating-dependency")}createDragTooltip(){const t=this,{view:i}=t;return t.creationTooltip=ue.new({id:`${i.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:i.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:t}},t.creationTooltip)}removeConnector(){const t=this,{connector:i,view:n}=t;i&&(i.classList.add("b-removing"),i.style.width="0",t.removeConnectorTimeout=t.setTimeout(()=>{i.remove(),t.connector=null},200)),n.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),n.scrollManager.stopMonitoring()}showTerminals(t,i){const n=this;if(!n.isCreateAllowed||!t.project)return;const s=n.terminalCls,a=`${s}s-visible`;if(i=C.down(i,n.view.eventInnerSelector),!i.classList.contains(a)&&!n.view.element.classList.contains("b-resizing-event")&&!n.view.readOnly){if(n.client.trigger("beforeShowTerminals",{source:t})===!1)return;n.terminalSides.forEach(o=>{o=n.fixSide(o);const l=C.createElement({parent:i,className:`${s} ${s}-${o}`,dataset:{side:o,feature:!0}});l.detacher=j.on({element:l,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})}),i.classList.add(a),t.internalCls.add(a),n.showingTerminalsFor=i}}fixSide(t){return t==="left"?"start":t==="right"?"end":t}hideTerminals(t){const i=this,n=i.client.getTimeSpanMouseEventParams(t),s=n==null?void 0:n[`${i.eventName}Record`],a=`${i.terminalCls}s-visible`;C.forEachSelector(t,`.${i.terminalCls}`,o=>{o.detacher&&o.detacher(),o.remove()}),C.down(t,i.view.eventInnerSelector).classList.remove(a),s.internalCls.remove(a),i.showingTerminalsFor=null}createDependency(t){const{source:i,target:n,fromSide:s,toSide:a}=t,o=(s==="start"?0:2)+(a==="end"?1:0),l=this.dependencyStore.add({from:i.id,to:n.id,type:o,fromSide:s,toSide:a});return l!==null?l[0]:null}getTargetSideFromType(t){return t===wt.Type.StartToStart||t===wt.Type.EndToStart?"start":"end"}updateCreationTooltip(){const t=this,i=t.creationData,{valid:n}=i,s=t.creationTooltip,{classList:a}=s.element;if(U.isPromise(n))return a.remove("b-invalid"),a.add("b-checking"),new Promise(o=>n.then(l=>{i.valid=l,s.isDestroyed||o(t.updateCreationTooltip())}));s.html=t.creationTooltipTemplate(i)}creationTooltipTemplate(t){var i,n;const s=this,{tooltip:a,valid:o}=t,{classList:l}=a.element;Object.assign(t,{fromText:L.encodeHtml(t.source.name),toText:L.encodeHtml((n=(i=t.target)==null?void 0:i.name)!=null?n:""),fromSide:t.fromSide,toSide:t.toSide||""});let c,d;return l.toggle("b-invalid",!o),l.remove("b-checking"),o===!0?(c="valid",d=s.L("L{Dependencies.valid}")):(c="invalid",d=s.L("L{Dependencies.invalid}")),a.title=`<i class="b-icon b-icon-${c}"></i>${d}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:s.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:t.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${t.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:s.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:t.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${t.toSide}`}]}]}}doDisable(t){this.isConfiguring||this.updateCreateListeners(),super.doDisable(t)}},xd=25,eA=e=>{var r;return r=class extends e{constructor(){super(...arguments),R(this,"gridCache",null)}getDependenciesToConsider(t,i,n,s){const a=this,{gridCache:o}=a,{timeAxis:l}=a.client;if(o){const c=new Set,d=Math.floor((t-l.startMS)/a.MS_PER_CELL),u=Math.floor((i-l.startMS)/a.MS_PER_CELL),h=Math.floor(n/xd),f=Math.floor(s/xd);for(let g=d;g<=u;g++){const m=o[g];if(m)for(let p=h;p<=f;p++){const v=m[p];if(v)for(let y=0;y<v.length;y++)c.add(v[y])}}return c}}afterDrawDependency(t,i,n,s,a){var o,l;const c=this;if(c.constructGridCache){const{MS_PER_CELL:d}=c,{startMS:u,endMS:h}=c.client.timeAxis,f=Math.ceil((h-u)/d),g=Math.floor((s-u)/d),m=Math.floor((a-u)/d),p=Math.floor(i/xd),v=Math.floor(n/xd),y=Math.min(g,m),S=Math.max(g,m),D=Math.min(p,v),w=Math.max(p,v);if(y<0&&S<0||y>f&&S>f)return;const E=Math.max(y,0),x=Math.min(S,f);for(let M=E;M<=x;M++){const I=(o=c.gridCache[M])!=null?o:c.gridCache[M]={};for(let P=D;P<=w;P++)((l=I[P])!=null?l:I[P]=[]).push(t)}}}beforeDraw(){const t=this;if(!t.gridCache){const{visibleDateRange:i}=t.client;t.constructGridCache=!0,t.MS_PER_CELL=Math.max(i.endMS-i.startMS,1e3),t.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},R(r,"$name","DependencyGridCache"),r},tA=Math.min(1/globalThis.devicePixelRatio,.75),rA=["start","end","top","bottom"],wi=(e,r)=>Math.abs(e-r)<.1,iA={l:"left",r:"right",t:"top",b:"bottom"},Bs=class extends F{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,r){const t=this,i=e;let n,s,a,o,l,c,d,u,h,f,g,m,p,v,y,S,D,w,E,x,M,I,P,_,A,V,N,B,Z;for(r=H.asArray(r),Z=0;e&&!B;)for(n=Object.assign(t.config,e),s=n.startBox,a=n.endBox,o=n.startShift,l=n.endShift,c=n.startSide,d=n.endSide,u=n.startArrowMargin,h=n.endArrowMargin,f=n.horizontalMargin,g=n.verticalMargin,m=n.hasOwnProperty("startHorizontalMargin")?n.startHorizontalMargin:f,p=n.hasOwnProperty("startVerticalMargin")?n.startVerticalMargin:g,v=n.hasOwnProperty("endHorizontalMargin")?n.endHorizontalMargin:f,y=n.hasOwnProperty("endVerticalMargin")?n.endVerticalMargin:g,S=n.hasOwnProperty("otherHorizontalMargin")?n.otherHorizontalMargin:f,D=n.hasOwnProperty("otherVerticalMargin")?n.otherVerticalMargin:g,w=n.otherBoxes,c=t.normalizeSide(c),d=t.normalizeSide(d),E=t.getConnectionCoordinatesFromBoxSideShift(s,c,o),x=t.getConnectionCoordinatesFromBoxSideShift(a,d,l),A=t.calcGridBaseBoxFromBoxAndDrawParams(s,c,u,m,p),V=t.calcGridBaseBoxFromBoxAndDrawParams(a,d,h,v,y),rA.forEach(K=>{Math.abs(A[K]-V[K])<=tA&&(V[K]=A[K])}),t.shouldLookForPath(s,a,A,V)&&(w=w==null?void 0:w.map(K=>t.calcGridBaseBoxFromBoxAndDrawParams(K,!1,0,S,D)),M=t.getConnectionCoordinatesFromBoxSideShift(A,c,o),I=t.getConnectionCoordinatesFromBoxSideShift(V,d,l),N=t.buildPathGrid(A,V,M,I,c,d,w),P=t.convertDecartPointToGridPoint(N,M),_=t.convertDecartPointToGridPoint(N,I),B=t.findPathOnGrid(N,P,_,c,d)),e=!1;!B&&!e&&r&&Z<r.length;Z++)e=r[Z](n,i);return B&&(B=t.prependPathWithArrowStaffSegment(B,E,c),B=t.appendPathWithArrowStaffSegment(B,x,d),B=t.optimizePath(B)),B}static calculateRelativePosition(e,r,t=!1){const i=t?"top":"start",n=t?"bottom":"end";let s;return e[n]<r[i]?s=0:e[n]<=r[n]&&e[n]>=r[i]&&e[i]<r[i]?s=1:e[i]>=r[i]&&e[n]<=r[n]?s=2:e[i]<r[i]&&e[n]>r[n]?s=-2:e[i]<=r[n]&&e[n]>r[n]?s=3:s=4,s}static boxOverlapChanged(e,r,t,i,n=!1){const s=Bs.calculateRelativePosition,a=s(e,r,n),o=s(t,i,n);return a!==o}shouldLookForPath(e,r,t,i){let n=!0;return(e.end-e.start<=this.startArrowMargin||r.end-r.start<=this.endArrowMargin)&&Math.abs(Bs.calculateRelativePosition(e,r,!0))===2&&(n=!Bs.boxOverlapChanged(e,r,t,i)),n}getConnectionCoordinatesFromBoxSideShift(e,r,t){let i;switch(r){case"left":i={x:e.start,y:(e.top+e.bottom)/2+t};break;case"right":i={x:e.end,y:(e.top+e.bottom)/2+t};break;case"top":i={x:(e.start+e.end)/2+t,y:e.top};break;case"bottom":i={x:(e.start+e.end)/2+t,y:e.bottom};break}return i}calcGridBaseBoxFromBoxAndDrawParams(e,r,t,i,n){let s;switch(this.normalizeSide(r)){case"left":s={start:e.start-Math.max(t,i),end:e.end+i,top:e.top-n,bottom:e.bottom+n};break;case"right":s={start:e.start-i,end:e.end+Math.max(t,i),top:e.top-n,bottom:e.bottom+n};break;case"top":s={start:e.start-i,end:e.end+i,top:e.top-Math.max(t,n),bottom:e.bottom+n};break;case"bottom":s={start:e.start-i,end:e.end+i,top:e.top-n,bottom:e.bottom+Math.max(t,n)};break;default:s={start:e.start-i,end:e.end+i,top:e.top-n,bottom:e.bottom+n}}return s}normalizeSide(e){const{rtl:r}=this.client;return e==="start"?r?"right":"left":e==="end"?r?"left":"right":e}buildPathGrid(e,r,t,i,n,s,a){let o,l,c,d,u,h,f,g,m,p,v,y,S;const D={},w=[];for(o=[e.start,n==="left"||n==="right"?(e.start+e.end)/2:t.x,e.end,r.start,s==="left"||s==="right"?(r.start+r.end)/2:i.x,r.end],l=[e.top,n==="top"||n==="bottom"?(e.top+e.bottom)/2:t.y,e.bottom,r.top,s==="top"||s==="bottom"?(r.top+r.bottom)/2:i.y,r.bottom],a&&a.forEach(E=>{o.push(E.start,(E.start+E.end)/2,E.end),l.push(E.top,(E.top+E.bottom)/2,E.bottom)}),o=[...new Set(o.sort((E,x)=>E-x))],l=[...new Set(l.sort((E,x)=>E-x))],h=0,g=l.length;h<g;++h)for(D[h]=D[h]||{},c=l[h],u=0,f=o.length;u<f;++u){if(d=o[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=r.start||d>=r.end||c<=r.top||c>=r.bottom),a)for(m=0,p=a.length;y&&m<p;++m)v=a[m],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===t.x&&c===t.y||d===i.x&&c===i.y;S={distance:Number.MAX_SAFE_INTEGER,permitted:y,x:d,y:c,ix:u,iy:h},D[h][u]=S,w.push(S)}return{width:o.length,height:l.length,xs:o,ys:l,points:D,linearPoints:w}}convertDecartPointToGridPoint(e,r){const t=e.xs.indexOf(r.x),i=e.ys.indexOf(r.y);return e.points[i][t]}findPathOnGrid(e,r,t,i,n){const s=this;let a=!1;return r.permitted&&t.permitted&&(e=s.waveForward(e,r,0),a=s.collectPath(e,t,n)),a}getGridPointNeighbors(e,r,t){const i=r.ix,n=r.iy,s=[];let a;return n<e.height-1&&(a=e.points[n+1][i],(!t||t(a))&&s.push(a)),n>0&&(a=e.points[n-1][i],(!t||t(a))&&s.push(a)),i<e.width-1&&(a=e.points[n][i+1],(!t||t(a))&&s.push(a)),i>0&&(a=e.points[n][i-1],(!t||t(a))&&s.push(a)),s}waveForward(e,r,t){const i=this;return qn.preWalkUnordered([r,t],([n,s])=>i.getGridPointNeighbors(e,n,a=>a.permitted&&a.distance>s+1).map(a=>[a,s+1]),([n,s])=>n.distance=s),e}collectPath(e,r,t){const i=this,n=[];let s=!0,a,o,l,c;for(;s&&r.distance;)if(a=i.getGridPointNeighbors(e,r,d=>d.permitted&&d.distance===r.distance-1),s=a.length>0,s){switch(a=a.sort((d,u)=>{let h,f;h=d.ix-r.ix,f=d.iy-r.iy;const g=(t==="left"||t==="right")&&f===0||(t==="top"||t==="bottom")&&h===0?-1:1;h=u.ix-r.ix,f=u.iy-r.iy;const m=(t==="left"||t==="right")&&f===0||(t==="top"||t==="bottom")&&h===0?-1:1;if(g>m)return 1;if(g<m)return-1;if(g===m)return d.y>u.y?-1:1}),o=a[0],n.push({x1:o.x,y1:o.y,x2:r.x,y2:r.y}),l=o.ix-r.ix,c=o.iy-r.iy,!0){case(!c&&l>0):t="left";break;case(!c&&l<0):t="right";break;case(!l&&c>0):t="top";break;case(!l&&c<0):t="bottom";break}r=o}return s&&n.reverse()||!1}prependPathWithArrowStaffSegment(e,r,t){if(e.length>0){const i=e[0],n={x2:i.x1,y2:i.y1};switch(t){case"left":n.x1=r.x,n.y1=i.y1;break;case"right":n.x1=r.x,n.y1=i.y1;break;case"top":n.x1=i.x1,n.y1=r.y;break;case"bottom":n.x1=i.x1,n.y1=r.y;break}e.unshift(n)}return e}appendPathWithArrowStaffSegment(e,r,t){if(e.length>0){const i=e[e.length-1],n={x1:i.x2,y1:i.y2};switch(t){case"left":n.x2=r.x,n.y2=i.y2;break;case"right":n.x2=r.x,n.y2=i.y2;break;case"top":n.x2=i.x2,n.y2=r.y;break;case"bottom":n.x2=i.x2,n.y2=r.y;break}e.push(n)}return e}optimizePath(e){const r=[];let t,i;if(e.length>0)for(t=e.shift(),r.push(t);e.length>0;)i=e.shift(),wi(t.x1,i.x1)&&wi(t.y1,i.y1)&&wi(t.x2,i.x2)&&wi(t.y2,i.y2)?t=i:wi(t.y1,t.y2)&&wi(i.y1,i.y2)?t.x2=i.x2:wi(t.x1,t.x2)&&wi(i.x1,i.x2)?t.y2=i.y2:(r.push(i),t=i);return r}};Bs._$name="RectangularPathFinder";function Lw(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function $g(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function nA(e,r,t){const i=Lw(e)+Lw(r),n=t*(i.includes("l")?-1:1),s=t*(i.includes("u")?-1:1);return`a${n},${s} 0 0 ${i==="ur"||i==="lu"||i==="dl"||i==="rd"?1:0} ${n},${s}`}function sA(e,r,t,i,n){let s=e.x1===e.x2?"v":"h",a=i;if(i){const o=$g(e),l=r?Math.abs($g(r)):Number.MAX_SAFE_INTEGER,c=Math.sign(o);n==null&&(n=i),(Math.abs(o)<i*2||l<i*2)&&(a=Math.min(Math.abs(o),l)/2);const d=t==="single"?0:t==="first"?a:t==="between"?n+a:n,u=o-d*c;s+=Math.sign(u)!==c?0:u,t!=="last"&&t!=="single"&&a>0&&(s+=` ${nA(e,r,a)}`)}else s+=$g(e);return{line:s,currentRadius:i!==a?a:null}}function aA(e,r){const{length:t}=r;if(!t)return"";let i=null;return`M${r[0].x1},${r[0].y1} ${r.map((n,s)=>{const a=t===1?"single":s===t-1?"last":s===0?"first":"between",o=sA(n,r[s+1],a,e,i);return{currentRadius:i}=o,o.line}).join(" ")}`}var oA=e=>{var r;return r=class extends e{constructor(){super(...arguments),R(this,"lineCache",{})}onSVGReady(){const t=this;t.pathFinder=new Bs({...t.pathFinderConfig,client:t.client}),t.lineDefAdjusters=t.createLineDefAdjusters(),t.createMarker()}changeRadius(t){return t!==null&&T.assertNumber(t,"radius"),t}updateRadius(){this.isConfiguring||this.reset()}updateRenderer(){this.isConfiguring||this.reset()}changeClickWidth(t){return t!==null&&T.assertNumber(t,"clickWidth"),t}updateClickWidth(){this.isConfiguring||this.reset()}createMarker(){var t,i;const n=this,{markerDef:s}=n,a=this.client.svgCanvas,o=s?`${n.client.id}-arrowEnd`:"arrowEnd";(t=n.marker)==null||t.remove(),a.style.setProperty("--scheduler-dependency-marker",`url(#${o})`),n.marker=C.createElement({parent:a,id:o,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:(i=n.markerDef)!=null?i:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(t){var i,n;return((n=(i=this.client.features.eventDrag)==null?void 0:i.getProxyElement)==null?void 0:n.call(i,t))||this.client.getElementFromAssignmentRecord(t)}getDomConfigs(t,i,n,s){var a,o;const l=this,c=l.getDependencyKey(t,i,n),d=l.lineCache[c];if(l.constructLineCache||!d||s||l.drawingLive&&(l.getAssignmentElement(i)||l.getAssignmentElement(n))){const u=l.prepareLineDef(t,i,n,s),h=u&&l.pathFinder.findPath(u,l.lineDefAdjusters),{client:f,clickWidth:g}=l,{toEvent:m}=t;if(h){const p=l.highlighted.get(t),v={tag:"path",ns:"http://www.w3.org/2000/svg",d:aA((a=l.radius)!=null?a:0,h),role:"presentation",dataset:{syncId:c,depId:t.id,fromId:i.id,toId:n.id},elementData:{dependency:t,points:h},class:{[l.baseCls]:1,[t.cls]:t.cls,[t.highlighted]:t.highlighted,[p&&[...p].join(" ")]:p,[l.noMarkerCls]:u.hideMarker,"b-inactive":t.active===!1,"b-sch-bidirectional-line":t.bidirectional,"b-readonly":t.readOnly,"b-sch-dependency-ends-outside":!m.milestone&&(m.endDate<=f.startDate||f.endDate<=m.startDate)||m.milestone&&(m.endDate<f.startDate||f.endDate<m.startDate)}};(o=l.renderer)==null||o.call(l,{domConfig:v,points:h,dependencyRecord:t,fromAssignmentRecord:i,toAssignmentRecord:n,fromBox:u.startBox,toBox:u.endBox,fromSide:u.startSide,toSide:u.endSide});const y=[v];return g>1&&y.push({...v,class:{...v.class,"b-click-area":1},dataset:{...v.dataset,syncId:`${v.dataset.syncId}-click-area`},style:{strokeWidth:g}}),l.lineCache[c]=y}return l.lineCache[c]=null}return d}generateBoundaryBoxes(t,i){return i==="bottom"?[{start:t.left,end:t.left+t.width/2,top:t.rowTop,bottom:t.rowBottom},{start:t.left+t.width/2,end:t.right,top:t.rowTop,bottom:t.rowBottom}]:[{start:t.left-this.pathFinder.startArrowMargin,end:t.right+this.pathFinder.startArrowMargin,top:t.rowTop,bottom:t.rowBottom}]}getAssignmentBounds(t){const{client:i}=this,n=this.getAssignmentElement(t);if(n&&!i.isExporting){const s=k.from(n,this.relativeTo);if(i.isHorizontal){let a=i.getRowById(t.resource.id);if(s.y<a.top||s.bottom>a.bottom){const o=i.rowManager.getRowAt(s.center.y,!0);o&&(a=o)}s.rowTop=a.top,s.rowBottom=a.bottom}return s}return i.isEngineReady&&i.getAssignmentEventBox(t,!0)}getConnectorStartSide(t){return this.client.currentOrientation.getConnectorStartSide(t)}getConnectorEndSide(t){return this.client.currentOrientation.getConnectorEndSide(t)}getDependencyStartSide(t){const{fromEvent:i,type:n,fromSide:s}=t;if(s)return s;switch(!0){case n===Dt.Type.StartToEnd:case n===Dt.Type.StartToStart:return this.getConnectorStartSide(i);case n===Dt.Type.EndToStart:case n===Dt.Type.EndToEnd:return this.getConnectorEndSide(i);default:return this.getConnectorEndSide(i)}}getDependencyEndSide(t){const{toEvent:i,type:n,toSide:s}=t;if(s)return s;switch(!0){case n===Dt.Type.EndToEnd:case n===Dt.Type.StartToEnd:return this.getConnectorEndSide(i);case n===Dt.Type.EndToStart:case n===Dt.Type.StartToStart:return this.getConnectorStartSide(i);default:return this.getConnectorStartSide(i)}}createLineDefAdjusters(){const{client:t}=this;function i(a){const{barMargin:o}=t;let l=!1;return(a.startArrowMargin>o||a.endArrowMargin>o)&&(a.startArrowMargin=a.endArrowMargin=o,l=!0),l&&a}function n(a){let o=!1;return(a.startArrowMargin>0||a.endArrowMargin>0)&&(a.startArrowMargin=a.endArrowMargin=0,o=!0),o&&a}function s(a,o){let l=!1;return a.horizontalMargin>2&&(a.horizontalMargin=1,l=!0,o.hideMarker=!0),l&&a}return[i,n,s]}adjustLineDef(t,i){return i}prepareLineDef(t,i,n,s){var a,o;const l=this,c=l.getDependencyStartSide(t),d=l.getDependencyEndSide(t),u=(a=s==null?void 0:s.from)!=null?a:l.getAssignmentBounds(i),h=(o=s==null?void 0:s.to)!=null?o:l.getAssignmentBounds(n),f=[];if(!u||!h)return null;let{startArrowMargin:g,verticalMargin:m}=l.pathFinder;return l.client.isHorizontal&&(u.rowTop!=null&&u.rowTop!==h.rowTop&&f.push(...l.generateBoundaryBoxes(u,c)),t.bidirectional||(/(top|bottom)/.test(c)&&(g=l.client.barMargin/2),m=l.client.barMargin/2)),l.adjustLineDef(t,{startBox:u,endBox:h,otherBoxes:f,startArrowMargin:g,verticalMargin:m,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:c,endSide:d})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},R(r,"$name","DependencyLineGenerator"),r},lA=["start","start","end","end"],cA=["start","end","start","end"],$w=e=>{var r;return r=class extends e{changeTooltip(t,i){const n=this;return i==null||i.destroy(),!n.showTooltip||!t?null:ue.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},t)}getHoverTipHtml({activeTarget:t}){return this.tooltipTemplate(this.resolveDependencyRecord(t))}},R(r,"$name","DependencyTooltip"),R(r,"configurable",{showTooltip:!0,tooltipTemplate(t){return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:this.L("L{Dependencies.from}")},{text:t.fromEvent.name},{className:`b-sch-box b-${t.fromSide||lA[t.type]}`},{tag:"label",text:this.L("L{Dependencies.to}")},{text:t.toEvent.name},{className:`b-sch-box b-${t.toSide||cA[t.type]}`}]}]}},tooltip:{$config:"nullify",value:{}}}),r},dA={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},jw=e=>{var r;const t=[e];return(r=e.resource)!=null&&r.hasLinks&&t.push(...e.resource.$links.map(i=>({id:`${i.id}_${e.id}`,resource:i,event:e.event,drawDependencies:e.drawDependencies}))),t},vn=class extends X.mixin(er,ge,Ow,eA,oA,$w){constructor(){super(...arguments),R(this,"domConfigs",new Map),R(this,"drawingLive",!1),R(this,"lastScrollX",null),R(this,"highlighted",new Map),R(this,"visibleResources",null),R(this,"usingLinks",null),R(this,"visibleDateRange",null),R(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,r){super.construct(e,r);const{scheduledEventName:t}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[t+"DragStart"]:"refresh",[t+"DragAbort"]:"refresh",[t+"ResizeStart"]:"refresh",[t+"SegmentDragStart"]:"refresh",[t+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const r=this;r.client.isVertical||(r.detachListeners("store"),r.client.usesDisplayStore&&(e==null||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:r}),r.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),e==null||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e==null||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),e==null||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),e==null||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),e==null||e.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const r=this;r.detachListeners("scroll"),e?r.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:r}):(r.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:r}),r.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:r}))}onHorizontalScroll({subGrid:e,scrollX:r}){r!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=r,this.draw())}onPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,r,t){return this.getElementsForDependency(e,r,t)[0]}getElementsForDependency(e,r,t){let i=`[data-dep-id="${e.id}"]`;return r&&(i+=`[data-from-id="${r.id}"]`),t&&(i+=`[data-to-id="${t.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(i))}resolveDependencyRecord(e){var r;return(r=e.elementData)==null?void 0:r.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const r=this.resolveDependencyRecord(e.target);if(r){const t=dA[e.type];this.client.trigger(`dependency${t}`,{dependency:r,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const r=this,t=r.resolveDependencyRecord(e.target);t&&(r.client.trigger("dependencyMouseOver",{dependency:t,event:e}),r.overCls&&r.highlight(t))}onElementMouseOut(e){const r=this,t=r.resolveDependencyRecord(e.target);t&&(r.client.trigger("dependencyMouseOut",{dependency:t,event:e}),r.overCls&&r.unhighlight(t))}isDependencyVisible(e){const r=this,{rowStore:t}=r,{fromEvent:i,toEvent:n}=e;if(!i||!n)return!1;const s=i.resource,a=n.resource;return!t.isAvailable(s)||!t.isAvailable(a)?!1:i.isModel&&!s.instanceMeta(t).hidden&&!a.instanceMeta(t).hidden}updateHighlightDependenciesOnEventHover(e){const r=this;if(e){const{client:t}=r;t.ion({name:"highlightOnHover",[`${t.scheduledEventName}MouseEnter`]:i=>r.highlightEventDependencies(i.eventRecord||i.taskRecord),[`${t.scheduledEventName}MouseLeave`]:i=>r.unhighlightEventDependencies(i.eventRecord||i.taskRecord),thisObj:r})}else r.detachListeners("highlightOnHover")}highlight(e,r=this.overCls){let t=this.highlighted.get(e);t||this.highlighted.set(e,t=new Set),t.add(r);for(const i of this.getElementsForDependency(e))i.classList.add(r)}unhighlight(e,r=this.overCls){const t=this.highlighted.get(e);t&&(t.delete(r),t.size||this.highlighted.delete(e));for(const i of this.getElementsForDependency(e))i.classList.remove(r)}highlightEventDependencies(e,r){e.dependencies.forEach(t=>this.highlight(t,r))}unhighlightEventDependencies(e,r){e.dependencies.forEach(t=>this.unhighlight(t,r))}getDependenciesToConsider(e,r,t,i){var n,s;return(s=(n=super.getDependenciesToConsider)==null?void 0:n.call(this,e,r,t,i))!=null?s:this.project.dependencyStore.records.filter(a=>a.isValid)}getDependencyKey(e,r,t){return`dep:${e.id};from:${r.id};to:${t.id}`}drawDependency(e,r=!1,t=null){var i,n,s,a;const o=this,{domConfigs:l,client:c,rowStore:d,topIndex:u,bottomIndex:h}=o,{eventStore:f,useInitialAnimation:g}=c,{idMap:m}=d,{startMS:p,endMS:v}=o.visibleDateRange,{fromEvent:y,toEvent:S}=e;let D=y.assigned,w=S.assigned;if(y.isScheduled&&S.isScheduled&&f.includes(y)&&f.includes(S)&&(D!=null&&D.size)&&(w!=null&&w.size)){o.usingLinks&&(D=[...D].flatMap(jw),w=[...w].flatMap(jw));for(const E of D)for(const x of w){const M=(n=m[(i=E.resource)==null?void 0:i.id])==null?void 0:n.index,I=(a=m[(s=x.resource)==null?void 0:s.id])==null?void 0:a.index,P=Math.min(y.startDateMS,S.startDateMS),_=Math.max(y.endDateMS,S.endDateMS);if(c.isExporting||M!=null&&I!=null&&E.drawDependencies!==!1&&x.drawDependencies!==!1&&d.isAvailable(E.resource)&&d.isAvailable(x.resource)&&!(M<u&&I<u||M>h&&I>h||P<p&&_<p||P>v&&_>v)){const A=o.getDependencyKey(e,E,x),V=o.getDomConfigs(e,E,x,t);V?(g&&(V[0].style={animationDelay:`${Math.max(M,I)/20*1e3}ms`}),l.set(A,V)):l.delete(A)}o.afterDrawDependency(e,M,I,P,_)}}r||o.domSync()}afterDrawDependency(e,r,t,i,n){var s;(s=super.afterDrawDependency)==null||s.call(this,e,r,t,i,n)}beforeDraw(){var e;(e=super.beforeDraw)==null||e.call(this)}afterDraw(){var e;(e=super.afterDraw)==null||e.call(this)}domSync(e=this.client.svgCanvas){q.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}})}fillDrawingCache(){const e=this,{client:r}=e;e.relativeTo=k.from(r.foregroundCanvas),e.visibleResources=r.visibleResources,e.visibleDateRange=r.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),e.usingLinks==null&&(e.usingLinks=r.resourceStore.some(t=>t.hasLinks))}draw(){const e=this,{client:r}=e;if(!(r.refreshSuspended||!r.foregroundCanvas||!r.isEngineReady||e.disabled&&!e._isDisabling||r.isExporting)){if(e.fillDrawingCache(),e.domConfigs.clear(),r.firstVisibleRow&&r.lastVisibleRow&&r.timeAxis.count&&!e.disabled&&e.visibleDateRange.endMS-e.visibleDateRange.startMS>0){const{visibleDateRange:t}=r,{topIndex:i,bottomIndex:n}=e,s=e.getDependenciesToConsider(t.startMS,t.endMS,i,n);e.beforeDraw();for(const a of s)e.drawDependency(a,!0);e.afterDraw()}e.domSync(),r.trigger("dependenciesDrawn")}}doRefresh(){var e,r,t,i;const n=this,{client:s}=n,{scheduledEventName:a}=s;n.draw(),n.drawingLive=s.dependencyStore.count&&(s.isAnimating||s.useInitialAnimation&&s.eventStore.count||((e=s.features[`${a}Drag`])==null?void 0:e.isActivelyDragging)||((r=s.features[`${a}Resize`])==null?void 0:r.isResizing)||((t=s.features[`${a}SegmentDrag`])==null?void 0:t.isActivelyDragging)||((i=s.features[`${a}SegmentResize`])==null?void 0:i.isResizing)),n.drawingLive&&n.refresh()}refresh(){const{client:e}=this;!e.refreshSuspended&&!this.disabled&&e.isPainted&&!e.timeAxisSubGrid.collapsed&&this.doRefresh()}reset(){var e;(e=super.reset)==null||e.call(this),this.refresh()}drawForEvent(){re.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}};R(vn,"$name","Dependencies"),R(vn,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null}),R(vn,"delayable",{doRefresh:10}),vn._$name="Dependencies",z.registerFeature(vn,!1,["Scheduler","ResourceHistogram"]),z.registerFeature(vn,!0,"SchedulerPro");var Bw=class extends st{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const{dependencyEditFeature:r}=this;return e.ref==="lagField"&&!r.showLagField||e.ref==="deleteButton"&&!r.showDeleteButton?!1:super.processWidgetConfig(e)}afterShow(...e){const{deleteButton:r}=this.widgetMap;r&&(r.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}};Bw._$name="DependencyEditor";var Rd=class extends X{static get $name(){return"DependencyEdit"}static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const e=this.parent;return Object.keys(Dt.Type).map(r=>({id:Dt.Type[r],name:e.L(r),localeKey:r}))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,r){const t=this;if(e.dependencyEdit=t,super.construct(e,r),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");t.clientListenersDetacher=e.ion({[t.triggerEvent]:t.onActivateEditor,thisObj:t})}doDestroy(){var e;this.clientListenersDetacher(),(e=this.editor)==null||e.destroy(),super.doDestroy()}changeEditorConfig(e){const r=this,{autoClose:t,cls:i,client:n}=r;return T.assign({owner:n,align:"b-t",id:`${n.id}-dependency-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],constrainTo:globalThis,autoClose:t,cls:i},e)}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!e.name||e.hidden?!0:e.isValid!==!1)}get values(){const e={};return this.editor.eachWidget(r=>{!r.name||r.hidden||(e[r.name]=r.value)},!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:r}=this;r.lag&&(r.lagUnit=r.lag.unit,r.lag=r.lag.magnitude),"type"in r&&(e.fromSide!=null&&(r.fromSide=null),e.toSide!=null&&(r.toSide=null)),T.cleanupProperties(r,!0),e.set(r)}onPopupKeyDown({event:e}){e.key==="Enter"&&this.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const r=this,{client:t}=r;let i=r.lastPointerDownCoordinate;if(t.trigger("beforeDependencyEdit",{dependencyEdit:r,dependencyRecord:e})===!1)return;const n=r.getEditor(e);if(r.loadRecord(e),t.trigger("beforeDependencyEditShow",{dependencyEdit:r,dependencyRecord:e,editor:n}),!i){const s=k.from(r.client.element).center;i=[s.x-n.width/2,s.y-n.height/2]}n.showBy(i)}editDependency(e){this.client.readOnly||e.readOnly||this.internalShowEditor(e)}getEditor(){var e,r,t;const i=this;let{editor:n}=i;return n||(n=i.editor=Bw.new({dependencyEditFeature:i,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:i.autoClose,cls:i.cls,rootElement:i.client.rootElement,internalListeners:{keydown:i.onPopupKeyDown,thisObj:i}},i.editorConfig),n.items.length===0&&console.warn("Editor configured without any `items`"),n.eachWidget(s=>{const a=s.ref||s.id;a&&!i[a]&&(i[a]=s)}),(e=i.saveButton)==null||e.ion({click:"onSaveClick",thisObj:i}),(r=i.deleteButton)==null||r.ion({click:"onDeleteClick",thisObj:i}),(t=i.cancelButton)==null||t.ion({click:"onCancelClick",thisObj:i}),i.editor)}loadRecord(e){const r=this;r.fromNameField.value=e.fromEvent.name,r.toNameField.value=e.toEvent.name,r.lagField&&(r.lagField.value=new Le(e.lag,e.lagUnit)),r.editor.record=r.dependencyRecord=e}async save(){var e;const r=this,{client:t,dependencyRecord:i}=r;if(!i||!r.isValid)return;const{dependencyStore:n,values:s}=r;if(t.trigger("beforeDependencySave",{dependencyRecord:i,values:s})!==!1){if(r.onBeforeSave(i),r.updateRecord(i),n&&!i.stores.length){if(t.trigger("beforeDependencyAdd",{dependencyRecord:i,dependencyEdit:r})===!1)return;n.add(i)}await((e=t.project)==null?void 0:e.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:i}),r.onAfterSave(i)}return i}async deleteDependency(){var e;const{client:r,editor:t,dependencyRecord:i}=this;return r.trigger("beforeDependencyDelete",{dependencyRecord:i})!==!1?(t.containsFocus&&t.revertFocus(),r.dependencyStore.remove(i),await((e=r.project)==null?void 0:e.commitAsync()),!0):!1}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:r}){this.disabled||(this.lastPointerDownCoordinate=[r.clientX,r.clientY],this.editDependency(e))}};Rd._$name="DependencyEdit",z.registerFeature(Rd,!1);var Hs=class extends X.mixin(ge){static get $name(){return"ScheduleContext"}construct(e,r){super.construct(e,r);const{triggerEvent:t}=this,i={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clearContext",thisObj:this};t==="mouseover"?i.timelineContextChange="onTimelineContextChange":((t==="click"||t==="mousedown")&&(i.schedulecontextmenu="onScheduleContextGesture"),Object.assign(i,{[`schedule${t}`]:"onScheduleContextGesture",[`event${t}`]:"onScheduleContextGesture",...i})),e.useBackgroundCanvas=!0,e.ion(i),e.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(e){return(e==="hover"||e==="mousemove")&&(e="mouseover"),e}get element(){return this._element||(this._element=C.createElement({parent:this.client.backgroundCanvas,className:"b-schedule-selected-tick"}))}onTimelineContextChange({context:e}){this.context=e}onScheduleContextGesture(e){this.context=e}onTimeAxisViewModelUpdate({source:e}){var r;e.timeAxis.includes((r=this.context)==null?void 0:r.tick)?this.syncContextElement():this.clearContext()}clearContext(){this.context=null}updateContext(e,r){this.syncContextElement()}syncContextElement(){if(this.context&&this.enabled){const e=this,{client:r,element:t,context:i,renderer:n}=e,{isVertical:s}=r,{style:a}=t,o=s?r.rowManager.rows[0]:r.getRowFor(i.resourceRecord);if(o){const{tickStartDate:l,tickEndDate:c,resourceRecord:d}=i,u=r.currentOrientation.getTimeSpanRenderData({startDate:l,endDate:c,startDateMS:l.getTime(),endDateMS:c.getTime()},d);let h,f,g;s?(h=u.top,f=u.resourceWidth,g=u.height):(h=o.top,f=u.width,g=o.height),a.display="",a.width=`${f}px`,a.height=`${g}px`,C.setTranslateXY(t,u.left,h),i.index=o.index,t.innerHTML="",n&&e.callback(n,e,[i,t])}else a.display="none"}else this.element.style.display="none"}};R(Hs,"delayable",{syncContextElement:"raf"}),R(Hs,"configurable",{triggerEvent:"click",renderer:null,context:{$config:{equal(e,r){return(e==null?void 0:e.index)===(r==null?void 0:r.index)&&(e==null?void 0:e.tickParentIndex)===(r==null?void 0:r.tickParentIndex)&&!(((e==null?void 0:e.tickStartDate)||0)-((r==null?void 0:r.tickStartDate)||0))}}}}),Hs.featureClass="b-scheduler-context",Hs._$name="ScheduleContext",z.registerFeature(Hs,!1,["Scheduler"]);var yn=class extends X{constructor(){super(...arguments),R(this,"clipboardRecords",[]),R(this,"entityName","event")}construct(e,r){super.construct(e,r),e.ion({eventclick:this.onEventClick,scheduleclick:this.onScheduleClick,projectChange:()=>{this.clearClipboard(),this._cellClickedContext=null},thisObj:this}),this.scheduler=e}onEventDataGenerated(e){const{assignmentRecord:r}=e;r&&(e.cls["b-cut-item"]=r.meta.isCut)}onEventClick(e){this._cellClickedContext=null}onScheduleClick(e){this._cellClickedContext=e}isActionAvailable({event:e}){var r;const t=this.client.features.cellEdit;return!this.disabled&&globalThis.getSelection().toString().length===0&&!(t!=null&&t.isEditing)&&!!e.target.closest(".b-timeaxissubgrid")&&!((r=this.client.focusedCell)!=null&&r.isSpecialRow)}copy(){this.copyEvents()}cut(){this.copyEvents(void 0,!0)}paste(){this.pasteEvents()}copyEvents(e=this.scheduler.selectedAssignments,r=!1){const t=this,{scheduler:i,entityName:n}=t;if(!(e!=null&&e.length))return;let s=e.slice();e[0].isEventModel&&(s=e.map(o=>o.assignments).flat()),r&&(s=s.filter(o=>!o.event.readOnly));const a=s.map(o=>o.event);!s.length||i.readOnly||i.trigger("beforeCopy",{assignmentRecords:s,records:a,eventRecords:a,isCut:r,entityName:n})===!1||(s.length>0&&i.trigger("copy",{assignmentRecords:s,eventRecords:a,isCut:r,entityName:n}),t._isCut=r,t.clipboard={assignmentRecords:s,eventRecords:a},i.assignmentStore.forEach(o=>{o.meta.isCut=r&&s.includes(o)}),i.refreshWithTransition())}pasteEvents(e,r){const t=this,{clipboard:i,scheduler:n,entityName:s}=t;if(!i)return;const{assignmentRecords:a,eventRecords:o}=i,l=t._isCut;let c;if(arguments.length===0){const g=t._cellClickedContext||{};e=g.date,r=g.resourceRecord}if(r&&(r.readOnly&&(c="resourceReadOnly"),r=r.$original),n.allowOverlap||a.some(m=>!n.isDateRangeAvailable(m.event.startDate,m.event.endDate,l?m.event:null,m.resource))&&(c="overlappingEvents"),c){n.trigger("pasteNotAllowed",{assignmentRecords:a,records:o,eventRecords:o,resourceRecord:r||a[0].resource,date:e,isCut:l,entityName:s,reason:c});return}if(!i||n.trigger("beforePaste",{assignmentRecords:a,records:o,eventRecords:o,resourceRecord:r||a[0].resource,date:e,isCut:l,entityName:s})===!1)return;let d=null;const u=new Set,h=[];for(const g of a){let{event:m}=g;const p=r||g.resource,v=e||g.event.startDate;if(u.has(m)){l&&g.remove();continue}if(u.add(m),l)g.meta.isCut=!1,g.resource=p,d=g;else if(n.eventStore.usesSingleAssignment||t.copyPasteAction==="clone")m=m.copy(),m.name=t.generateNewName(m),n.eventStore.add(m),m.assign(p),d=n.assignmentStore.last;else if(!m.resources.includes(p)){const y=g.copy();y.resource=p,[d]=n.assignmentStore.add(y)}m.startDate=v,m.constraintDate&&(m.constraintDate=null),h.push(m)}i&&n.trigger("paste",{assignmentRecords:a,pastedEventRecords:h,eventRecords:o,resourceRecord:r,date:e,isCut:l,entityName:s});const f=n.ion({renderEvent({assignmentRecord:g}){g===d&&(n.navigateTo(g,{scrollIntoView:!1}),f())}});l&&t.clearClipboard()}clearClipboard(){const e=this;e._isCut&&(e.clipboard.assignmentRecords.forEach(r=>{r.meta.isCut=!1}),e.scheduler.refreshWithTransition(),e._isCut=!1),e.clipboard=null}populateEventMenu({assignmentRecord:e,items:r}){const t=this,{scheduler:i}=t;i.readOnly||(r.copyEvent={text:"L{copyEvent}",localeClass:t,icon:"b-icon b-icon-copy",weight:110,onItem:()=>{const n=i.isAssignmentSelected(e)?i.selectedAssignments:[e];t.copyEvents(n)}},r.cutEvent={text:"L{cutEvent}",localeClass:t,icon:"b-icon b-icon-cut",weight:120,disabled:e.event.readOnly,onItem:()=>{const n=i.isAssignmentSelected(e)?i.selectedAssignments:[e];t.copyEvents(n,!0)}})}populateScheduleMenu({items:e,resourceRecord:r}){const t=this,{scheduler:i}=t;!i.readOnly&&t.clipboard&&(e.pasteEvent={text:"L{pasteEvent}",localeClass:t,icon:"b-icon b-icon-paste",disabled:i.resourceStore.count===0||r.readOnly,weight:110,onItem:({date:n,resourceRecord:s})=>t.pasteEvents(n,s,i.getRowFor(s))})}generateNewName(e){const r=e[this.nameField];let t=2;for(;this.client.eventStore.findRecord(this.nameField,`${r} - ${t}`);)t++;return`${r} - ${t}`}};R(yn,"$name","EventCopyPaste"),R(yn,"pluginConfig",{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}),R(yn,"configurable",{nameField:"name",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},copyPasteAction:"clone"}),yn.featureClass="b-event-copypaste",yn._$name="EventCopyPaste",z.registerFeature(yn,!0,"Scheduler");var Ho=class extends _g{static get $name(){return"EventDrag"}static get configurable(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:(e,r)=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,copyKey:"SHIFT",copyMode:"auto",mode:"move",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changeMode(e){const{dragData:r,copyMode:t}=this;if((t==="event"||t==="auto"||t==="assignment"&&!this.scheduler.eventStore.usesSingleAssignment)&&(!r||r.eventRecords.every(i=>!i.isRecurring)))return e}updateMode(e){this.dragData&&(e==="copy"?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:e}))}setCopying(){const{dragData:e}=this;e&&(e.eventBarCopies.some(r=>r.isConnected)?e.eventBarCopies.forEach(r=>{r.classList.remove("b-hidden")}):e.eventBarCopies.forEach(r=>{r.classList.add("b-drag-proxy-copy"),r.classList.remove("b-hidden"),e.context.grabbedParent.appendChild(r),r.retainElement=!0}))}setMoving(){const{dragData:e}=this;e&&e.eventBarCopies.forEach(r=>{r.classList.add("b-hidden")})}get scheduler(){return this.client}onAfterDragStart(e){const r=this,{context:{element:t}}=e;super.onAfterDragStart(e),r.handleKeyDownOrMove(e.event),r.keyEventDetacher=j.on({element:C.getRootElement(t),keydown:r.handleKeyDownOrMove,keyup:r.handleKeyUp,thisObj:r})}onDragReset(e){var r;super.onDragReset(e),(r=this.keyEventDetacher)==null||r.call(this),this.mode="move"}onDrop(e){var r;return(r=this.dragData.eventBarCopies)==null||r.forEach(t=>t.remove()),super.onDrop(e)}getDraggableElement(e){return e==null?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,r=this.client){return r.resolveEventRecord(e)}isElementDraggable(e,r){var t;const i=this,{client:n}=i,s=i.getDraggableElement(e);if(!s||i.disabled||n.readOnly||e.matches('[class$="-handle"]'))return!1;const a=i.resolveEventRecord(s,n);return!a||!a.isDraggable||a.readOnly?!1:!(((t=n[`is${i.capitalizedEventName}ElementDraggable`])==null?void 0:t.call(n,s,a,e,r))===!1)}getTriggerParams(e){const{assignmentRecords:r,eventRecords:t,resourceRecord:i,browserEvent:n}=e;return{context:e,eventRecords:t,resourceRecord:i,assignmentRecords:r,event:n,domEvent:n}}triggerBeforeEventDrag(e,r){return this.client.trigger(e,r)}triggerEventDrag(e,r){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,r){const t=this;if(t.currentOverClient.trigger("afterEventDrop",Object.assign(t.getTriggerParams(e),{valid:r})),!r){const{assignmentStore:i,eventStore:n}=t.client;t.dragData.initialAssignmentsState.find(({resource:a,assignment:o},l)=>{var c;return!i.includes(o)||!n.includes(o.event)||a.id!==((c=t.dragData.assignmentRecords[l])==null?void 0:c.resourceId)})&&t.client.refresh()}t.client.setTimeout(()=>t.client.navigator.skipNextClick=!1,10)}handleKeyDownOrMove(e){this.mode!=="copy"&&(e.key&&j.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()||e[`${this.copyKey.toLowerCase()}Key`])&&(this.mode="copy")}handleKeyUp(e){j.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()&&(this.mode="move")}isValidDrop(e){const{newResource:r,resourceRecord:t}=e,i=e.draggedEntities[0];return r?r.isSpecialRow||r.readOnly?!1:t!==r?!i.event.resources.includes(r):!0:!this.constrainDragToTimeline&&this.externalDropTargetSelector?!!e.browserEvent.target.closest(this.externalDropTargetSelector):!1}checkDragValidity(e,r){var t,i,n;const s=this,a=s.currentOverClient;let o;return(t=e.newResource)!=null&&t.readOnly?!1:(!a.allowOverlap&&!a.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?o={valid:!1,message:s.L("L{eventOverlapsExisting}")}:o=s.validatorFn.call(s.validatorFnThisObj||s,e,r),(!o||o.valid)&&(o=(n=(i=a.checkEventDragValidity)==null?void 0:i.call(a,e,r))!=null?n:o),o)}async updateRecords(e){const r=this,t=r.client,i=r.currentOverClient,n=r.mode==="copy",{draggedEntities:s,timeDiff:a,initialAssignmentsState:o}=e,l=o[0].startDate,c=r.adjustStartDate(l,a);let d;return e.externalDropTarget||(i.timeAxis.timeSpanInAxis(c,b.add(c,s[0].event.durationMS,"ms"))||(e.valid=!1),e.valid&&(t.eventStore.suspendAutoCommit(),i.eventStore.suspendAutoCommit(),d=await r.updateAssignments(t,i,e,n),t.eventStore.resumeAutoCommit(),i.eventStore.resumeAutoCommit())),e.valid&&i.trigger("eventDrop",Object.assign(r.getTriggerParams(e),{isCopy:n,copyMode:r.copyMode,domEvent:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),d}async updateAssignments(e,r,t,i){const n=this,{copyMode:s}=n,a=e!==r,{isVertical:o}=r,{assignmentStore:l,eventStore:c}=e,{assignmentStore:d,eventStore:u}=r,h=e.isVertical?e.resourceStore:e.store,f=o?r.resourceStore:r.store,{eventRecords:g,assignmentRecords:m,timeDiff:p,initialAssignmentsState:v,resourceRecord:y,newResource:S}=t,{unifiedDrag:D}=n,w=u.usesSingleAssignment||u.usesSingleAssignment!==!1&&c.usesSingleAssignment,E=s==="event"?"event":s==="assignment"?"assignment":w?"event":"assignment",x=n.adjustStartDate(m[0].event.startDate,p),M=[],I=[],P=[],_=[],A=[],V=new Set,N=h.getAllDataRecords();e.suspendRefresh(),r.suspendRefresh();let B=!1,Z=!1,K;a?K=f.indexOf(S)-h.indexOf(y):n.constainDragToResource?K=0:o&&f.isGrouped?K=N.indexOf(y)-N.indexOf(S):K=h.indexOf(y)-h.indexOf(S),o&&g.forEach((le,Xe)=>{const ie=t.eventBarEls[Xe];delete le.instanceMeta(e).hasTemporaryDragElement,ie.dataset.transient&&ie.remove()});const se=t.eventBarEls.slice(),xe=[],gr={};for(let le=0;le<m.length;le++){const Xe=m[le];let ie=Xe.event,ce;if(i?(ce=Xe.copy(),gr[Xe.id]=ce):ce=Xe,!ce.isOccurrenceAssignment&&(!l.includes(Xe)||!c.includes(ie))){se[le].remove(),se.splice(le,1),m.splice(le,1),le--;continue}const _i=v[le],gt=ie,wa=_i.startDate,_r=_i.resource,_v=this.constrainDragToTimeSlot?wa:D?x:n.adjustStartDate(wa,p);if(l!==d){const Rt=gt.assignments.length>1||i;let lt;i?lt=ce:(lt=ce.copy(),gr[ce.id]=lt),lt.event&&!w&&(lt.event=lt.event.id,lt.resource=lt.resource.id),i||_.push(ce),Rt||I.push(gt),(i&&(s==="event"||s==="auto"&&u.usesSingleAssignment)||!u.getById(gt.id))&&(ie=u.createRecord({...gt.data,id:i&&(s==="event"||s==="auto")?void 0:gt.id,calendar:null}),lt.set({eventId:ie.id,event:ie}),M.push(ie)),w||P.push(lt),ce=lt}let Be=S,Fv=null;if(!D)if(a){if(le>0){const Rt=h.indexOf(_r);Be=f.getAt(Rt+K)||Be}}else if(K!==0){let Rt;o&&f.isGrouped?(Rt=Math.max(Math.min(N.indexOf(_r)-K,N.length-1),0),Be=N[Rt]):(Rt=Math.max(Math.min(h.indexOf(_r)-K,h.count-1),0),Be=h.getAt(Rt),Be.isSpecialRow&&(Be=h.getNext(Be,!1,!0)||h.getPrevious(Be,!1,!0))),Be=Be==null?void 0:Be.$original}else Be=_r;const kv=ce.resourceId!==Be.id;if(kv){if(Fv=h.getById(ce.resourceId),i&&l===d){ce.setData({resource:null,resourceId:null}),ce.resource=Be,ce.event=u.getById(ce.eventId);const Rt=s==="event"||c.usesSingleAssignment&&s==="auto";Rt&&(ie=ie.copy(),ie.meta.endDateCached=n.adjustStartDate(ie.endDate,p),ie.endDate=null,ce.event=ie,u.usesSingleAssignment&&(ie.resource=Be,ie.resourceId=Be.id)),!d.find(lt=>lt.eventId===ce.eventId&&lt.resourceId===ce.resourceId)&&!P.find(lt=>lt.eventId===ce.eventId&&lt.resourceId===ce.resourceId)&&(Rt&&M.push(ie),P.push(ce))}else ce.resource=Be;ie.isEvent&&V.add(ie),B=!0,ie.isOccurrence&&ie.set("newResource",Be),a&&w&&(ie.resourceId=Be.id)}else i&&(s==="event"||s==="auto"&&c.usesSingleAssignment)&&!M.includes(ie)&&(ie=ie.copy(),ie.meta.endDateCached=n.adjustStartDate(ie.endDate,p),ie.endDate=null,M.push(ie),ce.event=ie,u.usesSingleAssignment&&ie.set({resource:Be,resourceId:Be.id}),P.push(ce));if(!A.find(Rt=>Rt.draggedEvent===ie)&&!b.isEqual(ie.startDate,_v)){for(;!ie.isOccurrence&&ie.isBatchUpdating;)ie.endBatch(!0);i&&!a&&!w&&E==="assignment"&&kv||(ie.startDate=_v,A.push({draggedEvent:ie,originalStartDate:wa})),ie.isEvent&&V.add(ie),Z=!0}r.processEventDrop({eventRecord:ie,resourceRecord:Be,element:le===0?t.context.element:t.context.relatedElements[le-1],context:t,toScheduler:r,reassignedFrom:Fv,eventsToAdd:M,addedEvents:xe,draggedAssignment:ce}),r.trigger("processEventDrop",{originalAssignment:Xe,draggedAssignment:ce,context:t,copyMode:s,isCopy:i})}if(l.remove(_),c.remove(I),d.add(P),i&&l===d){const{syncIdMap:le}=e.foregroundCanvas;Object.entries(gr).forEach(([Xe,ie])=>{const ce=le[Xe];delete le[Xe],le[ie.id]=ce})}if(M.length&&xe.push(...u.add(M)),!n.constrainDragToTimeline)for(let le=0;le<m.length;le++){const Xe=gr[m[le].id]||m[le],ie=Xe.event,ce=(xe==null?void 0:xe.find(_r=>_r.id===ie.id))||ie,_i=t.eventBarEls[le],gt=le===0?t.context.element:t.context.relatedElements[le-1],wa=r.isInTimeAxis(ce);if(delete ce.meta.endDateCached,i||q.removeChild(_i.parentElement,_i),ce.resource&&(o||r.rowManager.getRowFor(ce.resource))&&wa){if(!ce.parent||ce.parent.isRoot){const _r=k.from(gt,r.foregroundCanvas,!0);C.setTopLeft(gt,_r.y,_r.x),q.addChild(r.foregroundCanvas,gt,ce.assignments[0].id),a&&r.processCrossSchedulerEventDrop({eventRecord:ce,toScheduler:r})}gt.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),gt.retainElement=!1}}xe==null||xe.forEach(le=>V.add(le)),(_.length||I.length||P.length||M.length)&&(B=!0),(B||Z)&&(w&&V.forEach(le=>le.beginBatch()),await Promise.all([r.project!==e.project?r.project.commitAsync():null,e.project.commitAsync()]),w&&V.forEach(le=>le.endBatch(!1,!0))),B||(B=A.some(({draggedEvent:le,originalStartDate:Xe})=>!b.isEqual(le.startDate,Xe))),r.resumeRefresh(),e.resumeRefresh(),m.length>0&&(B?(se.forEach(le=>delete le.lastDomConfig),r.refreshWithTransition(),a&&(e.refreshWithTransition(),r.selectedEvents=xe)):t.valid=!1)}getProductDragContext(e){const r=this,{currentOverClient:t}=r,i=e.browserEvent.target,n=e.newResource||e.resourceRecord,s=e.targetEventRecord;let a=t?r.resolveEventRecord(i,t):null,o,l;e.eventRecords.includes(a)&&(a=null),r.constrainDragToResource?o=e.resourceRecord:r.constrainDragToTimeline?t&&(o=r.resolveResource()||e.newResource||e.resourceRecord):o=r.resolveResource();const{assignmentRecords:c,eventRecords:d}=e,u=n!==o;let h=!!(o&&!o.isSpecialRow);return!o&&r.externalDropTargetSelector&&(l=i.closest(r.externalDropTargetSelector),h=!!l),{valid:h,externalDropTarget:l,eventRecords:d,assignmentRecords:c,newResource:o,targetEventRecord:a,dirty:u||a!==s,proxyElements:[e.context.element,...e.context.relatedElements||[]]}}getMinimalDragData(e){const r=this,{scheduler:t}=r,i=r.getElementFromContext(e),n=r.resolveEventRecord(i,t),s=t.resolveResourceRecord(i),a=t.resolveAssignmentRecord(i),o=a?[a]:[];a&&(t.isAssignmentSelected(o[0])||r.drag.startEvent.ctrlKey&&t.multiEventSelect)&&o.push.apply(o,r.getRelatedRecords(a));const l=[...new Set(o.map(c=>c.event))];return{eventRecord:n,resourceRecord:s,assignmentRecord:a,eventRecords:l,assignmentRecords:o}}setupProductDragData(e){var r;const t=this,{scheduler:i}=t,n=t.getElementFromContext(e),{eventRecord:s,resourceRecord:a,assignmentRecord:o,assignmentRecords:l}=t.getMinimalDragData(e),c=[];if(t.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);let d;if(t.constrainDragToTimeline){d=(r=t.getDateConstraints)==null?void 0:r.call(t,a,s);const u=t.constrainRectangle=t.getConstrainingRectangle(d,a,s),h=k.from(n,i.timeAxisSubGridElement);super.setupConstraints(u,h,i.timeAxisViewModel.snapPixelAmount,!!d.start)}return l.forEach(u=>{let h=i.getElementFromAssignmentRecord(u,!0);h||(h=i.currentOrientation.addTemporaryDragElement(u.event,u.resource)),c.push(h)}),{record:o,draggedEntities:l,dateConstraints:d!=null&&d.start?d:null,eventBarCopies:c.map(u=>t.createProxy(u)),eventBarEls:c}}getDateConstraints(e,r){var t;const{scheduler:i}=this,n=(t=i.getDateConstraints)==null?void 0:t.call(i,e,r);let s,a;return this.constrainDragToTimeSlot?(s=r.startDate,a=r.endDate):n&&(s=n.start,a=n.end),{start:s,end:a}}getConstrainingRectangle(e,r,t){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&r,t,!0,e&&{start:e.start,end:e.end})}getDragData(e){const r=this.getMinimalDragData(e)||{};return{...super.getDragData(e),...r,initialAssignmentsState:r.assignmentRecords.map(t=>({startDate:t.event.startDate,resource:t.resource,assignment:t}))}}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter(r=>r!==e&&!r.resource.readOnly&&r.event.isDraggable)}getCoordinate(e,r,t){const i=this.currentOverClient;if(i.isHorizontal){let n=t[0];if(i.milestoneLayoutMode!=="default"&&e.isMilestone)switch(i.milestoneAlign){case"center":n+=r.offsetWidth/2;break;case"end":n+=r.offsetWidth;break}return n}else{let n=t[1];if(i.milestoneLayoutMode!=="default"&&e.isMilestone)switch(i.milestoneAlign){case"center":n+=r.offsetHeight/2;break;case"end":n+=r.offsetHeight;break}return n}}resolveResource(){const e=this,r=e.currentOverClient,{isHorizontal:t}=r,{context:i,browserEvent:n,dragProxy:s}=e.dragData,a=s||i.element,o=k.from(a,null,!0),l=r.isVertical||e.unifiedDrag?i.clientY:o.center.y,c=k.from(a,r.timeAxisSubGridElement,!0),{x:d,y:u}=c.center,h=e.getMouseMoveEventTarget(n);let f=null;if(r.element.contains(h))if(t){const g=r.rowManager.getRowAt(l);f=g&&r.store.getAt(g.dataIndex)}else f=r.resolveResourceRecord(r.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[d,u]);return f}adjustStartDate(e,r){const t=this.currentOverClient;return e=t.timeAxis.roundDate(new Date(e-0+r),t.snapRelativeToEventStartDate?e:!1),this.constrainStartDate(e)}getRecordElement(e){return this.client.getElementFromAssignmentRecord(e,!0)}getProxyElement(e){if(this.isDragging){const r=this.dragData.assignmentRecords.indexOf(e);if(r>=0)return this.dragData.proxyElements[r]}return null}getMouseMoveEventTarget(e){return e.target}};Ho._$name="EventDrag",z.registerFeature(Ho,!0,"Scheduler"),z.registerFeature(Ho,!1,"ResourceHistogram");var Vs=class extends Bo{get scheduler(){return this.client}get store(){return this.client.eventStore}get project(){return this.client.project}updateLockLayout(e){this.dragActiveCls=`b-dragcreating${e?" b-dragcreate-lock":""}`}handleBeforeDragCreate(e,r,t){var i;const{resourceRecord:n}=e;if(n.readOnly||!this.scheduler.resourceStore.isAvailable(n))return!1;const{scheduler:s}=this,a=!s.isSchedulerPro||r.ignoreResourceCalendar||n.isWorkingTime(e.mousedownDate),o=a&&s.trigger("beforeDragCreate",{resourceRecord:n,date:e.mousedownDate,event:t});return this.dateConstraints=(i=s.getDateConstraints)==null?void 0:i.call(s,n,r),o}dragStart(e){var r;const t=this,{client:i}=t,{eventStore:n,assignmentStore:s,enableEventAnimations:a}=i,{resourceRecord:o}=e,l=t.createEventRecord(e),c=[o];if(l.set("duration",b.diff(l.startDate,l.endDate,l.durationUnit,!0)),l.isCreating=!0,l.meta.isDragCreating=!0,i.features.taskEdit&&i.features.taskEdit.doCancel(),t.handleBeforeDragCreate(e,l,e.event)===!1)return!1;t.captureStm(!0);let d=[];return o&&(d=s.assignEventToResource(l,o)),i.trigger("beforeEventAdd",{eventRecord:l,resourceRecords:c,assignmentRecords:d})===!1?(s.remove(d),!1):(t.lockLayout&&(l.meta.excludeFromLayout=!0),(r=i.onEventCreated)==null||r.call(i,l),i.enableEventAnimations=!1,n.addAsync(l).then(()=>i.enableEventAnimations=a),i.isCreating=!0,i.refreshRows(),i.isCreating=!1,e.itemElement=e.element=i.getElementFromEventRecord(l),C.isInView(e.itemElement)||i.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:i.barMargin}),super.dragStart(e))}checkValidity(e,r){const t=this,{client:i}=t;return e.resourceRecord=t.dragging.resourceRecord,(i.allowOverlap||i.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&t.createValidatorFn.call(t.validatorFnThisObj||t,e,r)}isRowEmpty(e){const r=this.store.getEventsForResource(e);return!r||!r.length}triggerBeforeFinalize(e){this.client.trigger("beforeDragCreateFinalize",e)}createEventRecord(e){const r=this,{client:t}=r,i=t.isHorizontal?"X":"Y",{timeAxis:n,eventStore:s,weekStartDay:a}=t,{event:o,mousedownDate:l}=e,c=r.draggingEnd=o[`page${i}`]>e.startEvent[`page${i}`],d={name:s.modelClass.fieldMap.name.defaultValue||r.L("L{Object.newEvent}"),startDate:c?b.floor(l,n.resolution,null,a):l,endDate:c?l:b.ceil(l,n.resolution,null,a)};return t.project.isGanttProjectMixin&&T.assign(d,{constraintDate:d.startDate,constraintType:"startnoearlierthan"}),s.createRecord(d)}async internalUpdateRecord(e,r){await super.internalUpdateRecord(e,r),this.client.hasEventEditor||(e.eventRecord.isCreating=!1)}async finalizeDragCreate(e){const{meta:r}=e.eventRecord;r.excludeFromLayout=!1,r.isDragCreating=!1;const t=await super.finalizeDragCreate(e);return t?this.hasStmCapture=!1:this.freeStm(!0),t}async cancelDragCreate(e){await super.cancelDragCreate(e),this.freeStm(!1)}getTipHtml(...e){const r=super.getTipHtml(...e),{element:t}=this.tip;return t.classList.add("b-sch-dragcreate-tooltip"),t.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),r}onAborted(e){var r,t;const{eventRecord:i,resourceRecord:n}=e;(t=(r=this.store).unassignEventFromResource)==null||t.call(r,i,n),this.store.remove(i)}};R(Vs,"$name","EventDragCreate"),R(Vs,"configurable",{validatorFn:()=>!0,lockLayout:!1}),Vs._$name="EventDragCreate",z.registerFeature(Vs,!0,"Scheduler"),z.registerFeature(Vs,!1,"ResourceHistogram");var Vo=class extends ge(X){constructor(){super(...arguments),R(this,"targetSelector",".b-sch-timeaxis-cell, .b-timeaxissubgrid")}construct(e,r){e.multiEventSelect=!0,super.construct(e,r)}onElementMouseDown(e){const r=this,{client:t}=r,{foregroundCanvas:i}=t,{target:n,button:s,touches:a,clientX:o,clientY:l}=e,c=k.from(i,!0);a||s!==0||r.disabled||!n.matches(r.targetSelector)||t.trigger("beforeEventDragSelect",{event:e})===!1||(t.preventDragSelect=!0,r.startX=o-c.x,r.startY=l-c.y,r.element=C.createElement({tag:"div",className:"b-dragselect-rect",parent:t.foregroundCanvas,retainElement:!0,style:{transform:`translate(${r.startX}px, ${r.startY}px)`}}),t.element.classList.add("b-dragselecting"),!e.ctrlKey&&!e.metaKey&&t.clearEventSelection(),r.originalSelection=t.selectedAssignments.slice(),r.subGridElementRect=k.from(t.timeAxisSubGridElement,!0),t.navigator.disabled=!0,t.enableScrollingCloseToEdges(t.timeAxisSubGrid),r.mouseUpDetacher=j.on({element:document,mouseup:"onDocumentMouseUp",thisObj:r}))}get eventRectangles(){const{client:e}=this;return Array.from(e.foregroundCanvas.children).filter(t=>t.matches(`${e.eventSelector}, .b-nested-events-container`)).map(t=>{const i=e.resolveAssignmentRecord(t);return{rectangle:k.from(t,!0),record:i,selected:e.selectedAssignments.includes(i)}})}onElementMouseMove(e){const r=this;if(typeof r.startX=="number"){const t=r.rectangle=k.from(r.client.foregroundCanvas,!0),i=Math.min(Math.max(e.clientX-t.x,0),t.width+1),n=Math.min(Math.max(e.clientY-t.y,0),t.height+1),s=new k(r.startX,r.startY,i-r.startX,n-r.startY);C.setTranslateXY(r.element,s.x,s.y),r.element.style.width=`${s.width}px`,r.element.style.height=`${s.height}px`,r.updateSelection()}}onDocumentMouseUp(e){var r,t;const i=this,{client:n}=i,{selectedAssignments:s,navigator:a}=n;n.disableScrollingCloseToEdges(n.timeAxisSubGrid),(r=i.element)==null||r.remove(),n.element.classList.remove("b-dragselecting"),i.startX=i.startY=null,a.skipNextClick=n.timeAxisSubGridElement.contains(e.target),a.disabled=!1,s.length&&(a.skipScrollIntoView=!0,n.activeAssignment=s[s.length-1],(t=a.activeItem)==null||t.focus(),a.skipScrollIntoView=!1),i.mouseUpDetacher()}updateSelection(){const e=this,r=e.rectangle=k.from(e.element,!0),{eventRectangles:t,client:i}=e,n=i.selectedAssignments.reduce((s,a)=>(i.getElementFromAssignmentRecord(a)||s.push(a),s),[]);for(const s of t)r.intersect(s.rectangle,!0)&&(s.selected=!0,n.push(s.record));n.push(...e.originalSelection),i.selectedAssignments=n}};R(Vo,"$name","EventDragSelect"),R(Vo,"pluginConfig",{chain:["onElementMouseDown","onElementMouseMove"]}),Vo._$name="EventDragSelect",z.registerFeature(Vo,!1,"Scheduler");var jg=class extends st{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain(e=>!e.isSpecialRow,null,{storeClass:ee,excludeCollapsedRecords:!1})}processWidgetConfig(e){var r;if((r=e.type)!=null&&r.includes("date")&&e.weekStartDay==null&&(e.weekStartDay=this.weekStartDay),e.type==="extraItems")return!1;const{eventEditFeature:t}=this,i={};if(e.ref==="resourceField"){const{store:n}=e;e.store=this.chainResourceStore(),n&&e.store.setConfig(n),"multiSelect"in e||(e.multiSelect=!t.eventStore.usesSingleAssignment)}return(e.name==="startDate"||e.name==="endDate")&&e.type==="date"&&(i.format=t.dateFormat),(e.name==="startDate"||e.name==="endDate")&&e.type==="time"&&(i.format=t.timeFormat),Object.assign(e,i),super.processWidgetConfig(e)}onBeforeShow(...e){var r;const t=this,{record:i,titleRenderer:n}=t,{deleteButton:s}=t.widgetMap;s&&(s.hidden=t.readOnly||i.isCreating),n?t.title=t.callback(n,t,[i]):t.title=t.initialTitle,(r=super.onBeforeShow)==null||r.call(this,...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:r,saveButton:t,cancelButton:i}=this.widgetMap;super.updateReadOnly(e),r&&(r.hidden=e),t&&(t.hidden=e),i&&(i.hidden=e)}};jg.initClass(),jg._$name="EventEditor";var Bg=class extends st{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const r=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach(t=>{t in e&&(r[t]=e[t])}),r.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:r,changeSingleButton:t,cancelButton:i}=e.widgetMap,{eventRecord:n,actionType:s="update"}=e;(n==null?void 0:n.isRecurring)?(r.text=e.L("L{Object.Yes}"),e.html=e.L(`${s}-all-message`)):(r.text=e.L(`${s}-further-btn-text`),e.html=e.L(`${s}-further-message`)),t.text=e.L(`${s}-only-this-btn-text`),i.text=e.L("L{Object.Cancel}"),e.width=e.L("L{width}"),e.title=e.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:r,thisObj:t,finalizerFn:i}=this;e.beginBatch(),r&&this.callback(r,t,[e]),e.endBatch(),i&&this.callback(i,t,[e])}processSingleRecord(){const{eventRecord:e,changerFn:r,thisObj:t,finalizerFn:i}=this;e.beginBatch();let n;e!=null&&e.isRecurring&&e.recurrence.forEachOccurrence(e.startDate,null,(s,a,o)=>{if(o>1)return n=s,!1}),n==null||n.convertToRealEvent(),e.recurrence=null,r&&this.callback(r,t,[e]),e.recurrenceRule=null,e.endBatch(),i&&this.callback(i,t,[e])}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}};Bg.initClass(),Bg._$name="RecurrenceConfirmationPopup";var bn=class extends qe{buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}};R(bn,"$name","RecurrenceFrequencyCombo"),R(bn,"type","recurrencefrequencycombo"),R(bn,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1}),bn.initClass(),bn._$name="RecurrenceFrequencyCombo";var Hg=class extends bn{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){const e=this;return[{value:"none",text:"L{None}"},...super.buildItems(),{value:e.customValue,text:"L{Custom}",cls:e.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const r=this;e?r.value=r.isCustomRecurrence(e)?r.customValue:e.frequency:r.value=null}isCustomRecurrence(e){const{interval:r,days:t,monthDays:i,months:n}=e;return!!(r>1||t&&t.length||i&&i.length||n&&n.length)}};Hg.initClass(),Hg._$name="RecurrenceCombo";var Vg=class extends Ya{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?Pg.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}};Vg.initClass(),Vg._$name="RecurrenceLegendButton";var Ng=class extends qe{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],r=e.join(",");return{allDaysValue:r,editable:!1,defaultValue:r,workingDaysValue:e.filter((t,i)=>!b.nonWorkingDays[i]).join(","),nonWorkingDaysValue:e.filter((t,i)=>b.nonWorkingDays[i]).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const r=b.weekStartDay,t=b.getDayNames().map((i,n)=>({text:i,value:kt.encodeDay(n)}));e._weekDays=t.slice(r).concat(t.slice(0,r))}return e._weekDays}set value(e){const r=this;e&&Array.isArray(e)&&(e=e.join(",")),(!e||!r.store.findRecord("value",e))&&(e=r.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}};Ng.initClass(),Ng._$name="RecurrenceDaysCombo";var zg=class extends Vr{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){const r=this;e.columns=7,e.items=r.buildItems(),super.construct(e)}updateItemText(e){const r=kt.decodeDay(e.value)[0];e.text=b.getDayName(r).substring(0,3)}buildItems(){const e=this;if(!e.__items){const r=b.weekStartDay,t=b.getDayNames().map((i,n)=>({text:i.substring(0,3),value:kt.encodeDay(n)}));e.__items=t.slice(r).concat(t.slice(0,r))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};zg.initClass(),zg._$name="RecurrenceDaysButtonGroup";var Wg=class extends Vr{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){const r=this;e.columns=7,e.items=r.buildItems(),super.construct(e)}buildItems(){const e=this,r=[];for(let t=e.minValue;t<=e.maxValue;t++)r.push({text:t+"",value:t});return r}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};Wg.initClass(),Wg._$name="RecurrenceMonthDaysButtonGroup";var Ug=class extends Vr{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){const r=this;e.columns=4,e.items=r.buildItems(),super.construct(e)}buildItems(){return b.getMonthNames().map((e,r)=>({text:e.substring(0,3),value:r+1}))}updateItemText(e){e.text=b.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};Ug.initClass(),Ug._$name="RecurrenceMonthsButtonGroup";var Gg=class extends qe{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let r=null;e.endDate?r="date":e.count&&(r="count"),this._recurrence=e,this.value=r}};Gg.initClass(),Gg._$name="RecurrenceStopConditionCombo";var Yg=class extends qe{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])}buildDayNumbers(){return H.populate(this.maxPosition,e=>({value:e+1,text:this.L(`position${e+1}`)}))}set value(e){const r=this;e&&Array.isArray(e)&&(e=e.join(",")),(!e||!r.store.findRecord("value",e))&&(e=r.defaultValue),super.value=e}get value(){const e=super.value;return e?`${e}`.split(",").map(r=>parseInt(r,10)):[]}};Yg.initClass(),Yg._$name="RecurrencePositionsCombo";var Ns=class extends Nt{updateRecord(e){super.updateRecord(e);const r=this,{frequencyField:t,daysButtonField:i,monthDaysButtonField:n,monthsButtonField:s,monthDaysRadioField:a,positionAndDayRadioField:o,stopRecurrenceField:l}=r.widgetMap;if(e){const c=e.timeSpan,d=c==null?void 0:c.startDate;d&&((!e.days||!e.days.length)&&(i.value=[kt.encodeDay(d.getDay())]),(!e.monthDays||!e.monthDays.length)&&(n.value=d.getDate()),(!e.months||!e.months.length)&&(s.value=d.getMonth()+1)),e.days&&e.positions?(o.check(),r.isPainted||a.uncheck()):(a.check(),r.isPainted||o.uncheck()),l.recurrence=e}else t.value="NONE"}syncEventRecord(e){const r=this.getValues(t=>t.name in e&&!t.disabled);"endDate"in r||(r.endDate=null),"count"in r||(r.count=null),e.set(r)}toggleStopFields(){const e=this,{countField:r,endDateField:t}=e.widgetMap;switch(e.widgetMap.stopRecurrenceField.value){case"count":r.show(),r.enable(),t.hide(),t.disable();break;case"date":r.hide(),r.disable(),t.show(),t.enable();break;default:r.hide(),t.hide(),r.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:r}=this.widgetMap;r.disabled=!e||!this.isWidgetAvailableForFrequency(r)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:r,positionsCombo:t}=this.widgetMap;r.disabled=t.disabled=!e||!this.isWidgetAvailableForFrequency(r)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,r=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.includes(r)}onFrequencyFieldChange({value:e,oldValue:r,valid:t}){const i=this,n=i.queryAll(o=>"forFrequency"in o),{intervalField:s,stopRecurrenceField:a}=i.widgetMap;if(t&&e){for(let o=0;o<n.length;o++){const l=n[o];i.isWidgetAvailableForFrequency(l,e)?(l.show(),l.enable()):(l.hide(),l.disable())}s.hidden=a.hidden=e==="NONE",e!=="NONE"&&(s.hint=i.L(`L{RecurrenceEditor.${e}intervalUnit}`)),r==="NONE"&&s.value==null&&(s.value=1),i.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:r}=e;e.onMonthDaysRadioFieldChange({checked:r.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:r.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:r,frequencyField:t}=this.widgetMap;e.hint=this.L("L{RecurrenceEditor.time(s)}"),t.value&&t.value!=="NONE"&&(r.hint=this.L(`L{RecurrenceEditor.${t.value}intervalUnit}`)),super.updateLocalization()}};R(Ns,"$name","RecurrenceEditorPanel"),R(Ns,"type","recurrenceeditorpanel"),R(Ns,"configurable",{cls:"b-recurrenceeditor",record:!1,addNone:!1,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}}}),Ns.initClass(),Ns._$name="RecurrenceEditorPanel";var qg=class extends st{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}},scrollable:{overflowY:!0}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}get recurrenceEditorPanel(){return this.widgetMap.recurrenceEditorPanel}updateRecord(e){this.recurrenceEditorPanel.record=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.recurrenceEditorPanel.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}};qg.initClass(),qg._$name="RecurrenceEditor";var Hw=e=>class extends(e||F){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},showRecurringUI:null}}changeEditorConfig(t){return t.items={...t.items,...this.recurringEventsItems},t=super.changeEditorConfig(t),t}construct(t,i){super.construct(t,i),this.scheduler.ion({beforeEventSave:"onRecurrableEventBeforeSave",thisObj:this})}doDestroy(){var t,i;(t=this._recurrenceConfirmation)==null||t.destroy(),(i=this._recurrenceEditor)==null||i.destroy(),super.doDestroy()}onEditorConstructed(t){var i;const n=this;t.ion({hide:n.onRecurringEventEditorHide,thisObj:n}),n.editRecurrenceButton&&(n.editRecurrenceButton.menu=n.recurrenceEditor),(i=n.recurrenceCombo)==null||i.ion({change:n.onRecurrenceComboChange,thisObj:n})}updateReadOnly(t){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=t)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&this.showRecurringUI!==!1)}toggleRecurringFieldsVisibility(t=!0){var i,n,s,a;const o=t?"show":"hide";(n=(i=this.editRecurrenceButton)==null?void 0:i[o])==null||n.call(i),(a=(s=this.recurrenceCombo)==null?void 0:s[o])==null||a.call(s)}onRecurringEventEditorHide(){var t,i;(t=this.recurrenceEditor)!=null&&t.isVisible&&this.recurrenceEditor.hide(),(i=this.recurrenceConfirmation)!=null&&i.isVisible&&this.recurrenceConfirmation.hide()}makeRecurrence(t){const i=this.eventRecord,n=i.copy();let s=i.recurrence;return!t&&s?s=s.copy():s=new i.recurrenceModel(t?{rule:t}:{}),s.timeSpan=n,n.setStartDate(this.values.startDate),s.suspendTimeSpanNotifying(),s}onRecurrableEventBeforeSave({eventRecord:t,context:i}){const n=this;n.isEditing&&!t.isCreating&&t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(n.recurrenceConfirmation.confirm({actionType:"update",eventRecord:t,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}),i.async=!0)}set recurrenceConfirmation(t){this._recurrenceConfirmation=t}get recurrenceConfirmation(){const t=this;let i=t._recurrenceConfirmation;return(!i||!i.$$name)&&(i=$.create({type:"recurrenceconfirmation",owner:t.editor,...i}),t._recurrenceConfirmation=i),i}set recurrenceEditor(t){this._recurrenceEditor=t}get recurrenceEditor(){const t=this;let i=t._recurrenceEditor;return(!i||!i.$$name)&&(t._recurrenceEditor=i=$.create({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,constrainTo:globalThis,anchor:!1,rootElement:t.rootElement,saveHandler:t.recurrenceEditorSaveHandler,onBeforeShow:t.onBeforeShowRecurrenceEditor.bind(t),thisObj:t,...i}),i.readOnly=t._readOnly),i}onBeforeShowRecurrenceEditor(){const t=this,{recurrenceEditor:i,eventRecord:n}=t;i&&(n!=null&&n.supportsRecurring)&&(t.recurrence||(t.recurrence=t.makeRecurrence()),t.recurrence.timeSpan.setStartDate(t.values.startDate),i.record=t.recurrence,i.centered=!0)}loadRecurrenceData(t){this.recurrence=t,this.updateRecurrenceFields(t)}updateRecurrenceFields(t){const i=this,{editRecurrenceButton:n}=i;i.recurrenceCombo&&(i.recurrenceCombo.recurrence=t),n&&(n.recurrence=t,n.value=t?t.rule:null,t&&i.client.enableRecurringEvents&&i.showRecurringUI!==!1?n.show():n.hide())}onRecurrenceComboChange({source:t,value:i,userAction:n}){if(n){const s=this,{recurrenceEditor:a}=s;i===t.customValue?(s.recurrenceCombo.recurrence=s.makeRecurrence(),a.centered?a.show():a.show((s.editRecurrenceButton||t).element)):s.loadRecurrenceData(i&&i!=="none"?s.makeRecurrence(`FREQ=${i}`):null)}}recurrenceEditorSaveHandler(t,i){t.recurrenceEditorPanel.syncEventRecord(i),this.updateRecurrenceFields(i),t.close()}onDatesChange(...t){if(super.onDatesChange(...t),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:i}=this.values;i&&(this.editRecurrenceButton.eventStartDate=i)}}internalLoadRecord(t){t!=null&&t.supportsRecurring&&this.loadRecurrenceData(t.recurrence?this.makeRecurrence():null)}updateRecord(t){return t.recurrenceRule&&!this.recurrence&&(t.recurrenceRule=null),super.updateRecord(t)}},Kg=class extends qe{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:!1,displayField:"name",valueField:"id",picker:{cls:"b-resourcecombo-picker",itemIconTpl(e){const{eventColor:r}=e,t=!C.isNamedColor(r),i=r?t?` style="color:${r}"`:"":' style="display:none"';return`<div class="b-icon b-icon-square${!r||t?"":` b-sch-foreground-${r}`}"${i}></div>`}}}}changeShowEventColor(e){return!!e}updateShowEventColor(e){const{_picker:r}=this,t=e?"add":"remove";this.element.classList[t]("b-show-event-color"),r==null||r.element.classList[t]("b-show-event-color")}changePicker(e,r){return e=super.changePicker(e,r),e==null||e.element.classList[this.showEventColor?"add":"remove"]("b-show-event-color"),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e,r;const t=this,{resourceIcon:i,lastResourceIconCls:n}=t,{classList:s}=i,a=(r=(e=t.selected)==null?void 0:e.eventColor)!=null?r:"";super.syncInputFieldValue(),i.style.color="",n&&s.remove(n),t.lastResourceIconCls=null,a?(C.isNamedColor(a)?(t.lastResourceIconCls=`b-sch-foreground-${a}`,s.add(t.lastResourceIconCls)):i.style.color=a,s.remove("b-hide-display")):s.add("b-hide-display")}};Kg.initClass(),Kg._$name="ResourceCombo";var Vw=/[^\w\d]/g,No=class extends kg.mixin(jo,Hw,ge){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",weight:600}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey","editEvent"]}}construct(e,r){this.readOnly=e.readOnly,super.construct(e,r),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get project(){return this.client.project}get readOnly(){return this._editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){super.updateReadOnly(e),this._editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}get editor(){var e,r,t,i,n;const s=this,a={beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s};let{_editor:o}=s;if(o)return o;o=s._editor=$.create(s.getEditorConfig());const{startDateField:l,startTimeField:c,endDateField:d,endTimeField:u}=o.widgetMap;return!l&&c&&(c.keepDate=!0,c.label=s.L("Start"),c.flex="1 0 100%"),!d&&u&&(u.keepDate=!0,u.label=s.L("End"),u.flex="1 0 100%"),!o.floating&&!o.positioned&&(o.element.parentNode||s.client.add(o),delete a.beforehide,delete a.beforShow,a.beforeToggleReveal="onBeforeEditorToggleReveal"),o.readOnly=s._readOnly,o.items.length===0&&console.warn("Event Editor configured without any `items`"),o.ion(a),s.scheduler.relayEvents(o,["beforeSetRecord"],"eventEdit"),Object.values(o.widgetMap).forEach(h=>{const f=h.ref||h.id;if(f&&!s[f])switch(s[f]=h,h.name){case"startDate":case"endDate":h.ion({change:"onDatesChange",thisObj:s});break}}),(e=s.onEditorConstructed)==null||e.call(s,o),(r=s.eventTypeField)==null||r.ion({change:"onEventTypeChange",thisObj:s}),(t=s.saveButton)==null||t.ion({click:"onSaveClick",thisObj:s}),(i=s.deleteButton)==null||i.ion({click:"onDeleteClick",thisObj:s}),(n=s.cancelButton)==null||n.ion({click:"onCancelClick",thisObj:s}),o}getEditorConfig(){const e=this,r=new Date(2e3,12,31,23,55,55),t=b.format(r,e.dateFormat).replace(Vw,"").length,i=b.format(r,e.timeFormat).replace(Vw,"").length,n=t+i,{cls:s,scheduler:a}=e,o=T.assign({owner:a,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${a.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,cls:s},e.editorConfig);return $.prototype.getRenderContext(o)[0]&&(o.floating=!1),o.floating===!1&&!o.positioned&&(o.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},o.collapsed=!0,o.hidden=o.anchor=!1,o.hide=function(){this.collapsible.toggleReveal(!1)}),o.onElementCreated=function({element:l}){l.style.setProperty("--date-time-length",`${n}em`),l.style.setProperty("--date-width-difference",`${(t-i)/2}em`)},o}internalShowEditor(e,r,t=null){var i,n;const s=this,{scheduler:a}=s,o=((i=t==null?void 0:t.target)==null?void 0:i.nodeType)===Element.ELEMENT_NODE?t.target:a.getElementFromEventRecord(e,r),l=e.isPartOfStore(a.eventStore);if(t=t!=null?t:{target:o,anchor:!0},t.target||!l||e.isCreating){if(a.trigger("beforeEventEdit",{eventEdit:s,eventRecord:e,resourceRecord:r,eventElement:o})===!1)return a.element.classList.remove("b-eventeditor-editing"),!1;s.scheduler.element.classList.add("b-eventeditor-editing"),s.resourceRecord=r;const{editor:c}=s;s.editingContext={eventRecord:e,resourceRecord:r,eventElement:o,editor:c,isPartOfStore:l},(n=super.internalShowEditor)==null||n.call(this,e,r,t),s.typeField&&s.toggleEventType(e.get(s.typeField)),s.loadRecord(e,r),c.collapsed?c.setTimeout(async()=>{await c.collapsible.toggleReveal(!0),c.focus()},100):c.centered||!c.anchor||!c.floating?c.show():o?(s.targetEventElement=o,c.showBy(t)):(c.show(),c.updateCentered(!0));const d=a.timeAxisViewModel.timeResolution;if(d.unit==="hour"||d.unit==="minute"){const u=`${d.increment}${d.unit}`;s.startTimeField&&(s.startTimeField.step=u),s.endTimeField&&(s.endTimeField.step=u)}s.detachListeners("changesWhileEditing"),a.eventStore.ion({change:s.onChangeWhileEditing,refresh:s.onChangeWhileEditing,thisObj:s,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;!e.isFinalizingEventSave&&e.isEditing&&e.editingContext.isPartOfStore&&!e.eventRecord.isPartOfStore(e.scheduler.eventStore)&&e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",{eventEdit:this,...this.editingContext})}updateTargetEventElement(e,r){e==null||e.classList.add("b-editing"),r==null||r.classList.remove("b-editing")}editEvent(e,r,t=null,i=null){const n=this,{simpleEventEdit:s}=n.client.features;if(n.isEditing&&n.resetEditingContext(),!(n.disabled||e.readOnly||e.isCreating&&(s!=null&&s.enabled)))return i?(n.stmInitiallyAutoRecord=i.stmInitiallyAutoRecord,n.stmInitiallyDisabled=i.stmInitiallyDisabled,n.hasStmCapture=!0,i.transferred=!0):i!==!1&&!n.client.isCalendar&&!n.hasStmCapture&&n.captureStm(!0),n.doEditEvent(...arguments).then(a=>{n.isDestroying||!n.isEditing&&!n.client.isCalendar&&(a!==!1&&n.rejectStmTransaction(),n.freeStm())})}get isEditing(){const{_editor:e}=this;return!!(e!=null&&e.isVisible&&!(e.collapsed&&!e.revealed))}async doEditEvent(e,r,t=null){const i=this,{scheduler:n}=i,s=e.isCreating;return r||(r=e.resource||i.resourceStore.getById(e.resourceId)),s&&St.prototype.normalize.call(e),t||s?i.internalShowEditor(e,r,t?{target:t}:null):n.scrollResourceEventIntoView(r,e,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then(()=>i.internalShowEditor(e,r),()=>n.element.classList.remove("b-eventeditor-editing"))}loadRecord(e,r){this.loadingRecord=!0,this.internalLoadRecord(e,r),this.loadingRecord=!1}get eventRecord(){var e;return(e=this._editor)==null?void 0:e.record}internalLoadRecord(e,r){var t;const i=this,{eventStore:n}=i.client,{editor:s,resourceField:a}=i;if(i.resourceRecord=r,a&&((t=a.store)==null?void 0:t.masterStore)!==i.resourceStore&&(a.store=s.chainResourceStore()),s.record=e,a){const o=n.assignmentStore.getResourcesForEvent(e);s.assigningValues=!0,!e.isOccurrence&&!n.storage.includes(e,!0)&&r?i.resourceField.value=r[i.resourceField.valueField]:i.assignmentStore&&(i.resourceField.value=o.map(l=>l[i.resourceField.valueField])),s.assigningValues=!1}super.internalLoadRecord(e,r)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget(r=>{var t;(t=r.dataset)!=null&&t.eventType&&(r.hidden=r.dataset.eventType!==e)})}async finalizeEventSave(e,r,t,i){const n=this,{scheduler:s,assignmentStore:a}=n,o=!1;a.suspendAutoCommit(),s.suspendRefresh(),n.onBeforeSave(e),e.beginBatch(),n.updateRecord(e),e.endBatch(),e.isOccurrence?r&&e.set("resourceRecords",r):n.resourceField&&a.assignEventToResource(e,r,null,!0),e.isCreating=!1,o||await s.project.commitAsync(),a.resumeAutoCommit(),s.resumeRefresh(!0),o||(s.trigger("afterEventSave",{eventRecord:e}),n.onAfterSave(e)),t(o?!1:e)}save(){return new Promise((e,r)=>{var t;const i=this,{scheduler:n,eventRecord:s}=i;if(!s||!i.editor.isValid){e(!1);return}const{eventStore:a,values:o}=i,l=((t=i.resourceField)==null?void 0:t.records)||(i.resourceRecord?[i.resourceRecord]:[]);if(!i.scheduler.allowOverlap&&a){let{startDate:d,endDate:u}=o;if(u||("duration"in o?u=b.add(d,o.duration,o.durationUnit||s.durationUnit):"fullDuration"in o?u=b.add(d,o.fullDuration):u=s.endDate),l.some(f=>!a.isDateRangeAvailable(d,u,s,f))){e(!1);return}}const c={finalize(d){try{d!==!1?i.finalizeEventSave(s,l,e,r):e(!1)}catch(u){r(u)}}};if(n.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,values:o,context:c})===!1){e(!1);return}c.async||c.finalize()})}deleteEvent(){return this.detachListeners("changesWhileEditing"),new Promise((e,r)=>{const t=this,{eventRecord:i,editor:n}=t;t.scheduler.removeEvents([i],s=>{s&&n.containsFocus&&n.revertFocus(),e(s)},n)})}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:r,eventElement:t}){this.editEvent(e,r,t)}onDragCreateEnd({eventRecord:e,resourceRecord:r,proxyElement:t,stmCapture:i}){this.editEvent(e,r,t,i)}onEventEnterKey({assignmentRecord:e,eventRecord:r,target:t}){const{client:i}=this,n=t[t.matches(i.eventSelector)?"querySelector":"closest"](i.eventInnerSelector);e?this.editEvent(r,e.resource,n):r&&this.editEvent(r,r.resource,n)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:r,items:t}){!this.scheduler.readOnly&&!this.disabled&&(t.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editEvent(e,r)}})}onBeforeEditorToggleReveal({reveal:e}){this[e?"onBeforeEditorShow":"resetEditingContext"]()}resetEditingContext(){const e=this;e.detachListeners("changesWhileEditing"),super.resetEditingContext(),e.hasStmCapture&&!e.isDeletingEvent&&!e.isCancelingEdit&&e.freeStm(!1),e.resourceRecord=null}async finalizeStmCapture(e){e?await this.rejectStmTransaction():this.commitStmTransaction(),this.freeStm()}};No._$name="EventEdit",z.registerFeature(No,!0,"Scheduler"),z.registerFeature(No,!1,["SchedulerPro","ResourceHistogram"]),No.initClass();var zo=class extends X{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const r=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:r.disabled,localeClass:r,weight:100,menu:{type:"popup",localeClass:r,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:r,width:200,internalListeners:{change:r.onEventFilterChange,thisObj:r}}},onBeforeShow({source:t}){const[i]=t.items,n=r.store.filters.getBy("property","name");i.value=(n==null?void 0:n.value)||""}}}}onEventFilterChange({value:e}){e!==""?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}};zo.featureClass="b-event-filter",zo._$name="EventFilter",z.registerFeature(zo,!0,["Scheduler","Gantt"]),z.registerFeature(zo,!1,"ResourceHistogram");var Wo=class extends Ed{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(e){var r;const t=super.getDataFromEvent(e),i=t.targetElement,{client:n}=this,s=n.resolveEventRecord(i),a=s&&((r=n.resolveResourceRecord(i)||this.resourceStore.last)==null?void 0:r.$original),o=s&&n.resolveAssignmentRecord(i);return Object.assign(t,{eventElement:i,eventRecord:s,resourceRecord:a,assignmentRecord:o})}getTargetElementFromEvent({target:e}){return e.closest(this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:r,event:t}={}){this.disabled||!r&&(r=this.getElementFromRecord(e),!r)||C.triggerMouseEvent(r,this.tiggerEvent)}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e,eventRecord:r,assignmentRecord:t}){const{client:i}=this;e.deleteEvent={disabled:r.readOnly||(t==null?void 0:t.readOnly),hidden:i.readOnly},e.unassignEvent={disabled:r.readOnly||(t==null?void 0:t.readOnly),hidden:i.readOnly||i.eventStore.usesSingleAssignment}}changeItems(e){const{client:r}=this;return U.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:t,eventRecord:i}){var n;const s=(n=t.focusInEvent)==null?void 0:n.relatedTarget;s&&(s.focus(),r.navigator.activeItem=s),r.removeEvents(r.isEventSelected(i)?r.selectedEvents:[i])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:t,eventRecord:i,resourceRecord:n}){var s;const a=(s=t.focusInEvent)==null?void 0:s.relatedTarget;a&&(a.focus(),r.navigator.activeItem=a),r.isEventSelected(i)?r.assignmentStore.remove(r.selectedAssignments):i.unassign(n)}}},e)}};Wo.featureClass="",Wo._$name="EventMenu",z.registerFeature(Wo,!0,"Scheduler"),z.registerFeature(Wo,!1,"ResourceHistogram");var Xg=e=>{var r;return r=class extends e{getNonWorkingTimeRanges(t,i,n){if(!t.getNonWorkingTimeRanges){const s=[];return t.forEachAvailabilityInterval({startDate:i,endDate:n,isForward:!0},(a,o,l)=>{for(const[c,d]of l.intervalGroups)d.getIsWorking()||s.push({name:c.name,iconCls:c.iconCls,cls:c.cls,startDate:a,endDate:o})}),s}return t.getNonWorkingTimeRanges(i,n)}getCalendarTimeRanges(t,i=!1){const n=this,{timeAxis:s,fillTicks:a}=n.client,{unit:o,increment:l}=s,c=!n.maxTimeAxisUnit||b.compareUnits(o,n.maxTimeAxisUnit)<=0;if(t&&c&&s.count){const d=n.getNonWorkingTimeRanges(t,s.startDate,s.endDate),u=d.map(g=>new St({name:g.name,cls:`b-nonworkingtime ${g.cls||""}`,startDate:g.startDate,endDate:g.endDate})),h=[];let f=null;for(const g of u)f&&g.startDate<=f.endDate&&(i||g.name===f.name)&&g.duration>0?f.endDate=g.endDate:(h.push(g),g.setData("id",`nonworking-${h.length}`),f=g);return a&&h.forEach(g=>{g.setStartEndDate(b.ceil(g.startDate,{magnitude:l,unit:o}),b.floor(g.endDate,{magnitude:l,unit:o}))}),h}else return[]}setupDefaultCalendar(){const{client:t,project:i}=this;!this.autoGeneratedWeekends&&!t.isSchedulerPro&&!t.isGantt&&i.effectiveCalendar===i.defaultCalendar&&!i.defaultCalendar.intervalStore.count&&(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const t=this.client.project.effectiveCalendar,i=this.defaultNonWorkingIntervals,n=!!i.length;t.clearIntervals(n),n&&t.addIntervals(i)}}updateLocalization(){var t;(t=super.updateLocalization)==null||t.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return b.nonWorkingDaysAsArray.map(i=>({recurrentStartDate:`on ${t[i]} at 0:00`,recurrentEndDate:`on ${t[(i+1)%7]} at 0:00`,isWorking:!1}))}},R(r,"$name","NonWorkingTimeMixin"),R(r,"configurable",{maxTimeAxisUnit:"week"}),r},Uo=class extends X.mixin(er,Xg){static get properties(){return{calendarRangeCache:new Map}}doDisable(e){this.client.refresh(),super.doDisable(e)}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e);const r=this;e.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:r}),r.client.isScheduler&&r.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:r}),r.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(e,r,t,i){const n=this,{client:s}=n,{rtl:a}=s,o=s.getCoordinateFromDate(b.max(e.startDate,r))-i,l=e.endDate?s.getCoordinateFromDate(b.min(e.endDate,t))-i:o,c=Math.abs(l-o),d=c>0,u=a?`calc(${o}px - 100%)`:`${o}px`;return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[e.cls]:e.cls,"b-rtl":a},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`transform: translateY(${u}); ${d?`height:${c}px`:""};`:`transform: translateX(${u}); ${d?`width:${c}px`:""};`}}getCalendarTimeRanges(e){let r=this.calendarRangeCache.get(e);return r||(r=super.getCalendarTimeRanges(e,!0),this.calendarRangeCache.set(e,r)),r}onEventDataGenerated({eventRecord:e,endMS:r,startMS:t,start:i,end:n,left:s,top:a,children:o}){var l;if(this.enabled){const{isVertical:c}=this.client,d=(l=e.effectiveCalendarsCombination)!=null?l:this.client.project.calendar;for(const u of this.getCalendarTimeRanges(d))if(u.startDateMS<r&&u.endDateMS>t){const h=this.getRangeDomConfig(u,i,n,c?a:s);o.push(h)}}}};R(Uo,"$name","EventNonWorkingTime"),R(Uo,"pluginConfig",{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]}),Uo._$name="EventNonWorkingTime",z.registerFeature(Uo,!1,"Scheduler");var Nw=[0,0],uA=[null,[0,10],[10,0]],Td=class extends Og{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`
                ${e.eventRecord.name?L.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}
                ${e.startClockHtml}
                ${e.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(e,r){const t=this;super.construct(e,r),typeof t.align=="string"&&(t.align={align:t.align})}onPaint({firstPaint:e}){if(super.onPaint(...arguments),e){const r=this,t=r.client.features.dependencies;t&&r.tooltip.ion({beforeAlign({source:i,offset:n=Nw}){const{edgeAligned:s}=Py(i.align.align),a=t.disabled?Nw:uA[s];arguments[0].offset=[n[0]+a[0],n[1]+a[1]]}})}}};Td._$name="EventTooltip",z.registerFeature(Td,!0,"Scheduler"),z.registerFeature(Td,!1,"ResourceHistogram");var hA={update:1,filter:1},fA={add:1,remove:1,update:1,removeAll:1,filter:1},Zg=class extends vo{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,r){const t=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");t.scheduler=e,super.construct(e,r),!t.summaries&&t.renderer&&(t.summaries=[{renderer:t.renderer}]),e.isSchedulerBase&&(e.eventStore.ion({changePreCommit:t.onEventStoreChange,thisObj:t}),e.assignmentStore.ion({changePreCommit:t.onAssignmentStoreChange,thisObj:t}),e.ion({timeAxisViewModelUpdate:t.onTimeAxisChange,thisObj:t}),e.project.ion({dataReady:t.onProjectDataReady,thisObj:t}))}doDestroy(){var e;(e=this._tip)==null||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach(e=>{e.isGroupFooter&&e.render()})}onEventStoreChange({action:e,records:r,changes:t}){if(hA[e]){const i=new Set;r.forEach(n=>n.resources.forEach(s=>i.add(s))),this.afterChange(i)}}onAssignmentStoreChange({action:e,records:r,changes:t}){var i;if(fA[e]){const n=new Set;if(r.forEach(s=>s.resource&&n.add(s.resource)),((i=t==null?void 0:t.resourceId)==null?void 0:i.oldValue)!=null){const s=this.scheduler.resourceStore.getById(t.resourceId.oldValue);s&&n.add(s)}this.afterChange(n)}}afterChange(e){const{rowManager:r}=this.scheduler;for(const t of e){let i=r.getRowFor(t);if(this.target==="header")for(;i&&!i.isGroupHeader;)i=r.getRow(i.index-1);else for(;i&&!i.isGroupFooter;)i=r.getRow(i.index+1);i&&this.footersToUpdate.add(i)}}onProjectDataReady(){var e;const{footersToUpdate:r,client:t}=this;if(t.isVisible){if(r.size){for(const i of r)(e=i.render)==null||e.call(i);r.clear()}}else t.whenVisible("refresh",t,[!0])}onBeforeRenderRow({row:e,record:r}){if(e.isGroupFooter&&!r.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,r,t,i,n,s){if(e.type==="timeAxis"){const a=this,{scheduler:o}=a,{eventStore:l}=o,c=o.timeAxisViewModel.columnConfig;let d="";const u=o.getResourcesEventsPerTick(r,({event:h})=>h.resources.some(f=>r.includes(f))&&(!l.isFiltered||l.records.includes(h)));return o.timeAxis.forEach((h,f)=>{const g=u[f]||[],m=a.summaries.map(p=>`<div class="b-timeaxis-summary-value">${p.renderer({startDate:h.startDate,endDate:h.endDate,resourceStore:o.resourceStore,events:g,resources:r,eventStore:l,groupRecord:i,groupField:n,groupValue:s})}</div>`).join("");d+=`<div class="b-timeaxis-tick" style="width: ${c[c.length-1][f].width}px">${m}</div>`}),`<div class="b-timeaxis-group-summary">${d}</div>`}return super.generateHtml(e,r,t,i,n,s)}updateSummaryHtml(e,r,t){const i=super.updateSummaryHtml(e,r,t);if(r.type==="timeAxis"){const n={count:0,height:0};return this.summaries.forEach(s=>{s.height?n.height+=s.height:n.count++}),n}return i}getTipHtml({activeTarget:e}){const r=this,t=Array.from(e.parentElement.children).indexOf(e),i=r.scheduler.timeAxis.getAt(t);let n=`<header>${r.L("L{Summary.Summary for}",r.scheduler.getFormattedDate(i.startDate))}</header>`,s=!1;return C.forEachSelector(e,".b-timeaxis-summary-value",(a,o)=>{const l=r._labels[o],c=a.innerText.trim();n+=`<label>${l||""}</label><div class="b-timeaxis-summary-value">${c}</div>`,a.innerHTML&&(s=!0)}),s?n:null}render(){var e;const r=this,{scheduler:t}=r;t.isSchedulerBase&&(e=r.summaries)!=null&&e.some(i=>i.label)&&r.showTooltip&&!r._tip&&(r._labels=r.summaries.map(i=>i.label||""),r._tip=new ue({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:r.getTipHtml.bind(r)}))}removeSummaryElements(e){const r=e.querySelector(".b-timeaxis-group-summary");r==null||r.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}};Zg._$name="GroupSummary",z.registerFeature(Zg,!1,"Scheduler");var Md=class extends X{static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const r=this;if(!(e.touches||e.button!==0||r.disabled)&&e.target.closest(".b-sch-header-timeaxis-cell")){const t=r.client.subGrids.normal.header.headersElement;r.startX=e.clientX,r.element=C.createElement({parent:t,tag:"div",className:"b-headerzoom-rect"}),r.headerElementRect=k.from(t),j.on({element:document,mouseup:"onMouseUp",thisObj:r,once:!0})}}onElementMouseMove(e){const r=this;if(typeof r.startX=="number"){const t=Math.max(e.clientX,r.headerElementRect.left),i=Math.min(r.startX,t),n=Math.abs(r.startX-t),s=new k(i-r.headerElementRect.x+r.client.scrollLeft,0,n,r.headerElementRect.height);C.setTranslateX(r.element,s.left),r.element.style.width=s.width+"px"}}onMouseUp(){const e=this;if(typeof e.startX=="number"){const{client:r}=e,t=k.from(e.element),i=r.getDateFromCoordinate(t.left,"round",!1),n=r.getDateFromCoordinate(t.right,"round",!1);e.element.remove(),e.startX=null,r.zoomToSpan({startDate:i,endDate:n})}}};R(Md,"$name","HeaderZoom"),Md._$name="HeaderZoom",z.registerFeature(Md,!1,"Scheduler");var gA=["top","before","after","bottom"],mA=(e,r)=>{switch(e){case"top":return"b-b";case"after":return r.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return r.rtl?"l-l":"r-r";case"left":return"r-r"}},pA={top:1,bottom:1},vA={estimate:1,measure:1},yA={before:1,after:1},Pd=class extends X{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,r){const t=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");t.scheduler=e,super.construct(e,r),(t.top||t.bottom||t.before||t.after)&&t.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:r}=this,{classList:t}=this.scheduler.element;t.remove("b-labels-topbottom"),t.remove("b-labels-top"),t.remove("b-labels-bottom"),(e||r)&&(t.add("b-labels-topbottom"),e&&t.add("b-labels-top"),r&&t.add("b-labels-bottom"))}onLabelDblClick(e){const r=this,t=e.target;if(t&&!r.scheduler.readOnly){const{side:i}=t.dataset,n=r[i],{editor:s,field:a}=n;if(s){const o=this.scheduler.resolveEventRecord(e.target);return o.readOnly?void 0:(s instanceof Qt||(n.editor=new Qt({blurAction:r.blurAction,inputField:s,scrollAction:"realign"})),n.editor.render(r.scheduler.element),n.editor.startEdit({target:t,align:mA(i,r.client),matchSize:!1,record:o,field:a}),e.stopImmediatePropagation(),!1)}}}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeAfter(e){return this.processLabelSpec(e,"after")}updateAfter(){this.updateHostClasslist()}changeRight(e){this[this.client.rtl?"before":"after"]=e}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(e){return this.processLabelSpec(e,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(e){this[this.client.rtl?"after":"before"]=e}processLabelSpec(e,r){if(typeof e=="function")e={renderer:e};else if(typeof e=="string")e={field:e};else if(e)e=Object.setPrototypeOf({},e);else return null;const{scheduler:t}=this,{eventStore:i,resourceStore:n,taskStore:s,id:a}=t,{field:o,editor:l}=e;if(pA[r]&&(t.milestoneWidth=null),i&&!s?e.recordType="event":e.recordType="task",o){let c,d=!1;i&&!s&&(c=i.modelClass.fieldMap[o],c?(e.fieldDef=c,e.recordType="event",d=!0):Reflect.has(i.modelClass.prototype,o)&&(e.recordType="event",d=!0)),!c&&s&&(c=s.modelClass.fieldMap[o],c?(e.fieldDef=c,e.recordType="task",d=!0):Reflect.has(n.modelClass.prototype,o)&&(e.recordType="task",d=!0)),!c&&n&&(c=n.modelClass.fieldMap[o],c?(e.fieldDef=c,e.recordType="resource",d=!0):Reflect.has(n.modelClass.prototype,o)&&(e.recordType="resource",d=!0)),l&&(typeof l=="boolean"?t.editor={type:"textfield"}:typeof l=="string"&&(t.editor={type:l}),j.on({element:t.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const r=this,t=[];for(const i of gA)if(r[i]){const{field:n,fieldDef:s,recordType:a,renderer:o,thisObj:l}=r[i],c={tag:"label",className:{[r.labelCls]:1,[`${r.labelCls}-${i}`]:1},dataset:{side:i,taskFeature:`label-${i}`}};let d;const u=`${a}Record`,h=e[u];o?d=o.call(l||r.thisObj||r,{[u]:h,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:c}):(d=h[n],(s==null?void 0:s.type)==="date"&&!o?d=b.format(d,r.client.displayDateFormat):d=L.encodeHtml(d)),c.html=d||"\xA0",t.push(c)}return t}measureLabels(e,r){const t=this,i=t.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const n of e)if(yA[n.dataset.side]){let{html:s}=n,a=0;if(t.labelLayoutMode==="estimate")s.includes("<")&&(s=C.stripTags(s)),a=s.length*t.labelCharWidth+18;else{const l=t.labelMeasureElement||(t.labelMeasureElement=C.createElement({className:"b-sch-event-wrap b-measure-label",parent:t.client.foregroundCanvas}));l.retainElement=!0,q.sync({targetElement:l,childrenOnly:!0,domConfig:{children:[n]}}),a=l.firstElementChild.offsetWidth}const o=a/i;switch(n.dataset.side){case"before":r.startMS-=o;break;case"after":r.endMS+=o;break}}}onEventDataGenerated(e){var r;if(!this.disabled&&!((r=e.eventRecord)!=null&&r.isResourceTimeRange)){const t=this.generateLabelConfigs(e);vA[this.labelLayoutMode]&&this.measureLabels(t,e),e.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}};Pd.featureClass="b-sch-labels",Pd._$name="Labels",z.registerFeature(Pd,!1,"Scheduler");var zs=class extends pn.mixin(er,Xg){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){re.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){!this.isConfiguring&&e==="fillTicks"&&this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),!e.graph&&!this.client.isScheduler&&e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const r=this,{project:t,client:i}=r;r.detachListeners("calendar"),r.autoGeneratedWeekends=!1,e&&(r.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>r.setTimeout(()=>r.refresh(),1)})),i.isEngineReady&&!i.project.isDelayingCalculation&&!i.isDestroying?r.refresh():t.isDestroyed||(r.detachListeners("initialProjectListener"),t.ion({name:"initialProjectListener",refresh({isCalculated:n}){n!==!1&&(r.refresh(),r.detachListeners("initialProjectListener"))},thisObj:r}))}get calendar(){var e;return(e=this.project)==null?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=b.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}};R(zs,"$name","NonWorkingTime"),R(zs,"pluginConfig",{chain:["onPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]}),zs._$name="NonWorkingTime",z.registerFeature(zs,!1,"Scheduler"),z.registerFeature(zs,!0,["SchedulerPro","Gantt","ResourceHistogram"]);var Go=class extends X{get targetSelector(){return`.b-sch-timeaxis-cell,.b-timeline-subgrid${this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":""}`}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(e){const r=this,{client:t}=r,{button:i,touches:n,target:s,clientX:a,clientY:o}=e,l=t.features.taskDrag||t.features.eventDrag,c=t.readOnly||!(l!=null&&l.enabled);n||i!==0||r.disabled||t.trigger("beforePan",{event:e})===!1||(s.matches(r.targetSelector)||c&&s.closest(t.eventSelector))&&(r.mouseX=a,r.mouseY=o,r.onHeader=r.enableInHeader&&s.closest(".b-sch-header-timeaxis-cell"),r.mouseDetacher=j.on({element:document,mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:r}))}onMouseMove(e){const r=this,{client:t}=r,i=t.timeAxisSubGrid.scrollable,n=t.scrollable,s=e.clientX,a=e.clientY;e.preventDefault(),r.vertical&&(t.isVertical||!r.onHeader)&&n.scrollBy(0,r.mouseY-a),r.horizontal&&(t.isHorizontal||!r.onHeader)&&i.scrollBy(r.mouseX-s),r.mouseX=s,r.mouseY=a}onMouseUp(){this.mouseDetacher(),this.mouseDetacher=null}get isActive(){return!!this.mouseDetacher}};R(Go,"$name","Pan"),R(Go,"configurable",{horizontal:!0,vertical:!0,enableInHeader:!0}),Go._$name="Pan",z.registerFeature(Go,!1,["Scheduler","Gantt"]);var Ws=class extends es{static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateResourceMenu"),e}getDataFromEvent(e){const r=e.target.closest(".b-resourceheader-cell"),t=r==null?void 0:r.dataset.resourceId;if(t){const i=this.client.resourceStore.getById(t);return{cellElement:r,resourceRecord:i}}}populateResourceMenu({items:e,resourceRecord:r}){const{client:t}=this;t.readOnly||(e.remove={text:"L{CellMenu.removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:r.readOnly,onItem:()=>t.resourceStore.remove(r)})}get showMenu(){return!0}};R(Ws,"$name","ResourceMenu"),R(Ws,"configurable",{processItems:null,items:null,type:"resource"}),Ws.featureClass="",Ws._$name="ResourceMenu",z.registerFeature(Ws,!1,["Scheduler"]);var Us=class extends mn{static get pluginConfig(){return{...super.pluginConfig,assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]}}attachToProject(e){const r=this,{client:t}=r;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=t.resourceTimeRangeStore||new $o({owner:r});const{crudManager:n}=t;n&&!n.resourceTimeRangeStore&&(n.resourceTimeRangeStore=e.resourceTimeRangeStore)}const i=e.resourceTimeRangeStore;r.exposedOnScheduler||(t.resourceTimeRanges&&(i.add(t.resourceTimeRanges),delete t.resourceTimeRanges),Object.defineProperty(t,"resourceTimeRanges",{get:()=>i.records,set:n=>i.data=n}),r.exposedOnScheduler=!0),i.resourceStore||(i.resourceStore=e.resourceStore),r.detachListeners("store"),i.ion({name:"store",change:r.onStoreChange,thisObj:r})}attachToResourceTimeRangeStore(e){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(e,r){if(!this.disabled){const{timeRanges:t}=e.$original;if(t!=null&&t.length){const{startDate:i,endDate:n}=this.client;t.forEach(s=>{s.isRecurring?r.push(...s.getOccurrencesForDateRange(i,n)):r.push(s)})}}return r}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}doDestroy(){var e;((e=this.store)==null?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}};R(Us,"$name","ResourceTimeRanges"),R(Us,"configurable",{rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0,entityName:"resourceTimeRange"}),Us.featureClass="",Us._$name="ResourceTimeRanges",z.registerFeature(Us,!1,"Scheduler");var Id=class extends Ed{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:r}=this,{targetElement:t,resourceRecord:i}=e,n=r.timeAxisSubGridElement.contains(t);return!t.closest(r.eventSelector)&&n&&!(i&&i.isSpecialRow)}getDataFromEvent(e){var r,t;if(C.isDOMEvent(e)){const{client:i}=this,n=(r=i.getCellDataFromEvent)==null?void 0:r.call(i,e),s=(t=i.getDateFromDomEvent)==null?void 0:t.call(i,e,"floor"),a=i.resolveResourceRecord(e)||i.isVertical&&i.resourceStore.last;return T.assign(super.getDataFromEvent(e),n,{date:s,resourceRecord:a})}return e}populateScheduleMenu({items:e,resourceRecord:r,date:t}){const{client:i}=this;!i.readOnly&&i.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!r||r.readOnly||!r.isWorkingTime(t),weight:100,onItem(){i.createEvent(t,r,i.getRowFor(r))}})}};Id.featureClass="",Id._$name="ScheduleMenu",z.registerFeature(Id,!0,"Scheduler");var Yo=class extends X{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){if(!e)return;const r=this,{client:t}=r;t.isSchedulerPro&&r.hideForNonWorkingTime===void 0&&(r.hideForNonWorkingTime=!0);let i;const n=r.hoverTip=new ue({id:`${t.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",getHtml:r.getHoverTipHtml.bind(r),onDocumentMouseDown(s){n.forElement.contains(s.event.target)&&(i=j.on({thisObj:r,element:t.timeAxisSubGridElement,mousemove:o=>n.internalOnPointerOver(o),capture:!0}));const a=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,s),n.hideAnimation=a},...r.config,internalListeners:r.configuredListeners});n.ion({pointerover({event:s}){const a="buttons"in s?s.buttons>0:s.which>0;return!a&&i&&i(),!r.disabled&&!a},innerhtmlupdate({source:s}){r.clockTemplate.updateDateIndicator(s.element,r.lastTime)}}),t.ion({timeAxisViewModelUpdate:"updateTip",thisObj:r}),r.clockTemplate=new fn({scheduler:t})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:r}){const t=this,i=t.client,n=r&&i.getDateFromDomEvent(r,"floor",!0);let s=t.lastHtml;if(n&&r.target){const a=i.resolveResourceRecord(r);if(a&&(n-t.lastTime!==0||a.id!==t.lastResourceId)){if(t.hideForNonWorkingTime){const o=a.isWorkingTime(n);e.element.classList.toggle("b-nonworking-time",!o)}t.lastResourceId=a.id,s=t.lastHtml=t.generateTipContent({date:n,event:r,resourceRecord:a})}}else e.hide(),t.lastTime=null,t.lastResourceId=null;return s}generateTipContent({date:e,event:r,resourceRecord:t}){const i=this,n=i.clockTemplate.generateContent({date:e,text:i.client.getFormattedDate(e)}),s=i.messageTemplate({message:i.getText(e,r,t)||""});return i.lastTime=e,n+s}getText(e,r,t){}};Yo.featureClass="b-scheduletip",Yo._$name="ScheduleTooltip",z.registerFeature(Yo,!0,"Scheduler"),z.registerFeature(Yo,!1,"ResourceUtilization");var Jg=class extends X.mixin(jo){static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,r){const t=this;t.scheduler=e,e.eventEdit=t,super.construct(e,r),t.clientListenersDetacher=e.ion({[t.triggerEvent]:({eventRecord:i,eventElement:n})=>t.editEvent(i,i.resource,n),dragcreateend:t.onDragCreateEnd,thisObj:t})}doDestroy(){var e;this.clientListenersDetacher(),(e=this.editor)==null||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}get project(){return this.client.project}async editEvent(e,r,t,i){const n=this,{scheduler:s}=n,{eventEdit:a}=n.client.features;if(s.readOnly||n.disabled||e.readOnly||a&&!a.disabled&&!e.isCreating)return;let{editor:o}=n;t=C.down(t,s.eventInnerSelector)||t,e=e.isAssignment?e.event:e,n.resource=r,n.event=e,n.element=t,s.element.classList.add("b-eventeditor-editing"),o?o.render(s.timeAxisSubGridElement):(n.editor=o=Qt.new({owner:s.timeAxisSubGrid,appendTo:s.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:s.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:n},onInternalKeyDown:l=>l.stopPropagation()},n.editorConfig),n.relayEvents(n.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),i?(n.stmInitiallyAutoRecord=i.stmInitiallyAutoRecord,n.stmInitiallyDisabled=i.stmInitiallyDisabled,n.hasStmCapture=!0,i.transferred=!0):i!==!1&&!n.hasStmCapture&&n.captureStm(!0),e.isCreating&&(e.name=""),await o.startEdit({target:t,record:e,field:n.field}),s.isVertical&&e.startDate<s.visibleDateRange.startDate&&o.element.scrollIntoView(),s.navigator.disabled=!0}onEditorComplete(){this.event.isCreating=!1,this.reset(),this.freeStm(!0)}onEditorCancel(){this.event.isCreating&&this.event.remove(),this.reset(),this.freeStm(!1)}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.event=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:r}){const t=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(r),i=(e||r).resource;this.editEvent(r,i,t)}onDragCreateEnd({eventRecord:e,resourceRecord:r,eventElement:t,stmCapture:i}){this.element=t,this.editEvent(e,r,t,i)}};Jg._$name="SimpleEventEdit",z.registerFeature(Jg,!1,"Scheduler");var bA={width:0,height:0},Cn=class extends X{construct(e,r){super.construct(e,r),e.isVertical&&(this.toUpdate=new Set,e.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=e.eventRecord.stickyContents===!1:(this.syncEventContentPosition(e,void 0,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}onHorizontalScroll({subGrid:e}){e===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:e,style:r}of this.toUpdate)C.applyStyle(e,r);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(e){const{resourceMap:r}=e.currentOrientation;for(const t of r.values())for(const{renderData:i,elementConfig:n}of Object.values(t)){const s=[i];n&&i.eventRecord.isResourceTimeRange&&s.push(n.children[0]),this.syncEventContentPosition.apply(this,s)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(e,r=e.eventContent,t=!1){if(this.disabled||e.eventRecord.stickyContents===!1)return;const{client:i}=this,{eventRecord:n,resourceRecord:s,useEventBuffer:a,bufferAfterWidth:o,bufferBeforeWidth:l,top:c,height:d}=e,u=i.scrollable.y,h=t?null:i.getElementFromEventRecord(n,s,!0),f=h&&q.getChild(h,"event.content"),g=n.instanceMeta(i),m=typeof r.style=="string"?r.style=C.parseStyle(r.style):r.style||(r.style={});if(h!=null&&h.classList.contains("b-dragging"))return;let p=c,v=d,y=p+v;if(a&&(p+=l,v=v-l-o,y=p+v),p<u&&y>=u&&!n.isMilestone){const S=f==null?void 0:f.offsetWidth,D=(f==null?void 0:f.parentNode)&&C.getStyleValue(f.parentNode,"justifyContent"),w=D==="center"?(e.width-S)/2:0,E=p,x=E+v-1;if((!f||S)&&E<u&&x>=u){const M=this.getEventContentMargins(f),I=f?v-f.offsetHeight-M.height-w:Number.MAX_SAFE_INTEGER,P=Math.min(u-E,I-2);m.transform=P>0?`translateY(${P}px)`:"",g.stuck=!0}else m.transform="",g.stuck=!1;f&&this.toUpdate.add({contentEl:f,style:m})}else f&&g.stuck&&(m.transform="",g.stuck=!1,this.toUpdate.add({contentEl:f,style:m}))}getEventContentMargins(e){return e!=null&&e.classList.contains("b-sch-event-content")?C.getEdgeSize(e,"margin"):bA}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}};R(Cn,"$name","StickyEvents"),R(Cn,"type","stickyEvents"),R(Cn,"pluginConfig",{chain:["onEventDataGenerated"]}),Cn._$name="StickyEvents",z.registerFeature(Cn,!0,"Scheduler"),z.registerFeature(Cn,!1,"ResourceHistogram");var Qg=class extends wo{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(e,r){const t=this;super.construct(e,r),t.summaries||(t.summaries=[{renderer:t.renderer}]),e.isTimelineBase&&(t.updateProject(e.project),e.ion({timeAxisViewModelUpdate:t.renderRows,thisObj:t}))}updateProject(e){this.detachListeners("summaryProject"),e.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const e=this,{client:r}=e,t=r.isHorizontal?"width":"height",i=r.timeAxisViewModel.columnConfig,n=e.summaryBarElement;n&&(!e._tip&&e.showTooltip&&e.summaries.some(s=>s.label)&&(e._tip=new ue({id:`${r.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:n,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:s})=>s._tipHtml})),n.innerHTML=i[i.length-1].map(s=>`<div class="b-timeaxis-tick" style="${t}: ${s.width}px"></div>`).join(""),e.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(e){var r;const{isConfiguring:t}=this.client;super.doDisable(e),(r=this.summaryColumn)==null||r.toggle(!e),!t&&!e&&this.render()}doDestroy(){var e;(e=this._tip)==null||e.destroy(),super.doDestroy()}};Qg._$name="TimelineSummary";var em=class extends Qg{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}construct(e,r){const t=this;t.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,r.hideFooters=!0,e.add(e.createSubGrid("right")),t.summaryColumn=e.columns.add(T.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:t.disabled},t.verticalSummaryColumnConfig))[0]),super.construct(e,r),e.isSchedulerBase&&(t.updateEventStore(e.eventStore),t.updateResourceStore(e.resourceStore))}updateEventStore(e){this.detachListeners("summaryEventStore"),e.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:r}=e,{eventStore:t,timeAxis:i}=r,n=e.summaryBarElement,s=e.selectedOnly&&r.selectedRecords.length?r.selectedRecords:r.resourceStore.records;if(n&&r.isEngineReady){const a=r.getResourcesEventsPerTick(s,({event:o})=>!t.isFiltered||t.records.includes(o));Array.from(n.children).forEach((o,l)=>{const c=i.getAt(l),d=a[l]||[];let u="",h=`<header>${e.L("L{Summary for}",r.getFormattedDate(c.startDate))}</header>`;e.summaries.forEach(f=>{const g=f.renderer({startDate:c.startDate,endDate:c.endDate,resourceStore:r.resourceStore,eventStore:t,events:d,element:o}),m=g?`<div class="b-timeaxis-summary-value">${g}</div>`:"";(e.summaries.length>1||g)&&(u+=m),h+=m?`<label>${f.label||""}</label>`+m:""}),o.innerHTML=u,o._tipHtml=u?h:""})}}};em._$name="Summary",z.registerFeature(em,!1,"Scheduler");var CA={maintainVisibleStart:!0},Ad=class extends yo{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:r,targetElement:t}=e,{client:i}=this;return i.isHorizontal?(r==null?void 0:r.enableHeaderContextMenu)!==!1&&(r==null?void 0:r.isTimeAxisColumn):t.matches(".b-sch-header-timeaxis-cell")}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const r=this,{client:t}=r,i={magnitude:t.timeAxis.shiftIncrement,unit:t.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:r,icon:"b-fw-icon b-icon-search-plus",disabled:!t.presets.count||r.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:n}){const[s]=n.items;s.min=t.minZoomLevel,s.max=t.maxZoomLevel,s.value=t.zoomLevel,r.zoomDetatcher=s.ion({change:"onZoomSliderChange",thisObj:r})},onHide(){r.zoomDetatcher&&(r.zoomDetatcher(),r.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:r,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:r},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:i,internalListeners:{change:r.onRangeDateFieldChange,thisObj:r}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:i,internalListeners:{change:r.onRangeDateFieldChange,thisObj:r}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:r.onLeftShiftBtnClick,thisObj:r}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",internalListeners:{click:r.onTodayBtnClick,thisObj:r}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:r.onRightShiftBtnClick,thisObj:r}}},internalListeners:{paint:r.initDateRangeFields,thisObj:r}}}})}onZoomSliderChange({value:e}){const r=this;r.menu.scrollAction="realign",r.client.zoomLevel=e,r.menu.setTimeout({fn:()=>r.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:r}){if(r){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const r=this,t=e===r.startDateField,{client:i}=r,{timeAxis:n}=i,s=r.startDateFieldInitialValue&&!t?r.startDateFieldInitialValue:r.startDateField.value;let a=r.endDateFieldInitialValue&&t?r.endDateFieldInitialValue:r.endDateField.value;t?r.startDateFieldInitialValue=null:r.endDateFieldInitialValue=null,a-s?a<s&&(a=b.add(s,n.shiftIncrement,n.shiftUnit)):a=b.add(a,n.shiftIncrement,n.shiftUnit),i.setTimeSpan(s,a,CA),r.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=b.clearTime(new Date);this.client.setTimeSpan(e,b.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}};Ad._$name="TimeAxisHeaderMenu",z.registerFeature(Ad,!0,["Scheduler","Gantt"]),z.registerFeature(Ad,!1,"ResourceHistogram");var _d=class extends pn.mixin(er){static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:!0}}doDestroy(){var e;(e=this.storeDetacher)==null||e.call(this),super.doDestroy()}get timeRanges(){const e=this;if(!e._timeRanges){const{store:r}=e;let{records:t}=r;if(r.recurringEvents){const{startDate:i,endDate:n}=e.client.timeAxis;t=t.flatMap(s=>s.isRecurring?s.getOccurrencesForDateRange(i,n):s)}e.currentTimeLine&&(r.recurringEvents||(t=t.slice()),t.push(e.currentTimeLine)),e._timeRanges=t}return e._timeRanges}attachToProject(e){var r,t;super.attachToProject(e);const i=this;(r=i.projectTimeZoneChangeDetacher)==null||r.call(i),i.showCurrentTimeLine&&(i.projectTimeZoneChangeDetacher=(t=i.client.project)==null?void 0:t.ion({timeZoneChange:()=>i.updateCurrentTimeLine()}),i.currentTimeLine&&i.updateCurrentTimeLine())}initCurrentTimeLine(){const e=this;if(e.currentTimeLine||!e.showCurrentTimeLine)return;const r=typeof e.showCurrentTimeLine=="object"?e.showCurrentTimeLine:{};e.currentTimeLine=e.store.modelClass.new({id:"currentTime",cls:"b-sch-current-time"},r),e.currentTimeInterval=e.setInterval(()=>e.updateCurrentTimeLine(),e.currentTimeLineUpdateInterval),e._timeRanges=null,e.updateCurrentTimeLine()}updateCurrentTimeLine(){var e;const r=this,{currentTimeLine:t}=r;t.timeZone=(e=r.project)==null?void 0:e.timeZone,t.setLocalDate("startDate",new Date),t.endDate=t.startDate,t.originalData.name||(t.name=b.format(t.startDate,r.currentDateFormat)),r.renderRanges()}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.refresh())}updateShowCurrentTimeLine(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateTimeAxisHeaderMenu({column:e,items:r}){r.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.showCurrentTimeLine,onToggle:({checked:t})=>{this.showCurrentTimeLine=t}}}attachToStore(e){const r=this;let t=!1;r.storeDetacher&&(r.storeDetacher(),t=!0),r.storeDetacher=e.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:r}),r._timeRanges=null,t&&r.renderRanges()}get store(){return this.client.project.timeRangeStore}updateStore(e){const r=this,{client:t}=r,{project:i}=t;e=i.timeRangeStore,r.attachToStore(e),t.timeRanges&&!t._timeRangesExposed&&(e.add(t.timeRanges),delete t.timeRanges)}attachToTimeRangeStore(e){this.store=e}resolveTimeRangeRecord(e){return this.store.getById(e.closest(this.baseSelector).dataset.id)}onStoreChange({type:e,action:r}){const t=this;t._timeRanges=null,!(t.disabled||!t.client.isVisible||t.isConfiguring||e==="refresh"&&r!=="batch")&&t.client.runWithTransition(()=>t.renderRanges(),!t.client.refreshSuspended)}onDragStart(e){const r=this,{context:t}=e,i=r.resolveTimeRangeRecord(t.element.closest(r.baseSelector)),n=r.getBodyElementByRecord(i);t.relatedElements=[n],Object.assign(t,{record:i,rangeBodyEl:n,originRangeX:C.getTranslateX(n),originRangeY:C.getTranslateY(n)}),super.onDragStart(e),r.showTip(t)}onDrop(e){const{context:r}=e;if(!r.valid)return this.onInvalidDrop({context:r});const t=this,{client:i}=t,{record:n}=r,s=k.from(r.rangeBodyEl),a=i.getDateFromCoordinate(s.getStart(i.rtl,i.isHorizontal),"round",!1);n.startDate-a!==0?n.setStartDate(a):t.onInvalidDrop(),t.destroyTip(),super.onDrop(e)}onResizeStart({context:e}){const r=this,t=r.resolveTimeRangeRecord(e.element.closest(r.baseSelector)),i=r.getBodyElementByRecord(t);Object.assign(e,{record:t,rangeBodyEl:i}),r.showTip(e)}onResizeDrag({context:e}){const r=this,{rangeBodyEl:t}=e;r.client.isVertical?(e.edge==="top"&&C.setTranslateY(t,e.newY),t.style.height=e.newHeight+"px"):(e.edge==="left"&&C.setTranslateX(t,e.newX),t.style.width=e.newWidth+"px")}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const r=this,{client:t}=r,{rtl:i}=t,n=e.record,s=k.from(e.element),a=s.getStart(i,t.isHorizontal),o=s.getEnd(i,t.isHorizontal),l=t.getDateFromCoordinate(a,"round",!1),c=i&&e.edge==="right"||!i&&e.edge==="left"||e.edge==="top",d=t.getDateFromCoordinate(o,"round",!1);(c&&n.startDate-l!==0||d&&n.endDate-d!==0)&&d>l?c?n.setStartDate(l,!1):n.setEndDate(d,!1):r.onInvalidResize({context:e}),r.destroyTip()}onInvalidResize({context:e}){const r=this;r.resize.reset(),e.rangeBodyEl.parentElement.lastDomConfig=e.rangeBodyEl.lastDomConfig=null,r.renderRanges(),r.destroyTip()}};R(_d,"configurable",{store:{modelClass:St},currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:!1}),_d._$name="TimeRanges",z.registerFeature(_d,!1,["Scheduler","Gantt"]);var Fd=class extends pn{static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},headerRenderer({timeRange:e}){const{dateFormat:r}=this.client.timeAxisViewModel.bottomHeader;return`<span class="b-selection-start">${b.format(e.startDate,r)}</span>
                        <span class="b-selection-end">${b.format(e.endDate,r)}</span>
                        <i class='b-icon b-icon-close' data-ref="closeButton" data-btip="L{Popup.close}"></i>`},selectedTimeSpan:null}}onUIReady(){super.onUIReady(),this.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",thisObj:this})}onTimeAxisHeaderMouseDown({startDate:e,endDate:r}){this.disabled||(this.selectedTimeSpan={startDate:e,endDate:r})}onTimeRangeClick(e){super.onTimeRangeClick(e);const r=this;!r.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?r.selectedTimeSpan=null:r.client.trigger("timeSelectionElementClick",{...r.selectedTimeSpan,domEvent:e}))}updateFromCoords(e,r,t,i){const{client:n}=this,s=n.isHorizontal?t:i;let a=n.isHorizontal?e:r;n.rtl&&n.isHorizontal&&(a=Math.max(n.timeAxisViewModel.totalSize-a-s,0));const o=n.getDateFromCoord({coord:a,roundingMethod:"round",ignoreRTL:!0}),l=n.getDateFromCoord({coord:a+s,roundingMethod:"round",ignoreRTL:!0});this.selectedTimeSpan={startDate:b.max(o,n.startDate),endDate:b.min(l,n.endDate)}}onResizeStart({source:e}){const{timeAxisViewModel:r,timeResolution:t}=this.client,i=b.asMilliseconds(t.increment,t.unit);this.resize.minWidth=r.getDistanceForDuration(i)}onResizeDrag({context:e}){var r,t;this.updateFromCoords(e.newX,e.newY,(r=e.newWidth)!=null?r:e.elementWidth,(t=e.newHeight)!=null?t:e.elementHeight)}onDragStart(e){super.onDragStart(e);const{context:r}=e;r.elementWidth=r.element.offsetWidth,r.elementHeight=r.element.offsetHeight}onDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.elementWidth,e.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(e){return e&&(e.id="time-selection"),e}updateSelectedTimeSpan(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",{...e!=null?e:{}})}};R(Fd,"$name","TimeSelection"),Fd._$name="TimeSelection",z.registerFeature(Fd,!1,"Scheduler");var Di={completeview:"completeview",currentview:"currentview",daterange:"daterange"},SA=Promise.resolve(),tm=e=>class extends e{async scrollRowIntoView(t,i){const{rowManager:n,scrollable:s}=t,a=s.y;return i<t.store.count&&(s.scrollTo(null,n.calculateTop(i)),s.y!==a)?new Promise(o=>{const l=t.ion({scroll({scrollTop:c}){c!=null&&n.getRow(i)&&(l(),o())}})}):SA}async scrollToDate(t,i){let n=!1;const s=[],a=t.timeAxisSubGrid.scrollable.ion({scrollStart({x:o}){o!=null&&(n=!0)}});s.push(t.scrollToDate(i,{block:"start"})),a(),n&&s.push(t.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(s)}cloneElement(t,i,n){super.cloneElement(t,i,n);const s=this.element.querySelector(".b-schedulerbase");s==null||s.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map(a=>`b-initial-${a}`))}async prepareComponent(t){const i=this,{client:n}=t,{currentOrientation:s}=n,a=n.timeAxisSubGrid.width>0;switch(t.scheduleRange){case Di.completeview:t.rangeStart=n.startDate,t.rangeEnd=n.endDate;break;case Di.currentview:{const{startDate:u,endDate:h}=n.visibleDateRange;t.rangeStart=u,t.rangeEnd=h;break}}await n.waitForAnimations(),t.infiniteScroll=n.infiniteScroll,n.infiniteScroll=!1,a&&(n.setTimeSpan(t.rangeStart,t.rangeEnd),n.svgCanvas),i._oldEnableEventAnimations=n.enableEventAnimations,n.enableEventAnimations=!1,s.isHorizontalRendering&&(i._oldScrollBuffer=s.scrollBuffer,i._oldVerticalBuffer=s.verticalBufferSize,s.scrollBuffer=100,s.verticalBufferSize=-1),n.ignoreViewBox=!0,await super.prepareComponent(t);const{exportMeta:o,element:l}=i,c=l.querySelector(".b-sch-foreground-canvas"),d=l.querySelector(".b-horizontaltimeaxis");if(o.includeTimeline=a,a&&t.scheduleRange!==Di.completeview){o.totalWidth-=o.subGrids.normal.width,o.totalWidth+=o.subGrids.normal.width=n.timeAxisViewModel.getDistanceBetweenDates(t.rangeStart,t.rangeEnd);const u=Math.ceil(o.totalWidth/o.pageWidth),h=u*o.verticalPages;o.horizontalPages=u,o.totalPages=h,o.subGrids.normal.scrollLeft=n.getCoordinateFromDate(t.rangeStart)}if(o.timeAxisHeaders=[],o.timeAxisPlaceholders=[],o.headersColleted=!1,C.forEachSelector(d,".b-sch-header-row",u=>{o.timeAxisPlaceholders.push(i.createPlaceholder(u)),o.timeAxisHeaders.push(new Map)}),o.subGrids.normal.eventsPlaceholder=i.createPlaceholder(c,!1),C.removeEachSelector(c,".b-sch-event-wrap,.b-sch-resourcetimerange"),C.removeEachSelector(i.element,".b-released"),o.eventsBoxes=new Map,o.client=n,n.hasActiveFeature("columnLines")){const u=l.querySelector(".b-column-lines-canvas");o.columnLinesPlaceholder=i.createPlaceholder(u),o.columnLines={lines:new Map,majorLines:new Map}}if(n.hasActiveFeature("timeRanges")){const u=l.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),h=l.querySelector(".b-sch-foreground-canvas .b-sch-timeranges-canvas");o.timeRanges={},u&&(o.timeRanges.header={},o.timeRangesHeaderPlaceholder=i.createPlaceholder(u)),o.timeRanges.body={},o.timeRangesBodyPlaceholder=i.createPlaceholder(h)}if(n.hasActiveFeature("dependencies")){n.features.dependencies.fillDrawingCache();const u=l.querySelector(`[id="${n.svgCanvas.getAttribute("id")}"]`);u&&(o.dependencyCanvasEl=u,o.dependenciesPlaceholder=i.createPlaceholder(u,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),C.removeEachSelector(u,".b-sch-dependency"))}a&&!b.betweenLesser(t.rangeStart,n.startDate,n.endDate)&&await i.scrollToDate(n,t.rangeStart)}async restoreState(t){let i=!1;const{client:n}=t,s=[],a=n.timeAxisSubGrid.scrollable.ion({scrollStart({x:o}){this.element.scrollLeft!==o&&(i=!0)}});s.push(super.restoreState(t)),a(),i&&s.push(n.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(s)}async restoreComponent(t){const{client:i}=t,{currentOrientation:n}=i;i.ignoreViewBox=!1,i.infiniteScroll=t.infiniteScroll,i.enableEventAnimations=this._oldEnableEventAnimations,n.isHorizontalRendering&&(n.scrollBuffer=this._oldScrollBuffer,n.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(t)}async onRowsCollected(t,i){const n=this;if(await super.onRowsCollected(t,i),n.exportMeta.includeTimeline){const{client:s,enableDirectRendering:a}=i,{timeView:o}=s,{pageRangeStart:l,pageRangeEnd:c}=n.getCurrentPageDateRange(i);if(a)l&&c&&(n.renderHeaders(i,l,c),n.renderLines(i,l,c),n.renderRanges(i,l,c),n.renderEvents(i,t,l,c));else{if(l){let d=!1;for(await n.scrollToDate(s,l);!d;)if(n.collectLines(i),n.collectHeaders(i),n.collectRanges(i),n.collectEvents(t,i),b.timeSpanContains(o.startDate,o.endDate,l,c))d=!0;else if(o.endDate.getTime()>=c.getTime())d=!0;else{const u=o.endDate;if(await n.scrollToDate(s,o.endDate),u.getTime()===o.endDate.getTime())throw new Error("Could not scroll to date")}}await n.scrollToDate(s,i.rangeStart)}}}getCurrentPageDateRange({rangeStart:t,rangeEnd:i,enableDirectRendering:n,client:s}){const a=this,{exportMeta:o}=a,{horizontalPages:l,horizontalPosition:c,pageWidth:d,subGrids:u}=o;let h,f;if(l>1){const g=c*d,m=(c+1)*d,p=u.locked.width+u.locked.splitterWidth;if(m<=p)f=h=null;else{const{scrollLeft:v=0}=u.normal;h=s.getDateFromCoordinate(Math.max(g-p+v,0));const y=n?1:1.2;f=s.getDateFromCoordinate((m-p+v)*y)||i}}else h=t,f=i;return{pageRangeStart:h,pageRangeEnd:f}}prepareExportElement(){const{element:t,exportMeta:i}=this,{id:n,headerId:s,footerId:a,scrollLeft:o}=i.subGrids.normal,l=t.querySelector(`[id="${n}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach(c=>{const d=l.querySelector(c);d&&(i.lastExportedRowBottom?d.style.height=`${i.lastExportedRowBottom}px`:d.style.height="",o&&(d.style.marginLeft=`-${o}px`))}),o&&[s,a].forEach(c=>{const d=t.querySelector(`[id="${c}"] .b-widget-scroller`);d&&(d.style.marginLeft=`-${o}px`)}),super.prepareExportElement()}collectHeaders(t){const i=this,{client:n}=t,{exportMeta:s}=i;if(!s.headersCollected){const a=n.timeView.element,o=s.timeAxisHeaders;C.forEachSelector(a,".b-sch-header-row",(l,c,d)=>{const u=o[c];C.forEachSelector(l,".b-sch-header-timeaxis-cell",h=>{u.has(h.dataset.tickIndex)||u.set(h.dataset.tickIndex,h.outerHTML)}),c===d.length-1&&u.has(String(n.timeAxis.count-1))&&(s.headersCollected=!0)})}}collectRanges(t){const i=this,{client:n}=t,{exportMeta:s}=i,{timeRanges:a}=s;if(!s.headersCollected&&a){const{headerCanvas:o,bodyCanvas:l}=n.features.timeRanges;o&&C.forEachSelector(o,".b-sch-timerange",c=>{a.header[c.dataset.id]=c.outerHTML}),C.forEachSelector(l,".b-sch-timerange",c=>{a.body[c.dataset.id]=c.outerHTML})}}collectLines(t){const i=this,{client:n}=t,{exportMeta:s}=i,{columnLines:a}=s;if(!s.headersCollected&&a){const o=n.backgroundCanvas;C.forEachSelector(o,".b-column-line, .b-column-line-major",l=>{if(l.classList.contains("b-column-line")){const c=Number(l.dataset.line.replace(/line-/,""));a.lines.set(c,l.outerHTML)}else{const c=Number(l.dataset.line.replace(/major-/,""));a.majorLines.set(c,l.outerHTML)}})}}collectEvents(t,i){const n=this,s=t.length,{client:a}=i,o=n.exportMeta.subGrids.normal.rows;t.forEach((l,c)=>{var d,u;const h=o[o.length-s+c],f=a.store.getAt(l.dataIndex),g=h[3];(d=f.events)==null||d.forEach(m=>{if(m.isScheduled){let p=a.getElementFromEventRecord(m,f);p&&(p=p.parentElement)&&!g.has(m.id)&&g.set(m.id,[p.outerHTML,k.from(p,p.offsetParent)])}}),(u=f.timeRanges)==null||u.forEach(m=>{var p;const v=((p=a.features.resourceTimeRanges)==null?void 0:p.generateElementId(m))||"",y=a.foregroundCanvas.syncIdMap[v];y&&!g.has(v)&&g.set(v,[y.outerHTML,k.from(y,y.offsetParent)])})})}renderHeaders(t,i,n){const s=this,{exportMeta:a}=s,{client:o}=t,l=a.timeAxisHeaders,{timeAxisView:c}=o.timeAxisColumn,d=c.buildCells(i,n),u=document.createElement("div");q.sync({targetElement:u,domConfig:d}),C.forEachSelector(u,".b-sch-header-row",(h,f)=>{const g=l[f];C.forEachSelector(h,".b-sch-header-timeaxis-cell",m=>{g.has(m.dataset.tickIndex)||g.set(m.dataset.tickIndex,m.outerHTML)})})}renderEvents(t,i,n,s){const a=this,{client:o}=t,l=a.exportMeta.subGrids.normal.rows;i.forEach((c,d)=>{const u=l[d],h=u[3],f=o.store.getAt(c.dataIndex),g=o.currentOrientation.getResourceLayout(f),m=o.getCoordinateFromDate(n),p=o.getCoordinateFromDate(s),v=o.currentOrientation.getEventDOMConfigForCurrentView(g,c,m,p),y=document.createElement("div");v.forEach(S=>{const{eventId:D}=S.dataset,{left:w,top:E,width:x,height:M}=S.style;q.sync({targetElement:y,domConfig:S}),h.set(D,[y.outerHTML,new k(w,E,x,M)])})})}renderLines(t,i,n){const s=this,{client:a}=t,{exportMeta:o}=s,{columnLines:l}=o;if(l){const c=a.features.columnLines.getColumnLinesDOMConfig(i,n),d=document.createElement("div");q.sync({targetElement:d,domConfig:{children:c},onlyChildren:!0}),l.lines.set(0,d.innerHTML)}}renderRanges(t,i,n){const s=this,{client:a}=t,{exportMeta:o}=s,{timeRanges:l}=o;if(l){const c=a.features.timeRanges.getDOMConfig(i,n),d=document.createElement("div");c.forEach((u,h)=>{q.sync({targetElement:d,domConfig:{children:u,onlyChildren:!0}}),h===0?l.body=d.innerHTML:l.header=d.innerHTML})}}buildPageHtml(t){const i=this,{subGrids:n,timeAxisHeaders:s,timeAxisPlaceholders:a,columnLines:o,columnLinesPlaceholder:l,timeRanges:c,timeRangesHeaderPlaceholder:d,timeRangesBodyPlaceholder:u}=i.exportMeta,{enableDirectRendering:h}=t;let f=i.prepareExportElement();if(Object.values(n).forEach(({placeHolder:g,eventsPlaceholder:m,rows:p,mergedCellsHtml:v})=>{const y=g.outerHTML,{resources:S,events:D}=i.positionRows(p,t);let w=S.join("");v!=null&&v.length&&(w+=`<div class="b-grid-merged-cells-container">${v.join("")}</div>`),f=f.replace(y,w),m&&(f=f.replace(m.outerHTML,D.join("")))}),s.forEach((g,m)=>{f=f.replace(a[m].outerHTML,Array.from(g.values()).join(""))}),o){const g=Array.from(o.lines.values()).concat(Array.from(o.majorLines.values()));f=f.replace(l.outerHTML,g.join("")),h&&(i.exportMeta.columnLines.lines.clear(),i.exportMeta.columnLines.majorLines.clear())}return c&&(h?(f=f.replace(u.outerHTML,c.body),d&&(f=f.replace(d.outerHTML,c.header)),i.exportMeta.timeRanges={}):(f=f.replace(u.outerHTML,Object.values(c.body).join("")),d&&(f=f.replace(d.outerHTML,Object.values(c.body).join(""))))),f=i.buildDependenciesHtml(f),f}getEventBox(t){const i=this,{eventsBoxes:n,enableDirectRendering:s}=i.exportMeta,a=t&&n.get(String(t.id));return s&&a&&t.isMilestone&&a.translate(-a.width/2,0),a}renderDependencies(){const t=this,{client:i,eventsBoxes:n}=t.exportMeta,{dependencies:s}=i,a=i.features.dependencies,o=C.createElement();let l=!1;return s.forEach(c=>{if(!n.has(String(c.from))&&!n.has(String(c.to))||!a.isDependencyVisible(c))return;const d=t.getEventBox(c.fromEvent),u=t.getEventBox(c.toEvent);a.drawDependency(c,!0,{from:d==null?void 0:d.clone(),to:u==null?void 0:u.clone()}),l=!0}),l&&a.domSync(o),o.innerHTML}buildDependenciesHtml(t){const{dependenciesPlaceholder:i,includeTimeline:n}=this.exportMeta;if(i&&n){const s=i.outerHTML;t=t.replace(s,this.renderDependencies())}return t}},rm=class extends tm(Ds){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const r=[],t=[];return e.forEach(([i,n,s,a])=>{r.push(i),a&&Array.from(a.entries()).forEach(([o,[l,c,d=[]]])=>{t.push(l+d.join("")),this.exportMeta.eventsBoxes.set(String(o),c)})}),{resources:r,events:t}}};rm._$name="MultiPageExporter";var im=class extends tm(Es){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==Di.completeview&&this.estimateTotalPages(e)}positionRows(e){const r=[],t=[];return e.forEach(([i,,,n])=>{r.push(i),n&&Array.from(n.entries()).forEach(([s,[a,o,l=[]]])=>{t.push(a+l.join("")),this.exportMeta.eventsBoxes.set(String(s),o)})}),{resources:r,events:t}}};im._$name="MultiPageVerticalExporter";var nm=class extends qe{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems(){return Object.entries(Di).map(([e,r])=>({value:e,text:"L{"+r+"}"}))}}}};nm.initClass(),nm._$name="ScheduleRangeCombo";var sm=class extends Eo{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",value:"completeview",weight:150,onChange({value:e}){this.parent.widgetMap.rangesContainer.hidden=e!==Di.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget"},rangeStartField:{type:"datefield",label:"L{Export from}",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:e}){this.parent.widgetMap.rangeEndField.min=b.add(e,1,"d")}},filler2:{type:"widget",weight:20,width:"0.5em"},rangeEndField:{type:"datefield",label:"L{Export to}",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:e}){this.parent.widgetMap.rangeStartField.max=b.add(e,-1,"d")}}}}}}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach(r=>{r instanceof $e?r.labelWidth=e:r.ref==="rangesContainer"&&(r.items[0].width=e)})}applyInitialValues(e){super.applyInitialValues(e);const r=this,{client:t,scheduleRange:i}=e,n=e.items=e.items||{},s=n.scheduleRangeField=n.scheduleRangeField||{},a=n.rangesContainer=n.rangesContainer||{},o=a.items=a.items||{},l=o.filler=o.filler||{},c=o.rangeStartField=o.rangeStartField||{},d=o.rangeEndField=o.rangeEndField||{};l.width=r.L("labelWidth"),s.value=s.value||i,s.value===Di.daterange&&(a.hidden=!1);const u=c.value=c.value||t.startDate;c.max=b.max(t.startDate,b.add(t.endDate,-1,"d"));let h=d.value||t.endDate;h<=u&&(h=b.add(u,1,"d")),d.value=h,d.min=b.min(t.endDate,b.add(t.startDate,1,"d"))}};sm._$name="SchedulerExportDialog";var am=class extends tm(xo){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(e,r){const t=[],i=[],n=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,s=/top:.+?px/;if(r.enableDirectRendering)e.forEach(([a,,,o])=>{t.push(a),o&&Array.from(o.entries()).forEach(([l,[c,d,u=[]]])=>{this.exportMeta.eventsBoxes.set(String(l),d),i.push(c+u.join(""))})});else{let a=0;e.forEach(([o,l,c,d])=>{t.push(o.replace(n,`translate($1px, ${a}px)`));const u=a-l;d&&Array.from(d.entries()).forEach(([h,[f,g]])=>{g.translate(0,u),this.exportMeta.eventsBoxes.set(String(h),g),i.push(f.replace(s,`top: ${g.y}px`))}),a+=c})}return{resources:t,events:i}}};am._$name="SinglePageExporter";var om=class extends Wc{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[am,rm,im],dialogClass:sm,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return T.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:r,rangeStart:t,rangeEnd:i}=this;return e.columns&&!e.columns.find(n=>n.type==="timeAxis")&&e.columns.push(e.client.timeAxisColumn.id),T.assign({scheduleRange:r,rangeStart:t,rangeEnd:i},e)}};om._$name="PdfExport",z.registerFeature(om,!1,"Scheduler");var lm=class extends Ae(){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const r=this;r.unitToPixelsCache={},super.construct(e);const t=r.timeAxis.viewPreset||r.viewPreset;if(t)if(t instanceof Si)r.consumeViewPreset(t);else{const i=$s.getPreset(t);i&&r.consumeViewPreset(i)}r.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:r}),r.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(e,r,t=this.viewPreset){const{timeAxis:i,availableSpace:n}=this,{bufferCoef:s}=this.owner,{leafUnit:a,leafIncrement:o,topUnit:l,topIncrement:c,tickSize:d}=t,u=a===l&&Math.round(c)===c&&Math.round(o)===o,h=u?c:o,f=u?l:a;if(r){const g=Math.ceil((n*s+n/2)/d);return{startDate:i.floorDate(b.add(e,-g*o,a),!1,f,h),endDate:i.ceilDate(b.add(e,g*o,a),!1,f,h)}}else{const g=Math.ceil(n*s/d);return{startDate:i.floorDate(b.add(e,-g*o,a),!1,f,h),endDate:i.ceilDate(b.add(e,Math.ceil((n/d+g)*o),a),!1,f,h)}}}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return this.mode!=="vertical"}get isVertical(){return this.mode==="vertical"}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:r}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),!r&&e.count>0&&this.update()}update(e,r=!1,t=!1){const i=this,{timeAxis:n,headers:s}=i,a=e!==0;if(i.isConfiguring||a&&i._availableSpace===e){t&&i.trigger("update");return}if(i._availableSpace=Math.max(e||i.availableSpace||0,0),typeof i.availableSpace!="number")throw new Error("Invalid available space provided to TimeAxisModel");i.columnConfig=[];const o=i._tickSize=i.calculateTickSize(i.originalTickSize);if(typeof o!="number"||o<=0)throw new Error("Invalid timeAxis tick size");i.unitToPixelsCache={},i._totalSize=null;for(let l=0,{length:c}=s;l<c;l++){const d=s[l];if(d.cellGenerator){const u=d.cellGenerator.call(i,n.startDate,n.endDate);i.columnConfig[l]=i.createHeaderRow(l,d,u)}else i.columnConfig[l]=i.createHeaderRow(l,d)}r||i.trigger("update")}getDistanceBetweenDates(e,r){return this.getPositionFromDate(r)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,r={}){const t=this.getScaledTick(e,r);return t===-1?-1:this.tickSize*(t-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:r,snapToNextIncluded:t,isEnd:i,min:n,max:s}){const{timeAxis:a}=this,{include:o,unit:l}=a;let c=a.getTickFromDate(e);if(c!==-1&&r&&o){let d=!1;if(o.hour&&b.compareUnits(l,"hour")>0&&l!=="day"){const{from:u,to:h,lengthFactor:f,center:g}=o.hour,m=e.getHours(),p=Math.min(Math.max(m,u),h);if(!t&&p!==m)return-1;const v=p+e.getMinutes()/60,y=g-v,S=g-y*f;e=b.add(e,S-m,"h"),d=!0}if(o.day&&b.compareUnits(l,"day")>0){const{from:u,to:h,lengthFactor:f,center:g}=o.day;let m=e.getDay();i&&e.getHours()===0&&e.getMinutes()===0&&e.getSeconds()===0&&e.getMilliseconds()===0&&--m<0&&(m=6);let p=0;if(m<u||m>=h)if(t){if(i?p=(h-m-8)%7:p=(u-m+7)%7,e=b.add(e,p,"d"),e=b.startOf(e,"d",!1),s&&e.getTime()>=s||n&&e.getTime()<=n)return-1}else return-1;const{weekStartDay:v}=a,y=e.getDay()===0?0:g,S=e.getDay()+e.getHours()/24,D=y-S,w=y-D*f;e=b.add(e,w-S+v,"d"),d=!0}d&&(e=b.constrain(e,a.startDate,a.endDate),c=a.getTickFromDate(e))}return c}getDateFromPosition(e,r,t=!1){const i=this,{timeAxis:n}=i,s=i.getScaledPosition(e)/i.tickSize+n.visibleTickStart;if(s<0||s>n.count){if(t){let a;return s<0?a=b.add(n.startDate,s,n.unit):a=b.add(n.endDate,s-n.count,n.unit),r&&(a=n[r+"Date"](a)),a}return null}return n.getDateFromTick(s,r)}getScaledPosition(e){const{include:r,unit:t,weekStartDay:i}=this.timeAxis;if(r){const n=this.getSingleUnitInPixels("day");if(r.day&&b.compareUnits(t,"day")>0){const{from:s,lengthFactor:a}=r.day,o=e%(n*7),l=e-o;e=o/a+(s-i)*n+l}if(r.hour&&b.compareUnits(t,"hour")>0&&t!=="day"){const{from:s,lengthFactorExcl:a}=r.hour,o=this.getSingleUnitInPixels("hour"),l=e%n,c=e-l;e=l/a+s*o+c}}return e}getSingleUnitInPixels(e){const r=this;return r.unitToPixelsCache[e]||(r.unitToPixelsCache[e]=b.getUnitToBaseUnitRatio(r.timeAxis.unit,e,!0)*r.tickSize/r.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,r){this._tickSize=this.originalTickSize=e,this.update(void 0,r)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const r=this,{forceFit:t,timeAxis:i,suppressFit:n}=r,s=i.unit;let a=0,o=1;if(r.snap){const l=i.resolution;o=b.getUnitToBaseUnitRatio(s,l.unit)*l.increment}if(n)a=e;else{const l=r.availableSpace/i.visibleTickTimeSpan;a=t||e<l?l:e,o>0&&(!t||o<1)&&(a=Math.max(1,o*a)/o)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const r=this;if(r._availableSpace=Math.max(0,e),r._availableSpace>0){const t=r.calculateTickSize(r.originalTickSize);t>0&&t!==r.tickSize&&r.update()}}getDates(e=this.columnLinesFor,r=!1,t=!1){const i=this,n=[],s=r?i.lowestHeader:e,a=i.majorHeaderLevel,o=i.headers&&i.headers[e].unit,l=a!=null&&i.headers&&i.headers[a].unit,c=a!=null&&b.doesUnitsAlign(l,o);if(!!(i.headers&&i.headers[s].cellGenerator)){const u=i.columnConfig[s];for(let h=1,f=u.length;h<f;h++)n.push({date:u[h].startDate})}else i.forEachInterval(s,(u,h)=>{n.push({date:t?h:u,isMajor:a!==e&&c&&i.isMajorTick(t?h:u)})});return n}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const r=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(r,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,r,t){const i=this,n=[],{align:s,headerCellCls:a=""}=r,o=b.clearTime(new Date),{timeAxis:l}=i,c=i.headers.length-1,d=(h,f,g,m,p)=>{let v=b.format(h,r.dateFormat);const y=g>0&&!m,S={align:s,start:h,end:f,value:p?p.header:v,headerCellCls:a,width:c===e&&i.owner&&(l.fullTicks||y)?i.owner.tickSize:i.getDistanceBetweenDates(h,f),index:g};S.width!==0&&(S.coord=u-1,u+=S.width,i.headersDatesCache[e][h.getTime()]=1,r.renderer&&(v=r.renderer.call(r.thisObj||i,h,f,S,g),S.value=v==null?"":v),r.unit==="day"&&(!r.increment||r.increment===1)&&(S.headerCellCls+=" b-sch-dayheadercell-"+h.getDay(),b.clearTime(h,!0)-o===0&&(S.headerCellCls+=" b-sch-dayheadercell-today")),n.push(S))};let u=0;return i.headersDatesCache[e]={},t?t.forEach((h,f)=>d(h.start,h.end,f,f===t.length-1,h)):i.forEachInterval(e,d),n}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const r=this.majorHeaderLevel;return r!=null&&this.headersDatesCache[r]&&this.headersDatesCache[r][e.getTime()]||!1}forEachInterval(e,r,t=this){const{headers:i,timeAxis:n}=this;if(i)if(e===i.length-1)n.forEach((s,a)=>r.call(t,s.startDate,s.endDate,a,a===n.count-1));else{const s=i[e];n.forEachAuxInterval(s.unit,s.increment,r,t)}}forEachMainInterval(e,r){this.forEachInterval(this.mainHeaderLevel,e,r)}consumeViewPreset(e){const r=this;r.headers=null,r.getConfig("tickSize"),r.viewPreset=e,Object.assign(r,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:r.isHorizontal?e.tickWidth:e.tickHeight}),r.originalTickSize=r.tickSize}};lm._$name="TimeAxisViewModel";var zw=new Date,Ww=e=>{var r;return r=class extends(e||F){getRtlX(t){return this.rtl&&this.isHorizontal&&(t=this.timeAxisViewModel.totalSize-t),t}getDateFromCoordinate(t,i,n=!0,s=!1,a=!1){return n||(t=this.currentOrientation.translateToScheduleCoordinate(t)),a||(t=this.getRtlX(t)),this.timeAxisViewModel.getDateFromPosition(t,i,s)}getDateFromCoord(t){return this.getDateFromCoordinate(t.coord,t.roundingMethod,t.local,t.allowOutOfRange,t.ignoreRTL)}getDateFromXY(t,i,n=!0,s=!1){return this.currentOrientation.getDateFromXY(t,i,n,s)}getDateFromDomEvent(t,i,n=!1){return this.getDateFromXY([t.pageX,t.pageY],i,!1,n)}getStartEndDatesFromRectangle(t,i,n,s=!1){const a=this,{isHorizontal:o}=a,l=o?t.x:t.top,c=o?t.right:t.bottom;let d,u;return l>=0&&c<a.timeAxisViewModel.totalSize?(d=a.getDateFromCoordinate(l,i,!0),u=a.getDateFromCoordinate(c,i,!0)):l<0?(u=a.getDateFromCoordinate(c,i,!0,s),d=u&&b.add(u,-n,"ms")):(d=a.getDateFromCoordinate(l,i,!0,s),u=d&&b.add(d,n,"ms")),{start:d,end:u}}getDisplayEndDate(t,i){return t.getHours()===0&&t.getMinutes()===0&&(!i||!(t.getYear()===i.getYear()&&t.getMonth()===i.getMonth()&&t.getDate()===i.getDate()))&&!b.formatContainsHourInfo(this.displayDateFormat)&&(t=b.add(t,-1,"day")),t}getFormattedEndDate(t,i){return this.getFormattedDate(this.getDisplayEndDate(t,i))}getCoordinateFromDate(t,i=!0){const n=this,{timeAxisViewModel:s}=n,{isContinuous:a,startMS:o,endMS:l,startDate:c,endDate:d,unit:u}=n.timeAxis,h=t.valueOf();i===!0?i={local:!0}:i?"local"in i||(i.local=!0):i={local:!1};let f;if(t instanceof Date||(zw.setTime(t),t=zw),a&&t.getTimezoneOffset()===c.getTimezoneOffset()&&c.getTimezoneOffset()===d.getTimezoneOffset()&&b.getUnitToBaseUnitRatio(u,"day")!==-1){if(h<o||h>l)return-1;f=(h-o)/(l-o)*s.totalSize}else f=s.getPositionFromDate(t,i);return n.rtl&&n.isHorizontal&&(f=s.totalSize-f),i.local||(f=n.currentOrientation.translateToPageCoordinate(f)),f}getTimeSpanDistance(t,i){return this.timeAxisViewModel.getDistanceBetweenDates(t,i)}get viewportCenterDate(){const{timeAxis:t,timelineScroller:i}=this;if(t.isContinuous){const n=(i.position+i.clientSize/2)/i.scrollSize;return new Date(t.startMS+(t.endMS-t.startMS)*n)}return this.getDateFromCoordinate(i.position+i.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(t){this.timeAxis.resolution=typeof t=="number"?{increment:t,unit:this.timeAxis.resolution.unit}:t}get snap(){var t,i;return(i=(t=this._timeAxisViewModel)==null?void 0:t.snap)!=null?i:this._snap}updateSnap(t){this.isConfiguring||(this.timeAxisViewModel.snap=t,this.timeAxis.forceFullTicks=t&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:t,scrollLeft:i,scrollX:n}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},R(r,"$name","TimelineDateMapper"),R(r,"configurable",{snap:!1}),r},{eventNameMap:wA}=j,Uw=e=>{var r;return r=class extends(e||F){constructor(){super(...arguments),R(this,"hoveredEvents",new Set)}initDomEvents(){const t=this,{schedulerEvents:i,schedulerEnterLeaveEvents:n}=t;i.element=n.element=t.timeAxisSubGridElement,i.thisObj=n.thisObj=t,j.on(i),j.on(n),Y.supportsPointerEventConstructor&&j.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:t})}getTimeSpanMouseEventParams(t,i){throw new Error("Implement in subclass")}getScheduleMouseEventParams(t,i){throw new Error("Implement in subclass")}handleScheduleEvent(t){const i=this,n=i.getTimelineEventContext(t);i.lastPointerEvent=t,n&&i.trigger(`${n.eventElement?i.scheduledEventName:"schedule"}${wA[t.type]||L.capitalize(t.type)}`,n),i.timelineContext=n}handleScheduleEnterLeaveEvent(t){t.target.parentElement===this.foregroundCanvas&&this.handleScheduleEvent(t)}onScheduleScroll({target:t}){var i,n,s,a,o;const l=this;if(t&&l.updateTimelineContextOnScroll&&!((i=l.features.pan)!=null&&i.isActive)&&!l.partners.some(c=>{var d;return(d=c.features.pan)==null?void 0:d.isActive})&&(t.contains(l.element)||l.bodyElement.contains(t))){const{timelineContext:c,lastPointerEvent:d}=l;if(c){const u=C.elementFromPoint(c.domEvent.clientX,c.domEvent.clientY),h=new Y.PointerEventConstructor("pointermove",d),f=new MouseEvent("mousemove",d);Object.defineProperty(h,"pointerId",{value:(o=(a=(n=he.currentPointerDown)==null?void 0:n.pointerId)!=null?a:(s=he.currentTouch)==null?void 0:s.identifier)!=null?o:1}),h.scrollInitiated=f.scrollInitiated=!0,u==null||u.dispatchEvent(h),u==null||u.dispatchEvent(f)}}}updateTimelineContext(t,i){this.trigger("timelineContextChange",{oldContext:i,context:t}),t||this.trigger("scheduleMouseLeave")}getTimelineEventContext(t){const i=this,n=t.target.closest(i.eventInnerSelector),s=i.getCellElementFromDomEvent(t);if(s){const a=i.getDateFromDomEvent(t,"floor");if(!a)return;const o=ze.get(s),l=n?i.getTimeSpanMouseEventParams(n,t):i.getScheduleMouseEventParams(o,t);if(!l)return;const c=i.isVertical?i.resourceStore.indexOf(l.resourceRecord):o.row.dataIndex,d=i.timeAxis.getTickFromDate(a),u=i.timeAxis.getAt(Math.floor(d));if(u)return{isTimelineContext:!0,domEvent:t,eventElement:n,cellElement:s,index:c,tick:u,tickIndex:d,date:a,tickStartDate:u.startDate,tickEndDate:u.endDate,tickParentIndex:u.parentIndex,row:o.row,event:t,...l}}}getCellElementFromDomEvent({target:t,clientY:i,type:n}){var s;const a=this,{isVertical:o,foregroundCanvas:l}=a,c=t.closest(a.eventSelector);if(c)return a.getCell({[o?"row":"record"]:o?0:a.resolveRowRecord(c),column:a.timeAxisColumn});if(l.contains(t)){if(t===l||n==="mousemove")return(s=a.rowManager.getRowAt(i,!1))==null?void 0:s.getCell(a.timeAxisColumn.id)}else return t.matches(".b-grid-row")?t.firstElementChild:t.closest(a.timeCellSelector)}matchScheduleCell(t){return t.closest(this.timeCellSelector)}onElementMouseButtonEvent(t){const i=t.target.closest(".b-sch-header-timeaxis-cell");if(i){const n=this,s=i.parentElement.dataset.headerPosition,a=n.timeAxisViewModel.columnConfig[s],o=n.timeAxis.isFiltered?a.findIndex(d=>d.index==i.dataset.tickIndex):i.dataset.tickIndex,l=a[o],c=n.features.contextMenu;(!c||t.type!==c.triggerEvent)&&this.trigger(`timeAxisHeader${L.capitalize(t.type)}`,{startDate:l.start,endDate:l.end,event:t})}}onElementMouseDown(t){this.onElementMouseButtonEvent(t),super.onElementMouseDown(t)}onElementClick(t){this.onElementMouseButtonEvent(t),super.onElementClick(t)}onElementDblClick(t){this.onElementMouseButtonEvent(t),super.onElementDblClick(t)}onElementContextMenu(t){this.onElementMouseButtonEvent(t),super.onElementContextMenu(t)}onElementMouseOver(t){var i;super.onElementMouseOver(t);const n=this,{target:s}=t,{hoveredEvents:a}=n;if(s.closest(n.eventInnerSelector)&&!((i=n.features.eventDrag)!=null&&i.isDragging)){const o=s.closest(n.eventSelector);if(!a.has(o)&&!n.preventOverCls){a.add(o),o.classList.add(n.overScheduledEventClass);const l=n.getTimeSpanMouseEventParams(o,t);l&&n.trigger(`${n.scheduledEventName}MouseEnter`,l)}}else a.size&&n.unhoverAll(t)}onElementMouseOut(t){var i;super.onElementMouseOut(t);const n=this,{target:s,relatedTarget:a}=t,o=s.closest(n.eventInnerSelector),l=s.closest(n.eventSelector),c=n.resolveTimeSpanRecord(s);if(o&&c&&n.hoveredEvents.has(l)&&!((i=n.features.eventDrag)!=null&&i.isDragging)){if(a&&C.isDescendant(o,a))return;n.unhover(l,t)}}unhover(t,i){const n=this;t.classList.remove(n.overScheduledEventClass),n.trigger(`${n.scheduledEventName}MouseLeave`,n.getTimeSpanMouseEventParams(t,i)),n.hoveredEvents.delete(t)}unhoverAll(t){for(const i of this.hoveredEvents)!i.isReleased&&!i.classList.contains("b-released")&&this.unhover(i,t);this.hoveredEvents.clear()}get widgetClass(){}},R(r,"$name","TimelineDomEvents"),R(r,"configurable",{timelineContext:{$config:{equal(t,i){return(t==null?void 0:t.index)===(i==null?void 0:i.index)&&(t==null?void 0:t.tickParentIndex)===(i==null?void 0:i.tickParentIndex)&&!(((t==null?void 0:t.tickStartDate)||0)-((i==null?void 0:i.tickStartDate)||0))}}},updateTimelineContextOnScroll:!0}),R(r,"properties",{schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"},schedulerEnterLeaveEvents:{mouseenter:"handleScheduleEnterLeaveEvent",mouseleave:"handleScheduleEnterLeaveEvent",capture:!0}}),R(r,"delayable",{onScheduleScroll:"raf"}),r},qo=(e=0,r=0)=>r-e,Gw=e=>class extends(e||F){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(t){const i={owner:this};let n=[];if(t===!0)n=$s.allRecords;else if(Array.isArray(t))for(const a of t)if(typeof a=="string"){const o=$s.getById(a);o&&n.push(o)}else n.push(a);else T.assign(i,t);const s=new Sd(i);return s.add(n),s}changeViewPreset(t,i){const n=this,{presets:s}=n;t?(t=s.createRecord(t),s.includes(t)||s.add(t)):t=s.first;const a=n.lastViewPresetOptions||{},o=t.options||(t.options={}),l=o.event={startDate:o.startDate,endDate:o.endDate,from:i,to:t,preset:t},c=!n._viewPreset||!n._viewPreset.equals(t),d=qo(o.startDate,a.startDate)||qo(o.endDate,a.endDate)||qo(o.centerDate,a.centerDate)||o.startDate&&qo(o.startDate,n.startDate)||o.endDate&&qo(o.endDate,n.endDate);if((c||d)&&(c||(n._viewPreset=null),n.isConfiguring||n.trigger("beforePresetChange",l)!==!1))return t}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(t){this.trigger("displayDateFormatChange",{format:t})}getFormattedDate(t){return b.format(t,this.displayDateFormat)}updateViewPreset(t){const i=this,{options:n}=t,{event:s,startDate:a,endDate:o}=n,{isHorizontal:l,_timeAxis:c,_timeAxisViewModel:d}=i,u=l&&i.rtl;let{centerDate:h,zoomDate:f,zoomPosition:g}=n,m=!1;if(delete t.options,i._viewPresetChanging=!0,c&&!i.isConfiguring){const{timelineScroller:p}=i;if(i.lastViewPresetOptions=n,c.isConfigured){i.suspendRefresh();const v=T.copyProperties({},i,["weekStartDay","startTime","endTime"]);i.infiniteScroll?Object.assign(v,d.calculateInfiniteScrollingDateRange(h||new Date((a.getTime()+o.getTime())/2),!0,t)):a?(v.startDate=a,v.endDate=o,!h&&o&&(h=new Date((a.getTime()+o.getTime())/2))):(v.startDate=c.startDate,v.endDate=o||c.endDate,h||(h=i.viewportCenterDate)),c.isConfigured=!1,v.viewPreset=t,c.reconfigure(v,!0),d.reconfigure({viewPreset:t,headers:t.headers,columnLinesFor:t.columnLinesFor!=null?t.columnLinesFor:t.headers.length-1,tickSize:l?t.tickWidth:t.tickHeight||t.tickWidth||60}),i.resumeRefresh(!1)}if(i.refresh(),!n.notScroll&&i.isPainted)if(n.visibleDate)i.visibleDate=n.visibleDate;else if(f&&g){const v=Kt[c.resolutionUnit],y=v>3?"hour":"minute",S=b.asMilliseconds(y==="minute"?15:1,y),D=new Date(Math.round(f/S)*S);s.zoomDate=f,s.zoomPosition=g,s.zoomLevel=n.zoomLevel,u?p.position=p.scrollWidth-(i.getCoordinateFromDate(D)+g):p.position=i.getCoordinateFromDate(D)-g}else if(h){i.cachedCenterDate=h,s.centerDate=h;const v=i.timelineScroller.clientSize,y=u?i.timeAxisViewModel.totalSize-i.getCoordinateFromDate(h,!0):i.getCoordinateFromDate(h,!0),S=Math.max(y-v/2,0);i.scrollingToCenter=!0,S===(i.isHorizontal?i.scrollLeft:i.scrollTop)?m=!0:i.isHorizontal?i.scrollHorizontallyTo(S,!1):i.scrollVerticallyTo(S,!1),i.setTimeout(()=>{i.scrollingToCenter=!1},100)}else(i.isHorizontal?i.scrollLeft:i.scrollTop)===0?m=!0:i.timelineScroller.scrollTo(0)}i.dataset.presetId=t.id,i.trigger("presetChange",s),i._viewPresetChanging=!1,m&&(i.isHorizontal?i.currentOrientation.updateFromHorizontalScroll(i.scrollLeft,i.scrollX):i.currentOrientation.updateFromVerticalScroll(i.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(t){const i=super.getCurrentConfig(t);return i.viewPreset&&i.viewPreset.name&&!i.viewPreset.base&&delete i.viewPreset.name,i}get widgetClass(){}},Yw=e=>{var r;return r=class extends(e||F){constructor(){super(...arguments),R(this,"lastWheelTime",-1),R(this,"lastZoomPosition",-1)}construct(t){const i=this;super.construct(t),i.zoomOnMouseWheel&&j.on({element:i.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:n=>n.ctrlKey&&n.preventDefault()},thisObj:i,capture:!0,passive:!1}),i.zoomOnTimeAxisDoubleClick&&i.ion({timeaxisheaderdblclick:({startDate:n,endDate:s})=>{i.forceFit||i.zoomToSpan({startDate:n,endDate:s})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(t){if(typeof t!="number"&&(t=this.presets.count-1),t<0||t>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=t}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(t){if(typeof t!="number"&&(t=0),t<0||t>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=t}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(t){this.zoomToLevel(t)}getMilliSecondsPerPixelForZoomLevel(t,i){const{bottomHeader:n}=t,s=this.isHorizontal?t.tickWidth:t.tickHeight;return Math.round((b.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(i?s:t.actualWidth||s))}zoomTo(t){const i=this;typeof t=="object"?t.preset?i.zoomToLevel(t.preset,t):t.level!=null?i.zoomToLevel(t.level,t):i.zoomToSpan(t):i.zoomToLevel(t)}zoomToLevel(t,i={}){if(this.forceFit){console.warn("Warning: The forceFit setting and zooming cannot be combined");return}typeof t=="number"&&(t=Math.min(Math.max(t,this.minZoomLevel),this.maxZoomLevel));const n=this,{presets:s}=n,a=n.isVertical?"tickHeight":"tickWidth",o=s.createRecord(t),l=o[a],c=i.startDate?new Date(i.startDate):null,d=i.endDate?new Date(i.endDate):null;s.add(o);let u=c&&d?{startDate:c,endDate:d}:null;const h=i.centerDate?new Date(i.centerDate):u?new Date((c.getTime()+d.getTime())/2):n.viewportCenterDateCached;let f=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width;if(f===0){const{_beforeCollapseState:g}=n.timeAxisSubGrid;if(n.isHorizontal&&n.timeAxisSubGrid.collapsed&&(g!=null&&g.width))f=g.width;else return null}return u||(u=n.calculateOptimalDateRange(h,f,o)),"width"in i&&o.setData(a,i.width),n.isZooming=!0,o.options={...i,startDate:u.startDate||n.startDate,endDate:u.endDate||n.endDate,centerDate:h},n.viewPreset=o,o.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,o.setData(a,l),n.zoomLevel}zoomToFit(t){const i=this.eventStore,n=i.getTotalTimeSpan();t={leftMargin:0,rightMargin:0,...t,...n},t.startDate&&t.endDate&&(t.endDate>t.startDate?this.zoomToSpan(t):this.scrollToDate(t.startDate))}zoomToSpan(t={}){if((t.leftMargin||t.rightMargin)&&(t.adjustStart=0,t.adjustEnd=0),t.leftMargin||(t.leftMargin=0),t.rightMargin||(t.rightMargin=0),!t.startDate||!t.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const i=this,{timeAxis:n}=i,s=t.adjustStart>=0||t.adjustEnd>=0;let{startDate:a,endDate:o}=t;if(s&&(a=b.add(a,-t.adjustStart,n.mainUnit),o=b.add(o,t.adjustEnd,n.mainUnit)),a<=o){const{availableSpace:l}=i.timeAxisViewModel,c=i.presets.allRecords,d=o-a||1;let u=i.zoomLevel,h,f;u===-1&&(u=0);let g=i.getMilliSecondsPerPixelForZoomLevel(c[u],!0),m=u+(h=d/g+t.leftMargin+t.rightMargin>l?-1:1),p,v=null;for(;m>=0&&m<=c.length-1;){p=c[m],g=i.getMilliSecondsPerPixelForZoomLevel(p,!0);const x=d/g+t.leftMargin+t.rightMargin;if(h===-1){if(x<=l){v=m;break}}else if(x<=l)u!==m-h&&(v=m);else break;m+=h}v=v!=null?v:m-h,p=c[v];const y=p.bottomHeader.unit;g=i.getMilliSecondsPerPixelForZoomLevel(p,!0),(t.leftMargin||t.rightMargin)&&(a=new Date(a.getTime()-g*t.leftMargin),o=new Date(o.getTime()+g*t.rightMargin));const S=b.getDurationInUnit(a,o,y,!0)/p.bottomHeader.increment;if(S===0)return null;const D=Math.floor(l/S),w=t.centerDate||new Date((a.getTime()+o.getTime())/2);s?f={startDate:a,endDate:o}:f=i.calculateOptimalDateRange(w,l,p);let E=i.zoomLevel;return i.zoomLevel===v?n.reconfigure(f):E=i.zoomToLevel(v,Object.assign(f,{width:D,centerDate:w})),i.infiniteScroll&&i.scrollToDate(a,{block:"start"}),E}return null}zoomIn(t=1,i){typeof t=="object"&&(i=t,t=1);const n=this.zoomLevel;return n>=this.maxZoomLevel?null:this.zoomToLevel(n+t,i)}zoomOut(t=1,i){typeof t=="object"&&(i=t,t=1);const n=this.zoomLevel;return n<=this.minZoomLevel?null:this.zoomToLevel(n-t,i)}zoomInFull(t){return this.zoomToLevel(this.maxZoomLevel,t)}zoomOutFull(t){return this.zoomToLevel(this.minZoomLevel,t)}calculateOptimalDateRange(t,i,n,s){if(s)return s;const a=this,{timeAxis:o}=a,{bottomHeader:l}=n,c=a.isHorizontal?n.tickWidth:n.tickHeight;if(a.zoomKeepsOriginalTimespan)return{startDate:o.startDate,endDate:o.endDate};const d=l.unit,u=Math.ceil(i/c*l.increment*a.visibleZoomFactor/2),h=b.add(t,-u,d),f=b.add(t,u,d);return a.infiniteScroll?a.timeAxisViewModel.calculateInfiniteScrollingDateRange(t,!0):{startDate:o.floorDate(h,!1,d,l.increment),endDate:o.ceilDate(f,!1,d,l.increment)}}onElementMouseMove(t){const{isHorizontal:i,zoomContext:n}=this;super.onElementMouseMove(t),t.isTrusted&&n&&Math.abs(t[`client${i?"X":"Y"}`]-n.coordinate)>10&&(this.zoomContext=null)}async onWheel(t){if(t.ctrlKey&&!this.forceFit){t.preventDefault();const i=this,{zoomContext:n,isHorizontal:s,timelineScroller:a,zoomLevel:o}=i,l=performance.now(),c=t[`client${s?"X":"Y"}`];let d=c-a.viewport[`${s?"x":"y"}`];s&&i.rtl&&(d=a.viewport.width+a.viewport.x-c),l-i.lastWheelTime>200||!n||Math.abs(c-i.zoomContext.coordinate)>20?i.zoomContext={zoomLevel:o,coordinate:c,zoomPosition:d,zoomDate:i.getDateFromDomEvent(t)}:(o>n.zoomLevel&&(n.zoomDate=i.getDateFromDomEvent(t),n.zoomLevel=o),n.zoomPosition=d),i.lastWheelTime=l,i[`zoom${t.deltaY>0?"Out":"In"}`](void 0,i.zoomContext)}}setTimeSpan(t,i){this.timeAxis.setTimeSpan(t,i)}shift(t,i){this.timeAxis.shift(t,i)}shiftNext(t){this.timeAxis.shiftNext(t)}shiftPrevious(t){this.timeAxis.shiftPrevious(t)}get widgetClass(){}},R(r,"$name","TimelineZoomable"),R(r,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),r},qw=e=>{var r;return r=class extends(e||F){construct(t){super.construct(t),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(t,i){const n=this.constructor.reconfigure(i,t,"recurrenceconfirmation");return n.owner=this,n}findRecurringEventToConfirmDelete(t){return t.find(i=>i.supportsRecurring&&(i.isRecurring||i.isOccurrence))}onRecurrableAssignmentBeforeDelete({assignmentRecords:t,context:i}){const n=t.map(a=>a.event),s=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&s)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:s,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecords:i}=t,n=i.filter(s=>s.supportsRecurring&&(s.isRecurring||s.isOccurrence));n.length&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecord:i}=t;i.supportsRecurring&&(i.isRecurring||i.isOccurrence)&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:i,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onAssignmentChange({action:t,records:i}){var n;if(t!=="dataset"&&Array.isArray(i))for(const s of i)(n=s.event)!=null&&n.isRecurring&&!s.event.isBatchUpdating&&s.event.removeOccurrences()}getOccurrencesFor(t){return this.eventStore.getOccurrencesForTimeSpan(t,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(t,i=null,n=this){const s=this;if(!s.readOnly&&t.length){const a={finalize(l=!0){i&&i(l),l!==!1&&(t.some(c=>{var d;return c.isOccurrence||((d=c.event)==null?void 0:d.isOccurrence)})?t.forEach(c=>c.isOccurrenceAssignment?c.event.remove():c.remove()):(t[0].isAssignment?s.assignmentStore:s.eventStore).remove(t))}};let o;if(t[0].isAssignment?o=s.trigger("beforeAssignmentDelete",{assignmentRecords:t,context:a}):o=s.trigger("beforeEventDelete",{eventRecords:t,context:a}),o!==!1){const l=t.find(c=>c.isRecurring||c.isOccurrence);return l?(s.recurrenceConfirmationPopup.owner=n,s.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:l,changerFn(){a.finalize(!0)},cancelFn(){a.finalize(!1)}})):a.finalize(!0),!0}}return!1}get widgetClass(){}},R(r,"$name","RecurringEvents"),R(r,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),r},Kw=e=>{var r;return r=class extends(e||F){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green",tickSize:null}}updateFillTicks(t){this.isConfiguring||(this.timeAxis.forceFullTicks=t&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(t){return T.assertNumber(t,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),t):t}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return this._resourceMargin==null?this.barMargin:this._resourceMargin}set resourceMargin(t){const i=this;T.assertNumber(t,"resourceMargin"),i.isHorizontal&&i.rowHeight&&(t=Math.min(Math.ceil(i.rowHeight/2),t)),i._resourceMargin!==t&&(i._resourceMargin=t,i.rendered&&(i.currentOrientation.onBeforeRowHeightChange(),i.refreshWithTransition()))}set tickSize(t){T.assertNumber(t,"tickSize"),this.timeAxisViewModel.tickSize=t}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}},R(r,"configurable",{barMargin:10,fillTicks:!1}),r},DA={maintainVisibleStart:!0},EA={block:"nearest"},Xw=e=>class extends(e||F){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const t=this,{isHorizontal:i,visibleDate:n}=t;super.initScroll();const{scrollable:s}=i?t.timeAxisSubGrid:t;if(s.ion({scroll:"onTimelineScroll",thisObj:t}),t.infiniteScroll){const a=n?{...n,visibleDate:n.date}:{visibleDate:t.viewportCenterDate,block:"center"},{startDate:o,endDate:l}=t.timeAxisViewModel.calculateInfiniteScrollingDateRange(a.visibleDate,a.block==="center");t.setTimeSpan(o,l,a)}}get timelineScroller(){const t=this;return t.scrollInitialized||t.initScroll(),t._timelineScroller||(t._timelineScroller=new xA({widget:t,scrollable:t.isHorizontal?t.timeAxisSubGrid.scrollable:t.scrollable,isHorizontal:t.isHorizontal}))}doDestroy(){var t;(t=this._timelineScroller)==null||t.destroy(),super.doDestroy()}onTimelineScroll({source:t}){this.infiniteScroll&&this.checkTimeAxisScroll(t[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(t){const i=this,n=i.timelineScroller,{clientSize:s}=n,a=s*i.bufferCoef,o=a*i.bufferThreshold,l=n.maxPosition,{style:c}=i.timeAxisSubGrid.virtualScrollerElement;(l-t<o||t<o)&&(c.overflow="hidden",c.pointerEvents="none",c.paddingBottom=`${C.scrollBarWidth}px`,i.setTimeout(()=>{c.overflow="",c.paddingBottom="",c.pointerEvents=""},100),i.shiftToDate(i.getDateFromCoordinate(t,null,!0,!1,!0)))}shiftToDate(t,i){const n=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(t,i);this.setTimeSpan(n.startDate,n.endDate,DA)}updateInfiniteScroll(t){!this.isConfiguring&&t&&this.checkTimeAxisScroll(this.timelineScroller.position)}async scrollToDate(t,i={}){const n=this,{timeAxis:s,visibleDateRange:a,infiniteScroll:o}=n,{unit:l,increment:c}=s,d=i.edgeOffset||0,u=b.ceil(a.endDate,c+" "+l)-b.floor(a.startDate,c+" "+l),h=t>n.viewportCenterDate?1:-1,f=(o?u*n.bufferCoef*n.bufferThreshold:i.block==="center"?u/2:d?n.getMilliSecondsPerPixelForZoomLevel(n.viewPreset)*d:0)*h,g=new Date(t.getTime()+f);(g>s.endDate?1:g<s.startDate?-1:0)&&n.infiniteScroll&&(n.shiftToDate(new Date(t-f),null,!0),await n.nextAnimationFrame());const p=n.timelineScroller.viewport,v=n.getCoordinateFromDate(t,!0),y=Math.min(n.timeAxisViewModel.tickSize,n.timeAxisViewModel.availableSpace),S=n.isHorizontal?new k(n.getCoordinateFromDate(t,!1)-(n.rtl?y:0),p.y,y,p.height):new k(p.x,n.getCoordinateFromDate(t,!1),p.width,n.timeAxisViewModel.tickSize);await n.scrollToCoordinate(v,S,t,i)}scrollToNow(t={}){return this.scrollToDate(new Date,t)}async scrollToCoordinate(t,i,n,s={}){const a=this;if(t<0){const o=a.endDate-a.startDate,{unit:l,increment:c}=a.timeAxis,d=b.floor(new Date(n.getTime()-o/2),c+" "+l),u=b.add(d,o);return d-a.startDate!==0&&u-a.endDate!==0?(a.setTimeSpan(d,u),a.scrollToDate(n,s)):void 0}return await a.timelineScroller.scrollIntoView(i,s),!a.isDestroyed&&a.nextAnimationFrame()}set scrollLeft(t){this.timeAxisSubGrid.scrollable.element.scrollLeft=t}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(t){this.timeAxisSubGrid.scrollable.x=t}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(t){this.scrollable.y=t}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(t,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,i)}scrollVerticallyTo(t,i=!0){return this.scrollable.scrollTo(null,t,i)}scrollTo(t,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,i)}get widgetClass(){}},xA=class extends or{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable[`client${this.isHorizontal?"Width":"Height"}`]}get scrollSize(){return this.scrollable[`scroll${this.isHorizontal?"Width":"Height"}`]}get maxPosition(){return this.scrollable[`max${this.isHorizontal?"X":"Y"}`]}scrollTo(e,r){return this.isHorizontal?this.scrollable.scrollTo(e,null,r):this.scrollable.scrollTo(null,e,r)}scrollBy(e=0,r=0,t=EA){return this.isHorizontal?this.scrollable.scrollBy(e||r,0,t):this.scrollable.scrollBy(0,r||e,t)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}},Zw=["barMargin"],Jw=e=>class extends(e||F){static get $name(){return"TimelineState"}getState(){const t=this,i=T.copyProperties(super.getState(),t,Zw);return i.zoomLevel=t.zoomLevel,i.zoomLevelOptions={startDate:t.startDate,endDate:t.endDate,centerDate:!t.infiniteScroll||t.timeAxisViewModel.availableSpace?t.viewportCenterDate:void 0,width:t.tickSize},i}applyState(t){var i;const n=this;n.suspendRefresh(),T.copyProperties(n,t,Zw),super.applyState(t),t.zoomLevel!=null&&(n.infiniteScroll&&(i=t==null?void 0:t.scroll)!=null&&i.scrollLeft&&(t.scroll.scrollLeft={}),n.isPainted?n.zoomToLevel(t.zoomLevel,t.zoomLevelOptions):n._zoomAfterPaint={zoomLevel:t.zoomLevel,zoomLevelOptions:t.zoomLevelOptions}),n.resumeRefresh(!0)}onPaint(...t){if(super.onPaint(...t),this._zoomAfterPaint){const{zoomLevel:i,zoomLevelOptions:n}=this._zoomAfterPaint;this.zoomToLevel(i,n),delete this._zoomAfterPaint}}get widgetClass(){}},Qw=class extends ln{static get $name(){return"SchedulerHeader"}refreshContent(){var e;(e=this.headersElement)!=null&&e.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}};Qw._$name="Header";var cm=class extends cn{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:Qw}}startConfigure(e){const{grid:r}=e;r.timeAxisSubGrid=this,super.startConfigure(e),r.isHorizontal&&(e.header={cls:{"b-sticky-headers":r.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,r=super.changeScrollable(...arguments);return r&&Object.defineProperty(r,"scrollWidth",{get(){var t,i;return(i=(t=this.element)==null?void 0:t.scrollWidth)!=null?i:0},set(){e.grid.updateCanvasSize()}}),r}syncScrollingPartners(e=!0){this.grid._viewPresetChanging||super.syncScrollingPartners(e)}onInternalResize(e,r,t,i,n){const s=this;if(s.isPainted&&r!==i){const a=s.grid,o=a._bodyRectangle.height;C.scrollBarWidth&&r<i&&(s.monitorResize=!1),a.onSchedulerViewportResize(r,o,i,o),s.monitorResize||s.requestAnimationFrame(()=>s.monitorResize=!0)}super.onInternalResize(...arguments)}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(){const{owner:e}=this;await super.expand(),e.isPainted&&e.timeAxisViewModel.update(this.width,!1,!0)}};cm.initClass(),cm._$name="TimeAxisSubGrid";var eD={fn:"exitTransition",delay:0,cancelOutstanding:!0},dm={},Ko=class extends xs.mixin(Ww,Uw,Kw,Xw,Jw,Gw,Yw,qw){constructor(){super(...arguments),R(this,"timeCellSelector",null)}static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit",viewportResizeTimeout:250,testConfig:{viewportResizeTimeout:50}}}updateTimeZone(e){this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e}get timeZone(){return this.project.timeZone}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const r=this,{_visibleDateRange:t}=r;(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&(r.timeView.range=e,r.handlingVisibleDateRangeChange=!0,r.trigger("visibleDateRangeChange",{old:t,new:e}),r.handlingVisibleDateRangeChange=!1,r._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const r=this;super.construct(e),r.$firstVerticalOverflow=!0,r.initDomEvents(),r.currentOrientation.init(),r.rowManager.ion({refresh:()=>{r.forceLayout=!1}})}createSubGrid(e,r={}){const t=this,{stickyHeaders:i}=t;return e===(t.schedulerRegion||"normal")?r.type="timeaxissubgrid":e==="locked"&&i&&t.isVertical&&(r.scrollable={overflowX:"visible",overflowY:"visible"},t.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,r)}doDestroy(){const e=this,{partneredWith:r,currentOrientation:t}=e;t==null||t.destroy(),r?(r.forEach(i=>{e.removePartner(i)}),r.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),Je.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return typeof e=="string"&&(e=b.parse(e)),e}onPaint({firstPaint:e}){var r,t;if(e){const i=this,n=i.isHorizontal?i.timeAxisSubGrid.scrollable:i.scrollable,s=n.element.getBoundingClientRect()[i.isHorizontal?"width":"height"];i.timeAxisViewModel.update(s,i.infiniteScroll,!0),i.infiniteScroll&&((t=(r=i.currentOrientation).doUpdateTimeView)==null||t.call(r))}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,r,t){this.currentOrientation.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(e,r,t)}initScroll(){const e=this;let r=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:t,scrollLeft:i,scrollX:n})=>{e.isPainted&&t===e.timeAxisSubGrid&&!e.isDestroying&&!e.refreshSuspended&&e.onSchedulerHorizontalScroll(t,i,n),r++}}),e.testPerformance==="horizontal"&&e.setTimeout(()=>{const t=performance.now();let i=5,n=1;const s=e.setInterval(()=>{if(i=i+5,e.scrollX+=(10+Math.floor(i))*n,n===1&&e.scrollX>5500&&(n=-1,i=5),n===-1&&e.scrollX<=0){const l=(performance.now()-t)/r,c=Math.round(1e3/l*10)/10;clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,c+"fps")}},0)},500)}preserveViewCenter(e,r=this,...t){const i=this,n=i.viewportCenterDate,s=e.apply(r,t),a=i.timelineScroller,{clientSize:o}=a,l=Math.max(Math.floor(i.getCoordinateFromDate(n,!0)-o/2),0);return i.scrollingToCenter=!0,a.scrollTo(l,!1).then(()=>i.scrollingToCenter=!1),s}setTimeSpan(e,r,t=dm){const i=this,{timeAxis:n}=i,{preventThrow:s=!1,maintainVisibleStart:a=!1,visibleDate:o}=t,{startDate:l,endDate:c}=n.getAdjustedDates(e,r),d=n.startDate-l!==0,u=n.endDate-c!==0;if(d||u){if(a){const{timeAxisViewModel:f}=i,{totalSize:g}=f,m=f.tickSize,p=i.timelineScroller,v=p.position,y=f.getDateFromPosition(v);y>=l&&y<c&&f.ion({update(){const S=f.tickSize!==m;i.updateCanvasSize(),d&&!u&&!S?p.position+=f.totalSize-g:!d&&!S?p.position=v:p.position=f.getPositionFromDate(y),p.syncPartners(!0)},prio:1e4,once:!0})}const h=n.reconfigure({startDate:l,endDate:c},!1,s);return o?i.scrollToDate(o,t).then(()=>h):h}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=L.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const r=this;if(!r.isPartneredWith(e)){(r.partneredWith||(r.partneredWith=new Mt)).add(e),(e.partneredWith||(e.partneredWith=new Mt)).add(r),r.getConfig("viewPreset"),e.ion({presetchange:"onPartnerPresetChange",thisObj:r}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:r});const i=r.partnerSharedConfigs.reduce((n,s)=>(n[s]=e[s],n),{});r.setConfig(i),r.ion({presetchange:"onPartnerPresetChange",thisObj:e}),r.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),r.isPainted?(r.scrollable.addPartner(e.scrollable,r.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):r.initScroll=Te.createSequence(r.initScroll,()=>{r.scrollable.addPartner(e.scrollable,r.isHorizontal?"x":"y"),e.syncPartnerSubGrids()},r)}}removePartner(e){const r=this,{partneredWith:t}=r;r.isPartneredWith(e)&&(t.remove(e),r.scrollable.removePartner(e.scrollable),r.un({presetchange:"onPartnerPresetChange",thisObj:e}),r.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(r))}isPartneredWith(e){var r;return!!((r=this.partneredWith)!=null&&r.includes(e))}onPartnerOverflowChange({source:e,y:r}){const{scrollable:t}=this,i=t.hasOverflow("y");i!==r?i?e.overflowY="scroll":(e.overflowY=!0,t.overflowY="scroll",this.refreshVirtualScrollbars()):t.overflowY=!0}onPartnerPresetChange({preset:e,startDate:r,endDate:t,centerDate:i,zoomDate:n,zoomPosition:s,zoomLevel:a}){!this._viewPresetChanging&&this.viewPreset!==e&&(e.options={startDate:r,endDate:t,centerDate:i,zoomDate:n,zoomPosition:s,zoomLevel:a},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}changeColumns(e,r){const t=this;let i,n;if(e){const s=Array.isArray(e);let a=e;s||(a=e.data),i=a&&a.length,a.some((o,l)=>o.type==="timeAxis"?(i=l,n=T.assign(o,t.timeAxisColumn),!0):!1),t.isVertical?(a=[T.assign({type:"verticalTimeAxis"},t.verticalTimeAxisColumn),a[i]],i=1):a=a.slice(),a[i]=this._timeAxisColumn||{type:"timeAxis",cellCls:t.timeCellCls,mode:t.mode,...n},s||e.isStore&&e.owner!==this?e=a:e.data=a}return super.changeColumns(e,r)}updateColumns(e,r){if(super.updateColumns(e,r),e){const t=this,i=t._timeAxisColumn=t.columns.find(n=>n.isTimeAxisColumn);t.isVertical&&(t.verticalTimeAxisColumn=t.columns.find(n=>n.isVerticalTimeAxisColumn),t.verticalTimeAxisColumn.relayAll(t)),i.relayAll(t)}}onColumnsChanged({action:e,changes:r,record:t,records:i}){var n;const{timeAxisColumn:s,columns:a}=this;(e==="dataset"||e==="batch")&&!a.includes(s)?a.add(s,!0):t===s&&"width"in r&&this.updateCanvasSize(),t&&((n=this.partneredWith)==null||n.forEach(o=>{const l=o.columns.getAt(t.allIndex);if(l!=null&&l.shouldSync(t)){const c={};for(const d in r)c[d]=r[d].value;l.set(c)}})),super.onColumnsChanged(...arguments)}get timeView(){var e,r;const t=this;return t.columns&&t.isVertical?(e=t.verticalTimeAxisColumn)==null?void 0:e.view:(r=t.timeAxisColumn)==null?void 0:r.timeAxisView}updateEventCls(e){const r=this;r.eventSelector||(r.unreleasedEventSelector=r.eventSelector=`.${e}-wrap`),r.eventInnerSelector||(r.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){const r=this,t=r._timeAxisViewModel,i={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:r};r.partner&&!e||t&&t===e||((t==null?void 0:t.owner)===r&&t.destroy(),r.detachListeners("timeAxisViewModel"),e!=null&&e.isTimeAxisViewModel?e.ion(i):e=lm.new({mode:r._mode,snap:r.snap,forceFit:r.forceFit,timeAxis:r.timeAxis,suppressFit:r.suppressFit,internalListeners:i,owner:r},e),r.isConfiguring||(r.isHorizontal?r.timeAxisColumn.timeAxisViewModel=e:r.verticalTimeAxisColumn.view.model=e),r._timeAxisViewModel=e,r.relayEvents(e,["update"],"timeAxisViewModel"),t&&e&&r.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,r;return(r=(e=this._timeAxisViewModel)==null?void 0:e.suppressFit)!=null?r:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){const r=this,t=r._timeAxis,i={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:r};r.partner&&!e||t&&t===e||(t&&t.owner===r&&t.destroy(),r.detachListeners("timeAxis"),e!=null&&e.isTimeAxis||(e=T.assign({owner:r,viewPreset:r.viewPreset,autoAdjust:r.autoAdjustTimeAxis,weekStartDay:r.weekStartDay,forceFullTicks:r.fillTicks&&r.snap},e),r.startDate&&(e.startDate=r.startDate),r.endDate&&(e.endDate=r.endDate),r.workingTime&&r.applyWorkingTime(e),e=new Mg(e)),e.ion(i),r._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:r}){e&&(!r||r.startDate-e.startDate||r.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:r.startDate,endDate:r.endDate},new:{startDate:e.startDate,endDate:e.endDate}}),this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){var r;const t=this,i=t._workingTime;if(i){let n=null;i.fromHour>=0&&i.fromHour<24&&i.toHour>i.fromHour&&i.toHour<=24&&i.toHour-i.fromHour<24&&(n={from:i.fromHour,to:i.toHour});let s=null;i.fromDay>=0&&i.fromDay<7&&i.toDay>i.fromDay&&i.toDay<=7&&i.toDay-i.fromDay<7&&(s={from:i.fromDay,to:i.toDay}),n||s?e.include={hour:n,day:s}:e.include=null}else e.include=null;t.isPainted&&(t.timeAxisColumn.refreshHeader(),(r=t.features.columnLines)==null||r.refresh(),t.refreshWithTransition())}updateStartDate(e){this.setStartDate(e)}setStartDate(e,r=!0){const t=this,i=t._timeAxis,{startDate:n,endDate:s,mainUnit:a}=i||dm;if(typeof e=="string"&&(e=b.parse(e)),i&&s){if(e){let o=s;if(r&&n){const l=b.diff(n,s,a,!0);o=b.add(e,l,a)}t.setTimeSpan(e,o)}}else t._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}changeEndDate(e){typeof e=="string"&&(e=b.parse(e)),this.setEndDate(e)}setEndDate(e,r=!1){const t=this,i=t._timeAxis,{startDate:n,endDate:s,mainUnit:a}=i||dm;if(typeof e=="string"&&(e=b.parse(e)),i&&n){if(e){let o=n;if(r&&s){const l=b.diff(n,s,a,!0);o=b.add(e,-l,a)}t.setTimeSpan(o,e)}}else t._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||b.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){if(e instanceof Date)return{date:e,block:"nearest"};if(e instanceof Object)return{date:e.date,...e}}updateVisibleDate(e){const r=this;r.infiniteScroll&&r.isConfiguring||(r.isPainted?r.scrollToDate(e.date,e):r.ion({paint:()=>r.scrollToDate(e.date,e),once:!0}))}get features(){return super.features}set features(e){e=e===!0?{}:e,"regionResize"in e||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){this._eventStyle=e,this.refreshWithTransition(),this.trigger("stateChange")}get eventColor(){return this._eventColor}set eventColor(e){this._eventColor=e,this.refreshWithTransition(),this.trigger("stateChange")}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,r,{width:t,height:i}){this.isVertical&&r&&t!==r.width&&delete this.timeAxisSubGrid._width;const n=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&r&&i!==r.height&&this.onSchedulerViewportResize(n,i,n,r.height)}onSchedulerViewportResize(e,r,t,i){if(this.isPainted){const n=this,{isHorizontal:s,partneredWith:a}=n;n.currentOrientation.onViewportResize(e,r,t,i),n.updateViewModelAvailableSpace(s?e:Math.floor(r)),a&&!n.isSyncingFromPartner&&n.syncPartnerSubGrids(),n.trigger("timelineViewportResize",{width:e,height:r,oldWidth:t,oldHeight:i})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){!this._viewPresetChanging&&!this.timeAxisSubGrid.collapsed&&(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid(r=>{const t=e.subGrids[r.region];t.width!==r.width&&(r.collapsed?t.collapse():(t.collapsed&&t.expand(),r.flex?r.flex!==t.flex&&(t.flex=r.flex):t.width=r.width))}),e.isSyncingFromPartner=!1)})}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const r=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("id",ji.generateId("svg")),r.retainElement=!0,e.foregroundCanvas.appendChild(r),e.trigger("svgCanvasCreated",{svg:r})}return e._svgCanvas}get timeAxisSubGridElement(){var e;return this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=(e=this.timeAxisColumn)==null?void 0:e.subGridElement),this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:r}=e.timeAxisViewModel,t=e.isHorizontal?r:e.timeAxisColumn.width;let i=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(r+e._rowBorderHeight,!0),e.suppressFit&&C.setLength(e.foregroundCanvas,"height",r),i=!0),t!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&C.setLength(e.backgroundCanvas,"width",t),C.setLength(e.foregroundCanvas,"width",t),e.$canvasWidth=t,i=!0),i}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const r=this;r.isVisible?(e==="dataset"&&r.project.isRepopulatingStores&&await r.project.await("refresh",!1),super.onStoreDataChange(...arguments)):r.whenVisible("refresh",r,[!0])}refresh(e=!0){const r=this;r.isPainted&&!r.refreshSuspended&&(r.isVertical||r.hasVisibleEvents||r.timeAxisSubGridElement.querySelector(r.eventSelector)?r.isEngineReady?r.refreshRows(!1,e):(r.refreshAfterProjectRefresh=!0,r.currentOrientation.refreshAllWhenReady=!0):r.rowManager.trigger("refresh"))}render(){const e=this,r=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=C.createElement({className:"b-sch-background-canvas",parent:r,nextSibling:r.firstElementChild}));const t=e._foregroundCanvas=C.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-e.resourceMargin*2}px`,parent:r});e.timeAxisSubGrid.insertRowsBefore=t,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,r=!0){const t=this;t.isConfiguring||(t.currentOrientation.refreshRows(r),super.refreshRows(e))}getCellDataFromEvent(e,r){return r&&(r=!e.target.closest(".b-sch-foreground-canvas")),super.getCellDataFromEvent(e,r)}onCellNavigate(e,r,t){var i,n;(i=t.cell)!=null&&i.classList.contains("b-timeaxis-cell")&&!((n=he.currentMouseDown)!=null&&n.target.classList.contains("b-grid-cell"))&&(this.preventDragSelect=!0),super.onCellNavigate(...arguments)}runWithTransition(e,r){const t=this;t.isVisible&&((r==null||r===!0)&&(r=t.transitionDuration),r&&t.enableEventAnimations&&(t.hasTimeout("exitTransition")||(t.isAnimating=!0),eD.delay=r,t.setTimeout(eD))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){this.isEngineReady||await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,r){const t=this;!t.refreshSuspended&&t.isPainted&&(t.rowManager.topRow?t.runWithTransition(()=>t.refresh(e),r):t.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some(r=>{var t;return r.column?r.column.isTimeAxisColumn:(t=r.cell)==null?void 0:t.closest(".b-timeaxis-cell")})}formatDuration(e,r=this.durationDisplayPrecision){const t=Math.pow(10,r);return Math.round(e*t)/t}beginListeningForBatchedUpdates(){this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1}endListeningForBatchedUpdates(){this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1)}onConnectedCallback(e,r){e&&!r&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(e){const r=this,{isConfiguring:t}=r;let i;t||(i=r.visibleDateRange),super.updateRtl(e),t||(r.currentOrientation.clearAll(),r.infiniteScroll?(r.shiftToDate(i.startDate),r.scrollToDate(i.startDate,{block:"start"})):r.timelineScroller.position+=.5)}applyStartEndParameters(e){const r=this,t=r.eventStore.modelClass.fieldMap.startDate;r.passStartEndParameters&&(e[r.startParamName]=t.print(r.startDate),e[r.endParamName]=t.print(r.endDate))}};R(Ko,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null}),Ko.initClass(),re.setVersion("scheduler","5.3.7"),Ko._$name="TimelineBase";var RA=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],TA=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"],MA=e=>class extends e{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(t){for(const i of TA)delete t[i];super.preProcessCurrentConfigs(t)}getCurrentConfig(t){const i=this.project.getCurrentConfig(t),n=super.getCurrentConfig(t);if(i){n.project=i;const{crudManager:s}=n;if(s)for(const a of RA)s[a]&&(i[a]=s[a]);Object.keys(i).length===0&&delete n.project}return delete n.data,delete n.crudManager,n}get widgetClass(){}},tD=e=>!e||Array.isArray(e)?e:[e],rD=(e,r,t)=>e&&e[r]!==!0?e[r]:t,iD=e=>{var r;return r=class extends(e||F){get dateBounds(){return[this.date]}get description(){const t=this,{descriptionRenderer:i}=t;return i?t.callback(i,t,[t]):t.formattedDescription}get formattedDescription(){var t;const i=this,{dateBounds:n,dateFormat:s}=i,a=(t=i.descriptionFormat)!=null?t:tD(i.defaultDescriptionFormat),o=rD(a,0,s),l=n.length>1&&(a==null?void 0:a.length)>1&&b.format(n[0],o)!==b.format(n[1],o);let c=b.format(n[0],o);return l&&(c=b.formatRange(n,rD(a,1,`S${s}${i.dateSeparator}E${s}`))),c}changeDescriptionFormat(t){return tD(t)}get widgetClass(){}},R(r,"$name","Describable"),R(r,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),r},nD=e=>class extends(e||F){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(t,i=!1){var n,s,a;if(this.isPainted&&t){let o=(n=this.foregroundCanvas.syncIdMap)==null?void 0:n[t.id];if(!o&&t.resource.hasLinks){for(const l of t.resource.$links)if(o=(s=this.foregroundCanvas.syncIdMap)==null?void 0:s[`${t.id}_${l.id}`],o)break}return i?o:(a=o==null?void 0:o.syncIdMap)==null?void 0:a.event}return null}getElementFromEventRecord(t,i=(s=>(s=t.resources)==null?void 0:s[0])(),n=!1){var s;if(t.isResourceTimeRange){const o=(s=this.foregroundCanvas.syncIdMap)==null?void 0:s[t.domId];return n?o:o==null?void 0:o.syncIdMap.event}const a=this.assignmentStore.getAssignmentForEventAndResource(t,i);return this.getElementFromAssignmentRecord(a,n)}getElementsFromEventRecord(t,i,n=!1){return i?[this.getElementFromEventRecord(t,i,n)]:t.resources.reduce((s,a)=>{const o=this.getElementFromEventRecord(t,a,n);return o&&s.push(o),s},[])}resolveResourceRecord(t,i){return this.currentOrientation.resolveRowRecord(t,i)}resolveRowRecord(t){return this.resolveResourceRecord(t)}resolveEventRecord(t){t instanceof Event&&(t=t.target);const i=t==null?void 0:t.closest(this.eventSelector);if(i){if(i.dataset.eventId)return this.eventStore.getById(i.dataset.eventId);if(i.dataset.assignmentId)return this.assignmentStore.getById(i.dataset.assignmentId).event}return null}resolveTimeSpanRecord(t){return this.resolveEventRecord(t)}resolveAssignmentRecord(t){const i=t.closest(this.eventSelector),n=i&&this.assignmentStore.getById(i.dataset.assignmentId),s=i&&this.eventStore.getById(i.dataset.eventId);return this.assignmentStore.getOccurrence(n,s)}isRowVisible(t){return this.store.indexOf(t)>=0}get widgetClass(){}},sD=e=>class extends(e||F){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(t,i){const n=this.resolveEventRecord(t);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(t),assignmentRecord:this.resolveAssignmentRecord(t),eventElement:t,event:i}}getScheduleMouseEventParams(t,i){return{resourceRecord:this.isVertical?this.resolveResourceRecord(i):this.store.getById(t.id)}}onElementKeyDown(t){const i=super.onElementKeyDown(t),n=this;return n.selectedEvents.length&&n.trigger(n.scheduledEventName+"KeyDown",{eventRecords:n.selectedEvents,assignmentRecords:n.selectedAssignments,event:t,eventRecord:n.selectedEvents,assignmentRecord:n.selectedAssignments}),i}onElementKeyUp(t){super.onElementKeyUp(t);const i=this;i.selectedEvents.length&&i.trigger(i.scheduledEventName+"KeyUp",{eventRecords:i.selectedEvents,assignmentRecords:i.selectedAssignments,event:t,eventRecord:i.selectedEvents,assignmentRecord:i.selectedAssignments})}get widgetClass(){}},aD=e=>class extends(e||F){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,resourceMargin:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:wd,horizontalLayoutStackClass:Dd,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg",isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(t){return this.internalEventLayout=t,this.internalEventLayout.type}changeInternalEventLayout(t){return this.getEventLayout(t)}updateInternalEventLayout(t,i){const n=this;i&&n.element.classList.remove(`b-eventlayout-${i.type}`),n.element.classList.add(`b-eventlayout-${t.type}`),n.isConfiguring||(n.refreshWithTransition(),n.trigger("stateChange"))}changeHorizontalEventSorterFn(t){re.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=t}updateOverlappingEventSorter(t){this.isConfiguring||this.refreshWithTransition()}getEventLayout(t){return t!=null&&t.isModel&&(t=t.eventLayout||this.internalEventLayout),typeof t=="string"&&(t={type:t}),t}getEventLayoutHandler(t){const i=this;if(!i.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:s}=i,{type:a}=t;switch(i.layouts||(i.layouts={}),a){case"stack":return i.layouts.horizontalStack||(i.layouts.horizontalStack=new i.horizontalLayoutStackClass(T.assign({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:s},t))),i.layouts.horizontalStack;case"pack":return i.layouts.horizontalPack||(i.layouts.horizontalPack=new i.horizontalLayoutPackClass(T.assign({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:s},t))),i.layouts.horizontalPack;default:return null}}get resourceColumns(){var t;return((t=this.timeAxisColumn)==null?void 0:t.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var t;return((t=this.resourceColumns)==null?void 0:t.columnWidth)||null}getEventsToRender(t,i){return i}repaintEventsForResource(t){this.currentOrientation.repaintEventsForResource(t)}repaintEvent(t){this.eventStore.getResourcesForEvent(t).forEach(n=>this.repaintEventsForResource(n))}getResourceMargin(t){var i;return(i=t==null?void 0:t.resourceMargin)!=null?i:this.resourceMargin}getBarMargin(t){var i;return(i=t==null?void 0:t.barMargin)!=null?i:this.barMargin}getResourceHeight(t){var i;return(i=t.rowHeight)!=null?i:this.isHorizontal?this.rowHeight:this.getResourceWidth(t)}getResourceWidth(t){var i;return(i=t.columnWidth)!=null?i:this.resourceColumnWidth}getAppliedResourceHeight(t){var i;const n=this.getRowById(t);return(i=n==null?void 0:n.maxRequestedHeight)!=null?i:this.getResourceHeight(t)}getResourceLayoutSettings(t,i=null){const n=this.getResourceMargin(t,i),s=this.getAppliedResourceHeight(t,i);return{barMargin:this.getBarMargin(t,i),contentHeight:Math.max(s-n*2,1),rowHeight:s,resourceMargin:n}}getEventStyle(t,i){return t.eventStyle||i.eventStyle||this.eventStyle}getEventColor(t,i){var n,s;return t.eventColor||((n=t.event)==null?void 0:n.eventColor)||((s=t.parent)==null?void 0:s.eventColor)||i.eventColor||this.eventColor}generateRenderData(t,i,n={viewport:!0}){var s,a;const o=this,l=o.currentOrientation.getTimeSpanRenderData(t,i,n),{isEvent:c}=t,{eventResize:d}=o.features,u=!t.meta.isDragCreating&&t.isMilestone,h=c&&t.assignments.find(g=>g.resourceId===i.$originalId),f={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(l){l.tabIndex="0";let g=t.isResizable;d&&g&&(l.startsOutsideView&&(g===!0?g="end":g==="start"&&(g=!1)),l.endsOutsideView&&(g===!0?g="start":g==="end"&&(g=!1)),g&&(o.isHorizontal?!o.rtl&&!d.leftHandle||o.rtl&&!d.rightHandle?g=g==="start"?!1:"end":(!o.rtl&&!d.rightHandle||o.rtl&&!d.leftHandle)&&(g=g==="end"?!1:"start"):d.topHandle?d.bottomHandle||(g=g==="end"?!1:"start"):g=g==="start"?!1:"end"));const m=!!(t.hasPersistableChanges||h!=null&&h.hasPersistableChanges),p={[i.cls]:i.cls,[o.generatedIdCls]:!t.isOccurrence&&t.hasGeneratedId,[o.dirtyCls]:m,[o.committingCls]:t.isCommitting,[o.endsOutsideViewCls]:l.endsOutsideView,[o.startsOutsideViewCls]:l.startsOutsideView,"b-clipped-start":l.clippedStart,"b-clipped-end":l.clippedEnd,"b-iscreating":t.isCreating,"b-rtl":o.rtl},v={[`${o.eventCls}-parent`]:i.isParent,"b-readonly":t.readOnly||(h==null?void 0:h.readOnly),"b-linked-resource":i.isLinked,"b-original-resource":i.hasLinks},y=t.isResourceTimeRange?new J:t.internalCls.clone(),S=t.isResourceTimeRange?t.internalCls.clone():new J;if(l.wrapperStyle="",l.isWrap=!0,c){const E=h&&o.isAssignmentSelected(h);T.assign(p,{[o.eventCls]:1,"b-milestone":u,"b-sch-event-narrow":!u&&l.width<o.narrowEventWidth,[o.fixedEventCls]:t.isDraggable===!1,[`b-sch-event-resizable-${g}`]:!!(d&&!t.readOnly),[o.eventSelectedCls]:E,[o.eventAssignHighlightCls]:o.eventAssignHighlightCls&&!E&&o.isEventSelected(t),"b-recurring":t.isRecurring,"b-occurrence":t.isOccurrence,"b-inactive":t.inactive}),l.eventId=t.id;const x=o.getEventStyle(t,i),M=o.getEventColor(t,i),I=o.isFirstRender&&o.useInitialAnimation&&globalThis.bryntum.noAnimations!==!0;if(T.assign(v,{[`${o.eventCls}-wrap`]:1,"b-milestone-wrap":u}),I){const P=l.row?l.row.index:(l.top-o.scrollTop)/o.tickSize,_=P/20*1e3;l.wrapperStyle=`animation-delay: ${_}ms;`,o.maxDelay=Math.max(o.maxDelay||0,_),o.initialAnimationDetacher||(o.initialAnimationDetacher=j.on({element:o.foregroundCanvas,delegate:o.eventSelector,once:!0,animationend:()=>o.setTimeout({fn:"stopInitialAnimation",delay:o.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:o.initialAnimationDuration+o.maxDelay},thisObj:o}))}l.eventColor=M,l.eventStyle=x,l.assignmentRecord=l.assignment=h}if(l.wrapperCls=T.assign(S,v),l.cls=T.assign(y,p),l.iconCls=new J(t.get(o.eventBarIconClsField)||t.iconCls),t.isResourceTimeRange?(l.style="",l.wrapperStyle+=t.style||""):l.style=t.style||"",l.resource=l.resourceRecord=i,l.resourceId=l.rowId,c){let E=null,x=null,M;if(o.eventRenderer){const I=o.eventRenderer.call(o.eventRendererThisObj||o,{eventRecord:t,resourceRecord:i,assignmentRecord:l.assignmentRecord,renderData:l});typeof l.cls=="string"&&(l.cls=new J(l.cls)),typeof l.wrapperCls=="string"&&(l.wrapperCls=new J(l.wrapperCls)),typeof l.iconCls=="string"&&(l.iconCls=new J(l.iconCls)),o.eventBodyTemplate?M=o.eventBodyTemplate(I):M=I}else o.eventBodyTemplate?M=o.eventBodyTemplate(t):o.eventBarTextField&&(M=L.encodeHtml(t[o.eventBarTextField]||""));!o.eventBodyTemplate||Array.isArray(M)?(f.children=[],u&&(o.milestoneLayoutMode==="default"||o.milestoneTextPosition==="always-outside")&&M!=null&&M!==""&&f.children.unshift(x={tag:"label",children:[]}),(s=l.iconCls)!=null&&s.length&&f.children.unshift({tag:"i",className:l.iconCls}),Array.isArray(M)?(x||f).children.push(...M):L.isHtml(M)?f.children.length?E={tag:"span",class:"b-event-text-wrap",html:M}:(f.children=null,f.html=M):typeof M=="string"||typeof M=="object"?E=M:M!=null&&(E=String(M)),E!=null&&((x||f).children.push(E),l.cls.add("b-has-content")),(f.html!=null||f.children.length)&&l.children.push(f)):(f.html=M,l.children.push(f))}const{eventStyle:D,eventColor:w}=l;if(l.wrapperCls[`b-sch-style-${D||"none"}`]=1,C.isNamedColor(w))l.wrapperCls[`b-sch-color-${w}`]=w;else if(w){const E=D?"color":"background-color";l.style=`${E}:${w};`+l.style,l.wrapperCls["b-sch-custom-color"]=1}else l.wrapperCls["b-sch-color-none"]=1;l.style&&u&&f&&(f.style=l.style,delete l.style),l.cls["b-sch-event-withicon"]=(a=l.iconCls)==null?void 0:a.length,l.eventContent=f,l.wrapperChildren=[],o.onEventDataGenerated(l)}return l}onEventDataGenerated(t){}changeUseInitialAnimation(t){return t===!0?"fade-in":t}updateUseInitialAnimation(t,i){const{classList:n}=this.element;i&&n.remove(`b-initial-${i}`),t&&(n.add(`b-initial-${t}`),Y.isFirefox&&n.add("b-prevent-event-transitions"))}restartInitialAnimation(t){var i;const n=this;(i=n.initialAnimationDetacher)==null||i.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=t,n.isFirstRender=!0,n.refresh()}stopInitialAnimation(){const t=this;t.initialAnimationDetacher(),t.isFirstRender=!1,t.useInitialAnimation=!1,Y.isFirefox&&t.setTimeout(()=>t.element.classList.remove("b-prevent-event-transitions"),100)}getMilestoneLabelWidth(t,i){const n=this,s=n.milestoneLayoutMode,a=n.getResourceLayoutSettings(i).contentHeight;if(s==="measure"){const o=L.encodeHtml(t.name),l=n.getEventColor(t,i),c=n.getEventStyle(t,i),d=n.milestoneMeasureElement||(n.milestoneMeasureElement=C.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${l}`]:l,[`b-sch-style-${c}`]:c},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:n.foregroundCanvas}));if(d.retainElement=!0,d.style.fontSize=`${a}px`,n.milestoneTextPosition==="always-outside"){const u=d.firstElementChild.firstElementChild.firstElementChild;u.innerHTML=o;const h=k.from(u,u.parentElement);return h.left+h.width+2}else return d.firstElementChild.firstElementChild.innerHTML=`<label></label>${o}`,d.firstElementChild.offsetWidth}return s==="estimate"?t.name.length*n.milestoneCharWidth+(n.milestoneTextPosition==="always-outside"?a:0):s==="data"?t.milestoneWidth:0}updateMilestoneLayoutMode(t){const i=this,n=i.milestoneTextPosition==="always-outside";i.element.classList.toggle("b-sch-layout-milestones",t!=="default"&&!n),i.element.classList.toggle("b-sch-layout-milestone-labels",t!=="default"&&n),i.isConfiguring||i.refreshWithTransition()}updateMilestoneTextPosition(t){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside",t==="inside"),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}},oD=e=>class extends _w(e||F){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:re.checkVersion("core","6.0",">="),crudManagerClass:null,crudManager:null}}updateProject(t,i){super.updateProject(t,i),this.detachListeners("schedulerStores"),t.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:t}){const i=this;i.isVisible?(t&&i.isVertical&&(i.refreshAfterProjectRefresh=!1,i.refreshWithTransition()),i.navigateToAfterRefresh&&(i.navigateTo(i.navigateToAfterRefresh),i.navigateToAfterRefresh=null),i.refreshAfterProjectRefresh&&(i.refreshWithTransition(!1,!t),i.refreshAfterProjectRefresh=!1)):i.whenVisible("refresh",i,[!0])}changeCrudManager(t){const i=this;t&&!t.isCrudManager&&(t=i.crudManagerClass.new({scheduler:i},t)),i._crudManager=t,i.bindCrudManager(t)}get store(){return!this._store&&this.isVertical&&(this._store=new ee({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(t){super.store=t}refreshFromRowOnStoreAdd(t,{isExpand:i,records:n}){const s=arguments;this.runWithTransition(()=>{this.currentOrientation.suspended=!i&&!n.some(a=>a.isLinked),super.refreshFromRowOnStoreAdd(t,...s),this.currentOrientation.suspended=!1},!i)}onStoreAdd(t){super.onStoreAdd(t),this.isPainted&&this.calculateRowHeights(t.records)}onStoreUpdateRecord({source:t,record:i,changes:n}){let s=0;"assigned"in n&&s++,"calendar"in n&&s++,s!==Object.keys(n).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(t){t&&this.isHorizontal&&(t.metaMapId=this.id,this.store=t)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(t){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(t)}onEventStoreBatchedUpdate(t){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(t)}onInternalEventStoreChange(t){!this.isPainted||!this._mode||t.isAssign||this.assignmentStore.isRemovingAssignment||(this.isVisible?this.currentOrientation.onEventStoreChange(t):this.whenVisible(this.onInternalEventStoreChange,this,[t]))}onEventCommit({changes:t}){let i=[...t.added,...t.modified].map(n=>this.eventStore.getResourcesForEvent(n));i=Array.prototype.concat.apply([],i),new Set(i).forEach(n=>this.repaintEventsForResource(n))}onEventCommitStart({changes:t}){const{currentOrientation:i,committingCls:n}=this;[...t.added,...t.modified].forEach(s=>s.assignments.forEach(a=>i.toggleCls(a,n,!0)))}onEventException({action:t}){if(t==="commit"){const{changes:i}=this.eventStore;[...i.added,...i.modified,...i.removed].forEach(n=>this.repaintEvent(n))}}onAssignmentCommit({changes:t}){this.repaintEventsForAssignmentChanges(t)}onAssignmentCommitStart({changes:t}){const{currentOrientation:i,committingCls:n}=this;[...t.added,...t.modified].forEach(s=>{i.toggleCls(s,n,!0)})}onAssignmentException({action:t}){t==="commit"&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(t){const i=[...t.added,...t.modified,...t.removed].map(n=>n.getResource());new Set(i).forEach(n=>this.repaintEventsForResource(n))}onAssignmentBeforeRemove({records:t,removingAll:i}){if(i)return;const n=this;let s;if(!n.isConfiguring&&(n.navigateToAfterRefresh||n.activeAssignment&&t.includes(n.activeAssignment))){if(t.includes(n.navigateToAfterRefresh)&&(n.navigateToAfterRefresh=null),he.lastInteractionType==="key")for(let a=0,o=t.length;a<o&&!s;a++){const l=t[a];if(l.resource&&l.resource.isModel){let c=n.getNext(l);(!c||t.includes(c))&&(c=n.getPrevious(l)),c&&!t.includes(c)&&(s=c)}}s?(n.navigateTo(s),n.navigateToAfterRefresh=s):C.focusWithoutScrolling(n.focusElement)}}set timeRanges(t){this.project.timeRanges=t}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(t){this.project.resourceTimeRanges=t}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:t}){this.applyStartEndParameters(t)}getResourcesEventsPerTick(t,i){const{timeAxis:n,resourceStore:s}=this,a=[];return t=t||s.records,t.forEach(o=>{o.events.forEach(l=>{if(!n.isTimeSpanInAxis(l)||i&&!i.call(this,{resource:o,event:l}))return;let c=Math.floor(n.getTickFromDate(l.startDate)),d=Math.ceil(n.getTickFromDate(l.endDate));c==-1&&(c=0),d===-1&&(d=n.ticks.length);do a[c]?a[c].push(l):a[c]=[l];while(++c<d)})}),a}get widgetClass(){}},kd={block:"nearest",edgeOffset:20},PA={highlight:!1,focus:!1},lD=e=>class extends(e||F){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(t,i=kd){const n=this,s=t.resources||[t];if(s.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");s.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await n.scrollResourceEventIntoView(s[0],t,i)}scrollAssignmentIntoView(t,...i){return this.scrollResourceEventIntoView(t.resource,t.event,...i)}async scrollResourceEventIntoView(t,i,n=kd){var s;const a=this,o=i.startDate,l=i.endDate,c=i.isScheduled&&o<a.timeAxis.startDate|(l>a.timeAxis.endDate)<<1;arguments.length>3&&(n=arguments[3]);let d;if(n.edgeOffset==null&&(n.edgeOffset=20),c&&n.extendTimeAxis!==!1){const u=a.timeAxis.endDate-a.timeAxis.startDate;if(c===3)a.setTimeSpan(new Date(o.valueOf()-u/2),new Date(l.valueOf()+u/2));else if(a.infiniteScroll){const{visibleDateRange:h}=a,f=h.endMS-h.startMS,g=c&1?1:-1;await a.setTimeSpan(new Date(o.valueOf()-u/2),new Date(o.valueOf()+u/2),{visibleDate:new Date(l.valueOf()+g*f)})}else c&1?a.setTimeSpan(new Date(o),new Date(o.valueOf()+u)):a.setTimeSpan(new Date(l.valueOf()-u),new Date(l))}if(a.store.tree&&await((s=a.expandTo)==null?void 0:s.call(a,t)),i.parent&&!i.parent.isRoot&&await this.scrollEventIntoView(i.parent),d=a.getElementFromEventRecord(i,t),d){C.isFocusable(d)||(d=d.parentNode);const u=a.timeAxisSubGrid.scrollable;a.timeAxisSubGrid.forceScrollUpdate=!0,await u.scrollIntoView(d,n)}else c===3&&n.extendTimeAxis===!1?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):!i.isOccurrence&&!a.eventStore.isAvailable(i)?console.warn("You have asked to scroll to an event which is not available"):i.isScheduled?await a.scrollUnrenderedEventIntoView(t,i,n):await a.scrollResourceIntoView(t,n)}scrollUnrenderedEventIntoView(t,i,n=kd){return new Promise(s=>{const a=this,o=Object.assign({edgeOffset:20},n,PA),l=a.timeAxisSubGrid.scrollable,c=a.getResourceEventBox(i,t),d=l.viewport;if(!d||!c){s();return}c.x=Math.ceil(c.x),c.y=Math.ceil(c.y),a.rtl&&c.translate(-a.timeAxisViewModel.totalSize+d.width,0),c.translate(d.x-l.scrollLeft,d.y-l.y);const u=async({eventRecord:g,element:m,targetElement:p})=>{if(g===i){const v=m||p;h(),await f,n.highlight&&C.highlight(v),n.focus&&v.focus(),s()}},h=a.ion({renderEvent:u}),f=l.scrollIntoView(c,o)})}scrollResourceIntoView(t,i=kd){return this.isVertical?this.currentOrientation.scrollResourceIntoView(t,i):this.scrollRowIntoView(t,i)}get widgetClass(){}},cD=e=>class extends(e||F){static get $name(){return"SchedulerRegions"}getScheduleRegion(t,i,n=!0,s){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(t,i,n){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(t,i){return this.getResourceEventBox(t.event,t.resource,i)}getResourceEventBox(t,i,n=!1,s=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(t,i=!1){return t.resources.map(n=>this.getResourceEventBox(t,n,i))}get widgetClass(){}},dD=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"],uD=e=>class extends(e||F){static get $name(){return"SchedulerState"}getState(){return T.copyProperties(super.getState(),this,dD)}applyState(t){var i;this.suspendRefresh();let n=dD.slice();(t==null?void 0:t.eventLayout)==="layoutFn"&&(delete t.eventLayout,n.splice(n.indexOf("eventLayout"),1)),(i=t==null?void 0:t.zoomLevelOptions)!=null&&i.width&&(n=n.filter(s=>s!=="tickSize")),T.copyProperties(this,t,n),super.applyState(t),this.resumeRefresh(!0)}get widgetClass(){}},hD=e=>class extends(e||F){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){var t;super.afterConstruct(),(t=this.navigator)==null||t.ion({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(t){t instanceof Mt||(t=new Mt(t)),this._selectedCollection=t,t.ion({change:(...i)=>this.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",(...n)=>!this.isDestroying&&this.onSelectedCollectionChange(...n),i),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:this})}get selectedCollection(){return this._selectedCollection}getActionType(t,i,n){return t.length>0?i.length>0&&n.length>0?"update":i.length>0?"select":"deselect":"clear"}getEventsFromAssignments(t){return H.unique(t.map(i=>i.event))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(t){const i=[];t=H.asArray(t),t==null||t.forEach(n=>{this.isEventSelectable(n)!==!1&&(n.isOccurrence?n.assignments.forEach(s=>{i.push(this.assignmentStore.getOccurrence(s,n))}):i.push(...n.assignments))}),this.selectedCollection.splice(0,this.selectedCollection.count,i)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(t){this.selectedCollection.splice(0,this.selectedCollection.count,t||[])}isEventSelected(t){const{selectedCollection:i}=this;return!!(i.count&&i.includes(t.assignments))}isEventSelectable(t){}isAssignmentSelected(t){return this.selectedCollection.includes(t)}select(t,i=!1){t.isAssignment?this.selectAssignment(t,i):this.selectEvent(t,i)}selectEvent(t,i=!1){this.isEventSelected(t)||this.selectEvents([t],i)}selectAssignment(t,i=!1,n){this.isAssignmentSelected(t)||(i?this.selectedCollection.add(t):this.selectedAssignments=t)}deselect(t){t.isAssignment?this.deselectAssignment(t):this.deselectEvent(t)}deselectEvent(t){this.isEventSelected(t)&&this.selectedCollection.remove(...t.assignments)}deselectAssignment(t){this.isAssignmentSelected(t)&&this.selectedCollection.remove(t)}selectEvents(t,i=!1){if(i){const n=t.reduce((s,a)=>(this.isEventSelectable(a)!==!1&&s.push(...a.assignments),s),[]);this.selectedCollection.add(n)}else this.selectedEvents=t}deselectEvents(t){this.selectedCollection.remove(t.reduce((i,n)=>(i.push(...n.assignments),i),[]))}selectAssignments(t){this.selectedCollection.add(t)}deselectAssignments(t){this.selectedCollection.remove(t)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:t,toRemove:i,index:n}){const s=this,a=s._selectedCollection.values,o=t,l=i>0?o.slice(n,i+n):[],c=s.getActionType(a,o,l);if(s.trigger("beforeEventSelectionChange",{action:c,selection:s.getEventsFromAssignments(a)||[],selected:s.getEventsFromAssignments(o)||[],deselected:s.getEventsFromAssignments(l)||[]})===!1||s.trigger("beforeAssignmentSelectionChange",{action:c,selection:a,selected:o,deselected:l})===!1)return!1}onSelectedCollectionChange({added:t,removed:i}){const n=this,s=n.selectedAssignments,a=t||[],o=i||[];function l(c,d){const u=c.event;if(u){const{eventAssignHighlightCls:h}=n,f=n.getElementFromAssignmentRecord(c);n.currentOrientation.toggleCls(c,n.eventSelectedCls,d),h&&n.getElementsFromEventRecord(u).forEach(g=>{if(g!==f){const m=n.resolveAssignmentRecord(g);n.currentOrientation.toggleCls(m,h,d),d&&(g.style.animation="none",g.offsetHeight,g.style.animation=""),g.classList.toggle(h,d)}})}}if(o.forEach(c=>l(c,!1)),a.forEach(c=>l(c,!0)),(n.highlightSuccessors||n.highlightPredecessors)&&n.highlightLinkedEvents(n.selectedEvents),n.$selectedAssignments=s.map(c=>({eventId:c.eventId,resourceId:c.resourceId})),!n.silent){const c=this.getActionType(s,a,o);n.trigger("assignmentSelectionChange",{action:c,selection:s,selected:a,deselected:o}),n.trigger("eventSelectionChange",{action:c,selection:n.selectedEvents,selected:n.getEventsFromAssignments(a),deselected:n.getEventsFromAssignments(o)})}}onAssignmentChange(t){super.onAssignmentChange(t);const i=this,{action:n,records:s}=t;if(i.silent=!i.triggerSelectionChangeOnRemove,n==="remove")i.deselectAssignments(s);else if(n==="removeall"&&!i.eventStore.isSettingData)i.clearEventSelection();else if(n==="dataset"&&i.$selectedAssignments)if(!i.maintainSelectionOnDatasetChange)i.clearEventSelection();else{const a=i.$selectedAssignments.map(o=>s.find(l=>l.eventId===o.eventId&&l.resourceId===o.resourceId));i.selectedAssignments=H.clean(a)}i.silent=!1}onInternalEventStoreChange({source:t,action:i,records:n}){!t.isResourceTimeRangeStore&&i==="dataset"&&!n.length&&this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(t,i){const n=this;n.isAssignmentSelected(i)?(n.deselectOnClick||t.ctrlKey)&&n.deselectAssignment(i,n.multiEventSelect,t):this.isEventSelectable(i.event)!==!1&&n.selectAssignment(i,t.ctrlKey&&n.multiEventSelect,t)}onEventNavigate({event:t,item:i}){if(!this.eventSelectionDisabled){const n=i&&(i.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(i):i);n?this.onAssignmentSelectionClick(t,n):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}changeHighlightSuccessors(t){return this.changeLinkedEvents(t)}changeHighlightPredecessors(t){return this.changeLinkedEvents(t)}changeLinkedEvents(t){const i=this;return t?(i.highlighted=i.highlighted||new Set,i.highlightLinkedEvents(i.selectedEvents)):i.highlighted&&i.highlightLinkedEvents(),t}highlightLinkedEvents(t=[]){const i=this,{highlighted:n,eventStore:s}=i,a=i.features.dependencies;n.forEach(o=>{t.includes(o)||(o.meta.highlight=!1,n.delete(o),s.includes(o)&&o.dependencies.forEach(l=>a.unhighlight(l,"b-highlight")))}),t.forEach(o=>{const l=[o];for(;l.length;){const c=l.pop();n.add(c),i.highlightSuccessors&&c.outgoingDeps.forEach(d=>{a.highlight(d,"b-highlight"),!n.has(d.toEvent)&&l.push(d.toEvent)}),i.highlightPredecessors&&c.incomingDeps.forEach(d=>{a.highlight(d,"b-highlight"),!n.has(d.fromEvent)&&l.push(d.fromEvent)})}n.forEach(c=>c.meta.highlight=!0)}),i.element.classList.toggle("b-highlighting",t.length>0),i.refreshWithTransition()}onEventDataGenerated(t){(this.highlightSuccessors||this.highlightPredecessors)&&(t.cls["b-highlight"]=t.eventRecord.meta.highlight),super.onEventDataGenerated(t)}updateProject(t,i){this.clearEventSelection(),super.updateProject(t,i)}doDestroy(){var t;(t=this._selectedCollection)==null||t.destroy(),super.doDestroy()}get widgetClass(){}},fD=e=>e.preventDefault(),IA={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},AA={animate:100},_A=Object.freeze({}),gD=e=>class extends ge(e||F){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(t){const i=this;i.isInTimeAxis=i.isInTimeAxis.bind(i),i.onDeleteKey=i.throttle(i.onDeleteKey,i.onDeleteKeyBuffer,i),super.construct(t)}changeNavigator(t){const i=this;return i.getConfig("subGridConfigs"),new qi(i.constructor.mergeConfigs({ownerCmp:i,target:i.timeAxisSubGridElement,processEvent:i.processEvent,itemSelector:`.${i.eventCls}-wrap`,focusCls:i.focusCls,navigatePrevious:i.throttle(i.navigatePrevious,{delay:i.navigatePreviousBuffer,throttled:fD}),navigateNext:i.throttle(i.navigateNext,{delay:i.navigateNextBuffer,throttled:fD})},t))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(t){return!t.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(t)}onElementKeyDown(t){var i,n,s;const a=this,{navigator:o}=a;if(((i=a.focusedCell)==null?void 0:i.rowIndex)!==-1&&((n=a.focusedCell)==null?void 0:n.column)===a.timeAxisColumn&&!t.target.closest(o.itemSelector)&&t.key==="Enter"){const l=a.getFirstVisibleAssignment();if(l)return a.navigateTo(l,{uiEvent:t}),!1}else(s=super.onElementKeyDown)==null||s.call(this,t)}getFirstVisibleAssignment(t=this.focusedCell){var i,n,s;const a=this,{currentOrientation:o,rowManager:l,eventStore:c}=a;if(a.isHorizontal){let d=o.rowMap.get(l.getRow(t.rowIndex));if(d!=null&&d.length)return(i=d[0])==null?void 0:i.elementData.assignmentRecord;if(d=(n=o.resourceMap.get(t.id))==null?void 0:n.eventsData,d!=null&&d.length)return(s=d.filter(u=>c.isAvailable(u.eventRecord))[0])==null?void 0:s.assignmentRecord}else{const d=[...o.resourceMap.values()][0],u=d&&Object.values(d);if(u!=null&&u.length)return u.filter(h=>c.isAvailable(h.renderData.eventRecord))[0].renderData.assignmentRecord}}onGridBodyFocusIn(t){var i;const n=t.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(t.target)){const s=this,{navigationEvent:a}=s,{target:o}=t,l=o.closest(s.navigator.itemSelector),c=l?s.normalizeCellContext({rowIndex:s.isVertical?0:s.resourceStore.indexOf(s.resolveResourceRecord(o)),column:s.timeAxisColumn,target:o}):new ne(o);if(l){const{_focusedCell:d}=s;s._focusedCell=c,(i=s.onCellNavigate)==null||i.call(s,s,d,c,a,!0);return}if(n&&(!a||IA[a.key])){const d=s.getFirstVisibleAssignment(c);if(d){s.navigateTo(d,{scrollIntoView:!!(a&&a.type!=="mousedown"),uiEvent:a||t});return}}}n&&super.onGridBodyFocusIn(t)}accessibleFocusCell(t,i){const n=this;if(t=n.normalizeCellContext(t),t.columnId!==n.timeAxisColumn.id)return super.focusCell(t,i)}normalizeTarget(t){return t.assignmentRecord}getPrevious(t,i){const n=this,{resourceStore:s}=n,{eventSorter:a}=n.currentOrientation,{startDate:o,endDate:l}=n.timeAxis,c=t.event,d=n.eventStore.getEvents({resourceRecord:t.resource,startDate:o,endDate:l}).filter(this.isInTimeAxis).sort(a);let u=t.resource,h=d[d.indexOf(c)-1];if(!h)for(let f=s.indexOf(u)-1;(!h||i&&h===c)&&f>=0;f--){u=s.getAt(f);const g=n.eventStore.getEvents({resourceRecord:u,startDate:o,endDate:l}).filter(n.isInTimeAxis).sort(a);h=g.length&&g[g.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(h,u)}navigatePrevious(t){const i=this,n=i.getPrevious(i.normalizeTarget(t));return t.preventDefault(),n?(t.ctrlKey||i.clearEventSelection(),i.navigateTo(n,{uiEvent:t})):i.doGridNavigation(t)}getNext(t,i){const n=this,{resourceStore:s}=n,{eventSorter:a}=n.currentOrientation,{startDate:o,endDate:l}=n.timeAxis,c=t.event,d=n.eventStore.getEvents({resourceRecord:t.resource,startDate:o,endDate:l}).filter(this.isInTimeAxis).sort(a);let u=t.resource,h=d[d.indexOf(c)+1];if(!h)for(let f=s.indexOf(u)+1;(!h||i&&h===c)&&f<s.count;f++)u=s.getAt(f),h=n.eventStore.getEvents({resourceRecord:u,startDate:o,endDate:l}).filter(n.isInTimeAxis).sort(a)[0];return n.assignmentStore.getAssignmentForEventAndResource(h,u)}navigateNext(t){const i=this,n=i.getNext(i.normalizeTarget(t));return t.preventDefault(),n?(t.ctrlKey||i.clearEventSelection(),i.navigateTo(n,{uiEvent:t})):i.doGridNavigation(t)}doGridNavigation(t){!t.handled&&t.key.indexOf("Arrow")===0&&this[`navigate${t.key.substring(5)}ByKey`](t)}async navigateTo(t,{scrollIntoView:i=!0,uiEvent:n={}}=_A){const s=this,{navigator:a}=s,{skipScrollIntoView:o}=a;t&&(i?(a.disabled=!0,await s.scrollAssignmentIntoView(t,AA),a.disabled=!1):a.skipScrollIntoView=!0,!s.isDestroyed&&this.getElementFromAssignmentRecord(t)&&(s.activeAssignment=t,a.skipScrollIntoView=o,a.trigger("navigate",{event:n,item:s.getElementFromAssignmentRecord(t).closest(a.itemSelector)})))}set activeAssignment(t){const i=this.getElementFromAssignmentRecord(t,!0);i&&(this.navigator.activeItem=i)}get activeAssignment(){const{activeItem:t}=this.navigator;if(t)return this.resolveAssignmentRecord(t)}get previousActiveEvent(){const{previousActiveItem:t}=this.navigator;if(t)return this.resolveEventRecord(t)}processEvent(t){const i=this,n=t.target.closest(i.eventSelector);return!i.navigator.disabled&&n&&(t.assignmentRecord=i.resolveAssignmentRecord(n),t.eventRecord=i.resolveEventRecord(n),t.resourceRecord=i.resolveResourceRecord(n)),t}onDeleteKey(t){const i=this;if(!i.readOnly&&i.enableDeleteKey){const n=i.eventStore.usesSingleAssignment?i.selectedEvents:i.selectedAssignments;i.removeEvents(n.filter(s=>!s.readOnly))}}onArrowUpKey(t){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),t.handled=!0}onArrowDownKey(t){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),t.handled=!0)}onEscapeKey(t){t.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),t.handled=!0)}onEventSpaceKey(t){}onEventEnterKey(t){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},FA={releaseElement:1,reuseElement:1},kA={newElement:1,reuseOwnElement:1,reuseElement:1},um=9999999,OA=({startDateMS:e},{startDateMS:r})=>e-r,LA={startDate:1,endDate:1,duration:1};function mD(e,r,t,i,n){var s,a;const{timeAxis:o}=e,l=r.isBatchUpdating&&!n?r.get(i):r[i],c=(s=r.hasBatchedChange)==null?void 0:s.call(r,i);if(e.fillTicks&&(!((a=r.meta)!=null&&a.isResizing)||!c)){let u=o.getTickFromDate(l);if(u>=0){t&&u===Math.round(u)&&u>0&&u--;const h=Math.floor(u);return o.getAt(h)[i].getTime()}}return l==null?void 0:l.getTime()}var Xo=class extends F.mixin(er){static get configurable(){return{scrollBuffer:0,bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(e){const r=this;r.client=r.scheduler=e,r.eventSorter=r.eventSorter.bind(e),e.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:r}),e.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:r}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,r,t,i=!1){const{scheduler:n}=this;let s=e[0];return t||(s=this.translateToScheduleCoordinate(s)),s=n.getRtlX(s),n.timeAxisViewModel.getDateFromPosition(s,r,i)}translateToScheduleCoordinate(e){const{scheduler:r}=this,{scrollable:t}=r.timeAxisSubGrid;let i=e-r.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return r.rtl?i+=t.maxX-Math.abs(r.scrollLeft):i+=r.scrollLeft,i}translateToPageCoordinate(e){const{scheduler:r}=this,{scrollable:t}=r.timeAxisSubGrid;let i=e+r.timeAxisSubGridElement.getBoundingClientRect().left;return r.rtl?i-=t.maxX-Math.abs(r.scrollLeft):i-=r.scrollLeft,i}getScheduleRegion(e,r,t=!0,i,n=!1){var s;const a=this,{scheduler:o}=a,{timeAxisSubGridElement:l,timeAxis:c}=o,d=(!n||e)&&o.getResourceMargin(e)||0;let u;if(e){const p=r&&o.getElementsFromEventRecord(r,e)[0];if(u=k.from(o.getRowById(e.id).getElement("normal"),l),p){const v=k.from(p,l);u.y=v.y,u.bottom=v.bottom}else u.y=u.y+d,u.bottom=u.bottom-d}else u=k.from(l).moveTo(null,0),u.width=l.scrollWidth,u.y=u.y+d,u.bottom=u.bottom-d;const h=c.startDate,f=c.endDate;i=(i==null?void 0:i.start)&&i||((s=o.getDateConstraints)==null?void 0:s.call(o,e,r))||{start:h,end:f};let g=o.getCoordinateFromDate(i.start?b.max(h,i.start):h),m=o.getCoordinateFromDate(i.end?b.min(f,i.end):f);return t||(g=a.translateToPageCoordinate(g),m=a.translateToPageCoordinate(m)),u.left=Math.min(g,m),u.right=Math.max(g,m),u}getRowRegion(e,r,t){const{scheduler:i}=this,{timeAxis:n}=i,s=i.getRowById(e.id);if(!s)return null;const a=n.startDate,o=n.endDate,l=r?b.max(a,r):a,c=t?b.min(o,t):o,d=i.getCoordinateFromDate(l),u=i.getCoordinateFromDate(c,!0,!0),h=s.top,f=Math.min(d,u),g=h+s.offsetHeight;return new k(f,h,Math.max(d,u)-f,g-h)}getResourceEventBox(e,r,t,i=!1){const n=this.resourceMap.get(r.id);let s=null,a=!1;if(n&&(s=n.eventsData.find(o=>o.eventRecord===e)),s||(s=this.getTimeSpanRenderData(e,r,{viewport:!0,timeAxis:t}),a=!0),s){const o=this.scheduler.rowManager.getRecordCoords(r,!0,i),l=s.top+o.top,c=new k(s.left,l,s.width,s.height);return c.layout=!a,c.rowTop=o.top,c.rowBottom=o.bottom,c.resourceId=r.id,c}return null}resolveRowRecord(e){const r=this,{scheduler:t}=r,i=e.nodeType?e:e.target,n=i.nodeType===Element.TEXT_NODE?i.parentElement:i,s=n.closest(t.eventSelector);return s?r.resourceStore.getById(s.dataset.resourceId):t.getRecordFromElement(n)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),e==null||e.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:e,toDrawOnDataReady:r,project:t}=this;e.isVisible?e.isPainted&&!e.refreshSuspended&&(!r.size&&t.timeZone!=null&&t.ignoreRecordChanges&&t.resourceStore.forEach(i=>r.add(i.id)),r.size&&(this.clearResources(r),this.refreshResources(r)),r.clear()):e.whenVisible("refreshRows")}onProjectRefresh({isCalculated:e,isInitialCommit:r}){const t=this,{scheduler:i,toDrawOnProjectRefresh:n}=t;if(i.isVisible){if(i.isPainted&&!i.isConfiguring&&!i.refreshSuspended){if(t.refreshAllWhenReady||r&&e){i.calculateAllRowHeights(!0);const{rowManager:s}=i;s.topRow?(t.clearAll(),i.refreshAfterProjectRefresh||(s.topRow.dataIndex>=i.store.count?i.renderRows(!1):i.refreshWithTransition(!1,!t.isFirstRefresh&&e&&!r)),t.isFirstRefresh=!1):s.reinitialize(),t.refreshAllWhenReady=!1}else n.size&&t.refreshResources(n);n.clear()}}else i.whenVisible("refresh",i,[!0])}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:e,action:r,records:t=[],replaced:i,changes:n}){const s=this,{scheduler:a}=s,o=new Set(t.flatMap(l=>{var c,d,u;return[l.resourceId,...(u=(d=(c=l.resource)==null?void 0:c.$links)==null?void 0:d.map(h=>h.id))!=null?u:[]]}));if(!(s.resourceStore.isRemoving||s.resourceStore.isChangingId))switch(r){case"dataset":{s.eventStore.usesSingleAssignment||(o.size?s.refreshResourcesWhenReady(o):(s.clearAll(),a.refreshWithTransition()));return}case"add":case"remove":case"updateMultiple":s.refreshResourcesWhenReady(o);return;case"removeall":s.refreshAllWhenReady=!0;return;case"replace":i.forEach(([l,c])=>{o.add(l.resourceId),o.add(c.resourceId)}),s.refreshResourcesWhenReady(o);return;case"filter":s.clearAll(),a.calculateAllRowHeights(!0),a.refreshWithTransition();return;case"update":{("eventId"in n||"resourceId"in n||"id"in n)&&("resourceId"in n&&o.add(n.resourceId.oldValue),e===a.project.assignmentStore?s.refreshResourcesOnDataReady(o):s.refreshResources(o));break}case"clearchanges":{const{added:l,modified:c,removed:d}=n;c.length?a.refreshWithTransition():(l.forEach(u=>o.add(u.resourceId)),d.forEach(u=>o.add(u.resourceId)),s.refreshResourcesOnDataReady(o))}}}onAssignmentStoreRefresh({action:e,records:r}){e==="batch"&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.ion({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){if(e==="batch"){const{scheduler:r}=this;r.isEngineReady&&r.isPainted&&(this.clearAll(),r.refreshWithTransition())}}onEventStoreChange({action:e,records:r=[],record:t,replaced:i,changes:n,source:s}){var a,o;const l=this,{scheduler:c}=l,d=s.isResourceTimeRangeStore,u=new Set;if(c.isPainted)if(r.forEach(h=>{var f;const g=(f=h.$linkedResources)==null?void 0:f.filter(m=>l.resourceStore.includes(m));g==null||g.forEach(m=>u.add(m.id))}),d){switch(e){case"removeall":case"dataset":l.clearAll(),c.refreshWithTransition();return}l.refreshResources(u)}else{switch(e){case"batch":case"sort":case"group":case"move":return;case"remove":return;case"clearchanges":l.clearAll(),c.refreshWithTransition();return;case"dataset":{l.clearAll(),c.isEngineReady?c.refreshWithTransition():l.refreshAllWhenReady=!0;return}case"add":case"updateMultiple":break;case"replace":i.forEach(([,h])=>{h.resources.map(f=>u.add(f.id))});break;case"removeall":case"filter":if(!c.isEngineReady){l.refreshAllWhenReady=!0;return}l.clearAll(),c.calculateAllRowHeights(!0),c.refreshWithTransition();return;case"update":{const h=t.$entity?!Object.keys(n).some(g=>!t.$entity.getField(g)):!Object.keys(n).some(g=>!LA[g]);let f=0;"startDate"in n&&f++,"endDate"in n&&f++,"duration"in n&&f++,"resourceId"in n&&u.add(n.resourceId.oldValue),u.size&&(!h||f&&!("duration"in n&&f===1)||"percentDone"in n||"inactive"in n||"constraintDate"in n||"constraintType"in n||"segments"in n)&&((a=l.project)!=null&&a.propagatingLoadChanges||(o=l.project)!=null&&o.isWritingData?l.refreshResourcesOnDataReady(u):l.refreshResources(u));return}}l.refreshResourcesWhenReady(u)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:e,isExpand:r,records:t,changes:i}){const n=this,s=t==null?void 0:t.flatMap(a=>a.isLinked?[a.id,a.$originalId]:[a.id]);if(n.scheduler.isPainted){switch(e){case"add":r||(t.every(a=>a.isLinked)?n.refreshResources(s):n.refreshResourcesWhenReady(s));return;case"update":{!n.project.isBatchingChanges&&!i.isLeaf&&n.refreshResources(s);return}case"filter":return;case"removeall":n.clearAll({clearLayoutCache:!0});return;case"dataset":return}s&&n.clearResources(s)}}onTranslateRow({row:e}){e.id!=null&&this.refreshEventsForResource(e,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(e){var r;const{scheduler:t}=this,i=t.getResourceHeight(e),n=t.getEventLayout(e);if(n.type==="stack"&&t.isEngineReady&&!e.isSpecialRow&&((r=e.assigned)==null?void 0:r.size)>1){const{assignmentStore:a,eventStore:o,timeAxis:l}=t,{barMargin:c,resourceMargin:d,contentHeight:u}=t.getResourceLayoutSettings(e),h=(o.isFiltered||a.isFiltered)&&(p=>p.assignments.some(v=>v.resource===e.$original&&a.includes(v))),f=o.getEvents({resourceRecord:e,includeOccurrences:t.enableRecurringEvents,startDate:l.startDate,endDate:l.endDate,filter:h}).sort(OA).map(p=>{const v=p.isBatchUpdating?p.get("startDate"):p.startDate,y=p.isBatchUpdating?p.get("endDate"):p.endDate||v;return{eventRecord:p,resourceRecord:e,startMS:v.getTime(),endMS:y.getTime()}}),g=t.getEventLayoutHandler(n),m=g.layoutEventsInBands(f,e,!0);return g.type==="layoutFn"?m:m*u+(m-1)*c+d*2}return i}doUpdateTimeView(){const{scrollable:e}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x)}onTimeAxisViewModelUpdate(){const e=this,{scheduler:r}=e;e.clearAll(),r.refreshSuspended&&(e.detachListeners("renderingSuspend"),r.ion({name:"renderingSuspend",resumeRefresh({trigger:t}){r.isEngineReady&&t&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"start"}getConnectorEndSide(e){return"end"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(e,r,t,i){r>i&&this.onRenderDone()}onDragAbort({context:e,dragData:r}){this.resourceStore.indexOf(r.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,r,t=!0,i=!1){const n=this.client.getElementFromAssignmentRecord(e,i),s=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),a=s==null?void 0:s.eventsData.find(o=>o.eventId===e.eventId);a&&(a[i?"wrapperCls":"cls"][r]=t),n&&(n.classList[t?"add":"remove"](r),n.lastDomConfig.className[r]=t)}onRemoveRows({rows:e}){e.forEach(r=>this.rowMap.delete(r)),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(e){const r=this,{scheduler:t,scrollBuffer:i}=r,{timeAxisSubGrid:n,timeAxis:s,rtl:a}=t,{width:o}=n,{totalSize:l}=t.timeAxisViewModel,c=e,d=n.scrollable.maxX!==0&&Math.abs(n.scrollable.maxX)<=Math.round(c)+5,u=t.getDateFromCoord({coord:Math.max(0,c-i),ignoreRTL:!0}),h=d?s.endDate:t.getDateFromCoord({coord:c+o+i,ignoreRTL:!0})||s.endDate;if(u&&!t._viewPresetChanging){r._visibleDateRange={startDate:u,endDate:h,startMS:u.getTime(),endMS:h.getTime()},r.viewportCoords=a?{left:l-e-o+i,right:l-e-i}:{left:e-i,right:e+o+i};const f=t.timeView.range={startDate:u,endDate:h};if(t.onVisibleDateRangeChange(f),!t.refreshSuspended&&t.rowManager.rows.length){if(t.rowManager.rows[0].id===null)return;r.fromScroll=!0,t.rowManager.rows.forEach(g=>r.refreshEventsForResource(g,!1,!1)),r.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(e){e.forEach(r=>this.toDrawOnDataReady.add(r))}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach(r=>this.toDrawOnProjectRefresh.add(r))}refreshResources(e,r=!0){const t=this,{scheduler:i}=t,n=[],s=[];t.clearResources(e),i.refreshSuspended||(e.forEach(a=>{const o=i.getRowById(a);o?n.push(o):s.push(o)}),i.runWithTransition(()=>{i.calculateRowHeights(s.map(a=>this.resourceStore.getById(a)),!0),i.rowManager.renderRows(n)},r))}layoutEventVerticallyStack(e,r,t){const{barMargin:i,resourceMargin:n,contentHeight:s}=this.scheduler.getResourceLayoutSettings(t,r.parent);return e===0?n:n+e*s+e*i}layoutEventVerticallyPack(e,r,t,i){const{barMargin:n,resourceMargin:s,contentHeight:a}=this.scheduler.getResourceLayoutSettings(i,t.parent),o=1/r,l=e*o,c=(a-(o-1)*n)*r;return{top:s+l*c+l*n,height:c}}addTemporaryDragElement(e,r=e.resource){const{scheduler:t}=this,i=t.generateRenderData(e,r,{timeAxis:!0,viewport:!0});i.absoluteTop=i.row?i.top+i.row.top:t.getResourceEventBox(e,r,!0).top;const n=this.renderEvent(i),{dataset:s}=n;delete n.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,n.parent=this.scheduler.foregroundCanvas,n.retainElement=!0;const a=C.createElement(n);return a.innerElement=a.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,a}eventSorter(e,r){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,r.eventRecord||r);const t=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,i=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,n=r.isModel?r.startDateMS:r.dataStartMS||r.startMS,s=r.isModel?r.endDateMS:r.dataEndMS||r.endMS,a=e.isModel?e.name:e.eventRecord.name,o=r.isModel?r.name:r.eventRecord.name;return t-n||s-i||(a<o?-1:a==o?0:1)}calculateMS(e,r,t,i,n){const s=this,{scheduler:a}=s,{timeAxisViewModel:o}=a;let l=mD(a,e,!1,r,i),c=mD(a,e,!0,t,i),d=c-l;if(a.milestoneLayoutMode!=="default"&&d===0){const u=o.getSingleUnitInPixels("minute");if(d=a.getMilestoneLabelWidth(e,n)*(1/u)*60*1e3,a.milestoneTextPosition==="always-outside"){const g=a.getResourceLayoutSettings(n,e.parent).contentHeight,m=g*(1/u)*60*1e3;l-=m/2,c=l+d}else switch(a.milestoneAlign){case"start":case"left":c=l+d;break;case"end":case"right":c=l,l=c-d;break;default:c=l+d/2,l=c-d;break}}return{startMS:l,endMS:c,durationMS:d}}setupRenderData(e,r){var t;const i=this,{scheduler:n}=i,{timeAxis:s,timeAxisViewModel:a}=n,{preamble:o,postamble:l}=e,c=i.isProHorizontalRendering&&((t=n.features.eventBuffer)==null?void 0:t.enabled)&&(o||l)&&!e.isMilestone,d=a.getSingleUnitInPixels("minute"),{isBatchUpdating:u}=e,h=c?"wrapStartDate":"startDate",f=c?"wrapEndDate":"endDate",g=u&&!c?e.get(h):e[h],m=u&&!c?e.get(f):e[f]||g,p=s.startMS,v=s.endMS,{startMS:y,endMS:S,durationMS:D}=i.calculateMS(e,h,f,c,r),w=y<p|(y>v)<<1,E=S>v|(S<=p)<<1,x=D/(1e3*60),M=E?d*x:null,I=n.getRowById(r);return{eventRecord:e,taskRecord:e,start:g,end:m,rowId:r.id,children:[],startMS:y,endMS:S,durationMS:D,startsOutsideView:w,endsOutsideView:E,width:M,row:I,useEventBuffer:c}}fillTimeSpanHorizontalPosition(e){const{startMS:r,endMS:t,durationMS:i}=e,n=r!=null&&t!=null&&this.calculateHorizontalPosition(e,r,t,i);return n?(Object.assign(e,n),!0):!1}calculateHorizontalPosition(e,r,t,i){const{scheduler:n}=this,{timeAxis:s,timeAxisViewModel:a}=n,{startsOutsideView:o,endsOutsideView:l,eventRecord:c}=e,d=s.startMS,u=a.getSingleUnitInPixels("minute"),h=i/(1e3*60),f=l?u*h:null;let g=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0}),m,p=!1,v=!1;return o?(m=(r-d)/(1e3*60)*u,n.rtl&&(m=n.timeAxisSubGrid.scrollable.scrollWidth-m)):(m=n.getCoordinateFromDate(r,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:g!==-1}),p=m===-1),l?Y.isSafari&&n.features.stickyEvents&&s.endMS||g===-1&&!s.continuous?g=n.getCoordinateFromDate(s.endMS):g=m+f*(n.rtl?-1:1):v=g===-1,v&&!p&&(g=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),f>um&&(o===1?l===1?(m=-100,g=n.timeAxisColumn.width+100):m=g-um:l===1&&(g=m+um)),p&&v&&(m=n.getCoordinateFromDate(r,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:t}),g=n.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:r}),m===g)?(c.instanceMeta(n).excluded=!0,null):{left:Math.min(m,g),width:Math.abs(g-m)||(c.isMilestone&&!c.meta.isDragCreating?0:6),clippedStart:p,clippedEnd:v}}fillTimeSpanVerticalPosition(e,r){const{scheduler:t}=this,{start:i,end:n}=e,{resourceMargin:s,contentHeight:a}=t.getResourceLayoutSettings(r);t.fillTicks&&(e.dataStartMS=i.getTime(),e.dataEndMS=n.getTime()),e.top=Math.max(0,s),t.managedEventSizing&&(e.height=a)}getTimeSpanRenderData(e,r,t=!1){const i=this,{scheduler:n}=i,{timeAxis:s}=n,a=t===!0||t.timeAxis,o=t===!0||t.viewport;if((a||s.isTimeSpanInAxis(e))&&(n.getRowById(r)||o)){const c=i.setupRenderData(e,r);return i.fillTimeSpanHorizontalPosition(c)?(i.fillTimeSpanVerticalPosition(c,r),c):null}}layoutEvents(e,r,t=!1,i,n){const s=this,{scheduler:a}=s,{timeAxis:o}=a,l=r.reduce((f,g)=>{if(t||o.isTimeSpanInAxis(g)){const m=a.generateRenderData(g,e,!1);m&&f.push(m)}return f},[]);l.sort(n!=null?n:s.eventSorter);let c=a.getAppliedResourceHeight(e,i);const d=l.filter(({eventRecord:f})=>f.isEvent&&!f.meta.excludeFromLayout),u=a.getEventLayout(e,i),h=a.getEventLayoutHandler(u);if(h){const{barMargin:f,resourceMargin:g,contentHeight:m}=a.getResourceLayoutSettings(e,i),p=h.applyLayout(d,e)||1;h.type==="layoutFn"?c=p:c=p*m+(p-1)*f+g*2}else if(d.length>0)for(let f=0;f<d.length;f++){const g=d[f];g.wrapperStyle+=`;z-index:${f+5}`}return{rowHeight:c,eventsData:l}}layoutResourceEvents(e,r=!1){const t=this,{scheduler:i}=t,{eventStore:n,assignmentStore:s,timeAxis:a}=i,o=n.getEvents({includeOccurrences:i.enableRecurringEvents,resourceRecord:e,startDate:a.startDate,endDate:a.endDate,filter:(s.isFiltered||n.isFiltered)&&(c=>c.assignments.some(d=>d.resource===e.$original&&s.includes(d)))}),l=i.getEventsToRender(e,o)||[];return t.layoutEvents(e,l,r)}renderEvent(e,r){const{scheduler:t}=this,{resourceRecord:i,assignmentRecord:n,eventRecord:s}=e,{milestoneLayoutMode:a,milestoneTextPosition:o}=t,l=n?this.assignmentStore.getOccurrence(n,s).id:e.eventId,c={className:e.cls,style:e.style||"",children:e.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},d={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,children:[c,...e.wrapperChildren],style:{top:e.absoluteTop,left:e.left,height:e.fillSize?r:e.height,width:s.isMilestone&&!s.meta.isDragCreating&&(a==="default"&&(o==="outside"||o==="inside"&&!e.width)||o==="always-outside")?e.height:e.width,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:i.id,eventId:e.eventId,syncId:i.isLinked?`${l}_${i.id}`:l},elementData:e,retainElement:(n==null?void 0:n.instanceMeta(t).retainElement)||s.instanceMeta(t).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return e.fillSize&&(e.height=r),e.zIndex&&(d.zIndex=e.zIndex),n&&(d.dataset.assignmentId=n.id),e.elementConfig=d,d}refreshEventsForResource(e,r=!0,t=!0){const i=this,n=i.scheduler.store.getById(e.isRow?e.id:e),s=i.scheduler.rowManager.getRowFor(n);r&&i.clearResources([n]),s&&n&&(i.renderer({row:s,record:n}),r&&t&&i.onRenderDone())}getResourceLayout(e){const r=this;let t=r.resourceMap.get(e.id);if(!t||t.invalid){if(r.suspended)return;t=r.layoutResourceEvents(e,!1),r.resourceMap.set(e.id,t)}return t}getEventDOMConfigForCurrentView(e,r,t,i){const n=this,{bufferSize:s,scheduler:a}=n,{labels:o,eventBuffer:l}=a.features,c=(l==null?void 0:l.enabled)||(o==null?void 0:o.enabled)&&(o.left||o.right||o.before||o.after),{eventsData:d}=e,u=n.fromScroll?n.rowMap.get(r):null,h=[];let f,g;for(let m=0;m<d.length;m++){const p=d[m];if(f=t,g=i,(c||p.width===0)&&(f-=s,g+=s),p.left+p.width>=f&&p.left<=g){p.absoluteTop=p.top+r.top;const v=u==null?void 0:u.find(y=>y.elementData.eventId===p.eventId&&y.elementData.resourceId===p.resourceId);h.push(v!=null?v:n.renderEvent(p,e.rowHeight))}}return h}renderer({row:e,record:r,size:t={}}){const i=this;if(r.isSpecialRow){i.rowMap.delete(e);return}const{left:n,right:s}=i.viewportCoords,a=i.getResourceLayout(r);if(!a)return;t.height=a.rowHeight,t.transient=!0;const o=i.getEventDOMConfigForCurrentView(a,e,n,s);i.rowMap.set(e,o),i.rendererCalled=!0}onRenderDone(){var e;const{scheduler:r,rowMap:t,verticalBufferSize:i}=this,n=[],s=(e=r._scrollTop)!=null?e:0,a=s-i,o=s+r._bodyRectangle.height+i,l=i<0,c=!r.managedEventSizing;t.forEach((d,u)=>{if(l||u.bottom>a&&u.top<o)for(let h=0;h<d.length;h++){const f=d[h],g=f.elementData,{absoluteTop:m,eventRecord:p}=g;(l||c||p.meta.isDragCreating||p.meta.isResizing||m+g.height>a&&m<o)&&n.push(f)}for(let h=0;h<d.length;h++)d[h]={...d[h]}}),this.fromScroll=!1,this.visibleEventDOMConfigs=n,q.sync({domConfig:{onlyChildren:!0,children:n},targetElement:r.foregroundCanvas,syncIdField:"syncId",callback({action:d,domConfig:u,lastDomConfig:h,targetElement:f,jsx:g}){var m,p,v;const{reactComponent:y}=r,S=FA[d],D=kA[d];if(!S&&((m=r.processEventContent)==null||m.call(r,{jsx:g,action:d,domConfig:u,targetElement:f,isRelease:S,reactComponent:y})),!(d==="none"||!((p=u==null?void 0:u.elementData)!=null&&p.isWrap))){if(S&&(h!=null&&h.elementData)){const{eventRecord:w,resourceRecord:E,assignmentRecord:x}=h.elementData,M={renderData:h.elementData,element:f,eventRecord:w,resourceRecord:E,assignmentRecord:x};(v=r.processEventContent)==null||v.call(r,{isRelease:S,targetElement:f,reactComponent:y,assignmentRecord:x}),f===C.getActiveElement(f)&&r.focusElement.focus(),r.trigger("releaseEvent",M)}if(D){const{eventRecord:w,resourceRecord:E,assignmentRecord:x}=u.elementData,M={renderData:u.elementData,element:f,isReusingElement:d==="reuseElement",isRepaint:d==="reuseOwnElement",eventRecord:w,resourceRecord:E,assignmentRecord:x};r.trigger("renderEvent",M)}}}})}clearResources(e){e=H.asArray(e),e.map(ae.asId).forEach(t=>{const i=this.resourceMap.get(t);i&&(i.invalid=!0);const n=this.scheduler.getRowById(t);n&&this.rowMap.delete(n)})}clearAll({clearDom:e=!1,clearLayoutCache:r=!1}={}){const t=this,{layouts:i,foregroundCanvas:n}=t.scheduler;if(r&&i)for(const s in i)i[s].clearCache();if(n&&e){n.syncIdMap=n.lastDomConfig=null;for(const s of n.children)s.lastDomConfig=s.elementData=null}t.resourceMap.clear(),t.rowMap.clear()}};R(Xo,"$name","HorizontalRendering"),Xo._$name="HorizontalRendering";var pD=class extends Ag(){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,r,t,i,n,s){const a=this,o=s.type;return a.packEventsInBands(e,(l,c,d,u)=>{if(o==="none")l.width=r-t*2,l.left+=t;else{l.widthFactor=u;const h=l.leftFactor=d.start+c*u,f=Math.round(1/u),g=h/u,m=r-t*2-i*(f-1);o==="mixed"&&f===2?(l.left+=h*r/5+i,l.width=r-h*r/5-i*2,l.zIndex=5+g):(l.width=u*m,l.left+=h*m+t+i*g)}l.cls["b-sch-event-narrow"]=l.width<a.scheduler.narrowEventWidth})}};pD._$name="VerticalLayout";var $A={releaseElement:1,reuseElement:1},jA={newElement:1,reuseOwnElement:1,reuseElement:1},BA={startDate:1,endDate:1,duration:1},HA=Object.freeze({}),Od=class extends F.mixin(ge,er){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new pD({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:r,resourceColumns:t}=e;t.resourceStore=e.resourceStore,t.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,r.isPainted&&e.renderer(),t.availableWidth=r.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,r){const t=this,{scheduler:i}=t,n=e.nodeType?null:e,s=n?n.target:e,a=n?[n.borderOffsetX,n.borderOffsetY]:r,o=s.nodeType===Element.TEXT_NODE?s.parentElement:s,l=o.closest(i.eventSelector);if(l)return i.resourceStore.getById(l.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!a)throw new Error(`Vertical mode needs coordinates to resolve this element. Can also be called with a browser
                event instead of element to extract element and coordinates from`);if(i.variableColumnWidths||i.resourceStore.isGrouped){let d=0;for(const u of t.resourceStore)if(u.isSpecialRow||(d+=u.columnWidth||t.resourceColumns.columnWidth),d>=a[0])return u;return null}const c=Math.floor(a[0]/t.resourceColumns.columnWidth);return t.allResourceRecords[c]}toggleCls(e,r,t=!0,i=!1){var n;const s=(n=this.eventMap.get(e.eventId))==null?void 0:n[e.resourceId];if(s){s.renderData[i?"wrapperCls":"cls"][r]=t;const a=this.client.getElementFromAssignmentRecord(e,i);a&&a.classList[t?"add":"remove"](r)}}getDateFromXY(e,r,t,i=!1){let n=e[1];return t||(n=this.translateToScheduleCoordinate(n)),this.scheduler.timeAxisViewModel.getDateFromPosition(n,r,i)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(e,r){var t,i,n;const s=e.id,a=r.id;let{renderData:o}=((t=this.eventMap.get(s))==null?void 0:t[a])||HA;return o||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(a)),o=(n=(i=this.eventMap.get(s))==null?void 0:i[a])==null?void 0:n.renderData),o?new k(o.left,o.top,o.width,o.bottom-o.top):null}getScheduleRegion(e,r,t){var i;const n=this,{scheduler:s}=n,a=k.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);e&&(a.left=n.allResourceRecords.indexOf(e)*s.resourceColumnWidth,a.right=a.left+s.resourceColumnWidth);const o=s.timeAxis.startDate,l=s.timeAxis.endDate,c=((i=s.getDateConstraints)==null?void 0:i.call(s,e,r))||{start:o,end:l},d=s.getCoordinateFromDate(b.max(o,c.start)),u=s.getCoordinateFromDate(b.min(l,c.end));return t?(a.top=d,a.bottom=u):(a.top=n.translateToPageCoordinate(d),a.bottom=n.translateToPageCoordinate(u)),a}getRowRegion(e,r,t){const i=this,{scheduler:n}=i,s=i.allResourceRecords.indexOf(e)*n.resourceColumnWidth,a=n.timeAxis.startDate,o=n.timeAxis.endDate,l=r?b.max(a,r):a,c=t?b.min(o,t):o,d=n.getCoordinateFromDate(l),u=n.getCoordinateFromDate(c,!0,!0),h=Math.min(d,u),f=Math.abs(d-u);return new k(s,h,n.resourceColumnWidth,f)}get visibleDateRange(){const e=this.scheduler,r=e.scrollable.y,t=e.scrollable.clientHeight,i=e.getDateFromCoordinate(r)||e.timeAxis.startDate,n=e.getDateFromCoordinate(r+t)||e.timeAxis.endDate;return{startDate:i,endDate:n,startMS:i.getTime(),endMS:n.getTime()}}onResourceColumnWidthChange({width:e,oldWidth:r}){const t=this,{scheduler:i}=t;t.resourceColumns.width=i.timeAxisColumn.width=t.allResourceRecords.length*e,t.clearAll(),t.refresh(Math.abs(e-r)>30)}attachToProject(e){super.attachToProject(e),e&&e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:r,toDrawOnProjectRefresh:t}=e;r.isVisible?r.rendered&&!r.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):t.size&&e.refresh(),t.clear()):r.whenVisible("refresh",r,[!0])}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){e==="batch"&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:r=[],record:t,replaced:i,changes:n,isAssign:s}){const a=this,o=new Set;switch(r.forEach(l=>{var c;const d=(c=l.$linkedResources)==null?void 0:c.filter(u=>a.resourceStore.includes(u));d==null||d.forEach(u=>o.add(u.id))}),e){case"sort":case"group":case"move":case"remove":return;case"dataset":a.refreshAllResourcesWhenReady();return;case"add":case"updateMultiple":break;case"replace":i.forEach(([,l])=>{l.resources.map(c=>o.add(c.id))}),a.clearResources(o);break;case"removeall":case"filter":a.clearAll(),a.refresh();return;case"update":{const l=t.$entity?!Object.keys(n).some(d=>!t.$entity.getField(d)):!Object.keys(n).some(d=>!BA[d]);let c=0;"startDate"in n&&c++,"endDate"in n&&c++,"duration"in n&&c++,(!l||c||"percentDone"in n||"inactive"in n||"segments"in n)&&(a.shouldWaitForInitializeAndEngineReady?a.refreshResourcesWhenReady(o):(a.clearResources(o),a.refresh()));return}}a.refreshResourcesWhenReady(o)}attachToResourceStore(e){const r=this;super.attachToResourceStore(e),r.refreshAllWhenReady=!0,r.resourceColumns&&(r.resourceColumns.resourceStore=e),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>r.scheduler.unmaskBody(),thisObj:r,prio:1}),r.initialized&&r.scheduler.isPainted&&(r.firstResource=r.lastResource=null,r.clearAll(),r.renderer())}onResourceStoreChange({source:e,action:r,records:t=[],record:i,replaced:n,changes:s}){const a=this,o=n?n.map(d=>d[1]):t,l=new Set(o.map(d=>d.id));a.firstResource=a.lastResource=null,e._allResourceRecords=null;const{allResourceRecords:c}=e;if(a.scheduler.isEngineReady){switch(r){case"update":s!=null&&s.id?a.clearResources([s.id.oldValue,s.id.value]):a.clearResources([i.id]);break;case"filter":a.clearAll();break}s&&"columnWidth"in s&&a.clearAll(),a.refresh(!0)}else{switch(r){case"dataset":case"remove":case"removeall":a.refreshAllResourcesWhenReady();return;case"replace":case"add":if(!e.isGrouped){const d=o.reduce((u,h)=>Math.min(u,c.indexOf(h)),c.length);for(let u=d;u<c.length;u++)l.add(c[u].id)}}a.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const r=this;(e==="sort"||e==="group")&&(r.firstResource=r.lastResource=r.resourceStore._allResourceRecords=null,r.clearAll(),r.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:r=[],replaced:t,changes:i}){const n=this,s=new Set(r.map(a=>a.resourceId));if(n.scheduler.isEngineReady){switch(e){case"remove":n.clearResources(s);break;case"filter":n.clearAll();break;case"update":{if("resourceId"in i&&s.add(i.resourceId.oldValue),!Object.keys(i).filter(a=>a!=="resource"&&a!=="event").length)return;n.clearResources(s)}}n.refresh(!0)}else{switch(i&&"resourceId"in i&&s.add(i.resourceId.oldValue),e){case"removeall":n.refreshAllResourcesWhenReady();return;case"replace":t.forEach(([a,o])=>{s.add(a.resourceId),s.add(o.resourceId)})}n.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:e,records:r}){e==="batch"&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollX&&(this.renderer(),this.prevScrollX=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,r){const{scheduler:t}=this,i=this.allResourceRecords.indexOf(e)*t.resourceColumnWidth;return t.scrollHorizontallyTo(i,r)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}get resourceColumns(){var e;return(e=this.scheduler.timeAxisColumn)==null?void 0:e.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(e){return"top"}getConnectorEndSide(e){return"bottom"}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach(r=>this.toDrawOnProjectRefresh.add(r))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:r}=this.getResourceRange();return{first:this.allResourceRecords[e],last:this.allResourceRecords[r]}}getResourceRange(e){const{scheduler:r,resourceStore:t}=this,{resourceColumnWidth:i,scrollX:n}=r,{scrollWidth:s}=r.timeAxisSubGrid.scrollable,a=e?this.resourceBufferSize:0,o=n-a,l=n+s+a;if(!(t!=null&&t.count))return{first:-1,last:-1};if(r.variableColumnWidths){let c,d=0,u,h=0;return this.allResourceRecords.forEach((f,g)=>{if(f.instanceMeta(r).insetStart=u=h,h=u+f.columnWidth,u>l)return!1;h>o&&c==null?c=g:u<l&&(d=g)}),{first:c,last:d}}else return{first:Math.max(Math.floor(n/i)-a,0),last:Math.min(Math.floor((n+r.timeAxisSubGrid.width)/i)+a,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:e}=this;let r=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));r||(r=e.timeAxis.last.endDate);let t=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return t||(t=e.timeAxis.first.startDate,r=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:t,bottomDate:r}}getTimeSpanRenderData(e,r,t=!1){var i;const n=this,{scheduler:s}=n,{preamble:a,postamble:o}=e,{variableColumnWidths:l}=s,c=((i=s.features.eventBuffer)==null?void 0:i.enabled)&&n.isProVerticalRendering&&(a||o)&&!e.isMilestone,d=c?"wrapStartDate":"startDate",u=c?"wrapEndDate":"endDate",h=e.isBatchUpdating&&e.hasBatchedChange(d)&&!c?e.get(d):e[d],f=e.isBatchUpdating&&e.hasBatchedChange(u)&&!c?e.get(u):e[u],g=s.getResourceMargin(r),m=s.getCoordinateFromDate(h),p=r.instanceMeta(s),v=l?p.insetStart:n.allResourceRecords.indexOf(r)*s.resourceColumnWidth,y=s.getResourceWidth(r),S=y-g*2,D=h.getTime(),w=f.getTime();let E=s.getCoordinateFromDate(f),x=E-m;return E===-1&&(x=Math.round((w-D)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),E=m+x),{eventRecord:e,resourceRecord:r,left:v,top:m,bottom:E,resourceWidth:y,width:S,height:x,startDate:h,endDate:f,startDateMS:D,endDateMS:w,useEventBuffer:c,children:[],start:h,end:f,startMS:D,endMS:w}}eventSorter(e,r){const t=e.dataStartMs||e.startDateMS,i=e.dataEndMs||e.endDateMS,n=r.dataStartMs||r.startDateMS,s=r.dataEndMs||r.endDateMS,a=e.isModel?e.name:e.eventRecord.name,o=r.isModel?r.name:r.eventRecord.name;return t-n||s-i||(a<o?-1:a==o?0:1)}layoutEvents(e,r,t=!1,i,n){const s=this,{scheduler:a}=s,{variableColumnWidths:o}=a,{id:l}=e,c=e.instanceMeta(a),d=i?`${l}-${i.id}`:l,u=s.resourceMap.set(d,{}).get(d),h=s.allResourceRecords.indexOf(e),{barMargin:f,resourceMargin:g}=a.getResourceLayoutSettings(e,i),m=r.reduce((p,v)=>{if(v.isScheduled){const y=a.generateRenderData(v,e,!1),S={renderData:y},D=T.getMapPath(s.eventMap,y.eventId,{});D[l]=S,u[y.eventId]=S,y.fillSize?(y.left=o?c.insetStart:h*a.resourceColumnWidth,y.width=a.getResourceWidth(e)):p.push(y)}return p},[]);return m.sort(n!=null?n:s.eventSorter),s.verticalLayout.applyLayout(m,a.getResourceWidth(e,i),g,f,h,a.getEventLayout(e,i)),u}layoutResourceEvents(e){const r=this,{scheduler:t}=r,{assignmentStore:i,eventStore:n,timeAxis:s}=t;let a=n.getEvents({includeOccurrences:t.enableRecurringEvents,resourceRecord:e,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||n.isFiltered)&&(o=>o.assignments.some(l=>l.resource===e&&i.includes(l)))});return a=t.getEventsToRender(e,a),r.layoutEvents(e,a)}addTemporaryDragElement(e){const{scheduler:r}=this,t=r.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});t.top=t.row?t.top+t.row.top:r.getResourceEventBox(e,e.resource,!0).top;const i=this.renderEvent({renderData:t}),{dataset:n}=i;delete i.tabIndex,delete n.eventId,delete n.resourceId,delete n.assignmentId,delete n.syncId,n.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const s=C.createElement(i);return s.innerElement=s.firstChild,e.instanceMeta(r).hasTemporaryDragElement=!0,s}renderEvent(e){const{scheduler:r}=this,t=e.renderData,{resourceRecord:i,assignmentRecord:n,eventRecord:s}=t,a={className:t.wrapperCls,tabIndex:-1,children:[{role:"presentation",className:t.cls,style:(t.internalStyle||"")+(t.style||""),children:t.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...t.wrapperChildren],style:{top:t.top,[r.rtl?"right":"left"]:t.left,height:s.isMilestone?"1em":t.height,width:t.width,style:t.wrapperStyle||"",fontSize:s.isMilestone?Math.min(t.width,40):null},dataset:{resourceId:i.id,eventId:t.eventId,syncId:n?this.assignmentStore.getOccurrence(n,s).id:t.eventId},elementData:e,retainElement:(n||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return a.className["b-sch-vertical"]=1,t.zIndex&&(a.zIndex=t.zIndex),n&&(a.dataset.assignmentId=n.id),e.elementConfig=a,a}renderResource(e){var r;const t=this,{topDateMS:i,bottomDateMS:n}=t,s=[];let a=t.resourceMap.get(e.id);a||(a=t.layoutResourceEvents(e));for(const o in a){const l=a[o],{endDateMS:c,startDateMS:d,eventRecord:u}=l.renderData;if(c>=i&&d<=n&&!u.instanceMeta(t.scheduler).hasTemporaryDragElement){const h=((r=l.elementConfig)==null?void 0:r.className)!=="b-released"&&l.elementConfig||t.renderEvent(l);s.push(h)}}return s}isEventElement(e){const r=e&&e.className;return r&&r[this.scheduler.eventCls+"-wrap"]}get shouldWaitForInitializeAndEngineReady(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}renderer(){const e=this,{scheduler:r}=e,{first:t,last:i}=e.resourceRange,{topDate:n,bottomDate:s}=e.dateRange,a=[],o=[];if(!e.shouldWaitForInitializeAndEngineReady){if(!b.isEqual(n,e.topDate)||!b.isEqual(s,e.bottomDate)){e.topDate=n,e.bottomDate=s,e.topDateMS=n.getTime(),e.bottomDateMS=s.getTime();const l=e.timeView.range={startDate:n,endDate:s};r.onVisibleDateRangeChange(l)}if(t!==-1&&i!==-1)for(let l=t;l<=i;l++)a.push.apply(a,e.renderResource(e.allResourceRecords[l]));if(r.getForegroundDomConfigs(o),a.push.apply(a,o),q.sync({domConfig:{onlyChildren:!0,children:a},targetElement:r.foregroundCanvas,syncIdField:"syncId",callback({action:l,domConfig:c,lastDomConfig:d,targetElement:u,jsx:h}){var f,g,m;const{reactComponent:p}=r;if(e.isEventElement(c)||h||(f=c==null?void 0:c.elementData)!=null&&f.jsx){const v=$A[l],y=jA[l];if((g=r.processEventContent)!=null&&g.call(r,{action:l,domConfig:c,isRelease:!1,targetElement:u,reactComponent:p,jsx:h}))return;if(v&&e.isEventElement(d)&&!d.isReleased){const S=d.elementData.renderData,D={renderData:S,assignmentRecord:S.assignmentRecord,eventRecord:S.eventRecord,resourceRecord:S.resourceRecord,element:u};(m=r.processEventContent)==null||m.call(r,{isRelease:v,targetElement:u,reactComponent:p,assignmentRecord:S.assignmentRecord}),u===C.getActiveElement(u)&&r.focusElement.focus(),r.trigger("releaseEvent",D)}if(y){const S=c.elementData.renderData,D={renderData:S,assignmentRecord:S.assignmentRecord,eventRecord:S.eventRecord,resourceRecord:S.resourceRecord,element:u,isReusingElement:l==="reuseElement",isRepaint:l==="reuseOwnElement"};D.reusingElement=l==="reuseElement",r.trigger("renderEvent",D)}}}}),e.firstResource!==t||e.lastResource!==i){const l=e.resourceColumns.visibleResources={firstResource:t,lastResource:i};e.firstResource=t,e.lastResource=i,r.onVisibleResourceRangeChange(l),r.trigger("resourceRangeChange",l)}}}refresh(e){this.scheduler.runWithTransition(()=>this.renderer(),e)}refreshResources(e){this.clearResources(e),this.refresh()}refreshEventsForResource(e,r=!0,t=!0){this.refreshResources([e.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:r,eventMap:t}=this;e.forEach(i=>{r.has(i)&&(Object.values(r.get(i)).forEach(({renderData:{eventId:n}})=>{delete t.get(n)[i]}),r.delete(i))})}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}};Od._$name="VerticalRendering";var VA={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"},Ei=class extends Ko.mixin(vw,iD,nD,sD,oD,lD,uD,aD,cD,hD,gD,MA){constructor(){super(...arguments),R(this,"timeCellSelector",".b-sch-timeaxis-cell"),R(this,"resourceTimeRangeSelector",".b-sch-resourcetimerange")}static get $name(){return"SchedulerBase"}static get type(){return"schedulerbase"}static get configurable(){return{date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",sortFeatureStore:"resourceStore"}}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:Cd,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){const e=this;super.afterConstruct(),e.ion({scroll:"onVerticalScroll",thisObj:e}),e.createEventOnDblClick&&e.ion({scheduledblclick:e.onTimeAxisCellDblClick})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,r;const t=this;return t.isVertical?t.currentOrientation.visibleResources:{first:t.store.getById((e=t.firstVisibleRow)==null?void 0:e.id),last:t.store.getById((r=t.lastVisibleRow)==null?void 0:r.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:e,resourceRecord:r,row:t}){this.createEvent(e,r,t)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return this.mode==="horizontal"}get isVertical(){return this.mode==="vertical"}get mode(){return this._mode}set mode(e){const r=this;r._mode=e,r[e]||(r.element.classList.add(`b-sch-${e}`),e==="horizontal"?(r.horizontal=new Xo(r),r.isPainted&&r.horizontal.init()):e==="vertical"&&(r.vertical=new Od(r),r.rendered&&r.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}get hasEventEditor(){return!!this.eventEditingFeature}get eventEditingFeature(){const{eventEdit:e,taskEdit:r,simpleEventEdit:t}=this.features;return e!=null&&e.enabled?e:r!=null&&r.enabled?r:t!=null&&t.enabled?t:null}editEvent(e,r,t){const i=this,{eventStore:n,assignmentStore:s}=i;if(!i.hasEventEditor)return!1;if(e.eventStore!==n){const{enableEventAnimations:a}=i,o=[];e.isCreating=!0;let l=[];if(r&&(o.push(r),l=s.assignEventToResource(e,r)),i.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:o,assignmentRecords:l})===!1)return s==null||s.remove(l),!1;i.enableEventAnimations=!1,n.add(e),i.project.commitAsync().then(()=>i.enableEventAnimations=a),i.refreshRows()}}async createEvent(e,r){var t,i;const n=this,{enableEventAnimations:s,eventStore:a,assignmentStore:o,hasEventEditor:l}=n,c=[r],d=n.createEventOnDblClick.useEventModelDefaults,u=d?a.modelClass.defaultValues.duration:1,h=d?a.modelClass.defaultValues.durationUnit:n.timeAxis.unit,f=a.createRecord({startDate:e,endDate:b.add(e,u,h),duration:u,durationUnit:h,name:n.L("L{Object.newEvent}")});if(n.readOnly||r.isSpecialRow||r.readOnly||!n.allowOverlap&&!n.isDateRangeAvailable(f.startDate,f.endDate,null,r))return;(t=n.eventEditingFeature)==null||t.captureStm(!0),f.isCreating=l,n.onEventCreated(f);const g=o==null?void 0:o.assignEventToResource(f,r);if(n.trigger("beforeEventAdd",{eventRecord:f,resourceRecords:c,assignmentRecords:g})===!1){o==null||o.remove(g),(i=n.eventEditingFeature)==null||i.freeStm(!1);return}n.enableEventAnimations=!1,a.add(f),n.project.commitAsync().then(()=>n.enableEventAnimations=s),n.isCreating=!0,n.refreshRows(),n.isCreating=!1,n.trigger("eventAutoCreated",{eventRecord:f,resourceRecord:r}),l&&n.editEvent(f,r,n.getEventElement(f))}isDateRangeAvailable(e,r,t,i){return this.eventStore.isDateRangeAvailable(e,r,t,i)}async resumeRefresh(e){super.resumeRefresh(!1);const r=this;if(!r.refreshSuspended&&e){if(!r.isEngineReady)return r.currentOrientation.refreshAllWhenReady=!0,r.project.commitAsync();r.isDestroyed||r.refreshWithTransition()}}toggleEmptyText(){var e;const r=this;r.bodyContainer&&C.toggleClasses(r.bodyContainer,"b-grid-empty",!(r.resourceStore.count>0||(e=r.crudManager)!=null&&e.isLoading))}getRowHeight(e){if(this.isHorizontal){const r=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,r),r}}calculateRowHeights(e,r=!1){e.forEach(t=>t&&this.getRowHeight(t)),r||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:r,rowManager:t}=this,i=Math.min(r.count,this.preCalculateHeightLimit);if(i){t.clearKnownHeights();for(let n=0;n<i;n++)this.getRowHeight(r.getAt(n));e||t.estimateTotalHeight(!0)}}get dateBounds(){const e=this,r=[e.startDate];return e.range==="week"&&r.push(e.lastDate),r}get defaultDescriptionFormat(){return VA[this.range]}get lastDate(){const e=this.endDate;return e&&b.add(e,-1,"day")}getEventRecord(e){return e=C.getEventElement(e),this.resolveEventRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeRange(e){return b.normalizeUnit(e)}updateRange(e){if(!this.isConfiguring){const r=this.date,t=this.date=b.startOf(r,e);r.getTime()===t.getTime()&&this.updateDate(t)}}changeStepUnit(e){return b.normalizeUnit(e)}updateDate(e){const r=this,t=b.startOf(e,r.range);r.setTimeSpan(t,b.add(t,1,r.range)),r.visibleDate={date:b.max(e,r.timeAxis.startDate),block:"start",animate:!0},r.trigger("descriptionChange")}previous(){this.date=b.add(this.date,-1,this.stepUnit)}next(){this.date=b.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:e,eventRecord:r,resourceRecord:t,element:i}){const n=this;if(n.eventStore.includes(r)||([r]=n.eventStore.add(r)),r.startDate=e,r.assign(t),i){const s=k.from(i,n.foregroundCanvas);C.setTranslateXY(i,0,0),C.setTopLeft(i,s.y,s.x),q.addChild(n.foregroundCanvas,i,r.assignments[0].id)}await n.project.commitAsync()}};Ei.initClass(),Ei._$name="SchedulerBase";var hm=class extends Ve(Uc){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...r){super.construct(e,...r),this.eventSortFn||(this.eventSortFn=(t,i)=>t.internalId-i.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map(r=>typeof r=="string"?{field:r}:r)}generateExportData(e){const r=this,t=this.target instanceof Ei,i=r.generateColumns(e),n=t?r.generateEventColumns(e):[],s=i.concat(n),a=r.generateRows(e);return{columns:s,rows:a}}generateEventColumns(e){return e.eventColumns.map(r=>this.processEventColumn(r,e))}processEventColumn(e,r){const{width:t,minWidth:i}=e,{defaultColumnWidth:n}=r;return{field:e.field,value:e.text,width:Math.max(t||n,i||n),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const r=this,{target:t}=r;let i;if(!(t instanceof Ei))i=super.generateRows(e);else{if(i=[],t.resourceStore.map(n=>{const s=n.events||[];s.sort(r.eventSortFn),s.length||s.push(""),s.forEach(a=>i.push(r.getRowData(e,n,a)))}),e.includeUnassigned&&e.eventColumns.length){const n=t.eventStore.query(s=>!s.resources.length);if(n.length){const s=new Array(e.columns.length).fill("");s.push(r.L("L{ExcelExporter.No resource assigned}")),i.push(s),n.forEach(a=>i.push(r.getRowData(e,null,a)))}}i=i.filter(n=>n.length)}return i}getRowData(e,r,t){const{columns:i,eventColumns:n}=e,s=[],a=this.processRecord(r,i,e);if(a&&s.push(...a),!r||!r.isSpecialRow){const o=this.processRecord(t,n,e);o&&s.push(...o)}return s}};hm._$name="ScheduleTableExporter";var fm=class extends Gc{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:hm,exporterConfig:null}}};fm._$name="ExcelExporter",z.registerFeature(fm,!1,"Scheduler");var gm=class extends Ei{static get $name(){return"Scheduler"}static get type(){return"scheduler"}};gm.initClass(),gm._$name="Scheduler";var mm=class extends qe{static get $name(){return"ProjectCombo"}static get type(){return"projectcombo"}static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1}}updateProject(e){var r;(r=e.transport.load)!=null&&r.url&&(this.value=e.transport.load.url)}onChange({value:e,userAction:r}){r&&this.project&&(this.project.transport.load.url=e,this.project.load())}};mm.initClass(),mm._$name="ProjectCombo";var pm=class extends di{static get $name(){return"ResourceFilter"}static get type(){return"resourcefilter"}static get delayable(){return{applyFilters:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,toggleAllIfCtrlPressed:!0,itemTpl:e=>L.encodeHtml(e.name||""),masterFilter:()=>!0,filterResources:null}}itemIconTpl(e,r){const{eventColor:t}=e,i=C.isNamedColor(t)?` b-sch-foreground-${t}`:"",n=!i&&t?` style="color:${t}"`:"";return this.multiSelect?`<div class="b-selected-icon b-icon${i}"${n}></div>`:""}updateEventStore(e){var r,t;const i=this,n=(r=i.initialConfig.store)!=null&&r.isStore?i.initialConfig.store.initialConfig:(t=i.store)==null?void 0:t.config,{resourceStore:s}=e,a=i.store=s.chain(i.masterFilter,null,{...n,syncOrder:!0}),o={change:"onStoreChange",thisObj:i};a.un(o),s.ion(o),s.count?i.initFilter():s.project.ion({name:"project",refresh:"initFilter",thisObj:i})}changeMasterFilter(e){const r=this;if(!r.filterResources)return function(t){return r.callback(e,r,[t])}}initFilter(){const{eventStore:e,selected:r}=this;e.count&&e.resourceStore.count&&(this.initialSelection||r.add(this.store.getRange()),this.detachListeners("project"))}onStoreRefresh({source:e,action:r}){if(r==="filter"&&this.eventStoreFilter){const{eventStoreFilter:t}=this,{disabled:i}=t,n=!e.isFiltered&&this.allSelected;n!==i&&(t.disabled=n,this.applyFilters())}super.onStoreRefresh(...arguments)}onSelectionChange({source:e,added:r,removed:t}){const i=this,n=!i.store.isFiltered&&i.allSelected;super.onSelectionChange(...arguments);let s=!1;if(i.eventStoreFilter||(i.eventStoreFilter=i.eventStore.addFilter({id:`${i.id}-filter-instance`,filterBy:a=>!a.resource||i.selected.includes(a.resources),disabled:n},(r==null?void 0:r.length)===i.store.count),s=!0),i.filterResources&&!i.resourceStoreFilter&&(i.resourceStoreFilter=i.eventStore.resourceStore.addFilter({id:`${i.id}-filter-instance`,filterBy:a=>i.selected.includes(a),disabled:n},(r==null?void 0:r.length)===i.store.count),s=!0),!s&&(i.eventStoreFilter.disabled=n,i.resourceStoreFilter&&(i.resourceStoreFilter.disabled=n),i.applyFilters(),i.eventListeners.change)){const a=e.values,o=a.concat(t);H.remove(o,r),i.triggerFieldChange({value:a,oldValue:o})}}get value(){return this.selected.values}applyFilters(){this.eventStore.filter(),this.filterResources&&this.eventStore.resourceStore.filter()}doDestroy(){var e;(e=this.store)==null||e.destroy(),super.doDestroy()}};pm.initClass(),pm._$name="ResourceFilter";var Ld=class extends eo{static get $name(){return"SchedulerDatePicker"}static get type(){return"datepicker"}static get configurable(){return{showEvents:null,eventStore:null,eventFilter:{$config:"lazy",value:null}}}construct(e){"events"in e&&(e={...e,showEvents:e.events},delete e.events,re.deprecate(re.calendar?"Calendar":"Scheduler","6.0.0","DatePicker#events should be configured as showEvents")),super.construct(e)}changeEventFilter(e){if(typeof e=="string"){const{handler:r,thisObj:t}=this.resolveCallback(e);e=r.bind(t)}return e}doRefresh(){if(this.isVisible||!this.showEvents)return this.refreshEventsMap(),super.doRefresh(...arguments);this.whenVisible("doRefresh")}updateShowEvents(e,r){const t=this,{classList:i}=t.contentElement;let{eventStore:n}=t;if(t.requestAnimationFrame(()=>{var s;t.element.classList.toggle("b-datepicker-with-events",!!e),(s=t.owner)==null||s.element.classList.toggle("b-datepicker-with-events",!!e),e&&i.add(`b-show-events-${e}`),i.remove(`b-show-events-${r}`)}),e){if(!n){const s=t.up(a=>a.eventStore);if(s)n=s.eventStore;else throw new Error("DatePicker configured with events but no eventStore")}}else t.eventsMap=null;t.isConfiguring||(t.updateEventStore(n),t.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap,filter:e.eventFilter}))}updateEventStore(e){var r;e.findListener("change","refresh",this)===-1&&((r=e==null?void 0:e[this.showEvents?"on":"un"])==null||r.call(e,{change:"refresh",thisObj:this}))}cellRenderer({cell:e,date:r}){var t,i;const{showEvents:n}=this,s=(i=(t=this.eventCounts)==null?void 0:t.get)==null?void 0:i.call(t,b.makeKey(r)),a=n==="count";delete e.dataset.btip,s&&(!a&&this.eventCountTip&&(e.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",s)),C.createElement({dataset:{count:s},class:{[a?"b-cell-events-badge":"b-icon b-icon-circle"]:1,[Ld.getEventCountClass(s)]:1},parent:e,[a?"text":""]:s}))}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-calendar-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}};Ld.initClass(),Ld._$name="SchedulerDatePicker";var NA=e=>e.isProjectConsumer,$d=class extends Dc{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(NA))}changeScheduler(e){return e.isProjectConsumer?e:$d.getById(e)}updateScheduler(e){const{crudManager:r}=e;e.ion({projectChange:"onProjectChanged",thisObj:this}),r?this.setupLoadListener(r):this.onLoad(),this.stm=e.project.stm}setupLoadListener(e){e.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}async onLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}onProjectChanged({project:e}){this.project=e}updateProject(e){super.updateProject(...arguments),e&&this.scheduler&&!this.scheduler.isConfiguring&&this.setupLoadListener(e)}};$d.initClass(),$d._$name="UndoRedo";var Gs=class extends qe{construct(){super.construct(...arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up(e=>e.isTimelineBase)||$.query(e=>e.isTimelineBase)}changeValue(e,r){return this.getConfig("presets"),super.changeValue(e,r)}updatePresets(e){this.store=this.scheduler.presets.chain(r=>e.includes(r.id)),this.store.sort((r,t)=>e.indexOf(r.id)-e.indexOf(t.id))}onClientPresetChange({preset:e}){const r=this;r._isSelecting||(r.isSettingValue=!0,r.store.includes(e.id)?r.value=e:r.clear(),r.isSettingValue=!1)}onSelect({record:e}){var r;if(!this.isSettingValue){const{scheduler:t}=this,{mainUnit:i,start:n,defaultSpan:s}=e;if(t.suspendRefresh(),this._isSelecting=!0,t.viewPreset=e,this._isSelecting=!1,i&&s){let a=i;n&&typeof n=="string"&&(a=(r=b.parseTimeUnit(n))!=null?r:n);let o=b.startOf(t.startDate,a);e.start&&typeof n=="number"&&(o=b.add(o,n,i));const l=b.add(o,s,i);t.setTimeSpan(o,l)}t.isVertical?t.scrollTop=0:t.scrollLeft=0,t.resumeRefresh(!0)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}};R(Gs,"$name","ViewPresetCombo"),R(Gs,"type","viewpresetcombo"),R(Gs,"configurable",{presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"}),Gs.initClass(),Gs._$name="ViewPresetCombo";var zA=-Math.pow(2,30),xi=Math.pow(2,30)-1,vm=e=>e.slice(0,1).toUpperCase()+e.slice(1),jd=e=>Object(e)!==e,Bd=(e,r,t)=>(Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0}),t),fe=e=>function(r,t){r[t]=e},WA=(e,r)=>{for(const t of e)r.add(t);return r},Zo=e=>new Promise(r=>setTimeout(r,e)),UA=function*(e,r){let t;for(;(t=e.exec(r))!==null;)yield t},ym=null,bm=function(e){return ym===null&&(ym=typeof regeneratorRuntime!="undefined"),ym===!0?regeneratorRuntime.isGeneratorFunction(e):e.constructor.name==="GeneratorFunction"},Hd=function(e){return e&&typeof e.then=="function"},Ys=!1,GA=(...e)=>{},Vd=e=>Ys?e:GA,YA=Vd(e=>{debugger}),Jo=Vd(e=>{typeof console!="undefined"&&console.warn(e)}),qA=class extends We{},vD=class extends We{constructor(){super(...arguments),this.stackEntries=[]}static fromError(e){return vD.new({exception:e,stackEntries:KA(e.stack)})}static fromThisCall(){const e=this.fromError(new Error);return e.stackEntries.splice(0,2),e}},KA=e=>ot(UA(/^   +at\s*(.*?)\s*\((https?:\/\/.*?):(\d+):(\d+)/gm,e)).map(r=>qA.new({statement:r[1],sourceFile:r[2],sourceLine:Number(r[3]),sourceCharPos:Number(r[4])})).toArray(),Cm=Symbol("RequiredProperties"),yD=Vd((e,r)=>{let t=e[Cm];t||(t=e[Cm]=[]),t.push(r)}),bD=Vd(e=>{const r=e[Cm];if(r){for(let t=0;t<r.length;t++)if(e[r[t]]===void 0)throw new Error(`Required attribute [${String(r[t])}] is not provided`)}}),wr;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(wr||(wr={}));var CD=Symbol("WalkSource"),qs=-1,Sn=-2,Sm=class extends We{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map(r=>({node:r,from:CD,label:void 0}))),this.walkDepth()}onNode(e,r){}onTopologicalNode(e){}onCycle(e,r){return wr.Cancel}forEachNext(e,r){throw new Error("Abstract method called")}collectNext(e,r,t){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,r,t){return t?(t.visitedAt=r,t.visitEpoch=this.currentEpoch):(t={visitedAt:r,visitEpoch:this.currentEpoch},this.visited.set(e,t)),t}walkDepth(){const e=this.visited,r=this.toVisit;let t;for(;t=r.length;){const i=r[t-1].node,n=this.getVisitedInfo(i);if(n&&n.visitedAt===Sn&&n.visitEpoch===this.currentEpoch){r.pop();continue}if(n&&n.visitEpoch===this.currentEpoch&&n.visitedAt!==qs){if(n.visitedAt<t){if(this.onCycle(i,r)!==wr.Resume)break}else n.visitedAt=Sn,this.onTopologicalNode(i);r.pop()}else{if(this.onNode(i,r[t-1])===!1)break;const s=this.setVisitedInfo(i,t,n),a=r.length;this.collectNext(i,r,s),r.length===a&&(s.visitedAt=Sn,this.onTopologicalNode(i),r.pop())}}}};function SD(e){const r=e.length;if(r===0)return[];const t=e[r-1].node,i=[t];let n=r-1,s=n;for(;n>=0&&e[n].from!==t;){for(;n>=0&&e[n].from===e[s].from;)n--;n>=0&&(i.push(e[n].node),s=n)}return n<0?[]:(i.push(t),i.reverse())}var XA=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},wD=0,Et=wD++,Ge=class extends We{constructor(){super(...arguments),this.formulaId=wD++,this.inputs=new Set}},DD=class extends Sm{collectNext(e,r){if(e instanceof Ge)r.push({node:e.output,from:e,label:void 0});else{const t=this.cache.formulasByInput.get(e);t&&t.forEach(i=>r.push({node:i,from:e,label:void 0}))}}},Nd=class extends G([We],e=>class extends e{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return this.$formulasByInput!==void 0?this.$formulasByInput:(this.fillCache(),this.$formulasByInput)}get formulasByOutput(){return this.$formulasByOutput!==void 0?this.$formulasByOutput:(this.fillCache(),this.$formulasByOutput)}add(t){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(t)}has(t){return this.formulas.has(t)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach(t=>{let i=this.$formulasByOutput.get(t.output);i||(i=new Set,this.$formulasByOutput.set(t.output,i)),i.add(t),t.inputs.forEach(n=>{let s=this.$formulasByInput.get(n);s||(s=new Set,this.$formulasByInput.set(n,s)),s.add(t)})})}allInputVariables(){return US(YS(Jc(this.formulas,t=>t.inputs.values())))}isCyclic(){let t=!1;return DD.new({cache:this,onCycle:()=>(t=!0,wr.Cancel)}).startFrom(Array.from(this.allInputVariables())),t}}){},Ks=class extends Nd{},Dr=class extends We{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const r=this.resolutionsByInputHash.get(e.hash);if(r!==void 0)return r;const t=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,t),t}buildResolution(e){const r=Dm.new({context:this,input:e}),t=Array.from(r.next()).map(i=>({resolution:i.asResolution(),nbrOfDefaultFormulas:Array.from(i.activatedFormulas.formulas).reduce((n,s)=>i.formulaIsDefault(s)?n+1:n,0),unCoveredInputWeight:i.unCoveredInputWeight()}));if(t.sort((i,n)=>i.unCoveredInputWeight<n.unCoveredInputWeight?-1:i.unCoveredInputWeight>n.unCoveredInputWeight?1:n.nbrOfDefaultFormulas-i.nbrOfDefaultFormulas),t.length>0)return t[0].resolution;debugger}},Er;(function(e){e[e.NoInput=0]="NoInput",e[e.HasPreviousValue=1]="HasPreviousValue",e[e.HasProposedValue=2]="HasProposedValue",e[e.KeepIfPossible=4]="KeepIfPossible"})(Er||(Er={}));var wm=class extends We{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return this.$hash!==""?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),bD(this),this.input=new Map(ot(this.description.variables).map(r=>[r,Er.NoInput]))}buildHash(){return String.fromCharCode(...ot(this.description.variables).inBatchesBySize(5).map(e=>this.batchToCharCode(e)))}batchToCharCode(e){return e.reduceRight((r,t,i)=>r|this.input.get(t)<<i*3,0)}addProposedValueFlag(e){if(Ys){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const r=this.input.get(e);this.input.set(e,r|Er.HasProposedValue)}hasProposedValue(e){return!!(this.input.get(e)&Er.HasProposedValue)}hasProposedValueVars(){return ot(this.description.variables).filter(e=>this.hasProposedValue(e))}addPreviousValueFlag(e){if(Ys){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const r=this.input.get(e);this.input.set(e,r|Er.HasPreviousValue)}hasPreviousValue(e){return!!(this.input.get(e)&Er.HasPreviousValue)}hasPreviousValueVars(){return ot(this.description.variables).filter(e=>this.hasPreviousValue(e))}addKeepIfPossibleFlag(e){if(Ys){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(this.$hash!=="")throw new Error("Already hashed")}const r=this.input.get(e);this.input.set(e,r|Er.KeepIfPossible)}keepIfPossible(e){return!!(this.input.get(e)&Er.KeepIfPossible)}keepIfPossibleVars(){return ot(this.description.variables).filter(e=>this.keepIfPossible(e))}};XA([yD],wm.prototype,"context",void 0);var Dm=class extends We{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(this.$activatedFormulas!==void 0)return this.$activatedFormulas;const e=Nd.new({variables:this.description.variables,formulas:ot(this.thisAndPreviousStates()).map(r=>r.activatedFormula).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some(r=>this.input.hasProposedValue(r))}unCoveredInputWeight(){const e=Jc(this.input.hasProposedValueVars(),i=>({variable:i,isProposed:!0})),r=Jc(this.input.keepIfPossibleVars(),i=>({variable:i,isProposed:!1}));return ot([e,r]).concat().uniqueOnlyBy(i=>i.variable).reduce((i,{variable:n,isProposed:s})=>{let a=0;const o=this.activatedFormulas.formulasByOutput.get(n);if(o){const c=o.size===1?Array.from(o)[0]:null;c&&this.formulaIsDefault(c)&&this.formulaHasProposedValueInInput(c)?s?a+=1e6:a+=1e4:s?a+=1e7:a+=1e5}const l=this.activatedFormulas.formulasByInput.get(n);return l&&l.size>0||(s?a+=1e3:a+=100),i+a},0)}preferFormula(e,r){const t=this.formulaAllInputsHasProposed(e),i=this.formulaAllInputsHasProposed(r);if(t&&!i)return-1;if(i&&!t)return 1;const n=this.formulaCountInputsWithProposedOrKeep(e),s=this.formulaCountInputsWithProposedOrKeep(r);return n>s?-1:n<s?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(r)?-1:this.formulaIsDefault(r)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let r=0;return Array.from(e.inputs).forEach(t=>{(this.input.hasProposedValue(t)||this.input.keepIfPossible(t))&&r++}),r}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every(r=>this.input.hasProposedValue(r)||this.input.keepIfPossible(r))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every(r=>this.input.hasProposedValue(r))}formulaIsApplicable(e){const r=Array.from(e.inputs).every(i=>this.input.hasProposedValue(i)||this.input.hasPreviousValue(i)||this.activatedFormulas.formulasByOutput.has(i)),t=Nd.new({formulas:new Set(this.activatedFormulas.formulas)});return t.add(e),r&&!t.isCyclic()}formulaIsInsignificant(e){const r=this.activatedFormulas.formulasByOutput.has(e.output),t=this.input.hasPreviousValue(e.output);return r||t&&Array.from(e.inputs).some(i=>!this.input.hasPreviousValue(i)&&!this.input.hasProposedValue(i)&&!this.activatedFormulas.formulasByOutput.has(i))}unvisitedFormulas(){return Array.from(this.description.formulas).filter(e=>!this.activatedFormulas.has(e))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let r=!0;for(const t of e){if(!this.formulaIsApplicable(t)||this.formulaIsInsignificant(t))continue;yield*Dm.new({previous:this,context:this.context,input:this.input,activatedFormula:t}).next(),r=!1}r&&(yield this)}asResolution(){return new Map(ot(this.description.variables).map(e=>{const r=this.activatedFormulas.formulasByOutput.get(e);if(r)for(const t of r)return[e,t.formulaId];return[e,Et]}))}},Qo=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Xs=Symbol("BreakCurrentStackExecution"),et=class extends We{};Qo([fe(!0)],et.prototype,"sync",void 0),Qo([fe(!0)],et.prototype,"pure",void 0);var Em=Symbol("ProposedOrPreviousSymbol"),we=et.new({handler:Em}),el=Symbol("RejectSymbol"),Zs=class extends et{constructor(){super(...arguments),this.handler=el}};Qo([fe(!1)],Zs.prototype,"pure",void 0);var wn=e=>Zs.new({reason:e}),xm=Symbol("TransactionSymbol"),ZA=et.new({handler:xm}),Rm=Symbol("OwnQuarkSymbol"),JA=et.new({handler:Rm}),Tm=Symbol("OwnIdentifierSymbol"),QA=et.new({handler:Tm}),Mm=Symbol("WriteSymbol"),Pm=class extends et{constructor(){super(...arguments),this.handler=Mm}};Qo([fe(!1)],Pm.prototype,"pure",void 0);var ED=(e,r,...t)=>Pm.new({identifier:e,proposedArgs:[r,...t]}),Im=Symbol("WriteSeveralSymbol"),Am=class extends et{constructor(){super(...arguments),this.handler=Im}};Qo([fe(!1)],Am.prototype,"pure",void 0);var xD=e=>Am.new({writes:e}),_m=Symbol("PreviousValueOfSymbol"),RD=class extends et{constructor(){super(...arguments),this.handler=_m}},zd=e=>RD.new({identifier:e}),Fm=Symbol("ProposedValueOfSymbol"),TD=class extends et{constructor(){super(...arguments),this.handler=Fm}},MD=e=>TD.new({identifier:e}),km=Symbol("HasProposedValueSymbol"),PD=class extends et{constructor(){super(...arguments),this.handler=km}},xr=e=>PD.new({identifier:e}),Om=Symbol("HasProposedNotPreviousValueSymbol"),ID=class extends et{constructor(){super(...arguments),this.handler=Om}},AD=e=>ID.new({identifier:e}),Lm=Symbol("ProposedOrPreviousValueOfSymbol"),_D=class extends et{constructor(){super(...arguments),this.handler=Lm}},Ke=e=>_D.new({identifier:e}),$m=Symbol("ProposedArgumentsOfSymbol"),FD=class extends et{constructor(){super(...arguments),this.handler=$m}},Dn=e=>FD.new({identifier:e}),jm=Symbol("UnsafeProposedOrPreviousValueOfSymbol"),kD=class extends et{constructor(){super(...arguments),this.handler=jm}},e_=e=>kD.new({identifier:e}),Bm=Symbol("UnsafePreviousValueOfSymbol"),OD=class extends et{constructor(){super(...arguments),this.handler=Bm}},t_=e=>OD.new({identifier:e}),LD=class extends wm{collectInfo(e,r,t){e(zd(r))!=null&&this.addPreviousValueFlag(t),e(AD(r))&&this.addProposedValueFlag(t)}},r_=Symbol("ContextSync"),i_=Symbol("ContextGen"),$D=class extends G([],e=>class extends e{constructor(){super(...arguments),this.iterator=void 0,this.iterationResult=void 0}isCalculationStarted(){return!!(this.iterator||this.iterationResult)}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...i){const n=this.iterator=this.calculation.call(this.context||this,t,...i);return this.iterationResult=n.next()}continueCalculation(t){return this.iterationResult=this.iterator.next(t)}cleanupCalculation(){this.iterationResult=void 0,this.iterator=void 0}*calculation(t,...i){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...i){for(this.startCalculation(t,...i);!this.isCalculationCompleted();)this.continueCalculation(t(this.iterationResult.value));return this.iterator=void 0,this.result}async runAsyncWithEffect(t,...i){for(this.startCalculation(t,...i);!this.isCalculationCompleted();)this.continueCalculation(await t(this.iterationResult.value));return this.iterator=void 0,this.result}}){},Wd=Symbol("SynchronousCalculationStarted"),n_={value:Wd},jD=class extends G([],e=>class extends e{constructor(){super(...arguments),this.iterationResult=void 0}isCalculationStarted(){return!!this.iterationResult}isCalculationCompleted(){return!!(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(t,...i){return this.iterationResult=n_,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,t,...i)}}continueCalculation(t){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=void 0}calculation(t,...i){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(t,...i){return this.startCalculation(t,...i),this.result}async runAsyncWithEffect(t,...i){throw new Error("Can not run synchronous calculation asynchronously")}}){};function BD(e,r,t,i){const n=r.apply(i||null,t);let s=n.next();for(;!s.done;)s=n.next(e(s.value));return s.value}async function tl(e,r,t,i){const n=r.apply(i||null,t);let s=n.next();for(;!s.done;){let a,o=!1;do{o=!1;try{a=e(s.value)}catch(l){if(l instanceof et)if(await e(l)==="Cancel"){e(wn(l));return}else o=!0}}while(o);Hd(a)?s=n.next(await a):s=n.next(a)}return s.value}var Js;(function(e){e[e.Normal=1]="Normal",e[e.Past=2]="Past"})(Js||(Js={}));var s_=0,Ud=class extends QS([Map],e=>class extends e{constructor(){super(...arguments),this.createdAt=void 0,this.identifier=void 0,this.value=void 0,this.proposedValue=void 0,this.proposedIsPrevious=!1,this.proposedArguments=void 0,this.usedProposedOrPrevious=!1,this.previous=void 0,this.origin=void 0,this.originId=zA,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=qs,this.visitEpoch=0,this.promise=void 0,this.$outgoingPast=void 0}static new(t){const i=new this;return t&&Object.assign(i,t),i}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=xi}cleanup(){this.cleanupCalculation()}isShadow(){return!!(this.origin&&this.origin!==this)}resetToEpoch(t){this.visitEpoch=t,this.visitedAt=qs,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),this.clearOutgoing(),this.promise=void 0,this.origin&&this.origin===this?(this.proposedArguments=void 0,this.value!==void 0&&(this.proposedValue=this.value),this.value=void 0):(this.origin=void 0,this.value=void 0),this.identifier.proposedValueIsBuilt&&this.proposedValue!==Se&&(this.needToBuildProposedValue=!0,this.proposedValue=void 0)}copyFrom(t){this.value=t.value,this.proposedValue=t.proposedValue,this.proposedArguments=t.proposedArguments,this.usedProposedOrPrevious=t.usedProposedOrPrevious}clearProperties(){this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0}mergePreviousOrigin(t){const i=this.origin;if(i!==this.previous)throw new Error("Invalid state");this.copyFrom(i);const n=this.getOutgoing();for(const[s,a]of i.getOutgoing())if(!n.get(s)){const l=t.get(s);(!l||l.originId===a.originId)&&n.set(s,l||a)}if(i.$outgoingPast!==void 0){const s=this.getOutgoingPast();for(const[a,o]of i.getOutgoingPast())if(!s.get(a)){const c=t.get(a);(!c||c.originId===o.originId)&&s.set(a,c||o)}}this.origin=this,i.clearProperties(),i.clear()}setOrigin(t){this.origin=t,this.originId=t.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=s_++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return this.$outgoingPast!==void 0?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(t,i){(i===Js.Normal?this:this.getOutgoingPast()).set(t.identifier,t)}clearOutgoing(){this.clear(),this.$outgoingPast!==void 0&&this.$outgoingPast.clear()}getValue(){const t=this.origin;return t===this?this.value:t?t.getValue():void 0}setValue(t){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=t}hasValue(){return this.getValue()!==void 0}hasProposedValue(){return this.isShadow()?!1:this.hasProposedValueInner()}hasProposedValueInner(){return this.proposedValue!==void 0}getProposedValue(t){return this.needToBuildProposedValue&&(this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,t),this.needToBuildProposedValue=!1),this.proposedValue}outgoingInTheFutureCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values())s.originId===t.getLatestEntryFor(s.identifier).originId&&i(s);n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureAndPastCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values()){const a=t.getLatestEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}if(n.$outgoingPast!==void 0)for(const s of n.$outgoingPast.values()){const a=t.getLatestEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureAndPastTransactionCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values()){const a=t.getLatestStableEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}if(n.$outgoingPast!==void 0)for(const s of n.$outgoingPast.values()){const a=t.getLatestStableEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}n.isShadow()?n=n.previous:n=null}}outgoingInTheFutureTransactionCb(t,i){let n=this;for(;n;){for(const s of n.getOutgoing().values()){const a=t.getLatestEntryFor(s.identifier);a&&s.originId===a.originId&&i(s)}n.isShadow()?n=n.previous:n=null}}}){},Se=Symbol("Tombstone"),Qs=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Rr;(function(e){e[e.UserInput=0]="UserInput",e[e.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",e[e.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",e[e.DependsOnSelfKind=3]="DependsOnSelfKind"})(Rr||(Rr={}));var rl=class extends We{constructor(){super(...arguments),this.name=void 0,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,r){return e===r}};Qs([fe(Rr.DependsOnSelfKind)],rl.prototype,"level",void 0),Qs([fe(!0)],rl.prototype,"sync",void 0);var Wt=class extends rl{constructor(){super(...arguments),this.context=void 0,this.isWritingUndefined=!1}newQuark(e){const r=this.quarkClass.new();return r.createdAt=e,r.identifier=this,r.needToBuildProposedValue=this.proposedValueIsBuilt,r}write(e,r,t,i,...n){t=t||r.getWriteTarget(e),t.proposedValue=i,t.proposedArguments=n.length>0?n:void 0,t.proposedIsPrevious=r.graph.isWritingPreviousData}writeToTransaction(e,r,...t){e.write(this,r,...t)}writeToGraph(e,r,...t){e.write(this,r,...t)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,r,t){}enterGraph(e){}leaveGraph(e){}},a_=e=>Wt.new(e),ea=Ud.mix(jD.mix(Map)),HD=Ud.mix($D.mix(Map)),il=class extends Wt{calculation(e){throw new Error("The 'calculation' method of the variables should never be called. Instead, the value will be set directly to quark")}write(e,r,t,i,...n){t=t||r.getWriteTarget(e),t.value=i,t.proposedArguments=n.length>0?n:void 0}};Qs([fe(Rr.UserInput)],il.prototype,"level",void 0),Qs([fe(ea)],il.prototype,"quarkClass",void 0);function Hm(...e){return il.new(...e)}var ta=class extends Wt{calculation(e){return e(we)}};Qs([fe(ea)],ta.prototype,"quarkClass",void 0);function Vm(...e){return ta.new(...e)}var ur=class extends Wt{*calculation(e){return yield we}};Qs([fe(HD)],ur.prototype,"quarkClass",void 0);function Nm(...e){return ur.new(...e)}var hr=e=>{throw new Error(`Unknown identifier ${e}`)},o_=0,Gd=class extends We{constructor(){super(...arguments),this.createdAt=o_++,this.name="revision-"+this.createdAt,this.previous=void 0,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let r=this;for(;r;){const t=r.scope.get(e);if(t)return t;r=r.previous}return null}hasIdentifier(e){const r=this.getLatestEntryFor(e);return!!(r&&r.getValue()!==Se)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}},l_=class{constructor(){this.length=0,this.levels=[],this.lowestLevel=xi}getLowestLevel(){for(let e=this.lowestLevel!==xi?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=xi}takeLowestLevel(){for(let e=this.lowestLevel!==xi?this.lowestLevel:0;e<this.levels.length;e++){const r=this.levels[e];if(r)return this.length-=r.length,this.levels[e]=null,this.lowestLevel=e+1,r}}pop(){for(let e=this.lowestLevel!==xi?this.lowestLevel:0;e<this.levels.length;e++){const r=this.levels[e];if(this.lowestLevel=e,r&&r.length>0)return this.length--,r.pop()}this.lowestLevel=xi}push(e){const r=e.level;let t=this.levels[r];if(!t){for(let i=this.levels.length;i<r;i++)this.levels[i]=null;t=this.levels[r]=[]}t.push(e),this.length++,r<this.lowestLevel&&(this.lowestLevel=r)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const r=this.levels[e];r&&(yield*r)}}},Yd=class extends We{toString(){const e=[],r=[];return this.cycle.forEach(({name:t,context:i})=>{e.push(t),r[r.length-1]!==i&&r.push(i)}),`events: 
`+r.map(t=>"#"+t.id).join(" => ")+`

identifiers: 
`+e.join(`
`)}},VD=class extends Sm{constructor(){super(...arguments),this.transaction=void 0}onCycle(e,r){return wr.Cancel}doCollectNext(e,r,t){let i=this.visited.get(r);i||(i={visitedAt:qs,visitEpoch:this.currentEpoch},this.visited.set(r,i)),t.push({node:r,from:e,label:void 0})}collectNext(e,r){const t=this.transaction.getLatestEntryFor(e);t&&t.outgoingInTheFutureTransactionCb(this.transaction,i=>{this.doCollectNext(e,i.identifier,r)})}},ND=class extends We{constructor(){super(...arguments),this.visited=new Map,this.transaction=void 0,this.baseRevision=void 0,this.pushTo=void 0,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(e,r){!e.lazy&&e.level!==Rr.UserInput&&this.pushTo.push(r)}onCycle(e,r){return wr.Resume}doCollectNext(e,r,t){let i=this.visited.get(r);i||(i=r.newQuark(this.baseRevision),i.visitEpoch=this.currentEpoch,this.visited.set(r,i)),t.push(r)}collectNext(e,r,t){const i=this.baseRevision.getLatestEntryFor(e);i&&(t.previous=i,i.outgoingInTheFutureAndPastTransactionCb(this.transaction,n=>{this.doCollectNext(e,n.identifier,r)}));for(const n of t.getOutgoing().keys())this.doCollectNext(e,n,r);if(t.$outgoingPast!==void 0)for(const n of t.getOutgoingPast().keys())this.doCollectNext(e,n,r)}walkDepth(){const e=this.visited,r=this.toVisit;let t;for(;t=r.length;){const i=r[t-1];let n=e.get(i);if(n&&n.visitedAt===Sn&&n.visitEpoch===this.currentEpoch){n.edgesFlow++,r.pop();continue}if(n&&n.visitEpoch===this.currentEpoch&&n.visitedAt!==qs){if(n.visitedAt<t){if(this.onCycle(i,r)!==wr.Resume)break;n.edgesFlow++}else n.visitedAt=Sn,this.onTopologicalNode(i,n);r.pop()}else{const s=r.length;n||(n=i.newQuark(this.baseRevision),n.visitEpoch=this.currentEpoch,e.set(i,n)),this.collectNext(i,r,n),n.visitEpoch<this.currentEpoch&&n.resetToEpoch(this.currentEpoch),n.visitedAt=t,n.edgesFlow++,r.length===s&&(n.visitedAt=Sn,this.onTopologicalNode(i,n),r.pop())}}}},nl=Js.Normal,En=Js.Past,zm=class extends We{constructor(){super(...arguments),this.baseRevision=void 0,this.candidateClass=Gd,this.candidate=void 0,this.graph=void 0,this.isClosed=!1,this.walkContext=void 0,this.entries=new Map,this.stackGen=new l_,this.activeStack=[],this.onEffectSync=void 0,this.onEffectAsync=void 0,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=void 0,this.stopped=!1,this.hasEntryWithProposedValue=!1,this.hasVariableEntry=!1}initialize(...e){super.initialize(...e),this.walkContext=ND.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const r=this.entries.get(e);r&&r.getValue()===Se||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return Hd(e)?e:this.graph[e.handler](e,this)}yieldSync(e){if(Hd(e))throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}readAsync(e){if(!(e instanceof Wt))return this.yieldAsync(e);let r;const t=this.getActiveEntry();if(t)r=this.addEdge(e,t,nl);else if(r=this.entries.get(e),!r){const i=this.baseRevision.getLatestEntryFor(e);i||hr(e),r=i.hasValue()?i:this.touch(e)}return r.hasValue()?r.getValue():r.promise?r.promise:((!r.previous||!r.previous.hasValue())&&r.forceCalculation(),this.ongoing=r.promise=this.ongoing.then(()=>(async()=>{for(;this.stackGen.lowestLevel<e.level;)await tl(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);if(this.markSelfDependent(),r.getValue()===void 0)return tl(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[r]],this)})()).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);if(!r.hasValue())throw new Error("Computation cycle. Sync");return r.getValue()}))}get(e){if(!(e instanceof Wt))return this.yieldSync(e);let r;const t=this.getActiveEntry();if(t)r=this.addEdge(e,t,nl);else if(r=this.entries.get(e),!r){const n=this.baseRevision.getLatestEntryFor(e);n||hr(e),r=n.hasValue()?n:this.touch(e)}const i=r.getValue();if(i===Se&&hr(e),i!==void 0&&r.hasValue())return i;if(r.promise)return r.promise;for((!r.previous||!r.previous.hasValue())&&r.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[r]);const n=r.getValue();if(n===void 0)throw new Error("Cycle during synchronous computation");return n===Se&&hr(e),n}else{const n=this.ongoing=r.promise=this.ongoing.then(()=>{if(r.getValue()===void 0)return tl(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[r]],this)}).then(()=>{if(this.rejectedWith)throw new Error(`Transaction rejected: ${String(this.rejectedWith.reason)}`);const s=r.getValue();if(s===void 0)throw new Error("Computation cycle. Async get");return s===Se&&hr(e),s});return Ys&&(n.quark=r),n}}read(e){if(!(e instanceof Wt))return this.yieldSync(e);let r;const t=this.getActiveEntry();if(t)r=this.addEdge(e,t,nl);else if(r=this.entries.get(e),!r){const s=this.baseRevision.getLatestEntryFor(e);s||hr(e),r=s.hasValue()?s:this.touch(e)}const i=r.getValue();if(i===Se&&hr(e),i!==void 0)return i;for((!r.previous||!r.previous.hasValue())&&r.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[r]);const n=r.getValue();if(n===void 0)throw new Error("Cycle during synchronous computation");return n===Se&&hr(e),n}readCurrentOrProposedOrPrevious(e){const r=this.entries.get(e);if(r){const t=r.getValue();if(t!==void 0)return t;if(r.proposedValue!==void 0)return r.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const r=this.entries.get(e);if(r){const t=r.getValue();if(t!==void 0)return t;if(r.proposedValue!==void 0)return r.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const r=this.baseRevision.getLatestEntryFor(e);if(!r)return;const t=r.getValue();return t!==Se?t===void 0&&e.lazy?this.read(e):t:void 0}readPreviousAsync(e){const r=this.baseRevision.getLatestEntryFor(e);if(!r)return;const t=r.getValue();return t!==Se?t!==void 0?t:this.readAsync(e):void 0}readProposedOrPrevious(e){const r=this.entries.get(e);return r&&r.proposedValue!==void 0?r.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const r=this.entries.get(e);return r&&r.proposedValue!==void 0?r.proposedValue:this.readPreviousAsync(e)}write(e,r,...t){r===void 0&&(r=null),e.write.call(e.context||e,e,this,null,r,...t);const i=this.entries.get(e);this.hasVariableEntry=this.hasVariableEntry||!i.isShadow()&&e.level===Rr.UserInput,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||i.hasProposedValue()}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const r=this.entries.get(e);return r&&r.origin===r?r.origin:void 0}touch(e){const r=this.entries.get(e);(!r||r.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const t=r||this.entries.get(e);return t.forceCalculation(),t}hasIdentifier(e){const r=this.entries.get(e);return r&&r.getValue()===Se?!1:!!(r||this.baseRevision.getLatestEntryFor(e))}addIdentifier(e,r,...t){let i=this.entries.get(e);const n=!!i,s=e.level===Rr.UserInput;return i||(i=e.newQuark(this.baseRevision),i.previous=this.baseRevision.getLatestEntryFor(e),i.forceCalculation(),this.entries.set(e,i),!e.lazy&&!s&&this.stackGen.push(i),this.hasVariableEntry=this.hasVariableEntry||!i.isShadow()&&s,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||i.hasProposedValue()),(r!==void 0||s)&&(i.startOrigin(),(!(n&&(i.proposedValue!==void 0||i.value!==void 0))||i.proposedValue===Se||i.value===Se)&&(e.isWritingUndefined=r===void 0,e.write.call(e.context||e,e,this,i,r===void 0&&s?null:r,...t),e.isWritingUndefined=!1)),i.getValue()===Se&&(i.value=void 0),i.proposedValue===Se&&(i.proposedValue=void 0),e.enterGraph(this.graph),i}removeIdentifier(e){e.leaveGraph(this.graph),this.touch(e).startOrigin().setValue(Se),this.candidate.selfDependent.delete(e)}populateCandidateScopeFromTransitions(e,r){if(e.scope.size===0)e.scope=r;else for(const[t,i]of r)if(i.isShadow()){const n=e.getLatestEntryFor(t);i.getOutgoing().forEach((s,a)=>n.getOutgoing().set(a,s))}else e.scope.set(t,i)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=void 0,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=Zs.new()){this.rejectedWith=e,this.walkContext=void 0}stop(){this.stopped=!0}clearRejected(){for(const e of this.entries.values())e.cleanup();this.entries.clear()}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then(()=>tl(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this)).then(()=>this.postCommit())}getLatestEntryFor(e){let r=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);if(!(r&&r.getValue()===Se))return r}getLatestStableEntryFor(e){let r=this.entries.get(e);if(r){const t=r.getValue();return t===Se?void 0:t===void 0?this.baseRevision.getLatestEntryFor(e):r}else return this.baseRevision.getLatestEntryFor(e)}addEdge(e,r,t){if(r.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let n=this.entries.get(e);if(!n){const s=this.baseRevision.getLatestEntryFor(e);s||hr(e),n=e.newQuark(this.baseRevision),n.setOrigin(s),n.previous=s,this.entries.set(e,n)}return n.addOutgoingTo(r,t),n}onQuarkCalculationCompleted(e,r){e.cleanup();const t=e.identifier,i=e.previous,n=!!(i&&i.hasValue()&&t.equality(r,i.getValue()));n?(i.outgoingInTheFutureAndPastTransactionCb(this,a=>{const o=this.entries.get(a.identifier);o&&o.edgesFlow--}),e.edgesFlow=xi,e.setOrigin(i.origin),e.value=r):(e.startOrigin(),e.setValue(r));let s=!1;e.usedProposedOrPrevious&&(e.proposedValue!==void 0?t.equality(r,e.proposedValue)&&(s=!0):(n||!i&&r===null)&&(s=!0),s||this.candidate.selfDependent.add(t))}onReadIdentifier(e,r,t){const i=this.addEdge(e,r,nl);if(i.hasValue()||i.value!==void 0){const n=i.getValue();return n===Se&&hr(e),r.continueCalculation(n)}else if(i.isShadow()){i.startOrigin(),i.forceCalculation(),t.push(i);return}else if(i.isCalculationStarted()){let n;return VD.new({transaction:this,onCycle(a,o){return n=Yd.new({cycle:SD(o),requestedEntry:i,activeEntry:r}),wr.Cancel}}).startFrom([i.identifier]),n}else{t.push(i),(!i.previous||!i.previous.hasValue())&&i.forceCalculation();return}}*calculateTransitions(e){const r=this.stackGen;for(;r.length;)yield*this.calculateTransitionsStackGen(e,r.takeLowestLevel())}calculateTransitionsSync(e){const r=this.stackGen;for(;r.length;)this.calculateTransitionsStackSync(e,r.takeLowestLevel())}*calculateTransitionsStackGen(e,r){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,i=this.propagationStartDate,n=this.graph?this.graph.enableProgressNotifications:!1;let s=0;const a=this.activeStack;for(this.activeStack=r;r.length&&!this.rejectedWith&&!this.stopped;){if(n&&!(s++%this.emitProgressNotificationsEveryCalculations)){const h=Date.now();if(h-i>this.startProgressNotificationsAfterMs){const g=this.lastProgressNotificationDate;(!g||h-g>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=h,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:this.stackGen.length+r.length,phase:"propagating"}),this.activeStack=a,yield Zo(0),this.activeStack=r)}}if(this.rejectedWith||this.stopped)break;const o=r[r.length-1],l=o.identifier;if(t.get(l)!==o){o.cleanup(),r.pop();continue}if(o.edgesFlow==0){o.edgesFlow--;const h=o.previous;h&&h.outgoingInTheFutureAndPastTransactionCb(this,f=>{const g=t.get(f.identifier);g&&g.edgesFlow--})}if(o.edgesFlow<0&&o.previous&&o.previous.origin){o.setOrigin(o.previous.origin),o.size===0&&t.delete(l),o.cleanup(),r.pop();continue}if(o.hasValue()||o.proposedValue===Se){o.cleanup(),r.pop();continue}const d=o.visitEpoch;let u=o.isCalculationStarted()?o.iterationResult:o.startCalculation(this.onEffectSync);for(;u&&!this.rejectedWith&&!this.stopped;){const h=u.value===void 0?null:u.value;if(o.isCalculationCompleted()){o.visitEpoch==d&&this.onQuarkCalculationCompleted(o,h),r.pop();break}else if(h instanceof Wt){const f=this.onReadIdentifier(h,o,r);f instanceof Yd?(this.walkContext.startNewEpoch(),yield*this.graph.onComputationCycleHandler(f),o.cleanupCalculation(),u=void 0):u=f}else if(h===Wd){r.pop();break}else{const f=yield h;if(f===Xs)break;if(o.visitEpoch===d)u=o.continueCalculation(f);else{r.pop();break}}}}this.activeStack=a}calculateTransitionsStackSync(e,r){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const t=this.entries,i=this.activeStack;for(this.activeStack=r;r.length&&!this.rejectedWith&&!this.stopped;){const n=r[r.length-1],s=n.identifier;if(t.get(s)!==n){n.cleanup(),r.pop();continue}if(n.edgesFlow==0){n.edgesFlow--;const c=n.previous;c&&c.outgoingInTheFutureAndPastTransactionCb(this,d=>{const u=t.get(d.identifier);u&&u.edgesFlow--})}if(n.edgesFlow<0&&n.previous&&n.previous.origin){n.setOrigin(n.previous.origin),n.size===0&&t.delete(s),n.cleanup(),r.pop();continue}if(n.hasValue()||n.proposedValue===Se){n.cleanup(),r.pop();continue}const o=n.visitEpoch;let l=n.isCalculationStarted()?n.iterationResult:n.startCalculation(this.onEffectSync);for(;l&&!this.rejectedWith&&!this.stopped;){const c=l.value===void 0?null:l.value;if(n.isCalculationCompleted()){n.visitEpoch==o&&this.onQuarkCalculationCompleted(n,c),r.pop();break}else if(c instanceof Wt){const d=this.onReadIdentifier(c,n,r);d instanceof Yd?(this.walkContext.startNewEpoch(),this.graph.onComputationCycleHandlerSync(d,this),n.cleanupCalculation(),l=void 0):l=d}else if(c===Wd){r.pop();break}else{const d=e(c);if(Hd(d))throw new Error("Effect resolved to promise in the synchronous context, check that you marked the asynchronous calculations accordingly");if(d===Xs)break;if(n.visitEpoch===o)l=n.continueCalculation(d);else{r.pop();break}}}}this.activeStack=i}},qd={rejectedWith:null},zD=class extends We{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let r=0;r<this.handlers.length;r++)this.handlers[r](e)}},WD=class extends We{constructor(){super(...arguments),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.baseRevision=Gd.new(),this.topRevision=void 0,this.historyLimit=0,this.listeners=new Map,this.isWritingPreviousData=!1,this.$activeTransaction=void 0,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=zm,this.isJustCleared=!1,this.$followingRevision=void 0}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler=this.autoCommitMode==="sync"?r=>this.commit(r):async r=>this.commitAsync(r)),this.markAndSweep()}hasPendingAutoCommit(){return this.autoCommitTimeoutId!==null}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=void 0,this.$activeTransaction=void 0,this.markAndSweep(),this.isJustCleared=!0}*eachReachableRevision(){let e=!0,r=0;for(const t of this.topRevision.previousAxis())yield[t,e||r<this.historyLimit],t===this.baseRevision?e=!1:e||r++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const r=[];for(const[t,i]of this.eachReachableRevision())i?(t.reachableCount++,e=t):r.push(t),t.referenceCount++;r.unshift(e);for(let t=r.length-1;t>=1&&r[t].reachableCount===0;t--)this.compactRevisions(r[t-1],r[t])}compactRevisions(e,r){if(r.reachableCount>0||e.previous!==r)throw new Error("Invalid compact operation");if(r.referenceCount<=1){for(const[t,i]of e.scope)if(i.getValue()===Se)r.scope.delete(t);else{const n=r.scope.get(t);i.origin===i?n&&(n.clear(),n.clearProperties()):n&&i.origin===n?i.mergePreviousOrigin(e.scope):t.lazy&&!i.origin&&n&&n.origin&&(i.startOrigin().proposedValue=n.origin.value!==void 0?n.origin.value:n.origin.proposedValue),i.previous=void 0,r.scope.set(t,i)}WA(e.selfDependent,r.selfDependent),e.scope=r.scope,r.scope=null}else e.scope=new Map(GS(r.scope,e.scope)),e.selfDependent=new Set(GS(r.selfDependent,e.selfDependent)),r.referenceCount--;e.previous=null}get followingRevision(){if(this.$followingRevision!==void 0)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),r=[];for(let t=e.length-1;t>0;t--)r.push([e[t],e[t-1]]);return this.$followingRevision=new Map(r)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(Zs.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=void 0,this.baseRevisionTentative=void 0,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=void 0)}commit(e){this.isJustCleared=!1,this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const t=this.activeTransaction.commit(e);this.$activeTransaction=void 0;const i=this.finalizeCommit(t);return this.baseRevisionStable=void 0,this.isInitialCommit=!1,i}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){if(this.isCommitting)return this.ongoing;this.isJustCleared=!1,this.isCommitting=!0,this.baseRevisionStable=this.baseRevision;let r;return this.ongoing=this.ongoing.then(()=>this.doCommitAsync(e)).then(t=>(r=t,t)).finally(()=>{this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.isInitialCommit=!1,this.isCommitting=!1})}async doCommitAsync(e){this.unScheduleAutoCommit();const r=this.activeTransaction,t=await r.commitAsync(e),i=!!r.rejectedWith,n=this.baseRevisionTentative;if(i||(this.baseRevisionTentative=r.candidate),this.$activeTransaction=void 0,await this.finalizeCommitAsync(t),this.isJustCleared)return{rejectedWith:Zs.new({reason:"Graph cleared"})};r.rejectedWith&&!i&&(this.baseRevisionTentative=n,this.$activeTransaction=void 0);const s=this.finalizeCommit(t);return r.rejectedWith&&r.clearRejected(),this.dirty&&!r.rejectedWith&&await this.doCommitAsync(e),s}finalizeCommit(e){const{revision:r,entries:t,transaction:i}=e;if(i.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0;else{if(r.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[n,s]of this.eachReachableRevision())s&&n.reachableCount--,n.referenceCount--;this.baseRevision=this.topRevision=r;for(const[n,s]of t){if(s.cleanup(),s.isShadow()||!s.hasValue())continue;const a=this.listeners.get(n);a&&a.trigger(s.getValue())}this.$followingRevision=void 0,this.markAndSweep()}return{rejectedWith:i.rejectedWith}}async finalizeCommitAsync(e){}*onComputationCycleHandler(e){const r=new Error(`Computation cycle:
`+e);switch(r.cycle=e,this.onComputationCycle){case"ignore":console.log(r.message);const{requestedEntry:t,activeEntry:i}=e;return i.continueCalculation(t.proposedValue!==void 0?t.proposedValue:t.value);case"throw":throw r;case"reject":this.reject(r);break;case"warn":Jo(r);break}}onComputationCycleHandlerSync(e,r){const t=new Error(`Computation cycle:
`+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:i,activeEntry:n}=e;return n.continueCalculation(i.proposedValue!==void 0?i.proposedValue:i.value);case"throw":throw t;case"reject":this.reject(t);break;case"warn":Jo(t);break}}scheduleAutoCommit(){this.autoCommitTimeoutId===null&&!this.isCommitting&&(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){this.autoCommitTimeoutId!==null&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const r=Hm();return this.addIdentifier(r,e===void 0?null:e)}variableNamed(e,r){const t=Hm({name:e});return this.addIdentifier(t,r===void 0?null:r)}identifier(e,r){const t=bm(e)?Nm({calculation:e,context:r}):Vm({calculation:e,context:r});return this.addIdentifier(t)}identifierNamed(e,r,t){const i=r.constructor.name==="GeneratorFunction"?Nm({name:e,calculation:r,context:t}):Vm({name:e,calculation:r,context:t});return this.addIdentifier(i)}addIdentifier(e,r,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Adding identifier during commit");this.onWriteDuringCommit==="warn"&&Jo(new Error("Adding identifier during commit"))}return this.activeTransaction.addIdentifier(e,r,...t),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Removing identifier during commit");this.onWriteDuringCommit==="warn"&&Jo(new Error("Removinfg identifier during commit"))}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,r,...t){if(this.isCommitting){if(this.onWriteDuringCommit==="throw")throw new Error("Write during commit");this.onWriteDuringCommit==="warn"&&Jo(new Error("Write during commit"))}this.activeTransaction.write(e,r,...t),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,r){const t=this.addIdentifier(ur.new({lazy:!1,calculation:e}));return this.addListener(t,r),t}observeContext(e,r,t){const i=this.addIdentifier(ur.new({lazy:!1,calculation:e,context:r}));return this.addListener(i,t),i}addListener(e,r){let t=this.listeners.get(e);t||(t=zD.new(),this.listeners.set(e,t)),t.handlers.push(r)}undo(){const r=this.baseRevision.previous;return r?(this.baseRevision=r,this.$activeTransaction=void 0,!0):!1}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const r=this.followingRevision.get(e);return this.baseRevision=r,this.$activeTransaction=void 0,!0}onPropagationProgressNotification(e){}[Em](e,r){const t=r.getActiveEntry();t.usedProposedOrPrevious=!0;const i=t.getProposedValue(r);return i!==void 0?i:t.previous?t.identifier.lazy?t.previous.hasValue()?t.previous.getValue():t.previous.hasProposedValue()?t.previous.getProposedValue(r):null:r.readPrevious(t.identifier):void 0}[el](e,r){return this.reject(e.reason),Xs}[xm](e,r){return r}[Rm](e,r){return r.getActiveEntry()}[Tm](e,r){return r.getActiveEntry().identifier}[Mm](e,r){const t=r.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const i=e.identifier.level>t.identifier.level;return i||r.walkContext.startNewEpoch(),r.write(e.identifier,...e.proposedArgs),i?void 0:Xs}[Im](e,r){const t=r.getActiveEntry();if(t.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let i=!0;return e.writes.forEach(n=>{n.identifier.level<=t.identifier.level&&i&&(r.walkContext.startNewEpoch(),i=!1),r.write(n.identifier,...n.proposedArgs)}),i?void 0:Xs}[_m](e,r){const t=r.getActiveEntry(),i=e.identifier;return r.addEdge(i,t,En),r.readPrevious(i)}[Fm](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,En);const n=r.entries.get(i);return n&&!n.isShadow()?n.getProposedValue(r):void 0}[km](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,En);const n=r.entries.get(i);return n?n.hasProposedValue():!1}[Om](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,En);const n=r.entries.get(i);return n?n.hasProposedValue()&&!n.proposedIsPrevious:!1}[Lm](e,r){const t=r.getActiveEntry(),i=e.identifier;return r.addEdge(i,t,En),r.readProposedOrPrevious(i)}[jm](e,r){return r.readProposedOrPrevious(e.identifier)}[Bm](e,r){return r.readPrevious(e.identifier)}[$m](e,r){const t=r.getActiveEntry(),i=e.identifier;r.addEdge(i,t,En);const n=r.entries.get(i);return n&&!n.isShadow()?n.proposedArguments:void 0}},UD=class extends We{constructor(){super(...arguments),this.name=void 0,this.ownFields=new Map,this.schema=void 0,this.$skeleton={},this.$allFields=void 0}hasField(e){return this.getField(e)!==void 0}getField(e){return this.allFields.get(e)}addField(e){const r=e.name;if(!r)throw new Error("Field must have a name");if(this.ownFields.has(r))throw new Error(`Field with name [${r}] already exists`);return e.entity=this,this.ownFields.set(r,e),e}forEachParent(e){let r=this;for(;r;)e(r),r=r.parentEntity}get allFields(){if(this.$allFields!==void 0)return this.$allFields;const e=new Map,r=new Set;return this.forEachParent(t=>{t.ownFields.forEach((i,n)=>{r.has(n)||(r.add(n),e.set(n,i))})}),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}},qr;(function(e){e[e.Current=0]="Current",e[e.Previous=1]="Previous",e[e.ProposedOrPrevious=2]="ProposedOrPrevious",e[e.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious"})(qr||(qr={}));var Wm=class extends G([WD],e=>class extends e{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=qr.Current}addEntity(t){t.enterGraph(this)}addEntities(t){t.forEach(i=>this.addEntity(i))}removeEntity(t){t.leaveGraph(this)}removeEntities(t){t.forEach(i=>this.removeEntity(i))}}){},tr=class extends G([Wt],e=>class extends e{constructor(){super(...arguments),this.field=void 0,this.self=void 0,this.DATA=void 0}getFromGraph(t){return t?t.readMode===qr.Current?t.get(this):t.readMode===qr.Previous?t.activeTransaction.readPrevious(this):(t.readMode===qr.ProposedOrPrevious&&t.activeTransaction.readProposedOrPrevious(this),t.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(t){return t?t.read(this):this.DATA}writeToGraph(t,i,...n){t?t.write(this,i,...n):this.DATA=i}leaveGraph(t){const i=t.activeTransaction.getLatestStableEntryFor(this);i&&(this.DATA=i.getValue()),super.leaveGraph(t)}toString(){return this.name}}){},sl=class extends tr.mix(ta){},Um=class extends tr.mix(ur){},Gm=class extends tr.mix(il){},GD=class extends G([Wt],e=>class extends e{constructor(){super(...arguments),this.entity=void 0,this.self=void 0}equality(){return!1}toString(){return`Entity identifier [${this.self}]`}}){},YD=class extends GD.mix(ur){},ra=class extends rl{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?bm(e)?Um:sl:Gm}},qD=Symbol("isEntity"),Tr=class extends G([],e=>{class r extends e{[qD](){}get $entity(){return Ym(this.constructor.prototype)}get $(){const i={};if(this.$entity.forEachField((n,s)=>{i[s]=this.createFieldIdentifier(n)}),Ys){const n=new Proxy(i,{get(s,a,o){return s[a]||YA(new Error(`Attempt to read a missing field ${String(a)} on ${s}`)),s[a].SOURCE_POINT=vD.fromThisCall(),s[a]}});return Bd(this,"$",n)}else return Bd(this,"$",i)}get $$(){return Bd(this,"$$",YD.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(i){const n=i.name,s=this.$entity,a=this.constructor,o=s.$skeleton;o[n]||(o[n]=a.getIdentifierTemplateClass(this,i));const l=new o[n];return l.context=this,l.self=this,l.name=`${this.$$.name}.$.${i.name}`,l}forEachFieldIdentifier(i){this.$entity.forEachField((n,s)=>i(this.$[s],s,n))}enterGraph(i){if(this.graph)throw new Error("Already entered replica");this.graph=i,i.addIdentifier(this.$$),this.$entity.forEachField((n,s)=>{const a=this.$[s];i.addIdentifier(a,a.DATA),a.DATA=void 0})}leaveGraph(i){const n=this.graph,s=i||n;s&&(this.$entity.forEachField((a,o)=>s.removeIdentifier(this.$[o])),s.removeIdentifier(this.$$),s===n&&(this.graph=void 0))}propagate(i){return this.commit(i)}commit(i){const n=this.graph;return n?n.commit(i):qd}async propagateAsync(){return this.commitAsync()}async commitAsync(i){const n=this.graph;return n?n.commitAsync(i):Promise.resolve(qd)}static get $entity(){return xn(this.prototype)}static getIdentifierTemplateClass(i,n){const s=n.name,a={name:`${i.$$.name}.$.${s}`,field:n};n.hasOwnProperty("sync")&&(a.sync=n.sync),n.hasOwnProperty("lazy")&&(a.lazy=n.lazy),n.hasOwnProperty("equality")&&(a.equality=n.equality);const o=i.$calculations&&i[i.$calculations[s]];o&&(a.calculation=o);const l=i.$writes&&i[i.$writes[s]];l&&(a.write=l);const c=i.$buildProposed&&i[i.$buildProposed[s]];c&&(a.buildProposedValue=c,a.proposedValueIsBuilt=!0);const d=n.getIdentifierClass(o).new(a),u=function(){};return u.prototype=d,u}run(i,...n){const s=c=>{if(c instanceof Wt)return this.graph.read(c);throw new Error("Helper methods can not yield effects during computation")},a=this.graph.activeTransaction,o=a.activeStack;a.activeStack=[];const l=BD(s,this[i],n,this);return a.activeStack=o,l}static createPropertyAccessorsFor(i){const n=i,s=this.prototype;Object.defineProperty(s,n,{get:function(){return this.$[n].getFromGraph(this.graph)},set:function(a){this.$[n].writeToGraph(this.graph,a)}})}static createMethodAccessorsFor(i){const n=i,s=this.prototype,a=`get${vm(n)}`,o=`set${vm(n)}`,l=`put${vm(n)}`;a in s||(s[a]=function(){return this.$[n].getFromGraph(this.graph)}),o in s||(s[o]=function(c,...d){return this.$[n].writeToGraph(this.graph,c,...d),this.graph?this.graph.autoCommitMode==="sync"?this.graph.commit():this.graph.commitAsync():Promise.resolve(qd)}),l in s||(s[l]=function(c,...d){this.$[n].writeToGraph(this.graph,c,...d)})}}return r}){},Ym=e=>{let r=Object.getPrototypeOf(e);return Bd(e,"$entity",UD.new({parentEntity:r.hasOwnProperty(qD)?null:r.$entity,name:e.constructor.name}))},xn=e=>(e.hasOwnProperty("$entity")||Ym(e),e.$entity),Ot=(e,r=ra)=>function(t,i){const s=xn(t).addField(r.new(Object.assign(e||{},{name:i}))),a=t.constructor;a.createPropertyAccessorsFor(i),a.createMethodAccessorsFor(i)},Ce=Ot,oe=function(e){return function(r,t,i){xn(r);let n;r.$calculations?r.hasOwnProperty("$calculations")?n=r.$calculations:n=r.$calculations=Object.create(r.$calculations):n=r.$calculations={},n[e]=t}},Kr=function(e){return function(r,t,i){xn(r);let n;r.$writes?r.hasOwnProperty("$writes")?n=r.$writes:n=r.$writes=Object.create(r.$writes):n=r.$writes={},n[e]=t}},KD=function(e){return function(r,t,i){xn(r);let n;r.$buildProposed?r.hasOwnProperty("$buildProposed")?n=r.$buildProposed:n=r.$buildProposed=Object.create(r.$buildProposed):n=r.$buildProposed={},n[e]=t}},XD=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},qm=class extends G([ra],e=>class extends e{constructor(){super(...arguments),this.identifierCls=JD}}){},ZD=(e,r=qm)=>Ot(e,r),Km=class extends G([tr],e=>{class r extends e{constructor(){super(...arguments),this.field=void 0,this.proposedValueIsBuilt=!0}hasBucket(){return!!this.field.bucket}getBucket(i){return i.$[this.field.bucket]}buildProposedValue(i,n,s){const a=n.proposedValue;if(a===null)return null;const o=Ft(a,Tr)?a:i.resolve(a);return o&&i.hasBucket()&&i.getBucket(o).addToBucket(s,i.self),o}resolve(i){const n=this.field.resolver;return n?n.call(this.self,i):null}enterGraph(i){if(this.hasBucket()){const n=i.activeTransaction.readProposedOrPrevious(this);n instanceof Tr&&this.getBucket(n).addToBucket(i.activeTransaction,this.self)}super.enterGraph(i)}leaveGraph(i){if(this.hasBucket()){const n=i.activeTransaction.readProposedOrPrevious(this);n instanceof Tr&&this.getBucket(n).removeFromBucket(i.activeTransaction,this.self)}super.leaveGraph(i)}write(i,n,s,a,...o){const l=s||n.acquireQuarkIfExists(i);if(i.hasBucket()){if(l){const c=l.getValue();c instanceof Tr&&i.getBucket(c).removeFromBucket(n,i.self)}else if(n.baseRevision.hasIdentifier(i)){const c=n.readPrevious(i);c instanceof Tr&&i.getBucket(c).removeFromBucket(n,i.self)}}super.write(i,n,s,a)}}return XD([fe(Rr.DependsOnlyOnUserInput)],r.prototype,"level",void 0),XD([fe(ea)],r.prototype,"quarkClass",void 0),r}){},JD=class extends Km.mix(tr.mix(ta)){},QD=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Xm=class extends G([ra],e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=iE}}){},eE=(e,r=Xm)=>Ot(e,r),ia;(function(e){e.Add="Add",e.Remove="Remove"})(ia||(ia={}));var tE=class extends G([Ud],e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=void 0}hasProposedValueInner(){return this.mutations.length>0}}){},rE=tE.mix(ea),Zm=class extends G([tr],e=>{class r extends e{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(i,n){const s=i.getWriteTarget(this);s.mutations.push({type:ia.Add,entity:n});const a=i.baseRevision;!s.previousValue&&a.hasIdentifier(this)&&(s.previousValue=i.readPrevious(this))}removeFromBucket(i,n){const s=i.entries.get(this);if(s&&s.getValue()===Se)return;const a=i.getWriteTarget(this);a.mutations.push({type:ia.Remove,entity:n});const o=i.baseRevision;!a.previousValue&&o.hasIdentifier(this)&&(a.previousValue=i.readPrevious(this))}buildProposedValue(i,n,s){const a=n,o=new Set(a.previousValue);for(let l=0;l<a.mutations.length;l++){const{type:c,entity:d}=a.mutations[l];c===ia.Remove?o.delete(d):c===ia.Add&&o.add(d)}return o}leaveGraph(i){super.leaveGraph(i),this.DATA=void 0}}return QD([fe(Rr.DependsOnlyOnDependsOnlyOnUserInput)],r.prototype,"level",void 0),QD([fe(rE)],r.prototype,"quarkClass",void 0),r}){},iE=class extends Zm.mix(tr.mix(ta)){},nE=class extends We{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const r=e.name;if(!r)throw new Error("Entity must have a name");if(this.hasEntity(r))throw new Error(`Entity with name [${String(r)}] already exists`);return e.schema=this,this.entities.set(r,e),e}getEntityDecorator(){return e=>{const r=Jm(e);return this.addEntity(r),e}}},Jm=e=>{if(!e.name)throw new Error("Can't add entity - the target class has no name");return xn(e.prototype)},c_=()=>e=>(Jm(e),e),Kd=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},na=function(e,r){return e===r||(r!=null&&r.isBase?this.serialize(r):r)===(e!=null&&e.isBase?this.serialize(e):e)},Xd=class extends ra{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?bm(e)?oE:aE:lE}},Rn=class extends qm.mix(Xd){constructor(){super(...arguments),this.identifierCls=al}},Tn=class extends Xm.mix(ra){constructor(){super(...arguments),this.identifierCls=Jd}},Zd=Symbol("IsChronoModelSymbol"),sa=class extends G([tr],e=>{const r=e.prototype;class t extends e{[Zd](){}getFromGraph(n){var s,a;if(n){if(n.readMode===qr.CurrentOrProposedOrPrevious){const o=n.isCommitting&&this.level>((a=(s=n.activeTransaction.getActiveEntry())==null?void 0:s.level)!=null?a:Number.MAX_SAFE_INTEGER);return this.sync&&!this.context.project.isDelayingCalculation&&!o?n.get(this):n.activeTransaction.readCurrentOrProposedOrPrevious(this)}return r.getFromGraph.call(this,n)}else return this.DATA}writeToGraph(n,s,...a){n?r.writeToGraph.call(this,n,s,...a):(this.DATA=s,!this.self.inSetting&&!this.self.isConstructing&&this.self.set(this.field.name,s,!1,!1,!0))}write(n,s,a,o,...l){o=n.convert(o),r.write.call(this,n,s,a,o,...l)}convert(n){const s=this.field,a=this.self.getFieldDefinition(s.name);return a!=null&&a.convert?n=a.convert(n,this.context.data,this.context):s.converter&&(n=s.converter(n,s)),n}equality(n,s){return n instanceof Date&&s instanceof Date?n.getTime()===s.getTime():n===s}}return Kd([fe(!1)],t.prototype,"sync",void 0),t}){},sE=class extends G([ea],e=>{const r=e.prototype;class t extends e{setValue(n){r.setValue.call(this,n),n!==Se&&(this.identifier.DATA=n)}}return t}){},al=class extends Km.mix(sa.mix(sl)){buildProposedValue(e,r,t){const i=r,n=i.proposedValue;if(n==null)return t.candidate.failedResolutionReferences.delete(i.identifier),null;if(Ft(n,Tr)&&n.graph)return e.hasBucket()&&e.getBucket(n).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(i.identifier),n;const s=e.resolve(n);return Ft(s,Tr)&&s.graph?(e.hasBucket()&&e.getBucket(s).addToBucket(t,e.self),t.candidate.failedResolutionReferences.delete(i.identifier),s):(t.candidate.failedResolutionReferences.set(i.identifier,n),null)}};Kd([fe(!0)],al.prototype,"sync",void 0),Kd([fe(sE)],al.prototype,"quarkClass",void 0);var Jd=class extends Zm.mix(sa.mix(sl)){};Kd([fe(!0)],Jd.prototype,"sync",void 0);var aE=class extends sa.mix(sl){},oE=class extends sa.mix(Um){},lE=class extends sa.mix(Gm){},de=function(e={},r={},t=Xd){return function(i,n){Ot({modelFieldConfig:e,...r},t)(i,n),Qd(i.constructor)}},Qd=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return cE(this)}})},cE=e=>{const r=e.prototype,t=[];return r.hasOwnProperty("$entity")&&r.$entity.ownFields.forEach(i=>{if(i instanceof Xd){const n=i.modelFieldConfig||{};!n.convert&&i.converter&&i.converter!==Mn&&(n.convert=i.converter),t.push(Object.assign(n,{$chrono:i,name:i.name}))}}),t},Mn=(e,r)=>{var t,i;return e===null?null:(e instanceof Date||(e=b.parse(e,((t=r.modelFieldConfig)==null?void 0:t.format)||((i=r.modelFieldConfig)==null?void 0:i.dateFormat)||b.defaultParseFormat)),e||void 0)},eu=class extends G([Tr,ae],e=>{const r=e.prototype;class t extends e{get isEntity(){return!0}construct(n,...s){this.constructor.exposeProperties(),this.originalData=n=n||{},r.construct.call(this,n,...s);for(const a in this.originalData)this.$[a]&&!this.getFieldDefinition(a)&&(this[a]=n[a])}*userProvidedValue(){return yield we}copy(n=null,s=null){const a=r.copy.call(this,n,s),{creatingOccurrence:o}=s!=null?s:{};return(T.isObject(s)&&!s.skipFieldIdentifiers||!T.isObject(s))&&this.forEachFieldIdentifier((l,c,d)=>{var u;!d.lazy&&((u=this.getFieldDefinition(c))==null?void 0:u.type)!=="store"&&(!o||l instanceof Jd||l instanceof al)&&(a[c]=this[c])}),a}applyValue(n,s,a,o,l){var c;this.$entity.getField((l==null?void 0:l.name)||s)&&(n=!0),o&&(n=!1),r.applyValue.call(this,n,n&&(c=l==null?void 0:l.name)!=null?c:s,a,o,l)}get isInActiveTransaction(){var n;const s=(n=this.graph)==null?void 0:n.activeTransaction;return!!(s!=null&&s.getLatestEntryFor(this.$$))}get data(){return this._data}set data(n){this._data=n;const{fields:s,$:a,graph:o,generation:l}=this;for(let c=0;c<s.length;c++){const{name:d,dataSource:u,complexMapping:h}=s[c],f=a[d];if(f){const g=h?T.getPath(n,u):n[u];(h||u in n)&&(l!=null||g!==void 0)&&f.writeToGraph(o,g)}}}get $entityName(){const n=this.constructor.name||this.$entity.name,s=this.id;return`${n}${s!=null?"-"+String(s):""}`}}return t}){},d_={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",RemoveDependencyCycleEffectResolution:{descriptionTpl:"Remove dependency"},DeactivateDependencyCycleEffectResolution:{descriptionTpl:"Deactivate dependency"},CycleEffectDescription:{descriptionTpl:"A cycle has been found, formed by: {0}"},EmptyCalendarEffectDescription:{descriptionTpl:'"{0}" calendar does not provide any working time intervals.'},Use24hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 24 hours calendar with non-working Saturdays and Sundays."},Use8hrsEmptyCalendarEffectResolution:{descriptionTpl:"Use 8 hours calendar (08:00-12:00, 13:00-17:00) with non-working Saturdays and Sundays."},ConflictEffectDescription:{descriptionTpl:"A scheduling conflict has been found: {0} is conflicting with {1}"},ConstraintIntervalDescription:{dateFormat:"LLL"},ProjectConstraintIntervalDescription:{startDateDescriptionTpl:"Project start date {0}",endDateDescriptionTpl:"Project end date {0}"},DependencyType:{long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},ManuallyScheduledParentConstraintIntervalDescription:{startDescriptionTpl:'Manually scheduled "{2}" forces its children to start no earlier than {0}',endDescriptionTpl:'Manually scheduled "{2}" forces its children to finish no later than {1}'},DisableManuallyScheduledConflictResolution:{descriptionTpl:'Disable manual scheduling for "{0}"'},DependencyConstraintIntervalDescription:{descriptionTpl:'Dependency ({2}) from "{3}" to "{4}"'},RemoveDependencyResolution:{descriptionTpl:'Remove dependency from "{1}" to "{2}"'},DeactivateDependencyResolution:{descriptionTpl:'Deactivate dependency from "{1}" to "{2}"'},DateConstraintIntervalDescription:{startDateDescriptionTpl:'Task "{2}" {3} {0} constraint',endDateDescriptionTpl:'Task "{2}" {3} {1} constraint',constraintTypeTpl:{startnoearlierthan:"Start-No-Earlier-Than",finishnoearlierthan:"Finish-No-Earlier-Than",muststarton:"Must-Start-On",mustfinishon:"Must-Finish-On",startnolaterthan:"Start-No-Later-Than",finishnolaterthan:"Finish-No-Later-Than"}},RemoveDateConstraintConflictResolution:{descriptionTpl:'Remove "{1}" constraint of task "{0}"'}},Sk=ct.publishLocale(d_),tu=class extends We{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=ft),this.endDate||(this.endDate=Qe)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}isInfinite(){return this.startDate.getTime()===ft.getTime()&&this.endDate.getTime()===Qe.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==ft.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==Qe.getTime()}containsDate(e,r=Cr.Left){return r===Cr.Left&&e>=this.startDate&&e<this.endDate||r===Cr.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const r=e.startDate,t=e.endDate,i=this.startDate,n=this.endDate;if(n<r||i>t)return dE;const s=new Date(Math.max(i.getTime(),r.getTime())),a=new Date(Math.min(n.getTime(),t.getTime()));return this.constructor.new({startDate:s,endDate:a})}intersectMut(e,r=!1){var t;const i=e.startDate,n=e.endDate,s=this.startDate,a=this.endDate;if(r&&(this.intersectionOf||(this.intersectionOf=new Set),((t=e.intersectionOf)==null?void 0:t.size)>0?(e.intersectionOf.forEach(this.intersectionOf.add,this.intersectionOf),this.intersectedAsEmpty=e.intersectedAsEmpty):this.intersectionOf.add(e)),!this.isIntervalEmpty()){if(a<i||s>n)return this.startDate=Qe,this.endDate=ft,r&&(this.intersectedAsEmpty=e),this;this.startDate=new Date(Math.max(s.getTime(),i.getTime())),this.endDate=new Date(Math.min(a.getTime(),n.getTime()))}return this}getCopyProperties(e){return e}copyWith(e){const r=this.getCopyProperties(e);return this.constructor.new(r)}},dE=tu.new({startDate:Qe,endDate:ft}),Ri=(e,r=!1)=>e.reduce((t,i)=>t.intersectMut(i,r),tu.new()),uE=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},fr;(function(e){e.Cancel="Cancel",e.Resume="Resume"})(fr||(fr={}));var ol=class extends F{getDescription(){throw new Error("Abstract method")}resolve(...e){throw new Error("Abstract method")}},ll=class extends et{getResolutions(){return this._resolutions}getDescriptionBuilderClass(){return this._descriptionBuilderClass}setDescriptionBuilderClass(e){this._descriptionBuilderClass=e}getDescription(){return this.getDescriptionBuilderClass().getDescription(this)}};uE([fe("schedulingIssueEffect")],ll.prototype,"type",void 0),uE([fe(!1)],ll.prototype,"sync",void 0);var Qm=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},ep=Symbol("ConflictSymbol"),hE=class extends Ve(F){static get $name(){return"ConflictEffectDescription"}static getDescription(e){return Wr(this.L("L{descriptionTpl}"),e.intervals[0].getDescription(),e.intervals[1].getDescription())}},aa=class extends ll{constructor(){super(...arguments),this.handler=ep}initialize(e){super.initialize(e),this.intervals=this.filterConflictingIntervals(this.intervals)}getResolutions(){return this._resolutions||(this._resolutions=[].concat(...this.intervals.map(e=>e.getResolutions()))),this._resolutions}filterConflictingIntervals(e){const r=[],t=[...e].filter(n=>!n.isInfinite()),i=t.find(n=>n.isAffectedByTransaction());if(i){const n=t.sort((o,l)=>o===i?-1:0),a=Ri(n,!0).intersectedAsEmpty;r.push(a,i)}else r.push(Ri(t,!0).intersectedAsEmpty,Ri(t.reverse(),!0).intersectedAsEmpty);return r}};Qm([fe("schedulingConflict")],aa.prototype,"type",void 0),Qm([fe(hE)],aa.prototype,"_descriptionBuilderClass",void 0);var tp=class extends ol{resolve(){throw new Error("Abstract method")}},ru=class extends Ve(F){static get $name(){return"ConstraintIntervalDescription"}static getDescription(e){return Wr(this.L("L{descriptionTpl}"),...this.getDescriptionParameters(e))}static getDescriptionParameters(e){return[b.format(e.startDate,this.L("L{dateFormat}")),b.format(e.endDate,this.L("L{dateFormat}"))]}},oa=class extends tu{constructor(){super(...arguments),this.owner=void 0,this.reflectionOf=void 0,this.side=void 0,this.resolutions=void 0}get isConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}getResolutions(){return[]}isAffectedByTransaction(e){return!1}getCopyProperties(e){const{owner:r,reflectionOf:t,side:i}=this;return Object.assign({owner:r,reflectionOf:t,side:i},e)}};Qm([fe(ru)],oa.prototype,"descriptionBuilderClass",void 0);var rp=class extends G([Io],e=>{const r=e.prototype;class t extends e{getGraph(){const n=this.getProject();return n==null?void 0:n.getGraph()}getEventById(n){var s;return(s=this.getEventStore())==null?void 0:s.getById(n)}getDependencyById(n){var s;return(s=this.getDependencyStore())==null?void 0:s.getById(n)}getResourceById(n){var s;return(s=this.getResourceStore())==null?void 0:s.getById(n)}getAssignmentById(n){var s;return(s=this.getAssignmentStore())==null?void 0:s.getById(n)}getCalendarById(n){var s;return(s=this.getCalendarManagerStore())==null?void 0:s.getById(n)}}return t}){},fE=class extends G([ee],e=>class extends e{}){},Pn=class extends G([zt,rp,fE],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=0}setStoreData(n){var s;(s=this.project)==null||s.repopulateStore(this),r.setStoreData.call(this,n)}register(n){var s,a;r.register.call(this,n),!n.isRoot&&!((s=this.project)!=null&&s.graph)&&((a=this.project)==null||a.scheduleDelayedCalculation())}onModelChange(n,s,a,o,l,c){!c&&!(this.syncDataOnLoad&&this.isLoadingData)&&Object.keys(a).some(d=>d!=="intervals"&&n.$entity.getField(d))&&(o=!0),super.onModelChange(n,s,a,o,l,c)}}return t}){},la=class extends G([Ps,rp,eu],e=>{const r=e.prototype;class t extends e{joinProject(){var n;(n=this.project)!=null&&n.delayEnteringReplica||(this.graph&&this.graph!=this.getGraph()&&(this.graph=null),this.getGraph().addEntity(this))}leaveProject(n=!1){r.leaveProject.call(this,n);const s=this.getGraph();s==null||s.removeEntity(this),this.graph=null}getProject(){return r.getProject.call(this)}calculateProject(){const n=this.stores.find(s=>Ft(s,Pn)&&!!s.getProject());return n==null?void 0:n.getProject()}get graph(){var n;return(n=this.project)!=null&&n.delayEnteringReplica?null:this._graph}set graph(n){this._graph=n}}return t}){},cl=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},u_=Symbol("CalendarMixin"),ip=Symbol("EmptyCalendarSymbol"),In=class extends G([Wf,la],e=>{class r extends e{constructor(){super(...arguments),this.version=1}[u_](){}}return cl([de({},{persistent:!1})],r.prototype,"version",void 0),cl([de({type:"boolean",defaultValue:!0})],r.prototype,"unspecifiedTimeIsWorking",void 0),cl([de()],r.prototype,"intervals",void 0),r}){},gE=class extends Ve(F){static get $name(){return"EmptyCalendarEffectDescription"}static getDescription(e){const r=e.getCalendar();return Wr(this.L("L{descriptionTpl}"),r.name||r.id)}},dl=class extends ll{constructor(){super(...arguments),this.handler=ip}getResolutions(){const e=this.getCalendar();return this._resolutions||(this._resolutions=[mE.new({calendar:e}),pE.new({calendar:e})])}getCalendar(){const{calendars:e}=this;if((e==null?void 0:e.length)>1){for(const r of e)if(!(r.skipNonWorkingTime(this.date,this.isForward)instanceof Date))return r}return e[0]}};cl([fe("emptyCalendar")],dl.prototype,"type",void 0),cl([fe(gE)],dl.prototype,"_descriptionBuilderClass",void 0);var np=class extends Ve(ol){static get $name(){return"BaseEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{intervals:[{isWorking:!0}]}}}getDescription(){const{calendar:e}=this;return Wr(this.L("L{descriptionTpl}"),e.name||e.id)}fixCalendarData(e){var r;e.clearIntervals(!0),Object.assign(e,this.calendarData),(r=e.intervals)!=null&&r.length&&e.addIntervals(e.intervals)}resolve(){const{calendar:e}=this;this.fixCalendarData(e)}},mE=class extends np{static get $name(){return"Use24hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"on Mon at 0:00",recurrentEndDate:"on Sat at 0:00",isWorking:!0}]}}}},pE=class extends np{static get $name(){return"Use8hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"every weekday at 08:00",recurrentEndDate:"every weekday at 12:00",isWorking:!0},{recurrentStartDate:"every weekday at 13:00",recurrentEndDate:"every weekday at 17:00",isWorking:!0}]}}}},sp=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},ap=Symbol("CycleSymbol"),op=class extends Gd{constructor(){super(...arguments),this.failedResolutionReferences=new Map}},vE=class extends zm{constructor(){super(...arguments),this.candidateClass=op}initialize(e){var r;(r=e.graph.project)!=null&&r.delayCalculation&&(e.startProgressNotificationsAfterMs=0,e.emitProgressNotificationsEveryMs=100),super.initialize(e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,r,...t){return this.candidate.failedResolutionReferences.size&&(this.candidate.failedResolutionReferences.forEach((i,n)=>{this.write(n,i)}),this.candidate.failedResolutionReferences.clear()),super.addIdentifier(e,r,...t)}},yE=class extends G([Wm],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.baseRevision=op.new(),this.transactionClass=vE,this.autoCommitMode="async",this.onComputationCycle="effect",this.cycleEffectClass=An,this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!1}get dirty(){const n=this.activeTransaction;return n.entries.size>0&&(n.hasVariableEntry||n.hasEntryWithProposedValue)}onPropagationProgressNotification(n){var s,a;this.enableProgressNotifications&&this.project&&((a=(s=this.project).trigger)==null||a.call(s,"progress",n))}async commitAsync(n){if(!this.project||this.project.isDestroyed)return;this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const s=this.project.beforeCommitAsync();return s||r.commitAsync.call(this,n)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(n){super.isInitialCommit=n}write(n,s,...a){var o,l,c;const d=(o=n.field)==null?void 0:o.name,u=n.self;if(d&&u){const h=(l=u.beforeChronoFieldSet)==null?void 0:l.call(u,d,s);r.write.call(this,n,s,...a),(c=u.afterChronoFieldSet)==null||c.call(u,d,s,h)}else r.write.call(this,n,s,...a)}async finalizeCommitAsync(n){const{project:s}=this;if(!s||s.isDestroyed)return;const{entries:a}=n,o=new Set;globalThis.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:l,silenceInitialCommit:c}=this,d=l&&c;l&&(s.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),s.isWritingData=!0,s.hasLoadedDataToCommit=!1,this.enableProgressNotifications&&s.trigger("progress",{total:n.entries.size,remaining:0,phase:"finalizing"}),n.transaction.rejectedWith&&s.trigger("commitRejected",{transactionResult:n,isInitialCommit:l,silenceCommit:d}),s.trigger("refresh",{isInitialCommit:l,isCalculated:!0}),await new Promise(h=>{setTimeout(()=>{var f,g;if(!s.isDestroyed){if(n.transaction.rejectedWith)s.isWritingData=!1;else{(f=s.suspendChangesTracking)==null||f.call(s),globalThis.DEBUG&&console.time("Finalize propagation");const m=new Set;for(const v of a.values()){const y=v.identifier,S=v.getValue(),{field:D}=y;if(v.isShadow()||!y[Zd]||S===Se||D instanceof Tn)continue;const w=y.self,E=w.firstStore;m.has(w)||(w.beginBatch(!0),m.add(w)),E!=null&&E.autoCommit&&!o.has(E)&&(E.suspendAutoCommit(),o.add(E)),w.meta.batchChanges[D.name]=S}let p=!1;for(const v of m)if(!v.triggerBeforeUpdate({...v.meta.batchChanges})){p=!0;break}if(p){for(const v of m)v.cancelBatch();n.transaction.reject(),s.trigger("commitRejected",{transactionResult:n,isInitialCommit:l,silenceCommit:d}),s.trigger("refresh",{isInitialCommit:l,isCalculated:!0})}else for(const v of m)v.ignoreBag=d||s.ignoreRecordChanges,v.generation++,v.endBatch(d,!0,!0),v.ignoreBag=!1;s.ignoreRecordChanges=!1,globalThis.DEBUG&&console.timeEnd("Finalize propagation"),s.isWritingData=!1,p||s.trigger("dataReady",{records:m,isInitialCommit:l}),(g=s.resumeChangesTracking)==null||g.call(s,d),o.forEach(v=>v.resumeAutoCommit()),d&&(s.eventStore.acceptChanges(),s.dependencyStore.acceptChanges(),s.resourceStore.acceptChanges(),s.assignmentStore.acceptChanges(),s.calendarManagerStore.acceptChanges(),s.acceptChanges())}s.trigger("commitFinalized",{isInitialCommit:l,transactionResult:n})}h()},0)})}*onComputationCycleHandler(n){if(this.onComputationCycle==="effect"){const s=this.project.cycleEffectClass.new({cycle:n});(yield s)===fr.Cancel&&(yield wn(s))}else return yield*super.onComputationCycleHandler(n)}async[ap](n,s){return this.project.onCycleSchedulingIssue(n,s)}async[ip](n,s){return s.walkContext.startNewEpoch(),this.project.onEmptyCalendarSchedulingIssue(n,s)}async[ep](n,s){return s.walkContext.startNewEpoch(),this.project.onConflictSchedulingIssue(n,s)}[el](n,s){return super[el](n,s)}}return t}){},bE=class extends Ve(ol){static get $name(){return"RemoveDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.remove()}},CE=class extends Ve(F){static get $name(){return"CycleEffectDescription"}static getDescription(e){return Wr(this.L("L{descriptionTpl}"),this.getShortDescription(e))}static getShortDescription(e){const r=e.getEvents().slice();return r.push(r[0]),'"'+r.map(t=>t.name||"#"+t.id).join('" -> "')+'"'}},An=class extends ll{constructor(){super(...arguments),this.handler=ap}getEvents(){if(!this._events){const e=new Set;this.cycle.cycle.forEach(({context:r})=>e.add(r)),this._events=[...e]}return this._events}matchDependencyBySourceAndTargetEvent(e,r,t){return e.fromEvent===r&&e.toEvent===t}getDependencyForSourceAndTargetEvents(e,r){return this.getEvents()[0].project.getDependencyStore().find(s=>this.matchDependencyBySourceAndTargetEvent(s,e,r))}getDependencies(){if(!this._dependencies){const e=new Set,r=this.getEvents(),t=r.length;let i=r[0],n;if(t===1)(n=this.getDependencyForSourceAndTargetEvents(i,i))&&e.add(n);else for(const s of r)for(const a of r)(n=this.getDependencyForSourceAndTargetEvents(s,a))&&e.add(n),(n=this.getDependencyForSourceAndTargetEvents(a,s))&&e.add(n);this._dependencies=[...e]}return this._dependencies}getResolutions(){return this._resolutions||(this._resolutions=[this.removeDependencyCycleEffectResolutionClass.new()]),this._resolutions}};sp([fe("cycle")],An.prototype,"type",void 0),sp([fe(CE)],An.prototype,"_descriptionBuilderClass",void 0),sp([fe(bE)],An.prototype,"removeDependencyCycleEffectResolutionClass",void 0);var SE=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},iu=class extends G([la],e=>{const r=e.prototype;class t extends e{}return SE([Ot({bucket:"assigned",resolver:function(i){return this.getEventById(i)},modelFieldConfig:{serialize:i=>i==null?void 0:i.id,isEqual:na,persist:!1}},Rn)],t.prototype,"event",void 0),SE([Ot({bucket:"assigned",resolver:function(i){return this.getResourceById(i)},modelFieldConfig:{serialize:i=>i==null?void 0:i.id,isEqual:na,persist:!1}},Rn)],t.prototype,"resource",void 0),Qd(t),t}){},lp=class extends G([Yf,Pn],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=100}static get defaultConfig(){return{modelClass:iu}}set data(n){this.allAssignmentsForRemoval=!0,super.data=n,this.allAssignmentsForRemoval=!1}}return t}){},cp=class extends G([qf,Pn],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=500}static get defaultConfig(){return{tree:!0,modelClass:In}}}return t}){},dp=class extends G([Kf,Pn],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=200}set data(n){this.allDependenciesForRemoval=!0,super.data=n,this.allDependenciesForRemoval=!1}}return t}){},Lt;(function(e){e.KeepDuration="KeepDuration",e.KeepStartDate="KeepStartDate",e.KeepEndDate="KeepEndDate"})(Lt||(Lt={}));var ve=Symbol("StartDate"),ye=Symbol("EndDate"),Ee=Symbol("Duration"),Mr=Ge.new({output:ve,inputs:new Set([Ee,ye])}),Pr=Ge.new({output:ye,inputs:new Set([Ee,ve])}),Ti=Ge.new({output:Ee,inputs:new Set([ve,ye])}),up=Ks.new({variables:new Set([ve,ye,Ee]),formulas:new Set([Mr,Pr,Ti])}),wE=Dr.new({description:up,defaultResolutionFormulas:new Set([Pr])}),DE=Dr.new({description:up,defaultResolutionFormulas:new Set([Mr])}),hp=class extends LD{addInstruction(e){e===Lt.KeepStartDate&&this.addKeepIfPossibleFlag(ve),e===Lt.KeepEndDate&&this.addKeepIfPossibleFlag(ye),e===Lt.KeepDuration&&this.addKeepIfPossibleFlag(Ee)}},fp=class extends tr.mix(ur){equality(e,r){const t=e.resolution,i=r.resolution;return t.get(ve)===i.get(ve)&&t.get(ye)===i.get(ye)&&t.get(Ee)===i.get(Ee)||t.get(ve)===Et&&t.get(ye)===Et&&t.get(Ee)===Et}},nu=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},su=class extends G([la],e=>{class r extends e{writeCalendar(i,n,s,a){const o=this.getCalendarManagerStore(),l=a;a&&o&&a instanceof In&&!o.includes(l)&&o.add(a),i.constructor.prototype.write.call(this,i,n,s,a)}resolveCalendar(i){var n;return(n=this.getCalendarManagerStore())==null?void 0:n.getById(i)}*calculateEffectiveCalendar(){let i=yield this.$.calendar;return i||(i=yield this.getProject().$.effectiveCalendar),yield i.$.version,i}shouldRecordFieldChange(i,n,s){if(!super.shouldRecordFieldChange(i,n,s))return!1;const{project:a}=this;if(i==="calendar"&&a){const{calendarManagerStore:o}=a;return o.oldIdMap[n]!==o.getById(s)}return!0}}return nu([Ce({equality:()=>!1})],r.prototype,"effectiveCalendar",void 0),nu([Ot({modelFieldConfig:{persist:!0,serialize:t=>t===void 0?void 0:(t==null?void 0:t.id)||null,isEqual:na},resolver:function(t){return this.resolveCalendar(t)},sync:!0},Rn)],r.prototype,"calendar",void 0),nu([Kr("calendar")],r.prototype,"writeCalendar",null),nu([oe("effectiveCalendar")],r.prototype,"calculateEffectiveCalendar",null),Qd(r),r}){},EE=class extends G([],e=>{class r extends e{constructor(){super(...arguments),this.combinedcalendarscache=new Map}combineCalendars(i){const n=Ms(i);if(n.length===0)throw new Error("No calendars to combine");n.sort((c,d)=>c.internalId<d.internalId?-1:1);const s=n.map(c=>c.internalId+"/").join(""),a=n.map(c=>c.version+"/").join(""),o=this.combinedcalendarscache.get(s);let l;return o&&o.versionsHash===a?l=o.cache:(l=new Nf({calendarCaches:n.map(c=>c.calendarCache)}),this.combinedcalendarscache.set(s,{versionsHash:a,cache:l})),l}}return r}){},vt=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},_n=class extends G([su],e=>{const r=e.prototype;class t extends e{*calculateDispatcher(n){const s=yield we,a=yield*this.prepareDispatcher(n),o=yield Dn(this.$.startDate),l=o?o[0]?Lt.KeepDuration:Lt.KeepEndDate:void 0;l&&a.addInstruction(l);const c=yield Dn(this.$.endDate),d=c?c[0]?Lt.KeepDuration:Lt.KeepStartDate:void 0;d&&a.addInstruction(d);const u=yield this.$.direction,h=yield Dn(this.$.duration);let f;if(h)switch(h[0]){case!0:f=Lt.KeepStartDate;break;case!1:f=Lt.KeepEndDate;break}return!f&&a.hasProposedValue(Ee)&&(f=u===Ue.Forward||u===Ue.None?Lt.KeepStartDate:Lt.KeepEndDate),f&&a.addInstruction(f),a}*prepareDispatcher(n){const a=this.dispatcherClass(n).new({context:this.cycleResolutionContext(n)});return a.collectInfo(n,this.$.startDate,ve),a.collectInfo(n,this.$.endDate,ye),a.collectInfo(n,this.$.duration,Ee),a}cycleResolutionContext(n){const s=n(this.$.direction);return s===Ue.Forward||s===Ue.None?wE:DE}dispatcherClass(n){return hp}buildProposedDispatcher(n,s,a){const o=this.dispatcherClass(a.onEffectSync).new({context:this.cycleResolutionContext(a.onEffectSync)});return o.addPreviousValueFlag(ve),o.addPreviousValueFlag(ye),o.addPreviousValueFlag(Ee),o}*skipNonWorkingTime(n,s){const a=yield this.$.effectiveCalendar;if(!n)return null;const o=a.skipNonWorkingTime(n,s);if(o instanceof Date)return o;{const l=dl.new({calendars:[a],event:this,date:n,isForward:s});if((yield l)===fr.Cancel)yield wn(l);else return null}}*skipWorkingTime(n,s,a,o){const l=yield this.$.durationUnit;return o&&o!==l&&(a=yield*this.getProject().$convertDuration(a,o,l)),yield*this.calculateProjectedXDateWithDuration(n,s,a)}setStartDate(n,s=!0){const{graph:a,project:o}=this;return a?(a.write(this.$.startDate,n,s),a.commitAsync()):(this.$.startDate.DATA=n,o==null?void 0:o.delayedCalculationPromise)}writeStartDate(n,s,a,o,l=!0){!s.baseRevision.hasIdentifier(n)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,s,void 0,o==null),n.constructor.prototype.write.call(this,n,s,a,o,l))}*calculateStartDate(){const s=(yield this.$.dispatcher).resolution.get(ve);if(s===Et)return yield*this.calculateStartDateProposed();if(s===Mr.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const n=this.getProject(),s=yield we;return!(yield this.$.manuallyScheduled)||n.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(s,!0):s}*calculateProjectedXDateWithDuration(n,s,a){const o=yield this.$.durationUnit,l=yield this.$.effectiveCalendar,c=this.getProject();return!n||iw(a)?null:(s=s===void 0?!0:s,s?l.calculateEndDate(n,yield*c.$convertDuration(a,o,Q.Millisecond)):l.calculateStartDate(n,yield*c.$convertDuration(a,o,Q.Millisecond)))}setEndDate(n,s=!1){const{graph:a,project:o}=this;return a?(a.write(this.$.endDate,n,s),a.commitAsync()):(this.$.endDate.DATA=n,o==null?void 0:o.delayedCalculationPromise)}writeEndDate(n,s,a,o,l=!1){!s.baseRevision.hasIdentifier(n)&&o==null||(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,s,void 0,o==null),n.constructor.prototype.write.call(this,n,s,a,o,l))}*calculateEndDate(){const s=(yield this.$.dispatcher).resolution.get(ye);if(s===Et)return yield*this.calculateEndDateProposed();if(s===Pr.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const n=this.getProject(),s=yield we;return!(yield this.$.manuallyScheduled)||n.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(s,!1):s}getDuration(n){const s=this.duration;return n!==void 0?this.getProject().convertDuration(s,this.durationUnit,n):s}setDuration(n,s,a){const{graph:o,project:l}=this;if(o){if(n!==void 0)return o.write(this.$.duration,n,s,a),o.commitAsync()}else{const c={duration:n};return this.$.duration.DATA=n,s!=null&&(c.durationUnit=this.$.durationUnit.DATA=s),this.set(c),l==null?void 0:l.delayedCalculationPromise}}setDurationUnit(n){throw new Error("Use `setDuration` instead")}writeDuration(n,s,a,o,l,c=void 0){o<0&&(o=0),!(!s.baseRevision.hasIdentifier(n)&&o==null)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,s,void 0,o==null),n.constructor.prototype.write.call(this,n,s,a,o,c),l!=null&&s.write(this.$.durationUnit,l))}*calculateDuration(){const s=(yield this.$.dispatcher).resolution.get(Ee);if(s===Et)return yield*this.calculateDurationProposed();if(s===Ti.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const n=yield this.$.startDate,s=yield this.$.endDate;if(!n||!s)return null;if(n>s)yield ED(this.$.duration,0,null);else return yield*this.calculateProjectedDuration(n,s)}*calculateDurationProposed(){return yield we}*calculateProjectedDuration(n,s,a){if(!n||!s)return null;a||(a=yield this.$.durationUnit);const o=yield this.$.effectiveCalendar;return yield*this.getProject().$convertDuration(o.calculateDurationMs(n,s),Q.Millisecond,a)}*calculateEffectiveDuration(){const n=yield this.$.dispatcher;let s;const a=n.resolution.get(Ee);return a===Et?s=yield this.$.duration:a===Ti.formulaId&&(s=yield*this.calculateProjectedDuration(yield Ke(this.$.startDate),yield Ke(this.$.endDate))),s}*calculateEffectiveCalendar(){const n=yield this.$.manuallyScheduled,s=this.getProject();return n&&!s.skipNonWorkingTimeInDurationWhenSchedulingManually?s.defaultCalendar:yield*super.calculateEffectiveCalendar()}}return vt([de({type:"date"},{converter:Mn})],t.prototype,"startDate",void 0),vt([de({type:"date"},{converter:Mn})],t.prototype,"endDate",void 0),vt([de({type:"number",allowNull:!0})],t.prototype,"duration",void 0),vt([de({type:"string",defaultValue:Q.Day},{converter:i=>b.normalizeUnit(i)||Q.Day})],t.prototype,"durationUnit",void 0),vt([de({type:"string",defaultValue:Ue.Forward},{sync:!0})],t.prototype,"direction",void 0),vt([Ce({identifierCls:fp})],t.prototype,"dispatcher",void 0),vt([de({type:"boolean",defaultValue:!1})],t.prototype,"manuallyScheduled",void 0),vt([de({type:"boolean",defaultValue:!1})],t.prototype,"unscheduled",void 0),vt([oe("dispatcher")],t.prototype,"calculateDispatcher",null),vt([KD("dispatcher")],t.prototype,"buildProposedDispatcher",null),vt([Kr("startDate")],t.prototype,"writeStartDate",null),vt([oe("startDate")],t.prototype,"calculateStartDate",null),vt([Kr("endDate")],t.prototype,"writeEndDate",null),vt([oe("endDate")],t.prototype,"calculateEndDate",null),vt([Kr("duration")],t.prototype,"writeDuration",null),vt([oe("duration")],t.prototype,"calculateDuration",null),t}){},h_=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},gp=class extends G([_n,Uf],e=>{const r=e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return h_([Ot({},Tn)],t.prototype,"assigned",void 0),t}){},xE=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},mp=class extends G([_n],e=>{const r=e.prototype;class t extends e{leaveProject(){var n,s;if(this.isInActiveTransaction){const a=this.graph.activeTransaction,o=this.getDependencyStore(),l=[];for(const c of(n=a.readCurrentOrProposedOrPrevious(this.$.outgoingDeps))!=null?n:[])o.includes(c)&&l.push(c);for(const c of(s=a.readCurrentOrProposedOrPrevious(this.$.incomingDeps))!=null?s:[])o.includes(c)&&l.push(c);this.project.dependencyStore.remove(l)}r.leaveProject.call(this)}}return xE([Ot({},Tn)],t.prototype,"outgoingDeps",void 0),xE([Ot({},Tn)],t.prototype,"incomingDeps",void 0),t}){},au=class extends G([_n,gp,mp],e=>{const r=e.prototype;class t extends e{}return t}){},ul=class extends G([Xf,Pn],e=>{class r extends e{constructor(){super(...arguments),this.removalOrder=400}static get defaultConfig(){return{modelClass:au}}set data(i){super.data=i,this.afterEventRemoval()}}return r}){},f_=class extends G([ul],e=>{class r extends e{buildRootNode(){return this.getProject()||{}}static get defaultConfig(){return{tree:!0}}}return r}){},g_=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},ou=class extends G([su,la],e=>{const r=e.prototype;class t extends e{get assignments(){return[...this.assigned]}leaveProject(n=!1){if(!this.isStmRestoring&&this.assigned&&!n){const s=this.getResourceStore();this.assigned.forEach(a=>s.assignmentsForRemoval.add(a))}r.leaveProject.call(this)}static get fields(){return[{name:"parentId"},{name:"children",persist:!1}]}}return g_([Ot({},Tn)],t.prototype,"assigned",void 0),t}){},pp=class extends G([Zf,Pn],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.removalOrder=300}static get defaultConfig(){return{modelClass:ou}}}return t}){},hl=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},RE=class extends G([eu],e=>{const r=e.prototype;class t extends e{*calculateUnitsInMs(){const n=yield this.$.hoursPerDay,s=yield this.$.daysPerWeek,a=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:60*1e3,hour:60*60*1e3,day:n*60*60*1e3,week:s*n*60*60*1e3,month:a*n*60*60*1e3,quarter:3*a*n*60*60*1e3,year:4*3*a*n*60*60*1e3}}convertDuration(n,s,a){let o=n;return s!==a&&(o=n*this.unitsInMs[s]/this.unitsInMs[a]),o}*$convertDuration(n,s,a){if(!s||!a)throw new Error("Conversion unit not provided");const o=yield this.$.unitsInMs;let l=n;return s!==a&&(l=n*o[s]/o[a]),l}}return hl([Ce()],t.prototype,"unitsInMs",void 0),hl([de({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),hl([de({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),hl([de({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),hl([oe("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}){},fl=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},vp=class extends G([la],e=>{const r=e.prototype;class t extends e{get isValid(){const{$:n,graph:s}=this;return s&&(!s.hasIdentifier(n.fromEvent)||!s.hasIdentifier(n.toEvent))?!1:super.isValid}}return fl([Ot({bucket:"outgoingDeps",resolver:function(i){return this.getEventById(i)},modelFieldConfig:{persist:!0,serialize:i=>i==null?void 0:i.id,isEqual:na}},Rn)],t.prototype,"fromEvent",void 0),fl([Ot({bucket:"incomingDeps",resolver:function(i){return this.getEventById(i)},modelFieldConfig:{persist:!0,serialize:i=>i==null?void 0:i.id,isEqual:na}},Rn)],t.prototype,"toEvent",void 0),fl([de({type:"int",defaultValue:bi.EndToStart})],t.prototype,"type",void 0),fl([de({type:"string"})],t.prototype,"fromSide",void 0),fl([de({type:"string"})],t.prototype,"toSide",void 0),t}){},TE=class extends G([eu,dw],e=>{const r=e.prototype;class t extends e{get isDelayingCalculation(){return!!(this.delayEnteringReplica||this.delayedCalculationPromise)}getGraph(){return this.replica}beforeCommitAsync(){return null}enterReplica(n){}acceptChanges(){}async commitAsync(){var n;return this.delayedCalculationPromise||((n=this.replica)==null?void 0:n.commitAsync())}getSchedulingIssueEventArguments(n,s,a,o){const l=[n.type,{continueWithResolutionResult:a,schedulingIssue:n}];return n instanceof aa&&(l[1].conflict=n),l}async onSchedulingIssueCall(n,s){return n.type&&this.hasListener(n.type)?new Promise((a,o)=>{this.trigger(...this.getSchedulingIssueEventArguments(n,s,a,o))}):fr.Cancel}async onCycleSchedulingIssue(n,s){return this.onSchedulingIssueCall(n,s)}async onEmptyCalendarSchedulingIssue(n,s){return this.onSchedulingIssueCall(n,s)}async onConflictSchedulingIssue(n,s){return this.onSchedulingIssueCall(n,s)}setModelCalculations(n,s){if(!s)return;const a={};for(const o in s)a[o]=n.prototype.$calculations[o];return Object.assign(n.prototype.$calculations,s),a}setRecordCalculations(n,s){const a=this.setModelCalculations(n.constructor,s),o=n.$entity.$skeleton;return Object.keys(s).forEach(l=>{o[l].prototype.calculation=n[s[l]]}),a}setStoreCalculations(n,s){if(!s)return;const a=n.first;return a?this.setRecordCalculations(a,s):this.setModelCalculations(n.modelClass,s)}async setCalculations(n){this.replica&&await this.commitAsync();const s={},a={tasks:this.eventStore,events:this.eventStore,dependencies:this.dependencyStore,resources:this.resourceStore,assignments:this.assignmentStore,calendars:this.calendarManagerStore};Object.keys(a).forEach(l=>{n[l]&&(s[l]=this.setStoreCalculations(a[l],n[l]))});let o=n.project;return o&&(s.project=this.setRecordCalculations(this,o)),this.replica&&this.repopulateReplica.now(),this.replica&&await this.commitAsync(),s}}return t}){},lu=class extends G([_n],e=>{const r=e.prototype;class t extends e{static get $name(){return"HasSubEventsMixin"}*hasSubEvents(){throw new Error("Abstract method `hasSubEvents` has been called")}*subEventsIterable(){throw new Error("Abstract method `subEventsIterable` has been called")}*calculateStartDatePure(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateMinChildrenStartDate():yield*r.calculateStartDatePure.call(this)}*calculateEndDatePure(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateMaxChildrenEndDate():yield*r.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateStartDatePure():yield*r.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateEndDatePure():yield*r.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const n=yield this.$.manuallyScheduled,s=yield*this.hasSubEvents();return!n&&s?yield*this.calculateDurationPure():yield*r.calculateDurationProposed.call(this)}*shouldRollupChildStartDate(n){return!0}*calculateMinChildrenStartDate(){const n=yield*this.subEventsIterable();let s=Qe.getTime();for(const a of n)if(yield*this.shouldRollupChildStartDate(a)){let o=yield a.$.startDate;o||(o=yield a.$.endDate),o&&o.getTime()<s&&(s=o.getTime())}return s===ft.getTime()||s===Qe.getTime()?null:new Date(s)}*shouldRollupChildEndDate(n){return!0}*calculateMaxChildrenEndDate(){const n=yield*this.subEventsIterable();let s=ft.getTime();for(const a of n)if(yield*this.shouldRollupChildEndDate(a)){let o=yield a.$.endDate;o||(o=yield a.$.startDate),o&&o.getTime()>s&&(s=o.getTime())}return s===ft.getTime()||s===Qe.getTime()?null:new Date(s)}}return t}){},ME=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},gl=class extends G([lu],e=>{const r=e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(n){this._parent=n,this.parentEvent=n}}return ME([ZD({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),ME([eE()],t.prototype,"childEvents",void 0),t}){},yp=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},PE=class extends QS([TE,_n,lu,su,RE,EE],e=>{const r=e.prototype;class t extends e{construct(n={}){this.delayCalculation=n.delayCalculation!==!1,this.enableProgressNotifications=n.enableProgressNotifications||n.delayCalculation!==!1,"expanded"in n||(n.expanded=!0),this.delayCalculation&&(this.delayEnteringReplica=!0),"skipNonWorkingTimeWhenSchedulingManually"in n||(n.skipNonWorkingTimeWhenSchedulingManually=!1),r.construct.call(this,n),this.repopulateStores=new Set,this.ignoreInitialCommitComputationCycles="ignoreInitialCommitComputationCycles"in n?n.ignoreInitialCommitComputationCycles:!1,this.ignoreInitialCommitComputationCycles&&console.warn('Project "ignoreInitialCommitComputationCycles" option is deprecated and will be dropped in the next major release'),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.cycleEffectClass||(this.cycleEffectClass=this.getDefaultCycleEffectClass()),this.initializeStm(),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.delayEnteringReplica||this.enterReplica(!1),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore),!!(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)?(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.delayCalculation&&this.hasDataInStores&&this.scheduleDelayedCalculation()}get hasDataInStores(){return[this.calendarManagerStore,this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore].some(n=>n.allCount>0)}enterReplica(n){const s=this;s.replica||(s.replica=s.createReplica(),s.replica.addEntity(s),s.replica.addEntity(s.defaultCalendar),s.trigger("graphReady")),n&&!s.isRepopulatingStores&&(s.calendarManagerStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.eventStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.resourceStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.dependencyStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}),s.assignmentStore.forEach(a=>{!a.graph&&a.joinProject()},void 0,{includeFilteredOutRecords:!0}))}resetStmQueue(){const n=this.stm.disabled;this.stm.disable(),this.stm.resetQueue(),n||this.stm.enable()}doDestroy(){var n,s,a,o,l,c,d,u;const h=this;(n=h.eventStore)==null||n.destroy(),(s=h.dependencyStore)==null||s.destroy(),(a=h.assignmentStore)==null||a.destroy(),(o=h.resourceStore)==null||o.destroy(),(l=h.calendarManagerStore)==null||l.destroy(),(c=h.defaultCalendar)==null||c.destroy(),(d=h.replica)==null||d.clear(),(u=h.stm)==null||u.destroy(),r.doDestroy.call(this)}getReplicaConfig(){return{project:this,schema:nE.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,cycleEffectClass:this.cycleEffectClass,onWriteDuringCommit:"ignore",readMode:qr.CurrentOrProposedOrPrevious}}createReplica(){return yE.mix(Wm).new(this.getReplicaConfig())}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return Ci.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(n){this._enableProgressNotifications=n,this.replica&&(this.replica.enableProgressNotifications=n)}getDefaultCycleEffectClass(){return An}getDefaultEventModelClass(){return au}getDefaultEventStoreClass(){return ul}getDefaultDependencyModelClass(){return vp}getDefaultDependencyStoreClass(){return dp}getDefaultResourceModelClass(){return ou}getDefaultResourceStoreClass(){return pp}getDefaultAssignmentModelClass(){return iu}getDefaultAssignmentStoreClass(){return lp}getDefaultCalendarModelClass(){return In}getDefaultCalendarManagerStoreClass(){return cp}usingSyncDataOnLoad(){return[this.eventStore,this.resourceStore,this.dependencyStore,this.assignmentStore].some(n=>n.syncDataOnLoad)}async loadInlineData(n){const{calendarManagerStore:s,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:d}=this;if(!this.isInitialCommitPerformed)d==null||d.unScheduleAutoCommit();else for(;this.replica.isCommitting;)await this.commitAsync();d!=null&&d.enableProgressNotifications&&!this.delayCalculation&&(await Zo(0),await this.commitAsync(),d.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await Zo(50)),this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!0,globalThis.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("Time to visible"),console.time("Populating project")),this.delayCalculation&&!this.delayedCalculationPromise&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),n.calendarsData&&(this.repopulateStore(s),s.data=n.calendarsData),(n.eventsData||n.tasksData)&&(this.repopulateStore(a),a.data=n.eventsData||n.tasksData),n.dependenciesData&&(this.repopulateStore(o),o.data=n.dependenciesData),n.resourcesData&&(this.repopulateStore(c),c.data=n.resourcesData),n.assignmentsData&&(this.repopulateStore(l),l.data=n.assignmentsData),n.project&&this.applyProjectResponse(n.project),globalThis.DEBUG&&console.timeEnd("Populating project");const u=await this.commitLoad();return this.isLoadingInlineData=!1,u}setupTemporaryIndices(){const{storage:n}=this.assignmentStore||{};n&&(n.addIndex({property:"event",unique:!1}),n.addIndex({property:"resource",unique:!1}))}removeTemporaryIndices(){const{storage:n}=this.assignmentStore;n.removeIndex("event"),n.removeIndex("resource")}async internalDelayCalculation(n){const s=this;if(s.delayEnteringReplica=!0,s.setupTemporaryIndices(),await Zo(0),s.isDestroyed){n();return}if(s.trigger("delayCalculationStart"),s.trigger("refresh",{isCalculated:!1}),await Zo(0),s.isDestroyed){n();return}s.delayEnteringReplica=!1,s.isRepopulatingStores?s.repopulateReplica.now():(s.trigger("recordsUnlinked"),s.enterReplica(!0));const a=await s.replica.commitAsync();if(s.isDestroyed){n();return}n(a),s.delayedCalculationPromise=null,s.trigger("delayCalculationEnd"),s.removeTemporaryIndices()}scheduleDelayedCalculation(){if(this.delayedCalculationPromise)return this.delayedCalculationPromise;if(this.delayCalculation!==!1)return this.delayedCalculationPromise=new Promise(n=>this.internalDelayCalculation(n).then())}async commitLoad(){const n=await this.commitAsync();return this.isDestroyed||this.trigger("load"),n}initializeStm(){const n=this.stmClass||Xn;this.stm instanceof Xn||this.setStm(n.new({disabled:!0},this.stm)),this.resetUndoRedoQueuesAfterLoad&&this.ion({load:this.resetStmQueue,thisObj:this}),this.ion({beforeCommit:this.onCommitInitialization,commitFinalized:this.onCommitFinalization,commitRejected:this.onCommitRejection,thisObj:this})}removeRejectedRecordsAdd({transactionResult:n,silenceCommit:s}){var a,o,l;const c=new Map;for(const u of n.entries.values()){const h=u.identifier,{field:f}=h;if(u.isShadow()||!h[Zd]||f instanceof Tn)continue;const g=h.self,m=g.firstStore;m&&!u.previous&&!((a=n.transaction.getLatestStableEntryFor(g.$$))!=null&&a.previous)&&(c.has(m)?c.get(m).has(g)||c.get(m).add(g):c.set(m,new Set([g])))}(o=this.suspendChangesTracking)==null||o.call(this),Array.from(c.keys()).sort((u,h)=>u.removalOrder-h.removalOrder).forEach(u=>u.remove(c.get(u))),(l=this.resumeChangesTracking)==null||l.call(this,s),s&&(this.eventStore.acceptChanges(),this.dependencyStore.acceptChanges(),this.resourceStore.acceptChanges(),this.assignmentStore.acceptChanges(),this.calendarManagerStore.acceptChanges())}onCommitRejection(n){this._stmDisabled?(this.replica.isWritingPreviousData=!0,this.isRestoringData=!0,this.removeRejectedRecordsAdd(n),this.isRestoringData=!1,this.replica.isWritingPreviousData=!1):this.rejectStmTransaction()}onCommitInitialization(){const{stm:n}=this;this._stmDisabled=n.disabled,n.isRecording&&n.autoRecord&&(this._stmAutoRecord=!0,n.autoRecord=!1)}onCommitFinalization(){this._stmAutoRecord&&(this.stm.autoRecord=!0,this._stmAutoRecord=!1)}onSTMRestoringStart({source:n}){this.replica&&(this.replica.isWritingPreviousData=!0)}async onSTMRestoringStop({source:n}){this.replica&&(this.replica.isWritingPreviousData=!1);const s=n;s.disable(),await this.commitAsync(),this.isDestroyed||(s.enable(),this.trigger("stateRestoringDone"))}deferUntilRepopulationIfNeeded(n,s,a){this.isRepopulatingStores?(this.detachListeners(n),this.ion({name:n,repopulateReplica:{fn:async()=>{await this.commitAsync(),this.isDestroyed||s(...a)},once:!0}})):s(...a)}get isRepopulatingStores(){var n;return!!((n=this.repopulateStores)!=null&&n.size)}repopulateStore(n){var s;const a=this;a.repopulateOnDataset&&n.allCount&&!n.syncDataOnLoad&&((s=a.replica)==null||s.activeTransaction.stop(),a.repopulateStores||(a.repopulateStores=new Set),a.repopulateStores.add(n),a.repopulateReplica())}repopulateReplica(){const n=this;if(n.delayEnteringReplica)return;const{calendarManagerStore:s,eventStore:a,dependencyStore:o,assignmentStore:l,resourceStore:c,replica:d}=n;d?(n.unlinkStoreRecords(s,a,o,c,l),n.unlinkRecord(n),n.unlinkRecord(n.defaultCalendar),n.trigger("recordsUnlinked"),d.clear()):n.trigger("recordsUnlinked");const u=n.replica=n.createReplica();u.addEntity(n),u.addEntity(n.defaultCalendar),n.joinStoreRecords(s,!0),n.joinStoreRecords(a,!0),n.joinStoreRecords(o,!0),n.joinStoreRecords(c,!0),n.joinStoreRecords(l,!0),n.repopulateStores.clear(),n.trigger("repopulateReplica")}beforeCommitAsync(){return this.repopulateReplica.isPending&&!this.isDelayingCalculation?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(n){var s;if(n!=null&&n.graph){const{activeTransaction:a}=this.replica,{$:o}=n,l=Object.keys(o);for(let c=0;c<l.length;c++){const d=l[c],u=o[d],h=a.getLatestEntryFor(u);if(h){let f=h.getValue();f===void 0&&(f=h.proposedValue),f!==void 0&&(u.DATA=u.field instanceof Rn&&(s=f==null?void 0:f.id)!=null?s:f)}}n.graph=null}}unlinkStoreRecords(...n){n.forEach(s=>{(!this.repopulateStores.has(s)||s.syncDataOnLoad)&&s.traverse(a=>{this.unlinkRecord(a)},!1,!1,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})})}getGraph(){return this.replica}async addEvents(n){return this.eventStore.add(n),this.commitAsync()}async addEvent(n){return this.eventStore.add(n),this.commitAsync()}includeEvent(n){this.eventStore.add(n)}async removeEvents(n){return this.eventStore.remove(n),this.commitAsync()}excludeEvent(n){this.eventStore.remove(n)}async removeEvent(n){return this.eventStore.remove(n),this.commitAsync()}getStm(){return this.stm}setStm(n){this.stm=n,this.stm.ion({restoringStart:this.onSTMRestoringStart,restoringStop:this.onSTMRestoringStop,thisObj:this})}calculateProject(){return this}*calculateEffectiveCalendar(){let n=yield this.$.calendar;return n?yield n.$.version:n=this.defaultCalendar,n}joinStoreRecords(n,s=!1){const a=o=>{o.setProject(this),o.joinProject()};n.rootNode?n.rootNode.traverse(a,s,!0):n.forEach(a,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}unjoinStoreRecords(n){const s=a=>{a.leaveProject(),a.setProject(this)};n.rootNode?n.rootNode.traverse(a=>{a!==n.rootNode&&s(a)},!1,!0):n.forEach(s,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}setEventStore(n){const s=this.eventStore;if(s&&this.stm.hasStore(s)){this.stm.removeStore(s),this.unjoinStoreRecords(s),this.detachStore(s);const a=s.assignmentsForRemoval;a.forEach(o=>{const l=o.event;if(l){const c=n.getById(l.id);c&&(o.event=c,a.delete(o))}}),s.afterEventRemoval()}if(!n||!(n instanceof ee)){const a=(n==null?void 0:n.storeClass)||this.eventStoreClass;this.eventStore=new a(T.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},n||{}))}else this.eventStore=n,n.setProject(this),this.stm.addStore(n),n.tree&&n.rootNode!==this?(this.appendChild(n.rootNode.children||[]),n.rootNode=this):this.joinStoreRecords(n);this.attachStore(this.eventStore),this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(n){const s=this.dependencyStore;if(s&&this.stm.hasStore(s)&&(this.stm.removeStore(s),this.detachStore(s)),!n||!(n instanceof ee)){const a=(n==null?void 0:n.storeClass)||this.dependencyStoreClass;this.dependencyStore=new a(T.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},n||{}))}else this.dependencyStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.attachStore(this.dependencyStore),this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(n){const s=this.resourceStore;if(s&&this.stm.hasStore(s)){this.stm.removeStore(s),this.unjoinStoreRecords(s),this.detachStore(s);const a=s.assignmentsForRemoval;a.forEach(o=>{const l=o.resource;if(l){const c=n.getById(l.id);c&&(o.resource=c,a.delete(o))}}),s.afterResourceRemoval()}if(!n||!(n instanceof ee)){const a=(n==null?void 0:n.storeClass)||this.resourceStoreClass;this.resourceStore=new a(T.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},n||{}))}else this.resourceStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.attachStore(this.resourceStore),this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(n){const s=this.assignmentStore;if(s&&this.stm.hasStore(s)&&(this.stm.removeStore(s),this.unjoinStoreRecords(s),this.detachStore(s)),!n||!(n instanceof ee)){const a=(n==null?void 0:n.storeClass)||this.assignmentStoreClass;this.assignmentStore=new a(T.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},n||{}))}else this.assignmentStore=n,n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n);this.isDelayingCalculation&&this.setupTemporaryIndices(),this.attachStore(this.assignmentStore),this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(n){const s=this.calendarManagerStore;if(s&&this.stm.hasStore(s)&&(this.stm.removeStore(s),this.detachStore(s)),!n||!(n instanceof ee)){const a=(n==null?void 0:n.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new a(T.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},n||{}))}else this.calendarManagerStore=n,n&&(n.setProject(this),this.stm.addStore(n),this.joinStoreRecords(n));this.attachStore(this.calendarManagerStore),this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...n){return!0}rejectStmTransaction(n){n=n||this.stm,n.transaction&&(n.transaction.length?(n.forEachStore(s=>s.beginBatch()),n.rejectTransaction(),n.forEachStore(s=>s.endBatch())):n.stopTransaction())}async tryPropagateWithChanges(n){const s=this.stm,a=s.disabled,o=s.autoRecord;a?s.enable():(o&&(s.autoRecord=!1),s.isRecording&&s.stopTransaction()),s.startTransaction(),n();let l=!0;try{l=!(await this.commitAsync()).rejectedWith}catch(c){if(!/cycle/i.test(c))throw c;l=!1}return l?(s.stopTransaction(),a&&s.resetQueue()):(this.replica.reject(),this.rejectStmTransaction(s)),s.disabled=a,s.autoRecord=o,l}isEngineReady(){const{replica:n}=this;return this.delayEnteringReplica||!this.isRepopulatingStores&&(n?!(n.dirty&&(n.hasPendingAutoCommit()||n.isCommitting)):!0)}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataset:!0}}static get delayable(){return{repopulateReplica:10}}}return t.applyConfigs=!0,yp([de({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),yp([de({type:"boolean",defaultValue:!1})],t.prototype,"skipNonWorkingTimeWhenSchedulingManually",void 0),yp([de({type:"boolean",defaultValue:!0})],t.prototype,"skipNonWorkingTimeInDurationWhenSchedulingManually",void 0),t}){},ke=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},IE=function*(e,r,t,i,n){if(t.isIntervalEmpty())return t;if(n&&t.intersectionOf){const o=new Set;for(const l of t.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!1,i):l.startDate,d=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!1,i):l.endDate,u=l;o.add(u.copyWith({reflectionOf:u,side:u.side===bt.Start?bt.End:bt.Start,startDate:c,endDate:d}))}t.intersectionOf=o}const s=t.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.startDate,!1,i):null,a=t.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.endDate,!1,i):null;return Ri([r,oa.new({intersectionOf:t.intersectionOf,startDate:s,endDate:a})],n)},AE=function*(e,r,t,i,n){if(r.isIntervalEmpty())return r;if(n){const o=new Set;for(const l of r.intersectionOf)if(l.isInfinite())o.add(l);else{const c=l.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.startDate,!0,i):l.startDate,d=l.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(l.endDate,!0,i):l.endDate,u=l;o.add(u.copyWith({reflectionOf:u,side:u.side===bt.Start?bt.End:bt.Start,startDate:c,endDate:d}))}r.intersectionOf=o}const s=r.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.startDate,!0,i):null,a=r.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.endDate,!0,i):null;return Ri([t,oa.new({reflectionOf:s||a?r:void 0,intersectionOf:s||a?r.intersectionOf:void 0,startDate:s,endDate:a})],n)},Xr=!0,ml=class extends G([lu],e=>{const r=e.prototype;class t extends e{*maybeSkipNonWorkingTime(n,s=!0){if(yield*this.hasSubEvents())return n;let a=yield*this.calculateEffectiveDuration();return n&&a>0?yield*this.skipNonWorkingTime(n,s):n}*calculateEffectiveConstraintInterval(n,s,a,o=!1){const l=yield*this.calculateEffectiveDuration();return l==null?null:yield*(n?IE:AE)(this,Ri(s,o),Ri(a,o),l,o)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*doCalculateEarlyEffectiveStartDateInterval(n=!1){const s=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,s.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),n)}*calculateEarlyEffectiveStartDateInterval(){return yield*this.doCalculateEarlyEffectiveStartDateInterval()}*doCalculateEarlyEffectiveEndDateInterval(n=!1){const s=yield this.$.earlyStartDateConstraintIntervals,a=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,s.concat(yield this.$.startDateConstraintIntervals),a.concat(yield this.$.endDateConstraintIntervals),n)}*calculateEarlyEffectiveEndDateInterval(){return yield*this.doCalculateEarlyEffectiveEndDateInterval()}*shouldRollupChildEarlyStartDate(n){return!0}*calculateMinChildrenEarlyStartDate(){let n=Qe;const s=yield*this.subEventsIterable();for(let a of s){let o;(yield*this.shouldRollupChildEarlyStartDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.minChildrenEarlyStartDate),o=o||(yield a.$.earlyStartDate),o&&o<n&&(n=o))}return n.getTime()-Qe.getTime()?n:null}*shouldRollupChildEarlyEndDate(n){return!0}*calculateMaxChildrenEarlyEndDate(){let n=ft;const s=yield*this.subEventsIterable();for(let a of s){let o;(yield*this.shouldRollupChildEarlyEndDate(a))&&((yield a.$.manuallyScheduled)&&(yield*a.hasSubEvents())&&(o=yield a.$.maxChildrenEarlyEndDate),o=o||(yield a.$.earlyEndDate),o&&o>n&&(n=o))}return n.getTime()-ft.getTime()?n:null}*calculateEarlyStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.direction)===Ue.Forward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenEarlyStartDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;let n=yield this.$.earlyEffectiveStartDateInterval;if(n===null)return null;if(n.isIntervalEmpty()){n=yield*this.doCalculateEarlyEffectiveStartDateInterval(!0);const s=aa.new({intervals:[...n.intersectionOf]});if((yield s)===fr.Cancel)yield wn(s);else return null}return un(n.startDate)?n.startDate:null}*calculateEarlyStartDate(){const n=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(n,!0)}*calculateEarlyEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.direction)===Ue.Forward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenEarlyEndDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;let n=yield this.$.earlyEffectiveEndDateInterval;if(n===null)return null;if(n.isIntervalEmpty()){n=yield*this.doCalculateEarlyEffectiveEndDateInterval(!0);const s=aa.new({intervals:[...n.intersectionOf]});if((yield s)===fr.Cancel)yield wn(s);else return null}return un(n.startDate)?n.startDate:null}*calculateEarlyEndDate(){return yield this.$.earlyEndDateRaw}*isConstrainedEarly(){const n=yield this.$.startDateConstraintIntervals,s=yield this.$.endDateConstraintIntervals,a=yield this.$.earlyStartDateConstraintIntervals,o=yield this.$.earlyEndDateConstraintIntervals;return!!(n!=null&&n.length||s!=null&&s.length||a!=null&&a.length||o!=null&&o.length)}*calculateStartDatePure(){return(yield this.$.direction)===Ue.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateStartDatePure.call(this):(yield this.$.earlyStartDate)||(yield*r.calculateStartDatePure.call(this)):yield*r.calculateStartDatePure.call(this)}*calculateStartDateProposed(){switch(yield this.$.direction){case Ue.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*r.calculateStartDateProposed.call(this);const s=yield this.$.earlyStartDate;if(s){if(un(s))return s;const a=yield*r.calculateStartDateProposed.call(this),o=yield this.$.earlyEffectiveStartDateInterval;return o.containsDate(a)?a:un(o.endDate)?o.endDate:a}else return yield*r.calculateStartDateProposed.call(this);default:return yield*r.calculateStartDateProposed.call(this)}}*calculateEndDatePure(){return(yield this.$.direction)===Ue.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*r.calculateEndDatePure.call(this):(yield this.$.earlyEndDate)||(yield*r.calculateEndDatePure.call(this)):yield*r.calculateEndDatePure.call(this)}*calculateEndDateProposed(){switch(yield this.$.direction){case Ue.Forward:if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled))return yield*r.calculateEndDateProposed.call(this);const s=yield this.$.earlyEndDate;if(s){if(un(s))return s;const a=yield*r.calculateEndDateProposed.call(this),o=yield this.$.earlyEffectiveEndDateInterval;return o.containsDate(a)?a:un(o.endDate)?o.endDate:a}else return yield*r.calculateEndDateProposed.call(this);default:return yield*r.calculateEndDateProposed.call(this)}}*calculateDirection(){return yield this.getProject().$.direction}}return ke([Ce({lazy:Xr})],t.prototype,"minChildrenEarlyStartDate",void 0),ke([Ce({lazy:Xr})],t.prototype,"earlyStartDateRaw",void 0),ke([de({type:"date",persist:!1},{lazy:Xr,converter:Mn,persistent:!1})],t.prototype,"earlyStartDate",void 0),ke([Ce({lazy:Xr})],t.prototype,"maxChildrenEarlyEndDate",void 0),ke([Ce({lazy:Xr})],t.prototype,"earlyEndDateRaw",void 0),ke([de({type:"date",persist:!1},{lazy:Xr,converter:Mn,persistent:!1})],t.prototype,"earlyEndDate",void 0),ke([Ce()],t.prototype,"startDateConstraintIntervals",void 0),ke([Ce()],t.prototype,"endDateConstraintIntervals",void 0),ke([Ce({lazy:Xr})],t.prototype,"earlyStartDateConstraintIntervals",void 0),ke([Ce({lazy:Xr})],t.prototype,"earlyEndDateConstraintIntervals",void 0),ke([Ce()],t.prototype,"earlyEffectiveStartDateInterval",void 0),ke([Ce()],t.prototype,"earlyEffectiveEndDateInterval",void 0),ke([oe("startDateConstraintIntervals")],t.prototype,"calculateStartDateConstraintIntervals",null),ke([oe("endDateConstraintIntervals")],t.prototype,"calculateEndDateConstraintIntervals",null),ke([oe("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),ke([oe("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),ke([oe("earlyEffectiveStartDateInterval")],t.prototype,"calculateEarlyEffectiveStartDateInterval",null),ke([oe("earlyEffectiveEndDateInterval")],t.prototype,"calculateEarlyEffectiveEndDateInterval",null),ke([oe("minChildrenEarlyStartDate")],t.prototype,"calculateMinChildrenEarlyStartDate",null),ke([oe("maxChildrenEarlyEndDate")],t.prototype,"calculateMaxChildrenEarlyEndDate",null),ke([oe("earlyStartDateRaw")],t.prototype,"calculateEarlyStartDateRaw",null),ke([oe("earlyStartDate")],t.prototype,"calculateEarlyStartDate",null),ke([oe("earlyEndDateRaw")],t.prototype,"calculateEarlyEndDateRaw",null),ke([oe("earlyEndDate")],t.prototype,"calculateEarlyEndDate",null),ke([oe("direction")],t.prototype,"calculateDirection",null),t}){},ca=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},_E=class extends G([ml,gl],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.ignorePinningConstraint=!1}writeStartDate(n,s,a,o,l=!0){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&s.graph.hasIdentifier(this.$.direction)&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!this.isReverting&&!(c!=null&&c.getStm().isRestoring)){const d=this.getStartDatePinConstraintType();d&&(this.constraintType=d,this.constraintDate=o)}return r.writeStartDate.call(this,n,s,a,o,l)}writeEndDate(n,s,a,o,l=!1){const c=this.getProject();if(c!=null&&c.addConstraintOnDateSet&&s.graph.hasIdentifier(this.$.direction)&&l&&!(c!=null&&c.eventStore.isSyncingDataOnLoad)&&!(c!=null&&c.getStm().isRestoring)){const d=this.getEndDatePinConstraintType();d&&(this.constraintType=d,this.constraintDate=o)}return r.writeEndDate.call(this,n,s,a,o,l)}*calculateConstraintType(){let n=yield we;return(yield*this.isConstraintTypeApplicable(n))||(n=null),n}*calculateConstraintDate(n){let s=yield we;const a=yield this.$.constraintType;return a?s||(s=this.getConstraintTypeDefaultDate(n,a)):s=null,s}getStartDatePinConstraintType(){const{direction:n}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(n){case Ue.Forward:return be.StartNoEarlierThan;case Ue.Backward:return be.StartNoLaterThan}}getEndDatePinConstraintType(){const{direction:n}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(n){case Ue.Forward:return be.FinishNoEarlierThan;case Ue.Backward:return be.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:n,ignorePinningConstraint:s,constraintType:a}=this;let o=!1;if(!n&&!s)if(a)switch(a){case be.StartNoEarlierThan:case be.StartNoLaterThan:case be.FinishNoEarlierThan:case be.FinishNoLaterThan:o=!0}else o=!0;return o}applyChangeset(n,s,a){this.ignorePinningConstraint=a;const o=super.applyChangeset(n,s,a);return this.ignorePinningConstraint=!1,o}getConstraintTypeDefaultDate(n,s){switch(s){case be.StartNoEarlierThan:case be.StartNoLaterThan:case be.MustStartOn:return n(Ke(this.$.startDate));case be.FinishNoEarlierThan:case be.FinishNoLaterThan:case be.MustFinishOn:return n(Ke(this.$.endDate))}return null}*isConstraintTypeApplicable(n){const s=yield*this.hasSubEvents();switch(n){case be.FinishNoEarlierThan:case be.StartNoLaterThan:case be.MustFinishOn:case be.MustStartOn:return!s}return!0}async setConstraint(n,s){return this.constraintType=n,s!==void 0&&(this.constraintDate=s),this.commitAsync()}*calculateEndDateConstraintIntervals(){const n=yield*r.calculateEndDateConstraintIntervals.call(this),s=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!s&&a&&o)switch(a){case be.MustFinishOn:n.unshift(l.new({owner:this,side:bt.End,startDate:o,endDate:o}));break;case be.FinishNoEarlierThan:n.unshift(l.new({owner:this,side:bt.End,startDate:o}));break;case be.FinishNoLaterThan:n.unshift(l.new({owner:this,side:bt.End,endDate:o}));break}return n}*calculateStartDateConstraintIntervals(){const n=yield*r.calculateStartDateConstraintIntervals.call(this),s=yield this.$.manuallyScheduled,a=yield this.$.constraintType,o=yield this.$.constraintDate,l=this.project.dateConstraintIntervalClass;if(!s&&a&&o)switch(a){case be.MustStartOn:n.unshift(l.new({owner:this,side:bt.Start,startDate:o,endDate:o}));break;case be.StartNoEarlierThan:n.unshift(l.new({owner:this,side:bt.Start,startDate:o}));break;case be.StartNoLaterThan:n.unshift(l.new({owner:this,side:bt.Start,endDate:o}));break}return n}}return ca([de({type:"string"},{sync:!0})],t.prototype,"constraintType",void 0),ca([de({type:"date"},{converter:Mn,sync:!0})],t.prototype,"constraintDate",void 0),ca([oe("constraintType")],t.prototype,"calculateConstraintType",null),ca([oe("constraintDate")],t.prototype,"calculateConstraintDate",null),t}){},FE=class extends Ve(tp){static get $name(){return"RemoveDateConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return Wr(this.L("L{descriptionTpl}"),e.name||e.id,this.interval.getConstraintName(e.constraintType))}resolve(){this.event.constraintType=null}},kE=class extends ru{static get $name(){return"DateConstraintIntervalDescription"}static getDescription(e){let r;switch(e.owner.constraintType){case be.StartNoEarlierThan:case be.FinishNoEarlierThan:case be.MustStartOn:case be.MustFinishOn:r=this.L("L{startDateDescriptionTpl}");break;case be.StartNoLaterThan:case be.FinishNoLaterThan:r=this.L("L{endDateDescriptionTpl}");break}return Wr(r,...this.getDescriptionParameters(e))}static getConstraintName(e){return this.L("L{constraintTypeTpl}")[e]}static getDescriptionParameters(e){const r=e.owner;return[b.format(e.startDate,this.L("L{dateFormat}")),b.format(e.endDate,this.L("L{dateFormat}")),r.name||r.id,this.getConstraintName(r.constraintType)]}},cu=class extends oa{getConstraintName(e){return this.descriptionBuilderClass.getConstraintName(e||this.owner.constraintType)}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const r=this.owner;e=e||r.graph.activeTransaction;const t=e.entries.get(r.$.constraintDate),i=e.entries.get(r.$.constraintType);return!e.baseRevision.hasIdentifier(r.$$)||t&&!t.isShadow()||i&&!i.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.removeDateConstraintConflictResolutionClass.new({interval:this})])}};ca([fe(FE)],cu.prototype,"removeDateConstraintConflictResolutionClass",void 0),ca([fe(kE)],cu.prototype,"descriptionBuilderClass",void 0);var du=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},OE=class extends G([ml,mp],e=>{const r=e.prototype;class t extends e{*shouldPredecessorAffectScheduling(n){const s=yield n.$.fromEvent;return s&&!jd(s)&&(yield n.$.active)&&(!(yield s.$.inactive)||(yield this.$.inactive))}*calculateEarlyStartDateConstraintIntervals(){const n=yield*r.calculateEarlyStartDateConstraintIntervals.call(this),s=this.getProject(),a=s.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent;let c;switch(yield o.$.type){case bi.EndToStart:c=yield l.$.earlyEndDateRaw;break;case bi.StartToStart:c=yield l.$.earlyStartDateRaw;break}if(c){const d=yield o.$.lag,u=yield o.$.lagUnit,h=yield o.$.calendar;yield h.$.version;const f=a.new({owner:o,startDate:h.calculateEndDate(c,yield*s.$convertDuration(d,u,Q.Millisecond)),endDate:null});n.unshift(f)}}return n}*calculateEarlyEndDateConstraintIntervals(){const n=yield*r.calculateEarlyEndDateConstraintIntervals.call(this),s=this.getProject(),a=s.dependencyConstraintIntervalClass;for(const o of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(o)))continue;const l=yield o.$.fromEvent;let c;switch(yield o.$.type){case bi.EndToEnd:c=yield l.$.earlyEndDateRaw;break;case bi.StartToEnd:c=yield l.$.earlyStartDateRaw;break}if(c){const d=yield o.$.lag,u=yield o.$.lagUnit,h=yield o.$.calendar;yield h.$.version;const f=a.new({owner:o,startDate:h.calculateEndDate(c,yield*s.$convertDuration(d,u,Q.Millisecond)),endDate:null});n.unshift(f)}}return n}}return du([de({type:"boolean"})],t.prototype,"inactive",void 0),t}){},bp=class extends Ve(tp){static get $name(){return"BaseDependencyResolution"}getDescription(){const{dependency:e}=this,{type:r,fromEvent:t,toEvent:i}=e;return Wr(this.L("L{descriptionTpl}"),this.L("L{DependencyType.long}")[r],t.name||t.id,i.name||i.id)}},Cp=class extends bp{static get $name(){return"RemoveDependencyResolution"}resolve(){this.dependency.remove()}},Sp=class extends bp{static get $name(){return"DeactivateDependencyResolution"}resolve(){this.dependency.active=!1}},LE=class extends ru{static get $name(){return"DependencyConstraintIntervalDescription"}static getDescriptionParameters(e){const r=e.owner;return[b.format(e.startDate,this.L("L{dateFormat}")),b.format(e.endDate,this.L("L{dateFormat}")),this.L("L{DependencyType.long}")[r.type],r.fromEvent.name,r.toEvent.name]}},pl=class extends oa{isAffectedByTransaction(e){const r=this.owner;e=e||r.graph.activeTransaction;const{entries:t}=e,{fromEvent:i,toEvent:n,lag:s,lagUnit:a,type:o}=r.$,l=t.get(i),c=t.get(n),d=t.get(s),u=t.get(a),h=t.get(o);return!e.baseRevision.hasIdentifier(r.$$)||l&&!l.isShadow()||c&&!c.isShadow()||d&&!d.isShadow()||u&&!u.isShadow()||h&&!h.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.deactivateDependencyConflictResolutionClass.new({dependency:this.owner}),this.removeDependencyConflictResolutionClass.new({dependency:this.owner})])}};du([fe(Cp)],pl.prototype,"removeDependencyConflictResolutionClass",void 0),du([fe(Sp)],pl.prototype,"deactivateDependencyConflictResolutionClass",void 0),du([fe(LE)],pl.prototype,"descriptionBuilderClass",void 0);var Mi=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},wp=class extends G([iu],e=>{const r=e.prototype;class t extends e{*calculateUnits(){const n=yield this.$.event;return n?yield*n.calculateAssignmentUnits(this):yield we}*calculateEffort(){const n=yield this.$.event;if(n){const s=yield n.$.startDate,a=yield n.$.endDate,o=yield n.$.effectiveCalendar;if(s&&a){const l=new Map;return l.set(o,[this]),yield*n.calculateProjectedEffort(s,a,l)}}return null}*calculateActualDate(){const n=yield this.$.event;if(n){const s=yield n.$.startDate,a=yield n.$.duration,o=yield n.$.percentDone;return yield*n.calculateProjectedXDateWithDuration(s,!0,a*.01*o)}return null}*calculateActualEffort(){const n=yield this.$.event;if(n){const s=yield n.$.startDate,a=yield n.$.effectiveCalendar,o=yield this.$.actualDate,l=new Map;return l.set(a,[this]),yield*n.calculateProjectedEffort(s,o,l)}return null}}return Mi([de({type:"number",defaultValue:100})],t.prototype,"units",void 0),Mi([oe("units")],t.prototype,"calculateUnits",null),Mi([Ce({lazy:!0})],t.prototype,"effort",void 0),Mi([Ce({lazy:!0})],t.prototype,"actualDate",void 0),Mi([Ce({lazy:!0})],t.prototype,"actualEffort",void 0),Mi([oe("effort")],t.prototype,"calculateEffort",null),Mi([oe("actualDate")],t.prototype,"calculateActualDate",null),Mi([oe("actualEffort")],t.prototype,"calculateActualEffort",null),t}){},da=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Dp=class extends G([vp],e=>{const r=e.prototype;class t extends e{*calculateCalendar(){const n=this.getProject(),s=yield n.$.dependenciesCalendar;let a;switch(s){case dn.Project:a=yield n.$.effectiveCalendar;break;case dn.FromEvent:const o=yield this.$.fromEvent;a=o&&!jd(o)?yield o.$.effectiveCalendar:null;break;case dn.ToEvent:const l=yield this.$.toEvent;a=l&&!jd(l)?yield l.$.effectiveCalendar:null;break}return a||(a=yield n.$.effectiveCalendar),a}async setLag(n,s){if(this.graph)return this.graph.write(this.$.lag,n,s),this.graph.commitAsync();this.$.lag.DATA=n,s!=null&&(this.$.lagUnit.DATA=s)}writeLag(n,s,a,o,l=void 0){n.constructor.prototype.write.call(this,n,s,a,o),l!=null&&s.write(this.$.lagUnit,l)}}return da([de({type:"number",defaultValue:0})],t.prototype,"lag",void 0),da([de({type:"string",defaultValue:Q.Day},{converter:b.normalizeUnit})],t.prototype,"lagUnit",void 0),da([Ce()],t.prototype,"calendar",void 0),da([de({type:"boolean",defaultValue:!0,persist:!0})],t.prototype,"active",void 0),da([oe("calendar")],t.prototype,"calculateCalendar",null),da([Kr("lag")],t.prototype,"writeLag",null),t}){},uu=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Ep=class extends G([gl],e=>{const r=e.prototype;class t extends e{*calculatePercentDone(){const n=yield this.$.childEvents,a=yield this.getProject().$.autoCalculatePercentDoneForParentTasks;if(n.size&&a){const o=yield this.$.percentDoneSummaryData;return o.totalDuration>0?o.completedDuration/o.totalDuration:o.milestonesNum>0?o.milestonesTotalPercentDone/o.milestonesNum:null}else return yield we}*shouldRollupChildPercentDoneSummaryData(n){return!0}*calculatePercentDoneSummaryData(){const n=yield this.$.childEvents;if(n.size){let s={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const a of n){if(!(yield*this.shouldRollupChildPercentDoneSummaryData(a)))continue;const o=yield a.$.percentDoneSummaryData;o&&(s.totalDuration+=o.totalDuration,s.completedDuration+=o.completedDuration,s.milestonesNum+=o.milestonesNum,s.milestonesTotalPercentDone+=o.milestonesTotalPercentDone)}return s}else{const s=yield this.$.duration;if(typeof s=="number"){const a=yield*this.getProject().$convertDuration(s,yield this.$.durationUnit,Q.Millisecond),o=yield this.$.percentDone;return{totalDuration:a,completedDuration:a*o,milestonesNum:a===0?1:0,milestonesTotalPercentDone:a===0?o:0}}else return null}}}return uu([de({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),uu([Ce()],t.prototype,"percentDoneSummaryData",void 0),uu([oe("percentDone")],t.prototype,"calculatePercentDone",null),uu([oe("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t}){},vl=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},hu=class extends G([gp],e=>{const r=e.prototype;class t extends e{*hasProposedValueForUnits(){const n=yield this.$.assigned;for(const s of n)if((yield s.$.resource)&&(yield xr(s.$.units)))return!0;return!1}async assign(n,s=100){const a=this.getProject().assignmentStore.modelClass;return this.addAssignment(new a({event:this,resource:n,units:s})),this.commitAsync()}*forEachAvailabilityInterval(n,s){const a=yield this.$.effectiveCalendar,o=yield this.$.assignmentsByCalendar,l=yield this.$.effectiveCalendarsCombination,c=(yield this.$.ignoreResourceCalendar)||n.ignoreResourceCalendar||!o.size,d=this.getProject().maxCalendarRange;return d&&(n=Object.assign({maxRange:d},n)),l.forEachAvailabilityInterval(n,(u,h,f)=>{const g=f.getCalendarsWorkStatus(),m=f.getCalendarsWorking();if(g.get(a)&&(c||m.some(p=>o.has(p))))return s(u,h,f)})}*calculateEffectiveCalendarsCombination(){const n=yield this.$.manuallyScheduled,s=this.getProject(),a=[yield this.$.effectiveCalendar];if(!n||s.skipNonWorkingTimeInDurationWhenSchedulingManually){const o=yield this.$.assignmentsByCalendar;a.push(...o.keys())}return this.getProject().combineCalendars(a)}*calculateAssignmentsByCalendar(){const n=yield this.$.assigned,s=new Map;for(const a of n){const o=yield a.$.resource;if(o){const l=yield o.$.effectiveCalendar;let c=s.get(l);c||(c=[],s.set(l,c)),c.push(a)}}return s}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendar:!1}}*useEventAvailabilityIterator(){return(yield this.$.assignmentsByCalendar).size>0}*skipNonWorkingTime(n,s=!0,a){if(!n)return null;const o=yield this.$.assignmentsByCalendar,l=yield this.$.ignoreResourceCalendar;if(yield*this.useEventAvailabilityIterator()){const c=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),s?{startDate:n,isForward:s}:{endDate:n,isForward:s},a);let d;const u=yield*this.forEachAvailabilityInterval(c,(h,f,g)=>(d=s?h:f,!1));if(u===Ct.MaxRangeReached||u===Ct.FullRangeIterated){const h=[yield this.$.effectiveCalendar];!c.ignoreResourceCalendar&&!l&&h.push(...o.keys());const f=dl.new({event:this,calendars:h,date:n,isForward:s});if((yield f)===fr.Cancel)yield wn(f);else return null}return new Date(d)}else return yield*r.skipNonWorkingTime.call(this,n,s)}*calculateProjectedDuration(n,s,a,o){if(!n||!s)return null;if(yield*this.useEventAvailabilityIterator()){const l=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:n,endDate:s,isForward:!0},o),c=this.getProject().adjustDurationToDST;let d=0;return yield*this.forEachAvailabilityInterval(l,(u,h)=>{if(d+=h.getTime()-u.getTime(),c){const f=u.getTimezoneOffset()-h.getTimezoneOffset();d+=f*60*1e3}}),a||(a=yield this.$.durationUnit),yield*this.getProject().$convertDuration(d,Q.Millisecond,a)}else return yield*r.calculateProjectedDuration.call(this,n,s,a)}*calculateProjectedXDateWithDuration(n,s=!0,a,o,l){if(a==null||isNaN(a)||n==null)return null;if(a==0)return n;o=o||(yield this.$.durationUnit);const c=yield*this.getProject().$convertDuration(a,o,Q.Millisecond);let d=n.getTime(),u=c;const h=yield this.$.effectiveCalendar;if(yield*this.useEventAvailabilityIterator()){const f=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),s?{startDate:n,isForward:s}:{endDate:n,isForward:s},l),g=this.getProject().adjustDurationToDST;return(yield*this.forEachAvailabilityInterval(f,(p,v,y)=>{const S=p.getTime(),D=v.getTime(),w=D-S;if(w>=u){if(g){const E=s?p.getTimezoneOffset()-new Date(S+u).getTimezoneOffset():new Date(D-u).getTimezoneOffset()-v.getTimezoneOffset();u-=E*60*1e3}return d=s?S+u:D-u,!1}else if(u-=w,g){const E=p.getTimezoneOffset()-v.getTimezoneOffset();u-=E*60*1e3}}))===Ct.StoppedByIterator?new Date(d):null}else return h.accumulateWorkingTime(n,c,s).finalDate}}return vl([Ce()],t.prototype,"effectiveCalendarsCombination",void 0),vl([Ce()],t.prototype,"assignmentsByCalendar",void 0),vl([de({type:"boolean"})],t.prototype,"ignoreResourceCalendar",void 0),vl([oe("effectiveCalendarsCombination")],t.prototype,"calculateEffectiveCalendarsCombination",null),vl([oe("assignmentsByCalendar")],t.prototype,"calculateAssignmentsByCalendar",null),t}){},Ut=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Ir=Symbol("MasterStartDateVar"),yl=Symbol("MasterEndDateVar"),bl=Symbol("MasterDurationVar"),Cl=Symbol("MasterTotalDurationVar"),$t=Symbol("StartOffsetVar"),Gt=Symbol("EndOffsetVar"),$E=Ge.new({output:Ee,inputs:new Set([$t,Gt])}),jE=Ge.new({output:ve,inputs:new Set([$t,Ir])}),xp=Ge.new({output:ye,inputs:new Set([Gt,Ir])}),BE=Ge.new({output:$t,inputs:new Set([ve,Ir])}),Rp=Ge.new({output:Gt,inputs:new Set([ye,Ir])}),HE=Ge.new({output:$t,inputs:new Set([Gt,Ee])}),Tp=Ge.new({output:Gt,inputs:new Set([$t,Ee])}),VE=Ge.new({output:Gt,inputs:new Set([$t,Cl])}),NE=Ge.new({output:Gt,inputs:new Set([$t,bl])}),zE=Ge.new({output:Ee,inputs:new Set([$t,yl])}),m_=Ks.new({variables:new Set([ve,ye,Ee,Ir,yl,bl,Cl,$t,Gt]),formulas:new Set([$E,jE,xp,HE,BE,Tp,VE,NE,Rp,zE])}),p_=Dr.new({description:m_,defaultResolutionFormulas:new Set([xp,Rp,Tp])}),v_=class extends tr.mix(ur){equality(e,r){const t=e.resolution,i=r.resolution;return t.get(ve)===i.get(ve)&&t.get(ye)===i.get(ye)&&t.get(Ee)===i.get(Ee)&&t.get(Ir)===i.get(Ir)&&t.get(yl)===i.get(yl)&&t.get(bl)===i.get(bl)&&t.get(Cl)===i.get(Cl)&&t.get($t)===i.get($t)&&t.get(Gt)===i.get(Gt)}},Mp=class extends G([_n],e=>{class r extends e{get isEventSegment(){return!0}get stm(){var i;return(i=this.event)==null?void 0:i.stm}set stm(i){}writeStartDate(i,n,s,a,o=!0){const l=this.event,c=this.getProject();if(l&&!this.previousSegment&&n.baseRevision.hasIdentifier(i)&&!(c&&c.getStm().isRestoring)?l.$.startDate.constructor.prototype.write.call(this,l.$.startDate,n,null,a,o):i.constructor.prototype.write.call(this,i,n,s,a,o),o&&this.nextSegment){const d=this.endOffset-this.nextSegment.startOffset;if(d>0){let u=this;for(;u=u.nextSegment;)u.startOffset+=d,u.endOffset+=d}}}shouldRecordFieldChange(i,n,s){return i==="startOffset"||i==="endOffset"||super.shouldRecordFieldChange(i,n,s)}*calculateStartOffset(){const n=(yield this.$.dispatcher).resolution.get($t);if(!this.event)return yield we;let s;if(n===Et)s=yield we;else if(n===HE.formulaId)s=yield*this.calculateStartOffsetByEndOffsetAndDuration();else if(n===BE.formulaId){const a=yield Ke(this.event.$.startDate),o=yield Ke(this.$.startDate);s=yield*this.event.calculateProjectedDuration(a,o,Q.Millisecond,{ignoreSegments:!0})}return s}*calculateEndOffset(){const n=(yield this.$.dispatcher).resolution.get(Gt);if(!this.event)return yield we;let s;if(n===Et)s=yield we;else if(n===Tp.formulaId)s=yield*this.calculateEndOffsetByStartOffsetAndDuration();else if(n===Rp.formulaId){const a=yield Ke(this.event.$.startDate),o=yield Ke(this.$.endDate);s=yield*this.event.calculateProjectedDuration(a,o,Q.Millisecond,{ignoreSegments:!0})}else n===NE.formulaId?s=yield*this.calculateEndOffsetByMasterDurationAndStartOffset():n===VE.formulaId&&(s=yield*this.calculateEndOffsetByMasterTotalDurationAndStartOffset());return s}*calculateStartDate(){const n=(yield this.$.dispatcher).resolution.get(ve);if(!this.event)return yield we;let s;return n===jE.formulaId?s=yield*this.calculateStartDateByMasterStartAndStartOffset():s=yield*super.calculateStartDate(),s}*calculateEndDate(){const n=(yield this.$.dispatcher).resolution.get(ye);if(!this.event)return yield we;let s;return n===xp.formulaId?s=yield*this.calculateEndDateByMasterStartAndEndOffset():s=yield*super.calculateEndDate(),s}*calculateDuration(){const n=(yield this.$.dispatcher).resolution.get(Ee);if(!this.event)return yield we;let s;return n===$E.formulaId?s=yield*this.calculateDurationByOffsets():n===zE.formulaId?s=yield*this.calculateDurationByOffsets():s=yield*super.calculateDuration(),s}buildProposedDispatcher(i,n,s){const a=super.buildProposedDispatcher(i,n,s);return a.addPreviousValueFlag(Ir),a.addPreviousValueFlag($t),a.addPreviousValueFlag(Gt),a}*prepareDispatcher(i){const n=yield*super.prepareDispatcher(i);if(!this.event)return n;if(i(zd(this.event.$.startDate))!=null&&n.addPreviousValueFlag(Ir),i(xr(this.event.$.startDate))&&n.addProposedValueFlag(Ir),!i(xr(this.event.$.segments))){if(n.collectInfo(i,this.event.$.duration,bl),i(xr(this.event.$.endDate))){const a=i(Dn(this.event.$.endDate));a!=null&&a[0]||n.addProposedValueFlag(yl)}const s=i(this.event.$.dispatcher);s.resolution.get(ve)===Et&&s.resolution.get(ye)===Et&&n.addProposedValueFlag(Cl)}return n.collectInfo(i,this.$.startOffset,$t),n.collectInfo(i,this.$.endOffset,Gt),n}cycleResolutionContext(i){return p_}*calculateEndOffsetByMasterDurationAndStartOffset(){const i=yield Ke(this.event.$.duration),n=yield this.event.$.durationUnit,s=yield this.$.startOffset,a=this.nextSegment;let o,l=yield*this.getProject().$convertDuration(i,n,Q.Millisecond);const c=[];let d=this;for(;d=d.previousSegment;)c.push(d);for(let u=c.length-1;u>=0;u--){const h=c[u],f=yield Ke(h.$.startOffset),m=(yield Ke(h.$.endOffset))-f;l-=m}return l>0?a?o=s+Math.min(l,(yield Ke(this.$.endOffset))-s):o=s+l:o=s,o}*calculateEndOffsetByMasterTotalDurationAndStartOffset(){const i=yield Ke(this.event.$.startDate),n=yield Ke(this.event.$.endDate),s=yield*this.event.calculateProjectedDuration(i,n,Q.Millisecond,{ignoreSegments:!0}),a=yield Ke(this.$.startOffset);let o=yield Ke(this.$.endOffset),l=this.nextSegment;return a<=s?o<=s?!l||(yield Ke(l.$.startOffset))>=s?s:o:s:yield this.$.startOffset}*calculateStartOffsetByEndOffsetAndDuration(){const i=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.endOffset)-(yield*this.event.getProject().$convertDuration(i,n,Q.Millisecond))}*calculateEndOffsetByStartOffsetAndDuration(){const i=yield this.$.duration,n=yield this.$.durationUnit;return(yield this.$.startOffset)+(yield*this.event.getProject().$convertDuration(i,n,Q.Millisecond))}*calculateEndDateByMasterStartAndEndOffset(){const i=yield this.event.$.startDate,n=yield this.$.endOffset,s=yield*this.event.calculateProjectedXDateWithDuration(i,!0,n,Q.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?s:yield*this.event.skipNonWorkingTime(s,!1)}*calculateStartDateByMasterStartAndStartOffset(){const i=yield this.event.$.startDate,n=yield this.$.startOffset,s=yield*this.event.calculateProjectedXDateWithDuration(i,!0,n,Q.Millisecond,{ignoreSegments:!0});return(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?s:yield*this.event.skipNonWorkingTime(s)}*calculateDurationByOffsets(){const i=yield this.$.startOffset,n=yield this.$.endOffset,s=yield this.$.durationUnit;return yield*this.getProject().$convertDuration(n-i,Q.Millisecond,s)}*calculatePercentDone(){let i=0;if(!this.event)return yield we;const n=yield this.event.$.segments;if(n){const s=yield this.event.$.percentDone,a=yield this.event.$.duration,o=yield this.event.$.durationUnit;let l=yield*this.getProject().$convertDuration(a,o,Q.Millisecond),c=s*.01*l;for(const d of n){const u=d.startOffset,f=d.endOffset-u;if(d===this)return c>=f?100:c>0?100*c/f:0;c-=f}}return i}*calculateMinPercent(){const i=this.previousSegment;return this.event?i?yield i.$.endPercentDone:0:yield we}*calculateMaxPercent(){if(!this.event)return yield we;const i=yield this.event.$.duration,n=yield this.event.$.durationUnit;let s=yield*this.getProject().$convertDuration(i,n,Q.Millisecond);const a=yield this.$.startOffset,o=yield this.$.endOffset;return(yield this.$.startPercentDone)+100*(o-a)/s}*calculateProjectedXDateWithDuration(i,n,s,a){return a||(a=yield this.$.durationUnit),yield*this.event.calculateProjectedXDateWithDuration(i,n,s,a,{ignoreSegments:!0})}*calculateProjectedDuration(i,n,s){return s||(s=yield this.$.durationUnit),yield*this.event.calculateProjectedDuration(i,n,s,{ignoreSegments:!0})}*calculateManuallyScheduled(){return this.event?yield this.event.$.manuallyScheduled:yield we}}return Ut([Ce({identifierCls:v_})],r.prototype,"dispatcher",void 0),Ut([de({persist:!1})],r.prototype,"startOffset",void 0),Ut([de({persist:!1})],r.prototype,"endOffset",void 0),Ut([Ce()],r.prototype,"percentDone",void 0),Ut([Ce()],r.prototype,"startPercentDone",void 0),Ut([Ce()],r.prototype,"endPercentDone",void 0),Ut([Kr("startDate")],r.prototype,"writeStartDate",null),Ut([oe("startOffset")],r.prototype,"calculateStartOffset",null),Ut([oe("endOffset")],r.prototype,"calculateEndOffset",null),Ut([oe("percentDone")],r.prototype,"calculatePercentDone",null),Ut([oe("startPercentDone")],r.prototype,"calculateMinPercent",null),Ut([oe("endPercentDone")],r.prototype,"calculateMaxPercent",null),Ut([oe("manuallyScheduled")],r.prototype,"calculateManuallyScheduled",null),r}){},Fn=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},kn=Symbol("SegmentsVar"),y_=(e,r,t)=>t.processSegmentsValue(e),Pp=Ge.new({output:ve,inputs:new Set([ye,kn])}),Ip=Ge.new({output:ye,inputs:new Set([ve,kn])}),Dk=Ge.new({output:Ee,inputs:new Set([ve,ye,kn])}),WE=Ks.new({variables:new Set([ve,ye,Ee,kn]),formulas:new Set([Ip,Pp,Mr,Pr,Ti])}),b_=Dr.new({description:WE,defaultResolutionFormulas:new Set([Pr,Ip])}),C_=Dr.new({description:WE,defaultResolutionFormulas:new Set([Mr,Pp])}),S_=class extends tr.mix(ur){equality(e,r){const t=e.resolution,i=r.resolution;return t.get(ve)===i.get(ve)&&t.get(ye)===i.get(ye)&&t.get(Ee)===i.get(Ee)&&t.get(kn)===i.get(kn)}};function w_(e,r){return!e&&!r?!0:this._skipSegmentsIsEqual||!e&&r||e&&!r||e.length!==r.length?!1:e.every((t,i)=>D_(t,r[i]))}var D_=(e,r)=>{if(e===r)return!0;const i=(e.isModel?e:r).fieldMap,n=e.startDate instanceof Date?e.startDate.getTime():i.startDate.convert(e.startDate).getTime(),s=r.startDate instanceof Date?r.startDate.getTime():i.startDate.convert(r.startDate).getTime(),a=e.endDate instanceof Date?e.endDate.getTime():i.endDate.convert(e.endDate).getTime(),o=r.endDate instanceof Date?r.endDate.getTime():i.endDate.convert(r.endDate).getTime();return n===s&&a===o},E_=class extends G([hu,Ep],e=>{class r extends e{constructor(){super(...arguments),this._segmentGeneration={}}static get $name(){return"SplitEventMixin"}construct(){this.segmentModelClass=this.getDefaultSegmentModelClass(),super.construct(...arguments)}get rawModifications(){let i=super.rawModifications;if(this.segments&&(!i||!("segments"in i))){for(const n of this.segments)if(n.rawModifications){i=i||{},i.segments=this.getFieldPersistentValue("segments");break}}return i}clearChanges(i,n,s){for(const a of this.segments||[])a.clearChanges(i,n,null);super.clearChanges(i,n,s)}getDefaultSegmentModelClass(){return Mp}*prepareDispatcher(i){const n=yield*super.prepareDispatcher(i);return(yield*this.hasSegmentChangesProposed())&&n.addProposedValueFlag(kn),n}cycleResolutionContext(i){const n=i(this.$.direction);return n===Ue.Forward||n===Ue.None?b_:C_}*hasSegmentChangesProposed(){const i=yield MD(this.$.segments);let n=!1;(yield xr(this.$.segments))&&(n=!!i);const s=yield Ke(this.$.segments);if(!s)return!1;for(const a of s){const o=yield xr(a.$.startDate),l=yield xr(a.$.endDate),c=yield xr(a.$.duration);(o||l||c)&&(n=!0)}return n}writeSegments(i,n,s,a){var o;const l=(o=n.getLatestEntryFor(i))==null?void 0:o.getValue(),c=l!==Se?l!=null?l:[]:[],d=new Set(c),u=a!=null?a:[],h=new Set(u);this.project.ion({commitFinalized:()=>g.removeEntities(c.filter(m=>!h.has(m))),once:!0}),i.constructor.prototype.write.call(this,i,n,s,a),this.$.isSegmented.write.call(this,this.$.isSegmented,n,null,!!(a!=null&&a.length));const f=this.project,g=f.replica;for(const m of u)!d.has(m)&&m.graph!==g&&(m.setProject(f),g.addEntity(m))}*doWriteSegments(i,n){if(n=n||[],i.length<=1){const s=i.length?yield*this.getProject().$convertDuration(i[0].endOffset-i[0].startOffset,Q.Millisecond,yield this.$.durationUnit):0;n.push({identifier:this.$.duration,proposedArgs:[s,null]}),i=null}n.push({identifier:this.$.segments,proposedArgs:[i]}),yield xD(n)}*calculateSegments(){const i=yield this.$.dispatcher,{graph:n,project:s}=this,a=yield zd(this.$.segments);let o=yield we;const l=[];let c=!1;if(o){const d=new Set;let u=null,h=!1;const{baseRevision:f}=n.$activeTransaction;for(const g of o){const m=yield g.$.startOffset,p=yield g.$.endOffset,v=f.hasIdentifier(g.$.startDate)&&(yield Dn(g.$.startDate)),y=f.hasIdentifier(g.$.endDate)&&(yield Dn(g.$.endDate));if(h=h||(v==null?void 0:v[0])||(y==null?void 0:y[0]),m===p)l.push(g);else if(u&&m<=u.endOffset){const S=u.endOffset;if(l.push(g),u.graph){l.push(u);const D=u.startOffset,w=h?p+S-m:Math.max(p,S),E=u.cls;u=this.segmentModelClass.new({event:this,cls:E,startOffset:D,endOffset:w})}else u.endOffset=h?p+u.endOffset-m:Math.max(p,u.endOffset)}else u&&d.add(u),u=g}u&&d.add(u),d.size===1&&l.push(...d),c=l.length>0,c&&(o=Array.from(d)),o.reduce((g,m,p)=>(g&&(g.nextSegment=m),m.previousSegment=g,m.segmentIndex=p,m),null),o.length&&(o[o.length-1].nextSegment=null)}else a&&l.push(...a);return l.length&&(l.forEach(d=>d.event=null),s.ion({commitFinalized:()=>n.removeEntities(l),once:!0})),c&&(yield*this.doWriteSegments(o)),o=(o==null?void 0:o.length)>1?o:null,o}*calculateAdjustedSegments(){const i=yield this.$.dispatcher;let n=yield this.$.segments;const s=yield this.$.startDate,a=yield this.$.endDate,o=yield this.$.duration;let l=yield we;if(n){const c=this.project,d=this.graph,u=[],h=[];let f=-1;for(let p=n.length-1;p>=0;p--){const v=n[p],y=yield v.$.startDate,S=yield v.$.endDate;if(y>a)u.push(v),f=p;else{if(S.getTime()!==a.getTime()){const D=v.endOffset+(a.getTime()-S.getTime())-v.startOffset,w=yield*c.$convertDuration(D,Q.Millisecond,yield v.$.durationUnit);h.push({identifier:v.$.duration,proposedArgs:[w,null]},{identifier:v.$.endDate,proposedArgs:[a,!1]},{identifier:v.$.endOffset,proposedArgs:[v.endOffset+(a.getTime()-S.getTime())]})}break}}let g=!1;f>-1&&(g=!0,n.splice(f),n.length&&(n[n.length-1].nextSegment=null),c.ion({commitFinalized:()=>d.removeEntities(u),once:!0}));let m="";n&&(m=this.getSegmentsSnapshot(n)),m!==this._lastSegmentsSnapshot&&(g=!0,n=n&&n.slice(),this._lastSegmentsSnapshot=m),g&&(yield*this.doWriteSegments(n,h))}return l}getSegmentsSnapshot(i){return i=i||this.segments,i==null?void 0:i.map(n=>{var s,a;return""+n.startOffset+"-"+((s=n.startDate)==null?void 0:s.getTime())+"-"+n.endOffset+"-"+((a=n.endDate)==null?void 0:a.getTime())}).join(";")}processSegmentsValue(i){let n=i;if(i)for(let s=0;s<i.length;s++){const a=i[s],o=a.isModel?a:this.segmentModelClass.new(a);o.event||(o.event=this),i[s]=o}return n}*calculateStartDate(){const n=(yield this.$.dispatcher).resolution.get(ve);let s;return n===Pp.formulaId?s=yield*this.calculateStartDateBySegments():s=yield*super.calculateStartDate(),s}*calculateStartDateBySegments(){const i=yield this.$.dispatcher,n=yield this.$.segments,s=yield this.$.endDate;let a;if(n){const l=yield n[n.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(s,!1,l,Q.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!0)}return a}*calculateEndDateBySegments(){const i=yield this.$.dispatcher,n=yield this.$.segments,s=yield this.$.startDate;let a;if(n){const l=yield n[n.length-1].$.endOffset,c=yield*this.calculateProjectedXDateWithDuration(s,!0,l,Q.Millisecond,{ignoreSegments:!0});a=(yield this.$.manuallyScheduled)&&!this.getProject().skipNonWorkingTimeWhenSchedulingManually?c:yield*this.skipNonWorkingTime(c,!1)}return a}*calculateEndDate(){const n=(yield this.$.dispatcher).resolution.get(ye);let s;return n===Ip.formulaId?s=yield*this.calculateEndDateBySegments():s=yield*super.calculateEndDate(),s}*calculateDurationProposed(){let i;return(yield*this.hasSegmentChangesProposed())?i=yield*this.calculateDurationBySegments():i=yield*super.calculateDurationProposed(),i}*skipNonWorkingTime(i,n=!0,s){return i?(s=Object.assign({ignoreSegments:!0},s),yield*super.skipNonWorkingTime(i,n,s)):null}*calculateDurationBySegments(){let i;const n=yield this.$.dispatcher,s=yield this.$.durationUnit,a=yield this.$.segments;if(a){let o=0;for(const l of a)o+=l.endOffset-l.startOffset;i=yield*this.getProject().$convertDuration(o,Q.Millisecond,s)}return i}*forEachAvailabilityInterval(i,n){const s=yield this.$.effectiveCalendar,a=yield this.$.assignmentsByCalendar,o=yield this.$.effectiveCalendarsCombination,l=i.isForward!==!1,c=(yield this.$.ignoreResourceCalendar)||i.ignoreResourceCalendar||!a.size,d=this.getProject().maxCalendarRange;let u=i.ignoreSegments,h=1,f,g,m,p,v;u||(p=yield this.$.segments,u=u||!p,u||(p=p.slice(),l?(f=p.shift(),g=0,h=1,v=f.nextSegment?f.endOffset:Qe.getTime()):(f=p.pop(),g=f.endOffset,h=-1,v=f.endOffset),m=v-f.startOffset));const y=yield this.$.manuallyScheduled,S=this.getProject();return o.forEachAvailabilityInterval(Object.assign({maxRange:d},i),(D,w,E)=>{const x=E.getCalendarsWorkStatus(),M=E.getCalendarsWorking();if(x.get(s)&&(c||M.some(I=>a.has(I))||y&&!S.skipNonWorkingTimeInDurationWhenSchedulingManually)){if(u)return n(D,w,E);{const I=D.getTime();let P=w.getTime()-D.getTime();if(this.getProject().adjustDurationToDST){const V=D.getTimezoneOffset()-w.getTimezoneOffset();P+=V*60*1e3}let _,A;for(l?(_=g,A=g+P):(_=g-P,A=g);f&&_<=v&&A>f.startOffset;){const V=Math.max(_,f.startOffset),N=Math.min(A,v),B=new Date(I+V-_),Z=new Date(I+N-_);if(n(B,Z,E)===!1)return!1;if(m-=Z.getTime()-B.getTime(),!m)f=l?p.shift():p.pop(),f&&(v=!l||f.nextSegment?f.endOffset:Qe.getTime(),m=v-f.startOffset);else break}g+=h*P}}})}*useEventAvailabilityIterator(){return(yield this.$.isSegmented)?!0:!(yield this.$.manuallyScheduled)}getSegmentByDate(i,n){if(n=n||this.getSegments(),n){const s=this.getSegmentIndexByDate(i,n);return n[s]}}getSegmentIndexByDate(i,n){return n=n||this.getSegments(),n?n.findIndex(s=>i>=s.startDate&&i<s.endDate):-1}get firstSegment(){const i=this.getSegments();return i?i[0]:null}get lastSegment(){const i=this.getSegments();return i?i[i.length-1]:null}getSegment(i){const n=this.getSegments();return n==null?void 0:n[i]}async splitToSegments(i,n=1,s){var a;const o=this.getProject();await o.commitAsync();const l=this;if(!i||l.isHasSubEventsMixin&&((a=l.childEvents)!=null&&a.size))return;const c=l.duration,d=l.durationUnit,u=l.startDate,h=l.endDate;if(s=s?b.normalizeUnit(s):d,!u||!h||u>=i||i>=h||!c)return;const f=l.isSegmented;let g=l.segments||[],m,p;if(f&&(p=l.getSegmentIndexByDate(i,g),m=g[p],!m))return;const v=m||l,y=m?v.startDate:u,S=v.duration,D=v.durationUnit,w=l.run("calculateProjectedDuration",y,i,D,{ignoreSegments:!0}),E=S-w,x=o.run("$convertDuration",n,s,Q.Millisecond),M=x+l.run("calculateProjectedDuration",u,i,Q.Millisecond,{ignoreSegments:!0});if(m){m.duration=w;const I=this.segmentModelClass.new({duration:E,durationUnit:D,startOffset:M});g=g.slice(0),g.splice(p+1,0,I),l.segments=g,l.duration=c;for(let P=p+2,_=g.length;P<_;P++){const A=g[P];A&&(A.startOffset+=x,A.endOffset+=x)}}else{const I=this.segmentModelClass.new({duration:w,durationUnit:D,startOffset:0}),P=this.segmentModelClass.new({duration:c-w,durationUnit:D,startOffset:M});l.duration=c,l.segments=[I,P]}return o.commitAsync()}async mergeSegments(i,n){if(this.isSegmented){if(i=i||this.firstSegment,n=n||this.lastSegment,i.startOffset>n.startOffset){let s=n;n=i,i=s}return i.endDate=n.startDate,this.getProject().commitAsync()}}storeFieldChange(i,n){if(i==="segments"&&n){const s=[];for(const a of n){const o=a.toJSON();(!this._segmentGeneration[a.internalId]||a.generation>this._segmentGeneration[a.internalId])&&Object.assign(o,a.meta.modified),s.push(o),this._segmentGeneration[a.internalId]=a.generation}n=s}super.storeFieldChange(i,n)}leaveProject(){const i=this.segments;i&&this.graph.removeEntities(i),super.leaveProject()}endBatch(...i){this.fieldMap.segments._skipSegmentsIsEqual++,super.endBatch(...i),this.fieldMap.segments._skipSegmentsIsEqual--}copy(i=null,n=null){const s=super.copy(i,n);return s.data.segments=void 0,s.segments&&(s.segments=s.segments.map(a=>Object.assign(a.copy(),{event:s}))),s}}return Fn([Ce({identifierCls:S_})],r.prototype,"dispatcher",void 0),Fn([de({type:"array",isEqual:w_,convert:y_,_skipSegmentsIsEqual:0})],r.prototype,"segments",void 0),Fn([Ce()],r.prototype,"adjustedSegments",void 0),Fn([Ce()],r.prototype,"isSegmented",void 0),Fn([Kr("segments")],r.prototype,"writeSegments",null),Fn([oe("segments")],r.prototype,"calculateSegments",null),Fn([oe("adjustedSegments")],r.prototype,"calculateAdjustedSegments",null),r}){},fu=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Ap=class extends G([hu,gl],e=>{const r=e.prototype;class t extends e{getEffort(n){const s=this.effort;return n?this.getProject().convertDuration(s,this.effortUnit,n):s}writeEffort(n,s,a,o,l){o<0&&(o=0),!(!s.baseRevision.hasIdentifier(n)&&o==null)&&(l!=null&&l!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,s,null,l),n.constructor.prototype.write(n,s,a,o))}setEffortUnit(n){throw new Error("Use `setEffort` instead")}*shouldRollupChildEffort(n){return!0}*calculateTotalChildrenEffort(){const n=yield this.$.childEvents,s=this.getProject();let a=0;for(const o of n){if(!(yield*this.shouldRollupChildEffort(o)))continue;const l=yield o.$.effortUnit;a+=yield*s.$convertDuration(yield o.$.effort,l,Q.Millisecond)}return yield*s.$convertDuration(a,Q.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const s=yield we;return s!==void 0?s:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield we}*calculateAssignmentUnits(n){return yield*this.calculateAssignmentUnitsProposed(n)}*calculateAssignmentUnitsPure(n){return yield*this.calculateUnitsByStartEndAndEffort(n)}*calculateAssignmentUnitsProposed(n){return yield we}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendar:!1}}*calculateProjectedEffort(n,s,a){if(n==null||s==null||n>s)return null;a||(a=yield this.$.assignmentsByCalendar);const o=new Map;for(const[d,u]of a){let h=0;for(const f of u)h+=yield f.$.units;o.set(d,h)}let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:n,endDate:s});return o.size===0&&(o.set(yield this.$.effectiveCalendar,100),c.ignoreResourceCalendar=!0),yield*this.forEachAvailabilityInterval(c,(d,u,h)=>{const f=h.getCalendarsWorking(),g=d.getTime(),m=u.getTime(),p=m-g;let v=0;for(const y of f)v+=o.get(y)||0;l+=v*p*.01}),yield*this.getProject().$convertDuration(l,Q.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(n){const s=yield this.$.effort,a=yield this.$.effortUnit,o=yield*this.getProject().$convertDuration(s,a,Q.Millisecond);let l=0;const c=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),d=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(c,(u,h,f)=>{const g=f.getCalendarsWorking(),m=u.getTime(),p=h.getTime(),v=p-m;for(const y of g)l+=(d.has(y)?d.get(y).length:0)*v}),l?100*o/l:100}*calculateProjectedXDateByEffort(n,s=!0,a,o){a=a!==void 0?a:yield this.$.effort,o=o!==void 0?o:yield this.$.effortUnit;const l=yield*this.getProject().$convertDuration(a,o,Q.Millisecond);if(n==null||a==null)return null;let c=n.getTime(),d=l;if(d===0)return new Date(c);const u=yield this.$.effectiveCalendar,h=yield this.$.assignmentsByCalendar,f=new Map;let g=!1;for(const[m,p]of h){let v=0;for(const y of p)v+=yield y.$.units;f.set(m,v),v>0&&(g=!0)}if(g&&(yield*this.useEventAvailabilityIterator())){const m=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),s?{startDate:n,isForward:s}:{endDate:n,isForward:s});return yield*this.forEachAvailabilityInterval(m,(p,v,y)=>{const S=y.getCalendarsWorking(),D=p.getTime(),w=v.getTime(),E=w-D;let x=0;for(const I of S)x+=f.get(I)||0;const M=x*E*.01;if(M>=d)return c=s?D+d/(.01*x):w-d/(.01*x),!1;d-=M}),new Date(c)}else return u.accumulateWorkingTime(n,l,s).finalDate}}return fu([de({type:"number"})],t.prototype,"effort",void 0),fu([de({type:"string",defaultValue:Q.Hour},{converter:i=>b.normalizeUnit(i)||Q.Hour})],t.prototype,"effortUnit",void 0),fu([Kr("effort")],t.prototype,"writeEffort",null),fu([oe("effort")],t.prototype,"calculateEffort",null),t}){},xt=Symbol("EffortVar"),jt=Symbol("UnitsVar"),Sl=Ge.new({output:xt,inputs:new Set([ve,ye,jt])}),ua=Ge.new({output:jt,inputs:new Set([ve,ye,xt])}),_p=Ge.new({output:ye,inputs:new Set([ve,xt,jt])}),Fp=Ge.new({output:ve,inputs:new Set([ye,xt,jt])}),UE=class extends hp{},GE=class extends fp{equality(e,r){const t=e.resolution,i=r.resolution;return(e!==Se||r===Se)&&(e===Se||r!==Se)&&t.get(xt)===i.get(xt)&&t.get(jt)===i.get(jt)&&super.equality(e,r)}},On=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},kp=class extends G([Ap],e=>{const r=e.prototype;class t extends e{*calculateSchedulingMode(){return(yield we)||je.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:je.Normal}effectiveSchedulingModeSync(n){return n(this.$.assignmentsByCalendar).size>0?n(this.$.schedulingMode):je.Normal}*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())!==je.Normal){const a=yield*r.prepareDispatcher.call(this,n);return a.collectInfo(n,this.$.effort,xt),(yield*this.hasProposedValueForUnits())&&a.addProposedValueFlag(jt),a.addPreviousValueFlag(jt),a}else return yield*r.prepareDispatcher.call(this,n)}dispatcherClass(n){return this.effectiveSchedulingModeSync(n)!==je.Normal?UE:r.dispatcherClass.call(this,n)}buildProposedDispatcher(n,s,a){const o=r.buildProposedDispatcher.call(this,n,s,a);return o.addPreviousValueFlag(xt),o.addPreviousValueFlag(jt),o}*calculateAssignmentUnits(n){if((yield*this.effectiveSchedulingMode())!==je.Normal){const o=(yield this.$.dispatcher).resolution.get(jt);if(o===Et)return yield*this.calculateAssignmentUnitsProposed(n);if(o===ua.formulaId)return yield*this.calculateAssignmentUnitsPure(n);throw new Error("Unknown formula for `units`")}else return yield*r.calculateAssignmentUnits.call(this,n)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==je.Normal){const a=(yield this.$.dispatcher).resolution.get(xt);if(a===Et)return yield*this.calculateEffortProposed();if(a===Sl.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}else return yield*r.calculateEffort.call(this)}*calculateStartDate(){return(yield*this.effectiveSchedulingMode())!==je.Normal?(yield this.$.dispatcher).resolution.get(ve)===Fp.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*r.calculateStartDate.call(this):yield*r.calculateStartDate.call(this)}*calculateEndDate(){return(yield*this.effectiveSchedulingMode())!==je.Normal?(yield this.$.dispatcher).resolution.get(ye)===_p.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*r.calculateEndDate.call(this):yield*r.calculateEndDate.call(this)}*calculateEffectiveDuration(){const n=yield this.$.dispatcher,s=yield*this.effectiveSchedulingMode(),a=n.resolution.get(Ee),o=n.resolution.get(xt);let l;if(a===Ti.formulaId&&s!=je.Normal){const c=yield Ke(this.$.startDate),d=yield Ke(this.$.endDate),u=n.resolution.get(ve),h=n.resolution.get(ye),f=yield this.$.effortDriven;d&&u===Fp.formulaId?l=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(d,!1),d):c&&h===_p.formulaId?l=yield*this.calculateProjectedDuration(c,yield*this.calculateProjectedXDateByEffort(c,!0)):(c&&d||!c&&!d)&&(l=yield*r.calculateEffectiveDuration.call(this))}else l=yield*r.calculateEffectiveDuration.call(this);return l}}return On([de({type:"boolean",defaultValue:!1})],t.prototype,"effortDriven",void 0),On([de({type:"string",defaultValue:je.Normal},{sync:!0})],t.prototype,"schedulingMode",void 0),On([Ce({identifierCls:GE})],t.prototype,"dispatcher",void 0),On([oe("schedulingMode")],t.prototype,"calculateSchedulingMode",null),On([oe("effort")],t.prototype,"calculateEffort",null),On([oe("startDate")],t.prototype,"calculateStartDate",null),On([oe("endDate")],t.prototype,"calculateEndDate",null),t}){},Op=Ks.new({variables:new Set([ve,ye,Ee,xt,jt]),formulas:new Set([Mr,Pr,Ti,ua,Sl])}),Lp=Ks.new({variables:new Set([ve,ye,Ee,xt,jt]),formulas:new Set([Mr,Pr,Ti,ua])}),YE=Dr.new({description:Op,defaultResolutionFormulas:new Set([Pr,Sl])}),qE=Dr.new({description:Lp,defaultResolutionFormulas:new Set([Pr,ua])}),KE=Dr.new({description:Op,defaultResolutionFormulas:new Set([Mr,Sl])}),XE=Dr.new({description:Lp,defaultResolutionFormulas:new Set([Mr,ua])}),ZE=class extends G([kp],e=>{const r=e.prototype;class t extends e{*prepareDispatcher(n){if((yield*this.effectiveSchedulingMode())===je.FixedDuration){const a=yield*r.prepareDispatcher.call(this,n),o=yield this.$.effortDriven;return o&&a.addKeepIfPossibleFlag(xt),(yield xr(this.$.assigned))&&(o?a.addProposedValueFlag(xt):a.addProposedValueFlag(jt)),a}else return yield*r.prepareDispatcher.call(this,n)}cycleResolutionContext(n){if(this.effectiveSchedulingModeSync(n)===je.FixedDuration){const a=n(this.$.direction),o=n(this.$.effortDriven);return a===Ue.Forward||a===Ue.None?o?qE:YE:o?XE:KE}else return r.cycleResolutionContext.call(this,n)}*getBaseOptionsForDurationCalculations(){return(yield*this.effectiveSchedulingMode())===je.FixedDuration?{ignoreResourceCalendar:!0}:yield*r.getBaseOptionsForDurationCalculations.call(this)}}return t}){},$p=class extends G([au,_E,Ep,hu,Ap,kp,ZE,ml,OE,E_],e=>{class r extends e{}return r}){},wl=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},JE=class extends Ao{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}},QE=class extends zf{static get defaultConfig(){return{modelClass:JE}}},jp=class extends In{get intervalStoreClass(){return QE}};wl([de({type:"boolean",defaultValue:!1})],jp.prototype,"unspecifiedTimeIsWorking",void 0);var gu=class extends We{constructor(){super(...arguments),this.effort=0,this.units=0}},ex=class extends gu{},Bp=class extends gu{constructor(){super(...arguments),this.maxEffort=0,this.isOverallocated=!1,this.isUnderallocated=!1,this.assignments=null,this.assignmentIntervals=null}},mu=class extends Tr.mix(We){getDefaultAllocationIntervalClass(){return gu}initialize(e){e=Object.assign({includeInactiveEvents:!1,allocationIntervalClass:this.getDefaultAllocationIntervalClass()},e),super.initialize(e)}};wl([Ce()],mu.prototype,"includeInactiveEvents",void 0),wl([Ce()],mu.prototype,"allocation",void 0);var pu=class extends mu{enterGraph(e){super.enterGraph(e)}leaveGraph(e){super.leaveGraph(e),this.resource&&this.resource.entities.delete(this)}getDefaultAllocationIntervalClass(){return Bp}*shouldIncludeAssignmentInAllocation(e){const r=yield e.$.event,t=yield e.$.units,i=yield this.$.includeInactiveEvents,n=r&&(yield r.$.inactive),s=r&&(yield r.$.startDate),a=r&&(yield r.$.endDate);return!!(r&&t&&s&&a&&(i||!n))}*calculateAllocation(){const e=[],r=yield this.ticks,t=yield this.$.resource,i=yield this.$.includeInactiveEvents,n=yield t.$.assigned,s=yield t.$.effectiveCalendar,a=new Map,o=[],l=new Map,c=new Map;let d=!1;for(const D of n){if(!(yield*this.shouldIncludeAssignmentInAllocation(D)))continue;yield D.$.units;const w=yield D.$.event,E=yield w.$.ignoreResourceCalendar,x=yield w.$.startDate,M=yield w.$.endDate,I=yield w.$.segments,P=yield w.$.effectiveCalendar;if(d=d||E,I)for(const A of I){const V=yield A.$.startDate,N=yield A.$.endDate;o.push({startDate:V,endDate:N,assignment:D})}else o.push({startDate:x,endDate:M,assignment:D});let _=a.get(P);_||(_=[],a.set(P,_)),l.set(D,new Map),c.set(D,[]),_.push(D)}const u=new jp({intervals:o}),h=[r,u,...a.keys()],f=new Map;r.intervalStore.forEach(D=>{const w=Bp.new({tick:D,resource:t});f.set(D,w),e.push(w),l.forEach((E,x)=>{const M=ex.new({tick:D,assignment:x});E.set(D,M),c.get(x).push(M)})});let g,m;const p=e[0].tick.startDate,v=e[e.length-1].tick.endDate,y={startDate:p,endDate:v,calendars:h,includeNonWorkingIntervals:d},S=v.getTime()-p.getTime();return S>t.getProject().maxCalendarRange&&(y.maxRange=S),yield*t.forEachAvailabilityInterval(y,(D,w,E)=>{const x=E.getCalendarsWorkStatus();if(x.get(r)){const M=E.intervalsByCalendar.get(r)[0],I=w.getTime()-D.getTime(),P=f.get(M),_=P.assignments||new Set,A=P.assignmentIntervals||new Map;P.assignments||(g=0,m=0);let V=0,N=!1,B;E.intervalsByCalendar.get(u).forEach(Z=>{const K=Z.assignment,se=K==null?void 0:K.event;if(se&&x.get(se.effectiveCalendar)&&(!d||se.ignoreResourceCalendar||x.get(s))){const xe=Math.max(D.getTime(),K.event.startDate.getTime()),gr=Math.min(w.getTime(),K.event.endDate.getTime());N=!0,B=gr-xe;const le=l.get(K).get(M),Xe=B*K.units/100;le.effort+=Xe,le.units=K.units,P.effort+=Xe,V+=K.units,_.add(K),A.set(K,le)}}),x.get(s)&&(P.maxEffort+=I),V&&(B?(g+=B*V,m+=B,P.units=g/m):g||(P.units=V)),N&&(P.assignments=_,P.assignmentIntervals=A,P.isOverallocated=P.isOverallocated||P.effort>P.maxEffort||P.units>100,P.isUnderallocated=P.effort<P.maxEffort||P.units<100)}}),{total:e,byAssignments:c}}};wl([Ce()],pu.prototype,"resource",void 0),wl([oe("allocation")],pu.prototype,"calculateAllocation",null);var Hp=class extends G([ou],e=>{const r=e.prototype;class t extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}addObserver(n){this.graph.addIdentifier(n),this.observers.add(n)}removeObserver(n){this.graph&&this.graph.removeIdentifier(n),this.observers.delete(n)}addEntity(n){this.graph.addEntity(n),this.entities.add(n)}removeEntity(n){this.graph&&this.graph.removeEntity(n),this.entities.delete(n)}leaveGraph(n){const{graph:s}=this;for(const a of this.observers)this.removeObserver(a);for(const a of this.entities)this.removeEntity(a);r.leaveGraph.call(this,n)}*forEachAvailabilityInterval(n,s){const a=this.getProject(),o=yield this.$.effectiveCalendar,l=a.combineCalendars([o].concat(n.calendars||[])),c=a.maxCalendarRange,d=n.includeNonWorkingIntervals;return c&&(n=Object.assign({maxRange:c},n)),l.forEachAvailabilityInterval(n,(u,h,f)=>{const g=f.getCalendarsWorkStatus();if(d||g.get(o))return s(u,h,f)})}}return t}){},ha=function(e,r,t,i){var n=arguments.length,s=n<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,r,t,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(n<3?a(s):n>3?a(r,t,s):a(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},Vp=class extends G([PE,ml,gl],e=>{const r=e.prototype;class t extends e{construct(n={}){this.eventSegmentModelClass=n.eventSegmentModelClass||this.getDefaultEventSegmentModelClass(),r.construct.call(this,n),this.resourceAllocationInfoClass||(this.resourceAllocationInfoClass=this.getDefaultResourceAllocationInfoClass())}getDefaultEventStoreClass(){return ul}getDefaultEventSegmentModelClass(){return Mp}getDefaultResourceAllocationInfoClass(){return pu}*calculateDirection(){return yield we}afterConfigure(){r.afterConfigure.apply(this,arguments),this.dateConstraintIntervalClass=this.dateConstraintIntervalClass||cu,this.dependencyConstraintIntervalClass=this.dependencyConstraintIntervalClass||pl}getType(){return Ci.SchedulerPro}getDefaultCycleEffectClass(){return Dl}getDefaultEventModelClass(){return $p}getDefaultDependencyModelClass(){return Dp}getDefaultAssignmentModelClass(){return wp}getDefaultResourceModelClass(){return Hp}async validateDependency(n,s,a,o){let l;return o&&(l=Array.isArray(o)?o:[o]),ot(n.outgoingDeps).some(d=>d.toEvent===s&&!(l!=null&&l.includes(d)))?zr.DuplicatingDependency:await this.isDependencyCyclic(n,s,a,l)?zr.CyclicDependency:zr.NoError}async isValidDependency(n,s,a,o){return await this.validateDependency(n,s,a,o)===zr.NoError}getDependencyCycleDetectionIdentifiers(n,s){return[s.$.earlyStartDateConstraintIntervals,s.$.earlyEndDateConstraintIntervals]}async isDependencyCyclic(n,s,a,o){const l=this.getDependencyStore().modelClass,c=new l({fromEvent:n,toEvent:s,type:a}),d=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});o&&(Array.isArray(o)||(o=[o]),o.forEach(u=>d.removeEntity(u))),d.addEntity(c),c.project=this;try{return await Promise.all(this.getDependencyCycleDetectionIdentifiers(n,s).map(u=>d.readAsync(u))),!1}catch(u){if(/cycle/i.test(u))return!0;if(!/conflict/i.test(u))throw u}}async isValidDependencyModel(n,s){return this.isValidDependency(n.fromEvent,n.toEvent,n.type,s)}}return ha([de({type:"string",defaultValue:dn.ToEvent})],t.prototype,"dependenciesCalendar",void 0),ha([de({type:"boolean",defaultValue:!0})],t.prototype,"autoCalculatePercentDoneForParentTasks",void 0),ha([de({type:"boolean",defaultValue:!0})],t.prototype,"addConstraintOnDateSet",void 0),t}){},tx=class extends Ve(ol){static get $name(){return"DeactivateDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.active=!1}},Dl=class extends An{getInvalidDependencies(){if(!this._invalidDependencies){const e=this.getDependencies();this._invalidDependencies=e.filter(r=>r.fromEvent===r.toEvent||r.fromEvent.contains(r.toEvent)||r.toEvent.contains(r.fromEvent))}return this._invalidDependencies}buildInvalidDependencyResolutions(e){return[this.removeDependencyConflictResolutionClass.new(e),this.deactivateDependencyConflictResolutionClass.new(e)]}matchDependencyBySourceAndTargetEvent(e,r,t){return e.active&&super.matchDependencyBySourceAndTargetEvent(e,r,t)}getResolutions(){if(!this._resolutions){const e=this.getInvalidDependencies(),r=[];for(const t of e)r.push(...this.buildInvalidDependencyResolutions({dependency:t}));e.length||r.push(this.deactivateDependencyCycleEffectResolutionClass.new(),...super.getResolutions()),this._resolutions=r}return this._resolutions}};ha([fe(tx)],Dl.prototype,"deactivateDependencyCycleEffectResolutionClass",void 0),ha([fe(Cp)],Dl.prototype,"removeDependencyConflictResolutionClass",void 0),ha([fe(Sp)],Dl.prototype,"deactivateDependencyConflictResolutionClass",void 0);var vu=class extends qe{static get $name(){return"ModelCombo"}static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}};vu.initClass(),vu._$name="ModelCombo";var yu=class extends vu{static get $name(){return"CalendarField"}static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,store:null,listItemTpl:e=>e.name||this.L("L{Default calendar}"),displayValueRenderer:(e,r)=>{var t,i;return e=e||((i=(t=r.store)==null?void 0:t.project)==null?void 0:i.effectiveCalendar),(e==null?void 0:e.name)||this.L("L{Default calendar}")}}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}};yu.initClass(),yu._$name="CalendarField";var Np=class extends pe.mixin(er){static get $name(){return"ResourceCalendarColumn"}static get type(){return"resourceCalendar"}static get defaults(){return{field:"calendar",text:"Calendar",editor:{type:yu.type,clearable:!0,allowInvalid:!1}}}attachToProject(e){e&&(this.defaultCalendar=e.defaultCalendar,this.editor.store=e.calendarManagerStore)}attachToResourceStore(e){super.attachToResourceStore(e),e&&e.ion({name:"resourceStore",update:"onResourceUpdate",thisObj:this})}onResourceUpdate({record:e,changes:r}){var t;const i=r[this.field];if(i){if(typeof i.oldValue=="string"&&((t=i.value)==null?void 0:t.id)===i.oldValue)return;this.refreshCell(e)}}renderer({value:e}){if(e===this.defaultCalendar)return"";if(e&&e.id){const r=this.editor.store.getById(e.id);return r&&r[this.editor.displayField]||""}else return""}};De.registerColumnType(Np),Np._$name="ResourceCalendarColumn";var zp=class extends pe{static get $name(){return"ScaleColumn"}static get type(){return"scale"}static get isScaleColumn(){return!0}static get fields(){return["scalePoints"]}static get defaults(){return{text:"\xA0",width:40,minWidth:40,cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:[{value:4},{value:8,text:8}]}}onDestroy(){this.scaleWidget.destroy()}set width(e){super.width=e,this.scaleWidget.width=e}get width(){return super.width}applyValue(e,r,t){return r==="scalePoints"&&(this.scaleWidget[r]=t),super.applyValue(...arguments)}buildScaleWidget(){const e=this,r=new Ac({owner:e.grid,appendTo:e.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1});return Object.defineProperties(r,{width:{get(){return e.width},set(t){this.element.style.width=`${t}px`,this._width=e.width}},height:{get(){return this._height},set(t){this.element.style.height=`${t}px`,this._height=t}}}),r.width=e.width,r}get scaleWidget(){const e=this;return e._scaleWidget||(e._scaleWidget=e.buildScaleWidget()),e._scaleWidget}renderer({cellElement:e,scaleWidget:r=this.scaleWidget}){r.height=this.grid.rowHeight,r.refresh();const t=r.element.cloneNode(!0);t.removeAttribute("id"),t.classList.remove("b-hide-offscreen"),e.innerHTML="",e.appendChild(t)}};De.registerColumnType(zp),zp._$name="ScaleColumn";var El=(e,r)=>{if(e!==r)throw new Error("Store set is prohibited for Scheduler Pro entity!")},Bt=e=>class extends(e||F){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(t){this.eventStore=t}get eventStore(){var t;return(t=this.project)==null?void 0:t.eventStore}get leftProjectEventStore(){const t=this.leftProject;return(t==null?void 0:t.getEventStore())||null}set eventStore(t){El(this.eventStore,t)}get dependencyStore(){var t;return(t=this.project)==null?void 0:t.dependencyStore}set dependencyStore(t){El(this.dependencyStore,t)}get assignmentStore(){var t;return(t=this.project)==null?void 0:t.assignmentStore}set assignmentStore(t){El(this.assignmentStore,t)}get resourceStore(){var t;return(t=this.project)==null?void 0:t.resourceStore}set resourceStore(t){El(this.resourceStore,t)}get calendarManagerStore(){var t;return(t=this.project)==null?void 0:t.calendarManagerStore}set calendarManagerStore(t){El(this.calendarManagerStore,t)}},Pi=class extends Bt(dg(wp.derive(ae))){get event(){const{project:e}=this,r=super.event;return e!=null&&e.isDelayingCalculation?e.eventStore.getById(r):r}set event(e){super.event=e}get resource(){const{project:e}=this;let r=super.resource;return e!=null&&e.isDelayingCalculation&&(r=e.resourceStore.getById(r)),r==null?void 0:r.$original}set resource(e){super.resource=e}get eventResourceKey(){return this.isInActiveTransaction?this.buildEventResourceKey(this.event,this.resource):this.buildEventResourceKey(this.$.event.DATA,this.$.resource.DATA)}};R(Pi,"$name","AssignmentModel"),R(Pi,"isProAssignmentModel",!0),Pi._$name="AssignmentModel";var bu=class extends Bt(ug(lp.derive(ut))){static get defaultConfig(){return{modelClass:Pi}}};R(bu,"$name","AssignmentStore"),bu._$name="AssignmentStore";var Wp=class extends Bt(Ao.derive(ae)){static get $name(){return"CalendarIntervalModel"}};Wp._$name="CalendarIntervalModel";var Cu=class extends Bt(In.derive(ae)){static get $name(){return"CalendarModel"}static get fields(){return[{name:"expanded",internal:!0,defaultValue:!0}]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:Wp}}};Cu._$name="CalendarModel";var Up=class extends Bt(cp.derive(ut)){static get defaultConfig(){return{tree:!0,modelClass:Cu,loadPriority:100,syncPriority:100,storeId:"calendars"}}};Up._$name="CalendarManagerStore";var fa=class extends Bt(Dp.derive(wt)){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}get fromEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.fromEvent):super.fromEvent}set fromEvent(e){super.fromEvent=e}get toEvent(){var e;return(e=this.project)!=null&&e.isDelayingCalculation?this.project.eventStore.getById(super.toEvent):super.toEvent}set toEvent(e){super.toEvent=e}};fa._$name="DependencyModel";var Gp=class extends Bt(xg(dp.derive(ut))){static get defaultConfig(){return{modelClass:fa}}};Gp._$name="DependencyStore";var Yp=e=>class extends e{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const t=super.copy(...arguments);return t.percentDone=0,t.clearChanges(),t}get renderedPercentDone(){const t=typeof this.percentDone=="number"&&!isNaN(this.percentDone)?this.percentDone:0;return this.getFormattedPercentDone(t)}getFormattedPercentDone(t=0){return t<=99?Math.round(t):Math.floor(t)}set renderedPercentDone(t){this.percentDone=t}},qp=class extends Mp.derive(St).mixin(yd,Yp){static get $name(){return"EventSegmentModel"}get task(){return this.event}};qp._$name="EventSegmentModel";var xl=class extends $p.derive(St).mixin(vd,Bt,yd,Yp){static get $name(){return"EventModel"}static get fields(){return[{name:"showInTimeline",type:"boolean",defaultValue:!1},"note",{name:"preamble",convert:e=>e?new Le(e):null},{name:"postamble",convert:e=>e?new Le(e):null}]}getDefaultSegmentModelClass(){return qp}updateWrapDate(e,r,t=!0){return r=new Le(r),new Date(e.getTime()+(t?1:-1)*r.milliseconds)}get startDate(){var e;let r;return this.isOccurrence?r=this.get("startDate"):r=(e=this._startDate)!=null?e:super.startDate,this.allDay&&(r=this.constructor.getAllDayStartDate(r)),r}set startDate(e){const r=this;if(r.generation&&r.isParent&&!r.$ignoreChange){const t=b.diff(r.startDate,e);if(t)for(const i of this.children)i.startDate=b.add(i.startDate,t)}r.batching?(r._startDate=e,r.set({startDate:e})):(super.startDate=e,r.preamble&&(r.wrapStartDate=null,r.wrapEndDate=null))}get endDate(){var e;let r;return this.isOccurrence?r=this.get("endDate"):r=(e=this._endDate)!=null?e:super.endDate,this.allDay&&(r=this.constructor.getAllDayEndDate(r)),r}set endDate(e){const r=this;r.batching?(r._endDate=e,r.set({endDate:e})):(super.endDate=e,r.postamble&&(r.wrapStartDate=null,r.wrapEndDate=null))}get fullEffort(){return new Le({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get wrapStartDate(){const e=this,{preamble:r,startDate:t}=e,i=e._wrapStartDate;let n;return i?n=i:r?(n=e.updateWrapDate(t,r,!1),e._wrapStartDate=n):n=t,n}set wrapStartDate(e){this._wrapStartDate=e}get wrapEndDate(){const e=this,{postamble:r,endDate:t}=e,i=e._wrapEndDate;let n;return i?n=i:r?(n=e.updateWrapDate(t,r,!0),e._wrapEndDate=n):n=t,n}set wrapEndDate(e){this._wrapEndDate=e}set(e){const r=typeof e=="object";return(e==="preamble"||r&&"preamble"in e)&&(this.wrapStartDate=null),(e==="postamble"||r&&"postamble"in e)&&(this.wrapEndDate=null),super.set(...arguments)}get outerStartDate(){return this.wrapStartDate}get outerEndDate(){return this.wrapEndDate}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":return!1;case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}get stm(){var e,r;return(r=(e=this.recurringEvent)==null?void 0:e.stm)!=null?r:super.stm}set stm(e){super.stm=e}get assigned(){const{project:e}=this,r=super.assigned;return e!=null&&e.isDelayingCalculation&&!r?e.assignmentStore.storage.findItem("event",this):r}set assigned(e){super.assigned=e}getCurrentConfig(e){const{segments:r}=this,t=super.getCurrentConfig(e);return t&&r&&(t.segments=r.map(i=>i.getCurrentConfig(e))),t}};R(xl,"isProEventModel",!0),xl._$name="EventModel";var Su=class extends Bt(vg(bg(mg(ww(gg(ul.derive(ut))))))){static get defaultConfig(){return{modelClass:xl}}};R(Su,"$name","EventStore"),Su._$name="EventStore";var Kp=class extends Ha{get type(){return"EventUpdateAction"}construct(e){let{model:r,newData:t,oldData:i}=e;if(t.segments&&i.segments){i={...i},t={...t};const n=i.segments.slice(),s=t.segments.slice();let a=!1;i.segments.forEach((o,l)=>{const c=t.segments.indexOf(o);c>-1&&(n[l]=s[c]=o,a=!0)}),a&&(i.segments=n,t.segments=s)}return super.construct({model:r,newData:t,oldData:i})}};Kp._$name="EventUpdateAction";var Rl=class extends Bt(fg(Hp.derive(pi))){static get $name(){return"ResourceModel"}get assigned(){var e,r;const{project:t}=this;return(e=t==null?void 0:t.assignmentStore.storage._indices)!=null&&e.resource?(r=t.assignmentStore.storage.findItem("resource",this))!=null?r:new Set:super.assigned}set assigned(e){super.assigned=e}};Rl._$name="ResourceModel";var Xp=class extends Bt(hg(pp.derive(ut))){static get defaultConfig(){return{modelClass:Rl}}};Xp._$name="ResourceStore";var x_=(e,r,t)=>e.isSplitEventMixin?new Kp({model:e,newData:r,oldData:t}):new Ha({model:e,newData:r,oldData:t}),Zp=class extends Xn{static get defaultConfig(){return{makeModelUpdateAction:x_}}};Zp._$name="StateTrackingManager";var ga=class extends Ve(ae){static get $name(){return"VersionModel"}onBeforeSave(){}get description(){var e;return(e=this.name)!=null?e:this.defaultDescription}get defaultDescription(){return`${this.isAutosave?"Auto-saved":"Saved"} at ${b.format(this.savedAt,this.L("L{Versions.versionDateFormat}"))}`}};R(ga,"fields",[{name:"name",type:"string"},{name:"isAutosave",type:"boolean"},{name:"content",type:"object"},{name:"savedAt",type:"date"}]),ga.exposeProperties(),ga._$name="VersionModel";var ma=class extends ee.mixin(Bt){};R(ma,"$name","VersionStore"),R(ma,"configurable",{modelClass:ga,storeId:"versions"}),ma._$name="VersionStore";var Ln=class extends Ve(ae){get description(){var e;return(e=this.get("description"))!=null?e:this.defaultDescription}get actions(){var e;return(e=this.get("actions"))!=null?e:[]}get defaultDescription(){var e,r;if(this.actions.length===0)return this.L("L{Versions.noChanges}");const t=this,i=H.unique(t.actions.map(({actionType:u})=>u.startsWith("add")?"add":u.startsWith("remove")?"remove":u.startsWith("update")?"update":u)),n=H.unique(t.actions.map(({entity:u})=>u.type)),s=H.unique(t.actions.map(({entity:u})=>`${u.type}.${u.id}`)).length,a=t.L("L{Versions.transactionDescriptions}"),o=t.L("L{Versions.entityNames}"),l=t.L("L{Versions.entityNamesPlural}"),c=n[0],d=n.length>1;return a[i.length>1?"mixed":i[0]].replace("{n}",s).replace("{entities}",s>1?(e=l[d?"other":c])!=null?e:l.other:(r=o[c])!=null?r:o.other)}};R(Ln,"$name","ChangeLogTransactionModel"),R(Ln,"fields",[{name:"versionId"},{name:"actions",type:"array"},{name:"occurredAt",type:"date"},{name:"description",type:"string"}]),Ln.exposeProperties(),Ln._$name="ChangeLogTransactionModel";var pa=class extends ee.mixin(Bt){};R(pa,"$name","ChangeLogStore"),R(pa,"configurable",{modelClass:Ln,storeId:"changelogs"}),pa._$name="ChangeLogStore";var rx=e=>class extends(e||F).mixin(Rg){static get configurable(){return{crudLoadValidationWarningPrefix:"Project load response error(s):",crudSyncValidationWarningPrefix:"Project sync response error(s):",trackProjectModelChanges:!1}}construct(...t){const i=this;super.construct(...t),i.addPrioritizedStore(i.calendarManagerStore),i.addPrioritizedStore(i.assignmentStore),i.addPrioritizedStore(i.dependencyStore),i.addPrioritizedStore(i.resourceStore),i.addPrioritizedStore(i.eventStore),i.timeRangeStore&&i.addPrioritizedStore(i.timeRangeStore),i.resourceTimeRangeStore&&i.addPrioritizedStore(i.resourceTimeRangeStore)}get project(){return this}set project(t){super.project=t}get crudLoadValidationMandatoryStores(){return[this.getStoreDescriptor(this.eventStore).storeId]}loadCrudManagerData(...t){this.delayCalculation&&!this.isDelayingCalculation&&!this.usingSyncDataOnLoad()&&this.scheduleDelayedCalculation(),super.loadCrudManagerData(...t)}acceptChanges(){super.acceptChanges(),this.clearChanges(!0,!1)}revertChanges(){this.revertCrudStoreChanges(),this.set(this.meta.modified,void 0,!0)}crudStoreHasChanges(t){const i=this.getCrudStore(t);let n;return i?n=super.crudStoreHasChanges(i):n=this.hasPersistableChanges||super.crudStoreHasChanges(),n}get changes(){let t=super.changes;if(this.trackProjectModelChanges){const i=this.modificationDataToWrite;i&&(t=t||{},t.project=i)}return t}shouldClearRecordFieldChange(t,i,n){return t.isCalendarModel&&i==="intervals"?!t.get("intervals").changes:super.shouldClearRecordFieldChange(...arguments)}},ix=(e,r)=>e<r?-1:e>r?1:0,Jp=e=>class extends(e||F){static get configurable(){return{type:null,weights:null,groupBy:null,groupByThisObj:null,layoutFn:null}}get grouped(){return!!this.groupBy}getGroupValue(t){var i;let n;if(t.group!=null)n=t.group;else{const{groupBy:s,weights:a,groupByThisObj:o=this}=this,{eventRecord:l}=t;typeof s=="function"?n=s.call(o,l):(n=l[s],a&&(n=(i=a[n])!=null?i:1/0)),t.group=n}return n}getEventGroups(t){if(this.grouped){const i=new Set;return t.sort((n,s)=>{const a=this.getGroupValue(n),o=this.getGroupValue(s);return i.add(a),i.add(o),ix(a,o)}),Array.from(i).sort(ix)}else return[]}},Qp=class extends Dd.mixin(Jp){static get $name(){return"ProHorizontalLayoutStack"}layoutEventsInBands(e,r=!1){return this.getEventGroups(e),super.layoutEventsInBands(e,r)}};Qp._$name="ProHorizontalLayoutStack";var ev=class extends wd.mixin(Jp){static get $name(){return"ProHorizontalLayoutPack"}layoutEventsInBands(e){const r=this.getEventGroups(e),t=r.length||1,i=this.packEventsInBands(e,(n,s,a,o)=>{const l=o/t,c=t===1?0:r.indexOf(n.group),d=c/t;n.height=l,n.top=d+a.start/t+s*l,n.inBandHeight=o,n.inBandTop=a.start+s*o});return e.forEach(n=>{Object.assign(n,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,n.top,n.height,n.eventRecord,n.resourceRecord))}),i}};ev._$name="ProHorizontalLayoutPack";var R_=0,wu=class extends Sr{static get $name(){return"CalendarHighlightModel"}static generateId(){return++R_}};R(wu,"domIdPrefix","calendarhighlight");var tv=class extends mn{static get $name(){return"CalendarHighlight"}static get configurable(){return{calendar:"event",unhighlightOnDrop:null,collectAvailableResources:null,rangeCls:"b-sch-highlighted-calendar-range",resourceTimeRangeModelClass:wu,inflate:3}}static get pluginConfig(){const e=super.pluginConfig;return e.assign=["highlightEventCalendars","highlightResourceCalendars","unhighlightCalendars"],e}afterConstruct(){super.afterConstruct(),this.client.ion({eventDragStart:"onEventDragStart",eventDragReset:"unhighlightCalendars",eventResizeStart:"onEventResizeStart",eventResizeEnd:"unhighlightCalendars",dragCreateStart:"onDragCreateStart",afterDragCreate:"unhighlightCalendars",thisObj:this})}highlightCalendar(e,r){e=H.asArray(e),r=H.asArray(r),this.calendar==="event"?this.highlightEventCalendars(e,r):this.highlightResourceCalendars(r)}highlightEventCalendars(e,r,t=!0){const i=this,{client:n}=i,{startDate:s,endDate:a}=n;i.disabled||(t&&i.unhighlightCalendars(),e=H.asArray(e),r||(r=e.flatMap(o=>o.$linkedResources)),i.highlight=new Map,r=H.asArray(r),e.forEach(o=>{var l;if(!o.calendar)return;const c=(l=o.calendar)==null?void 0:l.getWorkingTimeRanges(s,a).map(d=>new wu(d));if(c){for(const d of r)i.highlight.set(d,c),n.currentOrientation.refreshEventsForResource(d,!0,!1);r.length>0&&n.currentOrientation.onRenderDone()}}))}highlightResourceCalendars(e,r=!0){var t;const i=this,{startDate:n,endDate:s,currentOrientation:a}=i.client;if(!i.disabled){r&&i.unhighlightCalendars(),i.highlight=new Map;for(const o of e){const l=(t=o.calendar)==null?void 0:t.getWorkingTimeRanges(n,s).map(c=>new wu(c));l&&(i.highlight.set(o,l),a.refreshEventsForResource(o,!0,!1))}e.length>0&&a.onRenderDone()}}unhighlightCalendars(){if(!this.highlight)return;const{currentOrientation:e}=this.client,r=this.highlight.keys();this.highlight=null;for(const t of r)e.refreshEventsForResource(t,!0,!1);e.onRenderDone()}onEventDragStart({context:e}){var r,t;if(this.disabled)return;const i=this,{client:n}=i,{eventRecords:s}=e,a=e.availableResources=n.features.eventDrag.constrainDragToResource?[e.resourceRecord]:(t=(r=i.collectAvailableResources)==null?void 0:r.call(i,{scheduler:n,eventRecords:s}))!=null?t:n.resourceStore.records;i.highlightCalendar(s,a)}onEventResizeStart({eventRecord:e,resourceRecord:r}){this.disabled||this.highlightCalendar(e,[r])}onDragCreateStart({eventRecord:e,resourceRecord:r}){this.disabled||this.highlightCalendar(e,[r])}getEventsToRender(e,r){var t;const i=(t=this.highlight)==null?void 0:t.get(e);return i&&r.push(...i),r}onEventDataGenerated(e){const{eventRecord:r}=e;if(r.isCalendarHighlightModel){const{inflate:t}=this;e.fillSize=this.client.isVertical,e.wrapperCls["b-sch-highlighted-calendar-range"]=1,e.children.push({className:"b-sch-event-content",html:r.name,dataset:{taskBarFeature:"content"}}),e.width+=t*2,e.height+=t*2,e.left-=t,e.top-=t,e.eventId=`${this.generateElementId(r)}-resource-${e.resourceRecord.id}`}}updateDisabled(e,r){super.updateDisabled(e,r),e&&this.unhighlightCalendars()}shouldInclude(e){return e.isCalendarHighlightModel}get featureClass(){}};tv._$name="CalendarHighlight",z.registerFeature(tv,!1,"SchedulerPro");var rv=class extends Rd{static get $name(){return"DependencyEdit"}static get configurable(){return{showLagField:!0,editorConfig:{items:{activeField:{type:"checkbox",name:"active",label:"L{Active}"}}}}}};rv._$name="DependencyEdit",z.registerFeature(rv,!1);var iv=class extends X{static get $name(){return"EventBuffer"}static get configurable(){return{showDuration:!0,tooltipTemplate:{value:null,$config:"nullify"}}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}updateTooltipTemplate(e){var r;const t=this;e?t.tooltip=ue.new({forElement:t.client.timeAxisSubGridElement,forSelector:".b-sch-event-buffer-before,.b-sch-event-buffer-after",align:{align:"b-t",offset:[0,10]},getHtml({activeTarget:i}){const n=t.client.resolveEventRecord(i),s=i.matches(".b-sch-event-buffer-before"),a=s?n.preamble:n.postamble;return t.tooltipTemplate({eventRecord:n,duration:a,before:s})}}):(r=t.tooltip)==null||r.destroy()}onEventDataGenerated({useEventBuffer:e,bufferBeforeWidth:r,bufferAfterWidth:t,eventRecord:i,wrapperChildren:n}){if(this.enabled&&e){const{isHorizontal:s}=this.client,{showDuration:a}=this,{preamble:o,postamble:l}=i,c=s?"width":"height";n.push({className:{"b-sch-event-buffer":1,"b-sch-event-buffer-before":1,"b-buffer-thin":!r},style:`${c}: ${r}px`,children:a&&o?[{tag:"span",className:"b-buffer-label",html:o.toString(!0)}]:void 0},{className:{"b-sch-event-buffer":1,"b-sch-event-buffer-after":1,"b-buffer-thin":!t},style:`${c}: ${t}px`,children:a&&l?[{tag:"span",className:"b-buffer-label",html:l.toString(!0)}]:void 0})}}updateShowDuration(){this.isConfiguring||this.client.refreshWithTransition()}doDisable(e){super.doDisable(e);const{client:r}=this;!r.isConfiguring&&r.isPainted&&(r.element.classList.add("b-eventbuffer-transition"),r.refreshWithTransition(),r.waitForAnimations().then(()=>{r.element.classList.remove("b-eventbuffer-transition")}))}};iv._$name="EventBuffer",z.registerFeature(iv,!1,"SchedulerPro");var Du=class extends js{static get $name(){return"EventResize"}render(){const e=this,{client:r}=e;super.render(...arguments),e.dragSelector=e.dragItemSelector=r.eventSelector+":not(.b-sch-event-segment)"}};Du._$name="EventResize",z.registerFeature(Du,!0,"SchedulerPro");var Tl=class extends Ho{static get defaultConfig(){return{constrainDragToResource:!0}}static get configurable(){return{capitalizedEventName:"EventSegment"}}static get pluginConfig(){return{chain:["onPaint","isEventElementDraggable"]}}getTriggerParams(e){const{assignmentRecords:r,eventRecords:t,resourceRecord:i,browserEvent:n}=e;return{context:e,eventRecords:t,resourceRecord:i,assignmentRecords:r,event:n}}triggerEventDrag(e,r){this.scheduler.trigger("eventSegmentDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate}))}triggerDragStart(e){this.scheduler.navigator.skipNextClick=!0,this.scheduler.trigger("eventSegmentDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.scheduler.trigger("eventSegmentDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.scheduler.trigger("eventSegmentDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,r){if(this.scheduler.trigger("afterEventSegmentDrop",Object.assign(this.getTriggerParams(e),{valid:r})),!r){const{assignmentStore:t,eventStore:i}=this.client;this.dragData.initialAssignmentsState.find(({resource:s,assignment:a},o)=>{var l;return!t.includes(a)||!i.includes(a.event)||s.id!==((l=this.dragData.assignmentRecords[o])==null?void 0:l.resourceId)})&&this.client.refresh()}}async updateRecords(e){const r=this,{client:t}=r,i=!1;let n;return e.externalDropTarget||(t.eventStore.suspendAutoCommit(),n=await r.updateSegment(t,e,i),t.eventStore.resumeAutoCommit()),t.trigger("eventSegmentDrop",Object.assign(r.getTriggerParams(e),{isCopy:i,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),n}async updateSegment(e,r){var t;const i=this,n=e.mode==="vertical",{eventRecords:s,assignmentRecords:a,timeDiff:o}=r;e.suspendRefresh();let l=!1;n&&s.forEach((h,f)=>{const g=r.eventBarEls[f];delete h.instanceMeta(e).hasTemporaryDragElement,g.dataset.transient&&g.remove()});const c=r.eventBarEls.slice(),d=r.eventRecord,u=i.adjustStartDate(r.origStart,o);b.isEqual(d.startDate,u)||(e.endListeningForBatchedUpdates(),i.cancelBatchUpdate(d),d.startDate=u,l=!0,await e.project.commitAsync(),(t=i.endBatchUpdate)==null||t.call(i,d)),e.resumeRefresh(),a.length>0&&(l?(e.fillTicks&&c.forEach(h=>delete h.lastDomConfig),e.refreshWithTransition()):r.valid=!1)}isEventElementDraggable(e,r,t,i){const n=this;return n.disabled||!(r.isEventSegment||r.segments)?!0:!t.closest(n.drag.targetSelector)}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getMinimalDragData(e){const r=this,{client:t}=r,i=r.getElementFromContext(e),n=t.resolveEventRecord(i),s=t.resolveResourceRecord(i),a=t.resolveAssignmentRecord(i);return{eventRecord:n,resourceRecord:s,assignmentRecord:a,eventRecords:[n],assignmentRecords:a?[a]:[]}}beginBatchUpdate(e){e.event.beginBatch(),e.beginBatch()}endBatchUpdate(e){var r;(r=e.event)==null||r.endBatch(),e.endBatch()}cancelBatchUpdate(e){var r;(r=e.event)==null||r.cancelBatch(),e.cancelBatch()}setupProductDragData(e){var r;const t=this,{client:i}=t,n=t.getElementFromContext(e),{eventRecord:s,resourceRecord:a}=t.getMinimalDragData(e),o=[],l=i.getElementsFromEventRecord(s.event,a,!0)[0];if(t.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);t.drag.ignoreSamePositionDrop=!i.rtl||s.nextSegment,i.listenToBatchedUpdates||i.beginListeningForBatchedUpdates(),t.beginBatchUpdate(s);const c=(r=t.getDateConstraints)==null?void 0:r.call(t,a,s),d=t.constrainRectangle=t.getConstrainingRectangle(c,a,s),u=k.from(n,i.foregroundCanvas,!0),h=k.from(l,i.foregroundCanvas,!0);return d.translate(-h.x),super.setupConstraints(d,u,i.timeAxisViewModel.snapPixelAmount,!!c.start),o.push(n),{record:s,draggedEntities:[s],dateConstraints:c!=null&&c.start?c:null,eventBarEls:o,mainEventElement:l}}suspendRecordElementRedrawing(){}suspendElementRedrawing(){}getDateConstraints(e,r){let{minDate:t,maxDate:i}=super.getDateConstraints(e,r);return r.previousSegment&&(!t||t<r.previousSegment.endDate)&&(t=r.previousSegment.endDate),r.nextSegment&&(!i||i<r.nextSegment.startDate)&&(i=r.nextSegment.startDate),{start:t,end:i}}get tipId(){return`${this.client.id}-segment-drag-tip`}internalSnapToPosition(e){super.internalSnapToPosition(),this.client.rtl&&!this.dragData.eventRecord.nextSegment&&(e.x=0)}updateDragContext(e,r){var t;super.updateDragContext(...arguments);const{client:i}=this,{dirty:n,eventRecord:s,endDate:a}=this.dragData;if(n&&!s.nextSegment){const{enableEventAnimations:o}=i;i.enableEventAnimations=!1,s.event.set("endDate",a),(t=i.features.eventBuffer)!=null&&t.enabled&&(s.event.wrapEndDate=a),i.enableEventAnimations=o}}};R(Tl,"$name","EventSegmentDrag"),Tl._$name="EventSegmentDrag",z.registerFeature(Tl,!0,"SchedulerPro"),z.registerFeature(Tl,!1,"ResourceHistogram");var Ml=class extends Du{static get pluginConfig(){return{chain:[...super.pluginConfig.chain,"isEventSegmentElementDraggable"]}}render(){super.render(...arguments),this.dragSelector=this.dragItemSelector=".b-sch-event-segment"}isEventSegmentElementDraggable(e,r,t,i){return this.isEventElementDraggable(...arguments)}isEventElementDraggable(e,r,t,i){const n=this,s=r==null?void 0:r.resizable;if(n.disabled||!s||r.isMilestone)return!0;if(r.segments){const a=n.client.scheduledEventName;return r.segments.every((o,l)=>{const c=o.resizable,d=q.getChild(e,`${a}.segments.${l}`);return!c||(c!==!0&&c!=="start"||!n.isOverStartHandle(i,d))&&(c!==!0&&c!=="end"||!n.isOverEndHandle(i,d))})}return super.isEventElementDraggable(...arguments)}get tipId(){return`${this.client.id}-event-segment-resize-tip`}dragStart(e){return this._segmentsSlices=null,this._segmentsSlicesIndex=0,super.dragStart(...arguments)}beginEventRecordBatch(e){super.beginEventRecordBatch(e),e.isEventSegment&&e.event.beginBatch()}triggerBeforeResize(e){const{client:r}=this,t=r.scheduledEventName,i=r.resolveTimeSpanRecord(e.itemElement);return r.trigger(`before${r.capitalizedEventName}SegmentResize`,{[t+"Record"]:i,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,r){const{client:t}=this;t.trigger(`${t.scheduledEventName}SegmentResizeStart`,r)}triggerEventResizeEnd(e,r){const{client:t}=this;t.trigger(`${t.scheduledEventName}SegmentResizeEnd`,r)}triggerEventPartialResize(e,r){const{client:t}=this;t.trigger(`${t.scheduledEventName}SegmentPartialResize`,r)}triggerBeforeEventResizeFinalize(e,r){const{client:t}=this;t.trigger(`before${t.capitalizedEventName}SegmentResizeFinalize`,r)}applyDateConstraints(e,r,t){var i,n;let s=(i=t.dateConstraints)==null?void 0:i.start,a=(n=t.dateConstraints)==null?void 0:n.end;if(r.isEventSegment){const{previousSegment:o,nextSegment:l}=r;o&&(s=s?b.max(o.endDate,s):o.endDate),l&&(a=a?b.min(l.startDate,a):l.startDate)}return(s||a)&&(e=b.constrain(e,s,a),t.snappedDate=b.constrain(t.snappedDate,s,a)),e}resizeEventPartiallyInternal(e,r){const{toSet:t}=r;if(super.resizeEventPartiallyInternal(...arguments),e.isEventSegment){const{event:i}=e;if(!e.nextSegment&&t==="endDate")i.set("endDate",r[t]);else if(!e.previousSegment&&t==="startDate")i.set("startDate",r[t]);else{const n=i.fieldMap.segments;n._skipSegmentsIsEqual++,i.set("segments",i.get("segments")),n._skipSegmentsIsEqual--}}}cancelEventRecordBatch(e){super.cancelEventRecordBatch(e),e.isEventSegment&&e.event.cancelBatch()}highlightHandle(){const{overItem:e}=this;e.classList.add("b-resize-handle","b-over-resize-handle")}unHighlightHandle(e=this.overItem){e==null||e.classList.remove("b-resize-handle",this.resizingItemInnerCls,"b-over-resize-handle",this.draggingItemCls)}};R(Ml,"$name","EventSegmentResize"),Ml._$name="EventSegmentResize",z.registerFeature(Ml,!0,"SchedulerPro"),z.registerFeature(Ml,!1,"ResourceHistogram");var $n=class extends X{onElementMouseOut(e){const r=this,{client:t}=r,{target:i,relatedTarget:n}=e,s=i.closest(t.eventSelector),a=t.resolveTimeSpanRecord(i);a!=null&&a.isEventSegment&&s&&t.hoveredEvents.has(s)&&n&&C.isDescendant(s,n)||this.overridden.onElementMouseOut(...arguments)}getElementsFromEventRecord(e,r){if(e!=null&&e.isEventSegment){const t=this.overridden.getElementsFromEventRecord(e.event,r)[0];return[q.getChild(t,"segments."+e.segmentIndex)]}return this.overridden.getElementsFromEventRecord(...arguments)}resolveEventRecord(e){const r=e instanceof Event?e.target:e,t=r==null?void 0:r.closest(".b-sch-event-segment");let i=this.overridden.resolveEventRecord(e);return i!=null&&i.segments&&t&&(i=i.segments[t.dataset.segment]),i}resolveTaskRecord(e){const r=e==null?void 0:e.closest(".b-sch-event-segment");let t=this.overridden.resolveTaskRecord(e);return t!=null&&t.segments&&r&&(t=t.segments[r.dataset.segment]),t}populateTaskMenu(e){e.eventRecord=e.taskRecord,e.targetElement.closest(e.feature.client.eventSelector)&&this.populateEventMenu(e)}populateEventMenu({eventRecord:e,taskRecord:r,items:t,domEvent:i}){const n=this;if(!n.client.readOnly&&!e.isParent&&!e.milestone){t[`split${r?"Task":"Event"}`]={localeClass:n,text:`L{split${r?"Task":"Event"}}`,icon:"b-icon b-icon-cut",disabled:e.readOnly,weight:650,separator:!0,onItem(a){n.splitEvent(a)}};const s=i.target.closest(".b-sch-event-segment");if(s){const a=n.client.resolveEventRecord(s);t.renameSegment={localeClass:n,text:"L{renameSegment}",icon:"b-icon b-icon-rename",disabled:e.readOnly||a.readOnly,weight:660,onItem(){n.rename(a,s)}}}}}getSplitDate(e){const{eventRecord:r,date:t,timeAxis:i}=e;return i.roundDate(t,r.startDate)}getSplitDuration(e){const{splitDuration:r,minSplitDuration:t,maxSplitDuration:i}=this;if(r!=null&&r.magnitude)return r.magnitude;const{eventRecord:n,tick:s}=e;if(s){const a=this.getSplitDurationUnit(e),{project:o}=n;let l=s.endDate-s.startDate;if(i){const c=o.run("$convertDuration",i.magnitude,i.unit||a,"millisecond");l=Math.min(l,c)}if(t){const c=o.run("$convertDuration",t.magnitude,t.unit||a,"millisecond");l=Math.max(l,c)}return o.run("$convertDuration",l,"millisecond",a)}}getSplitDurationUnit(e){const{splitDuration:r}=this;return(r==null?void 0:r.unit)||e.eventRecord.durationUnit}splitEvent(e){const{client:r}=e.feature,{timeAxis:t}=r;e.date=r.getDateFromXY(e.point,void 0,!1),e.tick=t.getAt(Math.floor(t.getTickFromDate(e.date))),e.timeAxis=t,e.eventRecord.splitToSegments(this.getSplitDate(e),this.getSplitDuration(e),this.getSplitDurationUnit(e))}rename(e,r){const{client:t}=this;new Qt({owner:t,appendTo:t.timeAxisSubGridElement,scrollAction:"realign",align:{align:"c-c"},cls:"b-event-segment-renamer",internalListeners:{complete(){t.refresh()},thisObj:this}}).startEdit({target:r,record:e,field:"name"})}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}generateSegmentRenderData(e,r){var t;let i,n;if(this.client.isGantt){const s=this.client.currentOrientation,a=s.getTaskBox(e),o={taskRecord:e,task:e,row:r.row,children:[]};a&&Object.assign(o,{isTask:!0,top:a.top,left:a.left,width:a.width,height:a.height}),s.internalPopulateTaskRenderData(o,e),n=o}else n=this.client.generateRenderData(e,r.resourceRecord,!0);if(n){const{eventColor:s}=n;i={segmentRecord:e,eventContent:n.eventContent||n.taskContent,cls:n.cls||((t=e.cls)==null?void 0:t.clone())||new J,top:r.top,left:n.left-r.left,width:n.width,height:r.height,style:""},Object.assign(i.cls,{"b-sch-event-segment":!0,"b-first":!e.previousSegment,"b-last":!e.nextSegment},n.cls),C.isNamedColor(s)?i.cls[`b-sch-color-${s}`]=s:s?(i.style=`background-color:${s};`+i.style,i.cls["b-sch-custom-color"]=1):r.wrapperCls["b-sch-color-none"]=1}return i}appendDOMConfig(e){const r=e.eventRecord||e.taskRecord;if(r.segments&&!this.disabled){const t=e.eventContent||e.taskContent,i=e.children.indexOf(t);i>-1&&e.children.splice(i,1),delete e.eventContent,delete e.taskContent,e.cls["b-segmented"]=!0,e.segments=r.segments.map(n=>this.generateSegmentRenderData(n,e)),e.segmentsDOMConfig=e.segments.map(this.getSegmentDOMConfig.bind(this)),e.children.unshift({syncOptions:{syncIdField:"segment",releaseThreshold:0},className:"b-sch-event-segments",dataset:{taskBarFeature:"segments"},children:e.segmentsDOMConfig})}}getSegmentDOMConfig(e,r){return{className:e.cls,style:{style:e.style,left:e.left,height:e.height,width:e.width},dataset:{segment:r},syncOptions:{syncIdField:"taskBarFeature"},children:[e.eventContent]}}onEventDataGenerated(e){this.appendDOMConfig(e)}onTaskDataGenerated(e){this.appendDOMConfig(e)}get featureClass(){}};R($n,"$name","EventSegments"),R($n,"configurable",{splitDuration:0,maxSplitDuration:{magnitude:1,unit:"day"},minSplitDuration:0}),R($n,"pluginConfig",{override:["getElementsFromEventRecord","resolveEventRecord","resolveTaskRecord","onElementMouseOut"],chain:["populateTaskMenu","populateEventMenu","onTaskDataGenerated","onEventDataGenerated"]}),$n._$name="EventSegments",z.registerFeature($n,!0,"SchedulerPro"),z.registerFeature($n,!0,"Gantt");var T_={border:1,hollow:2},jn=class extends X.mixin(er,ge){construct(e,r){super.construct(e,r),this.client.eventStore.tree=!0}refreshClient(){!this.client.isConfiguring&&this.client.refreshWithTransition()}doDisable(){this.refreshClient()}updateEventLayout(e){e==="stack"&&this.client.isVertical&&console.warn("Stacked nested events are not supported in vertical mode"),this.refreshClient()}updateBarMargin(){this.refreshClient()}updateResourceMargin(){this.refreshClient()}updateEventHeight(){this.refreshClient()}updateHeaderHeight(e){this.client.element.style.setProperty("--schedulerpro-nested-event-header-height",`${e}px`),this.refreshClient()}getEventLayout(e,r){return r?{type:this.eventLayout}:this.overridden.getEventLayout(e)}getResourceMargin(e,r){return r&&!r.isRoot?this.resourceMargin:this.overridden.getResourceMargin(e)}getBarMargin(e,r){return r&&!r.isRoot?this.barMargin:this.overridden.getBarMargin(e)}getAppliedResourceHeight(e,r){var t;const i=this;if(r&&!r.isRoot){if(i.eventLayout==="stack")return i.eventHeight+i.resourceMargin*2;{const n=(t=T_[i.client.getEventStyle(r,e)])!=null?t:0;return i.currentParentsHeight-i.headerHeight-n}}return i.overridden.getAppliedResourceHeight(e)}getResourceWidth(e,r){return r&&!r.isRoot?this.currentParentsWidth-this.headerHeight:this.overridden.getResourceWidth(e)}attachToEventStore(e){e==null||e.ion({name:"eventStore",change:"onEventStoreChange",thisObj:this})}onEventStoreChange({records:e}){e!=null&&e.some(r=>r.parent&&!r.parent.isRoot)&&this.refreshClient()}onEventStoreBatchedUpdate({records:e}){if(this.client.listenToBatchedUpdates&&(e!=null&&e.some(r=>r.parent&&!r.parent.isRoot)))return this.refreshClient(),!1}beforeEventDragStart(e,r){const t=this,{client:i}=t,{eventRecord:n,assignmentRecords:s}=r,{parentElement:a}=e.element;if(n.parent&&a!==i.foregroundCanvas){t.isDraggingNestedEvent=!0,e.originalParentElement=a,e.originalBounds=[];for(const o of s){const{event:l}=o;if(l.parent===n.parent){const c=i.getElementFromAssignmentRecord(o,!0);if(e.originalBounds.push({element:c,bounds:k.from(c,a)}),!t.constrainDragToParent&&i.features.eventDrag.constrainDragToTimeline){const d=k.from(c,i.timeAxisSubGridElement);c.style.top=`${d.top}px`,c.style.left=`${d.left}px`,q.addChild(i.foregroundCanvas,c,o.id)}}}}else t.isDraggingNestedEvent=!1}afterEventDragStart(e,r){if(this.isDraggingNestedEvent&&this.constrainDragToParent){const{eventDrag:t}=this.client.features,{parent:i}=r.eventRecord,n=e.originalParentElement.getBoundingClientRect();t.setYConstraint(0,n.height-e.originalBounds[0].bounds.height),t.setXConstraint(0,n.width-e.originalBounds[0].bounds.width),r.dateConstraints={start:i.startDate,end:i.endDate}}}checkEventDragValidity({targetEventRecord:e,eventRecord:r,timeDiff:t,newResource:i,resourceRecord:n}){const s=this;if(s.isDraggingNestedEvent&&!s.allowDeNestingOnDrop&&!e&&(t||i!==n))return{valid:!1,message:s.L("L{deNestingNotAllowed}")};if(!s.allowNestingOnDrop&&e&&e!==r.parent)return{valid:!1,message:s.L("L{nestingNotAllowed}")}}processEventDrop({context:e,toScheduler:r,eventRecord:t,resourceRecord:i,reassignedFrom:n,element:s,eventsToAdd:a,addedEvents:o,draggedAssignment:l}){var c;const{parent:d}=t,{targetEventRecord:u}=e;let h=d;if(d!==u&&!this.constrainDragToParent&&!((c=t.children)!=null&&c.length)){if(u&&this.allowNestingOnDrop){h=u.parent.isRoot?u:u.parent;const f=this.client.resolveResourceRecord(e.browserEvent);f!==i&&(i=l.resource=f)}else h=r.eventStore.rootNode;h&&h!==d&&(o.push(h.appendChild(t)),H.remove(a,t))}if(d!=null&&d.isRoot&&t.isParent&&n&&n!==i)for(const f of t.children){const g=f.assignments.find(m=>m.resource===n);g&&(g.resource=i)}if(h&&!h.isRoot){const f=this.client.getElementFromEventRecord(h,i).syncIdMap.nestedEventsContainer,g=f&&k.from(s,f);f&&(s.style.top=`${g.top}px`,s.style.left=`${g.left}px`,s.lastDomConfig=null,q.addChild(f,s,s.dataset.syncId))}}processCrossSchedulerEventDrop({eventRecord:e}){if(e.isParent)for(const r of e.children)r.resource=e.resource}async afterEventDragAbortFinalized({originalParentElement:e,originalBounds:r}){if(this.isDraggingNestedEvent){for(const t of r[0].element.getAnimations())(t.transitionProperty==="top"||t.transitionProperty==="left")&&await t.finished;for(const{element:t,bounds:i}of r)t.style.top=`${i.top}px`,t.style.left=`${i.left}px`,e.appendChild(t)}}afterEventResizeStart(e){if(this.constrainResizeToParent){const{parent:r}=e.timespanRecord;if(r&&!r.isRoot){let{startDate:t,endDate:i}=r;e.dateConstraints&&(t=b.max(t,e.dateConstraints.start),i=b.min(i,e.dateConstraints.end)),e.dateConstraints={start:t,end:i}}}}getElementFromAssignmentRecord(e,r){var t;if((t=e==null?void 0:e.event)!=null&&t.parent&&!e.event.parent.isRoot){const i=this.client.getElementFromEventRecord(e.event.parent,e.resource);return q.getChild(i,`nestedEventsContainer.${e.id}${r?"":".event"}`)}return this.overridden.getElementFromAssignmentRecord(e,r)}async scheduleEvent({eventRecord:e,parentEventRecord:r,startDate:t,element:i}){if(r){if(e.startDate=t,e=r.appendChild(e),e.assign(r.resource),i){const n=this.client.getElementFromEventRecord(r).syncIdMap.nestedEventsContainer,s=k.from(i,n);C.setTranslateXY(i,0,0),C.setTopLeft(i,s.y,s.x),q.addChild(n,i,e.assignments[0].id)}await this.client.project.commitAsync()}else return this.overridden.scheduleEvent(...arguments)}getEventsToRender(e,r){return this.disabled||H.remove(r,...r.filter(t=>t.isEventModel&&!t.parent.isRoot)),r}onEventDataGenerated({eventRecord:e,resourceRecord:r,wrapperCls:t,height:i,width:n,children:s,left:a,top:o}){if(e.isParent){t["b-nested-events-parent"]=1;const l=this;l.currentParentsHeight=i,l.currentParentsWidth=n;const{currentOrientation:c,isVertical:d}=l.client,u=e.children.filter(m=>{var p;return(p=m.$linkedResources)==null?void 0:p.includes(r)}),h=c.layoutEvents(r,u,!1,e,l.overlappingEventSorter),f=[];let g;if(d){g=[];for(const m of Object.values(h))g.push(m.renderData)}else g=h==null?void 0:h.eventsData;if(g)for(const m of g){d?(m.left-=a,m.top-=o,m.absoluteTop=m.top):(l.eventLayout==="none"?(m.top=0,m.height=l.getAppliedResourceHeight(r,e)):l.eventLayout==="stack"&&(m.height=l.eventHeight),m.left-=a,m.absoluteTop=m.top);const p=c.renderEvent(d?{renderData:m}:m,i);p.className["b-nested-event"]=1,f.push(p)}s.push({className:{"b-nested-events-container":1,[`b-nested-events-layout-${l.eventLayout}`]:1},dataset:{taskBarFeature:"nestedEventsContainer"},children:f,syncOptions:{syncIdField:"syncId",releaseThreshold:0}})}}};R(jn,"$name","NestedEvents"),R(jn,"configurable",{eventLayout:"pack",barMargin:5,resourceMargin:0,eventHeight:30,headerHeight:20,constrainDragToParent:!1,allowNestingOnDrop:!0,allowDeNestingOnDrop:!0,constrainResizeToParent:!0}),R(jn,"pluginConfig",{before:["onEventStoreBatchedUpdate"],chain:["getEventsToRender","onEventDataGenerated","processEventDrop","processCrossSchedulerEventDrop","beforeEventDragStart","afterEventDragStart","afterEventDragAbortFinalized","checkEventDragValidity","afterEventResizeStart"],override:["getResourceMargin","getBarMargin","getAppliedResourceHeight","getResourceWidth","getEventLayout","getElementFromAssignmentRecord","scheduleEvent"]}),R(jn,"delayable",{refreshClient:"raf"}),jn._$name="NestedEvents",z.registerFeature(jn,!1,"SchedulerPro");function Bn(e){return`b-task-percent-bar${e[0]?`-${e[0]}`:""}`}var Eu=class extends X{static get $name(){return"PercentBar"}static get configurable(){return{allowResize:!0,showPercentage:!0,instantUpdate:!0,valueField:"percentDone",displayField:"renderedPercentDone"}}static get pluginConfig(){return{chain:["onPaint",{fn:"onTaskDataGenerated",prio:-1e4},{fn:"onEventDataGenerated",prio:-1e4}]}}onPaint({firstPaint:e}){if(e){const r=this,{client:t}=r;r.drag=new Yi({name:"percentBarHandle",lockX:t.isVertical,lockY:t.isHorizontal,targetSelector:`${t.eventSelector} .b-task-percent-bar-handle`,dragThreshold:1,outerElement:t.timeAxisSubGridElement,internalListeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",thisObj:r}}),r.detachListeners("view"),r.client.ion({name:"view",[`${t.scheduledEventName}mouseenter`]:"onTimeSpanMouseEnter",[`${t.scheduledEventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:r})}}get sizeProp(){return this.client.isVertical?"height":"width"}get offsetSizeProp(){return this.client.isVertical?"offsetHeight":"offsetWidth"}get positionProp(){return this.client.isVertical?"top":this.client.rtl?"right":"left"}get offsetPositionProp(){return this.client.isVertical?"offsetTop":this.client.rtl?"offsetRight":"offsetLeft"}updateAllowResize(e){this.client.element.classList.toggle(Bn`drag-disabled`,!e)}updateShowPercentage(e){this.client.element.classList.toggle(Bn`show-percentage`,!!e)}doDestroy(){var e;(e=this.drag)==null||e.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}reset(e){const r=this,{project:t}=r.client;if(r.client.element.classList.remove(Bn`resizing-task`),r.isMouseInsideEvent||(r.handle.remove(),r.handle=null),r.instantUpdate){const{stm:i}=t;i.disabled||(r._stmTransactionStarted&&(e.valid?i.stopTransaction():i.rejectTransaction()),i.autoRecord=r.oldStmAutoRecord,r._stmTransactionStarted=!1),t.resumeAutoSync(),r.client.eventStore.resumeAutoCommit()}}getPercentBarDOMConfig(e){return{className:Bn`outer`,dataset:{taskBarFeature:"percentBar"},children:[{className:Bn``,dataset:{percent:e[this.displayField]},style:{[this.sizeProp]:e[this.valueField]+"%"}}]}}appendDOMConfig(e,r,t){if((e.isEvent||e.isTask)&&!e.isMilestone&&!this.disabled){const{eventSegments:i}=this.client.features;e.isSegmented&&(i!=null&&i.enabled)?e.segments.forEach((n,s)=>{t.segmentsDOMConfig[s].children.unshift(this.getPercentBarDOMConfig(n))}):r.unshift(this.getPercentBarDOMConfig(e))}}onEventDataGenerated(e){this.appendDOMConfig(e.eventRecord,e.children,e)}onTaskDataGenerated(e){this.appendDOMConfig(e.taskRecord,e.children,e)}getHoverSegment(e){const r=(e.toElement||e.target).closest(".b-sch-event-segment");if(r){const t=k.from(r);if(t!=null&&t.contains(j.getPagePoint(e)))return r}}isOverSegment(e){return!!this.getHoverSegment(e)}onTimeSpanMouseEnter(e){const r=this,{client:t,sizeProp:i}=r,n=e[`${t.scheduledEventName}Record`];if(!(n.isMilestone||n.readOnly||r.disabled||n.isParent||!n.isEditable(r.valueField)))if(r.drag.context)n===r.drag.context.taskRecord&&(r.isMouseInsideEvent=!0);else{const s=e[`${t.scheduledEventName}Element`],a=q.getChild(s,t.scheduledEventName);if(!r.handle){const o={percent:n[r.valueField]};let l=n[r.valueField]+"%";const{eventSegments:c}=t.features;if(n.isSegmented&&(c!=null&&c.enabled)){o.segment=0;const d=k.from(a);let u,h;n.segments.some((f,g)=>{if(!f[r.valueField]&&u!==100)return!0;u=f[r.valueField],o.segment=g;const m=q.getChild(a,`segments.${g}.percentBar`).firstChild;h=k.from(m)}),t.isVertical?l=h?h.top+h[i]-d.top:0:t.rtl?l=h?h.right+h[i]-d.right:0:l=h?h.left+h[i]-d.left:0}r.handle=C.createElement({parent:a,className:Bn`handle`,style:{[r.positionProp]:l},dataset:o})}r.isMouseInsideEvent=!0}}onTimeSpanMouseLeave(e){const r=this;!r.drag.context&&r.handle&&e.event.toElement!==r.handle&&(r.handle.remove(),r.handle=null),r.isMouseInsideEvent=!1}onBeforeDragStart({source:e,context:r,event:t}){const{client:i,offsetPositionProp:n,offsetSizeProp:s}=this,{eventSegments:a}=i.features,{element:o}=r,l=i.resolveEventRecord(o);let c,d,u,h;if(l.isSegmented&&(a!=null&&a.enabled)){const f=o.dataset.segment;c=q.getChild(o.parentElement,`segments.${f}.percentBar`),d=c.firstElementChild,h=o.parentElement[s],u=q.getChild(o.parentElement,`segments.${f}`)[n]+d[s]}else c=q.getChild(o.parentElement,"percentBar"),d=c.firstElementChild,h=c[s],u=d[s];i.isVertical?(e.minY=-u,e.maxY=h-u):i.rtl?(e.maxX=u,e.minX=-(h-u)):(e.minX=-u,e.maxX=h-u),Object.assign(r,{percentBar:d,initialPos:u,size:h,taskRecord:l,initialValue:l[this.valueField],domEvent:t})}onDragStart({context:e,event:r}){const{client:t}=this,{project:i}=t;t.element.classList.add(Bn`resizing-task`),e.element.retainElement=!0,e.domEvent=r,t.trigger("percentBarDragStart",e),this.instantUpdate&&(i.suspendAutoSync(),t.eventStore.suspendAutoCommit(),i.stm.disabled||(this.oldStmAutoRecord=i.stm.autoRecord,i.stm.autoRecord=!1))}onDrag({context:e,event:r}){const t=this,{sizeProp:i,offsetSizeProp:n,client:s}=t,a=s.isHorizontal?Math.round((e.initialPos+e.newX*(s.rtl?-1:1))/e.size*100):Math.round((e.initialPos+e.newY)/e.size*100),{eventSegments:o}=s.features;if(t.instantUpdate){const{stm:l}=s.project;!l.disabled&&!l.transaction&&(l.startTransaction(),t._stmTransactionStarted=!0),e.taskRecord[t.valueField]=a}e.domEvent=r,e.percent=e.element.dataset.percent=a,e.taskRecord.isSegmented&&(o!=null&&o.enabled)&&e.taskRecord.segments.forEach((l,c)=>{const d=q.getChild(e.element.parentElement,`segments.${c}.percentBar`).firstChild,u=q.getChild(e.element.parentElement,`segments.${c}`);if(e.percent>=l.endPercentDone)d.style[i]=u[n]+"px";else if(e.percent<=l.startPercentDone)d.style[i]="0";else if(e.percent>=l.startPercentDone&&e.percent<=l.endPercentDone){const h=l.endPercentDone-l.startPercentDone;d.style[i]=(a-l.startPercentDone)*u[n]/h+"px"}}),s.trigger("percentBarDrag",e)}onDragAbort({context:e,event:r}){e.taskRecord.isSegmented&&(e.percentBar.style[this.sizeProp]=e.taskRecord.segments[e.element.dataset.segment][this.valueField]+"%"),e.taskRecord[this.valueField]=e.initialValue,e.domEvent=r,this.reset(e),this.client.trigger("percentBarDragAbort",e)}onDrop({context:e}){const r=this,{taskRecord:t}=e,{eventSegments:i}=r.client.features;t[r.valueField]=e.percent,t.isSegmented&&(i!=null&&i.enabled)?t.segments.some((n,s)=>{if(e.percent>=n.startPercentDone&&e.percent<=n.endPercentDone){const a=n.endPercentDone-n.startPercentDone,o=q.getChild(e.element.parentElement,`segments.${s}`),l=parseInt(o.style[r.sizeProp])+(e.percent-n.startPercentDone)*o[r.offsetSizeProp]/a;return e.element.style.cssText=`${r.positionProp}: ${l}px`,e.element.dataset.segment=s,!0}}):e.element.style.cssText=`${r.positionProp}: ${r.client.rtl?100-e.percent:e.percent}%`,r.reset(e),r.client.trigger("percentBarDrop",e)}get featureClass(){}};Eu._$name="PercentBar",z.registerFeature(Eu,!1,"SchedulerPro"),z.registerFeature(Eu,!0,"Gantt");var va=class extends mn{static get properties(){return{resourceMap:new Map}}construct(){var e;super.construct(...arguments),this.resourceTimeRangeModelClass=(e=class extends this.resourceTimeRangeModelClass{},R(e,"$name","ResourceNonWorkingTimeModel"),R(e,"domIdPrefix","resourcenonworkingtimemodel"),e),this.client.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e==null||e.ion({name:"resourceStore",changePreCommit:"onResourceChange",thisObj:this})}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e),e==null||e.ion({name:"calendarManagerStore",changePreCommit:"onCalendarChange",thisObj:this})}onTimeAxisReconfigure(){this.resourceMap.clear()}onResourceChange({action:e,records:r,record:t,changes:i}){var n;const s=this;if(e==="update"){const a=i.calendar;a&&(typeof a.oldValue!="string"||((n=a.value)==null?void 0:n.id)!==a.oldValue)&&(s.resourceMap.delete(t.id),s.client.runWithTransition(()=>{s.client.currentOrientation.refreshEventsForResource(t)}))}e==="remove"&&r.forEach(a=>s.resourceMap.delete(a.id)),e==="removeall"&&s.resourceMap.clear()}onCalendarChange({action:e,records:r,record:t,changes:i}){this.resourceMap.clear(),this.client.refresh()}getEventsToRender(e,r){const t=this,{resourceMap:i,client:n}=t,{timeAxis:s}=n,a=!t.maxTimeAxisUnit||b.compareUnits(s.unit,t.maxTimeAxisUnit)<=0;if(!t.disabled&&a&&e.effectiveCalendar){if(!i.has(e.id)){const o=e.effectiveCalendar.getNonWorkingTimeRanges(n.startDate,n.endDate),l=o.map((c,d)=>new t.resourceTimeRangeModelClass({id:`r${e.id}i${d}`,iconCls:c.iconCls||e.effectiveCalendar.iconCls||"",cls:`${e.effectiveCalendar.cls||""} ${c.cls||""}`,startDate:c.startDate,endDate:c.endDate,name:c.name||"",resourceId:e.id,isNonWorking:!0}));i.set(e.id,l)}r.push(...i.get(e.id))}return r}shouldInclude({isNonWorking:e}){return e}resolveResourceNonWorkingTimeInterval(e){var r;return(r=e==null?void 0:e.closest(".b-sch-resourcenonworkingtime"))==null?void 0:r.elementData.eventRecord}};R(va,"$name","ResourceNonWorkingTime"),R(va,"configurable",{rangeCls:"b-sch-resourcenonworkingtime",maxTimeAxisUnit:"hour",enableMouseEvents:!1,resourceTimeRangeModelClass:Sr,entityName:"resourceNonWorkingTime"}),va.featureClass="",va._$name="ResourceNonWorkingTime",z.registerFeature(va,!1,"SchedulerPro");var nv=e=>class extends(e||Ae(F)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}get widgetClass(){}},M_={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ConstraintTypePicker:{none:"None",muststarton:"Must start on",mustfinishon:"Must finish on",startnoearlierthan:"Start no earlier than",startnolaterthan:"Start no later than",finishnoearlierthan:"Finish no earlier than",finishnolaterthan:"Finish no later than"},CalendarField:{"Default calendar":"Default calendar"},TaskEditorBase:{Information:"Information",Save:"Save",Cancel:"Cancel",Delete:"Delete",calculateMask:"Calculating...",saveError:"Can't save, please correct errors first",repeatingInfo:"Viewing a repeating event",editRepeating:"Edit"},TaskEdit:{"Edit task":"Edit task",ConfirmDeletionTitle:"Confirm deletion",ConfirmDeletionMessage:"Are you sure you want to delete the event?"},GanttTaskEditor:{editorWidth:"44em"},SchedulerTaskEditor:{editorWidth:"34em"},SchedulerGeneralTab:{labelWidth:"6em",General:"General",Name:"Name",Resources:"Resources","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Preamble:"Preamble",Postamble:"Postamble"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},SchedulerAdvancedTab:{labelWidth:"13em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint",Rollup:"Rollup",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag",cyclicDependency:"Cyclic dependency",invalidDependency:"Invalid dependency"},NotesTab:{Notes:"Notes"},ResourcesTab:{unitsTpl:({value:e})=>`${e}%`,Resources:"Resources",Resource:"Resource",Units:"Units"},RecurrenceTab:{title:"Repeat"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"},ResourceHistogram:{barTipInRange:'<b>{resource}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',barTipOnDate:'<b>{resource}</b> on {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',groupBarTipAssignment:'<b>{resource}</b> - <span class="{cls}">{allocated} of {available}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more"},ResourceUtilization:{barTipInRange:'<b>{event}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated}</span> allocated',barTipOnDate:'<b>{event}</b> on {startDate}<br><span class="{cls}">{allocated}</span> allocated',groupBarTipAssignment:'<b>{event}</b> - <span class="{cls}">{allocated}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more",nameColumnText:"Resource / Event"},SchedulingIssueResolutionPopup:{"Cancel changes":"Cancel the change and do nothing",schedulingConflict:"Scheduling conflict",emptyCalendar:"Calendar configuration error",cycle:"Scheduling cycle",Apply:"Apply"},CycleResolutionPopup:{dependencyLabel:"Please select a dependency:",invalidDependencyLabel:"There are invalid dependencies involved that need to be addressed:"},DependencyEdit:{Active:"Active"},SchedulerProBase:{propagating:"Calculating project",storePopulation:"Loading data",finalizing:"Finalizing results"},EventSegments:{splitEvent:"Split event",renameSegment:"Rename"},NestedEvents:{deNestingNotAllowed:"De-nesting not allowed",nestingNotAllowed:"Nesting not allowed"},VersionGrid:{compare:"Compare",description:"Description",occurredAt:"Occurred At",rename:"Rename",restore:"Restore",stopComparing:"Stop Comparing"},Versions:{entityNames:{TaskModel:"task",AssignmentModel:"assignment",DependencyModel:"link",ProjectModel:"project",ResourceModel:"resource",other:"object"},entityNamesPlural:{TaskModel:"tasks",AssignmentModel:"assignments",DependencyModel:"links",ProjectModel:"projects",ResourceModel:"resources",other:"objects"},transactionDescriptions:{update:"Changed {n} {entities}",add:"Added {n} {entities}",remove:"Removed {n} {entities}",move:"Moved {n} {entities}",mixed:"Changed {n} {entities}"},addEntity:"Added {type} **{name}**",removeEntity:"Removed {type} **{name}**",updateEntity:"Changed {type} **{name}**",moveEntity:"Moved {type} **{name}** from {from} to {to}",addDependency:"Added link from **{from}** to **{to}**",removeDependency:"Removed link from **{from}** to **{to}**",updateDependency:"Edited link from **{from}** to **{to}**",addAssignment:"Assigned **{resource}** to **{event}**",removeAssignment:"Removed assignment of **{resource}** from **{event}**",updateAssignment:"Edited assignment of **{resource}** to **{event}**",noChanges:"No changes",nullValue:"none",versionDateFormat:"M/D/YYYY h:mm a",undid:"Undid changes",redid:"Redid changes",editedTask:"Edited task properties",deletedTask:"Deleted a task",movedTask:"Moved a task",movedTasks:"Moved tasks"}},Pk=ct.publishLocale(M_),Pl=class extends st.mixin(nv){static get $name(){return"TaskEditorBase"}static get type(){return"taskeditorbase"}static get configurable(){return{localizableProperties:["width"],title:"L{Information}",cls:"b-schedulerpro-taskeditor",closable:!0,layout:"fit",draggable:{handleSelector:":not(button,.b-field-inner)"},items:null,bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{text:"L{Save}",color:"b-blue",cls:"b-raised",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}},strips:{occurrenceInfoToolbar:{cls:"occurrence-info-toolbar",hidden:!0,ignoreParentReadOnly:!0,items:[{type:"widget",tag:"i",cls:"b-icon b-icon-locked"},{ref:"occurrenceInfoText",type:"label",localeClass:this,text:"L{repeatingInfo}"},"->",{ref:"editOccurrenceButton",localeClass:this,text:"L{editRepeating}",onClick:"up.onEditOccurrenceClick"}]}},width:{$config:{localeKey:"L{editorWidth}"}}}}static get defaultConfig(){return{axisLock:"flexible",autoClose:!0,onChange:null,onCancel:null,onSave:null,autoShow:!1,blurAction:"cancel",scrollAction:"realign",durationDisplayPrecision:1,tabPanelItems:null,defaultTabs:null,calculateMask:null,calculateMaskDelay:100,localizableProperties:["calculateMask"],project:null,dependencyIdField:null}}processWidgetConfig(e){var r;if((r=e.type)!=null&&r.includes("date")&&e.weekStartDay==null&&(e.weekStartDay=this.weekStartDay),e.ref==="tabs"&&this.extraItems){const t={};for(const i in this.extraItems){const n=i.replace("tab","Tab");t[n]={items:Array.isArray(this.extraItems[i])?T.transformArrayToNamedObject(this.extraItems[i]):this.extraItems[i]}}T.merge(e.items,t)}return e}changeItems(e){const{tabPanelItems:r={}}=this,t=T.clone(e),i=t.find(n=>n.ref==="tabs");return this.cleanItemsConfig(r),T.merge(i.items,r),super.changeItems(t)}cleanItemsConfig(e){for(const r in e){const t=e[r];t===!0?delete e[r]:t!=null&&t.items&&this.cleanItemsConfig(t.items)}}afterConfigure(){var e;const r=this,{widgetMap:t}=r,{tabs:i}=t,{cancelButton:n,deleteButton:s,saveButton:a}=((e=r.bbar)==null?void 0:e.widgetMap)||{};a==null||a.ion({click:"onSaveClick",thisObj:r}),n==null||n.ion({click:"onCancelClick",thisObj:r}),s==null||s.ion({click:"onDeleteClick",thisObj:r}),Object.values(t).forEach(o=>{o.isDurationField?o.decimalPrecision=this.durationDisplayPrecision:o.ref==="startDate"||o.ref==="endDate"?o.project=this.project:(o.ref==="predecessorsTab"||o.ref==="successorsTab")&&(o.grid.durationDisplayPrecision=this.durationDisplayPrecision,o.dependencyIdField=o.dependencyIdField||r.dependencyIdField),o.isReadyStatePropagator&&o.ion({readyStateChange:"onReadyStateChange",thisObj:r})}),i.onFieldChange=({source:o})=>{const{name:l,isValid:c,value:d}=o;r.loadedRecord&&l&&c&&!r.isLoadingEvent&&!o.up("recurrenceeditorpanel")&&(r.loadedRecord[l]=d)}}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach(r=>{r.isReadyStatePropagator&&(e=e&&r.canSave)}),e}async hide(){const e=this;e.detachListeners("project"),e.detachListeners("eventStore"),e._delayedAction=null;const r=await super.hide(this.element.matches(":focus-within"));return e.isDestroyed||e.trigger(e.blurAction),r}toggleFieldsDisabled(e){this.eachWidget(r=>{r.isField&&r.name&&!r.up("recurrenceeditorpanel")&&e.isEditable(r.name)!==void 0&&(r.disabled=!e.isEditable(r.name))})}loadEvent(e,r=!1){var t;const i=this,n=(t=i.project)!=null?t:e.project;i.isLoadingEvent=!0,i.widgetMap.occurrenceInfoToolbar.hidden=!e.isOccurrence&&!e.isRecurring||i.editingRecurring,i.toggleFieldsDisabled(e),i.callWidgetHook("loadEvent",e,r),i.detachListeners("project"),i.loadedRecord=e,n.ion({name:"project",beforeCommit:"onProjectBeforeCommit",dataReady:"onProjectDataReady",thisObj:i}),i.detachListeners("eventStore"),n.eventStore.ion({name:"eventStore",remove:"onTaskRemove",thisObj:i}),i.isLoadingEvent=!1,i.trigger("loadEvent")}callWidgetHook(e,...r){this.eachWidget(t=>{typeof t[e]=="function"&&t[e](...r)})}onDocumentMouseDown(e){const r=this,t=Object.values(r.widgetMap).some(n=>n._activeCellEdit);let i=null;if(t){const{event:n}=e,{saveButton:s,cancelButton:a,deleteButton:o}=r.widgetMap,l=n.target.closest("button");if(l)switch(l){case(s==null?void 0:s.element):i=r.onSaveClick;break;case(a==null?void 0:a.element):i=r.onCancelClick;break;case(o==null?void 0:o.element):i=r.onDeleteClick;break}}r._delayedAction=i,super.onDocumentMouseDown(e)}onSaveClick(){const e=this;e._delayedAction=null,e.canSave?e.trigger("save"):At.show({rootElement:e.rootElement,html:e.L("L{saveError}")})}onCancelClick(){this.close()}onDeleteClick(){this._delayedAction=null,this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:r}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(r?(e.tab.element.classList.remove("b-invalid"),e.tab.icon=null,e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.tab.element.classList.add("b-invalid"),e.tab.icon="b-icon-warning",e.title=e.couldSaveTitle))}onTaskRemove(){this.afterDelete()}onProjectBeforeCommit(){this.calculateMask&&this.mask({text:this.calculateMask,showDelay:this.calculateMaskDelay})}onProjectDataReady({records:e}){var r;const t=this;t.calculateMask&&t.unmask(),e.has(t.loadedRecord)&&t.callWidgetHook("afterProjectChange"),(r=t._delayedAction)==null||r.call(t)}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.loadedRecord=void 0,this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.loadedRecord=void 0,this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.loadedRecord=void 0,this.callWidgetHook("afterDelete")}onInternalKeyDown(e){if(!e.handled&&e.key==="Enter"&&this.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"){if(e.target.matches("input")){const r=$.fromElement(e.target);r!=null&&r.internalOnChange&&!r.isCheckbox&&!r.isSlider&&r.internalOnChange()}e.preventDefault(),this.onSaveClick()}super.onInternalKeyDown(e)}onEditOccurrenceClick(){const e=this;$.create({type:"recurrenceconfirmation",owner:e}).confirm({actionType:"update",eventRecord:e.loadedRecord,changerFn:t=>{var i;const n=(i=t.recurringTimeSpan)!=null?i:t;e.resetRecurrenceData={recurringTimeSpan:n,originalExceptionDates:{...n.exceptionDates}},t.isRecurring||(t.convertToRealEvent({startDate:t.startDate}),t.constraintDate=null)},finalizerFn:t=>{t.isRecurring&&(e.editingRecurring=!0,e.readOnly=!1),e.loadEvent(t)}})}updateReadOnly(e){const{deleteButton:r,saveButton:t,cancelButton:i,tabs:n}=this.widgetMap,{items:s}=n;super.updateReadOnly(e),r&&(r.hidden=e),t&&(t.hidden=e),i&&(i.hidden=e);for(let a=0,{length:o}=s;a<o;a++)s[a].readOnly=e}};Pl.initClass(),Pl._$name="TaskEditorBase";var nx=e=>class extends(e||yt){get project(){var t,i,n;return(n=(t=this.up(s=>s.isTaskEditorBase))==null?void 0:t.project)!=null?n:(i=this.record)==null?void 0:i.project}loadEvent(t,i){this.setRecord(t,i)}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}get widgetClass(){}},ya=class extends yt.mixin(nx,nv){static get $name(){return"EditorTab"}static get type(){return"editortab"}static get configurable(){return{title:null,strictRecordMapping:!0}}};ya._$name="EditorTab";var Ii=class extends ya{static get $name(){return"FormTab"}static get type(){return"formtab"}static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},autoUpdateRecord:!0}}onFieldChange({source:e,valid:r,userAction:t}){t&&(r=r!==void 0?r:typeof e.isValid=="function"?e.isValid():e.isValid,r&&super.onFieldChange(...arguments))}};Ii.initClass(),Ii._$name="FormTab";var P_=new Date(2300,0,1),sv=class extends us{static get $name(){return"StartDateField"}static get type(){return"startdatefield"}static get alias(){return"startdate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0,minDateDelta:"-10 years",maxDateDelta:"200 years"}}get calendarProvider(){var e,r;return((r=(e=this.eventRecord)==null?void 0:e.recurringEvent)!=null?r:this.eventRecord)||this.project}get backShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit)}get forwardShiftDate(){const e=this;let r=e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit);return r=r&&e.calendarProvider.run("skipNonWorkingTime",r,!0),r}transformTimeValue(e){const{calendarProvider:r,keepTime:t}=this;if(r&&t!=="entered"){const i=b.clearTime(e),n=r.run("skipNonWorkingTime",i);if(b.isValidDate(n)&&b.isEqual(n,i,"day"))return b.copyTimeValues(i,n)}return super.transformTimeValue(e)}get min(){var e;return super.min||(e=this.project)!=null&&e.startDate?b.add(this.project.startDate,this.minDateDelta):null}set min(e){super.min=e}get max(){var e;return super.max||(e=this.project)!=null&&e.startDate?b.add(this.project.startDate,this.maxDateDelta):P_}set max(e){super.max=e}};sv.initClass(),sv._$name="StartDateField";var I_=new Date(2300,0,1),av=class extends us{static get $name(){return"EndDateField"}static get type(){return"enddatefield"}static get alias(){return"enddate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0}}get min(){var e;let r=this._min;const t=(e=this.eventRecord)==null?void 0:e.startDate;return t&&(r=b.max(r||t,t)),r}set min(e){super.min=e}get max(){var e;return super.max||(e=this.project)!=null&&e.startDate?b.add(this.project.startDate,200,"year"):I_}set max(e){super.max=e}get calendarProvider(){var e,r;return((r=(e=this.eventRecord)==null?void 0:e.recurringEvent)!=null?r:this.eventRecord)||this.project}get backShiftDate(){const e=this;let r=e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit);return r=r&&e.calendarProvider.run("skipNonWorkingTime",r,!1),r}get forwardShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit)}transformTimeValue(e){const{calendarProvider:r,keepTime:t}=this;if(r&&t!=="entered"){const i=b.clearTime(e),n=b.add(i,1,"day"),s=r.run("skipNonWorkingTime",n,!1);if(b.isValidDate(s)&&b.isEqual(s,i,"day"))return b.copyTimeValues(i,s)}return!t&&e&&this.min&&b.clearTime(e,!1)<this.min?this.min:super.transformTimeValue(e)}};av.initClass(),av._$name="EndDateField";var ov=class extends no{static get $name(){return"EffortField"}static get type(){return"effort"}static get alias(){return"effortfield"}};ov.initClass(),ov._$name="EffortField";var lv=class extends Ii{static get $name(){return"GeneralTab"}static get type(){return"generaltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this},items:{name:{type:"text",weight:100,required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name"},percentDone:{type:"number",weight:200,label:"L{% complete}",name:"renderedPercentDone",cls:"b-percent-done b-inline",flex:"1 0 50%",min:0,max:100},effort:{type:"effort",weight:300,label:"L{Effort}",name:"fullEffort",flex:"1 0 50%"},divider:{html:"",weight:400,dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},startDate:{type:"startdate",weight:500,label:"L{Start}",name:"startDate",cls:"b-start-date b-inline",flex:"1 0 50%"},endDate:{type:"enddate",weight:600,label:"L{Finish}",name:"endDate",cls:"b-end-date b-last-row",flex:"1 0 50%"},duration:{type:"durationfield",weight:700,label:"L{Duration}",name:"fullDuration",flex:".5 0",cls:"b-inline"}}}}loadEvent(e){const r={unit:e.durationUnit,magnitude:1},{startDate:t,endDate:i,effort:n}=this.widgetMap;t&&(t.step=r,t.eventRecord=e),i&&(i.step=r,i.eventRecord=e),n&&(n.unit=e.effortUnit),super.loadEvent(e)}};lv.initClass(),lv._$name="GeneralTab";var sx=e=>e.map((r,t)=>[t,r]),cv=class extends qe{static get $name(){return"DependencyTypePicker"}static get type(){return"dependencytypepicker"}construct(e){super.construct(e),He.ion({locale:()=>{this.items=sx(this.L("L{DependencyType.long}"))},thisObj:this})}get store(){return this._items||(this.items=this._items=sx(this.L("L{DependencyType.long}"))),super.store}set store(e){super.store=e}};cv.initClass(),cv._$name="DependencyTypePicker";var A_=(e,r)=>{e.instanceMeta(r).valid=!0},ax=(e,r)=>{e.instanceMeta(r).valid=!1},dv=(e,r)=>e.instanceMeta(r).valid!==!1,xu=class extends ya{static get $name(){return"DependencyTab"}static get type(){return"dependencytab"}static get configurable(){return{dependencyIdField:null,layoutStyle:{flexFlow:"column nowrap"},sortField:null,taskComboSortField:"name",items:{grid:{type:"grid",weight:100,flex:"1 1 auto",emptyText:"",asyncEventSuffix:"PreCommit",disableGridRowModelWarning:!0,features:{group:!1},columns:{data:{id:{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,hidden:!0,sortable(e,r){var t,i;const{dependencyIdField:n,direction:s}=this.grid.parent,a=(t=e[s])==null?void 0:t[n],o=(i=r[s])==null?void 0:i[n];return a===o?0:a<o?-1:1},renderer:({record:e,row:r,grid:t,column:i})=>{let n;const{direction:s}=t.parent,a=e[s];if(a&&dv(e,t)){const o=t.parent.dependencyIdField,l=a[o];o==="id"?n=!a||a.hasGeneratedId?"*":a.id:n=l}else r.addCls("b-invalid"),n='<div class="b-icon b-icon-warning"></div>';return n}},name:{localeClass:this,text:"L{Name}",flex:5,renderer:({value:e,grid:r,cellElement:t})=>{if(e){t.classList.toggle("b-inactive",e.inactive);const i=e[r.parent.dependencyIdField];return e.name+(i!=null&&!e.hasGeneratedId?` (${i})`:"")}return""},finalizeCellEdit:"up.finalizeLinkedTaskCellEdit",editor:{type:"modelcombo",displayField:"name",valueField:"id",filterOperator:"*",allowInvalid:!0,listItemTpl(e){const r=this,t=r._dependencyTab||(r._dependencyTab=r.up("dependencytab",!0)),{dependencyIdField:i}=t,n=e.hasGeneratedId&&i==="id"?null:e[i];return L.xss`${e.name}${n!=null?` (${n})`:""}`}}},type:{localeClass:this,text:"L{Type}",field:"type",flex:3,sortable:!1,editor:"dependencytypepicker",renderer({value:e}){return this.L("L{DependencyType.long}")[e]}},lag:{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}}}},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add",onAction:"up.onAddClick"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,onAction:"up.onRemoveClick"}}}}}}async finalizeLinkedTaskCellEdit({grid:e,value:r,record:t}){const{project:i}=e.store.masterStore,n=this.direction==="toEvent",s=n?t.fromEvent:r,a=n?r:t.toEvent;switch(await i.validateDependency(s,a,t.type,t)){case zr.NoError:return!0;case zr.CyclicDependency:return"L{DependencyTab.cyclicDependency}"}return"L{DependencyTab.invalidDependency}"}afterConstruct(){super.afterConstruct(),(this.grid=this.widgetMap.grid).ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:this})}get taskCombo(){const{grid:e}=this,r=e==null?void 0:e.columns.get(this.direction);return r==null?void 0:r.editor}loadEvent(e){const r=this,{grid:t,taskCombo:i,record:n}=r;super.loadEvent(e);const{dependencyStore:s,eventStore:a}=r.project,o=t.store.masterStore!==s,l=!o&&e!==n;if(o){r.depStoreGeneration=s.storage.generation,r.eventStoreGeneration=a.storage.generation,r.detachListeners("taskCombo"),t.store=s.chain(d=>d[r.negDirection]===r.record,null);const c=i.store=a.chain(d=>d!==r.record,null,{doRelayToMaster:[],excludeCollapsedRecords:!1});c.sort(r.taskComboSortField),c.filterBy(d=>!t.store.find(u=>{const h=u[r.direction],f=r._activeCellEdit,g=f&&h===f.record[r.direction];return h===d&&!g})),i.ion({name:"taskCombo",change:"onGridCellEditChange",thisObj:r})}else l||s.storage.generation!==r.depStoreGeneration?(t.store.fillFromMaster(),r.depStoreGeneration=s.storage.generation):t.refreshRows(),(l||a.storage.generation!==r.eventStoreGeneration)&&(i.store.fillFromMaster(),r.eventStoreGeneration=a.storage.generation);l&&t.store.sort(r.sortField),r.requestReadyStateChange()}async insertNewDependency(){const e=this,{grid:r}=e,{cellEdit:t}=r.features;t.isEditing&&!t.editor.isValid&&t.cancelEditing();const[i]=r.store.insert(0,{[e.negDirection]:e.record});return e.depStoreGeneration=e.project.dependencyStore.storage.generation,await r.features.cellEdit.startEditing({field:e.direction,id:i.id}),ax(i,r),i}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,{grid:r}=e,t=r.selectedRecords;r.features.cellEdit.cancelEditing(!0),e.project.dependencyStore.remove(t),r.selectedRecord=r.store.getNext(t[0]),e.taskCombo.store.fillFromMaster()}onGridSelectionChange({selection:e}){const r=this.widgetMap.remove,t=!!(!(e!=null&&e.length)||this.up(i=>i.readOnly));r.containsFocus&&t&&this.grid.focusCell({rowIndex:-1,columnIndex:0}),r.disabled=t}clearActiveEditorErrors(){const e=this._activeCellEdit;e&&e.column.field===this.direction&&e.editor.inputField.clearError()}onGridCellEditChange(){this.clearActiveEditorErrors()}onGridStartCellEdit({editorContext:e}){const r=this,t=r._editingDependency=e.record,{grid:i,direction:n}=r;r._activeCellEdit=e,e.column.field===n&&(dv(t,i)?r.clearActiveEditorErrors():t[n]?e.editor.inputField.setError("L{DependencyTab.cyclicDependency}"):e.editor.inputField.setError("L{DependencyTab.invalidDependency}"))}async onGridFinishCellEdit({editorContext:e}){const r=this,{record:t,column:i}=e,{grid:n,direction:s}=r;i.field===s?(A_(t,n),r.taskCombo.store.fillFromMaster()):r.redrawDependencyRow(t),r._activeCellEdit=r._editingDependency=null,r.requestReadyStateChange()}afterCancel(){this._activeCellEdit&&this.grid.features.cellEdit.cancelEditing(!0)}onGridCancelCellEdit(){const e=this,r=e._editingDependency;r&&(r[e.direction]||(ax(r,e.grid),e.redrawDependencyRow(r)),e._activeCellEdit=e._editingDependency=null),e.requestReadyStateChange()}redrawDependencyRow(e){const{grid:r}=this,t=r.rowManager.getRowById(e);t&&r.store.indexOf(e)>=0&&t.render(r.store.indexOf(e),e)}get canSave(){const{grid:e}=this;return e.store.every(r=>dv(r,e))}updateReadOnly(e){const{add:r,remove:t}=this.widgetMap;super.updateReadOnly(...arguments),r.hidden=t.hidden=e}};xu._$name="DependencyTab";var uv=class extends xu{static get $name(){return"SuccessorsTab"}static get type(){return"successorstab"}static get configurable(){return{cls:"b-successors-tab",direction:"toEvent",negDirection:"fromEvent",title:"L{DependencyTab.Successors}",sortField:"toEventName",items:{grid:{columns:{data:{name:{field:"toEvent"}}}}}}}};uv.initClass(),uv._$name="SuccessorsTab";var hv=class extends xu{static get $name(){return"PredecessorsTab"}static get type(){return"predecessorstab"}static get configurable(){return{cls:"b-predecessors-tab",direction:"fromEvent",negDirection:"toEvent",title:"L{DependencyTab.Predecessors}",sortField:"fromEventName",items:{grid:{columns:{data:{name:{field:"fromEvent"}}}}}}}};hv.initClass(),hv._$name="PredecessorsTab";var fv=class extends ya{static get $name(){return"ResourcesTab"}static get type(){return"resourcestab"}static get configurable(){return{title:"L{Resources}",cls:"b-resources-tab",layoutStyle:{flexFlow:"column nowrap"},showUnits:null,items:{grid:{type:"grid",weight:100,flex:"1 1 auto",columns:{data:{resource:{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>(e==null?void 0:e.name)||"",editor:{type:"modelcombo",displayField:"name",valueField:"id"}},units:{type:"number",localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("L{unitsTpl}",e),min:0,max:100,step:10}}},disableGridRowModelWarning:!0,asyncEventSuffix:"PreCommit"},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"b-icon b-icon-add"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0}}}}}}afterConstruct(){super.afterConstruct();const e=this,r=e.addButton=e.widgetMap.add,t=e.removeButton=e.widgetMap.remove,i=e.grid=e.widgetMap.grid;r==null||r.ion({click:"onAddClick",thisObj:e}),t==null||t.ion({click:"onRemoveClick",thisObj:e}),i.ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:e})}updateReadOnly(e){const{add:r,remove:t}=this.widgetMap;super.updateReadOnly(...arguments),r.hidden=t.hidden=e}get resourceCombo(){var e;const r=(e=this.grid)==null?void 0:e.columns.get("resource");return r==null?void 0:r.editor}updateShowUnits(e){const r=this.widgetMap.grid.columns.get("units");r&&(r.hidden=!e)}loadEvent(e){const r=this,{resourceCombo:t,grid:i,record:n}=r;super.loadEvent(e);const{assignmentStore:s,resourceStore:a}=r.project,o=i.store.masterStore!==s,l=!o&&e!==n;typeof this.showUnits!="boolean"&&(i.columns.get("units").hidden=!e.isTask),o?(r.assignmentStoreGeneration=s.storage.generation,r.resourceStoreGeneration=a.storage.generation,i.store=s.chain(c=>r.record&&c.event===r.record,null),t.store=a.chain(c=>!c.isSpecialRow&&r.record&&!r.record.isAssignedTo(c)||!r.activeAssignment||r.activeAssignment.resource===c,null,{groupers:a.groupers})):((l||s.storage.generation!==r.assignmentStoreGeneration)&&i.store.fillFromMaster(),(l||a.storage.generation!==r.resourceStoreGeneration)&&t.store.fillFromMaster())}get activeAssignment(){return this.grid.features.cellEdit.activeRecord}async insertNewAssignment(){const e=this,{project:r,grid:t}=e,i=r.assignmentStore,[n]=i.insert(0,{event:e.record,resource:null,units:100});return e.assignmentStoreGeneration=i.storage.generation,await t.features.cellEdit.startEditing({field:"resource",id:n.id}),n}beforeSave(){this.pruneInvalidAssignments()}onAddClick(){this.insertNewAssignment()}onRemoveClick(){const e=this,{grid:r}=e;r.store.remove(r.selectedRecords),r.selectedRecords=null,e.removeButton.disable()}onGridSelectionChange({selection:e}){const{removeButton:r}=this,t=!(e!=null&&e.length)||this.up(i=>i.readOnly);r.containsFocus&&t&&this.grid.focus(),r.disabled=t}onGridStartCellEdit({editorContext:e}){e.column.field==="resource"&&(this.resourceCombo.store.fillFromMaster(),this._editingAssignment=e.record,this._activeCellEdit=e)}onGridFinishCellEdit(){this._activeCellEdit=this._editingAssignment=null}onGridCancelCellEdit(){this._activeCellEdit=this._editingAssignment=null}pruneInvalidAssignments(){const{store:e}=this.grid;e.remove(e.query(r=>!r.isValid))}};fv.initClass(),fv._$name="ResourcesTab";var gv=class extends qe{static get $name(){return"ConstraintTypePicker"}static get type(){return"constrainttypepicker"}static get configurable(){return{valueField:"id"}}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}buildStoreData(){const e=this;return[{id:"none",text:e.L("L{none}")},{id:"muststarton",text:e.L("L{muststarton}")},{id:"mustfinishon",text:e.L("L{mustfinishon}")},{id:"startnoearlierthan",text:e.L("L{startnoearlierthan}")},{id:"startnolaterthan",text:e.L("L{startnolaterthan}")},{id:"finishnoearlierthan",text:e.L("L{finishnoearlierthan}")},{id:"finishnolaterthan",text:e.L("L{finishnolaterthan}")}]}set value(e){super.value=e}get value(){const e=super.value;return e==="none"?null:e}get store(){return this._store||(this.store=new ee({data:this.buildStoreData(),allowNullId:!0})),this._store}set store(e){super.store=e}};gv.initClass(),gv._$name="ConstraintTypePicker";var mv=class extends qe{static get $name(){return"SchedulingModePicker"}static get type(){return"schedulingmodecombo"}static get configurable(){return{allowedModes:null,store:{data:this.defaultStoreData}}}static get defaultStoreData(){return[{id:je.Normal,text:this.L("L{Normal}")},{id:je.FixedDuration,text:this.L("L{Fixed Duration}")},{id:je.FixedUnits,text:this.L("L{Fixed Units}")},{id:je.FixedEffort,text:this.L("L{Fixed Effort}")}]}changeAllowedModes(e){return typeof e=="string"?e.split(","):e}updateAllowedModes(e){this._allowedModes=e,e?this.store.addFilter({id:"allowed-mode-filter",filterBy:r=>this._allowedModes.includes(r.id)}):this.store.removeFilter("allowed-mode-filter")}updateLocalization(){super.updateLocalization(),this.store.data=this.constructor.defaultStoreData}};mv.initClass(),mv._$name="SchedulingModePicker";var pv=class extends Ii{static get $name(){return"AdvancedTab"}static get type(){return"advancedtab"}static get defaultConfig(){const e={flex:"0 0 64%",labelWidth:"30%",cls:"b-inline"},r={flex:"0 0 34%",labelWidth:"80%"};return{localeClass:this,title:"L{Advanced}",cls:"b-advanced-tab",defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",weight:100,ref:"",name:"calendar",label:"L{Calendar}",...e},ignoreResourceCalendarField:{type:"checkbox",weight:100,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-ignore-resource-calendar",...r},schedulingModeField:{type:"schedulingmodecombo",weight:300,name:"schedulingMode",label:"L{Scheduling mode}",...e},effortDrivenField:{type:"checkbox",weight:400,name:"effortDriven",label:"L{Effort driven}",...r},divider:{weight:500,html:"",dataset:{text:this.L("L{Constraint}")},cls:"b-divider",flex:"1 0 100%"},constraintTypeField:{type:"constrainttypepicker",weight:600,name:"constraintType",label:"L{Constraint type}",clearable:!0,...e},rollupField:{type:"checkbox",weight:700,name:"rollup",label:"L{Rollup}",...r},constraintDateField:{type:"date",weight:800,name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",...e},inactiveField:{type:"checkbox",weight:900,name:"inactive",label:"L{Inactive}",...r},manuallyScheduledField:{type:"checkbox",weight:1e3,name:"manuallyScheduled",label:"L{Manually scheduled}",cls:"b-last-row",style:"margin-left:auto",...r}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get rollupField(){return this.widgetMap.rollupField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const r=this,{calendarField:t,constraintTypeField:i}=r,{calendarManagerStore:n}=e.project,s=(t==null?void 0:t.store)!==n;if(t&&s&&(t.store=n.chain(void 0,void 0,{excludeCollapsedRecords:!1})),i!=null&&i.isConstraintTypePicker){const{store:a}=i;a.removeFilter("constraintTypeApplicable"),a.filter({id:"constraintTypeApplicable",filterBy:o=>e.run("isConstraintTypeApplicable",o.id)})}super.loadEvent(e)}afterDelete(){const{constraintTypeField:e}=this;e!=null&&e.isConstraintTypePicker&&e.store.removeFilter("constraintTypeApplicable"),super.afterDelete(...arguments)}};pv.initClass(),pv._$name="AdvancedTab";var vv=class extends Ii{static get $name(){return"NotesTab"}static get type(){return"notestab"}static get configurable(){return{cls:"b-notes-tab",title:this.L("L{Notes}"),tab:{icon:"b-icon-note",titleProperty:"tooltip"},layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:{noteField:{weight:100,type:"textfield",inputAttributes:{tag:"textarea"},cls:"b-taskeditor-notes-field",name:"note"}}}}};vv.initClass(),vv._$name="NotesTab";var yv=class extends Pl{static get type(){return"gantttaskeditor"}static get $name(){return"GanttTaskEditor"}static get defaultConfig(){return{items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},defaults:{scrollable:{overflowY:!0}},items:{generalTab:{type:"generaltab",weight:100},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},resourcesTab:{type:"resourcestab",weight:400},advancedTab:{type:"advancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}};yv.initClass(),yv._$name="GanttTaskEditor";var bv=class extends Ii{static get $name(){return"SchedulerGeneralTab"}static get type(){return"schedulergeneraltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this,weight:10},items:{nameField:{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name",weight:100},resourcesField:{type:"combo",label:"L{Resources}",name:"resources",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,cls:"b-resources",weight:200},startDateField:{type:"datetime",label:"L{Start}",name:"startDate",cls:"b-start-date",flex:"1 0 100%",weight:300,dateField:{type:"startdatefield"}},endDateField:{type:"datetime",label:"L{Finish}",name:"endDate",cls:"b-end-date",flex:"1 0 100%",weight:400,dateField:{type:"enddatefield"}},durationField:{type:"durationfield",label:"L{Duration}",name:"fullDuration",flex:"1 0 50%",cls:"b-inline",min:0,weight:500},percentDoneField:{type:"number",label:"L{% complete}",name:"renderedPercentDone",flex:"1 0 50%",min:0,max:100,weight:600},effortField:{type:"durationfield",label:"L{Effort}",name:"fullEffort",weight:620},preambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:650,label:"L{SchedulerGeneralTab.Preamble}",name:"preamble",flex:"1 0 50%",cls:"b-inline"},postambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:660,label:"L{SchedulerGeneralTab.Postamble}",name:"postamble",flex:"1 0 50%"}}}}loadEvent(e){var r;const t=this,{project:i}=t,n={unit:e.durationUnit,magnitude:1},{isParent:s}=e,{durationField:a,percentDoneField:o,startDateField:l,endDateField:c,resourcesField:d}=t.widgetMap,u=(d==null?void 0:d.store.masterStore)!==i.resourceStore;a&&(a.disabled=s,o||a.element.classList.remove("b-inline")),o&&(o.disabled=s),l&&(l.dateField.eventRecord=e,b.compareUnits(n.unit,"hour")>0?l.dateField.step=n:l.timeField.step=n),c&&(c.dateField.eventRecord=e,b.compareUnits(n.unit,"hour")>0?c.dateField.step=n:c.timeField.step=n,c.disabled=s),d&&(d.multiSelect=(r=d.config.multiSelect)!=null?r:!i.eventStore.usesSingleAssignment,u&&(d.store=i.resourceStore.chain(h=>!h.isSpecialRow))),super.loadEvent(...arguments)}onFieldChange({source:e,valid:r,userAction:t,value:i}){if(t&&r){const{eventStore:n}=this.record,s=e.name==="resources"&&i.length===0&&this.autoUpdateRecord&&n.removeUnassignedEvent;s&&(n.removeUnassignedEvent=!1),super.onFieldChange(...arguments),s&&(n.removeUnassignedEvent=!0)}}beforeSave(){this.record.resources.length===0&&this.record.eventStore.removeUnassignedEvent&&this.record.remove(),super.beforeSave()}};bv.initClass(),bv._$name="SchedulerGeneralTab";var ba=class extends ya{get recurrenceEditor(){return this.widgetMap.recurrenceEditor}loadEvent(e){var r;this.recurrenceEditor&&(this.loadingRecord=!0,this.recurrenceEditor.record=(r=e.recurrence)!=null?r:null,this.loadingRecord=!1),super.loadEvent(e)}onFieldChange({source:e,value:r}){const t=this;if(!t.isConfiguring&&!t.recurrenceEditor.assigningValues&&!t.loadingRecord){const{record:i}=t;i.recurrence?e===t.recurrenceEditor.widgetMap.frequencyField&&r==="NONE"?i.recurrence=null:t.recurrenceEditor.syncEventRecord(i.recurrence):i.recurrence=new i.recurrenceModel({}),t.up(n=>n.isTaskEditorBase).editingRecurring=!0}}};R(ba,"$name","RecurrenceTab"),R(ba,"type","recurrencetab"),R(ba,"configurable",{title:"L{title}",cls:"b-recurrence-tab",scrollable:!0,items:{recurrenceEditor:{type:"recurrenceeditorpanel",addNone:!0}}}),ba.initClass(),ba._$name="RecurrenceTab";var Cv=class extends Ii{static get $name(){return"SchedulerAdvancedTab"}static get type(){return"scheduleradvancedtab"}static get configurable(){return{cls:"b-advanced-tab",tab:{icon:"b-icon-advanced",tooltip:"L{SchedulerAdvancedTab.Advanced}"},defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",name:"calendar",label:"L{Calendar}",weight:100},constraintTypeField:{type:"constrainttypepicker",name:"constraintType",label:"L{Constraint type}",clearable:!0,weight:200},constraintDateField:{type:"date",name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",weight:300},manuallyScheduledField:{type:"checkbox",name:"manuallyScheduled",label:"L{Manually scheduled}",weight:400},schedulingModeField:{type:"schedulingmodecombo",name:"schedulingMode",label:"L{Scheduling mode}",hidden:!0,weight:450,allowedModes:`${je.Normal},${je.FixedDuration}`},effortDrivenField:{type:"checkbox",weight:460,name:"effortDriven",label:"L{Effort driven}",hidden:!0,flex:"1 0 50%"},inactiveField:{type:"checkbox",weight:500,name:"inactive",label:"L{Inactive}"},ignoreResourceCalendarField:{type:"checkbox",weight:600,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",flex:"1 0 50%"}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const r=this,{project:t}=r,i=!r.record,{calendarField:n}=r;n&&(n.store=t.calendarManagerStore,n.hidden=!t.calendarManagerStore.count),super.loadEvent(...arguments)}};Cv.initClass(),Cv._$name="SchedulerAdvancedTab";var __=/(pre|post)amble/,Sv=class extends Pl{static get type(){return"schedulertaskeditor"}static get $name(){return"SchedulerTaskEditor"}static get defaultConfig(){return{enableEventSpanBuffer:!1,items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},defaults:{scrollable:{overflowY:!0}},items:{generalTab:{type:"schedulergeneraltab",weight:100},recurrenceTab:{type:"recurrencetab",weight:150},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},advancedTab:{type:"scheduleradvancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}processWidgetConfig(e){var r,t;return(r=e.ref)!=null&&r.match(__)&&(e.hidden=!this.enableEventSpanBuffer),e.ref==="recurrenceTab"&&(e.hidden=!((t=this.owner)!=null&&t.enableRecurringEvents)),super.processWidgetConfig(e)}onFocusOut({relatedTarget:e}){var r;const t=(r=e==null?void 0:e.closest(".b-sch-event-wrap"))==null?void 0:r.elementData.eventRecord;if(t&&t===this.loadedRecord)this.setTimeout(()=>this.focus(),100);else return super.onFocusOut(...arguments)}};Sv.initClass(),Sv._$name="SchedulerTaskEditor";var Ru=class extends X.mixin(ge,jo){static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}static get defaultConfig(){return{triggerEvent:"eventdblclick",editorClassMap:{[Ci.SchedulerBasic]:"schedulertaskeditor",[Ci.SchedulerPro]:"schedulertaskeditor",[Ci.Gantt]:"gantttaskeditor"},editorClass:null,editorConfig:null,confirmDelete:!0,saveAndCloseOnEnter:!0,blurAction:"cancel",weekStartDay:null,scrollIntoView:!0}}static get configurable(){return{items:null,suspendHasChangesEvent:!1}}construct(e,r){var t;e.taskEdit=this,super.construct(e,T.assign({weekStartDay:e.weekStartDay,enableEventSpanBuffer:(t=e.features.eventBuffer)==null?void 0:t.enabled},r)),e.ion({[this.triggerEvent]:"onActivateEditor",readOnly:"onClientReadOnlyToggle",dragCreateEnd:"onDragCreateEnd",afterEventDrop:"onEventDropped",eventResizeEnd:"onEventResized",thisObj:this})}doDestroy(){var e;this.detachFromProject(),(e=this.editor)==null||e.destroy(),this.deleteConfirmationPromise&&fi.hide(),super.doDestroy()}onClientReadOnlyToggle({readOnly:e}){this.editor&&(this.editor.readOnly=e)}get scheduler(){return this.client}getElementFromTaskRecord(e,r){return this.client.getElementFromEventRecord(e,r)}scrollEventIntoView(e,r){this.client.scrollResourceEventIntoView(r,e)}get isValid(){return this.editor.eachWidget(e=>e.isValid===!0||e.hidden||e.disabled||e.isField&&!e.name?!0:e.isValid!==!1,!0)}get project(){return this.scheduler.project}attachToProject(){this.detachFromProject(),this.project.ion({name:"project",loadstart:()=>this.save(),dataReady:"onDataReady",thisObj:this})}detachFromProject(){this.detachListeners("project")}onDataReady(){const{record:e}=this;e!=null&&e.project&&this.scheduler.taskStore.includes(e)?this.load(e,!0):this.editor.close()}get isEditing(){return!!this._editing}onActivateEditor({eventRecord:e,resourceRecord:r,eventElement:t}){e===this.record&&this.isEditing||this.editEvent(e,r,t)}async editEvent(e,r=null,t=null,i=null){var n;const s=this,{scheduler:a}=s;e=e.isEventSegment?e.event:e;const o=!s.disabled&&!e.readOnly&&!a.project.isDelayingCalculation&&(e.project||!a.usesDisplayStore);if(o&&i&&(i.transferred=!0),s.isEditing&&await s.cancel(),await Promise.all([s._cancelling,s._hiding]).catch(()=>{}),!a.isGanttBase&&!r&&(r=e.resource||((n=e.resources)==null?void 0:n[0])),o){const{taskStore:l}=a;if(s._editing=!0,i?(s.stmInitiallyAutoRecord=i.stmInitiallyAutoRecord,s.stmInitiallyDisabled=i.stmInitiallyDisabled,s.hasStmCapture=!0):s.hasStmCapture||s.captureStm(!0),a.project.suspendAutoSync(),typeof e=="function"&&(e=e()),e=e.$original,!e.isOccurrence&&!l.includes(e)&&!e.isCreating&&(e.isCreating=!0,l.add(e),r&&a.assignmentStore.assignEventToResource(e,r),await a.project.commitAsync(),s.isDestroyed)||s.scrollIntoView&&!a.timeAxisSubGrid.collapsed&&!t&&l.includes(e)&&(r||a.isGantt)&&(await s.scrollEventIntoView(e,r),s.isDestroyed))return;const c=t||C.down(s.getElementFromTaskRecord(e,r),a.eventInnerSelector),d=s.getEditor(e);if(await s.triggerOnClient("beforeTaskEdit",{taskEdit:s,taskRecord:e,taskElement:c})!==!1){if(s.suspendHasChangesEvent&&a.project.suspendChangesTracking(),a.element.classList.add("b-taskeditor-editing"),await a.project.commitAsync(),s.isDestroyed)return;s.load(e),s.triggerOnClient("beforeTaskEditShow",{taskEdit:s,taskRecord:e,taskElement:c,editor:d});const{widgetMap:u}=d,h=e.parent&&!e.parent.isRoot;u.deleteButton&&(u.deleteButton.hidden=a.readOnly||e.isCreating||d.readOnly),a.features.nestedEvents&&(u.predecessorsTab&&(u.predecessorsTab.disabled=h),u.successorsTab&&(u.successorsTab.disabled=h),u.resourcesField&&(u.resourcesField.disabled=h)),s.attachToProject(),d.centered?await d.show():!a.timeAxisSubGrid.collapsed&&c&&(!a.isGanttBase||s.scrollIntoView||k.from(c).intersect(k.from(a.timeAxisSubGridElement)))?await d.showBy({target:c,anchor:!0,offset:-5}):await d.showBy({target:a.element,anchor:!1,align:"c-c",clippedBy:null})}else{if(a.project.resumeAutoSync(),await s.rejectStmTransaction(),s.isDestroyed)return;s.disableStm(),s.freeStm(),s._editing=!1}}}getEditor(e=this.record){var r;const t=this,{client:i}=t;let{editor:n}=t;if(!n){const s=T.merge({clippedBy:[i.timeAxisSubGridElement,i.bodyContainer],eventEditFeature:t,weekStartDay:t.weekStartDay,enableEventSpanBuffer:t.enableEventSpanBuffer,saveAndCloseOnEnter:t.saveAndCloseOnEnter,blurAction:t.blurAction,owner:i,dependencyIdField:((r=t.editorConfig)==null?void 0:r.dependencyIdField)||i.dependencyIdField,project:t.project,durationDisplayPrecision:i.durationDisplayPrecision,tabPanelItems:t.items,internalListeners:{beforeHide:{fn:"onBeforeHide",prio:-1e3},cancel:"onCancel",delete:"onDelete",save:"onSave",thisObj:t},tabsConfig:t.tabsConfig},t.editorConfig);if(t.editorClass&&!s.type)n=t.editor=t.editorClass.new(s);else{const a=(e==null?void 0:e.project)||t.project,o=a.getType();n=t.editor=$.create(Object.assign({type:t.editorClassMap[o]||"schedulertaskeditor"},s))}}return n.readOnly=(i.readOnly||(e==null?void 0:e.isOccurrence)||(e==null?void 0:e.isRecurring))&&!n.editingRecurring,n.project=t.project,n}load(e,r){const t=this,i=t.getEditor(e);t._loading=!0,e.isEventSegment&&(e=e.event),t.record=e,i.loadEvent(e,r),t._loading=!1}async save(){const e=this,{scheduler:r,record:t}=e;if(e.isEditing){const i=e.getEditor();if(!e.isValid||await e.triggerOnClient("beforeTaskSave",{taskRecord:t,editor:i})===!1)return;e.detachFromProject(),i.beforeSave(),t.isCreating=!1,i.resetRecurrenceData=i.editingRecurring=null,e.freeStm(!0),e._editing=!1,await i.close(),r.project.resumeAutoSync(!0),r.element.classList.remove("b-taskeditor-editing"),e.triggerOnClient("afterTaskSave",{taskRecord:t,editor:i}),i.afterSave(),e.suspendHasChangesEvent&&r.project.resumeChangesTracking(),e.triggerOnClient("afterTaskEdit",{taskRecord:t,editor:i})}}async doCancel(){var e,r,t;const i=this,{scheduler:n,record:s}=i;if(i.isEditing){i._editing=!1,i.detachFromProject();const{project:a}=i,o=i.getEditor();if(o.editingRecurring=null,o.beforeCancel(),i.isDestroyed){(e=a.resumeAutoSync)==null||e.call(a,!1);return}if(s!=null&&s.isCreating?s.remove():await i.rejectStmTransaction(),i.isDestroyed){(r=a.resumeAutoSync)==null||r.call(a,!1);return}if(i.disableStm(),await a.commitAsync(),i.isDestroyed){(t=a.resumeAutoSync)==null||t.call(a,!1);return}i.freeStm(),o.afterCancel(),a.resumeAutoSync(!1),n.element.classList.remove("b-taskeditor-editing"),i.trigger("afterTaskEdit"),i.triggerOnClient("taskEditCanceled",{taskRecord:s,editor:o}),i.suspendHasChangesEvent&&a.resumeChangesTracking(),i.triggerOnClient("afterTaskEdit",{taskRecord:s,editor:o})}}async cancel(){const e=this,{editor:r}=e,{resetRecurrenceData:t}=r;return t&&(t.recurringTimeSpan.exceptionDates=t.originalExceptionDates,r.resetRecurrenceData=null),e._cancelling||(e._cancelling=e.doCancel().finally(()=>e._cancelling=void 0))}async delete(){const e=this,{editor:r,scheduler:t,record:i,project:n}=e;!i.isCreating&&await e.triggerOnClient("beforeTaskDelete",{taskRecord:i,editor:r})===!1||(e.detachFromProject(),r.beforeDelete(),i.remove(),e.freeStm(),await n.commitAsync(),n.resumeAutoSync(!i.isCreating),!e.isDestroyed&&(e._editing=!1,r.close(),r.afterDelete(),t.element.classList.remove("b-taskeditor-editing"),e.suspendHasChangesEvent&&t.project.resumeChangesTracking(),e.triggerOnClient("afterTaskEdit",{editor:r,taskRecord:i})))}onSave(){this.requestAnimationFrame(()=>this.save())}onCancel(){this.cancel().then()}async onDelete(){const e=this;if(e.confirmDelete){const{editor:r}=e,t=r.autoClose;r.autoClose=!1,e.deleteConfirmationPromise=fi.confirm({title:"L{TaskEdit.ConfirmDeletionTitle}",message:"L{TaskEdit.ConfirmDeletionMessage}",okButton:"L{TaskEditorBase.Delete}",rootElement:e.rootElement});const i=await e.deleteConfirmationPromise;r.autoClose=t,e.deleteConfirmationPromise=null,i===fi.yesButton&&e.delete()}else e.requestAnimationFrame(()=>e.delete())}onBeforeHide({source:e,animate:r}){e.hideAnimation&&r!==!1&&(this._hiding=new Promise(t=>{e.ion({hideAnimationEnd:t})}).finally(()=>this._hiding=void 0))}onDragCreateEnd({eventRecord:e,resourceRecord:r,proxyElement:t,stmCapture:i}){!this.disabled&&e.isCreating&&this.editEvent(e,r,null,i)}populateEventMenu({eventRecord:e,resourceRecord:r,items:t}){this.scheduler.readOnly||(t.editEvent={text:"L{Edit task}",localeClass:this,icon:"b-icon b-icon-edit",weight:-200,disabled:this.disabled||e.readOnly,onItem:()=>this.editEvent(e,r)})}onEventEnterKey({assignmentRecord:e,eventRecord:r}){e?this.editEvent(r,e.resource):r&&this.editEvent(r,r.resource)}async triggerOnClient(e,r){const t=e.replace(/task/,"event").replace(/Task/,"Event"),i=await this.scheduler.trigger(...arguments);r.eventRecord=r.taskRecord,r.eventRecords=[r.taskRecord];const n=await this.scheduler.trigger(t,r);return i&&n}onEventDropped({eventRecords:e}){var r;const t=((r=this.editor)==null?void 0:r.loadedRecord)&&e.find(i=>i===this.editor.loadedRecord);t&&this.onEventResized({eventRecord:t})}onEventResized({eventRecord:e}){const{editor:r}=this;r!=null&&r.isVisible&&e===r.loadedRecord&&r.realign()}};Ru._$name="TaskEdit",z.registerFeature(Ru,!0,"SchedulerPro"),z.registerFeature(Ru,!1,"ResourceHistogram");var F_={isHighlightConfig:!0,clearExisting:!1},wv=class extends X{constructor(){super(...arguments),R(this,"domConfigs",[]),R(this,"configs",[])}static get $name(){return"TimeSpanHighlight"}static get configurable(){return{padding:0}}static get pluginConfig(){return{assign:["highlightTimeSpan","highlightTimeSpans","unhighlightTimeSpans"],chain:["onTimeAxisViewModelUpdate"]}}construct(){super.construct(...arguments),this.client.rowManager.ion({renderDone:this.onViewChanged,thisObj:this})}highlightTimeSpan(e,r=!0){const t=this,{startDate:i,endDate:n,name:s,surround:a,padding:o=t.padding,clearExisting:l=!0}=e,{client:c}=t,d=e.isTimeSpan?e:e.taskRecord;let u=e.resourceRecord||e.resource;const{animationId:h}=e;if(h&&C.addTemporaryClass(c.element,"b-transition-highlight",500,c),l&&(t.domConfigs.length=t.configs.length=0),t.disabled)return;if(a){t.surroundTimeSpan(e);return}t.configs.push(e);let f;c.isGanttBase?f=c.getScheduleRegion(d,!0,{start:i,end:n}):(u&&(u=c.store.getById(u)),f=c.getScheduleRegion(u,null,!0,{start:i,end:n},!u)),f&&(o&&(c.isHorizontal?f.inflate(o,0,o,0):f.inflate(0,o,0,o)),t.domConfigs.push(f.visualize({children:[{class:"b-sch-highlighted-range-name",html:s}],dataset:{syncId:h},class:{"b-sch-highlighted-range":1,[e.cls]:e.cls,[e.class||"b-sch-highlighted-range-default"]:1}},!0)),r&&t.draw())}draw(){q.sync({targetElement:this.containerEl,domConfig:{onlyChildren:!0,children:this.domConfigs}})}surroundTimeSpan(e){this.highlightTimeSpans([Object.assign({},e,{animationId:(e.animationId||"")+"Before",class:"b-unavailable",surround:!1,startDate:this.client.startDate,endDate:e.startDate}),Object.assign({},e,{animationId:(e.animationId||"")+"After",class:"b-unavailable",surround:!1,startDate:e.endDate,endDate:this.client.endDate})],{clearExisting:e.clearExisting})}highlightTimeSpans(e,r={}){const t=this,{clearExisting:i=!0}=r;i&&(e=e.slice(),t.domConfigs.length=t.configs.length=0),!t.disabled&&(e.forEach(n=>{t.highlightTimeSpan(n.isHighlightConfig?n:Object.setPrototypeOf(F_,n),!1)}),t.draw())}async unhighlightTimeSpans(e=!1){const r=this,{client:t}=r;e&&C.addTemporaryClass(t.element,"b-transition-highlight",500,t),Array.from(r.containerEl.children).forEach(i=>{e?(i.style.opacity=0,r.fadeOutDetacher=j.onTransitionEnd({element:i,property:"opacity",thisObj:t,handler:()=>{r.domConfigs.length=r.configs.length=0,r.draw()}})):(r.domConfigs.length=r.configs.length=0,r.draw())})}get containerEl(){return this._containerEl||(this._containerEl=C.createElement({parent:this.client.foregroundCanvas,retainElement:!0,class:"b-sch-highlight-container"})),this._containerEl}onTimeAxisViewModelUpdate(){this.onViewChanged()}onViewChanged(){this.configs.length>0&&this.highlightTimeSpans(this.configs)}updateDisabled(e,r){e&&this.unhighlightTimeSpans(),super.updateDisabled(e,r)}get featureClass(){}};wv._$name="TimeSpanHighlight",z.registerFeature(wv,!1,["SchedulerPro","Gantt"]);var ox=class{constructor({model:e,type:r}){var t,i,n;Object.assign(this,{id:(t=e.id)!=null?t:e.$entityName,type:(i=r==null?void 0:r.$$name)!=null?i:e.constructor.name,name:(n=e.name)!=null?n:e.$entityName}),new.target===ox&&Object.freeze(this)}},Ca=ox;R(Ca,"$name","ChangeLogEntity"),Ca._$name="ChangeLogEntity";var Tu=class extends Ca{constructor({model:e,fromTask:r,toTask:t}){super({model:e,type:fa}),Object.assign(this,{fromTask:r,toTask:t}),Object.freeze(this)}};R(Tu,"$name","ChangeLogDependencyEntity"),Tu._$name="ChangeLogDependencyEntity";var Mu=class extends Ca{constructor({model:e,event:r,resource:t}){super({model:e,type:Pi}),Object.assign(this,{event:r,resource:t}),Object.freeze(this)}};R(Mu,"$name","ChangeLogAssignmentEntity"),Mu._$name="ChangeLogAssignmentEntity";var lx=class{constructor({entity:e,actionType:r}){Object.assign(this,{entity:e,actionType:r}),this.constructor===lx&&Object.freeze(this)}},Zr=lx;R(Zr,"$name","ChangeLogAction"),Zr._$name="ChangeLogAction";var cx=class extends Zr{static get $name(){return"ChangeLogMoveAction"}constructor({entity:e,from:r,to:t}){super({entity:e,actionType:"move"}),Object.assign(this,{from:r,to:t}),Object.freeze(this)}};cx._$name="ChangeLogMoveAction";var dx=class extends Zr{static get $name(){return"ChangeLogUpdateAction"}constructor({entity:e,propertyUpdates:r,isInitialUserAction:t}){super({entity:e,actionType:"update"}),Object.assign(this,{propertyUpdates:r,isUser:t}),Object.freeze(this)}};dx._$name="ChangeLogUpdateAction";var Il=class extends X.mixin(er){constructor(){super(...arguments),R(this,"_remoteActionRanges",[]),R(this,"_comparingVersionId")}construct(e,r){super.construct(e,r);const t=this;t.versionStore=new ma({modelClass:t.versionModelClass,internalListeners:{change:t.onStoreChangeExternal,thisObj:t},id:ma.configurable.storeId}),t.changeStore=new pa({modelClass:t.transactionModelClass,internalListeners:{change:t.onStoreChangeExternal,thisObj:t},id:pa.configurable.storeId}),t._currentChanges=[],t.client.ion({beforeTaskDelete:t.onBeforeTaskDelete,beforeTaskSave:t.onBeforeTaskSave,gridRowBeforeDropFinalize:t.onGridRowBeforeDropFinalize,thisObj:t})}attachToProject(e){const r=this;super.attachToProject(e),e.addCrudStore([r.versionStore,r.changeStore]),e.ion({name:"project",load:r.onProjectLoad,once:!0,thisObj:r}),r.detachProjectListeners(),r.attachProjectListeners(e)}onBeforeTaskDelete(){this.transactionDescription=this.L("L{Versions.deletedTask}")}onBeforeTaskSave(){this.transactionDescription=this.L("L{Versions.editedTask}")}onGridRowBeforeDropFinalize({context:{valid:e,records:r}}){e&&(this.transactionDescription=r.length===1?this.L("L{Versions.movedTask}"):this.L("L{Versions.movedTasks}"))}attachProjectListeners(e){var r;const t=this;(r=e==null?void 0:e.stm)==null||r.ion({recordingStart:t.onStmRecordingStart,recordingStop:t.handleTransactionStop,restoringStop:t.onStmRestoringStop,thisObj:t,name:"stmListeners"}),e==null||e.ion({wsBeforeReceiveChanges:t.onBeforeApplyRemoteChanges,wsReceiveChanges:t.onAfterApplyRemoteChanges,thisObj:t,name:"stmListeners"})}detachProjectListeners(){this.detachListeners("stmListeners")}updateVersionModelClass(e){if(!e.isVersionModel)throw new Error("versionModelClass config must be a subclass of SchedulerPro.model.VersionModel.")}updateTransactionModelClass(e){if(!e.isChangeLogTransactionModel)throw new Error("transactionModelClass config must be a subclass of SchedulerPro.model.changelog.ChangeLogTransactionModel.")}onStoreChangeExternal(){this.triggerVersionChange()}tryAutoSave(){const e=this,{project:r}=e.client;e.changeStore.find(({versionId:t})=>!t)&&(r!=null&&r.wsSend?(r.wsSend("requestVersionAutoSave",{project:r.wsProjectId}),e.detachListeners("autoSave"),r.ion({name:"autoSave",wsVersionAutoSaveOK:e.autoSave,thisObj:e,once:!0})):e.saveVersionWithConfig({isAutosave:!0}))}autoSave(){this.saveVersionWithConfig({isAutosave:!0})}autoSaveHourly(){new Date().getMinutes()===0&&this.tryAutoSave()}updateAutoSaveInterval(e){const r=this,{client:t}=r;r._autoSaveInterval&&t.clearInterval(r._autosaveInterval),e==="hourly"?r._autoSaveInterval=t.setInterval(r.autoSaveHourly.bind(r),10*1e3):e&&(r._autoSaveInterval=t.setInterval(r.tryAutoSave.bind(r),e*60*1e3))}saveVersion(e=null){return this.saveVersionWithConfig({name:e})}saveVersionWithConfig(e){const r=this,t=r.captureVersionContent(),i=new r.versionModelClass({savedAt:new Date,content:t,...e});return i.onBeforeSave(),r.versionStore.add(i),r.changeStore.query(n=>n.versionId==null).forEach(n=>n.versionId=i.id),r.triggerVersionChange(),r.triggerTransactionChange(),i}async loadVersionContent(e){const r=this,{client:t}=r,{project:i}=t,n={version:e,content:null};if(await r.trigger("beforeLoadVersionContent",{context:n})){if(i!=null&&i.wsSend){i.wsSend("loadVersionContent",{project:i.wsProjectId,versionId:e.id});const s=await new Promise((a,o)=>{const l=Date.now();i.ion({name:"loadVersionContent",loadVersionContent({project:c,versionId:d,content:u}){if(c===i.wsProjectId&&d===e.id)return i.detachListeners("loadVersionContent"),a(u)},thisObj:r,expires:{delay:r.versionContentLoadTimeout-(Date.now()-l),alt:()=>o(`Failed to receive version content within ${this.versionContentLoadTimeout} ms`)}})});return s&&r._versionContentCache.set(e.id,s),s}}else if(n.content)return n.content}async getVersionContent(e){var r;return(r=e.content)!=null?r:await this.loadVersionContent(e)}triggerTransactionChange(){this.client.trigger("transactionChange",{hasUnattachedTransactions:this.hasUnattachedTransactions})}triggerVersionChange(){this.client.trigger("versionChange",{versions:this.versionStore.records})}captureVersionContent(){return this.client.project.toJSON()}async restoreVersion(e){var r,t,i,n;const s=await this.getVersionContent(e),{project:a}=this.client,o=(r=a.stm)==null?void 0:r.enabled;(t=a.stm)==null||t.disable(),a.json=s,await a.commitAsync(),o&&((i=a.stm)==null||i.enable()),(n=a.stm)==null||n.resetQueue()}async compareVersion(e){var r,t,i;const n=await this.getVersionContent(e),s={},{project:a}=this.client,o=(r=a.stm)==null?void 0:r.enabled;(t=a.stm)==null||t.disable();for(const l of n.eventsData)qn.preWalk(l,c=>c.children,({id:c,startDate:d,endDate:u})=>{s[c]={startDate:d,endDate:u}});a.taskStore.traverse(l=>{s[l.id]&&(l.baselines.removeAll(),l.baselines.loadData([{task:l,...s[l.id]}]))}),o&&((i=a.stm)==null||i.enable()),this._comparingVersionId=e.id}stopComparing(){var e,r,t;if(!this._comparingVersionId)return;const{project:i}=this.client,n=(e=i.stm)==null?void 0:e.enabled;(r=i.stm)==null||r.disable(),i.taskStore.traverse(s=>{s.baselines.removeAll()}),n&&((t=i.stm)==null||t.enable()),this._comparingVersionId=null}doDisable(e){super.doDisable(e),e?this.detachProjectListeners():this.attachProjectListeners(this.client.project),this.client.refresh()}getEntityDescriptor(e){var r;const t=(r=this.knownBaseTypes.find(i=>e instanceof i))!=null?r:e.constructor;return e.isDependencyModel?new Tu({model:e,fromTask:this.getEntityDescriptor(e.fromTask),toTask:this.getEntityDescriptor(e.toTask)}):e.isAssignmentModel?new Mu({model:e,event:this.getEntityDescriptor(e.event),resource:this.getEntityDescriptor(e.resource)}):new Ca({model:e,type:t})}getUpdateAction(e){const r=e[0].model,t=e.flatMap(({newData:a,oldData:o})=>Object.entries(a).map(([l,c])=>({property:l,value:c,oldValue:o[l]})).filter(({property:l,value:c,oldValue:d})=>{var u;return!T.isEqual(c,d)&&((u=r.getFieldDefinition(l))==null?void 0:u.persist)})),i=H.groupBy(t,"property"),n=Object.entries(i).map(([a,o])=>({property:a,before:o[0].oldValue,after:o[o.length-1].value})),s=e.some(({isInitialUserAction:a})=>a);return new dx({actionType:"update",entity:this.getEntityDescriptor(r),propertyUpdates:n,isInitialUserAction:s})}onProjectLoad(){this._currentStmTransaction=null,this.stopTransaction()}onStmRecordingStart({transaction:e}){this._transactionStart=new Date,this._currentStmTransaction=e,this.triggerTransactionChange()}stopTransaction(){var e,r;(e=this.client.project)!=null&&e.stm.isRecording&&((r=this.client.project)==null||r.stm.stopTransaction()),this.handleTransactionStop()}async onStmRestoringStop({cause:e,transactions:r}){const t=this;e==="undo"?t.transactionDescription=t.L("L{undid}"):e==="redo"&&(t.transactionDescription=t.L("L{redid}")),await t.client.project.commitAsync(),t._transactionStart=new Date,t.finalizeTransaction({queue:r.flatMap(i=>i.queue)})}onBeforeApplyRemoteChanges(){var e,r;this._remoteChangesStartPos==null&&(this._remoteChangesStartPos=(r=(e=this._currentStmTransaction)==null?void 0:e.queue.length)!=null?r:0)}async onAfterApplyRemoteChanges(){this.endCurrentRemoteActionRange(),await this.client.project.commitAsync()}endCurrentRemoteActionRange(){var e,r;const t=this;if(t._remoteChangesStartPos!=null){const i=(r=(e=t._currentStmTransaction)==null?void 0:e.queue.length)!=null?r:0;i!==t._remoteChangesStartPos&&t._remoteActionRanges.push({start:t._remoteChangesStartPos,end:i}),t._remoteChangesStartPos=null}}handleTransactionStop(){const e=this;e.hasChanges&&e.finalizeTransaction(e._currentStmTransaction),e._currentTransactionDescription=null,e._currentStmTransaction=null,e._remoteActionRanges=[],e.triggerTransactionChange()}excludeRanges(e,r){let t=[],i=0;for(const{start:n,end:s}of r)t=t.concat(e.slice(i,n)),i=s;return t.concat(e.slice(i))}finalizeTransaction(e){const r=this;r.endCurrentRemoteActionRange();const t=r.excludeRanges(e.queue,r._remoteActionRanges);if(t.length===0)return;const i=({model:o})=>o.$entityName,n=H.groupBy(t,"type"),s=[];for(const o of["UpdateAction","EventUpdateAction"]){const l=H.groupBy(n[o]||[],i);for(const c of Object.values(l))s.push(r.getUpdateAction(c))}for(const{modelList:o,isInitialUserAction:l}of n.RemoveAction||[])for(const c of o)s.push(new Zr({actionType:"remove",entity:r.getEntityDescriptor(c),isInitialUserAction:l}));for(const{childModels:o}of n.RemoveChildAction||[])for(const l of o)s.push(new Zr({actionType:"remove",entity:r.getEntityDescriptor(l)}));for(const{modelList:o}of n.AddAction||[])for(const l of o)s.push(new Zr({actionType:"add",entity:r.getEntityDescriptor(l)}));for(const{childModels:o,parentModel:l,context:c,insertIndex:d}of n.InsertChildAction||[])for(const u of o){const h=c.get(u);h!=null?s.push(new cx({actionType:"move",entity:r.getEntityDescriptor(u),from:{parent:r.getEntityDescriptor(h.parent),index:h.index},to:{parent:r.getEntityDescriptor(l),index:d}})):s.push(new Zr({actionType:"add",entity:r.getEntityDescriptor(u)}))}const a=new r.transactionModelClass({description:r._currentTransactionDescription,actions:s,occurredAt:r._transactionStart});r.changeStore.add(a)}set transactionDescription(e){this._currentTransactionDescription=e}get hasChanges(){var e,r;return((r=(e=this._currentStmTransaction)==null?void 0:e.queue)==null?void 0:r.length)>0}get hasUnattachedTransactions(){return this.changeStore.find(e=>e.versionId==null)}get isComparing(){return this._comparingVersionId!=null}};R(Il,"$name","Versions"),R(Il,"configurable",{versionModelClass:ga,transactionModelClass:Ln,autoSaveInterval:"hourly",knownBaseTypes:[Pi,fa,Rl],versionContentLoadTimeout:6e4}),Il._$name="Versions",z.registerFeature(Il,!1,"SchedulerPro");var Dv=class{constructor({property:e,before:r,after:t}){Object.assign(this,{property:e,before:r,after:t}),Object.freeze(this)}};R(Dv,"$name","ChangeLogPropertyUpdate"),Dv._$name="ChangeLogPropertyUpdate";var Ev=(e,r,t)=>{const i=t.getFieldDefinition(e),{dataSource:n}=i,s=t.constructor.processField(e,r[n],t);return n in r&&!i.isEqual(s,t[e])},ux=e=>class extends(e||F){startConfigure(t){this.getConfig("project"),super.startConfigure(t)}beforeApplyProjectChanges(){const{stm:t}=this;let i=!1;return this.suspendChangesTracking(),t.enabled&&(i=!0,t.isRecording&&t.stash(),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),i}async applyProjectChanges(t){var i,n;const s=this,a=s.beforeApplyProjectChanges();s.applyingChangeset=!0,t.project&&s.applyProjectResponse(t.project),s.applyChangeset(T.clone(t),(o,l)=>{if(l.id==="tasks"||l.id==="events"){const{modelClass:c}=l,d=c.getFieldDataSource("startDate"),u=c.getFieldDataSource("endDate");if(o.updated)for(const h of o.updated){const f=l.getById(h[c.idField]);Ev("constraintType",h,f)||Ev("constraintDate",h,f)||(delete h[d],delete h[u])}}}),await s.commitAsync(),s.commitRespondedChanges();for(const o in t){const l=s.getStoreDescriptor(o);if(l){const{store:c}=l,d=t[o],u=[...(i=d.updated)!=null?i:[],...(n=d.added)!=null?n:[]];if(c)for(const h of u){const f=c.getById(h[c.modelClass.idField]);if(f)for(const g in f.modifications)Ev(g,h,f)||delete f.meta.modified[g]}}}s.afterApplyProjectChanges(a),s.applyingChangeset=!1,await s.commitAsync()}afterApplyProjectChanges(t){if(t){const{stm:i}=this;this.ignoreRemoteChangesInSTM?i.enable():i.stopTransaction(),i.applyStash()}this.resumeChangesTracking()}},xv=class extends ux(rx(Tg(Vp))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:Cu,dependencyModelClass:fa,eventModelClass:xl,assignmentModelClass:Pi,resourceModelClass:Rl,calendarManagerStoreClass:Up,dependencyStoreClass:Gp,eventStoreClass:Su,assignmentStoreClass:bu,resourceStoreClass:Xp,calendarsData:null,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/schedulerpro/docs/api/SchedulerPro/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,calendarManagerStore:{},stmClass:Zp}}static get configurable(){return{calendars:null}}get taskStore(){return this.eventStore}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}};xv._$name="ProjectModel";var k_=e=>{var r;return r=class extends(e||F){doDestroy(){var t;(t=this.websocketManager)==null||t.destroy(),super.doDestroy()}updateWsAddress(t){var i;const n=this;(i=n.websocketManager)==null||i.destroy(),t&&(n.websocketManager=new Za({address:t,userName:n.wsUserName,internalListeners:{message:"handleWebsocketMessage",close:"handleWebsocketClose",error:"handleWebsocketError",thisObj:n}}),n.wsAutoLoad&&n.wsLoad()),n.toggleAutoSyncListener()}toggleAutoSyncListener(){const t=this;t.detachListeners("websocketlisteners"),t._wsAutoSync&&t._wsAddress&&t.ion({name:"websocketlisteners",hasChanges:"scheduleWebsocketMessage"})}updateWsAutoSync(){this.toggleAutoSyncListener()}updateWsProjectId(t){t!=null&&this.wsAutoLoad&&this.wsLoad()}scheduleWebsocketMessage(){const t=this;!t.hasTimeout("wsAutoSync")&&!t.isAutoSyncSuspended&&t.setTimeout({name:"wsAutoSync",fn:()=>{t.wsSync()},delay:t.autoSyncTimeout})}resumeAutoSync(t=!0){super.resumeAutoSync(t),this.websocketManager&&!this.isAutoSyncSuspended&&this.changes&&this.wsSync()}async wsSend(t,i,n=!1){return await this.wsOpen()?(this.websocketManager.send(t,i),n||this.trigger("wsSendMessage",{command:t,data:i}),!0):!1}wsReceive(t){}handleWebsocketClose(){this.trigger("wsClose")}handleWebsocketError({error:t}){this.trigger("wsError",{error:t})}async handleWebsocketMessage({data:t}){const i=this,{wsProjectId:n}=i,{project:s}=t;if(i.trigger("wsMessage",{data:t}),s===n&&t.command==="projectChange")i.trigger("wsBeforeReceiveChanges"),await i.applyProjectChanges(t.changes),i.trigger("wsReceiveChanges");else if(s===n&&t.command==="dataset")await i.loadInlineData(t.dataset),i.trigger("wsReceiveDataset");else if(s===n&&t.command==="versionAutoSaveOK")i.trigger("wsVersionAutoSaveOK");else if(s===n&&t.command==="loadVersionContent"){const{versionId:a,project:o,content:l}=t;i.trigger("loadVersionContent",{versionId:a,project:o,content:l})}else i.wsReceive(t)}async wsOpen(){const{websocketManager:t}=this;return t?(!t.isOpened&&await t.open()&&this.trigger("wsOpen"),t.isOpened):!1}async wsLoad(){const t=this;t.wsProjectId!=null&&(await t.wsSend("dataset",{project:t.wsProjectId}),await new Promise(i=>{const n=t.ion({wsReceiveDataset(){n(),i(!0)},expires:{delay:t.wsConnectionTimeout,alt:()=>{n(),i(!1)}}})}),await t.commitAsync(),t.trigger("wsLoad"))}async wsSync(){const t=this,{wsProjectId:i}=t;if(i==null)return;await this.commitAsync();const{changes:n}=this;n&&t.wsAutoSync&&!t.autoSyncSuspendCounter&&(t.acceptChanges(),await t.wsSend("projectChange",{project:i,changes:n})&&t.trigger("wsSendChanges"))}wsClose(){var t;(t=this.websocketManager)==null||t.close()}},R(r,"configurable",{wsAddress:null,wsUserName:"",wsAutoLoad:!0,wsAutoSync:!0,wsConnectionTimeout:6e4,wsProjectId:null}),r},hx=e=>{var r;return r=class extends(e||F){static get $name(){return"ProjectProgressMixin"}updateProject(t,i){super.updateProject(t,i),this.setupProgressListener(),this.detachListeners("delayedCalculation"),t!=null&&t.delayCalculation&&t.ion({name:"delayedCalculation",delayCalculationStart:"internalOnProjectDelayCalculationStart",delayCalculationEnd:"internalOnProjectDelayCalculationEnd",thisObj:this})}setupProgressListener(){var t;const i=this;i.detachListeners("projectProgress"),i.projectProgressReporting&&((t=i.project)==null||t.ion({name:"projectProgress",progress:"onProjectProgress",thisObj:i}))}updateProjectProgressReporting(){this.isConfiguring||this.setupProgressListener()}onProjectProgress({total:t,remaining:i,phase:n="propagating"}){const s=this;if(!s.isPainted||t<s.projectProgressThreshold)return;let a=s.projectProgressReporting;if(a==="auto"&&(a=s.project.delayCalculation?"progressbar":"mask"),a==="progressbar"){let o=s.calculationProgressElement;o||(o=s.calculationProgressElement=C.createElement({parent:s.timeAxisSubGrid.header.element,retainElement:!0,className:"b-calculation-progress-wrap",children:[{className:"b-calculation-progress"}]})),o.firstElementChild.style.width=`${(t-i)/t*100}%`,t>0&&i===0?s.calculationProgressTimeout=s.setTimeout(()=>{o==null||o.remove(),s.calculationProgressElement=null},50):s.clearTimeout(s.calculationProgressTimeout)}else{const o=s.L(`L{SchedulerProBase.${n}}`),l=t?`${o} ${Math.round(100*(t-i)/t)}%`:o;s.masked||s.mask({maxProgress:t,useTransition:!1,text:l}),s.masked.text=l,t&&(s.masked.maxProgress=t,s.masked.progress=t-i),t>0&&i===0&&s.unmask()}}internalOnProjectDelayCalculationStart(){this.readOnly||(this.$delayCalculationReadOnly=this.readOnly=!0)}internalOnProjectDelayCalculationEnd(){this.$delayCalculationReadOnly&&(this.$delayCalculationReadOnly=this.readOnly=!1)}get widgetClass(){}},R(r,"configurable",{projectProgressReporting:"auto",projectProgressThreshold:5e3}),r},fx=e=>class extends(e||F){static get $name(){return"SchedulerProEventRendering"}static get configurable(){return{eventLayout:"stack",horizontalLayoutPackClass:ev,horizontalLayoutStackClass:Qp}}updateInternalEventLayout(t,i){const n=this;n.isConfiguring||n.clearLayouts(),super.updateInternalEventLayout(t,i)}getEventLayout(t){return t=super.getEventLayout(t),"layoutFn"in t&&(t.type="layoutFn"),t}clearLayouts(){const t=this;if(t.layouts)for(const i in t.layouts)t.layouts[i].destroy(),delete t.layouts[i]}getEventLayoutHandler(t){const i=this;if(!i.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:s}=i;i.layouts||(i.layouts={});const{layouts:a}=i;switch(t.type){case"stack":return a.horizontalStack||(a.horizontalStack=i.horizontalLayoutStackClass.new({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:s,groupByThisObj:i},t)),a.horizontalStack;case"pack":return a.horizontalPack||(a.horizontalPack=i.horizontalLayoutPackClass.new({scheduler:i,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:s,groupByThisObj:i},t)),a.horizontalPack;case"layoutFn":return{type:"layoutFn",scheduler:i,applyLayout:t.layoutFn,layoutEventsInBands:t.layoutFn};default:return null}}get widgetClass(){}},Al=class extends st{static get $name(){return"SchedulingIssueResolutionPopup"}static get type(){return"schedulingissueresolutionpopup"}static get configurable(){return{localizableProperties:[],schedulingIssue:null,align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onCloseButtonClick",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!1,closable:!0,floating:!0,cls:"b-schedulerpro-issueresolutionpopup",layout:"vbox",resolutionsGroup:{type:"radiogroup",name:"resolutions"},items:{description:{type:"widget",cls:"b-error-description",weight:-100}},bbar:{defaults:{localeClass:this},items:{applyButton:{weight:100,color:"b-raised b-blue",text:"L{Apply}",onClick:"up.onApplyButtonClick",disabled:!0},cancelButton:{weight:200,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get selectedResolutions(){var e,r;const t=new Set,i=(r=(e=this.resolutionsGroup)==null?void 0:e.selected)==null?void 0:r.resolution;return i&&t.add(i),t}changeResolutionsGroup(e,r){return xc.reconfigure(r,e,this)}updateResolutionsGroup(e){e&&this.add(e)}getResolutionParameters(e){return[]}onApplyButtonClick(){const e=this,{selectedResolutions:r}=e;r.size?(r.forEach(t=>t.resolve(...e.getResolutionParameters(t))),e.continueWithResolutionResult(fr.Resume),e.doResolve(r)):e.onCancelButtonClick()}onCancelButtonClick(){this.continueWithResolutionResult(fr.Cancel),this.doResolve()}onCloseButtonClick(){this.canCancel&&this.onCancelButtonClick()}get isResolving(){return!!this.resolving}async resolve({source:e,schedulingIssue:r,continueWithResolutionResult:t}){const i=this;return i.project=e,i.schedulingIssue=r,i.continueWithResolutionResult=t,i.updatePopupContent(r,t),i.onResolutionChange({}),i.show(),i.resolving=new Va,i.resolving.promise}doResolve(e){const r=this,{resolving:t}=r;t&&(r.resolving.resolve(e),r.resolving=null,r.schedulingIssue=null,r.hide())}getResolutionWidgetConfig(e){return{text:L.encodeHtml(e.getDescription()),cls:"b-resolution",checkedValue:e.$$name,localeClass:this,name:"resolutions",internalListeners:{change:"up.onResolutionChange"},resolution:e}}getResolutions(){var e;return(e=this.schedulingIssue)==null?void 0:e.getResolutions()}updatePopupContent(e,r){var t;const i=this,{resolutionsGroup:n}=i;r&&(i.continueWithResolutionResult=r),e?i.schedulingIssue=e:e=i.schedulingIssue,i.title=e!=null&&e.type?i.optionalL(e.type):"Unknown error",i.widgetMap.description.content=e&&L.encodeHtml(e.getDescription());const s=i.getResolutions(),a=(s==null?void 0:s.map(l=>i.getResolutionWidgetConfig(l)))||[],o=((t=a[0])==null?void 0:t.name)||"resolutions";n.removeAll(),n.name=o,n.add(...a,{ref:"cancelResolution",text:"L{Cancel changes}",name:o,checkedValue:"cancel",localeClass:this,cls:"b-resolution",internalListeners:{change:"up.onResolutionChange"}}),i.toggleControlsState()}get canApply(){return this.resolutionsGroup.value!=null}get canCancel(){var e;return!((e=this.project)!=null&&e.isInitialCommit)}get cancelResolution(){return this.resolutionsGroup.widgetMap.cancelResolution}onResolutionChange(){this.toggleControlsState()}toggleControlsState(){const e=this,{applyButton:r,cancelButton:t}=e.widgetMap;r.disabled=!e.canApply,e.cancelResolution.hidden=t.hidden=!e.canCancel}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}};Al.initClass(),Al._$name="SchedulingIssueResolutionPopup";var Pu=class extends Al{static get $name(){return"CycleResolutionPopup"}static get type(){return"cycleresolutionpopup"}getDependencyTitle(e){return`"${L.encodeHtml(e.fromEvent.name)}" -> "${L.encodeHtml(e.toEvent.name)}"`}getResolutionWidgetConfig(e){const{dependency:r}=e,t=this.schedulingIssue.getInvalidDependencies(),i=super.getResolutionWidgetConfig(e);return t.includes(r)&&Object.assign(i,{name:"dependency-resolution",checked:!this._dependencyResolutionsChecked++}),i}getResolutions(){const{schedulingIssue:e}=this,r=e==null?void 0:e.getInvalidDependencies();let t=e==null?void 0:e.getResolutions();return t&&r.length&&(t=t.filter(i=>i.dependency&&r.includes(i.dependency))),t}updatePopupContent(e,r){const t=this,{invalidDependenciesDescription:i,dependencyField:n}=t.widgetMap;if(t._dependencyResolutionsChecked=0,super.updatePopupContent(...arguments),i==null||i.hide(),n==null||n.hide(),e=t.schedulingIssue,e){const s=e.getDependencies(),a=e.getInvalidDependencies(),o=s.filter(l=>!a.includes(l));if(a.length)i?i.show():t.add({type:"widget",ref:"invalidDependenciesDescription",weight:-50,width:"100%",cls:"b-invalid-dependencies-description",html:t.L("L{invalidDependencyLabel}")});else{const l=o==null?void 0:o.map(c=>({value:c.id,text:t.getDependencyTitle(c)}));n?(n.value=null,n.items=l,n.show()):t.add({type:"combo",ref:"dependencyField",weight:50,width:"100%",name:"dependency",label:t.L("L{dependencyLabel}"),labelPosition:"above",cls:"b-dependency-field",items:l,internalListeners:{change:"up.onDependencyChange"}})}}}get canApply(){const{widgetMap:e}=this;return super.canApply&&(e.cancelResolution.checked||!e.dependencyField||e.dependencyField.value)}onDependencyChange(){this.toggleControlsState()}getResolutionParameters(e){if(e.isRemoveDependencyCycleEffectResolution||e.isDeactivateDependencyCycleEffectResolution){const r=this.widgetMap.dependencyField.value;return[this.project.dependencyStore.getById(r)]}return super.getResolutionParameters(e)}};Pu.initClass(),Pu._$name="CycleResolutionPopup";var gx=e=>class extends(e||F){static get $name(){return"SchedulingIssueResolution"}static get configurable(){return{schedulingIssueResolutionPopupClass:Al,cycleResolutionPopupClass:Pu,displaySchedulingIssueResolutionPopup:!0}}updateProject(t,i){super.updateProject(t,i),this.unbindSchedulingIssueResolutionFromProject(i),this.displaySchedulingIssueResolutionPopup&&t&&this.bindSchedulingIssueResolutionToProject(t)}bindSchedulingIssueResolutionToProject(t){t.ion({name:"schedulingIssueResolution",schedulingConflict:"onProjectSchedulingIssueEvent",emptyCalendar:"onProjectSchedulingIssueEvent",cycle:"onProjectSchedulingIssueEvent",thisObj:this})}get isResolving(){var t;return(t=this._lastSchedulingIssueResolutionPopup)==null?void 0:t.isResolving}get activeSchedulingIssueResolutionPopup(){return this.isResolving&&this._lastSchedulingIssueResolutionPopup}unbindSchedulingIssueResolutionFromProject(t){this.detachListeners("schedulingIssueResolution")}getSchedulingIssueResolutionPopup(t){return t.type==="cycle"?this._cycleResolutionPopup||(this._cycleResolutionPopup=new this.cycleResolutionPopupClass({rootElement:this.rootElement})):this._schedulingIssueResolutionPopup||(this._schedulingIssueResolutionPopup=new this.schedulingIssueResolutionPopupClass({rootElement:this.rootElement}))}onProjectSchedulingIssueEvent({schedulingIssue:t}){const i=this.getSchedulingIssueResolutionPopup(t);this._lastSchedulingIssueResolutionPopup=i,i.resolve(...arguments)}get widgetClass(){}},Rv=class extends Xo{fillInnerSpanHorizontalPosition(e){const r=this,{eventRecord:t}=e,{startMS:i,endMS:n,durationMS:s}=r.calculateMS(t,"startDate","endDate"),a=r.calculateHorizontalPosition(e,i,n,s);if(a){const{left:o,width:l}=a;return Object.assign(e,{innerStartMS:i,innerEndMS:n,innerDurationMS:s,bufferBeforeWidth:Math.max(o-e.left,0),bufferAfterWidth:Math.max(Math.floor(e.left+e.width-o-l),0)}),!0}else return!1}getTimeSpanRenderData(e,r,t=!1){const i=super.getTimeSpanRenderData(e,r,t);return i!=null&&i.useEventBuffer&&!this.fillInnerSpanHorizontalPosition(i)?null:i}};R(Rv,"$name","ProHorizontalRendering"),Rv._$name="ProHorizontalRendering";var Tv=class extends Od{fillInnerSpanVerticalPosition(e){const r=this,{scheduler:t}=r,{eventRecord:i}=e,{isBatchUpdating:n}=i,s=n?i.get("startDate"):i.startDate,a=n?i.get("endDate"):i.endDate,o=t.getCoordinateFromDate(s),l=s.getTime(),c=a.getTime(),d=c-l;let u=t.getCoordinateFromDate(a),h=u-o;return u===-1&&(h=Math.round(d*t.timeAxisViewModel.getSingleUnitInPixels("millisecond")),u=o+h),Object.assign(e,{innerStartMS:l,innerEndMS:c,innerDurationMS:d,bufferBeforeWidth:o-e.top,bufferAfterWidth:e.top+e.height-o-h}),!0}getTimeSpanRenderData(e,r,t=!1){const i=super.getTimeSpanRenderData(e,r,t);return i!=null&&i.useEventBuffer&&!this.fillInnerSpanVerticalPosition(i)?null:i}};R(Tv,"$name","ProVerticalRendering"),Tv._$name="ProVerticalRendering";var _l=class extends Ei.mixin(hx,gx,fx){static get $name(){return"SchedulerProBase"}static get type(){return"schedulerprobase"}static get configurable(){return{projectModelClass:xv,dependencyIdField:"id"}}static get isSchedulerPro(){return!0}onPaintOverride(){}set calendars(e){this.project.calendars=e}get calendars(){return this.project.calendars}get mode(){return this._mode}set mode(e){const r=this;r._mode=e,r[e]||(r.element.classList.add(`b-sch-${e}`),e==="horizontal"?(r.horizontal=new Rv(r),r.isPainted&&r.horizontal.init()):e==="vertical"&&(r.vertical=new Tv(r),r.rendered&&r.vertical.init()))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&C.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get taskStore(){return this.project.eventStore}createEvent(e,r,t){if(r.isWorkingTime(e))if(this.taskEdit&&this.taskEdit.isEditing)this.ion({aftertaskedit:()=>super.createEvent(e,r,t),once:!0});else return super.createEvent(e,r,t)}};_l.initClass(),re.setVersion("schedulerpro","5.3.7"),_l._$name="SchedulerProBase";var O_=()=>{},Hn=class extends _l{static get properties(){return{allocationReportByRecord:new Map,allocationDataByRecord:new Map,allocationObserverByRecord:new Map,resourceGroupsToUpdate:new Set,resourceGroupsAllocation:new Map}}construct(e){super.construct(e);const r=this;r.scheduleRefreshRows=r.createOnFrame(r.refreshRows,[],r,!0),r.horizontal.refreshResourcesWhenReady=r.horizontal.onAssignmentStoreChange=r.horizontal.renderer=function(){},r.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",renderRow:"onRowManagerRenderRow",thisObj:r})}get timeAxis(){return super.timeAxis}set timeAxis(e){const r=this._timeAxis;super.timeAxis=e,!(this.partner&&!e||r&&r===e)&&this._timeAxis.ion({name:"timeAxis",endReconfigure:"onTimeAxisEndReconfigure",thisObj:this})}async onRowManagerRenderRow({record:e}){if(e.isSpecialRow){const r=this;if(r.project.isDelayingCalculation&&(await r.project.commitAsync(),r.isDestroyed))return;r.renderGroupHistogram(e),r.renderGroupScale(e)}}onDestroy(){var e,r,t,i,n;const s=this;for(const[a,o]of(e=s.allocationObserverByRecord)==null?void 0:e.entries())a.removeObserver&&(a.removeObserver(o),s.allocationObserverByRecord.delete(a));for(const[a,o]of(r=s.allocationReportByRecord)==null?void 0:r.entries())a.removeEntity&&((t=a.removeEntity)==null||t.call(a,o),s.allocationReportByRecord.delete(o));s.allocationDataByRecord.clear(),(i=s._histogramWidget)==null||i.destroy(),(n=s._groupHistogramWidget)==null||n.destroy(),s.barTooltip=null}updateProject(e){this.detachListeners("resourceHistogramProject"),e.ion({name:"resourceHistogramProject",refresh:"internalOnProjectRefresh",delayCalculationStart:"onProjectDelayCalculationStart",delayCalculationEnd:"onProjectDelayCalculationEnd",repopulateReplica:"onRepopulateReplica",thisObj:this}),this.store=e.resourceStore}scheduleRefreshRows(){}getEventsToRender(){}getRowHeight(){return this.rowHeight}convertEffortUnit(e,r,t){return this.project.run("$convertDuration",e,r,t)}updateUseProjectTimeUnitsForScale(){const e=this;if(e.isPainted){const r={scalePoints:e.generateScalePoints()};e.trigger("generateScalePoints",r),e._generatedScalePoints=e.scalePoints=r.scalePoints,e.scheduleRefreshRows()}}get eventStore(){var e;return(e=this.project)==null?void 0:e.eventStore}set eventStore(e){super.eventStore=e}get scaleColumn(){return this.columns.query(e=>e.isScaleColumn)[0]}get scalePoints(){return this._scalePoints}set scalePoints(e){const{histogramWidget:r,scaleColumn:t}=this,i=e[e.length-1],{value:n,unit:s}=i;this.scaleUnit=s,this._scalePoints=e;let a=n;if(t){const{scaleWidget:o}=t;a+=o.scaleMaxPadding*n}r.topValue=this.useProjectTimeUnitsForScale?this.convertEffortUnit(a,s,Q.Millisecond):b.asMilliseconds(a,s),t&&(t.scalePoints=e)}buildScalePointText(e){return`${e.value}${b.getShortNameOfUnit(e.unit)}`}generateScalePoints(e,r){var t;if(!((t=this.project)!=null&&t.graph))return;const{timeAxis:i}=this,n=[];e=e||i.increment,r=r||i.unit;let s;e===1&&(r=b.getSmallerUnit(r),e=Math.round(this.useProjectTimeUnitsForScale?this.convertEffortUnit(e,i.unit,r):b.as(r,e,i.unit)));for(const o of[7,5,4,3,2])if(!(e%o)){s=e/o;break}s||(s=e);for(let o=s;o<=e;o+=s)n.push({value:o});const a=n[n.length-1];return a.unit=r,a.text=this.buildScalePointText(a),n}updateViewPreset(e){const r=this;r._updatingViewPreset=!0,super.updateViewPreset(...arguments),r._updatingViewPreset=!1,r.project.isInitialCommitPerformed&&r.isPainted&&r.onTimeAxisEndReconfigure()}onPaint({firstPaint:e}){super.onPaint({firstPaint:e}),e&&this.showBarTip&&(this.barTooltip={})}updateGetBarTip(e){return e&&(this.barTooltipTemplate=null),e}changeBarTooltip(e,r){return r==null||r.destroy(),e?e.isTooltip?e:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,e):null}onRepopulateReplica(){this.ticksIdentifier=null,this.allocationReportByRecord.clear(),this.allocationDataByRecord.clear(),this.allocationObserverByRecord.clear()}getTipHtml(e){var r;const{activeTarget:t}=e,i=t.dataset.index,n=this.getRecordFromElement(t),s=this.allocationDataByRecord.get(n);return e=Object.assign({},e),e.index=parseInt(i,10),e.datum=s[e.index],(r=this.barTooltipTemplate)==null?void 0:r.call(this,e)}buildTicksIdentifier(){const e=this,r=e.project.getGraph();return e.ticksIdentifier||(e.ticksIdentifier=r.addIdentifier(ur.new())),e.ticksIdentifier.writeToGraph(r,new In({unspecifiedTimeIsWorking:!1,intervals:e.timeAxis.ticks.map(t=>({startDate:t.startDate,endDate:t.endDate,isWorking:!0}))})),e.collectTicksWidth(),e.ticksIdentifier}collectTicksWidth(){const{ticks:e}=this.timeAxis,r=e[0].endDate-e[0].startDate,t={0:r};let i=r,n=!0;for(let s=1,{length:a}=e;s<a;s++){const o=e[s],l=o.endDate-o.startDate;r!==l&&(n=!1),i+=l,t[s]=l}if(n)this.ticksWidth=null;else{const s={};for(let a=0,{length:o}=e;a<o;a++)s[a]=t[a]/i;this.ticksWidth=s}}onProjectDelayCalculationStart(){this.suspendRefresh()}onProjectDelayCalculationEnd(){this.resumeRefresh(!0)}projectUnitsHasChanged(){const{project:e}=this;return e.daysPerMonth!==this._projectDaysPerMonth||e.daysPerWeek!==this._projectDaysPerWeek||e.hoursPerDay!==this._projectHoursPerDay}internalOnProjectRefresh({source:e,isCalculated:r}){if(r){const t=this;if(t.ticksIdentifier||t.onTimeAxisEndReconfigure(),t.useProjectTimeUnitsForScale&&t.projectUnitsHasChanged()){t._projectDaysPerMonth=e.daysPerMonth,t._projectDaysPerWeek=e.daysPerWeek,t._projectHoursPerDay=e.hoursPerDay;const i={scalePoints:t.generateScalePoints()};t.trigger("generateScalePoints",i),t._generatedScalePoints=t.scalePoints=i.scalePoints}}}relayStoreDataChange(e){super.relayStoreDataChange(e),this.store.count===0&&(this.histogramWidget.data=[],this.histogramWidget.refresh())}get columns(){return super.columns}set columns(e){const r=this;super.columns=e,r.isDestroying||(r.timeAxisColumn.renderer=r.renderResourceHistogram,r.timeAxisColumn.cellCls=r.timeAxisColumnCellCls,e.some(t=>t.type==="scale")||r.insertScaleColumn())}insertScaleColumn(){this.columns.rootNode.insertChild({type:"scale"},this.timeAxisColumn)}buildHistogramWidget(e){var r;const t=this;t.getBarTextRenderData&&!e.getBarTextRenderData&&(e.getBarTextRenderData=t.getBarTextRenderData);const i=t.histogramWidgetClass.new({owner:t,appendTo:t.element,cls:"b-hide-offscreen b-resourcehistogram-histogram",height:t.rowHeight,width:((r=t.timeAxisColumn)==null?void 0:r.width)||0,omitZeroHeightBars:!0,data:[],getBarTip:!t.barTooltipTemplate&&t.getBarTip||O_,getRectClass:t.getRectClass||t.getRectClassDefault,getBarText:t.getBarText||t.getBarTextDefault,series:t.series},t.histogramWidgetConfig,e);return t.getBarTextDefault.bind(i),i}get histogramWidget(){const e=this;if(!e._histogramWidget){const r=e.series;!e.showMaxEffort&&r.maxEffort&&(r.maxEffort=!1),e._histogramWidget=e.buildHistogramWidget()}return e._histogramWidget}getRectClassDefault(e,r,t){if(e.id==="effort")switch(!0){case t.isOverallocated:return"b-overallocated";case t.isUnderallocated:return"b-underallocated"}return""}get effortFormatter(){const e=this,r=e.effortFormat;let t=e._effortFormatter;return(!t||e._effortFormat!==r)&&(t=lr.get(e._lastFormat=r),e._effortFormatter=t),t}getEffortText(e,r,t=this.showEffortUnit){var i;if(!((i=this.project)!=null&&i.graph))return;const{scaleUnit:n,effortFormatter:s}=this;r=r||n;const a=b.getShortNameOfUnit(r),o=this.convertEffortUnit(e,Q.Millisecond,r);return s.format(o)+(t?a:"")}getBarTipEffortUnit(){const{effortUnit:e,barTipEffortUnit:r,timeAxis:t}=this,i=r||e;return b.compareUnits(t.unit,i)<0?t.unit:i}getGroupBarTip({datum:e}){const r=this,{showBarTip:t,timeAxis:i}=r;let n="";if(t&&e.effort){const s=r.getBarTipEffortUnit(...arguments),a=r.getEffortText(e.effort,s),o=r.getEffortText(e.maxEffort,s),l=r.L("L{groupBarTipAssignment}");let c="L",d=r.L("L{groupBarTipInRange}"),u="";b.compareUnits(i.unit,Q.Day)===0?d=r.L("L{groupBarTipOnDate}"):b.compareUnits(i.unit,Q.Second)<=0?c="HH:mm:ss A":b.compareUnits(i.unit,Q.Hour)<=0&&(c="LT");let h=[...e.resourceAllocation.entries()].filter(([g,m])=>m.effort).sort(([g,m],[p,v])=>m.effort>v.effort?-1:1);h.length>r.groupBarTipAssignmentLimit&&(u="<br>"+r.L("L{plusMore}").replace("{value}",h.length-r.groupBarTipAssignmentLimit),h=h.slice(0,this.groupBarTipAssignmentLimit));const f=h.map(([g,m])=>l.replace("{resource}",L.encodeHtml(g.name)).replace("{allocated}",r.getEffortText(m.effort,s)).replace("{available}",r.getEffortText(m.maxEffort,s)).replace("{cls}",m.isOverallocated?"b-overallocated":m.isUnderallocated?"b-underallocated":"")).join("<br>")+u;n=d.replace("{assignments}",f).replace("{startDate}",b.format(e.tick.startDate,c)).replace("{endDate}",b.format(e.tick.endDate,c)).replace("{allocated}",a).replace("{available}",o).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getResourceBarTip({datum:e}){const r=this,{showBarTip:t,timeAxis:i}=r;let n="";if(t&&e.effort){const s=r.getBarTipEffortUnit(),a=r.getEffortText(e.effort,s),o=r.getEffortText(e.maxEffort,s);let l="L",c=r.L("L{barTipInRange}");b.compareUnits(i.unit,Q.Day)===0?c=r.L("L{barTipOnDate}"):b.compareUnits(i.unit,Q.Second)<=0?l="HH:mm:ss A":b.compareUnits(i.unit,Q.Hour)<=0&&(l="LT"),n=c.replace("{startDate}",b.format(e.tick.startDate,l)).replace("{endDate}",b.format(e.tick.endDate,l)).replace("{allocated}",a).replace("{available}",o).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),e.resource&&(n=n.replace("{resource}",L.encodeHtml(e.resource.name))),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getBarTextEffortUnit(){const{effortUnit:e,barTextEffortUnit:r,timeAxis:t}=this,i=r||e;return b.compareUnits(t.unit,i)<0?t.unit:i}getBarTextDefault(e,r){const{showBarText:t}=this.owner;let i="";if(t&&e.effort){const n=this.owner.getBarTextEffortUnit();i=this.owner.getEffortText(e.effort,n)}return i}updateShowBarText(e){this.scheduleRefreshRows()}updateShowBarTip(e){this.barTooltip=e}updateShowMaxEffort(e){const r=this;r._showMaxEffort=e;let t=!1;[r._histogramWidget,r._groupHistogramWidget].forEach(i=>{if(!i)return;const{series:n}=i;e?typeof e=="object"?n.maxEffort=e:typeof i._seriesMaxEffort=="object"?n.maxEffort=i._seriesMaxEffort:(n.maxEffort={type:"outline",field:"maxEffort"},n.maxEffort.id="maxEffort"):n.maxEffort&&(i._seriesMaxEffort=n.maxEffort,delete n.maxEffort),t=!0}),t&&r.scheduleRefreshRows()}updateIncludeInactiveEvents(e){this.allocationReportByRecord.forEach(r=>r.includeInactiveEvents=e)}onTimeAxisEndReconfigureInternal(){const e=this;if(!e._updatingViewPreset){const{unit:r,increment:t}=e.timeAxis;if(r!==e._lastTimeAxisUnit||t!==e._lastTimeAxisIncrement){e._lastTimeAxisUnit=r,e._lastTimeAxisIncrement=t;const i=e.generateScalePoints(),n={scalePoints:i};e.trigger("generateScalePoints",n),e._generatedScalePoints=e.scalePoints=n.scalePoints}e.buildTicksIdentifier()}}onTimeAxisEndReconfigure(){const e=this;e._updatingViewPreset||(e.project.graph?e.onTimeAxisEndReconfigureInternal():e.project.ion({graphReady(){e.onTimeAxisEndReconfigureInternal()},thisObj:e,once:!0}))}onBeforeRowHeight({height:e}){if(this._timeAxisColumn)for(const r of[this._histogramWidget,this._groupHistogramWidget])r&&(r.height=e,r.onElementResize(r.element))}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(...arguments);for(const e of[this._histogramWidget,this._groupHistogramWidget])e&&(e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element))}getRecordAllocationInfoRenderData(e,r,t,i=null){if(r=Array.isArray(r)?r:r.total,this.ticksWidth)for(let n=0,{length:s}=r;n<s;n++)r[n].width=this.ticksWidth[n];return r}renderRecordAllocationInfo(e,r,t,i=null){i=i||this.histogramWidget;const n=this.getRecordAllocationInfoRenderData(e,r,t,i);if(!n)return;this.allocationDataByRecord.set(e,n),i.data=n,i.refresh();const s=i.element.cloneNode(!0);s.removeAttribute("id"),s.classList.remove("b-hide-offscreen"),t.innerHTML="",t.appendChild(s)}renderRows(){const e=this;return!e.ticksIdentifier&&e.project.isInitialCommitPerformed&&(e.onTimeAxisEndReconfigure(),(!e.timeView.startDate||!e.timeView.endDate)&&(e.timeView.range={startDate:e.startDate,endDate:e.endDate})),super.renderRows(...arguments)}onRecordAllocationCalculated(e,r,t){const i=this;if(!i.isDestroying){const n=i.getCell({record:e,columnId:i.timeAxisColumn.id});n&&i.renderRecordAllocationInfo(e,r,n),i.trigger("allocationChange",{record:e,allocation:r});const s=i.getResourceGroupParent(e);s&&(i.resourceGroupsAllocation.delete(s),i.scheduleGroupRender(s))}}buildResourceAllocationReport(e){return this.project.resourceAllocationInfoClass.new({includeInactiveEvents:this.includeInactiveEvents,ticks:this.ticksIdentifier,resource:e})}registerRecordAllocationReport(e){const r=this,t=r.project.getGraph(),i=r.buildResourceAllocationReport(e);r.allocationReportByRecord.set(e,i),e.addEntity(i);const n=t.observe(function*(){return yield i.$.allocation},s=>r.onRecordAllocationCalculated(e,s,i));return r.allocationObserverByRecord.set(e,n),e.addObserver(n),i}renderResourceHistogram({grid:e,cellElement:r,record:t}){const{project:i}=e;if(e.ticksIdentifier&&i.isInitialCommitPerformed&&!t.isSpecialRow){const{allocationReportByRecord:n,allocationObserverByRecord:s}=e;let a=n.get(t);if(a||(a=e.registerRecordAllocationReport(t)),a!=null&&a.allocation){a.graph?e.renderRecordAllocationInfo(t,a.allocation,r):(n.delete(t),e.allocationDataByRecord.delete(t),s.delete(t));const o=e.getResourceGroupParent(t);o&&e.store.includes(o)&&e.scheduleGroupRender(o)}}}renderScheduledGroups(){for(const e of Array.from(this.resourceGroupsToUpdate))this.renderGroupHistogram(e);this.clearTimeout(this.renderScheduledGroupTimer)}scheduleGroupRender(e){this.resourceGroupsToUpdate.add(e),this.renderScheduledGroupTimer=this.setTimeout({fn:"renderScheduledGroups",delay:10,cancelOutstanding:!0})}getResourceGroupParent(e){const r=e.instanceMeta(this.project.resourceStore.id);return r==null?void 0:r.groupParent}calculateResourceGroupAllocation(e){var r,t;const i=this,{allocationReportByRecord:n}=i,{groupChildren:s}=e,a=s.map(c=>n.get(c)),o=(t=(r=a[0])==null?void 0:r.allocation)==null?void 0:t.total,l=o==null?void 0:o.length;if(o&&a.every(c=>(c==null?void 0:c.allocation)&&c.allocation.total.length===l)){const c=[];return a.forEach(({allocation:d})=>{d.total.forEach((u,h)=>{let f=c[h];f||(f=c[h]={tick:u.tick,effort:0,maxEffort:0,units:0,isGroup:!0,resourceAllocation:new Map}),f.resourceAllocation.set(u.resource,{effort:u.effort,maxEffort:u.maxEffort,units:u.units,isOverallocated:u.effort>u.maxEffort,isUnderallocated:u.effort<u.maxEffort}),f.isOverallocated=f.isOverallocated||u.isOverallocated,f.isUnderallocated=f.isUnderallocated||u.isUnderallocated,f.effort+=u.effort,f.maxEffort+=u.maxEffort,u.assignments&&(f.assignments?u.assignments.forEach(g=>f.assignments.add(g)):f.assignments=new Set(u.assignments))})}),c}}renderGroupHistogram(e){var r;const t=this;t.resourceGroupsToUpdate.delete(e),t.store.includes(e)||t.resourceGroupsAllocation.delete(e);const i=t.resourceGroupsAllocation.get(e)||t.calculateResourceGroupAllocation(e);if(i){t.resourceGroupsAllocation.set(e,i);const{groupChildren:n}=e;let s=t.generateScalePoints(t.timeAxis.increment*n.length);const a={scalePoints:s,groupParent:e,isCalculatingTopValue:!0};t.trigger("generateScalePoints",a),s=a.scalePoints;const o=s[s.length-1],l=t.useProjectTimeUnitsForScale?t.convertEffortUnit(o.value,o.unit,Q.Millisecond):b.asMilliseconds(o.value,o.unit),c=l+(((r=t.scaleColumn)==null?void 0:r.scaleWidget.scaleMaxPadding)||0)*l,d=t._groupHistogramWidget||t.buildHistogramWidget({topValue:c}),u=t.getCell({id:e.id,columnId:t.timeAxisColumn.id});t._groupHistogramWidget?d.topValue=c:t._groupHistogramWidget=d,u&&(t.renderRecordAllocationInfo(e,i,u,d),t.trigger("groupRendered",{groupParent:e}))}else t.store.includes(e)&&t.scheduleGroupRender(e)}renderGroupScale(e){const r=this,{scaleColumn:t}=r;if(t){const{groupChildren:i}=e,n=r.generateScalePoints(r.timeAxis.increment*i.length),s=r.getCell({id:e.id,columnId:t.id}),a={scalePoints:n,groupParent:e};if(!s)return;let o=r._groupScaleWidget;return o||(o=r._groupScaleWidget=t.buildScaleWidget()),r.trigger("generateScalePoints",a),o.scalePoints=a.scalePoints,t.renderer({cellElement:s,scaleWidget:o})}}updateLocalization(){const e=this;e._generatedScalePoints===e.scalePoints&&e.scalePoints&&e.scalePoints.forEach(r=>{r.text&&r.unit&&(r.text=e.buildScalePointText(r))}),super.updateLocalization(...arguments)}};R(Hn,"$name","ResourceHistogram"),R(Hn,"type","resourcehistogram"),R(Hn,"configurable",{sortFeatureStore:"store",timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourcehistogram-cell",effortFormat:"0.#",showEffortUnit:!0,rowHeight:50,useProjectTimeUnitsForScale:!1,effortUnit:Q.Hour,barTextEffortUnit:null,barTipEffortUnit:null,showMaxEffort:!0,showBarText:!1,showBarTip:!1,barTooltip:null,barTooltipClass:ue,series:{maxEffort:{type:"outline",field:"maxEffort"},effort:{type:"bar",field:"effort"}},getRectClass:null,createEventOnDblClick:!1,readOnly:!0,getBarTip:null,barTooltipTemplate({datum:e}){let r="";const{effort:t,isGroup:i}=e;return t&&(i?r=this.getGroupBarTip(...arguments):r=this.getResourceBarTip(...arguments)),r},getBarText:null,getBarTextRenderData:void 0,groupBarTipAssignmentLimit:5,histogramWidgetClass:Ic,histogramWidgetConfig:null,includeInactiveEvents:!1,fixedRowHeight:!0}),Hn.initClass(),Hn._$name="ResourceHistogram";var Fl=class extends ae{construct(e,...r){this._childrenIndex=new Map,e.origin&&Object.assign(e,this.mapOriginValues(e.origin)),super.construct(e,...r),this.origin&&this.fillChildren()}mapOriginValues(e){var r,t;const i={};return e.isResourceModel?i.name=e.name:e.isAssignmentModel&&(i.name=(r=e.event)==null?void 0:r.name,i.iconCls=(t=e.event)==null?void 0:t.iconCls),i}fillChildren(){var e;const r=this,{children:t}=r,i=new Set(t),n=[];if((e=r.origin)!=null&&e.isResourceModel){const{assigned:s}=r.origin;for(const a of s)r._childrenIndex.has(a)?i.delete(r._childrenIndex.get(a)):n.push(r.constructor.new({origin:a}))}i.size&&this.removeChild([...i]),n.length&&this.appendChild(n)}afterRemoveChild(e){e.forEach(r=>this._childrenIndex.delete(r.origin))}insertChild(...e){var r;let t=super.insertChild(...e);if(t){const{stores:i}=this;if(Array.isArray(t)||(t=[t]),(r=this.origin)!=null&&r.isResourceModel)for(const n of t)n.origin&&!this._childrenIndex.has(n.origin)&&this._childrenIndex.set(n.origin,n);if(i!=null&&i.length)for(const n of i)for(const s of t)s.traverse(a=>n.setModelByOrigin(a.origin,a))}return t}getChildByOrigin(e){return this._childrenIndex.get(e)}};R(Fl,"$name","ResourceUtilizationModel"),R(Fl,"fields",["name","iconCls"]),Fl.exposeProperties(),Fl._$name="ResourceUtilizationModel";var Mv=class extends zt.derive(ut){static get properties(){return{_modelByOrigin:new Map}}updateProject(e){this.setResourceStore(e==null?void 0:e.resourceStore),this.setAssignmentStore(e==null?void 0:e.assignmentStore),this.setEventStore(e==null?void 0:e.eventStore),this.fillStoreFromProject()}setResourceStore(e){this.detachListeners("resourceStore"),e==null||e.ion({name:"resourceStore",change:this.onResourceStoreDataChanged,thisObj:this})}setEventStore(e){this.detachListeners("eventStore"),e==null||e.ion({name:"eventStore",update:this.onEventUpdate,thisObj:this})}setAssignmentStore(e){this.detachListeners("assignmentStore"),e==null||e.ion({name:"assignmentStore",change:this.onAssignmentsChange,refresh:this.onAssignmentsRefresh,add:this.onAssignmentsAdd,update:this.onAssignmentUpdate,remove:this.onAssignmentsRemove,thisObj:this})}onResourceStoreDataChanged(e){e.isMove&&e.action==="remove"||this.fillStoreFromProject()}onAssignmentsChange(){this.forEach(e=>e.fillChildren())}onAssignmentsRefresh(e){e.action==="batch"&&this.forEach(r=>r.fillChildren())}onAssignmentsAdd({records:e}){e.forEach(r=>{const t=this.getModelByOrigin(r==null?void 0:r.resource);t==null||t.fillChildren()})}onAssignmentUpdate({record:e,changes:r}){if("resource"in r){const t=this.getModelByOrigin(e),i=this.getModelByOrigin(e==null?void 0:e.resource);t&&i&&i.appendChild(t)}}onAssignmentsRemove({records:e}){this.remove(e.map(r=>this.getModelByOrigin(r)))}onEventUpdate({record:e,changes:r}){if("name"in r)for(const t of e.assigned)this.getModelByOrigin(t).set("name",e.name)}fillStoreFromProject(){var e;const r=[];(e=this._project)==null||e.resourceStore.forEach(t=>{t.isSpecialRow||r.push(this.modelClass.new({origin:t}))}),this.removeAll(),this.add(r),this.trigger("fillFromProject")}remove(){const e=super.remove(...arguments);return e==null||e.forEach(r=>{this._modelByOrigin.delete(r.origin)}),e}removeAll(){super.removeAll(...arguments),this._modelByOrigin.clear()}getModelByOrigin(e){return this._modelByOrigin.get(e)}setModelByOrigin(e,r){return this._modelByOrigin.set(e,r)}};R(Mv,"configurable",{modelClass:Fl,project:null,tree:!0}),Mv._$name="ResourceUtilizationStore";var mx=class extends Hn{updateProject(e){super.updateProject(e),this.store=this.buildStore(e)}buildStore(e){return Mv.new({project:e})}insertScaleColumn(){}getTipHtml({activeTarget:e}){const r=e.dataset.index,t=this.getRecordFromElement(e),i=this.allocationDataByRecord.get(t.origin),n=i[parseInt(r,10)];return this.barTooltipTemplate(n)}registerRecordAllocationReport(e){if(e.isResourceModel)return super.registerRecordAllocationReport(e);if(e.isAssignmentModel)return this.registerAssignmentAllocationReport(e)}onDestroy(){var e,r,t;const i=this;for(const[n,s]of(e=i.allocationObserverByRecord)==null?void 0:e.entries())n.isAssignmentModel&&(n.resource.removeObserver(s),i.allocationObserverByRecord.delete(n));for(const[n,s]of(r=i.allocationReportByRecord)==null?void 0:r.entries())n.isAssignmentModel&&(n.resource.removeEntity(s),i.allocationReportByRecord.delete(s));i.destroyStores&&((t=i.store)==null||t.destroy()),super.onDestroy()}registerAssignmentAllocationReport(e){const r=this,t=r.project.getGraph(),i=r.allocationReportByRecord.get(e.resource);if(i){r.allocationReportByRecord.set(e,i);const n=t.observe(function*(){return yield i.$.allocation},s=>r.onRecordAllocationCalculated(e,s,i));r.allocationObserverByRecord.set(e,n),e.resource.addObserver(n)}return i}onRecordAllocationCalculated(e,r,t){if(e.isAssignmentModel)if(r.byAssignments.get(e))super.onRecordAllocationCalculated(e,r,t);else{this.allocationReportByRecord.delete(e);const i=this.allocationObserverByRecord.get(e);i&&(t.resource.removeObserver(i),this.allocationObserverByRecord.delete(e))}else super.onRecordAllocationCalculated(e,r,t)}onRowManagerRenderRow({row:e,record:r}){var t,i;e.assignCls({"b-resource-row":(t=r.origin)==null?void 0:t.isResourceModel,"b-assignment-row":(i=r.origin)==null?void 0:i.isAssignmentModel})}getResourceGroupParent(e){const r=e.instanceMeta(this.store);return r==null?void 0:r.groupParent}renderResourceHistogram(e){const{project:r}=e.grid;if(r.isInitialCommitPerformed&&!e.record.isSpecialRow)return e.record=e.record.origin,super.renderResourceHistogram(e)}getCell(e){var r,t;return((r=e.record)!=null&&r.isResourceModel||(t=e.record)!=null&&t.isAssignmentModel)&&(e.record=this.store.getModelByOrigin(e.record)),super.getCell(e)}buildHistogramWidget(e={},...r){return!this.getBarTextRenderData&&!(e!=null&&e.getBarTextRenderData)&&(e.getBarTextRenderData=this.getBarTextRenderDataDefault),e.cls="b-hide-offscreen b-resourceutilization-histogram",e.height=this.rowHeight,super.buildHistogramWidget(e,...r)}getBarTextRenderDataDefault(e,r,t){return e.y="50%",e}getRecordAllocationInfoRenderData(e,r,t,i=null){let n;if(e.isResourceModel?n=r.total:e.isAssignmentModel&&(n=r.byAssignments.get(e)),n)for(let s=0,{length:a}=n;s<a;s++)n[s].effort&&(n[s].height=1);return n}getResourceBarTip(e){const r=this,{showBarTip:t,timeAxis:i}=r;let n="";if(t&&e.effort){const s=r.getBarTipEffortUnit(...arguments),a=r.getEffortText(e.effort,s,!0),o=r.getEffortText(e.maxEffort,s,!0),l=r.L("L{groupBarTipAssignment}");let c="L",d=r.L("L{groupBarTipInRange}"),u="";b.compareUnits(i.unit,Q.Day)===0?d=r.L("L{groupBarTipOnDate}"):b.compareUnits(i.unit,Q.Second)<=0?c="HH:mm:ss A":b.compareUnits(i.unit,Q.Hour)<=0&&(c="LT");let h=[...e.assignmentIntervals.entries()].filter(([g,m])=>m.effort).sort(([g,m],[p,v])=>m.effort>v.effort?-1:1);h.length>r.groupBarTipAssignmentLimit&&(u="<br>"+r.L("L{plusMore}").replace("{value}",h.length-r.groupBarTipAssignmentLimit),h=h.slice(0,this.groupBarTipAssignmentLimit));const f=h.map(([g,m])=>l.replace("{event}",L.encodeHtml(g.event.name)).replace("{allocated}",r.getEffortText(m.effort,s,!0)).replace("{available}",r.getEffortText(m.maxEffort,s,!0)).replace("{cls}",m.isOverallocated?"b-overallocated":m.isUnderallocated?"b-underallocated":"")).join("<br>")+u;n=d.replace("{assignments}",f).replace("{startDate}",b.format(e.tick.startDate,c)).replace("{endDate}",b.format(e.tick.endDate,c)).replace("{allocated}",a).replace("{available}",o).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getAssignmentBarTip(e){const r=this,{showBarTip:t,timeAxis:i}=r;let n="";if(t&&e.effort){const s=r.getBarTipEffortUnit(...arguments),a=r.getEffortText(e.effort,s,!0),o=r.getEffortText(e.maxEffort,s,!0);let l="L",c=r.L("L{barTipInRange}");b.compareUnits(i.unit,Q.Day)===0?c=r.L("L{barTipOnDate}"):b.compareUnits(i.unit,Q.Second)<=0?l="HH:mm:ss A":b.compareUnits(i.unit,Q.Hour)<=0&&(l="LT"),n=c.replace("{startDate}",b.format(e.tick.startDate,l)).replace("{endDate}",b.format(e.tick.endDate,l)).replace("{allocated}",a).replace("{available}",o).replace("{cls}",e.cls||""),e.assignment&&(n=n.replace("{event}",L.encodeHtml(e.assignment.event.name))),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}},Sa=mx;R(Sa,"$name","ResourceUtilization"),R(Sa,"type","resourceutilization"),R(Sa,"configurable",{timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourceutilization-cell",rowHeight:30,showEffortUnit:!1,showMaxEffort:!1,showBarText:!0,barTooltipTemplate({effort:e,isGroup:r,resource:t,assignment:i}){let n="";return e&&(t?n=this.getResourceBarTip(...arguments):i?n=this.getAssignmentBarTip(...arguments):r&&(n=this.getGroupBarTip(...arguments))),n},series:{effort:{type:"bar",field:"effort"}},readOnly:!0,columns:[{type:"tree",field:"name",text:"L{nameColumnText}",localeClass:mx}]}),Sa.initClass(),Sa._$name="ResourceUtilization",z.registerFeature(yi,!0,"ResourceUtilization");var Pv=class extends _l{static get $name(){return"SchedulerPro"}static get type(){return"schedulerpro"}};Pv.initClass(),Pv._$name="SchedulerPro";var Iv=class extends Ei{static get $name(){return"Timeline"}static get type(){return"timeline"}static get configurable(){return{height:"13em",eventLayout:"pack",barMargin:1,forceFit:!0,timeAxis:{autoAdjust:!1},readOnly:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,rowHeight:48,displayDateFormat:"L",resources:[{id:1}],columns:[]}}static get delayable(){return{fillFromTaskStore:100}}construct(e={}){const r=this;r.startDateLabel=document.createElement("label"),r.startDateLabel.className="b-timeline-startdate",r.endDateLabel=document.createElement("label"),r.endDateLabel.className="b-timeline-enddate";let t=!0;if("project"in e)if(e.project)e.project instanceof Vp&&(r.taskStore=e.project.eventStore,e.project.isInitialCommitPerformed||(t=!1,e.project.ion({name:"initialCommit",refresh({isInitialCommit:i}){i&&(r.fillFromTaskStore(),r.detachListeners("initialCommit"))},thisObj:r})),delete e.project);else throw new Error("You need to configure the Timeline with a Project");e.features=T.assign({cellEdit:!1,cellMenu:!1,columnAutoWidth:!1,columnLines:!1,columnPicker:!1,columnReorder:!1,columnResize:!1,contextMenu:!1,eventContextMenu:!1,eventDrag:!1,eventDragCreate:!1,eventEdit:!1,eventFilter:!1,eventMenu:!1,eventResize:!1,eventTooltip:!1,group:!1,headerMenu:!1,regionResize:!1,scheduleContextMenu:!1,scheduleMenu:!1,scheduleTooltip:!1,sort:!1,timeAxisHeaderMenu:!1,timeRanges:!1},e.features),super.construct(e),r.features.timeRanges&&(r.features.timeRanges.store=new ee),t&&r.fillFromTaskStore.now(),r.taskStore.ion({refreshPreCommit:r.fillFromTaskStore,changePreCommit:r.onTaskStoreChange,thisObj:r}),r.ion({resize:r.onSizeChanged,thisObj:r}),r.bodyContainer.appendChild(r.startDateLabel),r.bodyContainer.appendChild(r.endDateLabel)}onSizeChanged({width:e,oldWidth:r}){const t=this,i=e!==r;i&&t.suspendRefresh(),t.updateRowHeight(),i&&(t.resumeRefresh(),t.fitTimeline())}updateRowHeight(){this.bodyContainer.isConnected&&(this.rowHeight=this.bodyContainer.offsetHeight)}fitTimeline(){this.eventStore.count>0&&(this.forceFit=!1,this.zoomToFit({leftMargin:50,rightMargin:50}),this.forceFit=!0),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange({action:e,record:r,records:t,changes:i,isCollapse:n}){const s=this,a=s.eventStore;let o;switch(e){case"add":t.forEach(l=>{l.showInTimeline&&(a.add(s.cloneTask(l)),o=!0)});break;case"remove":n||t.forEach(l=>{l.showInTimeline&&(a.remove(l.id),o=!0)});break;case"removeall":s.fillFromTaskStore.now();break;case"update":{const l=r;if(i.showInTimeline){if(l.showInTimeline)a.add(s.cloneTask(l));else{const c=a.getById(l.id);c&&a.remove(c)}o=!0}else if(l.showInTimeline){const c=a.getById(l.id);c&&(c.set(s.cloneTask(l)),o=!0)}break}}o&&s.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,name:e.name,startDate:e.startDate,endDate:e.endDate,cls:e.cls}}render(){super.render(...arguments),this.updateRowHeight()}async fillFromTaskStore(){const e=this,r=[];e.taskStore.traverse(t=>{t.showInTimeline&&t.isScheduled&&r.push(e.cloneTask(t))}),e.events=r,await e.project.commitAsync(),!e.isDestroyed&&e.fitTimeline()}onLocaleChange(){this.updateStartEndLabels(),super.onLocaleChange()}};Iv.initClass(),Iv._$name="Timeline";var L_=[],px={remove:1,add:2,update:3},vx={TaskModel:1,DependencyModel:2,AssignmentModel:3,ProjectModel:4},yx=({parent:e,index:r})=>`${e.name}[${r}]`,$_={AssignmentModel:"Assignment",DependencyModel:"Dependency"},bx=class extends pi{};R(bx,"fields",[{name:"description",type:"string"},{name:"occurredAt",type:"date"},{name:"versionModel"},{name:"transactionModel"},{name:"propertyUpdate"},{name:"action"}]);var Ai=class extends Zc{constructor(){super(...arguments),R(this,"_transactionChanges",[]),R(this,"_versionChanges",[]),R(this,"comparingRowCls",`b-${Ai.type}-comparing`)}static get properties(){return{_rowsByUnderlyingRecord:new WeakMap,_expandedById:new Map}}construct(e){super.construct({...e,features:T.merge({},Ai.configurable.features,e.features)})}afterConstruct(){if(!this.project)throw new Error(`${Ai.$name} requires the project config.`);this.refreshGrid()}updateDateFormat(e){const r=this.columns.get("occurredAt");r&&(r.format=e)}updateProject(e){const r=this;r.detachListeners("storeChange"),r._versionStore=e.getCrudStore("versions"),r._transactionStore=e.getCrudStore("changelogs"),r._versionStore.ion({name:"storeChange",change:r.onVersionStoreChange,thisObj:r}),r._transactionStore.ion({name:"storeChange",change:r.onTransactionStoreChange,thisObj:r})}updateShowNamedVersionsOnly(){this.isPainted&&this.refreshGrid()}updateShowUnattachedTransactions(){this.isPainted&&this.refreshGrid()}updateShowVersions(){this.isPainted&&this.refreshGrid()}updateComparingVersionId(e,r){const[t,i]=[r,e].map(n=>this.store.getById(`v-${n}`));t&&(t.cls="",t.iconCls="b-icon b-icon-version"),i&&(i.cls=this.comparingRowCls,i.iconCls="b-icon b-icon-compare")}onVersionStoreChange({action:e,records:r}){this._versionChanges.push({action:e,records:r}),this.processUpdates()}onTransactionStoreChange({action:e,records:r}){this._transactionChanges.push({action:e,records:r}),this.processUpdates()}processUpdates(){const e=this,r=H.unique(e._versionChanges.flatMap(({records:n})=>n)),t=new Set(r.map(n=>String(n.id))),i=H.unique(e._transactionChanges.flatMap(({records:n})=>n).concat(r.length===0?[]:e._transactionStore.query(n=>t.has(n.versionId))));for(const n of i)n.versionId&&!t.has(n.versionId)&&(r.push(e._versionStore.getById(n.versionId)),t.add(n.versionId));e.replaceRows(H.unique(r),i),e._transactionChanges=[],e._versionChanges=[]}replaceRows(e,r){var t;const i=this,{showNamedVersionsOnly:n,showUnattachedTransactions:s,store:a}=i,o=new Set,l=H.groupBy(r,"versionId"),c=r.concat(e),d=n?e.filter(u=>u.name!=null):e;for(const u of c)for(const h of(t=i._rowsByUnderlyingRecord.get(u))!=null?t:L_)o.add(h);i.suspendRefresh(),a.remove(Array.from(o));for(const u of d){const h=a.add(i.getGridRows(u,l[u.id]));i._rowsByUnderlyingRecord.set(u,h)}if(s)for(const u of r.filter(h=>h.versionId==null)){const h=a.add(i.getGridRows(null,[u]));i._rowsByUnderlyingRecord.set(u,h)}i.resumeRefresh(),a.sort(a.sorters)}refreshGrid(){this.replaceRows(this._versionStore.records,this._transactionStore.records)}getGridRows(e,r){const t=this,{showVersions:i,comparingVersionId:n}=t,s=(r==null?void 0:r.map(o=>{var l;const c=`t-${o.id}`;return{id:c,expanded:!!((l=t._expandedById)!=null&&l.get(c)),description:o.description,occurredAt:o.occurredAt,transactionModel:o,rootVersionModel:e,children:o.actions.map((d,u)=>{var h,f,g;const m=`a-${o.id}-${u}`;return{id:m,expanded:!!((h=t._expandedById)!=null&&h.get(m)),action:d,rootVersionModel:e,children:(g=(f=d.propertyUpdates)==null?void 0:f.map(p=>({rootVersionModel:e,propertyUpdate:p})))!=null?g:[]}})}}))||[],a=`v-${e==null?void 0:e.id}`;return e&&i?{id:a,expanded:!!t._expandedById.get(a),description:e.description,occurredAt:e.savedAt,children:s,versionModel:e,iconCls:"b-icon-version",cls:e.id===n?t.comparingRowCls:null}:s}renderDescription(e){const{record:r}=e;return r.propertyUpdate?this.renderPropertyUpdate(r.propertyUpdate):r.action?this.renderActionDescription(r.action):r.description}renderPropertyUpdate(e){const r=Ai.type,{property:t,before:i,after:n}=e;return{children:[{tag:"div",class:`b-${r}-property-update-desc`,children:[{tag:"span",class:`b-${r}-property-name`,html:`${this.formatPropertyName(t)}`},this.renderPropertyValue(i,"before"),{tag:"i",class:"b-icon b-icon-right"},this.renderPropertyValue(n,"after")]}]}}renderPropertyValue(e,r){var t;return{tag:"span",class:[`b-${Ai.type}-property-${r}`,e==null&&`b-${Ai.type}-empty-value`],html:e==null?this.L("L{Versions.nullValue}"):(t=this.formatValueString(e))!=null?t:""}}formatValueString(e){return b.isDate(e)?b.format(e,this.dateFormat):typeof e=="number"?e.toFixed(2):e}formatPropertyName(e){return L.separate(e)}getAssignmentTextTokens(e){return{event:e.event.name,resource:e.resource.name}}getDependencyTextTokens(e){return{from:e.fromTask.name,to:e.toTask.name}}renderActionDescription(e){var r;const t=this,{actionType:i,entity:n}=e,s=t.L("L{Versions.entityNames}");let a,o={type:s[n.type],name:n.name};return i==="move"&&(o.from=yx(e.from),o.to=yx(e.to)),a=t.L(`L{Versions.${i}${(r=$_[n.type])!=null?r:"Entity"}}`),n.type==="DependencyModel"?o=t.getDependencyTextTokens(n):n.type==="AssignmentModel"&&(o=t.getAssignmentTextTokens(n)),a=a.replace(/\{(\w+)\}/g,(l,c)=>{var d;return(d=o[c])!=null?d:c}),e.isUser&&(a=`[!] ${a}`),t.renderHighlightedTextElements(L.capitalize(a),o)}static sortActionRows(e,r){if(e.parent===r.parent&&e.action&&r.action){const t=!!e.action.isUser,i=!!r.action.isUser,{actionType:n,entity:{type:s}}=e.action,{actionType:a,entity:{type:o}}=r.action;return t!==i?t?-1:1:Math.sign(px[n]-px[a])||Math.sign(vx[s]-vx[o])||0}return 0}triggerRestore(e){this.trigger("restore",{version:e})}triggerCompare(e){this.trigger("compare",{version:e})}triggerStopCompare(e){this.trigger("stopCompare")}renderHighlightedTextElements(e){const r=this.constructor.type;return{children:[{tag:"span",class:`b-${r}-highlighted-text`,children:e.split(/\*\*/g).reduce((t,i)=>(t.children.push({tag:"span",text:i,class:t.isEntity?`b-${r}-highlighted-entity`:null}),t.isEntity=!t.isEntity,t),{children:[],isEntity:!1}).children}]}}},Vn=Ai;R(Vn,"$name","VersionGrid"),R(Vn,"type","versiongrid"),R(Vn,"configurable",{store:{tree:!0,modelClass:bx,sorters:[{field:"occurredAt",ascending:!1},Ai.sortActionRows],reapplySortersOnAdd:!0},project:null,showUnattachedTransactions:!0,showNamedVersionsOnly:!1,showVersions:!0,comparingVersionId:null,flex:0,features:{group:{field:"id"},cellEdit:{continueEditingOnCellClick:!1,editNextOnEnterPress:!1},cellMenu:{items:{removeRow:!1,cut:!1,copy:!1,paste:!1,renameButton:{text:"L{VersionGrid.rename}",icon:"b-icon b-icon-edit",onItem:({record:e,source:r})=>{r.startEditing({id:e.id,column:r.columns.get("description")})}},restoreButton:{text:"L{VersionGrid.restore}",icon:"b-icon b-icon-undo",onItem:({record:e,source:r})=>{r.triggerRestore(e.versionModel)}},compareButton:{text:"L{VersionGrid.compare}",icon:"b-icon b-icon-compare",onItem:({record:e,source:r})=>{r.triggerCompare(e.versionModel)}},stopComparingButton:{text:"L{VersionGrid.stopComparing}",onItem:({record:e,source:r})=>{r.triggerStopCompare()}}}},rowCopyPaste:!1},columns:[{type:"tree",text:"L{VersionGrid.description}",field:"description",flex:4,groupable:!1,renderer:({grid:e,...r})=>e.renderDescription({grid:e,...r}),autoHeight:!0},{text:"L{VersionGrid.occurredAt}",field:"occurredAt",type:"date",flex:1,groupable:!1}],dateFormat:"M/D/YY h:mm a",internalListeners:{beforeCellEditStart({editorContext:{column:e,record:r}}){if(!(e.field==="description"&&r.versionModel))return!1},finishCellEdit({editorContext:{record:e,value:r}}){e.versionModel.name=r!=null&&r.trim()?r:null},cellMenuBeforeShow({source:e,record:r,items:t}){return t.stopComparingButton.disabled=!e.comparingVersionId,!!r.versionModel},toggleNode({record:e,collapse:r}){this._expandedById.set(e.id,!r)}}}),R(Vn,"delayable",{processUpdates:{type:"raf",cancelOutstanding:!0}}),Vn.initClass(),Vn._$name="VersionGrid";export{Yf as AbstractAssignmentStoreMixin,qf as AbstractCalendarManagerStoreMixin,Wf as AbstractCalendarMixin,og as AbstractCrudManager,ag as AbstractCrudManagerMixin,gw as AbstractCrudManagerValidation,Kf as AbstractDependencyStoreMixin,Xf as AbstractEventStoreMixin,Uf as AbstractHasAssignmentsMixin,Io as AbstractPartOfProjectGenericMixin,Ps as AbstractPartOfProjectModelMixin,zt as AbstractPartOfProjectStoreMixin,Yr as AbstractRecurrenceIterator,Zf as AbstractResourceStoreMixin,pn as AbstractTimeRanges,jr as ActionBase,tn as ActionColumn,pv as AdvancedTab,ms as AggregateColumn,mr as AjaxHelper,ut as AjaxStore,lg as AjaxTransport,_e as Animator,dh as ArrayDataField,H as ArrayHelper,ex as AssignmentAllocationInterval,Pi as AssignmentModel,dg as AssignmentModelMixin,bu as AssignmentStore,ug as AssignmentStoreMixin,Wu as AsyncHelper,er as AttachToProjectMixin,gs as AvatarRendering,$h as Badge,ja as Bag,Ro as Bar,F as Base,mu as BaseAllocationInfo,gu as BaseAllocationInterval,iu as BaseAssignmentMixin,In as BaseCalendarMixin,vp as BaseDependencyMixin,bp as BaseDependencyResolution,np as BaseEmptyCalendarEffectResolution,_n as BaseEventMixin,gp as BaseHasAssignmentsMixin,ou as BaseResourceMixin,ef as BooleanCombo,uh as BooleanDataField,Xs as BreakCurrentStackExecution,Y as BrowserHelper,Ya as Button,Vr as ButtonGroup,ot as CI,Gf as CIFromSetOrArrayOrValue,YC as CSSHelper,Et as CalculateProposed,ur as CalculatedValueGen,Nm as CalculatedValueGenC,ta as CalculatedValueSync,Vm as CalculatedValueSyncC,$D as CalculationGen,jD as CalculationSync,Bf as CalendarCache,td as CalendarCacheInterval,Hf as CalendarCacheIntervalMultiple,Nf as CalendarCacheMultiple,tw as CalendarCacheSingle,yu as CalendarField,tv as CalendarHighlight,Ao as CalendarIntervalMixin,Wp as CalendarIntervalModel,zf as CalendarIntervalStore,Ct as CalendarIteratorResult,Up as CalendarManagerStore,Cu as CalendarModel,ds as CalendarPanel,EE as CanCombineCalendarsMixin,ys as CellCopyPaste,kc as CellEdit,uo as CellMenu,ho as CellTooltip,Zr as ChangeLogAction,Mu as ChangeLogAssignmentEntity,Tu as ChangeLogDependencyEntity,Ca as ChangeLogEntity,Dv as ChangeLogPropertyUpdate,pa as ChangeLogStore,Ln as ChangeLogTransactionModel,rn as CheckColumn,Zi as Checkbox,wc as ChipView,TE as ChronoAbstractProjectMixin,lp as ChronoAssignmentStoreMixin,cp as ChronoCalendarManagerStoreMixin,dp as ChronoDependencyStoreMixin,ul as ChronoEventStoreMixin,f_ as ChronoEventTreeStoreMixin,ra as ChronoField,WD as ChronoGraph,We as ChronoMixinBase,sa as ChronoModelFieldIdentifier,eu as ChronoModelMixin,Jd as ChronoModelReferenceBucketFieldIdentifier,al as ChronoModelReferenceFieldIdentifier,sE as ChronoModelReferenceFieldQuark,rp as ChronoPartOfProjectGenericMixin,la as ChronoPartOfProjectModelMixin,Pn as ChronoPartOfProjectStoreMixin,pp as ChronoResourceStoreMixin,fE as ChronoStoreMixin,zm as ChronoTransaction,lc as ClickRepeater,fn as ClockTemplate,_h as CollapseTool,Mt as Collection,it as CollectionFilter,La as CollectionSorter,pe as Column,Oc as ColumnAutoWidth,Lc as ColumnDragToolbar,Lg as ColumnLines,fo as ColumnPicker,go as ColumnRename,mo as ColumnReorder,Df as ColumnResize,De as ColumnStore,qe as Combo,qd as CommitZero,Yd as ComputationCycle,Re as Config,aa as ConflictEffect,hE as ConflictEffectDescription,tp as ConflictResolution,ep as ConflictSymbol,ml as ConstrainedEarlyEventMixin,oa as ConstraintInterval,ru as ConstraintIntervalDescription,bt as ConstraintIntervalSide,be as ConstraintType,gv as ConstraintTypePicker,yt as Container,i_ as ContextGen,es as ContextMenuBase,r_ as ContextSync,nd as CoreAssignmentMixin,Jf as CoreAssignmentStoreMixin,aw as CoreCalendarManagerStoreMixin,Qf as CoreCalendarMixin,sd as CoreDependencyMixin,eg as CoreDependencyStoreMixin,Ur as CoreEventMixin,tg as CoreEventStoreMixin,lw as CoreHasAssignmentsMixin,cw as CoreHasDependenciesMixin,rd as CorePartOfProjectGenericMixin,Is as CorePartOfProjectModelMixin,_s as CorePartOfProjectStoreMixin,As as CoreResourceMixin,rg as CoreResourceStoreMixin,Xn as CoreStateTrackingManager,Cd as CrudManager,vw as CrudManagerView,Ks as CycleDescription,An as CycleEffect,CE as CycleEffectDescription,Dr as CycleResolution,wm as CycleResolutionInput,LD as CycleResolutionInputChrono,Pu as CycleResolutionPopup,ap as CycleSymbol,hd as DailyRecurrenceIterator,Xt as DataField,ns as DataGenerator,gi as DateColumn,cu as DateConstraintInterval,kE as DateConstraintIntervalDescription,hh as DateDataField,us as DateField,b as DateHelper,tu as DateInterval,eo as DatePicker,Ji as DateTimeField,at as DayTime,tx as DeactivateDependencyCycleEffectResolution,Sp as DeactivateDependencyResolution,ge as Delayable,uw as DelayableWrapper,eS as DemoBot,vn as Dependencies,dn as DependenciesCalendar,wt as DependencyBaseModel,pl as DependencyConstraintInterval,LE as DependencyConstraintIntervalDescription,Ow as DependencyCreation,rv as DependencyEdit,fa as DependencyModel,Gp as DependencyStore,xg as DependencyStoreMixin,xu as DependencyTab,$w as DependencyTooltip,bi as DependencyType,cv as DependencyTypePicker,zr as DependencyValidationResult,iD as Describable,Ue as Direction,tf as DisplayField,J as DomClassList,ze as DomDataStore,C as DomHelper,q as DomSync,_g as DragBase,ss as DragContext,Bo as DragCreateBase,Yi as DragHelper,as as DragProxy,Kh as DragTipProxy,zh as Draggable,sS as Droppable,Le as Duration,ig as DurationColumn,RE as DurationConverterMixin,no as DurationField,Ee as DurationVar,Wi as DynamicObject,dE as EMPTY_INTERVAL,Xr as EarlyLateLazyness,Cr as EdgeInclusion,Js as EdgeType,nl as EdgeTypeNormal,En as EdgeTypePast,kg as EditBase,Qt as Editor,ya as EditorTab,et as Effect,fr as EffectResolutionResult,ov as EffortField,xt as EffortVar,dl as EmptyCalendarEffect,gE as EmptyCalendarEffectDescription,ip as EmptyCalendarSymbol,av as EndDateField,ye as EndDateVar,yE as EngineReplica,op as EngineRevision,vE as EngineTransaction,Tr as Entity,GD as EntityIdentifier,UD as EntityMeta,iv as EventBuffer,yn as EventCopyPaste,ud as EventDayIndex,Ho as EventDrag,Vs as EventDragCreate,Vo as EventDragSelect,No as EventEdit,jg as EventEditor,zo as EventFilter,j as EventHelper,nx as EventLoader,Wo as EventMenu,xl as EventModel,yd as EventModelMixin,gD as EventNavigation,Uo as EventNonWorkingTime,Du as EventResize,Tl as EventSegmentDrag,qp as EventSegmentModel,Ml as EventSegmentResize,$n as EventSegments,hD as EventSelection,Su as EventStore,gg as EventStoreMixin,Td as EventTooltip,Kp as EventUpdateAction,Ae as Events,fm as ExcelExporter,Eo as ExportDialog,If as ExportOrientationCombo,Pf as ExportRowsCombo,ws as Exporter,$i as Factoryable,kM as Featureable,cS as Fencible,$e as Field,Zh as FieldContainer,hi as FieldFilterPicker,en as FieldFilterPickerGroup,tr as FieldIdentifier,Ec as FieldSet,af as FileField,zc as FileFormat,of as FilePicker,bs as FillHandle,Rf as Filter,jc as FilterBar,lf as FilterField,iS as Finalizable,ZE as FixedDurationMixin,Yc as Footer,Ii as FormTab,fc as Formatter,Ge as Formula,Nd as FormulasCache,yr as Fullscreen,Te as FunctionHelper,yv as GanttTaskEditor,lv as GeneralTab,mg as GetEventsMixin,ZA as GetTransaction,he as GlobalEvents,Xc as Grid,xs as GridBase,LS as GridElementEvents,Gc as GridExcelExporter,z as GridFeatureManager,$S as GridFeatures,$c as GridFieldFilterPicker,po as GridFieldFilterPickerGroup,vo as GridGroupSummary,Ds as GridMultiPageExporter,Es as GridMultiPageVerticalExporter,Wc as GridPdfExport,jS as GridResponsive,pi as GridRowModel,BS as GridSelection,xo as GridSinglePageExporter,HS as GridState,VS as GridSubGrids,wo as GridSummary,Bc as Group,Zg as GroupSummary,su as HasCalendarMixin,gl as HasChildrenMixin,_E as HasDateConstraintMixin,mp as HasDependenciesMixin,Ap as HasEffortMixin,Ep as HasPercentDoneMixin,AD as HasProposedNotPreviousValue,ID as HasProposedNotPreviousValueEffect,Om as HasProposedNotPreviousValueSymbol,xr as HasProposedValue,PD as HasProposedValueEffect,km as HasProposedValueSymbol,kp as HasSchedulingModeMixin,lu as HasSubEventsMixin,ln as Header,yo as HeaderMenu,Md as HeaderZoom,Ic as Histogram,wd as HorizontalLayoutPack,Dd as HorizontalLayoutStack,Xo as HorizontalRendering,Fs as HorizontalTimeAxis,$M as Hoverable,ji as IdHelper,Gn as Identifiable,Wt as Identifier,a_ as IdentifierC,hn as IndexPosition,X as InstancePlugin,Lt as Instruction,fh as IntegerDataField,Vf as IntervalCache,Zd as IsChronoModelSymbol,cg as JsonEncoder,mC as KeyMap,hs as Label,Xh as Labelable,Pd as Labels,br as Layout,Rr as Levels,di as List,zD as Listener,Wh as LoadMaskable,ct as LocaleHelper,He as LocaleManager,Ve as Localizable,ne as Location,Qe as MAX_DATE,KS as MI,ft as MIN_DATE,It as Mask,Qn as Menu,qa as MenuItem,bo as MergeCells,fi as MessageDialog,rl as Meta,mP as Minifiable,oE as MinimalChronoModelFieldIdentifierGen,aE as MinimalChronoModelFieldIdentifierSync,lE as MinimalChronoModelFieldVariable,YD as MinimalEntityIdentifier,Um as MinimalFieldIdentifierGen,sl as MinimalFieldIdentifierSync,Gm as MinimalFieldVariable,iE as MinimalReferenceBucketIdentifier,rE as MinimalReferenceBucketQuark,JD as MinimalReferenceIdentifier,ae as Model,Tn as ModelBucketField,vu as ModelCombo,gh as ModelDataField,Xd as ModelField,Zy as ModelLink,Rn as ModelReferenceField,qy as ModelStm,os as Month,gd as MonthlyRecurrenceIterator,rm as MultiPageExporter,im as MultiPageVerticalExporter,qs as NOT_VISITED,qi as Navigator,jn as NestedEvents,zs as NonWorkingTime,Xg as NonWorkingTimeMixin,vv as NotesTab,cr as NumberColumn,mh as NumberDataField,rf as NumberField,lr as NumberFormat,ph as ObjectDataField,T as ObjectHelper,U as Objects,wr as OnCycleAction,Cs as Orientation,aS as Override,QA as OwnIdentifier,Tm as OwnIdentifierSymbol,JA as OwnQuark,Rm as OwnQuarkSymbol,Ag as PackMixin,uf as PagingToolbar,Go as Pan,Nt as Panel,zi as PanelCollapser,ff as PanelCollapserOverlay,Do as PaperFormat,JM as Parser,xI as PartOfBaseProject,Bt as PartOfProject,gf as PasswordField,om as PdfExport,Eu as PercentBar,nn as PercentColumn,Yp as PercentDoneMixin,ls as PickerField,sh as Pluggable,ir as Point,st as Popup,hv as PredecessorsTab,$s as PresetManager,Sd as PresetStore,zd as PreviousValueOf,RD as PreviousValueOfEffect,_m as PreviousValueOfSymbol,Jp as ProHorizontalLayout,ev as ProHorizontalLayoutPack,Qp as ProHorizontalLayoutStack,ux as ProjectChangeHandlerMixin,mm as ProjectCombo,_w as ProjectConsumer,rx as ProjectCrudManager,xv as ProjectModel,Mw as ProjectModelCommon,Tg as ProjectModelMixin,Pw as ProjectModelTimeZoneMixin,hx as ProjectProgressMixin,Ci as ProjectType,k_ as ProjectWebSocketHandlerMixin,Va as Promissory,Dn as ProposedArgumentsOf,FD as ProposedArgumentsOfEffect,$m as ProposedArgumentsOfSymbol,we as ProposedOrPrevious,Em as ProposedOrPreviousSymbol,Ke as ProposedOrPreviousValueOf,_D as ProposedOrPreviousValueOfEffect,Lm as ProposedOrPreviousValueOfSymbol,MD as ProposedValueOf,TD as ProposedValueOfEffect,Fm as ProposedValueOfSymbol,Ud as Quark,HD as QuarkGen,ea as QuarkSync,Hc as QuickFind,pC as RTL,mf as Radio,xc as RadioGroup,is as RandomGenerator,mi as RatingColumn,qr as ReadMode,nv as ReadyStatePropagator,k as Rectangle,Bs as RectangularPathFinder,Hg as RecurrenceCombo,Bg as RecurrenceConfirmationPopup,kt as RecurrenceDayRuleEncoder,zg as RecurrenceDaysButtonGroup,Ng as RecurrenceDaysCombo,qg as RecurrenceEditor,Ns as RecurrenceEditorPanel,bn as RecurrenceFrequencyCombo,Pg as RecurrenceLegend,Vg as RecurrenceLegendButton,Eg as RecurrenceModel,Wg as RecurrenceMonthDaysButtonGroup,Ug as RecurrenceMonthsButtonGroup,Yg as RecurrencePositionsCombo,Gg as RecurrenceStopConditionCombo,ba as RecurrenceTab,Hw as RecurringEventEdit,qw as RecurringEvents,bg as RecurringEventsMixin,vd as RecurringTimeSpan,yg as RecurringTimeSpansMixin,Xm as ReferenceBucketField,Zm as ReferenceBucketIdentifier,tE as ReferenceBucketQuark,qm as ReferenceField,Km as ReferenceIdentifier,Co as RegionResize,wn as Reject,Zs as RejectEffect,el as RejectSymbol,FE as RemoveDateConstraintConflictResolution,bE as RemoveDependencyCycleEffectResolution,Cp as RemoveDependencyResolution,Hi as Renderable,Wm as Replica,Ka as ResizeHelper,Je as ResizeMonitor,jp as ResourceAllocationEventRangeCalendar,JE as ResourceAllocationEventRangeCalendarIntervalMixin,QE as ResourceAllocationEventRangeCalendarIntervalStore,pu as ResourceAllocationInfo,Bp as ResourceAllocationInterval,Np as ResourceCalendarColumn,ng as ResourceCollapseColumn,Kg as ResourceCombo,pm as ResourceFilter,ks as ResourceHeader,Hn as ResourceHistogram,sg as ResourceInfoColumn,Ws as ResourceMenu,Rl as ResourceModel,fg as ResourceModelMixin,va as ResourceNonWorkingTime,Xp as ResourceStore,hg as ResourceStoreMixin,Sr as ResourceTimeRangeModel,$o as ResourceTimeRangeStore,Us as ResourceTimeRanges,mn as ResourceTimeRangesBase,Sa as ResourceUtilization,fv as ResourcesTab,CP as Responsive,Gd as Revision,Ih as Ripple,cc as Rotatable,Ss as Row,dr as RowCopyPaste,So as RowExpander,qc as RowManager,lo as RowNumberColumn,vi as RowReorder,ht as RowsRange,DE as SEDBackwardCycleResolutionContext,hp as SEDDispatcher,fp as SEDDispatcherIdentifier,wE as SEDForwardCycleResolutionContext,up as SEDGraphDescription,UE as SEDWUDispatcher,GE as SEDWUDispatcherIdentifier,Ac as Scale,zp as ScaleColumn,Hs as ScheduleContext,Id as ScheduleMenu,Di as ScheduleRange,nm as ScheduleRangeCombo,hm as ScheduleTableExporter,Yo as ScheduleTooltip,OE as ScheduledByDependenciesEarlyEventMixin,gm as Scheduler,Cv as SchedulerAdvancedTab,Fo as SchedulerAssignmentModel,ko as SchedulerAssignmentStore,Ei as SchedulerBase,au as SchedulerBasicEvent,PE as SchedulerBasicProjectMixin,ad as SchedulerCoreEvent,hw as SchedulerCoreProjectMixin,Ld as SchedulerDatePicker,Rd as SchedulerDependencyEdit,Dt as SchedulerDependencyModel,bd as SchedulerDependencyStore,nD as SchedulerDom,sD as SchedulerDomEvents,Oo as SchedulerEventModel,aD as SchedulerEventRendering,js as SchedulerEventResize,Lo as SchedulerEventStore,sm as SchedulerExportDialog,bv as SchedulerGeneralTab,Gr as SchedulerPartOfProject,Pv as SchedulerPro,wp as SchedulerProAssignmentMixin,_l as SchedulerProBase,Dl as SchedulerProCycleEffect,Dp as SchedulerProDependencyMixin,$p as SchedulerProEvent,fx as SchedulerProEventRendering,hu as SchedulerProHasAssignmentsMixin,Vp as SchedulerProProjectMixin,Hp as SchedulerProResourceMixin,Rg as SchedulerProjectCrudManager,Ls as SchedulerProjectModel,cD as SchedulerRegions,Os as SchedulerResourceModel,cd as SchedulerResourceStore,lD as SchedulerScroll,uD as SchedulerState,oD as SchedulerStores,Sv as SchedulerTaskEditor,ol as SchedulingIssueEffectResolution,gx as SchedulingIssueResolution,Al as SchedulingIssueResolutionPopup,je as SchedulingMode,mv as SchedulingModePicker,nE as Schema,Sc as ScrollManager,or as Scroller,Vc as Search,vg as SharedEventStoreMixin,Jg as SimpleEventEdit,am as SinglePageExporter,vf as SlideToggle,pf as Slider,Nc as Sort,ew as SortedMap,bf as Splitter,sv as StartDateField,ve as StartDateVar,Xl as State,si as StateBase,Un as StateProvider,Wn as StateStorage,Zp as StateTrackingManager,Tf as StickyCells,Cn as StickyEvents,ee as Store,sb as StoreCRUD,pb as StoreChained,ab as StoreChanges,ka as StoreDataField,ob as StoreFilter,lb as StoreGroup,cb as StoreProxy,db as StoreRelation,fb as StoreSearch,gb as StoreSort,vb as StoreState,Sb as StoreStm,ub as StoreSum,bb as StoreSync,yb as StoreTree,Zl as StringDataField,L as StringHelper,Mf as Stripe,SP as Styleable,cn as SubGrid,uv as SuccessorsTab,em as Summary,Wd as SynchronousCalculationStarted,Rc as Tab,Cf as TabBar,Sf as TabPanel,Uc as TableExporter,Ru as TaskEdit,jo as TaskEditStm,Pl as TaskEditorBase,ps as TemplateColumn,Jt as TemplateHelper,wf as TextAreaField,Pc as TextAreaPickerField,Xi as TextField,Mg as TimeAxis,od as TimeAxisColumn,Ad as TimeAxisHeaderMenu,cm as TimeAxisSubGrid,lm as TimeAxisViewModel,sn as TimeColumn,io as TimeField,ro as TimePicker,_d as TimeRanges,Fd as TimeSelection,St as TimeSpan,wv as TimeSpanHighlight,Ed as TimeSpanMenuBase,Q as TimeUnit,pt as TimeZoneHelper,Ew as TimeZonedDatesMixin,Iv as Timeline,Ko as TimelineBase,Ww as TimelineDateMapper,Uw as TimelineDomEvents,Kw as TimelineEventRendering,Xw as TimelineScroll,Jw as TimelineState,Qg as TimelineSummary,Gw as TimelineViewPresets,Yw as TimelineZoomable,At as Toast,Se as TombStone,Ni as Tool,Lh as Toolable,Jn as Toolbar,ue as Tooltip,Og as TooltipBase,rc as Transaction,VD as TransactionCycleDetectionWalkContext,xm as TransactionSymbol,ND as TransactionWalkDepth,yi as Tree,an as TreeColumn,Rs as TreeCombo,Zc as TreeGrid,on as TreeGroup,Ky as TreeNode,$d as UndoRedo,Dc as UndoRedoBase,jt as UnitsVar,t_ as UnsafePreviousValueOf,OD as UnsafePreviousValueOfEffect,Bm as UnsafePreviousValueOfSymbol,e_ as UnsafeProposedOrPreviousValueOf,kD as UnsafeProposedOrPreviousValueOfEffect,jm as UnsafeProposedOrPreviousValueOfSymbol,rw as UnspecifiedTimeIntervalModel,Ha as UpdateAction,mE as Use24hrsEmptyCalendarEffectResolution,pE as Use8hrsEmptyCalendarEffectResolution,Sn as VISITED_TOPOLOGICALLY,il as Variable,Hm as VariableC,Er as VariableInputState,DD as VariableWalkContext,Vn as VersionGrid,re as VersionHelper,ga as VersionModel,ma as VersionStore,Il as Versions,Od as VerticalRendering,ld as VerticalTimeAxisColumn,Si as ViewPreset,Gs as ViewPresetCombo,Sm as WalkContext,qn as WalkHelper,CD as WalkSource,Dm as WalkState,Vt as Wbs,Za as WebSocketManager,fd as WeeklyRecurrenceIterator,$ as Widget,Nr as WidgetColumn,rs as WidgetHelper,ED as Write,Pm as WriteEffect,xD as WriteSeveral,Am as WriteSeveralEffect,Im as WriteSeveralSymbol,Mm as WriteSymbol,QC as XMLHelper,ui as YearPicker,md as YearlyRecurrenceIterator,Po as binarySearch,eE as bucket,KD as build_proposed,oe as calculate,AE as calculateEffectiveEndDateConstraintInterval,IE as calculateEffectiveStartDateConstraintInterval,gI as combineCalendars,Ym as createEntityOnPrototype,SD as cycleInfo,Mn as dateConverter,nw as delay,Ti as durationFormula,Sl as effortFormula,_p as endDateByEffortFormula,Pr as endDateFormula,xn as ensureEntityOnPrototype,c_ as entity,Jm as entityDecoratorBody,Ce as field,Lp as fixedDurationAndEffortSEDWUGraphDescription,XE as fixedDurationSEDWUBackwardEffortDriven,KE as fixedDurationSEDWUBackwardNonEffortDriven,qE as fixedDurationSEDWUForwardEffortDriven,YE as fixedDurationSEDWUForwardNonEffortDriven,Op as fixedDurationSEDWUGraphDescription,Wr as format,Ot as generic_field,cE as getDecoratedModelFields,Qd as injectStaticFieldsProperty,Ri as intersectIntervals,jd as isAtomicValue,un as isDateFinite,iw as isNotNumber,na as isSerializableEqual,$f as later,de as model_field,fe as prototypeValue,ZD as reference,yD as required,tl as runGeneratorAsyncWithEffect,BD as runGeneratorSyncWithEffect,Fp as startDateByEffortFormula,Mr as startDateFormula,Ms as stripDuplicates,hr as throwUnknownIdentifier,Kt as unitMagnitudes,ua as unitsFormula,bD as validateRequiredProperties,Kr as write};
//# sourceMappingURL=schedulerpro.module.min.js.map
