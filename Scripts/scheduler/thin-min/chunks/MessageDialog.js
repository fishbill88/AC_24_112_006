/*!
 *
 * Bryntum Scheduler Pro 5.3.7
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Ae=Object.defineProperty;var He=(m,e,t)=>e in m?Ae(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var x=(m,e,t)=>(He(m,typeof e!="symbol"?e+"":e,t),t);import{Base as Z,DomHelper as d,GlobalEvents as ve,Rectangle as L,Delayable as Ve,EventHelper as C,Events as ae,ObjectHelper as F,BrowserHelper as se,Widget as E,Point as De,Mask as ze,Toast as Xe,StringHelper as le,LocaleManagerSingleton as ke,DateHelper as u,DayTime as Be,Panel as Ce,Tooltip as Ue,TimeZoneHelper as je,ArrayHelper as X,Field as xe,TextField as we,Combo as Ke,PickerField as Se,Container as oe,Duration as B,VersionHelper as qe,DomClassList as Me,Popup as Ge}from"./Editor.js";var Ze=m=>class extends(m||Z){static get $name(){return"DragHelperContainer"}initContainerDrag(){const t=this;if(t.mode||(t.mode="container"),t.mode==="container"&&!t.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(t){const i=this;if(!i.ignoreSelector||!t.target.closest(i.ignoreSelector)){const r=d.getAncestor(t.target,i.containers,i.outerElement);if(r){const n=r.getBoundingClientRect();i.context={element:r,valid:!0,action:"container",offsetX:t.pageX-n.left,offsetY:t.pageY-n.top,originalPosition:{parent:r.parentElement,prev:r.previousElementSibling,next:r.nextElementSibling}}}return!0}return!1}startContainerDrag(t){var i;const r=this,{context:n,floatRootOwner:s}=r,{element:a}=n,l=a.cloneNode(!0),o=a.getBoundingClientRect(),c=s==null?void 0:s.element.closest(".b-outer");l.classList.add(r.dragProxyCls),l.classList.add(r.draggingCls),((s==null?void 0:s.floatRoot)||d.getRootElement(a)).appendChild(l),n.dragProxy=l,l.style.width=o.width+"px",l.style.height=o.height+"px",d.setTranslateXY(n.dragProxy,o.left,o.top),n.dragging=a,a.classList.add(r.dropPlaceholderCls),c!=null&&(i=c.parentElement)!==null&&i!==void 0&&i.matches(".b-float-root")&&(l.style.zIndex=s.floatRootMaxZIndex+1)}updateContainerDrag(t){var i;const r=this,{context:n}=r;if(!n.started||!n.targetElement)return;const s=d.getAncestor(n.targetElement,r.containers,"b-gridbase"),a=(i=n.dragging)===null||i===void 0?void 0:i.contains(d.getActiveElement(n.dragging));s&&d.isDescendant(n.element,s)||(a&&ve.suspendFocusEvents(),s&&n.valid?r.moveNextTo(s,t):r.revertPosition(),a&&ve.resumeFocusEvents(),t.preventDefault())}finishContainerDrag(t){const i=this,{context:r}=i,{dragging:n,dragProxy:s,valid:a,draggedTo:l,insertBefore:o,originalPosition:c}=r;n&&(r.valid=a&&l&&(n!==o||c.parent!==l),r.finalize=(g=r.valid)=>{!g&&i.context&&i.revertPosition(),n.classList.remove(i.dropPlaceholderCls),s.remove(),i.reset()},r.async=!1,i.trigger("drop",{context:r,event:t}),r.async||r.finalize())}abortContainerDrag(t=!1,i=null,r=!1){const n=this,{context:s}=n;s.dragging&&(s.dragging.classList.remove(n.dropPlaceholderCls),s.dragProxy.remove(),n.revertPosition()),r||n.trigger(t?"drop":"abort",{context:s,event:i}),n.reset()}updateContainerProxy(t){const i=this,{context:r}=i,n=r.dragProxy;let s=t.pageX-r.offsetX,a=t.pageY-r.offsetY;typeof i.minX=="number"&&(s=Math.max(i.minX,s)),typeof i.maxX=="number"&&(s=Math.min(i.maxX-n.offsetWidth,s)),typeof i.minY=="number"&&(a=Math.max(i.minY,a)),typeof i.maxY=="number"&&(a=Math.min(i.maxY-n.offsetHeight,a)),i.lockX?d.setTranslateY(n,a):i.lockY?d.setTranslateX(n,s):d.setTranslateXY(n,s,a);let l;if(t.type==="touchmove"){const o=t.changedTouches[0];l=d.elementFromPoint(o.clientX,o.clientY)}else l=t.target;r.targetElement=l}moveNextTo(t,i){const{context:r}=this,n=r.dragging,s=t.parentElement;if(t!==n){const a=L.from(t).center.x;this.isRTL&&i.pageX>a||!this.isRTL&&i.pageX<a?(s.insertBefore(n,t),r.insertBefore=t):t.nextElementSibling?t.nextElementSibling!==n?(r.insertBefore=t.nextElementSibling,s.insertBefore(n,t.nextElementSibling)):!r.insertBefore&&n.parentElement.lastElementChild!==n&&(r.insertBefore=t.nextElementSibling):(s.appendChild(n),r.insertBefore=null),r.draggedTo=s}}revertPosition(){const{context:t}=this,{dragging:i}=t,{parent:r,next:n}=t.originalPosition;n?n.previousSibling===i||!n&&i===r.lastChild||r.insertBefore(i,n):r.appendChild(i),t.draggedTo=null}};const Je={pageXOffset:0,pageYOffset:0};var Qe=m=>class extends Ve(m||Z){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const t=this;!t.isElementDraggable&&t.targetSelector&&(t.isElementDraggable=i=>i.closest(t.targetSelector))}grabTranslateDrag(t){const i=this.getTarget(t);return i?(this.context={valid:!0,element:i,startPageX:t.pageX,startPageY:t.pageY,startClientX:t.clientX,startClientY:t.clientY},!0):!1}getTarget(t){return t.target.closest(this.targetSelector)}getX(t){return this.positioning==="absolute"?parseFloat(t.style.left,10):d.getTranslateX(t)}getY(t){return this.positioning==="absolute"?parseFloat(t.style.top,10):d.getTranslateY(t)}getXY(t){return this.positioning==="absolute"?[t.offsetLeft,t.offsetTop]:d.getTranslateXY(t)}setXY(t,i,r){this.skipUpdatingElement||(this.positioning==="absolute"?(t.style.left=i+"px",t.style.top=r+"px"):d.setTranslateXY(t,i,r))}startTranslateDrag(t){const i=this,{context:r,outerElement:n,proxySelector:s}=i,a=i.dragWithin=i.dragWithin||i.cloneTarget&&document.body;let l=r.dragProxy||r.element;const o=l,c=l.parentElement;if(i.cloneTarget){const g=s?l.querySelector(s):l,{width:p,height:f,x:v,y:b}=L.from(g,a);l=i.createProxy(l);let y=v,M=b;if(i.autoSizeClonedTarget&&(l.style.width=`${p}px`,l.style.height=`${f}px`),l.classList.add(i.dragProxyCls,i.draggingCls),l.classList.remove("b-hover","b-selected","b-focused"),a.appendChild(l),!i.autoSizeClonedTarget||s){const k=l.getBoundingClientRect(),{x:T,y:w}=a.getBoundingClientRect(),O=t.clientX-T,D=t.clientY-w+(a!==document.body?document.body.getBoundingClientRect().y:0);y=O-k.width/2,M=D-k.height/2,r.startPageX=t.pageX,r.startPageY=t.pageY}i.setXY(l,y,M),o.classList.add("b-drag-original"),i.hideOriginalElement&&o.classList.add("b-hidden")}l.classList.add(i.draggingCls),Object.assign(r,{element:l,grabbed:o,grabbedParent:c,grabbedNextSibling:l.nextElementSibling,elementStartX:i.getX(l),elementStartY:i.getY(l),elementX:d.getOffsetX(l,a||n),elementY:d.getOffsetY(l,a||n),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!i.cloneTarget||a===n}),a&&(r.parentElement=l.parentElement,a!==l.parentElement&&a.appendChild(l),i.updateTranslateProxy(t))}onDragStarted(){var t;const i=this,{context:r}=i;let{relatedElements:n}=r;if(i.unifiedProxy&&r.element.classList.add("b-drag-main","b-drag-unified-proxy"),((t=n)===null||t===void 0?void 0:t.length)>0){r.relatedElStartPos=[],r.relatedElDragFromPos=[];const{proxySelector:s}=i;let[a,l]=[r.elementStartX,r.elementStartY];r.originalRelatedElements=n,n=r.relatedElements=n.map((o,c)=>{const g=s?o.querySelector(s):o,{x:p,y:f,width:v,height:b}=L.from(g,i.dragWithin),y=i.cloneTarget?i.createProxy(o):o;return y.classList.add(i.draggingCls),y.classList.remove("b-hover","b-selected","b-focused"),i.cloneTarget&&(i.setXY(y,p,f),i.dragWithin.appendChild(y),y.classList.add(i.dragProxyCls),i.autoSizeClonedTarget&&(y.style.width=`${v}px`,y.style.height=`${b}px`),i.hideOriginalElement&&o.classList.add("b-hidden"),o.classList.add("b-drag-original")),r.relatedElStartPos[c]=r.relatedElDragFromPos[c]=i.getXY(y),i.unifiedProxy&&(y.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),a+=i.unifiedOffset,l+=i.unifiedOffset,i.setXY(y,a,l),r.relatedElDragFromPos[c]=[a,l],y.style.zIndex=100-c),y}),i.unifiedProxy&&n&&n.length>0&&C.onTransitionEnd({element:n[0],property:"transform",handler(){n.forEach(o=>o.classList.remove("b-drag-unified-animation"))},thisObj:i,once:!0})}}applyConstraints(t,i,r){const n=this,{constrain:s,dragWithin:a}=n,{pageXOffset:l,pageYOffset:o}=a===document.body?globalThis:Je;return a&&s&&(i<0&&(i=0),i+t.offsetWidth>a.scrollWidth&&(i=a.scrollWidth-t.offsetWidth),r<0&&(r=0),r+t.offsetHeight>a.scrollHeight&&(r=a.scrollHeight-t.offsetHeight)),typeof n.minX=="number"&&(i=Math.max(n.minX+l,i)),typeof n.maxX=="number"&&(i=Math.min(n.maxX+l,i)),typeof n.minY=="number"&&(r=Math.max(n.minY+o,r)),typeof n.maxY=="number"&&(r=Math.min(n.maxY+o,r)),{constrainedX:i,constrainedY:r}}updateTranslateProxy(t,i){const r=this,{lockX:n,lockY:s,context:a}=r,l=a.dragProxy||a.element,{relatedElements:o,relatedElDragFromPos:c}=a;a.scrollManagerElementContainsDragProxy&&i&&(a.scrollX=i.getRelativeLeftScroll(l),a.scrollY=i.getRelativeTopScroll(l)),a.pageX=t.pageX,a.pageY=t.pageY,a.clientX=t.clientX,a.clientY=t.clientY;let g=a.elementStartX+t.pageX-a.startPageX+a.scrollX,p=a.elementStartY+t.pageY-a.startPageY+a.scrollY;if(r.snapCoordinates){const b=r.snapCoordinates({element:l,newX:g,newY:p});g=b.x,p=b.y}const{constrainedX:f,constrainedY:v}=r.applyConstraints(l,g,p);if((a.started||f!==g||v!==p)&&r.setXY(l,n?void 0:f,s?void 0:v),o){const b=n?0:f-a.elementStartX,y=s?0:v-a.elementStartY;o.forEach((M,k)=>{const[T,w]=c[k];r.setXY(M,T+b,w+y)})}a.newX=f,a.newY=v}async finishTranslateDrag(t){const i=this,r=i.context,{target:n}=t,s=!i.lockX&&Math.round(r.newX)!==Math.round(r.elementStartX),a=!i.lockY&&Math.round(r.newY)!==Math.round(r.elementStartY),l=r.dragProxy||r.element,{relatedElements:o}=r;if(!i.ignoreSamePositionDrop||s||a)if(r.valid===!1)await i.abortTranslateDrag(!0,t);else{const c=!i.allowDropOutside&&L.from(i.dragWithin||i.outerElement);c&&(typeof i.minX!="number"&&i.minX!==!0&&t.pageX<c.left||typeof i.maxX!="number"&&i.maxX!==!0&&t.pageX>c.right||typeof i.minY!="number"&&i.minY!==!0&&t.pageY<c.top||typeof i.maxY!="number"&&i.maxY!==!0&&t.pageY>c.bottom)?await i.abortTranslateDrag(!0,t):(r.finalize=async(g=r.valid)=>{if(r.finalized){console.warn("DragHelper: Finalizing already finalized drag");return}r.finalized=!0,!g&&i.context&&await i.abortTranslateDrag(!0,null,!0),i.isDestroyed||(i.trigger("dropFinalized",{context:r,event:t,target:n}),i.reset()),!i.cloneTarget&&l.parentElement!==r.grabbedParent&&[l,...o||[]].forEach(p=>p.style.transform="")},r.async=!1,await i.trigger("drop",{context:r,event:t,target:n}),r.async||await r.finalize())}else i.abortTranslateDrag(!1,t)}async abortTranslateDrag(t=!1,i=null,r=!1){var n,s;const a=this,{cloneTarget:l,context:o,proxySelector:c,dragWithin:g,draggingCls:p}=a,{relatedElements:f,relatedElStartPos:v,grabbed:b}=o,y=o.dragProxy||o.element;if(o.valid=!1,(n=a.scrollManager)===null||n===void 0||n.stopMonitoring(),o.aborted){console.warn("DragHelper: Aborting already aborted drag");return}let{elementStartX:M,elementStartY:k}=o;const T=M!==a.getX(y)||k!==a.getY(y);if(y&&o.started){if(!l&&g&&g!==o.grabbedParent&&o.grabbedParent.insertBefore(y,o.grabbedNextSibling),l&&c){const w=b.querySelector(c)||b,{x:O,y:D}=L.from(w);M=O,k=D}y.classList.add("b-aborting"),a.setXY(y,M,k),f==null||f.forEach((w,O)=>{w.classList.remove(p),w.classList.add("b-aborting"),a.setXY(w,v[O][0],v[O][1])}),r||a.trigger(t?"drop":"abort",{context:o,event:i}),y.isConnected&&!a.isDestroying&&T&&await C.waitForTransitionEnd({element:y,property:d.getPropertyTransitionDuration(y,"transform")?"transform":"all",thisObj:a,once:!0,runOnDestroy:!0}),a.isDestroyed||a.trigger("abortFinalized",{context:o,event:i})}(s=a.context)!==null&&s!==void 0&&s.started&&a.reset()}cleanUp(){const t=this,{context:i,cloneTarget:r,draggingCls:n,dragProxyCls:s}=t,a=i.dragProxy||i.element,{relatedElements:l,originalRelatedElements:o,grabbed:c}=i,g=r&&(t.removeProxyAfterDrop||!i.valid),p=[n,"b-aborting",s,"b-drag-main","b-drag-unified-proxy"];a.classList.remove(...p),g&&a.remove(),l==null||l.forEach(f=>{g?f.remove():f.classList.remove(...p)}),c.classList.remove("b-drag-original","b-hidden"),o==null||o.forEach(f=>f.classList.remove("b-hidden","b-drag-original"))}};const U={move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class Te extends Z.mixin(ae,Ze,Qe){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,i={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),C.on(i)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let i=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.mode==="closed"&&(i=e.closest(".b-outer")||i),i}get isRTL(){var e;return!!(!((e=this.rtlSource)===null||e===void 0)&&e.rtl)}onPointerDown(e){const t=this;if(e.button!==0||!d.isVisible(e.target)||t.context||t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;if(t.startEvent=e,t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e)){t.blurDetacher=C.on({element:globalThis,blur:t.onWindowBlur,thisObj:t});const r={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:U.keydown};if(e.pointerType==="touch"?(t.touchStartTimer=t.setTimeout(()=>t.touchStartTimer=null,t.touchStartDelay,"touchStartDelay"),r.touchmove={handler:U.touchmove,passive:!1},r.touchend=r.pointerup=U.touchend):(r.pointermove=U.move,r.pointerup=U.up),t.dragListenersDetacher=C.on(r),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const n=L.from(t.dragWithin,t.outerElement);t.minY=n.top,t.maxY=n.bottom,t.minX=n.left,t.maxX=n.right}}}internalMove(e){var t;if(e.scrollInitiated)return;const i=this,{context:r}=i,n=C.getDistanceBetween(i.startEvent,e);if(i.touchStartTimer&&n>i.dragThreshold){i.abort(!0);return}if(!i.touchStartTimer&&r!==null&&r!==void 0&&r.element&&(r.started||n>=i.dragThreshold)&&((t=e.target)===null||t===void 0?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!r.started){var a,l;if(i.trigger("beforeDragStart",{context:r,event:e})===!1)return i.abort();i.isContainerDrag?i.startContainerDrag(e):i.startTranslateDrag(e),r.started=!0,(a=i.scrollManager)===null||a===void 0||a.startMonitoring(F.merge({scrollables:[{element:i.dragWithin||i.outerElement}],callback:i.onScrollManagerScrollCallback},i.monitoringConfig)),r.outermostEl=d.getOutermostElement(e.target),r.outermostEl.classList.add("b-draghelper-active"),i.dropTargetSelector&&i.dropTargetCls&&d.getRootElement(i.outerElement).querySelectorAll(i.dropTargetSelector).forEach(o=>o.classList.add(i.dropTargetCls)),i.trigger("dragStart",{context:r,event:e}),(l=i.onDragStarted)===null||l===void 0||l.call(i),i.trigger("afterDragStart",{context:r,event:e})}i.update(e),e.type==="touchmove"&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:i}=this;(t=this.context)!==null&&t!==void 0&&t.element&&i&&(i.isScroll=!0,this.update(i,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const i=this,{context:r}=i,n=document.scrollingElement||document.body;let s=i.getMouseMoveEventTarget(e);if(e.type==="touchmove"){const o=e.changedTouches[0];s=d.elementFromPoint(o.clientX+n.scrollLeft,o.clientY+n.scrollTop)}r.target=s;let a=i.allowDropOutside||!i.dragWithin||i.dragWithin.contains(e.target);if(a&&i.dropTargetSelector){var l;a=a&&!!(!((l=s)===null||l===void 0)&&l.closest(i.dropTargetSelector))}i.isContainerDrag?i.updateContainerProxy(e,t):i.updateTranslateProxy(e,t),r.valid=a,i.trigger("drag",{context:r,event:e}),i.isContainerDrag&&i.updateContainerDrag(e,t),r.valid=r.valid&&a;for(const o of i.draggedElements)o.classList.toggle(i.invalidCls,!r.valid);e&&(i.lastMouseMoveEvent=e)}get draggedElements(){var t;const{context:e}=this;return[e.dragProxy||e.element,...(t=e.relatedElements)!=null?t:[]]}async abort(e=!1){var t,i;const r=this,{context:n}=r;(t=r.scrollManager)===null||t===void 0||(i=t.stopMonitoring)===null||i===void 0||i.call(t),r.removeListeners(),n!=null&&n.started&&!n.aborted?(n.element.getBoundingClientRect(),n.valid=!1,r.isContainerDrag?r.abortContainerDrag(void 0,void 0,e):r.abortTranslateDrag(void 0,void 0,e),n.aborted=!0):r.reset(!0)}removeListeners(){var e,t;(e=this.dragListenersDetacher)===null||e===void 0||e.call(this),(t=this.blurDetacher)===null||t===void 0||t.call(this)}reset(e){const t=this,{context:i}=t;if(i!=null&&i.started){for(const r of t.draggedElements)r.classList.remove(t.invalidCls);i.outermostEl.classList.remove("b-draghelper-active"),t.isContainerDrag?i.dragProxy.remove():t.cleanUp(),t.dropTargetSelector&&t.dropTargetCls&&d.getRootElement(t.outerElement).querySelectorAll(t.dropTargetSelector).forEach(r=>r.classList.remove(t.dropTargetCls))}t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,{context:i}=t;if(t.removeListeners(),i){var r;(r=t.scrollManager)===null||r===void 0||r.stopMonitoring(),i.started?(e.stopPropagation(),i.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),C.on({element:document,thisObj:t,click:U.docclick,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.reset(!0)}}onKeyDown(e){var t;(t=this.context)!==null&&t!==void 0&&t.started&&e.key==="Escape"&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return this.mode==="container"}async animateProxyTo(e,t={align:"c-c"}){const{context:i,draggedElements:r}=this,{element:n}=i,s=e.isRectangle?e:L.from(e);r.forEach(a=>{a.classList.add("b-drag-final-transition"),d.alignTo(a,s,t)}),await C.waitForTransitionEnd({element:n,property:"all",thisObj:this,once:!0}),r.forEach(a=>a.classList.remove("b-drag-final-transition"))}get isDragging(){var e;return!!(!((e=this.context)===null||e===void 0)&&e.started)}getMouseMoveEventTarget(e){return e.isScroll?d.elementFromPoint(e.clientX,e.clientY):e.target}}Te._$name="DragHelper";const I={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class ue extends ae(Z){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const t=this;super.construct(e),!t.handleSelector&&!se.isHoverableDevice&&(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:t,element:i,event:r}=e.grab;e.startEvent=r;const n=e.getCursorOffsetToElementEdge(r,i,t);e.context={element:i,edge:t,valid:!0,async:!1,elementStartX:d.getTranslateX(i)||i.offsetLeft,elementStartY:d.getTranslateY(i)||i.offsetTop,newX:d.getTranslateX(i)||i.offsetLeft,newY:d.getTranslateY(i)||i.offsetTop,elementWidth:i.offsetWidth,elementHeight:i.offsetHeight,cursorOffset:n,startX:r.clientX+n.x+e.scrollLeft,startY:r.clientY+n.y+e.scrollTop,finalize:()=>{var s;return(s=e.reset)===null||s===void 0?void 0:s.call(e)}},i.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:I.down,touchstart:I.touchstart,thisObj:e};!e.handleSelector&&se.isHoverableDevice&&(t.mousemove={handler:I.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),C.on(t)}get isRTL(){var e;return!!(!((e=this.rtlSource)===null||e===void 0)&&e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:I.keydown,thisObj:this};e?(t.touchmove=I.touchmove,t.touchend=t.pointerup=I.touchend):(t.mousemove=I.move,t.mouseup=I.up),this.removeDragListeners=C.on(t)}removeDragListeners(){}reset(){var e;(e=this.removeDragListeners)===null||e===void 0||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const i=this;i.startEvent=t,i.canResize(t.target,t)&&i.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),t.type==="touchstart"&&t.preventDefault(),i.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){e.button===0&&this.onPointerDown(!1,e)}internalMove(e,t){const i=this,{context:r,direction:n}=i;if(r!=null&&r.element&&(r.started||C.getDistanceBetween(i.startEvent,t)>=i.dragThreshold)){if(!r.started){var s;(s=i.scrollManager)===null||s===void 0||s.startMonitoring(F.merge({scrollables:[{element:i.dragWithin||i.outerElement,direction:n}],callback:a=>{var l;return((l=i.context)===null||l===void 0?void 0:l.element)&&i.lastMouseMoveEvent&&i.update(i.lastMouseMoveEvent,a)}},i.monitoringConfig)),i.trigger("resizeStart",{context:r,event:t}),r.started=!0}i.update(t)}else!e&&!i.handleSelector&&i.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var i;const r=this,n=r.context;if((i=r.removeDragListeners)===null||i===void 0||i.call(r),n){var s;(s=r.scrollManager)===null||s===void 0||s.stopMonitoring(),n.started&&C.on({element:document,thisObj:r,click:I.docclick,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t)}else{var a;(a=r.reset)===null||a===void 0||a.call(r)}}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){e.key==="Escape"&&this.abort()}update(e){const t=this,i=t.context,r=L.from(t.outerElement);i.currentX=Math.max(Math.min(e.clientX+i.cursorOffset.x,r.right),r.x)+t.scrollLeft,i.currentY=Math.max(Math.min(e.clientY+i.cursorOffset.y,r.bottom),r.y)+t.scrollTop,e&&(t.updateResize(e)&&(t.trigger("resizing",{context:i,event:e}),i.element.classList.toggle(t.invalidCls,i.valid===!1)),t.lastMouseMoveEvent=e)}abort(e=!1){var t,i;const r=this;(t=r.scrollManager)===null||t===void 0||(i=t.stopMonitoring)===null||i===void 0||i.call(t),r.context?r.abortResize(null,e):r.isDestroyed||r.reset()}grabResizeHandle(e,t){const i=this;if(i.allowResize&&!i.allowResize(t.target,t))return!1;const r=i.handleSelector,n=t.type==="touchstart"?t.changedTouches[0]:t,s=n.clientX,a=n.clientY,l=i.targetSelector?t.target.closest(i.targetSelector):t.target;if(l){let o;if(r)if(t.target.matches(r))i.direction==="horizontal"?t.pageX<d.getPageX(l)+l.offsetWidth/2?o=i.isRTL?"right":"left":o=i.isRTL?"left":"right":t.pageY<d.getPageY(l)+l.offsetHeight/2?o="top":o="bottom";else return!1;else if(i.direction==="horizontal"?i.overLeftHandle(t,l)?o=i.isRTL?"right":"left":i.overRightHandle(t,l)&&(o=i.isRTL?"left":"right"):i.overTopHandle(t,l)?o="top":i.overBottomHandle(t,l)&&(o="bottom"),!o)return i.context=null,!1;t.type==="touchstart"&&t.preventDefault();const c=i.getCursorOffsetToElementEdge(n,l,o);if(i.trigger("beforeResizeStart",{element:l,event:t})!==!1)return i.context={element:l,edge:o,isTouch:e,valid:!0,async:!1,direction:i.direction,elementStartX:d.getTranslateX(l)||l.offsetLeft,elementStartY:d.getTranslateY(l)||l.offsetTop,newX:d.getTranslateX(l)||l.offsetLeft,newY:d.getTranslateY(l)||l.offsetTop,elementWidth:l.offsetWidth,elementHeight:l.offsetHeight,cursorOffset:c,startX:s+c.x+i.scrollLeft,startY:a+c.y+i.scrollTop,finalize:()=>{var g;return(g=i.reset)===null||g===void 0?void 0:g.call(i)}},l.classList.add(i.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,i){const r=L.from(t);let n=0,s=0;switch(i){case"left":n=r.x-(this.isRTL?r.width:0)-e.clientX;break;case"right":n=r.x+(this.isRTL?0:r.width)-e.clientX;break;case"top":s=r.y-e.clientY;break;case"bottom":s=r.y+r.height-e.clientY;break}return{x:n,y:s}}checkResizeHandles(e){const t=this,i=t.targetSelector?e.target.closest(t.targetSelector):e.target;if(i&&(!t.allowResize||t.allowResize(e.target,e))){if(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement){let r;t.direction==="horizontal"?r=t.overLeftHandle(e,i)||t.overRightHandle(e,i):r=t.overTopHandle(e,i)||t.overBottomHandle(e,i),r?t.highlightHandle():t.unHighlightHandle()}}else t.currentElement&&t.unHighlightHandle()}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,{context:i,allowEdgeSwitch:r,skipTranslate:n,skipUpdatingElement:s}=t;let a;r&&(t.direction==="horizontal"?i.edge=i.currentX>i.startX?"right":"left":i.edge=i.currentY>i.startY?"bottom":"top");const{element:l,elementStartX:o,elementStartY:c,elementWidth:g,elementHeight:p,edge:f}=i,{style:v}=l,b=i.currentX-i.startX,y=i.currentY-i.startY,M=d.getExtremalSizePX(l,"minWidth")||t.minWidth,k=d.getExtremalSizePX(l,"maxWidth")||t.maxWidth,T=d.getExtremalSizePX(l,"minHeight")||t.minHeight,w=d.getExtremalSizePX(l,"maxHeight")||t.maxHeight,O=f==="right"&&!t.isRTL||f==="bottom"?1:-1,D=g+b*O,P=p+y*O;let S=Math.max(M,D),Y=Math.max(T,P);if(k>0&&(S=Math.min(S,k)),w>0&&(Y=Math.min(Y,w)),v.flex&&(v.flex=""),t.direction==="horizontal"&&g!==S){if(s||(v.width=Math.abs(S)+"px"),i.newWidth=S,f==="left"||S<0){const _=Math.max(Math.min(o+g-t.minWidth,o+b),0);n||d.setTranslateX(l,Math.round(_)),i.newX=_}else f==="right"&&r&&!n&&d.setTranslateX(l,o);a=!0}else t.direction==="vertical"&&p!==P&&(s||(v.height=Math.abs(Y)+"px"),i.newHeight=Y,f==="top"||Y<0?(i.newY=Math.max(Math.min(c+p-t.minHeight,c+y),0),n||d.setTranslateY(l,i.newY)):f==="bottom"&&r&&!n&&d.setTranslateY(l,c),a=!0);return a}finishResize(e){const t=this,i=t.context,r={context:i,event:e};if(i.element.classList.remove(t.resizingCls),i.started){let s=!1;t.direction==="horizontal"?s=i.newWidth&&i.newWidth!==i.elementWidth:s=i.newHeight&&i.newHeight!==i.elementHeight,t.trigger(s?"resize":"cancel",r),i.async||i.finalize()}else{var n;(n=t.reset)===null||n===void 0||n.call(t)}}abortResize(e=null,t=!1){const i=this,r=i.context;r.element.classList.remove(i.resizingCls),i.direction==="horizontal"?((r.edge==="left"||r.allowEdgeSwitch&&!r.skipTranslate)&&d.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(d.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&i.trigger("cancel",{context:r,event:e}),i.isDestroyed||i.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return this.direction==="horizontal"?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return this.direction==="horizontal"?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const i=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*i>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/i),0):r}overLeftHandle(e,t){const i=this,{offsetWidth:r}=t;if(i.leftHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=L.from(t);return n.width=i.getDynamicHandleSize(i.rightHandle,r),n.width>0&&n.contains(C.getPagePoint(e))}return!1}overRightHandle(e,t){const i=this,{offsetWidth:r}=t;if(i.rightHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=L.from(t);return n.x=n.right-i.getDynamicHandleSize(i.leftHandle,r),n.width>0&&n.contains(C.getPagePoint(e))}return!1}overTopHandle(e,t){const i=this,{offsetHeight:r}=t;if(i.topHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=L.from(t);return n.height=i.getDynamicHandleSize(i.bottomHandle,r),n.height>0&&n.contains(C.getPagePoint(e))}return!1}overBottomHandle(e,t){const i=this,{offsetHeight:r}=t;if(i.bottomHandle&&i.canResize(t,e)&&(r>=i.handleVisibilityThreshold||i.dynamicHandleSize)){const n=L.from(t);return n.y=n.bottom-i.getDynamicHandleSize(i.bottomHandle,r),n.height>0&&n.contains(C.getPagePoint(e))}return!1}}x(ue,"configurable",{skipUpdatingElement:null}),ue._$name="ResizeHelper";class Ee{static getById(e){return E.getById(e)}static fromElement(e,t,i){return E.fromElement(e,t,i)}static createWidget(e={}){return e.isWidget?e:E.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||typeof t=="string")&&(t={appendTo:t}),t.insertFirst){const i=typeof t.insertFirst=="string"?document.getElementById(t.insertFirst):t.insertFirst;i.firstChild?t.insertBefore=i.firstChild:t.appendTo=i}return e.map(i=>E.create(F.assign({},t||{},i)))}static openPopup(e,t){return E.create(F.assign({forElement:e},typeof t=="string"?{html:t}:t),"popup")}static showContextMenu(e,t){const i=this;return i.currentContextMenu&&i.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:(t.forElement=document.body,Array.isArray(e)&&(e=new De(...e)),e instanceof De&&(t.align={position:e})),t.internalListeners={destroy:i.currentContextMenu=null},i.currentContextMenu=E.create(t,"menu")}static attachTooltip(e,t){return E.attachTooltip(e,t)}static hasTooltipAttached(e){return E.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return E.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),ze.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return Xe.show(e)}}Ee._$name="WidgetHelper";const Le=Object.prototype.hasOwnProperty;let ce=null;function et(m,e){return Object.defineProperty(m,"parser",{value:e}),e}class tt{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class ee{static get(e){if(e==null)return this.NULL;if(e instanceof this)return e;const t=typeof e=="string"?e:JSON.stringify(e),i=this.cache;let r=i.get(t);return r||(ce=t,r=new this(e),i.set(t,r)),r}static get cache(){return Le.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return Le.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=ce,ce=null,t.initialize(),e===null)t.formatter=new tt(t);else{t.configure(e);for(const[i,r]of Object.entries(t.resolvedOptions()))r!=null&&i in t.defaults&&(t[i]=r)}}get parser(){return et(this,new this.constructor.Parser(this))}defaultFormat(e){return e==null?e:String(e)}defaultParse(e){return e}format(e){return e==null?e:this.formatter.format(e)}parse(e,t){return e==null?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}ee._$name="Formatter";const te=le.escapeRegExp,Oe=/[\d+-]/g,ie=(m,e)=>new Intl.NumberFormat(m||void 0,e),it=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,rt="\u2212";class nt{constructor(e){const t=this,i=e.locale,r=ie(i,{maximumFractionDigits:3}),n=e.is.currency?t._decodeStyle(i,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(i,{style:"percent"}):null,a=r.format(1.2).replace(Oe,"")[0],l=r.format(1e9).replace(Oe,"")[0]||"";Object.assign(t,{currency:n,decimal:a,formatter:e,grouper:l,percent:s}),t.decimal=a,t.decimalRe=te(a,"g"),t.grouper=l,t.stripRe=new RegExp(`(?:\\s+|${te(l)})`+(n?`|(?:${te(n.text)})`:"")+(s?`|(?:${te(s.text)})`:""),"g")}decimalPlaces(e){e=e.replace(this.stripRe,"");const t=e.indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return typeof e=="string"&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace(rt,"-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const i=ie(e,t),r=ie(e,Object.assign(i.resolvedOptions(),{style:"decimal"})),n=i.format(0),s=r.format(0);return{suffix:n.startsWith(s),text:n.replace(s,"").trim()}}}class N extends ee{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return e==null?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const t=this;typeof e!="string"?Object.assign(t,e):t.template=e;const i={},r=t.locale?ke.locales[t.locale]:ke.locale,n=r&&r.NumberFormat,s=t.template;if(n)for(const a in n)t[a]==null&&typeof n[a]!="function"&&(t[a]=n[a]);if(s){const a=it.exec(s),l=a[2],o=a[4];t.useGrouping=!!a[3],t.style=a[1]?"currency":a[6]?"percent":"decimal",l&&(t.integer=+l),o==="*"?t.fraction=[0,20]:o!=null&&(t.fraction=[a[5].length,o.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const a in t.defaults)t[a]!=null&&(i[a]=t[a]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=ie(t.locale,i)}as(e,t=null){const i=this.resolvedOptions()||{template:"9.*"},r=this._as;let n=t&&r[t];return n||(typeof e=="string"?i.style=e:Object.assign(i,e),i.from=this,n=new N(i)),t&&(r[t]=n),n}defaultParse(e,t){return e==null?e:t?Number(e):parseFloat(e)}format(e){if(typeof e=="string"){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,i=t.maximumFractionDigits,{truncator:r}=t;let n=t.parse(e),s;return r&&(n=r.format(n),s=n.indexOf(r.parser.decimal),s>-1&&n.length-s-1>i&&(n=n.substr(0,s+i+1)),n=r.parse(n)),n}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)e[t]===void 0&&(e[t]=this[t]);return e}_minMax(e,t,i){const r=this,n=r[e];if(n!=null){const s=le.capitalize(e),a=`maximum${s}Digits`,l=`minimum${s}Digits`;typeof n=="number"?(t&&(r[l]=n),i&&(r[a]=n)):(r[l]=n[0],r[a]=n[1])}}}N.Parser=nt,Object.assign(N.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(N.prototype,N.prototype.defaults),ee.number=(m,e)=>N.format(m,e),N._$name="NumberFormat";const ye=class extends ae(Z){static get configurable(){return{date:{$config:{equal:"date"},value:u.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e=typeof e=="string"?u.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const i=this,{dayColumnIndex:r,weekCount:n}=i,s=u.getFirstDateOfMonth(e),a=u.getLastDateOfMonth(s),l=r[s.getDay()],o=r[a.getDay()],c=!t||e.getFullYear()!==t.getFullYear(),g=!t||e.getMonth()!==t.getMonth(),p=i.eventListeners&&(t?e.getDate()!==t.getDate()|(i.getWeekId(e)!==i.getWeekId(t))<<1|g<<2|c<<3:15);if(i._year=e.getFullYear(),i._month=e.getMonth(),i.startDayOfMonth=1-l,i.endDayOfMonth=a.getDate()+(6-o),i.sixWeeks&&(i.endDayOfMonth+=(6-i.weekCount)*7),(!i.weekBase||c)&&i.calculateWeekBase(),(g||c)&&i.generation++,p){const f={newDate:e,oldDate:t,changes:{d:!0,w:!!(p&2),m:!!(p&12),y:!!(p&8),r:i.weekCount!==n}};i.trigger("dateChange",f),p&2&&i.trigger("weekChange",f),p&12&&i.trigger("monthChange",f),p&8&&i.trigger("yearChange",f)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,i=new Date(e.year,0,1),r=new Date(e.year,11,31),n=e.month?e.getOtherMonth(i):e;e.dayColumnIndex[i.getDay()]>3?e.weekBase=n.startDate:e.weekBase=new Date(e.year,0,n.startDayOfMonth-7);const s=Math.floor(u.diff(e.weekBase,r,"day")/7);e.has53weeks=s===53&&t[r.getDay()]>2}getWeekStart(e){if(typeof e=="number")return u.add(this.weekBase,Math.max(e,1)*7,"day");const t=this,[i,r]=e;return i===t.year?t.getWeekStart(r):t.getOtherMonth(new Date(i,0,1)).getWeekStart(r)}getOtherMonth(e){const t=this,i=t===Pe?new ye(null):Pe;return i.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),i.date=e,i.updateDate(i.date,i.date),i}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:u.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||u.nonWorkingDays}changeNonWorkingDays(e){return F.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:i}=t;for(let r=t.startDayOfMonth,n=0;n<i;n++){const s=[],a=t.getWeekNumber(new Date(t.year,t.month,r));for(let l=0;l<7;l++,r++)s.push(new Date(t.year,t.month,r));e(a,s)}}getWeekNumber(e){const t=this;if(e=u.clearTime(e),e.getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let i=Math.floor(u.diff(t.weekBase,e,"day")/7),r=e.getFullYear();if(i)i===53&&!t.has53weeks?(i=1,r++):i>53&&(i=i%52);else return t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0));return[r,i]}getWeekId(e){const t=this.getWeekNumber(e);return t[0]*100+t[1]}getCellData(e,t,i=Be.MIDNIGHT){const r=this,n=e.getDay(),s=r.visibleDayColumnIndex[n],a=r.nonWorkingDays[n],l=r.hideNonWorkingDays&&a;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:n,dayTime:i,visibleColumnIndex:s,isNonWorking:a,week:r.getOtherMonth(e).getWeekNumber(e),key:u.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[n],date:new Date(e),dayEnd:i.duration("s"),tomorrow:i.dayOfDate(u.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+e.getFullYear()*12-(t.month+t.year*12)),visible:!l&&e>=t.startDate&&e<u.add(t.endDate,1,"day"),isRowStart:s===0,isRowEnd:s===r.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:i,hideNonWorkingDays:r}=e,n=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],a=e.visibleDayColumnIndex=[];let l=0;for(let o=0;o<7;o++){const c=(t+o)%7;s[o]=c,n[c]=o,(!r||!i[c])&&(a[c]=l++)}e.visibleColumnCount=l,e.weekLength=r?7-F.keys(i).length:7}};let A=ye;x(A,"$name","Month");const Pe=new A(null);A._$name="Month";class j extends Ce{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var t;(t=super.onPaint)===null||t===void 0||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;(e=this.tip)===null||e===void 0||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const t=parseInt(d.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,t)}updateMinRowHeight(e){this.weekElements.forEach(t=>d.setLength(t,"minHeight",e)),this.scrollable={overflowY:e?"auto":!1}}changeMinColumnWidth(e){const t=parseInt(d.getStyleValue(this.element,"--min-column-width"),10)||75;return e==null?e:Math.max(parseInt(e)||0,t)}updateMinColumnWidth(e){const t=this;t.weekdayCells.forEach(i=>d.setLength(i,"minWidth",e)),t.cellElements.forEach(i=>i.matches(`.${t.dayCellCls}`)&&d.setLength(i,"minWidth",e)),t.scrollable={overflowX:e?"auto":!1},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return u.parseKey(t.dataset.date)}changeTip(e,t){const i=this;return Ue.reconfigure(t,e,{owner:i,defaults:{type:"tooltip",owner:i,id:`${i.id}-cell-tip`,forElement:i.bodyElement,forSelector:`.${i.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),e==null||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const i=this;super.updateElement(e,t),i.updateHideNonWorkingDays(i.hideNonWorkingDays),i.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),i.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),i.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),i.cellElements=[];for(let r=0,{length:n}=i.weekDayElements;r<n;r++)i.cellElements.push(i.weekDayElements[r].previousSibling,...i.weekDayElements[r].children)}changeDate(e){if(e=typeof e=="string"?u.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return u.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(u.format(e,this.dayNameFormat))}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:u.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let i=0;i<7;i++)t.dayNames[i]=t.shortDayNames[t.canonicalDayNumbers[i]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,!!e),(t=this.scrollable)===null||t===void 0||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,!!e),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,!!e),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=u.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=u.weekends)}changeNonWorkingDays(e){return F.assign({},e)}updateNonWorkingDays(e){if(this._month){var t;this.month.nonWorkingDays=e,this.refresh(),(t=this.scrollable)===null||t===void 0||t.syncOverflowState()}}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return u.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return u.add(e,1,"day")}changeMonth(e,t){const i=this;if(!(e instanceof A)){if(typeof e=="number"){if(t){t.month=e;return}const r=i.date||u.clearTime(new Date);r.setMonth(e),e={date:r}}e=A.new({weekStartDay:i.weekStartDay,nonWorkingDays:i.nonWorkingDays,hideNonWorkingDays:i.hideNonWorkingDays,sixWeeks:i.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:i}),e}onMonthDateChange({source:e,newDate:t,oldDate:i,changes:r}){const n=this;n.year=e.year,n.isConfiguring||((!n.getCell(t)||r.m||r.y)&&(n.refresh(),n.animateTimeShift&&n.isVisible&&d.slideIn(n.contentElement,t>i?1:-1)),n.trigger("dateChange",{changes:r,value:t,oldValue:i}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const t=this,i=t.timeZone!=null?t.timeZone:(e=t.project)===null||e===void 0?void 0:e.timeZone,r=i!=null?je.toTimeZone(new Date,i):new Date,{weekElements:n,weekDayElements:s,date:a,month:l,dayCellCls:o,dayHeaderCls:c,disabledCls:g,otherMonthCls:p,weekendCls:f,todayCls:v,nonWorkingDayCls:b,nonWorkingDays:y,canonicalDayNumbers:M,sixWeeks:k}=t;if(r.setHours(0,0,0,0),!a){t.date=r;return}t.trigger("beforeRefresh"),t.getConfig("dayNameFormat");for(let D=0;D<7;D++){const P=t.weekdayCells[D],S=t.canonicalDayNumbers[D],Y={[c]:1,[f]:u.weekends[S],[b]:y[S]};t.headerRenderer?(P.innerHTML="",t.callback(t.headerRenderer,t,[P,D,S])):d.setInnerText(P,t.shortDayNames[S]),d.syncClassList(P,Y),P.dataset.columnIndex=D,P.dataset.cellDay=S}let T=0,w=0,O=6;for(let D=6;D>=0;D--)if(!y[M[D]]){O=D;break}n[4].classList.toggle("b-hide-display",l.weekCount<5&&!k),n[5].classList.toggle("b-hide-display",l.weekCount<6&&!k),l.eachWeek((D,P)=>{const S=s[T],Y=[S.previousSibling,...S.children];n[T].dataset.week=`${D[0]},${D[1]}`,t.weekRenderer?t.callback(t.weekRenderer,t,[Y[0],D]):Y[0].innerText=D[1];for(let _=0;_<7;_++){const R=P[_],G=R.getDay(),be=u.makeKey(R),Ie=y[G],W=Y[_+1],$e={[o]:1,[g]:t.isDisabledDate(R),[p]:R.getMonth()!==l.month,[f]:u.weekends[G],[v]:R.getTime()===r.getTime(),[b]:Ie,"b-last-working-day":_===O,"b-first-visible-cell":!(R-(t.firstVisibleDate||-1)),"b-last-visible-cell":!(R-(t.lastVisibleDate||-1)),[`b-day-of-week-${G}`]:1};d.syncClassList(W,$e),W.dataset.date=be,W.dataset.cellIndex=w,W.dataset.columnIndex=_,W.lastDomConfig&&(delete W.lastDomConfig.class,delete W.lastDomConfig.className),t.cellRenderer?t.callback(t.cellRenderer,t,[{cell:W,date:R,day:G,row:n[T],rowIndex:T,cellIndex:w,columnIndex:_,visibleColumnIndex:t.visibleDayColumnIndex[G],week:D,key:be}]):W.innerHTML=R.getDate(),w++}T++}),t.visibleWeekCount=T,t.floating&&(t.isAligning||t.realign()),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:i,nonWorkingDays:r}=this;if(this.disableWeekends&&r[t])return!0;if(i)return Array.isArray(i)?(e=u.clearTime(e,!0),i.some(n=>!(u.clearTime(n,!0)-e))):this.callback(this.disabledDates,this,[e])}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...X.fill(7,{class:this.dayHeaderCls}),d.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let i=0;i<6;i++){const r={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:i},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(r)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=u.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,i=e;;i.setDate(i.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[i.getDay()])return i}getCell(e,t){typeof e!="string"&&(e=u.makeKey(e));const i=this.weeksElement.querySelector(`[data-date="${e}"]`);if(i&&(!t||!i.classList.contains(this.otherMonthCls)))return i}onTipOverCell({source:e,target:t}){e.date=u.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}j.initClass(),j._$name="CalendarPanel";const at=m=>!m.value;class de extends xe{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&(e=F.assign({},e),e.value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:t}=this;t&&(t=t===!0?at:t,e.collapsed=t(this))}assignFieldValue(e,t,i){this.value=i===this.checkedValue||(i===this.uncheckedValue?!1:null)}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var t;const i=this,r=i.value?i.checkedValue:i.uncheckedValue,n=r!==void 0,{valueName:s}=i;n&&(e[s]=r),i.gatherValues(e,n),r===!0&&((t=e[s])===null||t===void 0?void 0:t.value)===r&&delete e[s].value}changeValue(e){return e==="false"?!1:!!e}updateValue(e){var t;const i=this,r=i.input.checked!==e;i.input.checked=e,(t=i.container)===null||t===void 0||t.syncChildConfigs(),r&&!i.inputting&&!i.isConfiguring&&(i.uncheckToggleGroupMembers(),i.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,t){const i=this.element.classList;t&&i.remove(t),e&&i.add(e)}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:i,input:r,type:n}=e,s=[];return t&&i&&d.forEachSelector(e.rootElement,`input[type=${n}][data-group=${i}]`,a=>{if(a!==r){const l=E.fromElement(a);l&&s.push(l)}}),s}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const t=this;if(t.readOnly&&t.value!==t.input.checked){t.input.checked=t.value;return}t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0),t.inputting=!1)}updateInputReadOnly(e){}triggerChange(e){const t=this,{checked:i}=t.input,r={checked:i,value:i,userAction:e,valid:!0};if(!i&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter(s=>s.isVisible&&!s.disabled).length||t.trigger("beforeChange",r)===!1)t.input.checked=t._value=!i;else return t.triggerFieldChange(r,!1),e&&t.uncheckToggleGroupMembers(),t.trigger("action",r),t.trigger("change",r),!0}}de.initClass(),de._$name="Checkbox";class H extends Ce{construct(e){super.construct({year:new Date().getFullYear(),...e}),C.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return F.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const i=this;!i.startYear||e>i.endYear?i.startYear=e:e<i.startYear&&(i.startYear=e-(i.yearButtonCount-1)),i.isConfiguring||i.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,t){this.isVisible&&d.slideIn(this.contentElement,Math.sign(e-t))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),i=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let r=0,n=e;r<this.yearButtonCount;r++,n++)i.push({tag:"button",dataset:{year:n},class:{"b-yearpicker-year":1,"b-selected":n===this.year},text:`000${n}`.slice(-4)});return t}}x(H,"$name","YearPicker"),x(H,"type","yearpicker"),x(H,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),H.initClass(),H._$name="YearPicker";class he extends we{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):le.encodeHtml(this.value)}}}he.initClass(),he._$name="DisplayField";const Ye=()=>u.getMonthNames().map((m,e)=>[e,m]),Fe=(m,e)=>m.valueOf()-e.valueOf(),st=Object.freeze([]);class lt extends Ke{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}}lt.initClass();class re extends j{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"b-icon b-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield",items:Ye(),internalListeners:{select:"up.onMonthPicked"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}}},nextMonth:{cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"b-icon b-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,t)=>e&&e.equals(t)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),t.weeksElement.setAttribute("role","grid"),t.weekElements.forEach(i=>i.setAttribute("role","row")),t.element.setAttribute("ariaLabelledBy",t.widgetMap.fields.id),C.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${t.dayCellCls}`},thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearButton.disabled=!t.editMonth,t.refresh.flush()}afterHide(){var e;(e=this._yearPicker)===null||e===void 0||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;(e=this.yearButton)===null||e===void 0||e.destroy(),(t=this.monthField)===null||t===void 0||t.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector(`.${this.dayCellCls}[tabIndex="0"]`)}doRefresh(){const e=this,t=e.focusElement,i=u.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=e.date;super.doRefresh(...arguments);const r=u.parseKey(t==null?void 0:t.dataset.date);i-r&&e.syncActiveDate(i,r)}internalCellRenderer({cell:e,date:t}){const i=this,{activeCls:r,selectedCls:n,externalCellRenderer:s}=i,a=i.isSelectedDate(t),l={[r]:r&&i.isActiveDate(t),[n]:a,[i.outOfRangeCls]:i.minDate&&t<i.minDate||i.maxDate&&t>i.maxDate};if(a&&i.multiSelect){const o=!i.isSelectedDate(u.add(t,-1,"d")),c=!i.isSelectedDate(u.add(t,1,"d"));l["b-range-start"]=o,l["b-range-end"]=c,l["b-in-range"]=!o&&!c}d.updateClassList(e,l),e.innerHTML=`<div class="b-datepicker-cell-inner">${t.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",u.format(t,"MMMM D, YYYY")),i.isActiveDate(t)?e.id=`${i.id}-active-day`:e.removeAttribute("id"),s&&(arguments[0].cell=e.firstChild,i.callback(s,this,arguments))}onCellMousedown(e){const t=e.target.closest("[data-date]");e.preventDefault(),t.focus(),this.activeDate=u.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(u.parseKey(t.dataset.date),e)}onMonthDateChange({newDate:e,changes:t}){this.getConfig("tbar"),super.onMonthDateChange(...arguments),(t.m||t.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear())}onUIDateSelect(e,t){const i=this,{lastClickedDate:r,multiSelect:n}=i;i.lastClickedDate=e,i.isDisabledDate(e)||(i.activatingEvent=t,n?i.handleMultiSelect(r,e,t):(i.selection=e,i.floating&&i.hide()),i.activatingEvent=null)}handleMultiSelect(e,t,i){const r=this,{multiSelect:n}=r,s=r._selection||(r._selection=new q),a=s.dates,l=n==="range",{size:o,generation:c}=s,g=o&&{[u.makeKey(u.add(a[0],-1,"d"))]:1,[u.makeKey(a[0])]:1,[u.makeKey(a[a.length-1])]:1,[u.makeKey(u.add(a[a.length-1],1,"d"))]:1},p=s.has(t),f=p?"delete":"add",v=l&&(g==null?void 0:g[u.makeKey(t)]);if(i.ctrlKey)(n===!0||!o||v)&&(s[f](t),l&&!s.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(t<a[1]?1:-1)));else if(i.shiftKey&&o){const[y,M]=[new Date(l?r.rangeStartDate||(r.rangeStartDate=a[0]):e),t].sort(Fe);l&&s.clear();for(const k=y;k<=M;k.setDate(k.getDate()+1))s.add(k)}else s.has(t)&&s.size===1||(s.clear(),s.add(t));const b=s.size;b===1?r.rangeStartDate=t:b||(r.rangeStartDate=null),s.generation!==c&&r.updateSelection(s)}changeSelection(e){const t=this;let i,r;if(e)if(e.forEach||(e=[e]),e.forEach((n,s)=>e[s]=t.changeDate(n)),r=e[0],e.sort(Fe),t.multiSelect==="range"&&e.length===2){i=new q;for(const n=new Date(e[0]);n<=e[1];n.setDate(n.getDate()+1))i.add(n)}else r=e[0],i=new q(e);else i=new q;return r&&(t.activeDate=t.rangeStartDate=u.clearTime(r)),i}updateMultiSelect(e){this.element.classList.toggle("b-multiselect",!!e),e||(this.selection=[...this.selection][0])}updateSelection(e){const t=this,{dates:i}=e,r=t.multiSelect==="range"?[i[0],i[i.length-1]]:i;i.length&&(t.date=i[0]),t.isConfiguring||(t.refresh.now(),t.trigger("selectionChange",{selection:r,userAction:!!t.activatingEvent}))}get selection(){const{_selection:e}=this,t=e?e.dates:st;return this.multiSelect==="range"&&t.length?[t[0],t[t.length-1]]:t}onInternalKeyDown(e){const t=this,i=e.key.trim()||e.code,r=t.activeDate;let n=new Date(r);if(i==="Escape"&&t.floating)return t.hide();if(r&&t.weeksElement.contains(e.target)){do switch(i){case"ArrowLeft":e.preventDefault(),e.ctrlKey?n=t.gotoPrevMonth():n.setDate(n.getDate()-1);break;case"ArrowUp":e.preventDefault(),n.setDate(n.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?n=t.gotoNextMonth():n.setDate(n.getDate()+1);break;case"ArrowDown":e.preventDefault(),n.setDate(n.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}while(t.isDisabledDate(n)&&!t.focusDisabledDates);if(t.minDate&&n<t.minDate||t.maxDate&&n>t.maxDate)return;t.activeDate=n}}changeMinDate(e){return e&&j.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=e==null?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&j.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=e==null?void 0:e.getFullYear()),this.refresh()}changeDate(e){return u.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e){const t=this;t.isConfiguring&&!t.initializingActiveDate&&(t.selection=e),(!t.month.date||e.getMonth()===t.month.month||!t.getCell(e)||t.alwaysRefreshOnMonthChange||t.isNavigating)&&super.updateDate(e)}changeActiveDate(e,t){if(this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})!==!1){if(e=e?this.changeDate(e):this.date||(this.date=u.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return u.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,t){const i=this,{isConfiguring:r}=i;(r||!i.getCell(e))&&(i.initializingActiveDate=r,i.date=e,i.initializingActiveDate=!1),!r&&!i.refresh.isPending&&i.syncActiveDate(e,t)}syncActiveDate(e,t){const i=this,{activeCls:r}=i,n=i.getCell(e),s=t&&i.getCell(t),a=d.getActiveElement(i.element);n.setAttribute("tabIndex",0),r&&n.classList.add(r),n.id=`${i.id}-active-day`,i.weeksElement.contains(a)&&n.focus(),s&&s!==n&&(s.removeAttribute("tabIndex"),r&&s.classList.remove(r),s.removeAttribute("id"))}set value(e){const t=this,{selection:i,duration:r}=t;if(e){if(e=t.changeDate(e,t.value),t.multiSelect==="range"&&(i==null?void 0:i.length)===2){u.betweenLesserEqual(e,...i)||(e<i[0]?t.selection=[e,u.add(e,r-1,"d")]:t.selection=[u.add(e,-(r-1),"d"),e]),t.date=t.activeDate=e;return}e!==void 0&&(t.selection=e)}else t.date=new Date,t.selection=null}get value(){return this.selection[this.selection.length-1]}get duration(){return this.multiSelect==="range"?u.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const i=this,{activeDate:r}=i,n=r&&i.getCell(r);let s;t==="month"&&n&&(r==null?void 0:r.getMonth())===i.month.month+e?s=r:s=u.add(n?r:i.date,e,t);const a=new Date(s);a.setDate(1);const l=u.add(u.add(a,1,"month"),-1,"day");if(i.minDate&&e<0&&l<i.minDate||i.maxDate&&e>0&&a>i.maxDate)return;i.isNavigating=!0;const o=i.date=s;return n&&(i.activeDate=s),i.isNavigating=!1,o}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var t;return(t=this._selection)===null||t===void 0?void 0:t.has(e)}onMonthPicked({record:e,userAction:t}){if(t){var i;this.activeDate=u.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),(i=this.focusElement)===null||i===void 0||i.focus()}}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:t}){const i=new Date(this.activeDate);i.setFullYear(e),this.activeDate=i,this.focusElement&&d.focusWithoutScrolling(this.focusElement),t.hide()}changeYearPicker(e,t){var i,r;return H.reconfigure(t,e?H.mergeConfigs({owner:this,appendTo:this.element,minYear:(i=this.minDate)===null||i===void 0?void 0:i.getFullYear(),maxYear:(r=this.maxDate)===null||r===void 0?void 0:r.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,t=super.childItems;return e&&t.push(e),t}updateLocalization(){const{monthField:e}=this.widgetMap,t=Ye();!this.isConfiguring&&!t.every((i,r)=>i[1]===e.store.getAt(r).text)&&(t[e.value].selected=!0,e.items=t),super.updateLocalization()}}class q extends Set{add(e){return e=u.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=u.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(u.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new q(e)),e.size===this.size&&[...this].every(t=>e.has(t))}get dates(){return[...this].sort().map(e=>u.parseKey(e))}}re.initClass(),re._$name="DatePicker";class ge extends Se{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const i=this,r={owner:i,forElement:i[i.pickerAlignElement],minDate:i.min,maxDate:i.max,weekStartDay:i._weekStartDay,align:{anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},onSelectionChange:({selection:s,source:a})=>{a.isVisible&&(i._isUserAction=i._isPickerInput=!0,i.value=s[0],i._isPickerInput=i._isUserAction=!1,a.hide())}};i.calendarContainerCls&&(r.cls=i.calendarContainerCls),i.value?r.value=i.value:r.activeDate=new Date;const n=re.reconfigure(t,e,{owner:i,defaults:r});return n==null||n.refresh.flush(),n}get backShiftDate(){return u.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const i=e.backShiftDate;(!t||t.getTime()<=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}get forwardShiftDate(){return u.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const i=e.forwardShiftDate;(!t||t.getTime()>=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const t=this,{_picker:i}=t;if(i){const r={minDate:t.min,maxDate:t.max};t.value?r.value=t.value:i.activeDate||(r.activeDate=new Date),i.setConfig(r)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:i,max:r,validateDateOnly:n}=e;if(n&&(t=u.clearTime(t,!1)),i&&t<i)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&t>r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){const t=this;return e!=null&&(u.isDate(e)||(typeof e=="string"?e=u.parse(e,t.format,t.strictParsing)||u.parse(e,t.fallbackFormat,t.strictParsing):e=new Date(e)),u.isValidDate(e))?(!t.min||e-t.min>-u.MS_PER_DAY)&&(!t.max||e<=t.max)?t.transformTimeValue(e):e:null}transformTimeValue(e){const t=this,{keepTime:i}=t;if(e=u.clone(e),!i)u.clearTime(e,!1);else if(i!=="entered"){const r=u.parse(i,t.timeFormat);u.isValidDate(r)?u.copyTimeValues(e,r):u.isValidDate(t.value)&&u.copyTimeValues(e,t.value)}else t._isPickerInput&&u.isValidDate(t.value)&&u.copyTimeValues(e,t.value);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:i}=this;t&&(e==null?t.removeAttribute("min"):t.min=e),i&&(i.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:i}=this;t&&(e==null?t.removeAttribute("max"):t.max=e),i&&(i.maxDate=e),this.syncInvalid()}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:u.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const i=this,r=i.transformDateValue(e);if(e&&!r){i.setError("L{invalidDate}");return}if(i.clearError("L{invalidDate}"),i.hasChanged(t,r))return super.changeValue(r,t);i.inputting||i.syncInputFieldValue()}updateValue(e,t){const i=this._picker;i&&!this.inputting&&(i.value=i.activeDate=e),super.updateValue(e,t)}changeStep(e,t){const i=typeof e;if(!e)return null;if(i==="number"?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:i==="string"&&(e=u.parseDuration(e)),e&&e.unit&&e.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return e!=null&&e.getTime&&t!==null&&t!==void 0&&t.getTime&&this.keepTime!=="entered"?!u.isEqual(u.clearTime(e),u.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?u.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),e.key==="Enter"&&this.isValid&&this.picker.hide()}}ge.initClass(),ge._$name="DateField";class fe extends xe{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",()=>{t.select()}),typeof t.changeOnSpin=="number"&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let i=!isNaN(e);if(i&&!this.hasTextSelection){i=!1;const r=this.input.value,n=parseFloat(r);r!==t&&(i=!this.acceptValue(n,r))}return i}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if(e.type==="keydown"){const t=this,i=e.key;let r;if(i==="ArrowUp")t.doSpinUp(e.shiftKey),r=!0;else if(i==="ArrowDown")t.doSpinDown(e.shiftKey),r=!0;else if(!e.altKey&&!e.ctrlKey&&i&&i.length===1){const n=t.getAfterValue(i),s=t.formatter.parseStrict(n);r=!(s===t.value||n==="-"&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(s,n)}i==="Enter"&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),r&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;if(t.readOnly)return;let i=(t.value||0)+(e?t.largeStep:t.step);t.okMin(i)||(i=t.min),t.okMax(i)&&t.applySpinChange(i)}doSpinDown(e=!1){const t=this;if(t.readOnly)return;let i=(t.value||0)-(e?t.largeStep:t.step);t.okMax(i)||(i=t.max),t.okMin(i)&&t.applySpinChange(i)}applySpinChange(e){const t=this;t._isUserAction=!0,t.changeOnSpin!==!0&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t,i,r;super.onFocusOut(...arguments);const n=this,{input:s}=n,a=s.value,l=n.formatter.truncate(a),o=isNaN(l)?a:n.formatValue(l);(t=n.triggers)===null||t===void 0||(i=t.spin)===null||i===void 0||(r=i.clickRepeater)===null||r===void 0||r.cancel(),a!==o&&(s.value=o),n._changedBySilentSpin&&(n.triggerChange(e,!0),n._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:i,input:r}=t,{parser:n}=i,s=r.value,a=n.decimalPlaces(s);if(i.truncator&&a){let l=s;const o=i.truncate(s);if(!isNaN(o)&&(l=t.formatValue(o),n.decimalPlaces(l)<a)){const c=s.length-t.caretPos;r.value=l,t.caretPos=l.length-c}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(e===""){const{leadingZeroes:i,decimalPrecision:r}=t;e=i?`${i}>9`:null,r!=null?e=`${e||""}9.${"#".repeat(r)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let i=e._formatter;return(!i||e._lastFormat!==t)&&(i=N.get(e._lastFormat=t),e._formatter=i),i}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||this.step*10}get validity(){const e=this.value,t={};return e!=null&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const i=this;if(e||e===0){let r;typeof e!="number"&&(e=typeof e=="string"?i.formatter.parse(e):Number(e),r=isNaN(e),r&&(e="")),!r&&i.format&&(e=i.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){let e=this.value;return e!=null&&this.format&&(e=this.formatValue(e)),e}}fe.initClass(),fe._$name="NumberField";class J extends oe{static get $name(){return"TimePicker"}static get type(){return"timepicker"}construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){!this.isConfiguring&&!this.isRefreshing&&(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm=e.ref==="pmButton",this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var t;const i=this;switch(e.key){case"Escape":i.triggerTimeChange(i._initialValue),i.hide(),e.preventDefault();return;case"Enter":i.value=i.pickerToTime(),i.hide(),e.preventDefault();return}(t=super.onInternalKeyDown)===null||t===void 0||t.call(this,e)}pickerToTime(){const e=this,t=e._pm,{hour:i,minute:r,second:n}=e.widgetMap;i.format=e._is24Hour?"2>9":null;let s=i.value,a=new Date(e.value);return e._is24Hour||(t&&s<12&&(s=s+12),!t&&s===12&&(s=0)),a.setHours(s),a.setMinutes(r.value),e.seconds&&a.setSeconds(n.value),e._min&&(a=u.max(e._min,a)),e._max&&(a=u.min(e._max,a)),a}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){return e&&(e=typeof e=="string"?u.parse(e,this.format):e),this.isVisible||(this._initialValue=e),e!=null?e:u.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=u.is24HourFormat(e),this.refresh()}changeMin(e){return typeof e=="string"?u.parse(e,this.format):e}changeMax(e){return typeof e=="string"?u.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:t,minute:i,second:r,amButton:n,pmButton:s}=e.widgetMap,a=e.value,l=e._is24Hour,o=a.getHours(),c=e._pm=o>=12;e.element.classList[l?"add":"remove"]("b-24h"),t.min=l?0:1,t.max=l?23:12,t.value=l?o:o%12||12,i.value=a.getMinutes(),r.value=a.getSeconds(),n.pressed=!c,s.pressed=c,n.hidden=s.hidden=l,e.isRefreshing=!1}}}x(J,"configurable",{floating:!0,items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),J.initClass(),J._$name="TimePicker";class me extends Se{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,t){const i=this;return J.reconfigure(t,e,{owner:i,defaults:{value:i.value,forElement:i[i.pickerAlignElement],owner:i,align:{anchor:i.overlayAnchor,target:i[i.pickerAlignElement]},onTimeChange({time:r}){i._isUserAction=!0,i.value=r,i._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const i=u.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const i=u.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=i)&&(e._isUserAction=!0,e.value=i,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return e!=null&&e.getTime&&t!==null&&t!==void 0&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:i}=e;e.readOnly||(t.value=i,t.format=e.format,t.maxTime=e.max,t.minTime=e.min,i||(e.value=t.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=(e=this.pickerKeyDownRemover)===null||e===void 0?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return e!=null&&(typeof e=="string"?(e=u.parse(e,this.format),this.keepDate&&(e=u.copyTimeValues(new Date(this.value),e))):e=new Date(e),u.isValidDate(e))?this.keepDate?e:u.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(e==null?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(e==null?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const i=this,r=i.transformTimeValue(e);if(e&&!r||i.isRequired&&e===""){i.setError("L{invalidTime}");return}if(i.clearError("L{invalidTime}"),i.hasChanged(t,r))return super.changeValue(r,t);i.inputting||i.syncInputFieldValue(!0)}updateValue(e,t){const{expand:i}=this.triggers;i&&e&&(i.element.firstElementChild.style.animationDelay=-((e.getHours()*60+e.getMinutes())/10)+"s"),super.updateValue(e,t)}changeStep(e,t){var i,r;const n=typeof e;if(!e)return null;if(n==="number"?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:n==="string"&&(e=u.parseDuration(e)),(i=e)!==null&&i!==void 0&&i.unit&&(r=e)!==null&&r!==void 0&&r.magnitude)return e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return u.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}me.initClass(),me._$name="TimeField";class Q extends we{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return typeof e=="string"?new B(e):e}changeMax(e){return typeof e=="string"?new B(e):e}changeAllowedUnits(e){return typeof e=="string"&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return this.value==null?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||Q.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&this.decimalPrecision!=null?F.round(e,this.decimalPrecision):e}get allowDecimals(){return this.decimalPrecision!==0}get isValid(){const e=this,t=e.value==null||e.value&&e.value.magnitude==null;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,i=t.value,r=t._lastValue;t.hasChanged(r,i)&&(t._lastValue=i,t.triggerFieldChange({value:i,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t,i,r;return this.syncInputFieldValue(!0),(t=this.triggers)===null||t===void 0||(i=t.spin)===null||i===void 0||(r=i.clickRepeater)===null||r===void 0||r.cancel(),super.onFocusOut(e)}set value(e){const t=this;let i,r;if(this.clearError("L{invalidUnit}"),typeof e=="number")i=e,r=t._unit;else if(typeof e=="string")if(/^\s*$/.test(e))i=null;else{const n=u.parseDuration(e,t.allowDecimals,t.unitWithDefault);n&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(n.unit)?(r=n.unit,i=n.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,i=e.magnitude):(r=null,i=null);(t._magnitude!==i||t._unit!=r)&&(t._magnitude=i,r&&(t._unit=r),super.value=t.calcValue())}okMax(e){return typeof e=="number"&&(e=new B({unit:this.unitWithDefault,magnitude:e})),this.max==null||e<=this.max}okMin(e){return typeof e=="number"&&(e=new B({unit:this.unitWithDefault,magnitude:e})),this.min==null||e>=this.min}get validity(){const e=this.value,t={};return e!=null&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return(!t._unit||t._magnitude==null)&&t.clearable?null:new B(e?this.roundMagnitude(t._magnitude):this._magnitude,t.unitWithDefault)}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){e.key==="ArrowUp"?this.doSpinUp():e.key==="ArrowDown"&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),e.okMin(t)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}Q.initClass(),Q._$name="DurationField";const _e=["number","boolean","string","date","duration"],Ne=m=>{var e;return((e=m.column)===null||e===void 0?void 0:e.type)==="duration"},Re="",h=class extends oe{static get $name(){return"FieldFilterPicker"}static get type(){return"fieldfilterpicker"}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${h.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${h.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:i,caseSensitive:r}}=e;t.ion({select:"onPropertySelect",thisObj:e}),i.ion({select:"onOperatorSelect",thisObj:e}),r.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&i.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,i.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:i}=this.widgetMap;return[e,t,...this.valueFields,i]}updateDisabled(e){this.allChildInputs.forEach(t=>t.disabled=e)}updateReadOnly(e){const{propertyPicker:t,operatorPicker:i}=this.widgetMap;this.allChildInputs.forEach(r=>r.readOnly=e),t.readOnly=t.readOnly||e,i.readOnly=i.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=e!=null?e:h.defaultOperators;return Object.keys(t).reduce((i,r)=>({...i,[r]:t[r].map(n=>({...n,text:this.L(n.text)}))}),{})}changeFields(e){let t=e;return Array.isArray(e)&&(qe.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),t=X.keyBy(t,"name")),t}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes((e=this._filter)===null||e===void 0?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new Me(`b-${h.type}-property`,(e=this.propertyFieldConfig)===null||e===void 0?void 0:e.cls,{[`b-${h.type}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new Me(`b-${h.type}-operator`,(e=this.operatorFieldConfig)===null||e===void 0?void 0:e.cls,{[`b-${h.type}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:t,fieldType:i,_filter:{operator:r},onValueChange:n,filterValues:s,isMultiSelectValueField:a,operatorArgCount:l,getValueFieldConfig:o}=e,c=F.merge({},h.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!i||!r||l===0)return[];let g={type:"textfield",internalListeners:{change:n,input:n,thisObj:e},cls:t,dataset:{type:i},placeholder:e.L(c[a?"list":i])};return a?g={...g,type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(s),value:s!=null?s:[]}:["number","date","boolean"].includes(i)?g.type=`${i}field`:i==="duration"&&(g.type="durationfield"),o&&(g=e.callback(o,e,[e.filter,g])),a?[g]:X.populate(l,p=>[{type:"widget",tag:"div",cls:`b-${h.type}-value-separator`,content:e.L("L{FieldFilterPicker.and}")},{...g,value:s[p]}]).flat().slice(1)}getUniqueDataValues(e=[]){var t;const i=this,{fieldType:r}=i;if(!i.store||!((t=i._filter)!==null&&t!==void 0&&t.property))return[];const{relatedDisplayField:n}=i.selectedField;let s,a;if(i.fieldIsRelation){const{foreignStore:l}=i.currentPropertyRelationConfig;n?(s=l.allRecords.reduce((o,c)=>(c.id!=null&&o.push({text:c[n],value:c.id}),o),[]),a=s.sort((o,c)=>i.sortStrings(o.text,c.text))):s=l.allRecords.map(o=>o.id)}else s=i.store.allRecords.map(l=>l[i._filter.property]);if(!a){s.push(...e);const l=X.unique(s.reduce((o,c)=>(c!=null&&String(c).trim()!==""&&(r==="date"?o.push(c.valueOf()):r==="duration"?o.push(c.toString()):o.push(c)),o),[]));r==="string"?a=l.sort(i.sortStrings):r==="duration"?a=l.map(o=>new B(o)).filter(o=>o.isValid).sort(i.sortDurations):a=l.sort(i.sortNumerics),r==="date"?a=a.map(o=>{const c=new Date(o);return{text:u.format(c,i.dateFormat),value:o}}):r==="duration"&&(a=a.map(o=>o.toString()))}return a}sortStrings(e,t){return(e!=null?e:Re).localeCompare(t!=null?t:Re)}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return(e=this.selectedField)===null||e===void 0?void 0:e.type}get selectedField(){var e,t;return(e=this.fields)===null||e===void 0?void 0:e[(t=this._filter)===null||t===void 0?void 0:t.property]}get propertyOptions(){var e;return Object.entries((e=this.fields)!=null?e:{}).filter(([,t])=>_e.includes(t.type)||Ne(t)).map(([t,{title:i}])=>({value:t,text:i!=null?i:t})).sort((t,i)=>t.text.localeCompare(i.text))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return!!this.currentPropertyRelationConfig}get currentPropertyRelationConfig(){var e,t;return(e=this.store)===null||e===void 0||(t=e.modelRelations)===null||t===void 0?void 0:t.find(({foreignKey:i})=>{var r;return i===((r=this._filter)===null||r===void 0?void 0:r.property)})}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=h.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;(t=this._store)===null||t===void 0||t.un(this),e==null||e.ion({refresh:"onStoreRefresh",thisObj:this})}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFieldRow:t}=e.widgetMap;t.removeAll(),t.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const i=this,{fieldType:r,operatorArgCount:n,isMultiSelectValueField:s}=i,a=(e=i._filter)===null||e===void 0?void 0:e.operator,{caseSensitive:l}=i.widgetMap;l.hidden=r!=="string"||!a||s||n===0,l.checked=((t=i._filter)===null||t===void 0?void 0:t.caseSensitive)!==!1}onPropertySelect(e){var t;const i=this,{_filter:r}=i;r.property=((t=e.record)===null||t===void 0?void 0:t.data.value)||null,i.fieldType!==i._fieldType&&(r.operator=null,r.value=null),i._fieldType=r.type=i.fieldType,i.refreshOperatorPicker(),i.refreshValueFields(),i.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const i=this,r=i.isMultiSelectValueField,n=this.operatorArgCount;i._filter.operator=((t=e.record)===null||t===void 0?void 0:t.data.value)||null,i.operatorArgCount!==n&&(i._filter.value=null),i.isMultiSelectValueField&&!r&&(i._filter.value=[]),i.refreshValueFields(),i.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const e=this,{isMultiSelectValueField:t,fieldType:i,_filter:r}=e,n=this.valueFields.map(s=>s.value);t&&i==="date"?r.value=n[0].map(s=>new Date(s)):t&&i==="duration"?r.value=n[0].map(s=>new B(s)):(i==="date"&&r.operator==="between"&&u.isValidDate(n[1])&&n[1].setHours(23,59,59,999),r.value=n.length===1?n[0]:n),e.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:i},operatorOptions:r}=this;e.items=r,e.value=t,e.hidden=i===null}populateUIFromFilter(e=!1){const t=this,{filterValues:i,widgetMap:{propertyPicker:r,operatorPicker:n},_filter:{property:s,operator:a,disabled:l},propertyOptions:o,operatorOptions:c,isMultiSelectValueField:g}=t;r.items=o,n.items=c,n.hidden=s===null;let p=e;r.value!==s&&(r.value=s,t.refreshOperatorPicker(),p=!0),n.value!==a&&(a===null||!n.items.find(({value:f})=>f===a)?n.clear():n.value=a,p=!0),p&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach((f,v)=>{g&&(f.value.length>0||i.length>0)?t.fieldType==="date"?f.value=i.map(b=>b==null?void 0:b.valueOf()):t.fieldType==="duration"?f.value=i.map(b=>b==null?void 0:b.toString()):f.value=i:v>=i.length?f.clear():f.value=i[v]}),t.allChildInputs.forEach(f=>f.disabled=t.disabled||l)}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFieldRow.queryAll(e=>["textfield","datefield","numberfield","durationfield","combo"].includes(e.type)))}get filterValues(){var e;return((e=this._filter)===null||e===void 0?void 0:e.value)==null?[]:X.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,i=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(i)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:i}=this;return e&&t?i[e][t]:1}get isValid(){const e=this,{filter:t,fieldType:i,filterValues:r,isMultiSelectValueField:n,operatorArgCount:s}=e,{operator:a}=t,l=s>0&&(t==null?void 0:t.value)==null;return i&&a&&!l&&(n&&r.length>0||r.length===s)&&r.every(o=>o!=null&&(i!=="duration"||o.isValid))}};let $=h;x($,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}}),x($,"defaultOperators",{string:[h.operators.empty,h.operators.notEmpty,h.operators["="],h.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},h.operators.isIncludedIn,h.operators.isNotIncludedIn],number:[h.operators.empty,h.operators.notEmpty,h.operators["="],h.operators["!="],h.operators[">"],h.operators["<"],h.operators[">="],h.operators["<="],h.operators.between,h.operators.notBetween,h.operators.isIncludedIn,h.operators.isNotIncludedIn],date:[h.operators.empty,h.operators.notEmpty,h.operators["="],h.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},h.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},h.operators.isIncludedIn,h.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[h.operators.empty,h.operators.notEmpty,h.operators["="],h.operators["!="],h.operators[">"],h.operators["<"],h.operators[">="],h.operators["<="],h.operators.between,h.operators.notBetween,h.operators.isIncludedIn,h.operators.isNotIncludedIn],relation:[h.operators.isIncludedIn,h.operators.isNotIncludedIn]}),x($,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{propertyAndOperator:{type:"container",layout:"box",items:{propertyPicker:{type:"combo",items:{},cls:`b-${h.type}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",items:{},cls:`b-${h.type}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}"}}},valueFieldRow:{type:"container",cls:`b-${h.type}-values`,items:{}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`b-${h.type}-case-sensitive`}},operators:h.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),x($,"buildOperatorArgCountLookup",e=>X.keyBy(Object.entries(e),([t])=>t,([,t])=>X.keyBy(t,({value:i})=>i,({argCount:i})=>i===void 0?1:i))),$.initClass(),$._$name="FieldFilterPicker";class K extends E{compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}x(K,"$name","Label"),x(K,"type","label"),x(K,"configurable",{text:null,localizableProperties:["text"]}),K.initClass(),K._$name="Label";const z=class extends oe{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}get someFiltersNotShown(){return this.store&&this.store.filters.count>this.filters.length}updateFields(e){this.widgetMap.pickers.childItems.forEach(t=>t.fields=e)}updateFilters(e,t){const i=this;t&&t.filter(r=>!e.find(n=>n.id===r.id)).forEach(r=>{var n;return(n=i.store)===null||n===void 0?void 0:n.removeFilter(r.id)}),e.forEach(r=>r.id=r.id||i.nextFilterId),i.widgetMap.pickers.items=(e==null?void 0:e.map(r=>i.getPickerRowConfig(r)))||[]}changeFilters(e){const{canManageFilter:t}=this;return e&&t?e.filter(i=>this.callback(t,this,[i])):e}updateStore(e){const t=this;t.detachListeners("store"),e&&(t.widgetMap.pickers.childItems.forEach(({widgetMap:{filterPicker:{filter:i,isValid:r}}})=>{e.removeFilter(i.id,!0),r&&e.addFilter(i,!0)}),e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})),t.widgetMap.pickers.childItems.forEach(i=>i.store=e)}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e!=null?e:z.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach(t=>{var i;const r=e.canManage(t),{property:n,operator:s,value:a,id:l,disabled:o=!1,caseSensitive:c}=t;r&&n&&s&&!((i=e.filters)!==null&&i!==void 0&&i.find(g=>g.id===l))&&e.appendFilter({id:l,property:n,operator:s,value:a,disabled:o,caseSensitive:c})})}canManage(e){const t=this;return!t.canManageFilter||t.callback(t.canManageFilter,t,[e])===!0}getFilterPickerConfig(e){const t=this,{fields:i,store:r,disabled:n,readOnly:s,valueFieldCls:a,operators:l,limitToProperty:o,dateFormat:c,getFieldFilterPickerConfig:g}=t;return{type:t.constructor.childPickerType,fields:i!=null?i:t.getFieldsFromStore(r),filter:e,store:r,disabled:n,readOnly:s,propertyLocked:!!o,valueFieldCls:a,operators:l,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1,...g?t.callback(g,t,[e]):void 0}}getFieldsFromStore(e){var i;var t;return Object.fromEntries((i=(t=e.fields)===null||t===void 0?void 0:t.map(({name:r,type:n})=>[r,{type:n}]))!=null?i:[])}getPickerRowConfig(e){const t=this,{disabled:i,readOnly:r,canDeleteFilter:n}=t;return{type:"container",layout:"box",layoutStyle:{alignItems:"start"},cls:`b-${z.type}-row`,dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:i,readOnly:r,checked:!e.disabled,internalListeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${z.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:i,readOnly:r,hidden:n&&t.callback(n,t,[e])===!1,cls:`b-transparent b-${z.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll(t=>e.includes(t.type))}updateDisabled(e){this.allInputs.forEach(t=>t.disabled=e)}updateReadOnly(e){this.allInputs.forEach(t=>t.readOnly=e)}onFilterActiveChange({source:e,checked:t}){const i=this,r=i.getFilterIndex(e),n=i.filters[r],s=i.getFilterPicker(r);n.disabled=!t,s.onFilterChange(),i.store&&s.isValid&&i.store.addFilter(n,!0),i.updateStoreFilter(),i.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:i}){const r=this,{store:n}=r,s=r.getFilterIndex(e);n&&(n.removeFilter(t.id,!0),i&&n.addFilter(t,!0),r.updateStoreFilter()),Object.assign(r.filters[s],t),r.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,i=t.getFilterIndex(e),r=t.filters[i],n=t.getPickerRow(i),s=t.query(a=>a.isFocusable&&a.type!=="container"&&!n.contains(a));s&&s.focus(),t.removeFilterAt(i),t.store&&(t.store.removeFilter(r.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:r}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:i=null}={}){const r=this,{filters:n}=r,s={property:r.limitToProperty||e,operator:t,value:i,disabled:!1,id:r.nextFilterId,caseSensitive:!1};if(r.appendFilter(s),r.getFilterPicker(n.length-1).isValid){var a;(a=r.store)===null||a===void 0||a.addFilter(s,!0),r.store&&r.updateStoreFilter()}r.trigger("add",{filter:s}),r.triggerChange()}appendFilter(e){const t=this;(!t.limitToProperty||e.property===t.limitToProperty)&&(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:i}=e,r=i.values.reduce((n,s)=>({...n,[s.id]:s}),{});for(let n=t.filters.length-1;n>=0;n--){const s=t.filters[n],a=r[s.id],l=t.getPickerRow(n);if(l){const{filterPicker:o,activeCheckbox:c}=l.widgetMap;if(!a&&o.isValid)t.removeFilterAt(n);else if(a!==void 0){const{operator:g,value:p,property:f,disabled:v,caseSensitive:b}=a;s!==a&&Object.assign(s,{operator:g,value:p,property:f,disabled:v,caseSensitive:b}),o.filter=s,o.onFilterChange(),c.checked=!v}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:i}=this;t.remove(t.childItems[e]),i.splice(e,1),this.triggerChange()}updateStoreFilter(){var e;this._isUpdatingStore=!0,(e=this.store)===null||e===void 0||e.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){const{filters:e}=this,t=e.filter((i,r)=>this.getPickerRow(r).widgetMap.filterPicker.isValid);this.trigger("change",{filters:e,validFilters:t})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:i,store:r}=t;i.forEach((n,s)=>{if(e===n.disabled){const{filterPicker:a,activeCheckbox:l}=t.getPickerRow(s).widgetMap;n.disabled=!e,a.onFilterChange(),l.checked=e,e&&r&&a.isValid&&r.addFilter(n,!0)}}),t.updateStoreFilter()}};let V=z;x(V,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),x(V,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:z.addFilterButtonDefaultText,cls:`b-${z.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),x(V,"childPickerType","fieldfilterpicker"),V.initClass(),V._$name="FieldFilterPickerGroup";const We=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];se.isWindows&&We.reverse();class ne extends Ge{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"\xA0",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:We}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return E.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:i="\xA0",cancelButton:r,okButton:n,rootElement:s=document.body}){const a=this;return a.rootElement=s,a.getConfig("lazyItems"),a.title=a.optionalL(i),a.widgetMap.message.html=a.optionalL(t),a.showClass=`b-messagedialog-${e}`,n&&(n=typeof n=="string"?{text:n}:n),r&&(r=typeof r=="string"?{text:r}:r),n=Object.assign({},a.widgetMap.okButton.initialConfig,n),r=Object.assign({},a.widgetMap.cancelButton.initialConfig,r),n.text=a.optionalL(n.text),r.text=a.optionalL(r.text),E.reconfigure(a.widgetMap.okButton,n),E.reconfigure(a.widgetMap.cancelButton,r),a.show(),a.promise=new Promise(l=>{a.resolve=l})}show(){const e=d.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:ne.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:i}=this.element;t&&i.remove(t),e&&i.add(e)}doResolve(e){const t=this,{resolve:i}=t;if(i){const r=t.showClass==="b-messagedialog-prompt";if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,i(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){e.key==="Escape"&&(e.stopImmediatePropagation(),this.onCancelClick()),e.key==="Enter"&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(pe.okButton)}onCancelClick(){this.doResolve(pe.cancelButton)}}ne.initClass();const pe=new Proxy({},{get(m,e){const t=m.instance||(m.instance=new ne({rootElement:document.body})),i=t[e];return typeof i=="function"?i.bind(t):i}});export{j as CalendarPanel,de as Checkbox,ge as DateField,re as DatePicker,he as DisplayField,Te as DragHelper,Q as DurationField,$ as FieldFilterPicker,V as FieldFilterPickerGroup,ee as Formatter,K as Label,pe as MessageDialog,A as Month,fe as NumberField,N as NumberFormat,ue as ResizeHelper,_e as SUPPORTED_FIELD_DATA_TYPES,me as TimeField,J as TimePicker,Ee as WidgetHelper,H as YearPicker,Ne as isSupportedDurationField};
//# sourceMappingURL=MessageDialog.js.map
