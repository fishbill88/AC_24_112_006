/*!
 *
 * Bryntum Scheduler Pro 5.3.7
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var lt=Object.defineProperty;var dt=(v,i,e)=>i in v?lt(v,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):v[i]=e;var w=(v,i,e)=>(dt(v,typeof i!="symbol"?i+"":i,e),e);import{stripDuplicates as Se,CalendarCache as ct,IntervalCache as ut,TimeSpan as Ce,DependencyBaseModel as Z,DependencyModel as B}from"./ProjectModel.js";import{ColumnStore as Pe,WidgetColumn as ht,GridFeatureManager as _,HeaderMenu as mt,Header as gt,SubGrid as ft,GridBase as pt}from"./GridBase.js";import{NumberColumn as vt}from"./RegionResize.js";import{ObjectHelper as H,Duration as Dt,DateHelper as g,Widget as we,DomSync as q,EventHelper as O,DomHelper as k,StringHelper as $,DomClassList as bt,Events as Oe,Model as St,IdHelper as $e,Localizable as Ct,Store as Ie,unitMagnitudes as ye,InstancePlugin as N,Objects as G,Tooltip as j,Rectangle as I,BrowserHelper as Te,VersionHelper as ne,Delayable as Ee,Base as U,ArrayHelper as wt,WalkHelper as yt,GlobalEvents as xe,DomDataStore as Tt,Scroller as Et,ResizeMonitor as xt,Collection as Ve,FunctionHelper as Mt}from"./Editor.js";import{DragHelper as _e,ResizeHelper as Rt}from"./MessageDialog.js";import{AvatarRendering as kt,Draggable as We,Droppable as At}from"./AvatarRendering.js";import{ClockTemplate as se,TaskEditStm as zt,AttachToProjectMixin as Me,RecurringEvents as Lt}from"./EventNavigation.js";import"./Slider.js";class Ht{initialize(i){i&&Object.assign(this,i)}static new(i){const e=new this;return e.initialize(i),e}}class De{constructor(i){this.intervalGroups=[],i&&Object.assign(this,i)}combineWith(i){const e=this.intervalGroups.slice();return e.push([i.calendar,i]),new De({intervalGroups:e})}getIsWorkingForEvery(){if(this.isWorkingForEvery!=null)return this.isWorkingForEvery;for(let[i,e]of this.getGroups())if(!e[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(this.isWorkingForSome!=null)return this.isWorkingForSome;for(let[i,e]of this.getGroups())if(e[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(i){return this.getCalendarsWorkStatus().get(i)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const i=new Map;for(let[e,t]of this.getGroups())i.set(e,t[0].isWorking);return this.calendarsWorkStatus=i}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const i=[];for(let[e,t]of this.getGroups())t[0].isWorking&&i.push(e);return this.calendarsWorking=i}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const i=[];for(let[e,t]of this.getGroups())t[0].isWorking||i.push(e);return this.calendarsNonWorking=i}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const i=this.calendars=[],e=new Map;return this.intervalGroups.forEach(([t,r])=>{let n=e.get(t);n||(i.push(t),n=[],e.set(t,n)),n.push.apply(n,r.intervals)}),e.forEach((t,r)=>{const n=Se(t);n.sort((s,a)=>a.getPriorityField()-s.getPriorityField()),e.set(r,n)}),this.intervalsByCalendar=e}}class je extends ct{constructor(i){super(i),this.calendarCaches=Se(this.calendarCaches),this.intervalCache=new ut({emptyInterval:new De,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(i,e){this.calendarCaches.forEach(t=>{t.fillCache(i,e),this.includeWrappingRangeFrom(t,i,e)})}}const Ft=new Map,Pt=v=>{const i=Se(v);if(i.length===0)throw new Error("No calendars to combine");i.sort((s,a)=>s.internalId<a.internalId?-1:1);const e=i.map(s=>s.internalId+"/").join(""),t=i.map(s=>s.version+"/").join("");let r=Ft.get(e),n;return r&&r.versionsHash===t?n=r.cache:n=new je({calendarCaches:i.map(s=>s.calendarCache)}),n};class Re extends vt{constructor(){super(...arguments);w(this,"compositeField",!0)}static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,t){const r=e[this.field],n=t[this.field];return r-n}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get defaultEditor(){const{max:e,min:t,step:r,largeStep:n}=this;return H.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:r,largeStep:n})}get durationUnitField(){return`${this.field}Unit`}roundValue(e){const t=typeof this.grid.durationDisplayPrecision=="number"?this.grid.durationDisplayPrecision:this.decimalPrecision,r=Math.pow(10,t);return Math.round(e*r)/r}formatValue(e,t){return e instanceof Dt&&(t=e.unit,e=e.magnitude),e=this.roundValue(e),e+" "+g.getLocalizedNameOfUnit(t,e!==1)}defaultRenderer({record:e,isExport:t}){const r=e[this.field],n=typeof r,s=n==="number"?r:r==null?void 0:r.magnitude,a=n==="number"?e[this.durationUnitField]:r==null?void 0:r.unit;return typeof s!="number"?t?"":null:this.formatValue(s,a)}toClipboardString({record:e}){return e[this.field].toString()}fromClipboardString({string:e,record:t}){const r=g.parseDuration(e,!0,this.durationUnit);return r&&"magnitude"in r?r:t.fullDuration}calculateFillValue({value:e,record:t}){return this.fromClipboardString({string:e,record:t})}}Pe.registerColumnType(Re),Re._$name="DurationColumn";function Ot(v,i){return v===i.length-1}function $t(v,i){return i===v.cells[v.cells.length-1]}class ae extends we{constructor(){super(...arguments);w(this,"startDate",null);w(this,"endDate",null);w(this,"levels",[]);w(this,"size",null)}set range({startDate:e,endDate:t}){const r=this;(r.startDate-e||r.endDate-t)&&(r.startDate=e,r.endDate=t,r.refresh())}buildCells(e=this.startDate,t=this.endDate){var r;const n=this,{sizeProperty:s}=n,{stickyHeaders:a,isVertical:o}=n.client||{},l=[],{length:d}=n.levels,c=n.levels.map((u,h)=>{var f;const p=a&&(o||h<d-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${u.position}`]:1,"b-sch-header-row-main":h===n.model.viewPreset.mainHeaderLevel,"b-lowest":Ot(h,n.levels),"b-sticky-header":p},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${h}`,headerPosition:u.position},children:(f=u.cells)===null||f===void 0?void 0:f.filter(m=>m.start<t&&m.end>e).map((m,D)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[m.headerCellCls]:m.headerCellCls,[`b-align-${m.align}`]:m.align,"b-last":$t(u,m)},dataset:{tickIndex:m.index,...globalThis.DEBUG&&{date:m.start.getTime()}},style:{[n.positionProperty]:m.coord,[s]:m.width,[`min-${s}`]:m.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":p},html:m.value}]}))}});return(r=n.client)===null||r===void 0||r.getHeaderDomConfigs(l),c.push(...l),{className:n.widgetClassList,syncOptions:{releaseThreshold:0},children:c}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:r}=t.model,{levels:n}=t,s=n.length;if(e){n.length=0,r.forEach((o,l)=>n[l]={position:l,cells:o}),t.size=n[0].cells.reduce((o,l)=>o+l.width,0);const{parentElement:a}=t.element;a&&(n.length!==s||e)&&(a.classList.remove(`b-sch-timeaxiscolumn-levels-${s}`),a.classList.add(`b-sch-timeaxiscolumn-levels-${n.length}`))}!t.startDate||!t.endDate||(q.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}w(ae,"$name","TimeAxisBase"),w(ae,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),ae._$name="TimeAxisBase";class ee extends ae{get positionProperty(){var i;return(i=this.owner)!==null&&i!==void 0&&i.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(i){this.detachListeners("tavm"),i==null||i.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}}w(ee,"$name","HorizontalTimeAxis"),w(ee,"type","horizontaltimeaxis"),w(ee,"configurable",{model:null,sizeProperty:"width"}),ee._$name="HorizontalTimeAxis";class te extends we{constructor(){super(...arguments);w(this,"firstResource",-1);w(this,"lastResource",-1)}construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),t.imagePath!=null&&t.element.classList.add("b-has-images"),O.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return(t=this.avatarRendering)===null||t===void 0||t.destroy(),e&&(this.avatarRendering=new kt({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const t=this;t.getConfig("fillWidth"),t.getConfig("fitWidth"),t.updateWidthCache();const{element:r}=t,n=t.totalWidth;t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),n!==t.width&&(k.setLength(r,"width",n),t.column.set("width",n,t.column.grid.isConfiguring)),e==="removeall"&&(r.innerHTML=""),(e==="remove"||e==="add"||e==="filter"||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:t}=this;return t.variableColumnWidths=!1,t.resourceStore.forEach(r=>{r.instanceMeta(t).insetStart=e,r.instanceMeta(t).insetEnd=e+(r.columnWidth||t.resourceColumnWidth),r.columnWidth==null?e+=t.resourceColumnWidth:(e+=r.columnWidth,t.variableColumnWidths=!0)}),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const r=this;r.refreshingWidths||r.refreshWidths(),r.isConfiguring||(r.resourceStore.isGrouped&&r.updateWidthCache(),r.refresh(),r.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return $.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:r,configuredColumnWidth:n}=t,s=(e=t.resourceStore)===null||e===void 0?void 0:e.count;if(!r||!s||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const a=t.fitWidth||t.fillWidth&&n*s<r,o=a?Math.floor(r/s):n,l=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-o)>30;k.addTemporaryClass(t.element,"b-animating",l?300:0,t),t.columnWidth=o,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.updateWidthCache(),this.refresh()}refresh(){const e=this,{firstResource:t,scheduler:r,resourceStore:n,lastResource:s}=e,{variableColumnWidths:a}=r,o=n.isGrouped&&n.groupers[0].field,l=[];if(e.element.classList.toggle("b-grouped",!!o),!e.column.grid.isConfiguring&&t>-1&&s>-1&&s<n.count){let u;for(let h=t;h<=s;h++){var d;const f=n.allResourceRecords[h],p=f.instanceMeta(n).groupParent,m=p==null?void 0:p.groupChildren;if(o&&p.id!==((d=u)===null||d===void 0?void 0:d.dataset.resourceId)){const T=m[0].instanceMeta(r).insetStart,y=m[m.length-1].instanceMeta(r).insetEnd-T;u={className:"b-resourceheader-group-cell",dataset:{resourceId:p.id},style:{left:T,width:y},children:[{tag:"span",html:$.encodeHtml(m[0][o])},{className:"b-resourceheader-group-children",children:[]}]},l.push(u)}const D=f.instanceMeta(r),b=f.columnWidth||e.columnWidth,S=o?D.insetStart-u.style.left:a?D.insetStart:h*e.columnWidth,C={className:new bt({"b-resourceheader-cell":1}),dataset:{resourceId:f.id},style:{[r.rtl?"right":"left"]:S,width:b},children:[]};if(e.headerRenderer){const T=e.headerRenderer({elementConfig:C,resourceRecord:f});T!=null&&(C.html=T)}else{let T;if(f.imageUrl)T=f.imageUrl;else if(e.imagePath!=null&&f.image!==!1){var c;const y=f.image||((c=f.name)===null||c===void 0?void 0:c.toLowerCase())+e.imageExtension;T=e.getImageURL(y)}C.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({resourceRecord:f,initials:f.initials,color:f.eventColor,iconCls:f.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:T}),{tag:"span",className:"b-resource-name",html:$.encodeHtml(f.name)})}o?u.children[1].children.push(C):l.push(C)}}q.sync({domConfig:{onlyChildren:!0,children:l},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),r=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+$.capitalize(e.type),{resourceRecord:r,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}}w(te,"$name","ResourceHeader"),w(te,"type","resourceheader"),w(te,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),te._$name="ResourceHeader";class he extends Oe(ht){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(i){const e=this;super.construct(...arguments),e.thisObj=e,e.timeAxisViewModel=e.grid.timeAxisViewModel,e.mode=e.mode,e.grid.ion({paint:"onTimelinePaint",thisObj:e,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var i,e;(i=this.resourceColumns)===null||i===void 0||i.destroy(),(e=this.timeAxisView)===null||e===void 0||e.destroy(),super.doDestroy()}set mode(i){const e=this,{grid:t}=e;e.set("mode",i),i==="horizontal"?e.timeAxisView=new ee({model:e.timeAxisViewModel,compactCellWidthThreshold:e.compactCellWidthThreshold,owner:t,client:t}):i==="vertical"&&(e.resourceColumns=te.new({column:e,scheduler:t,resourceStore:t.resourceStore,imagePath:t.resourceImagePath,imageExtension:t.resourceImageExtension,defaultImageName:t.defaultResourceImageName},t.resourceColumns||{}),e.relayEvents(e.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:i}){const e=this;e.grid.timeAxisSubGrid.collapsed||(e.mode==="horizontal"?(e.refreshHeader(!0),e.width=i.totalSize,e.grid.refresh(),e.subGrid.refreshFakeScroll()):e.mode==="vertical"&&e.grid.refreshRows())}onTimelinePaint({firstPaint:i}){const e=this;if(e.subGrid.insertRowsBefore&&i&&(e.subGridElement.classList.add("b-timeline-subgrid"),e.mode==="vertical")){var t;e.refreshHeader(),(t=e.grid)===null||t===void 0||t.onHeightChange()}}refreshHeader(i){const e=this,{element:t}=e;t&&(e.mode==="horizontal"?(!i&&e.timeAxisViewModel.update(void 0,void 0,!0),e.timeAxisView.rendered?e.timeAxisView.refresh(!0):(t.innerHTML="",e.timeAxisView.render(t))):e.mode==="vertical"&&(e.resourceColumns.currentElement||(t.innerHTML="",e.resourceColumns.render(t))))}internalRenderer(i){const{grid:e}=this;if(e.project.isInitialCommitPerformed||e.project.isDelayingCalculation)return e.currentOrientation.renderer(i),super.internalRenderer(i)}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(i){const e=this;e.detachListeners("tavm"),i==null||i.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:e}),e._timeAxisViewModel=i,e.timeAxisView&&(e.timeAxisView.model=i)}getState(){const i=super.getState();return delete i.width,delete i.flex,i}}w(he,"$name","TimeAxisColumn"),Pe.registerColumnType(he),he._$name="TimeAxisColumn";class Y extends St{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(i){const e=this,{headers:t}=e,r=[];let n=Object.getPrototypeOf(e.data).id;if(!n){for(let{length:s}=t,a=s-1;a>=0;a--){const{unit:o,increment:l}=t[a],d=l>1;r.push(`${d?l:""}${a?o:$.capitalize(o)}${d?"s":""}`)}n=r.join("And")}return i.count&&i.includes(n)&&(n+=`-${e.tickWidth}by${e.tickHeight||e.tickWidth}`,i.includes(n)&&(n+=`-${e.bottomHeader.increment}`,i.includes(n)&&(n=$e.generateId(`${n}-`)))),n}normalizeUnits(){const i=this,{timeResolution:e,headers:t,shiftUnit:r}=i;if(t)for(let n=0,{length:s}=t;n<s;n++){const a=t[n];a.unit=g.normalizeUnit(a.unit),a.splitUnit&&(a.splitUnit=g.normalizeUnit(a.splitUnit)),"increment"in a||(t[n]=Object.assign({increment:1},a))}e&&(e.unit=g.normalizeUnit(e.unit)),r&&(i.shiftUnit=g.normalizeUnit(r))}static normalizeHeaderConfig(i){const{headerConfig:e,columnLinesFor:t,mainHeaderLevel:r}=i,n=i.headers=[];if(e.top&&(t==="top"&&(i.columnLinesFor=0),r==="top"&&(i.mainHeaderLevel=0),n[0]=e.top),e.middle)t==="middle"&&(i.columnLinesFor=n.length),r==="middle"&&(i.mainHeaderLevel=n.length),n.push(e.middle);else throw new Error("ViewPreset.headerConfig must be configured with a middle");e.bottom&&(i.mainHeaderLevel=n.length-1,t==null?i.columnLinesFor=n.length-1:t==="bottom"&&(i.columnLinesFor=n.length),r==null&&(i.mainHeaderLevel=n.length-1),r==="bottom"&&(i.mainHeaderLevel=n.length),n.push(e.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const i={},{headers:e}=this,{length:t}=e;switch(t){case 1:i.middle=e[0];break;case 2:this.mainHeaderLevel===0?(i.middle=e[0],i.bottom=e[1]):(i.top=e[0],i.middle=e[1]);break;case 3:i.top=e[0],i.middle=e[1],i.bottom=e[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return i}set mainHeaderLevel(i){this.data.mainHeaderLevel=i}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:this.data.headers.length===3?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:i}=this;return Math.round(g.asMilliseconds(i.increment||1,i.unit)/this.tickWidth)}get isValid(){const i=this;let e=!0;for(const t of i.headers)e=e&&!!g.normalizeUnit(t.unit);return i.timeResolution&&(e=e&&g.normalizeUnit(i.timeResolution.unit)),i.shiftUnit&&(e=e&&g.normalizeUnit(i.shiftUnit)),e}}w(Y,"$name","ViewPreset"),Y._$name="ViewPreset";class me extends Ct(Ie){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:Y,zoomOrder:1}}set storage(i){super.storage=i,this.storage.addSorter((e,t)=>{const r=e.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||ye[r.unit]-ye[n.unit]||r.increment-n.increment)*this.zoomOrder})}get storage(){return super.storage}getById(i){return super.getById(i)||!this.isPresetManager&&ie.getById(i)}createRecord(i,...e){let t;if(i.isViewPreset)return i;if(typeof i=="string")t=this.getById(i);else if(typeof i=="number")t=this.getAt(i);else return i.base&&(i=this.copyBaseValues(i)),super.createRecord(i,...e);if(!t)throw new Error(`ViewPreset ${i} does not exist`);return t}updateLocalization(){super.updateLocalization();const i=this;let e=i.allRecords;i.isPresetManager&&(e=new Set(e.concat(Object.values(i.basePresets)))),e.forEach(t=>{let r=i.optionalL(`L{PresetManager.${t.id}}`,null,!0);typeof r=="string"&&t.baseId&&(r=i.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),r&&typeof r=="object"&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),t.mainHeaderLevel===0&&r.topDateFormat&&(r.middleDateFormat=r.middleDateFormat||r.topDateFormat),t.setData("displayDateFormat",r.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach(n=>{const s=t.headerConfig[n],a=r[n+"DateFormat"];s&&(s.originalDateFormat||(s.originalDateFormat=s.dateFormat),a&&s.renderer&&(s.renderer=null),s.dateFormat=a||s.originalDateFormat)}),r.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",r.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))})}getCurrentConfig(i){return super.getCurrentConfig(i).data}copyBaseValues(i){let e=this.getById(i.base);if(!e)throw new Error(`ViewPreset base '${i.base}' does not exist.`);return e=H.clone(e.data),delete e.id,delete e.name,H.merge(e,i)}add(i){return i=Array.isArray(i)?i:[i],i.forEach(e=>{e.isViewPreset&&e.base&&(e.data=this.copyBaseValues(e.originalData))}),super.add(...arguments)}}me._$name="PresetStore";class It extends me{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(i){return`
                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${g.format(i,"HH")}</span>
                                    <span class="b-sch-calendarcolumn-minutes">${g.format(i,"mm")}</span></div>
                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(i){return`
                                    <div class="sch-calendarcolumn-ct">
                                    <span class="sch-calendarcolumn-hours">${g.format(i,"HH")}</span>
                                    <span class="sch-calendarcolumn-minutes">${g.format(i,"mm")}</span>
                                    </div>
                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(i){return g.getShortNameOfUnit("week")+"."+g.format(i,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(i,e,t){return g.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(i.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(i,e)=>i.getFullYear()+" - "+e.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(i){const e=this._basePresets={};for(const t in i)i[t].id=t,e[t]=this.createRecord(i[t])}get basePresets(){return this._basePresets}set defaultPresets(i){for(let e=0,{length:t}=i;e<t;e++){const r=i[e],n=typeof r=="string",s=n?r:r.base;let a;if(n)a=this.basePresets[s];else{const o=Object.setPrototypeOf(H.clone(this.basePresets[s].data),{id:s}),{timeResolution:l}=o,d=o.headers[o.headers.length-1];o.id=void 0,"width"in r&&(o.tickWidth=r.width),"height"in r&&(o.tickHeight=r.height),"increment"in r&&(d.increment=r.increment),"resolution"in r&&(l.increment=r.resolution),"resolutionUnit"in r&&(l.unit=g.getUnitByName(r.resolutionUnit)),a=this.createRecord(o),a.baseId=s}this.add(a)}}getById(i){return super.getById(i)||this.basePresets[i]}registerPreset(i,e){const t=this.createRecord(Object.assign({id:i},e)),r=this.find(n=>n.equals(t));if(r)return r;if(t.isValid)this.add(t);else throw new Error("Invalid preset, please check your configuration");return t}getPreset(i){return typeof i=="number"&&(i=this.getAt(i)),typeof i=="string"?i=this.getById(i):i instanceof Y||(i=this.createRecord(i)),i}normalizePreset(i){const e=this;if(!(i instanceof Y)){if(typeof i=="string"){if(i=e.getPreset(i),!i)throw new Error("You must define a valid view preset. See PresetManager for reference")}else if(typeof i=="object"){if(i.base){const t=this.getById(i.base);if(!t)throw new Error(`ViewPreset base '${i.base}' does not exist`);i=H.merge(H.clone(t.data),i)}i.id?i=e.createRecord(i):(i=e.createRecord(H.assign({},i)),i.id=i.generateId(i))}}return i}deletePreset(i){typeof i=="string"?i=this.getById(i):typeof i=="number"&&(i=this.getAt(i)),i&&(this.remove(i),delete this.basePresets[i.id])}}const ie=new It;class Vt extends Ce{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}}class ke extends Ie{static get defaultConfig(){return{modelClass:Vt,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(i){const e=this;if(super.construct(i),e.originalContinuous=e.continuous,e.ion({change:({action:t})=>{t!=="filter"&&e.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>e.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:t=>e.trigger("reconfigure",t)}),e.startDate)e.internalOnReconfigure(),e.trigger("reconfigure");else if(e.viewPreset){const t=e.getAdjustedDates(new Date);e.startDate=t.startDate,e.endDate=t.endDate}}get isTimeAxis(){return!0}reconfigure(i,e=!1,t=!1){const r=this,n=r.getAdjustedDates(i.startDate,i.endDate),s={};if(r.trigger("beforeReconfigure",{startDate:n.startDate,endDate:n.endDate,config:i})!==!1){r.trigger("beginReconfigure"),r._configuredStartDate=i.startDate,r._configuredEndDate=i.endDate;for(const o in i)s[o]=r[o];const a=i.viewPreset&&i.viewPreset!==r.viewPreset;if(a&&(t=r.isFiltered,r.filters.forEach(o=>o.disabled=!1)),Object.assign(r,i),r.internalOnReconfigure(t,a)===!1)return!1;r.trigger("endReconfigure",{suppressRefresh:e,config:i,oldConfig:s})}}internalOnReconfigure(i=!1,e){const t=this;t.isConfigured=!0;const r=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),s=n.startDate,a=n.endDate;if(s>=a)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${a}.`);const{unit:o,increment:l=1}=t,d=t.generateTicks(s,a,o,l);t.suspendEvents(),t.maintainFilter=i,t.data=d,t.maintainFilter=!1;const{count:c}=t;if(c===0){if(i)return e&&t.disableFilters(),t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=r.startDate,t.adjustedEnd=g.getNext(c>1?d[c-1].startDate:r.startDate,o,l,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const i=this,{count:e,unit:t,startDate:r,endDate:n,weekStartDay:s,increment:a=1}=i,o=g.getNormalizedUnitDuration(r,t)*a,l=g.getNormalizedUnitDuration(n,t)*a;do i.visibleTickStart=(r-i.adjustedStart)/o,i.autoAdjust&&(i.visibleTickStart=Math.floor(i.visibleTickStart)),i.visibleTickStart>=1&&(i.adjustedStart=g.getNext(i.adjustedStart,t,a,s));while(i.visibleTickStart>=1);do i.visibleTickEnd=e-(i.adjustedEnd-n)/l,e-i.visibleTickEnd>=1&&(i.adjustedEnd=g.getNext(i.adjustedEnd,t,-1,s));while(e-i.visibleTickEnd>=1);i.fullTicks=!i.visibleTickStart&&i.visibleTickEnd===e}get viewPreset(){return this._viewPreset}set viewPreset(i){const e=this;if(i=ie.getPreset(i),!(i instanceof Y))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");e._viewPreset=i,Object.assign(e,{unit:i.bottomHeader.unit,increment:i.bottomHeader.increment||1,resolutionUnit:i.timeResolution.unit,resolutionIncrement:i.timeResolution.increment,mainUnit:i.mainHeader.unit,shiftUnit:i.shiftUnit||i.mainHeader.unit,shiftIncrement:i.shiftIncrement||1,defaultSpan:i.defaultSpan||1,presetName:i.id,headers:i.headers})}get weekStartDay(){var i;return(i=this._weekStartDay)!=null?i:g.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(i){this.resolutionUnit=i.unit,this.resolutionIncrement=i.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(i,e,t=!1){e&&i-e===0&&(e=null);const r=this,{startDate:n,endDate:s}=r.getAdjustedDates(i,e);if(r.startDate-n!==0||r.endDate-s!==0)return r.reconfigure({startDate:n,endDate:s},!1,t)}shift(i,e=this.shiftUnit){const t=this;let{startDate:r,endDate:n}=t;t.isFiltered&&(r=t.allRecords[0].startDate,n=t.allRecords[t.allCount-1].endDate);let s=0;do r=g.add(r,i,e),n=g.add(n,i,e);while(s++<t.maxTraverseTries&&t.setTimeSpan(r,n,{preventThrow:!0})===!1)}shiftNext(i=this.shiftIncrement){this.shift(i)}shiftPrevious(i=this.shiftIncrement){this.shift(-i)}filterBy(i,e=this){this.filters.clear(),super.filterBy((r,n)=>i.call(e,r.data,n))}filter(){const i=this,e=super.filter(...arguments);return!i.maintainFilter&&i.count===0&&(i.resumeEvents(),i.trigger("invalidFilter"),i.disableFilters()),e}disableFilters(){this.filters.forEach(i=>i.disabled=!0),this.filter()}triggerFilterEvent(i){const e=this;i.filters.count?e.continuous=!1:e.continuous=e.originalContinuous,e.updateTickCache(),super.triggerFilterEvent(i)}get isContinuous(){return this.continuous!==!1&&!this.isFiltered}getAdjustedDates(i,e,t=!1){const r=this;return e&&i-e===0&&(e=null),i=i||r.startDate,e=e||g.add(i,r.defaultSpan,r.mainUnit),r.autoAdjust||t?{startDate:r.floorDate(i,!1,r.autoAdjust?r.mainUnit:r.unit,1),endDate:r.ceilDate(e,!1,r.autoAdjust?r.mainUnit:r.unit,1)}:{startDate:i,endDate:e}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(i){this._start=g.parse(i)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(i){i&&(this._end=g.parse(i))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(i,e,t,r){e=e!==!1;const n=this,s=e?g.clone(n.startDate):null,a=r||n.resolutionIncrement,o=t||(e?n.resolutionUnit:n.mainUnit),l=(c,u)=>Math.floor(c/u)*u;if(e){const c=l(g.diff(s,i,o),a);return g.add(s,c,o,!1)}const d=g.clone(i);if(o==="week"){const c=d.getDay()||7,u=n.weekStartDay||7;g.add(g.startOf(d,"day",!1),c>=u?u-c:-(7-u+c),"day",!1),d.getDay()!==u&&d.getHours()===23&&g.add(d,1,"hour",!1)}else{g.startOf(d,o,!1);const c=["day","year"].includes(o)?1:0,u=o==="day"?"date":o,h=l(g.get(d,u)-c,a)+c;g.set(d,u,h)}return d}roundDate(i,e,t=this.resolutionUnit,r=this.resolutionIncrement||1){const n=this,s=g.clone(i);switch(e=g.clone(e||n.startDate),t){case"week":{g.startOf(s,"day",!1);let a=s.getDay()-n.weekStartDay,o;return a<0&&(a=7+a),Math.round(a/7)===1?o=7-a:o=-a,g.add(s,o,"day",!1)}case"month":{const a=g.diff(e,s,"month")+g.as("month",s.getDay()/g.daysInMonth(s)),o=Math.round(a/r)*r;return g.add(e,o,"month",!1)}case"quarter":return g.startOf(s,"month",!1),g.add(s,3-s.getMonth()%3,"month",!1);default:{const a=g.as(t,g.diff(e,s)),o=g.as(t,e.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),l=Math.round((a+o)/r)*r;return g.add(e,l-o,t,!1)}}}ceilDate(i,e,t,r){const n=this;e=e!==!1,r=r||(e?n.resolutionIncrement:1);const s=t||(e?n.resolutionUnit:n.mainUnit),a=g.clone(i);let o=!1;switch(s){case"minute":o=!g.isStartOf(a,"minute");break;case"hour":o=!g.isStartOf(a,"hour");break;case"day":case"date":o=!g.isStartOf(a,"day");break;case"week":g.startOf(a,"day",!1),o=a.getDay()!==n.weekStartDay||!g.isEqual(a,i);break;case"month":g.startOf(a,"day",!1),o=a.getDate()!==1||!g.isEqual(a,i);break;case"quarter":g.startOf(a,"day",!1),o=a.getMonth()%3!==0||a.getDate()!==1||!g.isEqual(a,i);break;case"year":g.startOf(a,"day",!1),o=a.getMonth()!==0||a.getDate()!==1||!g.isEqual(a,i);break}return o?g.getNext(a,s,r,n.weekStartDay):a}get include(){return this._include}set include(i){const e=this;e._include=i,e.continuous=!i,e.isConfiguring||(e.startDate=e._configuredStartDate,e.endDate=e._configuredEndDate,e.internalOnReconfigure(),e.trigger("includeChange"))}processExclusion(i,e,t){const{include:r}=this;return r?Object.entries(r).some(([n,s])=>{if(!s)return!1;const{from:a,to:o}=s;if(g.compareUnits("day",t)>=0&&g.getLargerUnit(n)===t&&(a&&g.set(i,n,a),o)){let l=t;t==="day"&&(l="date"),g.set(e,{[l]:g.get(e,l)-1,[n]:o})}if(g.compareUnits(n,t)>=0){const l=n==="day"?i.getDay():g.get(i,n);if(a&&l<a||o&&l>=o)return!0}}):!1}initExclusion(){Object.entries(this.include).forEach(([i,e])=>{if(e){const{from:t,to:r}=e;e.lengthFactor=g.getUnitToBaseUnitRatio(i,g.getLargerUnit(i))/(r-t),e.lengthFactorExcl=g.getUnitToBaseUnitRatio(i,g.getLargerUnit(i))/(r-t-1),e.center=t+t/(e.lengthFactor-1)}})}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(i,e,t=this.unit,r=this.increment){const n=this,s=[],a=!!n.include;let o,l,d,c=0,{startDate:u,endDate:h}=n.getAdjustedDates(i,e);for(n.tickCache={},a&&n.initExclusion();u<h;){if(o=g.getNext(u,t,r,n.weekStartDay),!n.autoAdjust&&o>h&&(o=h),t==="hour"&&r>1&&s.length>0&&c===0){const f=s[s.length-1];c=(f.startDate.getHours()+r)%24-f.endDate.getHours(),c!==0&&(o=g.add(o,c,"hour"))}d=!1,a?(l=new Date(o.getTime()),d=n.processExclusion(u,o,t)):l=o,d||(s.push({id:s.length+1,startDate:u,endDate:o}),n.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const i=this;return i.isContinuous?i.visibleTickEnd-i.visibleTickStart:i.count}getTickFromDate(i){var u;var e;const t=this,r=t.records,n=(u=(e=i.getTime)===null||e===void 0?void 0:e.call(i))!=null?u:i;let s=0,a=r.length-1,o,l,d,c;if(!r.length||n<r[0].startDateMS||n>r[a].endDateMS)return-1;if(t.isContinuous){for(;s<a;)o=s+a+1>>1,n>r[o].endDateMS?s=o+1:n<r[o].startDateMS?a=o-1:s=o;return l=r[s],d=l.startDateMS,n>d&&(c=l.endDateMS,s+=(n-d)/(c-d)),Math.min(Math.max(s,t.visibleTickStart),t.visibleTickEnd)}else for(let h=0;h<=a;h++)if(c=r[h].endDateMS,n<=c)return d=r[h].startDateMS,l=h+(n>d?(n-d)/(c-d):0),l}getDateFromTick(i,e){const t=this;if(i===t.visibleTickEnd)return t.endDate;const r=Math.floor(i),n=i-r,s=t.getAt(r);if(!s)return null;const a=r===0&&t.isContinuous?t.adjustedStart:s.startDate,o=r===t.count-1&&t.isContinuous?t.adjustedEnd:s.endDate;let l=g.add(a,n*(o-a),"millisecond");return e&&(l=t[e+"Date"](l)),l}get ticks(){return this.records}updateTickCache(i=!1){const e=this;e.count?(e._start=e.first.startDate,e._end=e.last.endDate,e._startMS=e.startDate.getTime(),e._endMS=e.endDate.getTime()):e._start=e._end=e._startMs=e._endMS=null,i||(e.tickCache={},e.forEach((t,r)=>e.tickCache[t.startDate.getTime()]=r))}dateInAxis(i,e=!1){const t=this,r=t.startDate,n=t.endDate;if(t.isContinuous)return e?g.betweenLesserEqual(i,r,n):g.betweenLesser(i,r,n);{const s=t.getCount();let a,o,l;for(let d=0;d<s;d++)if(l=t.getAt(d),a=l.startDate,o=l.endDate,e&&i<=o||!e&&i<o)return i>=a}return!1}timeSpanInAxis(i,e){const t=this;return!e||e.getTime()===i.getTime()?this.dateInAxis(i,!0):t.isContinuous?g.intersectSpans(i,e,t.startDate,t.endDate):i<t.startDate&&e>t.endDate||t.getTickFromDate(i)!==t.getTickFromDate(e)}isTimeSpanInAxis(i){var l;const e=this,{startMS:t,endMS:r}=e,{startDateMS:n}=i,s=(l=i.endDateMS)!=null?l:i.meta.endDateCached;if(!n||!s)return!1;if(s===n)return e.dateInAxis(i.startDate,!0);if(e.isContinuous)return s>t&&n<r;const a=e.getTickFromDate(i.startDate),o=e.getTickFromDate(i.endDate);return a===e.count&&g.isEqual(i.startDate,e.last.endDate)||o===0&&g.isEqual(i.endDate,e.first.startDate)?!1:n<t&&s>r||a!==o}forEachAuxInterval(i,e=1,t,r=this){const n=this.endDate;let s=this.startDate,a=0,o;if(s>n)throw new Error("Invalid time axis configuration");for(;s<n;)o=g.min(g.getNext(s,i,e,this.weekStartDay),n),t.call(r,s,o,a,o>=n),s=o,a++}}ke._$name="TimeAxis";class Ue extends N{static get defaultConfig(){return{tooltipTemplate:i=>`
                <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                    ${i.startClockHtml}
                    ${i.endClockHtml}
                    <div class="b-sch-tip-message">${i.message}</div>
                </div>
            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onPaint"]}}internalSnapToPosition(i){var e;const{dragData:t}=this;(e=this.snapToPosition)===null||e===void 0||e.call(this,{assignmentRecord:t.assignmentRecord,eventRecord:t.eventRecord,resourceRecord:t.newResource||t.resourceRecord,startDate:t.startDate,endDate:t.endDate,snapTo:i})}buildDragHelperConfig(){const i=this,{client:e,constrainDragToTimeline:t,constrainDragToResource:r,constrainDragToTimeSlot:n,dragHelperConfig:s={}}=i,{timeAxisViewModel:a,isHorizontal:o}=e,l=o?r:n,d=o?n:r;return i.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${i.externalDropTargetSelector}`),G.merge({name:i.constructor.name,positioning:"absolute",lockX:d,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!t,removeProxyAfterDrop:!1,dragWithin:t?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:i.externalDropTargetSelector?"b-drop-target":"",outerElement:e.timeAxisSubGridElement,targetSelector:e.eventSelector,scrollManager:t?e.scrollManager:null,createProxy:c=>i.createProxy(c),snapCoordinates:({element:c,newX:u,newY:h})=>{const{dragData:f}=i;if(i.constrainDragToTimeline&&!i.constrainDragToTimeSlot&&(i.showExactDropPosition||a.snap)){const m=f.draggedEntities[0],D=i.getCoordinate(m,c,[u,h]),b=a.getDateFromPosition(D,"round"),{calendar:S}=m;if(!S||b&&S.isWorkingTime(b,g.add(b,m.fullDuration))){const C=b&&a.getPositionFromDate(b);b&&b>=e.startDate&&C!=null&&(o?u=C:h=C)}}const p={x:u,y:h};return i.internalSnapToPosition(p),p},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:i}},s,{isElementDraggable:(c,u)=>(!s||!s.isElementDraggable||s.isElementDraggable(c,u))&&i.isElementDraggable(c,u)})}onPaint({firstPaint:i}){var e;const t=this,{client:r}=t;(e=t.drag)===null||e===void 0||e.destroy(),t.drag=_e.new(t.buildDragHelperConfig()),i&&r.rowManager.ion({changeTotalHeight:()=>{var n;return t.updateYConstraint((n=t.dragData)===null||n===void 0?void 0:n[`${r.scheduledEventName}Record`])},thisObj:t}),t.showTooltip&&(t.clockTemplate=new se({scheduler:r}))}doDestroy(){var i,e,t;(i=this.drag)===null||i===void 0||i.destroy(),(e=this.clockTemplate)===null||e===void 0||e.destroy(),(t=this.tip)===null||t===void 0||t.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(i,e){const t=this;if(i){const r=j.reconfigure(e,j.mergeConfigs({forElement:t.element,id:t.tipId,getHtml:t.getTipHtml.bind(t),cls:t.tooltipCls,owner:t.client},i),{owner:t.client,defaults:{type:"tooltip"}});return r.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:t}),r}else e==null||e.destroy()}createProxy(i){const e=i.cloneNode(!0);return delete e.id,e.classList.add(`b-sch-${this.client.mode}`),e}onBeforeDragStart({context:i,event:e}){const t=this,{client:r}=t,n=t.getMinimalDragData(i,e),s=n==null?void 0:n[`${r.scheduledEventName}Record`],a=n.resourceRecord;if(r.readOnly||t.disabled||!s||s.isDraggable===!1||s.readOnly||a!=null&&a.readOnly)return!1;i.pointerStartDate=r.getDateFromXY([i.startClientX,i.startPageY],null,!1);const o=t.triggerBeforeEventDrag(`before${r.capitalizedEventName}Drag`,{...n,event:e,context:{...i,...n}})!==!1;if(o){var l;t.updateYConstraint(s,a),(l=r[`before${r.capitalizedEventName}DragStart`])===null||l===void 0||l.call(r,i,n)}return o}onAfterDragStart({context:i,event:e}){}get isDragging(){var i;return(i=this.drag)===null||i===void 0?void 0:i.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:i,event:e}){var c;var t,r;const n=this,s=(c=n.findClientFromTarget(e,i))!=null?c:n.client;n.currentOverClient=s,n.drag.unifiedProxy=n.unifiedDrag,n.onMouseOverNewTimeline(s,!0);const a=n.dragData=n.getDragData(i);if(n.suspendElementRedrawing(i.element),n.showTooltip&&n.tip){const u=a.context.dragProxy?a.context.dragProxy.firstChild:i.element;n.tip.showBy(u)}n.triggerDragStart(a),(t=s[`after${s.capitalizedEventName}DragStart`])===null||t===void 0||t.call(s,i,a);const{eventMenu:o,taskMenu:l}=s.features,d=o||l;d==null||(r=d.hideContextMenu)===null||r===void 0||r.call(d,!1)}updateDateIndicator(){const{startDate:i,endDate:e}=this.dragData,{tip:t,clockTemplate:r}=this,n=t.element.querySelector(".b-sch-tooltip-enddate");r.updateDateIndicator(t.element,i),n&&r.updateDateIndicator(n,e)}findClientFromTarget(i,e){let{target:t}=i;if(/^touch/.test(i.type)){const n=I.from(e.element,null,!0).center;t=k.elementFromPoint(n.x,n.y)}const r=we.fromElement(t,"timelinebase");return r!=null&&r.isResourceHistogram?null:r}onDrag({context:i,event:e}){const t=this,r=t.dragData,n=r.startDate;let s;if(t.constrainDragToTimeline?s=t.client:s=t.findClientFromTarget(e,r.context),t.updateDragContext(i,e),!!s){if(s!==t.currentOverClient&&t.onMouseOverNewTimeline(s),r.dirty||!t.throttleDragEvent){const a=r.valid;t.triggerEventDrag(r,n),a!==r.valid&&(r.context.valid=r.externalDragValidity=r.valid)}t.showTooltip&&t.tip&&(t.tip.lastAlignSpec.allowTargetOut=!r.valid,t.tip.realign())}}onMouseOverNewTimeline(i,e){const t=this,{drag:{lockX:r,lockY:n}}=t,s=[];t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),i.element.classList.add("b-dragging-"+i.scheduledEventName),e||t.currentOverClient.scrollManager.stopMonitoring(),r||s.push({element:i.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n||s.push({element:i.scrollable.element,direction:"vertical"}),i.scrollManager.startMonitoring({scrollables:s,callback:t.drag.onScrollManagerScrollCallback}),t.currentOverClient=i}triggerBeforeEventDropFinalize(i,e,t){t.trigger(i,e)}onDrop({context:i,event:e}){var t;const r=this,{currentOverClient:n,dragData:s}=r;let a=!1;if((t=r.tip)===null||t===void 0||t.hide(),i.valid=i.valid&&r.isValidDrop(s),r.drag.removeProxyAfterDrop=!!s.externalDropTarget,i.valid&&s.startDate&&s.endDate){let o=!1;s.finalize=async l=>{o||s.async?await r.finalize(l):i.valid=i.valid&&l},r.triggerBeforeEventDropFinalize(`before${n.capitalizedEventName}DropFinalize`,{context:s,domEvent:e},n),o=!0,i.async=s.async,!i.async&&!s.externalDropTarget&&(a=s.startDate-s.origStart!==0||s.newResource!==s.resourceRecord)}i.async||r.finalize(s.valid&&i.valid&&a)}onDragAbort({context:i}){var e;const t=this;t.client.currentOrientation.onDragAbort({context:i,dragData:t.dragData}),t.resetDraggedElements(),(e=t.tip)===null||e===void 0||e.hide(),t.triggerDragAbort(t.dragData)}onDragAbortFinalized({context:i}){var e,t;const r=this;r.triggerDragAbortFinalized(r.dragData),(e=(t=r.client)[`after${r.client.capitalizedEventName}DragAbortFinalized`])===null||e===void 0||e.call(t,i,r.dragData)}onDragReset({source:i}){var e;const t=this,r=t.currentOverClient;r==null||r.scrollManager.stopMonitoring(),(e=i.context)!==null&&e!==void 0&&e.started&&(t.resetDraggedElements(),r.trigger(`${r.scheduledEventName}DragReset`)),r==null||r.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),t.dragData=null}resetDraggedElements(){const{dragData:i}=this,{eventBarEls:e,draggedEntities:t}=i;this.resumeRecordElementRedrawing(i.record),t.forEach((r,n)=>{this.resumeRecordElementRedrawing(r),e[n].classList.remove(this.drag.draggingCls),e[n].retainElement=!1}),i.context.element.retainElement=!1}onInternalInvalidDrop(i){var e;const t=this,{context:r}=t.drag;(e=t.tip)===null||e===void 0||e.hide(),t.triggerAfterDrop(t.dragData,!1),r.valid=!1,i&&t.drag.abort()}async finalize(i){const e=this,{dragData:t}=e;if(!t||e.finalizing)return;const{context:r,draggedEntities:n,externalDropTarget:s}=t;let a;return e.finalizing=!0,n.forEach((o,l)=>{e.resumeRecordElementRedrawing(o),t.eventBarEls[l].classList.remove(e.drag.draggingCls),t.eventBarEls[l].retainElement=!1}),r.element.retainElement=!1,s&&t.valid||i?(a=e.updateRecords(t),!s&&G.isPromise(a)&&(r.async=!0,await a),t.valid?(r.async&&r.finalize(),s&&e.client.refreshRows(!1),e.triggerAfterDrop(t,!0)):e.onInternalInvalidDrop(!0)):e.onInternalInvalidDrop(r.async||t.async),e.finalizing=!1,a}updateDragContext(i,e){var f,p;const t=this,{drag:r}=t,n=t.dragData,s=t.currentOverClient,{isHorizontal:a}=s,[o]=n.draggedEntities,l=o.isAssignment?o.event:o,d=n.startDate,c=t.constrainDragToTimeSlot||(a?r.lockX:r.lockY);if(n.browserEvent=e,Object.assign(n,t.getProductDragContext(n)),c)n.timeDiff=0;else{let m;if(s.timeAxis.isContinuous){const D=s.isHorizontal?(f=i.pageX)!=null?f:i.startPageX:(p=i.pageY)!=null?p:i.startPageY,b=s.getDateFromCoordinate(D,null,!1,!0);m=n.timeDiff=b-i.pointerStartDate}else{const D=t.resolveStartEndDates(i.element);n.valid=!!(D.startDate&&D.endDate),n.valid&&(m=D.startDate-n.origStart)}m!==null&&(n.startDate=t.adjustStartDate(n.origStart,m),n.endDate=g.add(n.startDate,l.fullDuration),n.valid&&(n.timeDiff=n.startDate-n.origStart))}const u=n.dirty=n.dirty||d-n.startDate!==0;if(n.valid)if(t.constrainDragToTimeline&&(n.endDate<=s.timeAxis.startDate||n.startDate>=s.timeAxis.endDate))n.valid=!1,n.context.message=t.L("L{EventDrag.noDropOutsideTimeline}");else if(u||n.externalDropTarget){const m=n.externalDragValidity=!e||i.pageX&&t.checkDragValidity(n,e);!m||typeof m=="boolean"?(n.valid=m!==!1,n.context.message=""):(n.valid=m.valid!==!1,n.context.message=m.message)}else{var h;n.valid=n.externalDragValidity!==!1&&((h=n.externalDragValidity)===null||h===void 0?void 0:h.valid)!==!1}else n.valid=!1;n.context.valid=n.valid}suspendRecordElementRedrawing(i,e=!0){this.suspendElementRedrawing(this.getRecordElement(i),e),i.instanceMeta(this.client).retainElement=e}resumeRecordElementRedrawing(i){this.suspendRecordElementRedrawing(i,!1)}suspendElementRedrawing(i,e=!0){i&&(i.retainElement=e)}resumeElementRedrawing(i){this.suspendElementRedrawing(i,!1)}getDragData(i){const e=this,{client:t,drag:r}=e,n=e.setupProductDragData(i),{record:s,eventBarEls:a,draggedEntities:o}=n,{startEvent:l}=r,d=s.isAssignment?s.event:s,c=d.startDate,u=d.endDate,h=t.timeAxis,f=c<h.startDate,p=u>h.endDate,m=t.isSchedulerBase?t.multiEventSelect:t.selectionMode.multiSelect,D=e.getCoordinate(d,i.element,[i.elementStartX,i.elementStartY]),b=e.getCoordinate(d,i.element,[i.startClientX,i.startClientY]);e.suspendRecordElementRedrawing(s),o.forEach(C=>e.suspendRecordElementRedrawing(C)),s.isAssignment?t.selectAssignment(s,l.ctrlKey&&m):t.selectEvent(s,l.ctrlKey&&m);const S={context:i,...n,sourceDate:f?c:t.getDateFromCoordinate(D),screenSourceDate:t.getDateFromCoordinate(b,null,!1),startDate:c,endDate:u,timeDiff:0,origStart:c,origEnd:u,startsOutsideView:f,endsOutsideView:p,duration:u-c,browserEvent:l};return a.forEach(C=>C.classList.remove("b-sch-event-hover","b-active")),a.length>1&&(i.relatedElements=a.slice(1)),S}setupConstraints(i,e,t,r){const n=this,s=!n.showExactDropPosition&&t>1?t:0,a=0;r?n.setXConstraint(i.left,i.right-e.width,s):n.setXConstraint(!0,!0,s),n.setYConstraint(i.top,i.bottom-e.height,a)}updateYConstraint(i,e){const t=this,{client:r}=t,{context:n}=t.drag,s=r.timeAxisViewModel.snapPixelAmount;if(n&&!t.drag.lockY){let a;if(t.constrainDragToTimeline)a=r.getScheduleRegion(e,i);else{t.setYConstraint(null,null,s);return}t.setYConstraint(a.top,a.bottom-n.element.offsetHeight,s)}else t.setYConstraint(null,null,s)}setXConstraint(i,e,t){const{drag:r}=this;r.minX=i,r.maxX=e}setYConstraint(i,e,t){const{drag:r}=this;r.minY=i,r.maxY=e}adjustStartDate(i,e){const t=this.client.timeAxis.roundDate(new Date(i-0+e),this.client.snapRelativeToEventStartDate?i:!1);return this.constrainStartDate(t)}resolveStartEndDates(i){const e=this.currentOverClient,{timeAxis:t}=e,r=I.from(i.querySelector(e.eventInnerSelector),e.timeAxisSubGridElement),n=this.dragData,[s]=n.draggedEntities,a=s.isAssignment?s.event:s,{fullDuration:o}=a,l=e.fillTicks&&e.snapRelativeToEventStartDate;let{start:d,end:c}=e.getStartEndDatesFromRectangle(r,l?null:"round",o,!0);if(d&&c){if(l){const u=a.startDate-g.startOf(a.startDate,t.unit),h=c-d,f=u/h*r.width;r.deflate(f,0,0,f);const p=r.getStart(e.rtl,!e.isVertical);d=e.getDateFromCoordinate(p,null,!0),d=t.roundDate(d,a.startDate)}if(d=this.adjustStartDate(d,0),n.startsOutsideView)n.endsOutsideView||(d=c&&g.add(c,-o));else{if(!t.dateInAxis(d,!1)){const u=t.getTickFromDate(d);u>=0&&(d=t.getDateFromTick(u))}c=d&&g.add(d,o)}}return{startDate:d,endDate:c}}getTipHtml(){const i=this,{dragData:e,client:t,tooltipTemplate:r}=i,{startDate:n,endDate:s,draggedEntities:a}=e,o=t.getFormattedDate(n),l=t.getFormattedEndDate(s,n),{valid:d,message:c,element:u,dragProxy:h}=e.context,f=h?h.firstChild:u,p=a[0],m=p.isTask?p:p.event;return i.tip.lastAlignSpec.target=f,r({valid:d,startDate:n,endDate:s,startText:o,endText:l,dragData:e,message:c||"",[t.scheduledEventName+"Record"]:m,startClockHtml:i.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:m.isMilestone?"":i.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(i){const e=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[e]=i)}updateConstrainDragToResource(i){const e=this;if(e.drag){const{constrainDragToTimeSlot:t}=e,{isHorizontal:r}=e.client;i&&(e.constrainDragToTimeline=!0),e.drag.lockY=r?i:t,e.drag.lockX=r?t:i}}updateConstrainDragToTimeline(i){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!i,dragWithin:i?null:document.body,scrollManager:i?this.client.scrollManager:null})}constrainStartDate(i){const{dragData:e}=this,{dateConstraints:t}=e,r=e.eventRecord||e.taskRecord||e.draggedEntities[0];return t!=null&&t.start&&(i=g.max(t.start,i)),t!=null&&t.end&&(i=g.min(new Date(t.end-r.durationMS),i)),i}getElementFromContext(i){return i.grabbed||i.dragProxy||i.element}getRelatedRecords(i){return[]}getMinimalDragData(i,e){return{}}isValidDrop(i){throw new Error("Implement in subclass")}checkDragValidity(i){throw new Error("Implement in subclass")}updateRecords(i){throw new Error("Implement in subclass")}isElementDraggable(i,e){throw new Error("Implement in subclass")}getCoordinate(i,e,t){throw new Error("Implement in subclass")}setupProductDragData(i){throw new Error("Implement in subclass")}getProductDragContext(i){throw new Error("Implement in subclass")}getRecordElement(i){throw new Error("Implement in subclass")}}Ue._$name="DragBase";const Be={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class oe extends N.mixin(We,At){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:i=>`
                <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                    ${i.startClockHtml}
                    ${i.endClockHtml}
                    <div class="b-sch-tip-message">${i.message}</div>
                </div>
            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var i;super.doDestroy(),(i=this.dragging)===null||i===void 0||i.destroy()}render(){const i=this,{client:e}=i;i.dragSelector=i.dragItemSelector=e.eventSelector,i.dragRootElement=i.dropRootElement=e.timeAxisSubGridElement,i.dragLock=e.isVertical?"y":"x"}isEventElementDraggable(i,e,t,r){const n=this,s=e==null?void 0:e.resizable;return n.disabled||!s||e.isMilestone?!0:(s!==!0&&s!=="start"||!n.isOverStartHandle(r,i))&&(s!==!0&&s!=="end"||!n.isOverEndHandle(r,i))}onEventDataGenerated({eventRecord:i,wrapperCls:e,cls:t}){var r,n;i===((r=this.dragging)===null||r===void 0||(n=r.context)===null||n===void 0?void 0:n.eventRecord)&&(e["b-active"]=e[this.draggingItemCls]=e["b-over-resize-handle"]=t["b-resize-handle"]=t[this.resizingItemInnerCls]=1)}onDragPointerMove(i){var e;const{client:t,dragging:r}=this,{visibleDateRange:n,isHorizontal:s}=t,a=s&&t.rtl,o=s?"X":"Y",l=globalThis[`page${o}Offset`],d=i[`page${o}`]+(((e=r.context)===null||e===void 0?void 0:e.offset)||0),c=I.from(t.timeAxisSubGridElement,null,!0),u=c.getStart(a,s),h=c.getEnd(a,s);let f=t.getDateFromCoord({coord:d,local:!1});a?d-l>u?f=n.startDate:d<h&&(f=n.endDate):d-l<u?f=n.startDate:d-l>h&&(f=n.endDate),r.clientStartCoord=u,r.clientEndCoord=h,r.date=f,super.onDragPointerMove(i)}get isResizing(){return!!this.dragging}beforeDrag(i){const{client:e}=this,t=e.resolveTimeSpanRecord(i.itemElement),r=!e.isGanttBase&&e.resolveResourceRecord(e.isVertical?i.startEvent:i.itemElement);return this.disabled||e.readOnly||r!=null&&r.readOnly||t&&(t.readOnly||!(t.project||t.isOccurrence))||super.beforeDrag(i)===!1?!1:(i.mousedownDate=i.date=e.getDateFromCoordinate(i.event[`page${e.isHorizontal?"X":"Y"}`],null,!1),this.triggerBeforeResize(i))}dragStart(i){var e,t;const r=this,{client:n,tip:s}=r,{startEvent:a,itemElement:o}=i,l=n.scheduledEventName,d=n.resolveEventRecord(o),{isBatchUpdating:c,wrapStartDate:u,wrapEndDate:h}=d,f=(e=n.features.eventBuffer)===null||e===void 0?void 0:e.enabled,p=c?d.get("startDate"):d.startDate,m=c?d.get("endDate"):d.endDate,D=r.dragLock==="x",b=D&&n.rtl,S=r.isOverEndHandle(a,o),C=S?"endDate":"startDate",T=f?S?"wrapEndDate":"wrapStartDate":null,y=S?"startDate":"endDate",x=S?"setEndDate":"setStartDate",M=S?"setStartDate":"setEndDate",z=I.from(o),R=D?a.clientX:a.clientY,L=S?z.getEnd(b,D):z.getStart(b,D),E=i.context={eventRecord:d,element:o,timespanRecord:d,taskRecord:d,owner:r,valid:!0,oldValue:S?m:p,startDate:p,endDate:m,offset:f?0:L-R,edge:D?S?"right":"left":S?"bottom":"top",finalize:r.finalize,event:i.event,originalStartDate:p,originalEndDate:m,wrapStartDate:u,wrapEndDate:h,draggingEnd:S,toSet:C,wrapToSet:T,otherEnd:y,setMethod:x,setOtherMethod:M};d.meta.isResizing=!0,n.element.classList.add(...r.dragActiveCls.split(" ")),n.listenToBatchedUpdates||n.beginListeningForBatchedUpdates(),c||r.beginEventRecordBatch(d),r.setupProductResizeContext(E,a),r.triggerEventResizeStart(`${l}ResizeStart`,{[`${l}Record`]:d,event:a,...r.getResizeStartParams(E)},E),E.resizedRecord=((t=n.resolveAssignmentRecord)===null||t===void 0?void 0:t.call(n,E.element))||d,s&&(s.show(),s.align=Be[E.edge],s.showBy(r.getTooltipTarget(i)))}triggerBeforeResize(i){const{client:e}=this,t=e.resolveTimeSpanRecord(i.itemElement);return e.trigger(`before${e.capitalizedEventName}Resize`,{[`${e.scheduledEventName}Record`]:t,event:i.event,...this.getBeforeResizeParams({event:i.startEvent,element:i.itemElement})})}triggerEventResizeStart(i,e,t){var r,n;this.client.trigger(i,e),(r=(n=this.client)[`after${$.capitalize(i)}`])===null||r===void 0||r.call(n,t,e)}triggerEventResizeEnd(i,e){this.client.trigger(i,e)}triggerEventPartialResize(i,e){this.client.trigger(i,e)}triggerBeforeEventResizeFinalize(i,e){this.client.trigger(i,e)}dragEnter(i){var e;return((e=i.context)===null||e===void 0?void 0:e.owner)===this}resizeEventPartiallyInternal(i,e){var t;const{client:r}=this,{toSet:n}=e;if((t=r.features.eventBuffer)!==null&&t!==void 0&&t.enabled){if(n==="startDate"){const s=e.startDate.getTime()-e.originalStartDate.getTime();i.wrapStartDate=new Date(e.wrapStartDate.getTime()+s)}else if(n==="endDate"){const s=e.endDate.getTime()-e.originalEndDate.getTime();i.wrapEndDate=new Date(e.wrapEndDate.getTime()+s)}}i.set(n,e[n])}applyDateConstraints(i,e,t){var r,n;const s=(r=t.dateConstraints)===null||r===void 0?void 0:r.start,a=(n=t.dateConstraints)===null||n===void 0?void 0:n.end;return(s||a)&&(i=g.constrain(i,s,a),t.snappedDate=g.constrain(t.snappedDate,s,a)),i}moveDrag(i){const e=this,{client:t,tip:r}=e,n=e.dragLock==="x",s=n?"X":"Y",a=t.scheduledEventName,{visibleDateRange:o,enableEventAnimations:l,timeAxis:d,weekStartDay:c}=t,u=n&&t.rtl,{resolutionUnit:h,resolutionIncrement:f}=d,{event:p,context:m}=i,{eventRecord:D}=m,b=m.offset*(u?-1:1),{isOccurrence:S}=D,C=D.get("startDate"),T=D.get("endDate"),y=p[`client${s}`]+b,x=I.from(t.timeAxisSubGridElement,null,!0),M=x.getStart(u,n),z=x.getEnd(u,n);m.event=p,p.isScroll&&(i.date=t.getDateFromCoordinate(p[`page${s}`]+b,null,!1));let R,L,{date:E}=i,{toSet:A,otherEnd:P,draggingEnd:W}=m;u?y>M?E=i.date=o.startDate:y<z&&(E=i.date=o.endDate):y<M?E=i.date=o.startDate:y>z&&(E=i.date=o.endDate),A==="endDate"?E<C&&(R=-1):E>T&&(R=1),R&&e.onDragEndSwitch&&(e.onDragEndSwitch(m,E,R),P=m.otherEnd,A=m.toSet),t.snapRelativeToEventStartDate&&(E=d.roundDate(E,m.oldValue)),m.snappedDate=g.round(E,d.resolution,null,c);const F=g.diff(E,m[P],h)*(W?-1:1);if(e.isEventDragCreate)m.tooNarrow=F<f/2;else if(F<f)if(e.allowResizeToZero)m.snappedDate=E=m[P];else{const V=P==="startDate"?1:-1;m.snappedDate=E=d.roundDate(g.add(D.get(P),f*V,h)),L=!0}if(E=e.applyDateConstraints(E,D,m),(!m.date||E-m.date||L)&&(m.date=E,m[A]=e.showExactResizePosition||t.timeAxisViewModel.snap?m.snappedDate:E,m.valid=e.allowResizeToZero||m[A]-m[A==="startDate"?"endDate":"startDate"]!==0,D.get(A)-m[A])){if(m.valid=e.checkValidity(m,p),m.message="",m.valid&&typeof m.valid!="boolean"&&(m.message=m.valid.message,m.valid=m.valid.valid),m.valid=m.valid!==!1,m.valid){const V={[`${a}Record`]:D,startDate:C,endDate:T,element:i.itemElement,context:m};V[A]=m[A],e.triggerEventPartialResize(`${a}PartialResize`,V),S&&D.stores.push(t.eventStore),t.enableEventAnimations=!1,this.resizeEventPartiallyInternal(D,m),t.enableEventAnimations=l,S&&(D.stores.length=0)}m.tooNarrow&&(m.valid=!1)}r&&(r.align=Be[m.edge],r.alignTo(e.getTooltipTarget(i))),super.moveDrag(i)}dragEnd(i){const{context:e}=i;e&&(e.event=i.event),i.aborted?e==null||e.finalize(!1):!this.isEventDragCreate&&!i.started&&!O.getPagePoint(i.event).equals(O.getPagePoint(i.startEvent))&&(this.dragStart(i),this.cleanup(i.context,!1))}async dragDrop({context:i,event:e}){var t;i[i.toSet]=i.snappedDate;const{client:r}=this,{startDate:n,endDate:s}=i;let a;(t=this.tip)===null||t===void 0||t.hide(),i.valid=n&&s&&(this.allowResizeToZero||s-n>0)&&i[i.toSet]-i.oldValue&&i.valid!==!1,i.valid&&(this.triggerBeforeEventResizeFinalize(`before${r.capitalizedEventName}ResizeFinalize`,{context:i,event:e,[`${r.scheduledEventName}Record`]:i.eventRecord}),a=!0),i.async||await i.finalize(a)}async finalize(i){const e=this.owner,t=this,{eventRecord:r,oldValue:n,toSet:s}=t,{snapRelativeToEventStartDate:a,timeAxis:o}=e.client;let l=!1;i?(a&&(t[s]=t.snappedDate=o.roundDate(t.date,n)),l=await e.internalUpdateRecord(t,r)):(e.cancelEventRecordBatch(r),r.isOccurrence&&r.resources.forEach(d=>e.client.repaintEventsForResource(d))),e.cleanup(t,l)}cleanup(i,e){var t;const r=this,{client:n}=r,{element:s,eventRecord:a}=i,o=n.scheduledEventName;a.meta.isResizing=!1,n.endListeningForBatchedUpdates(),(t=r.tip)===null||t===void 0||t.hide(),r.unHighlightHandle(s),n.element.classList.remove(...r.dragActiveCls.split(" ")),r.triggerEventResizeEnd(`${o}ResizeEnd`,{changed:e,[`${o}Record`]:a,...r.getResizeEndParams(i)})}async internalUpdateRecord(i,e){const{client:t}=this,{generation:r}=e;if(e.isOccurrence)t.endListeningForBatchedUpdates(),e[e.batching>1?"endBatch":"cancelBatch"](),e.set(Ce.prototype.inSetNormalize.call(e,{startDate:i.startDate,endDate:i.endDate}));else{const s={[i.toSet]:i[i.toSet]};if(e.isEntity){var n;const{startDate:a,endDate:o,draggingEnd:l}=i;i.duration=s.duration=e.run("calculateProjectedDuration",a,o),s[i.toSet]=e.run("calculateProjectedXDateWithDuration",l?a:o,l,i.duration);const d=!e[i.otherEnd];d&&(s[i.otherEnd]=i[i.otherEnd]),e.set(s),t.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(e),(n=t.features.eventBuffer)!==null&&n!==void 0&&n.enabled&&(e[i.wrapToSet]=null);const c=[];d&&c.push(e[i.setOtherMethod](s[i.otherEnd],!1)),c.push(e[i.setMethod](s[i.toSet],!1)),await Promise.all(c),e.endBatch()}else{const a=Object.assign({},e.meta.batchChanges);delete a[i.toSet],t.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(e),e.set(a),e[i.setMethod](s[i.toSet],!1)}}return await t.project.commitAsync(),e.generation!==r}onDragItemMouseMove(i){i.pointerType!=="touch"&&!this.handleSelector&&this.checkResizeHandles(i)}checkResizeHandles(i){const e=this,{overItem:t}=e;if(t&&!e.client.readOnly&&(!e.allowResize||e.allowResize(t,i))){const r=e.client.resolveTimeSpanRecord(t);if(r!=null&&r.readOnly)return;e.isOverAnyHandle(i,t)?e.highlightHandle():e.unHighlightHandle()}}onDragItemMouseLeave(i,e){this.unHighlightHandle(e)}highlightHandle(){var n;var i;const{overItem:e,client:t}=this;((n=(i=e.syncIdMap)===null||i===void 0?void 0:i[t.scheduledEventName])!=null?n:e.querySelector(t.eventInnerSelector)).classList.add("b-resize-handle"),e.classList.add("b-over-resize-handle")}unHighlightHandle(i=this.overItem){var t;if(i){var e;const r=this,n=(t=(e=i.syncIdMap)===null||e===void 0?void 0:e[r.client.scheduledEventName])!=null?t:i.querySelector(r.client.eventInnerSelector);n&&n.classList.remove("b-resize-handle",r.resizingItemInnerCls),i.classList.remove("b-over-resize-handle",r.draggingItemCls)}}isOverAnyHandle(i,e){return this.isOverStartHandle(i,e)||this.isOverEndHandle(i,e)}isOverStartHandle(i,e){var t;return(t=this.getHandleRect("start",i,e))===null||t===void 0?void 0:t.contains(O.getPagePoint(i))}isOverEndHandle(i,e){var t;return(t=this.getHandleRect("end",i,e))===null||t===void 0?void 0:t.contains(O.getPagePoint(i))}getHandleRect(i,e,t){if(this.overItem){if(t=e.target.closest(`.${this.client.eventCls}`)||t.querySelector(`.${this.client.eventCls}`),!t)return;const r=this,n=i==="start",{client:s}=r,a=!!s.rtl,o=r.dragLock,l=o==="x",d=l?"width":"height",c=`${l?n&&!a?"left":"right":n?"top":"bottom"}Handle`,{offsetWidth:u}=t,h=s.resolveTimeSpanRecord(t),f=h==null?void 0:h.isResizable,p=I.from(t),m=p.clone(),D=globalThis.getComputedStyle(t,":before"),b=!r.handleSelector&&!Te.isHoverableDevice?r.touchHandleSize:void 0,S=b||r.handleSize||parseFloat(D[d]),C=r.handleVisibilityThreshold||2*r.handleSize,T=r.dynamicHandleSize?r.reservedSpace/2:0,y=[0,0,0,0];if(!r.disabled&&r[c]&&(u>=C||r.dynamicHandleSize)&&(f===!0||f===i)&&(!l&&!n||l&&a===n?(m[o]+=p[d]-S,y[l?3:0]=p[d]/2+T):y[l?1:2]=p[d]/2+T,p.deflate(...y),m[d]=S,m.constrainTo(p),m[d]))return m}}setupDragContext(i){const e=this;if(e.overItem&&e.isOverAnyHandle(i,e.overItem)&&e.isElementResizable(e.overItem,i)){const t=super.setupDragContext(i);return t.scrollManager=e.client.scrollManager,t}}changeHandleSize(){ne.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){ne.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(i,e){const t=this;if(!t.showTooltip)return null;if(i)i.isTooltip?i.owner=t:i=j.reconfigure(e,j.mergeConfigs({id:t.tipId},i,{getHtml:t.getTipHtml.bind(t),owner:t.client},t.tip),{owner:t,defaults:{type:"tooltip"}}),i.ion({innerhtmlupdate:"updateDateIndicator",thisObj:t}),t.clockTemplate=new se({scheduler:t.client});else if(e){var r;e.destroy(),(r=t.clockTemplate)===null||r===void 0||r.destroy()}return i}isElementResizable(i,e){var u;var t;const r=this,{client:n}=r,s=n.resolveTimeSpanRecord(i);if(n.readOnly)return!1;let a=s==null?void 0:s.isResizable;const o=(u=(t=i)===null||t===void 0?void 0:t.syncIdMap[n.scheduledEventName])!=null?u:i,l=e.target.closest('[class$="-handle"]');if(!a||l&&l!==o||(i=e.target.closest(r.dragSelector),!i))return!1;const d=i.classList.contains("b-sch-event-startsoutside"),c=i.classList.contains("b-sch-event-endsoutside");if(a===!0){if(d&&c)return!1;if(d)a="end";else if(c)a="start";else return r.isOverStartHandle(e,i)||r.isOverEndHandle(e,i)}return d&&a==="start"||c&&a==="end"?!1:!!(r.isOverStartHandle(e,i)&&a==="start"||r.isOverEndHandle(e,i)&&a==="end")}updateDateIndicator(){const{clockTemplate:i}=this,{eventRecord:e,draggingEnd:t,snappedDate:r}=this.dragging.context,n=t?e.get("startDate"):r,s=t?r:e.get("endDate"),{element:a}=this.tip;i.updateDateIndicator(a.querySelector(".b-sch-tooltip-startdate"),n),i.updateDateIndicator(a.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget({itemElement:i,context:e}){const t=this,{rtl:r}=t.client,n=I.from(i,null,!0);return t.dragLock==="x"?(!r&&e.edge==="right"||r&&e.edge==="left"?n.x=n.right-1:n.x-=t.tip.anchorSize[0]/2,n.width=t.tip.anchorSize[0]/2):(e.edge==="bottom"&&(n.y=n.bottom-1),n.height=t.tip.anchorSize[1]/2),{target:n}}basicValidityCheck(i,e){return i.startDate&&(i.endDate>i.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,i,e)}getTipHtml({tip:i}){const e=this,{startDate:t,endDate:r,toSet:n,snappedDate:s,valid:a,message:o="",timespanRecord:l}=e.dragging.context;if(!t||!r)return i.html;const d={record:l,valid:a,message:o,startDate:t,endDate:r,[n]:s};return d.startText=e.client.getFormattedDate(d.startDate),d.endText=e.client.getFormattedDate(d.endDate),d.startClockHtml=e.clockTemplate.template({date:d.startDate,text:d.startText,cls:"b-sch-tooltip-startdate"}),d.endClockHtml=e.clockTemplate.template({date:d.endDate,text:d.endText,cls:"b-sch-tooltip-enddate"}),e.tooltipTemplate(d)}beginEventRecordBatch(i){i.beginBatch()}cancelEventRecordBatch(i){i.cancelBatch()}getBeforeResizeParams(i){const{client:e}=this;return{resourceRecord:e.resolveResourceRecord(e.isVertical?i.event:i.element)}}getResizeStartParams(i){return{resourceRecord:i.resourceRecord}}getResizeEndParams(i){return{resourceRecord:i.resourceRecord,event:i.event}}setupProductResizeContext(i,e){var t,r,n;const{client:s}=this,{element:a}=i,o=s.resolveEventRecord(a),l=(t=s.resolveResourceRecord)===null||t===void 0?void 0:t.call(s,a),d=(r=s.resolveAssignmentRecord)===null||r===void 0?void 0:r.call(s,a);Object.assign(i,{eventRecord:o,taskRecord:o,resourceRecord:l,assignmentRecord:d,dateConstraints:(n=s.getDateConstraints)===null||n===void 0?void 0:n.call(s,l,o)})}checkValidity({startDate:i,endDate:e,eventRecord:t,resourceRecord:r}){const{client:n}=this;return!n.allowOverlap&&t.resources.some(s=>!n.isDateRangeAvailable(i,e,t,s))?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return`${this.client.id}-event-resize-tip`}}oe._$name="EventResize",_.registerFeature(oe,!0,"Scheduler"),_.registerFeature(oe,!1,"ResourceHistogram");const _t=function(v){var i,e;return(i=this.source)!==null&&i!==void 0&&(e=i.client.features.taskEdit)!==null&&e!==void 0&&e._canceling?!1:O.getDistanceBetween(this.startEvent,v)};class ge extends zt(oe){construct(i,e){(e==null?void 0:e.showTooltip)===!1&&(e.tip=null),super.construct(...arguments)}changeValidatorFn(i){this.createValidatorFn=i}render(){const i=this,{client:e}=i;i.dragRootElement=i.dropRootElement=e.timeAxisSubGridElement,i.dragLock=e.isVertical?"y":"x"}onDragEndSwitch(i){const{client:e}=this,{enableEventAnimations:t}=e,{eventRecord:r,draggingEnd:n}=i,s=this.dragLock==="x",{initialDate:a}=this.dragging;e.enableEventAnimations=!1,r.set({startDate:a,endDate:a}),n?Object.assign(i,{endDate:a,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"}):Object.assign(i,{startDate:a,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"}),i.draggingEnd=this.draggingEnd=!n,e.enableEventAnimations=t}beforeDrag(i){const e=this,t=super.beforeDrag(i),{pan:r,eventDragSelect:n}=e.client.features;return t!==!1&&(e.preventMultiple&&!e.isRowEmpty(i.rowRecord)||e.disabled||r&&!r.disabled||n&&!n.disabled)?!1:(e.client.preventDragSelect=!0,t)}startDrag(i){const e=super.startDrag(i);if(e!==!1){const{context:t}=i;i.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:i.element,eventElement:i.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),i.context.offset=0,i.context.oldValue=i.mousedownDate}return e}isOverEndHandle(){return this.draggingEnd}setupDragContext(i){const{client:e}=this;if(e.matchScheduleCell(i.target)){var t;const r=(t=e.resolveResourceRecord(i))===null||t===void 0?void 0:t.$original;if(r&&!r.isSpecialRow){const n=We().prototype.setupDragContext.call(this,i),s=[];return e.isVertical?s.push({element:e.scrollable.element,direction:"vertical"}):s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=e.scrollManager,n.monitoringConfig={scrollables:s},n.resourceRecord=n.rowRecord=r,n.getDistance=_t,n}}}async dragDrop({context:i,event:e}){var t;i[i.toSet]=i.snappedDate;const{client:r}=this,{startDate:n,endDate:s,eventRecord:a}=i,{generation:o}=a;let l;(t=this.tip)===null||t===void 0||t.hide(),await r.project.commitAsync(),a.generation!==o&&(i.eventRecord[i.toSet]=i.oldValue,i.eventRecord[i.toSet]=i[i.toSet]),i.valid=n&&s&&s-n>0&&i[i.toSet]-i.oldValue&&i.valid!==!1,i.valid&&(r.trigger("beforeDragCreateFinalize",{context:i,event:e,proxyElement:i.element,eventElement:i.element,eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),l=!0),i.async||await i.finalize(l)}updateDragTolerance(i){this.dragThreshold=i}changeTip(i,e){return super.changeTip(!i||i.isTooltip?i:H.assign({id:`${this.client.id}-drag-create-tip`},i),e)}async finalize(i){if(this.finalized)return;this.finalized=!0;const e=this.owner,t=this,r=()=>{e.isDestroyed||(e.client.trigger("afterDragCreate",{proxyElement:t.element,eventElement:t.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.cleanup(t))};if(i)await e.finalizeDragCreate(t),r();else{var n;await e.cancelDragCreate(t),(n=e.onAborted)===null||n===void 0||n.call(e,t),r()}}async cancelDragCreate(i){}async finalizeDragCreate(i){var e;await this.internalUpdateRecord(i,i.eventRecord);const t={stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1};return this.client.trigger("dragCreateEnd",{eventRecord:i.eventRecord,resourceRecord:i.resourceRecord,event:i.event,eventElement:i.element,stmCapture:t}),(e=this.client)===null||e===void 0||e.trigger("eventAutoCreated",{eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),t.transferred}cleanup(i){var e;const{client:t}=this,{eventRecord:r}=i;r.meta.isResizing=!1,t.endListeningForBatchedUpdates(),(e=this.tip)===null||e===void 0||e.hide(),t.element.classList.remove(...this.dragActiveCls.split(" ")),i.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(i,e,t,r=!1){return{...i,async:r,event:e,finalize:t}}onEventDataGenerated(i){var e,t;((e=this.dragging)===null||e===void 0||(t=e.context)===null||t===void 0?void 0:t.eventRecord)===i.eventRecord&&(i.wrapperCls["b-sch-dragcreating"]=!0,i.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(i,e){throw new Error("Implement in subclass")}handleBeforeDragCreate(i,e){throw new Error("Implement in subclass")}isRowEmpty(i){throw new Error("Implement in subclass")}}w(ge,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:i=>`
            <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                ${i.startClockHtml}
                ${i.endClockHtml}
                <div class="b-sch-tip-message">${i.message}</div>
            </div>
        `,dragActiveCls:"b-dragcreating"}),w(ge,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}),ge._$name="DragCreateBase";class Ne extends N{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(i,e){const t=this;e=t.processConfig(e),super.construct(i,e),t.forSelector||(t.forSelector=`${i.eventInnerSelector}:not(.b-dragproxy)`),t.clockTemplate=new se({scheduler:i}),i.ion({[`before${i.scheduledEventName}drag`]:()=>{var r;(r=t.tooltip)===null||r===void 0||r.hide()}})}processConfig(i){return typeof i=="function"?{template:i}:i}setConfig(i){super.setConfig(this.processConfig(i))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(i){this.tooltip&&(this.tooltip.disabled=i),super.doDisable(i)}onPaint({firstPaint:i}){if(i){var e;const t=this,{client:r}=t,n=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${r.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map(a=>`:not(${a})`).join("");(e=t.tooltip)===null||e===void 0||e.destroy();const s=t.tooltip=new j({axisLock:"flexible",id:t.tipId||`${t.client.id}-event-tip`,cls:t.tipCls,forSelector:`.b-timelinebase${n} .b-grid-body-container:not(.b-scrolling) ${t.forSelector}`,scrollAction:"realign",forElement:r.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:t.getTipHtml.bind(t),disabled:t.disabled,...t.config,internalListeners:t.configuredListeners});s.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:t}),Object.keys(s.$meta.configs).forEach(a=>{Object.defineProperty(this,a,{set:o=>s[a]=o,get:()=>s[a]})})}}processConfiguredListeners(){}addListener(...i){var e;const t=super.addListener(...i),r=(e=this.tooltip)===null||e===void 0?void 0:e.addListener(...i);if(t||r)return()=>{t==null||t(),r==null||r()}}removeListener(...i){var e;super.removeListener(...i),(e=this.tooltip)===null||e===void 0||e.removeListener(...i)}updateDateIndicator(){const i=this,e=i.tooltip,t=e.element.querySelector(".b-sch-tooltip-enddate");i.record&&(i.clockTemplate.updateDateIndicator(e.element,i.record.startDate),t&&i.clockTemplate.updateDateIndicator(t,i.record.endDate))}resolveTimeSpanRecord(i){return this.client.resolveTimeSpanRecord(i)}getTipHtml({tip:i,activeTarget:e}){const t=this,{client:r}=t,n=t.recordType||`${r.scheduledEventName}Record`,s=t.resolveTimeSpanRecord(e);if((s==null?void 0:s.startDate)instanceof Date){const{startDate:a,endDate:o}=s,l=r.getFormattedDate(a),d=r.getDisplayEndDate(o,a),c=r.getFormattedDate(d);return i.eventRecord=s,t.template({tip:i,[`${n}`]:s,startDate:a,endDate:o,startText:l,endText:c,startClockHtml:t.clockTemplate.template({date:a,text:l,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":t.clockTemplate.template({date:d,text:c,cls:"b-sch-tooltip-enddate"})})}else return i.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const i=this;i.monitorRecordUpdate&&!i.updateListener&&(i.updateListener=i.client.eventStore.ion({change:i.onRecordUpdate,buffer:300,thisObj:i}))}onTipHide(){var i;this.tooltip.eventRecord=null,(i=this.updateListener)===null||i===void 0||i.call(this),this.updateListener=null}onOverNewTarget({newTarget:i}){this.tooltip.eventRecord=this.resolveTimeSpanRecord(i)}onRecordUpdate({record:i}){const{tooltip:e}=this;e!=null&&e.isVisible&&i===this.record&&(e.updateContent(),e.lastAlignSpec.aligningToElement?e.realign():e.internalOnPointerOver(this.client.lastPointerEvent))}}Ne._$name="TooltipBase";class le extends N.mixin(Ee){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,tooltipTemplate:null,dragTipTemplate:i=>`
                <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                    <div class="b-sch-tip-name">${$.encodeHtml(i.name)||""}</div>
                    ${i.startClockHtml}
                    ${i.endClockHtml||""}
                </div>
            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(i,e){const t=this;super.construct(i,e),i.isVertical&&i.ion({renderRows:t.onUIReady,thisObj:t,once:!0}),t.cls=t.cls||`b-sch-${t.constructor.$$name.toLowerCase()}`,t.baseSelector=`.${t.baseCls}.${t.cls}`,t.enableResizing&&(t.showHeaderElements=!0)}doDestroy(){var i,e,t,r;const n=this;n.detachListeners("timeAxisViewModel"),n.detachListeners("timeAxis"),(i=n.clockTemplate)===null||i===void 0||i.destroy(),(e=n.tip)===null||e===void 0||e.destroy(),(t=n.drag)===null||t===void 0||t.destroy(),(r=n.resize)===null||r===void 0||r.destroy(),super.doDestroy()}doDisable(i){this.renderRanges(),super.doDisable(i)}setupTimeAxisViewModelListeners(){const i=this;i.detachListeners("timeAxisViewModel"),i.detachListeners("timeAxis"),i.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:i}),i.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:i}),i.updateLineBuffer()}onUIReady(){const i=this,{client:e}=i;e.ion({timeAxisViewModelChange:i.setupTimeAxisViewModelListeners,thisObj:i}),i.setupTimeAxisViewModelListeners(),e.hideHeaders||(i.headerContainerElement&&O.on({click:i.onTimeRangeClick,dblclick:i.onTimeRangeClick,contextmenu:i.onTimeRangeClick,delegate:i.baseSelector,element:i.headerContainerElement,thisObj:i}),i.enableResizing&&(i.drag=_e.new({name:"rangeDrag",lockX:e.isVertical,lockY:e.isHorizontal,constrain:!0,outerElement:i.headerContainerElement,targetSelector:`${i.baseSelector}`,isElementDraggable:(t,r)=>!e.readOnly&&i.isElementDraggable(t,r),rtlSource:e,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:i}},i.dragHelperConfig),i.resize=Rt.new({direction:e.mode,targetSelector:`${i.baseSelector}.b-sch-range`,outerElement:i.headerContainerElement,isElementResizable:(t,r)=>!t.matches(".b-dragging,.b-readonly")&&!r.target.matches(".b-fa"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:i}},i.resizeHelperConfig))),i.renderRanges(),i.tooltipTemplate&&(i.hoverTooltip=new j({forElement:i.headerContainerElement,getHtml({activeTarget:t}){const r=i.resolveTimeRangeRecord(t);return i.tooltipTemplate({timeRange:r})},forSelector:"."+i.baseCls+(i.cls?"."+i.cls:"")}))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(i,e){const t=this,r=[],n=[];if(!t.disabled){t._labelRotationMap={};for(const s of t.timeRanges){const a=t.renderRange(s,i,e);a&&(r.push(a.bodyConfig),n.push(a.headerConfig))}}return[r,n]}renderRanges(){const i=this,{client:e}=i,{foregroundCanvas:t}=e;if(t&&e.isPainted&&!e.timeAxisSubGrid.collapsed){const{headerContainerElement:r}=i,n=[],[s,a]=i.getDOMConfig();i.bodyCanvas||(i.bodyCanvas=k.createElement({className:`b-timeranges-canvas ${i.cls}-canvas`,parent:t,retainElement:!0})),q.sync({targetElement:i.bodyCanvas,childrenOnly:!0,domConfig:{children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:i.showHeaderElements?null:({targetElement:o,action:l})=>{(l==="reuseElement"||l==="newElement"||l==="reuseOwnElement")&&n.push(o)}}),i.showHeaderElements&&!i.headerCanvas&&(i.headerCanvas=k.createElement({className:`${i.cls}-canvas`,parent:r,retainElement:!0})),i.headerCanvas&&q.sync({targetElement:i.headerCanvas,childrenOnly:!0,domConfig:{children:a,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const o of n)i.cacheRotation(o.elementData.timeRange,o);for(const o of n)i.applyRotation(o.elementData.timeRange,o)}}get timeRanges(){return[]}shouldRenderRange(i,e=this.client.visibleDateRange.startDate,t=this.client.visibleDateRange.endDate){const{timeAxis:r}=this.client,{startDate:n,endDate:s,duration:a}=i;return!!(n&&(r.isContinuous||r.isTimeSpanInAxis(i))&&g.intersectSpans(e,t,n,a?s:g.add(n,this._lineBufferDurationMS)))}getRangeDomConfig(i,e,t,r=0){const n=this,{client:s}=n,{rtl:a}=s,o=s.getCoordinateFromDate(g.max(i.startDate,e),{respectExclusion:!0})-r,l=i.endDate?s.getCoordinateFromDate(g.min(i.endDate,t),{respectExclusion:!0,isEnd:!0})-r:o,d=Math.abs(l-o),c=d>0,u=a?`calc(${o}px - 100%)`:`${o}px`;return{className:{[n.baseCls]:1,[n.cls]:n.cls,[n.rangeCls]:c,[n.lineCls]:!c,[i.cls]:i.cls,"b-narrow-range":c&&d<n.narrowThreshold,"b-readonly":i.readOnly,"b-rtl":a},dataset:{id:i.id},elementData:{timeRange:i},style:s.isVertical?`transform: translateY(${u}); ${c?`height:${d}px`:""};`:`transform: translateX(${u}); ${c?`width:${d}px`:""};`}}renderRange(i,e,t){const r=this,{client:n}=r,{timeAxis:s}=n;if(r.shouldRenderRange(i,e,t)&&s.startDate){const a=r.getRangeDomConfig(i,s.startDate,s.endDate),o=i.iconCls&&$.xss`<i class="${i.iconCls}"></i>`,l=i.name&&$.encodeHtml(i.name),d=l||o?`<label>${o||""}${l||"&nbsp;"}</label>`:"",c={...a,style:a.style+(i.style||""),html:r.bodyRenderer?r.bodyRenderer({timeRange:i}):r.showHeaderElements&&!r.showLabelInBody?"":d};let u;return r.showHeaderElements&&(u={...a,html:r.headerRenderer?r.headerRenderer({timeRange:i}):r.showLabelInBody?"":d}),{bodyConfig:c,headerConfig:u}}}cacheRotation(i,e){if(!i.iconCls&&!i.name||!i.duration)return;const t=e.firstElementChild;t&&!i.recurringTimeSpan&&(this._labelRotationMap[i.id]=this.client.isVertical?t.offsetHeight<e.offsetHeight:t.offsetWidth>e.offsetWidth)}applyRotation(i,e){var s;var t,r;const n=this._labelRotationMap[(s=(t=i.recurringTimeSpan)===null||t===void 0?void 0:t.id)!=null?s:i.id];(r=e.firstElementChild)===null||r===void 0||r.classList.toggle("b-vertical",!!n)}getBodyElementByRecord(i){const e=typeof i=="string"?i:i==null?void 0:i.id;return e!=null&&q.getChild(this.bodyCanvas,e)}resolveTimeRangeRecord(i){}get headerContainerElement(){const i=this,{isVertical:e,timeView:t,timeAxisColumn:r}=i.client;return i._headerContainerElement||(e&&t.element?i._headerContainerElement=t.element.parentElement:e||(i._headerContainerElement=r.element)),i._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(i){const{client:e}=this;this.isConfiguring||(e.element.classList.toggle("b-sch-timeranges-with-headerelements",!!i),this.renderRanges())}populateTimeAxisHeaderMenu({column:i,items:e}){}onPaint({firstPaint:i}){i&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:i}=this.client;this._lineBufferDurationMS=i.getDateFromPosition(300)-i.getDateFromPosition(0)}onInternalResize(i,e,t,r,n){this.client.isVertical&&n!==t&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(i){const e=this.resolveTimeRangeRecord(i.target);this.client.trigger(`timeRangeHeader${$.capitalize(i.type)}`,{event:i,domEvent:i,timeRangeRecord:e})}showTip(i){const e=this;e.showTooltip&&(e.clockTemplate=new se({scheduler:e.client}),e.tip=new j(H.assign({id:`${e.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:i.element,getHtml:()=>e.getTipHtml(i.record,i.element)},e.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(i){return i=i.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"),i&&!i.classList.contains("b-over-resize-handle")}onDragStart({context:i}){const{client:e,drag:t}=this;e.isVertical?(t.minY=0,t.maxY=e.timeAxisViewModel.totalSize-i.element.offsetHeight,t.minX=0,t.maxX=Number.MAX_SAFE_INTEGER):(t.minX=0,t.maxX=e.timeAxisViewModel.totalSize-i.element.offsetWidth,t.minY=0,t.maxY=Number.MAX_SAFE_INTEGER),e.element.classList.add("b-dragging-timerange")}onDrop({context:i}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}onDrag(){}onDragReset(){}onResizeStart(){}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){}getTipHtml(i,e){const t=this,{client:r}=t,n=I.from(e),s=n.getStart(r.rtl,r.isHorizontal),a=n.getEnd(r.rtl,r.isHorizontal),o=r.getDateFromCoordinate(s,"round",!1),l=i.endDate&&r.getDateFromCoordinate(a,"round",!1),d=r.getFormattedDate(o),c=l&&r.getFormattedEndDate(l,o);return t.dragTipTemplate({name:i.name||"",startDate:o,endDate:l,startText:d,endText:c,startClockHtml:t.clockTemplate.template({date:o,text:d,cls:"b-sch-tooltip-startdate"}),endClockHtml:c&&t.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}}w(le,"configurable",{showHeaderElements:!0}),w(le,"pluginConfig",{chain:["onPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}),le._$name="AbstractTimeRanges";const Wt=Object.freeze({});class Ae extends N.mixin(Me,Ee){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(i,e){i.useBackgroundCanvas=!0,super.construct(i,e)}attachToResourceStore(i){const{client:e}=this;super.attachToResourceStore(i),e.isVertical&&e.resourceStore.ion({name:"resourceStore",group({groupers:t}){t.length===0&&this.refresh()},thisObj:this})}doDisable(i){super.doDisable(i),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(i,e){const t=this,{client:r}=t,{rtl:n}=r,s=n?-1:1,{timeAxisViewModel:a,isHorizontal:o,resourceStore:l,variableColumnWidths:d}=r,{columnConfig:c}=a,u=a.columnLinesFor,h=Math.max(u-1,0),f=i.getTime(),p=e.getTime(),m=[],D=new Set,b=o?"X":"Y";if(!t.disabled){const T=(y,x)=>{const M=y.start.getTime();M>f&&M<p&&!D.has(M)&&(D.add(M),m.push({role:"presentation",className:x?"b-column-line-major":"b-column-line",style:{transform:`translate${b}(${y.coord*s}px)`},dataset:{line:x?`major-${y.index}`:`line-${y.index}`}}))};if(u!==h)for(let y=1;y<=c[h].length-1;y++)T(c[h][y],!0);for(let y=1;y<=c[u].length-1;y++)T(c[u][y],!1);if(!o&&r.columnLines){const{columnWidth:y}=r.resourceColumns;let{first:x,last:M}=r.currentOrientation.getResourceRange(!0),z=0;if(x>-1)for(let R=x;R<M+1;R++){var S,C;const L=l.getAt(R);if(L.isGroupHeader){M++,z++;continue}const E=L.instanceMeta(l),A=d?E.insetStart+L.columnWidth-1:(R-z+1)*y-1;m.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":l.isGrouped&&((S=E.groupParent)===null||S===void 0?void 0:S.groupChildren[((C=E.groupParent)===null||C===void 0?void 0:C.groupChildren.length)-1])===L},style:{transform:`translateX(${A*s}px)`},dataset:{line:`resource-${R}`}})}}}return m}refresh(){const i=this,{client:e}=i,{timeAxis:t}=e,{startDate:r,endDate:n}=e.visibleDateRange||Wt;if(!t.startDate||!r||i.client.timeAxisSubGrid.collapsed)return;i.element||(i.element=k.createElement({parent:e.backgroundCanvas,className:"b-column-lines-canvas"}));const a=i.getColumnLinesDOMConfig(r,n);q.sync({targetElement:i.element,onlyChildren:!0,domConfig:{children:a,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:i,lastResource:e}){this.refresh()}updateCanvasSize(){this.refresh()}}Ae._$name="ColumnLines",_.registerFeature(Ae,!0,["Scheduler","Gantt"]);var Ge=v=>class extends(v||U){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const r=this;r.view=e,r.eventName=e.scheduledEventName,e.ion({readOnly:()=>r.updateCreateListeners()}),r.updateCreateListeners(),r.chain(e,"onElementTouchMove","onElementTouchMove")}doDestroy(){var e,t;const r=this;r.detachListeners("view"),r.creationData=null,(e=r.pointerUpMoveDetacher)===null||e===void 0||e.call(r),(t=r.creationTooltip)===null||t===void 0||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.detachListeners("view"),e.isCreateAllowed&&e.view.ion({name:"view",[`${e.eventName}mouseenter`]:"onTimeSpanMouseEnter",[`${e.eventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:e,source:t,[`${this.eventName}Record`]:r,[`${this.eventName}Element`]:n}){if(!r.isCreating&&!r.readOnly&&(!this.client.features.nestedEvents||r.parent.isRoot)){const s=this,{creationData:a}=s,o=k.down(n,t.eventInnerSelector);r!==(a==null?void 0:a.source)&&(s.showTerminals(r,o),a&&e.target.closest(s.client.eventSelector)&&(a.timeSpanElement=o,s.onOverTargetEventBar(e)))}}onTimeSpanMouseLeave(e){var t;const r=this,{creationData:n}=r,s=e[`${r.eventName}Element`],a=k.down(s,r.view.eventInnerSelector),o=(t=e.event)===null||t===void 0?void 0:t.relatedTarget,l=n==null?void 0:n.timeSpanElement;o&&((!n||!l||!o||!k.isDescendant(l,o))&&(e.event.isTrusted||a!==(n==null?void 0:n.sourceElement))&&r.hideTerminals(s),n&&!n.finalizing&&(n.timeSpanElement=null,r.onOverNewTargetWhileCreating(void 0,void 0,e)))}onTerminalMouseOver(e){this.creationData&&this.onOverTargetEventBar(e)}onTerminalMouseOut(e){const t=this,{creationData:r}=t,n=e.target.closest(t.view.eventSelector);n&&(!t.showingTerminalsFor||!k.isDescendant(n,t.showingTerminalsFor))&&(!r||n!==r.timeSpanElement)&&(t.hideTerminals(n),t.view.unhover(n,e)),r&&t.onOverNewTargetWhileCreating(e.relatedTarget,r.target,e)}onTerminalPointerDown(e){const t=this;if(e.button===0&&!t.creationData){var r;const n=t.view,s=n.timeAxisSubGridElement,a=e.target,o=a.closest(n.eventInnerSelector),l=I.from(n.element,document.body);e.stopPropagation(),t.creationData={sourceElement:o,source:n.resolveTimeSpanRecord(o).$original,fromSide:a.dataset.side,startPoint:I.from(a,s).center,startX:e.pageX-l.x+n.scrollLeft,startY:e.pageY-l.y+n.scrollTop,valid:!1,sourceResource:(r=n.resolveResourceRecord)===null||r===void 0?void 0:r.call(n,e),tooltip:t.creationTooltip},t.pointerUpMoveDetacher=O.on({pointerup:{element:n.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:s,handler:"onMouseMove",passive:!1},thisObj:t}),t.documentPointerUpDetacher=O.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:d})=>{d==="Escape"&&t.abort()}},thisObj:t})}}onElementTouchMove(e){var t;(t=super.onElementTouchMove)===null||t===void 0||t.call(this,e),this.connector&&e.preventDefault()}onMouseMove(e){const t=this,{view:r,creationData:n}=t,s=I.from(r.element,document.body),a=e.pageX-s.x+r.scrollLeft-n.startX,o=e.pageY-s.y+r.scrollTop-n.startY,l=Math.round(Math.sqrt(a*a+o*o))-3,d=Math.atan2(o,a);let{connector:c}=t;if(!c){if(t.onRequestDragCreate(e)===!1)return;c=t.connector}c.style.width=`${l}px`,c.style.transform=`rotate(${d}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(e){const t=this,{view:r,creationData:n}=t;if(r.trigger("beforeDependencyCreateDrag",{data:n,source:n.source})===!1)return t.abort(),!1;if(r.element.classList.add("b-creating-dependency"),t.createConnector(n.startPoint.x,n.startPoint.y),r.trigger("dependencyCreateDragStart",{data:n,source:n.source}),t.showCreationTooltip){const s=t.creationTooltip||(t.creationTooltip=t.createDragTooltip());t.creationData.tooltip=s,s.disabled=!1,s.show(),s.onMouseMove(e)}r.scrollManager.startMonitoring({scrollables:[{element:r.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:r.scrollable.element,direction:"vertical"}],callback:()=>t.lastMouseMoveEvent&&t.onMouseMove(t.lastMouseMoveEvent)})}onOverTargetEventBar(e){var t;const r=this,{view:n,creationData:s,allowDropOnEventBar:a}=r,{target:o}=e;let l=n.resolveTimeSpanRecord(o).$original;(t=l)!==null&&t!==void 0&&t.isEventSegment&&(l=l.event),!(G.isPromise(s.valid)||!a&&!o.classList.contains(r.terminalCls))&&l!==s.source&&r.onOverNewTargetWhileCreating(o,l,e)}async onOverNewTargetWhileCreating(e,t,r){const n=this,{view:s,creationData:a,allowDropOnEventBar:o,connector:l}=n;if(!G.isPromise(a.valid)&&!a.finalizing&&l){if(l.classList.remove("b-valid","b-invalid"),a.timeSpanElement&&k.removeClsGlobally(a.timeSpanElement,"b-sch-terminal-active"),!t||t===a.source||!o&&!e.classList.contains(n.terminalCls))a.target=a.toSide=null,a.valid=!1,l.classList.add("b-invalid");else{var d,c;const u=a.target=t,{source:h}=a;let f=e.dataset.side;o&&!e.classList.contains(n.terminalCls)&&(f=n.getTargetSideFromType(n.dependencyStore.modelClass.fieldMap.type.defaultValue||Z.Type.EndToStart)),s.resolveResourceRecord&&(a.targetResource=s.resolveResourceRecord(r));let p;a.toSide=f;const m=a.fromSide,D=C=>{n.isDestroyed||(a.valid=C,e.classList.add(C?"b-valid":"b-invalid"),l.classList.add(C?"b-valid":"b-invalid"),s.trigger("dependencyValidationComplete",{data:a,source:h,target:u,dependencyType:p}))};switch(!0){case(m==="start"&&f==="start"):p=Z.Type.StartToStart;break;case(m==="start"&&f==="end"):p=Z.Type.StartToEnd;break;case(m==="end"&&f==="start"):p=Z.Type.EndToStart;break;case(m==="end"&&f==="end"):p=Z.Type.EndToEnd;break}s.trigger("dependencyValidationStart",{data:a,source:h,target:u,dependencyType:p});let b=a.valid=n.dependencyStore.isValidDependency(h,u,p);G.isPromise(b)&&(b=await b),D(b);const S=b?"b-valid":"b-invalid";l.classList.add(S),(d=a.timeSpanElement)===null||d===void 0||(c=d.querySelector(`.b-sch-terminal[data-side=${f}]`))===null||c===void 0||c.classList.add("b-sch-terminal-active",S)}n.updateCreationTooltip()}}async onMouseUp(){var e;const t=this,r=t.creationData;if(r.finalizing=!0,(e=t.pointerUpMoveDetacher)===null||e===void 0||e.call(t),r.valid)if(await t.view.trigger("beforeDependencyCreateFinalize",r)===!1?r.valid=!1:G.isPromise(r.valid)&&(r.valid=await r.valid),r.valid){let s=t.createDependency(r);s!==null&&(G.isPromise(s)&&(s=await s),r.dependency=s,t.view.trigger("dependencyCreateDrop",{data:r,source:r.source,target:r.target,dependency:s}),t.doAfterDependencyDrop(r))}else t.doAfterDependencyDrop(r);else r.valid=!1,t.doAfterDependencyDrop(r);t.abort()}doAfterDependencyDrop(e){this.view.trigger("afterDependencyCreateDrop",{data:e,...e})}onDocumentMouseUp({target:e}){this.view.timeAxisSubGridElement.contains(e)||this.abort()}abort(){var e,t;const r=this,{view:n,creationData:s}=r;if(s){const{source:a,sourceResource:o,target:l,targetResource:d}=s;if(a){const c=n.getElementFromEventRecord(a,o);c&&r.hideTerminals(c)}if(l){const c=n.getElementFromEventRecord(l,d);c&&r.hideTerminals(c)}}r.creationTooltip&&(r.creationTooltip.disabled=!0),r.creationData=r.lastMouseMoveEvent=null,(e=r.pointerUpMoveDetacher)===null||e===void 0||e.call(r),(t=r.documentPointerUpDetacher)===null||t===void 0||t.call(r),r.removeConnector()}createConnector(e,t){const r=this,{view:n}=r;r.clearTimeout(r.removeConnectorTimeout),r.connector=k.createElement({parent:n.timeAxisSubGridElement,className:`${r.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),n.element.classList.add("b-creating-dependency")}createDragTooltip(){const e=this,{view:t}=e;return e.creationTooltip=j.new({id:`${t.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:e}},e.creationTooltip)}removeConnector(){const e=this,{connector:t,view:r}=e;t&&(t.classList.add("b-removing"),t.style.width="0",e.removeConnectorTimeout=e.setTimeout(()=>{t.remove(),e.connector=null},200)),r.element.classList.remove("b-creating-dependency"),e.creationTooltip&&e.creationTooltip.hide(),r.scrollManager.stopMonitoring()}showTerminals(e,t){const r=this;if(!r.isCreateAllowed||!e.project)return;const n=r.terminalCls,s=`${n}s-visible`;if(t=k.down(t,r.view.eventInnerSelector),!t.classList.contains(s)&&!r.view.element.classList.contains("b-resizing-event")&&!r.view.readOnly){if(r.client.trigger("beforeShowTerminals",{source:e})===!1)return;r.terminalSides.forEach(a=>{a=r.fixSide(a);const o=k.createElement({parent:t,className:`${n} ${n}-${a}`,dataset:{side:a,feature:!0}});o.detacher=O.on({element:o,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:r})}),t.classList.add(s),e.internalCls.add(s),r.showingTerminalsFor=t}}fixSide(e){return e==="left"?"start":e==="right"?"end":e}hideTerminals(e){const t=this,r=t.client.getTimeSpanMouseEventParams(e),n=r==null?void 0:r[`${t.eventName}Record`],s=`${t.terminalCls}s-visible`;k.forEachSelector(e,`.${t.terminalCls}`,a=>{a.detacher&&a.detacher(),a.remove()}),k.down(e,t.view.eventInnerSelector).classList.remove(s),n.internalCls.remove(s),t.showingTerminalsFor=null}createDependency(e){const{source:t,target:r,fromSide:n,toSide:s}=e,a=(n==="start"?0:2)+(s==="end"?1:0),o=this.dependencyStore.add({from:t.id,to:r.id,type:a,fromSide:n,toSide:s});return o!==null?o[0]:null}getTargetSideFromType(e){return e===Z.Type.StartToStart||e===Z.Type.EndToStart?"start":"end"}updateCreationTooltip(){const e=this,t=e.creationData,{valid:r}=t,n=e.creationTooltip,{classList:s}=n.element;if(G.isPromise(r))return s.remove("b-invalid"),s.add("b-checking"),new Promise(a=>r.then(o=>{t.valid=o,n.isDestroyed||a(e.updateCreationTooltip())}));n.html=e.creationTooltipTemplate(t)}creationTooltipTemplate(e){var d;var t;const r=this,{tooltip:n,valid:s}=e,{classList:a}=n.element;Object.assign(e,{fromText:$.encodeHtml(e.source.name),toText:$.encodeHtml((d=(t=e.target)===null||t===void 0?void 0:t.name)!=null?d:""),fromSide:e.fromSide,toSide:e.toSide||""});let o,l;return a.toggle("b-invalid",!s),a.remove("b-checking"),s===!0?(o="valid",l=r.L("L{Dependencies.valid}")):(o="invalid",l=r.L("L{Dependencies.invalid}")),n.title=`<i class="b-icon b-icon-${o}"></i>${l}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:r.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:e.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${e.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:r.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:e.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${e.toSide}`}]}]}}doDisable(e){this.isConfiguring||this.updateCreateListeners(),super.doDisable(e)}};const fe=25;var jt=v=>{var i;return i=class extends v{constructor(){super(...arguments);w(this,"gridCache",null)}getDependenciesToConsider(r,n,s,a){const o=this,{gridCache:l}=o,{timeAxis:d}=o.client;if(l){const c=new Set,u=Math.floor((r-d.startMS)/o.MS_PER_CELL),h=Math.floor((n-d.startMS)/o.MS_PER_CELL),f=Math.floor(s/fe),p=Math.floor(a/fe);for(let m=u;m<=h;m++){const D=l[m];if(D)for(let b=f;b<=p;b++){const S=D[b];if(S)for(let C=0;C<S.length;C++)c.add(S[C])}}return c}}afterDrawDependency(r,n,s,a,o){var d,c;const l=this;if(l.constructGridCache){const{MS_PER_CELL:u}=l,{startMS:h,endMS:f}=l.client.timeAxis,p=Math.ceil((f-h)/u),m=Math.floor((a-h)/u),D=Math.floor((o-h)/u),b=Math.floor(n/fe),S=Math.floor(s/fe),C=Math.min(m,D),T=Math.max(m,D),y=Math.min(b,S),x=Math.max(b,S);if(C<0&&T<0||C>p&&T>p)return;const M=Math.max(C,0),z=Math.min(T,p);for(let R=M;R<=z;R++){const L=(d=l.gridCache[R])!=null?d:l.gridCache[R]={};for(let E=y;E<=x;E++)((c=L[E])!=null?c:L[E]=[]).push(r)}}}beforeDraw(){const r=this;if(!r.gridCache){const{visibleDateRange:n}=r.client;r.constructGridCache=!0,r.MS_PER_CELL=Math.max(n.endMS-n.startMS,1e3),r.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},w(i,"$name","DependencyGridCache"),i};const Ut=Math.min(1/globalThis.devicePixelRatio,.75),Bt=["start","end","top","bottom"],X=(v,i)=>Math.abs(v-i)<.1;class J extends U{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(i,e){const t=this,r=i;let n,s,a,o,l,d,c,u,h,f,p,m,D,b,S,C,T,y,x,M,z,R,L,E,A,P,W,F,V;for(e=wt.asArray(e),V=0;i&&!F;){if(n=Object.assign(t.config,i),s=n.startBox,a=n.endBox,o=n.startShift,l=n.endShift,d=n.startSide,c=n.endSide,u=n.startArrowMargin,h=n.endArrowMargin,f=n.horizontalMargin,p=n.verticalMargin,m=n.hasOwnProperty("startHorizontalMargin")?n.startHorizontalMargin:f,D=n.hasOwnProperty("startVerticalMargin")?n.startVerticalMargin:p,b=n.hasOwnProperty("endHorizontalMargin")?n.endHorizontalMargin:f,S=n.hasOwnProperty("endVerticalMargin")?n.endVerticalMargin:p,C=n.hasOwnProperty("otherHorizontalMargin")?n.otherHorizontalMargin:f,T=n.hasOwnProperty("otherVerticalMargin")?n.otherVerticalMargin:p,y=n.otherBoxes,d=t.normalizeSide(d),c=t.normalizeSide(c),x=t.getConnectionCoordinatesFromBoxSideShift(s,d,o),M=t.getConnectionCoordinatesFromBoxSideShift(a,c,l),A=t.calcGridBaseBoxFromBoxAndDrawParams(s,d,u,m,D),P=t.calcGridBaseBoxFromBoxAndDrawParams(a,c,h,b,S),Bt.forEach(Q=>{Math.abs(A[Q]-P[Q])<=Ut&&(P[Q]=A[Q])}),t.shouldLookForPath(s,a,A,P)){var be;y=(be=y)===null||be===void 0?void 0:be.map(Q=>t.calcGridBaseBoxFromBoxAndDrawParams(Q,!1,0,C,T)),z=t.getConnectionCoordinatesFromBoxSideShift(A,d,o),R=t.getConnectionCoordinatesFromBoxSideShift(P,c,l),W=t.buildPathGrid(A,P,z,R,d,c,y),L=t.convertDecartPointToGridPoint(W,z),E=t.convertDecartPointToGridPoint(W,R),F=t.findPathOnGrid(W,L,E,d,c)}for(i=!1;!F&&!i&&e&&V<e.length;V++)i=e[V](n,r)}return F&&(F=t.prependPathWithArrowStaffSegment(F,x,d),F=t.appendPathWithArrowStaffSegment(F,M,c),F=t.optimizePath(F)),F}static calculateRelativePosition(i,e,t=!1){const r=t?"top":"start",n=t?"bottom":"end";let s;return i[n]<e[r]?s=0:i[n]<=e[n]&&i[n]>=e[r]&&i[r]<e[r]?s=1:i[r]>=e[r]&&i[n]<=e[n]?s=2:i[r]<e[r]&&i[n]>e[n]?s=-2:i[r]<=e[n]&&i[n]>e[n]?s=3:s=4,s}static boxOverlapChanged(i,e,t,r,n=!1){const s=J.calculateRelativePosition,a=s(i,e,n),o=s(t,r,n);return a!==o}shouldLookForPath(i,e,t,r){let n=!0;return(i.end-i.start<=this.startArrowMargin||e.end-e.start<=this.endArrowMargin)&&Math.abs(J.calculateRelativePosition(i,e,!0))===2&&(n=!J.boxOverlapChanged(i,e,t,r)),n}getConnectionCoordinatesFromBoxSideShift(i,e,t){let r;switch(e){case"left":r={x:i.start,y:(i.top+i.bottom)/2+t};break;case"right":r={x:i.end,y:(i.top+i.bottom)/2+t};break;case"top":r={x:(i.start+i.end)/2+t,y:i.top};break;case"bottom":r={x:(i.start+i.end)/2+t,y:i.bottom};break}return r}calcGridBaseBoxFromBoxAndDrawParams(i,e,t,r,n){let s;switch(this.normalizeSide(e)){case"left":s={start:i.start-Math.max(t,r),end:i.end+r,top:i.top-n,bottom:i.bottom+n};break;case"right":s={start:i.start-r,end:i.end+Math.max(t,r),top:i.top-n,bottom:i.bottom+n};break;case"top":s={start:i.start-r,end:i.end+r,top:i.top-Math.max(t,n),bottom:i.bottom+n};break;case"bottom":s={start:i.start-r,end:i.end+r,top:i.top-n,bottom:i.bottom+Math.max(t,n)};break;default:s={start:i.start-r,end:i.end+r,top:i.top-n,bottom:i.bottom+n}}return s}normalizeSide(i){const{rtl:e}=this.client;return i==="start"?e?"right":"left":i==="end"?e?"left":"right":i}buildPathGrid(i,e,t,r,n,s,a){let o,l,d,c,u,h,f,p,m,D,b,S,C;const T={},y=[];for(o=[i.start,n==="left"||n==="right"?(i.start+i.end)/2:t.x,i.end,e.start,s==="left"||s==="right"?(e.start+e.end)/2:r.x,e.end],l=[i.top,n==="top"||n==="bottom"?(i.top+i.bottom)/2:t.y,i.bottom,e.top,s==="top"||s==="bottom"?(e.top+e.bottom)/2:r.y,e.bottom],a&&a.forEach(x=>{o.push(x.start,(x.start+x.end)/2,x.end),l.push(x.top,(x.top+x.bottom)/2,x.bottom)}),o=[...new Set(o.sort((x,M)=>x-M))],l=[...new Set(l.sort((x,M)=>x-M))],h=0,p=l.length;h<p;++h)for(T[h]=T[h]||{},d=l[h],u=0,f=o.length;u<f;++u){if(c=o[u],S=(c<=i.start||c>=i.end||d<=i.top||d>=i.bottom)&&(c<=e.start||c>=e.end||d<=e.top||d>=e.bottom),a)for(m=0,D=a.length;S&&m<D;++m)b=a[m],S=c<=b.start||c>=b.end||d<=b.top||d>=b.bottom||c===t.x&&d===t.y||c===r.x&&d===r.y;C={distance:Number.MAX_SAFE_INTEGER,permitted:S,x:c,y:d,ix:u,iy:h},T[h][u]=C,y.push(C)}return{width:o.length,height:l.length,xs:o,ys:l,points:T,linearPoints:y}}convertDecartPointToGridPoint(i,e){const t=i.xs.indexOf(e.x),r=i.ys.indexOf(e.y);return i.points[r][t]}findPathOnGrid(i,e,t,r,n){const s=this;let a=!1;return e.permitted&&t.permitted&&(i=s.waveForward(i,e,0),a=s.collectPath(i,t,n)),a}getGridPointNeighbors(i,e,t){const r=e.ix,n=e.iy,s=[];let a;return n<i.height-1&&(a=i.points[n+1][r],(!t||t(a))&&s.push(a)),n>0&&(a=i.points[n-1][r],(!t||t(a))&&s.push(a)),r<i.width-1&&(a=i.points[n][r+1],(!t||t(a))&&s.push(a)),r>0&&(a=i.points[n][r-1],(!t||t(a))&&s.push(a)),s}waveForward(i,e,t){const r=this;return yt.preWalkUnordered([e,t],([n,s])=>r.getGridPointNeighbors(i,n,a=>a.permitted&&a.distance>s+1).map(a=>[a,s+1]),([n,s])=>n.distance=s),i}collectPath(i,e,t){const r=this,n=[];let s=!0,a,o,l,d;for(;s&&e.distance;)if(a=r.getGridPointNeighbors(i,e,c=>c.permitted&&c.distance===e.distance-1),s=a.length>0,s){switch(a=a.sort((c,u)=>{let h,f;h=c.ix-e.ix,f=c.iy-e.iy;const p=(t==="left"||t==="right")&&f===0||(t==="top"||t==="bottom")&&h===0?-1:1;h=u.ix-e.ix,f=u.iy-e.iy;const m=(t==="left"||t==="right")&&f===0||(t==="top"||t==="bottom")&&h===0?-1:1;if(p>m)return 1;if(p<m)return-1;if(p===m)return c.y>u.y?-1:1}),o=a[0],n.push({x1:o.x,y1:o.y,x2:e.x,y2:e.y}),l=o.ix-e.ix,d=o.iy-e.iy,!0){case(!d&&l>0):t="left";break;case(!d&&l<0):t="right";break;case(!l&&d>0):t="top";break;case(!l&&d<0):t="bottom";break}e=o}return s&&n.reverse()||!1}prependPathWithArrowStaffSegment(i,e,t){if(i.length>0){const r=i[0],n={x2:r.x1,y2:r.y1};switch(t){case"left":n.x1=e.x,n.y1=r.y1;break;case"right":n.x1=e.x,n.y1=r.y1;break;case"top":n.x1=r.x1,n.y1=e.y;break;case"bottom":n.x1=r.x1,n.y1=e.y;break}i.unshift(n)}return i}appendPathWithArrowStaffSegment(i,e,t){if(i.length>0){const r=i[i.length-1],n={x1:r.x2,y1:r.y2};switch(t){case"left":n.x2=e.x,n.y2=r.y2;break;case"right":n.x2=e.x,n.y2=r.y2;break;case"top":n.x2=r.x2,n.y2=e.y;break;case"bottom":n.x2=r.x2,n.y2=e.y;break}i.push(n)}return i}optimizePath(i){const e=[];let t,r;if(i.length>0)for(t=i.shift(),e.push(t);i.length>0;)r=i.shift(),X(t.x1,r.x1)&&X(t.y1,r.y1)&&X(t.x2,r.x2)&&X(t.y2,r.y2)?t=r:X(t.y1,t.y2)&&X(r.y1,r.y2)?t.x2=r.x2:X(t.x1,t.x2)&&X(r.x1,r.x2)?t.y2=r.y2:(e.push(r),t=r);return e}}J._$name="RectangularPathFinder";function Ye(v){return v.x1===v.x2?v.y2>v.y1?"d":"u":v.x2>v.x1?"r":"l"}function ze(v){return v.x1===v.x2?v.y2-v.y1:v.x2-v.x1}function Nt(v,i,e){const t=Ye(v)+Ye(i),r=e*(t.includes("l")?-1:1),n=e*(t.includes("u")?-1:1);return`a${r},${n} 0 0 ${t==="ur"||t==="lu"||t==="dl"||t==="rd"?1:0} ${r},${n}`}function Gt(v,i,e,t,r){let n=v.x1===v.x2?"v":"h",s=t;if(t){const a=ze(v),o=i?Math.abs(ze(i)):Number.MAX_SAFE_INTEGER,l=Math.sign(a);r==null&&(r=t),(Math.abs(a)<t*2||o<t*2)&&(s=Math.min(Math.abs(a),o)/2);const d=e==="single"?0:e==="first"?s:e==="between"?r+s:r,c=a-d*l;n+=Math.sign(c)!==l?0:c,e!=="last"&&e!=="single"&&s>0&&(n+=` ${Nt(v,i,s)}`)}else n+=ze(v);return{line:n,currentRadius:t!==s?s:null}}function Yt(v,i){const{length:e}=i;if(!e)return"";let t=null;return`M${i[0].x1},${i[0].y1} ${i.map((r,n)=>{const s=e===1?"single":n===e-1?"last":n===0?"first":"between",a=Gt(r,i[n+1],s,v,t);return{currentRadius:t}=a,a.line}).join(" ")}`}var Xt=v=>{var i;return i=class extends v{constructor(){super(...arguments);w(this,"lineCache",{})}onSVGReady(){const r=this;r.pathFinder=new J({...r.pathFinderConfig,client:r.client}),r.lineDefAdjusters=r.createLineDefAdjusters(),r.createMarker()}changeRadius(r){return r!==null&&H.assertNumber(r,"radius"),r}updateRadius(){this.isConfiguring||this.reset()}updateRenderer(){this.isConfiguring||this.reset()}changeClickWidth(r){return r!==null&&H.assertNumber(r,"clickWidth"),r}updateClickWidth(){this.isConfiguring||this.reset()}createMarker(){var l;var r;const n=this,{markerDef:s}=n,a=this.client.svgCanvas,o=s?`${n.client.id}-arrowEnd`:"arrowEnd";(r=n.marker)===null||r===void 0||r.remove(),a.style.setProperty("--scheduler-dependency-marker",`url(#${o})`),n.marker=k.createElement({parent:a,id:o,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:(l=n.markerDef)!=null?l:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(r){var n,s;return((n=this.client.features.eventDrag)===null||n===void 0||(s=n.getProxyElement)===null||s===void 0?void 0:s.call(n,r))||this.client.getElementFromAssignmentRecord(r)}getDomConfigs(r,n,s,a){var u;const o=this,l=o.getDependencyKey(r,n,s),d=o.lineCache[l];if(o.constructLineCache||!d||a||o.drawingLive&&(o.getAssignmentElement(n)||o.getAssignmentElement(s))){const h=o.prepareLineDef(r,n,s,a),f=h&&o.pathFinder.findPath(h,o.lineDefAdjusters),{client:p,clickWidth:m}=o,{toEvent:D}=r;if(f){var c;const b=o.highlighted.get(r),S={tag:"path",ns:"http://www.w3.org/2000/svg",d:Yt((u=o.radius)!=null?u:0,f),role:"presentation",dataset:{syncId:l,depId:r.id,fromId:n.id,toId:s.id},elementData:{dependency:r,points:f},class:{[o.baseCls]:1,[r.cls]:r.cls,[r.highlighted]:r.highlighted,[b&&[...b].join(" ")]:b,[o.noMarkerCls]:h.hideMarker,"b-inactive":r.active===!1,"b-sch-bidirectional-line":r.bidirectional,"b-readonly":r.readOnly,"b-sch-dependency-ends-outside":!D.milestone&&(D.endDate<=p.startDate||p.endDate<=D.startDate)||D.milestone&&(D.endDate<p.startDate||p.endDate<D.startDate)}};(c=o.renderer)===null||c===void 0||c.call(o,{domConfig:S,points:f,dependencyRecord:r,fromAssignmentRecord:n,toAssignmentRecord:s,fromBox:h.startBox,toBox:h.endBox,fromSide:h.startSide,toSide:h.endSide});const C=[S];return m>1&&C.push({...S,class:{...S.class,"b-click-area":1},dataset:{...S.dataset,syncId:`${S.dataset.syncId}-click-area`},style:{strokeWidth:m}}),o.lineCache[l]=C}return o.lineCache[l]=null}return d}generateBoundaryBoxes(r,n){return n==="bottom"?[{start:r.left,end:r.left+r.width/2,top:r.rowTop,bottom:r.rowBottom},{start:r.left+r.width/2,end:r.right,top:r.rowTop,bottom:r.rowBottom}]:[{start:r.left-this.pathFinder.startArrowMargin,end:r.right+this.pathFinder.startArrowMargin,top:r.rowTop,bottom:r.rowBottom}]}getAssignmentBounds(r){const{client:n}=this,s=this.getAssignmentElement(r);if(s&&!n.isExporting){const a=I.from(s,this.relativeTo);if(n.isHorizontal){let o=n.getRowById(r.resource.id);if(a.y<o.top||a.bottom>o.bottom){const l=n.rowManager.getRowAt(a.center.y,!0);l&&(o=l)}a.rowTop=o.top,a.rowBottom=o.bottom}return a}return n.isEngineReady&&n.getAssignmentEventBox(r,!0)}getConnectorStartSide(r){return this.client.currentOrientation.getConnectorStartSide(r)}getConnectorEndSide(r){return this.client.currentOrientation.getConnectorEndSide(r)}getDependencyStartSide(r){const{fromEvent:n,type:s,fromSide:a}=r;if(a)return a;switch(!0){case s===B.Type.StartToEnd:case s===B.Type.StartToStart:return this.getConnectorStartSide(n);case s===B.Type.EndToStart:case s===B.Type.EndToEnd:return this.getConnectorEndSide(n);default:return this.getConnectorEndSide(n)}}getDependencyEndSide(r){const{toEvent:n,type:s,toSide:a}=r;if(a)return a;switch(!0){case s===B.Type.EndToEnd:case s===B.Type.StartToEnd:return this.getConnectorEndSide(n);case s===B.Type.EndToStart:case s===B.Type.StartToStart:return this.getConnectorStartSide(n);default:return this.getConnectorStartSide(n)}}createLineDefAdjusters(){const{client:r}=this;function n(o){const{barMargin:l}=r;let d=!1;return(o.startArrowMargin>l||o.endArrowMargin>l)&&(o.startArrowMargin=o.endArrowMargin=l,d=!0),d&&o}function s(o){let l=!1;return(o.startArrowMargin>0||o.endArrowMargin>0)&&(o.startArrowMargin=o.endArrowMargin=0,l=!0),l&&o}function a(o,l){let d=!1;return o.horizontalMargin>2&&(o.horizontalMargin=1,d=!0,l.hideMarker=!0),d&&o}return[n,s,a]}adjustLineDef(r,n){return n}prepareLineDef(r,n,s,a){var m,D;const o=this,l=o.getDependencyStartSide(r),d=o.getDependencyEndSide(r),c=(m=a==null?void 0:a.from)!=null?m:o.getAssignmentBounds(n),u=(D=a==null?void 0:a.to)!=null?D:o.getAssignmentBounds(s),h=[];if(!c||!u)return null;let{startArrowMargin:f,verticalMargin:p}=o.pathFinder;return o.client.isHorizontal&&(c.rowTop!=null&&c.rowTop!==u.rowTop&&h.push(...o.generateBoundaryBoxes(c,l)),r.bidirectional||(/(top|bottom)/.test(l)&&(f=o.client.barMargin/2),p=o.client.barMargin/2)),o.adjustLineDef(r,{startBox:c,endBox:u,otherBoxes:h,startArrowMargin:f,verticalMargin:p,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:l,endSide:d})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},w(i,"$name","DependencyLineGenerator"),i};const Zt=["start","start","end","end"],qt=["start","end","start","end"];var Xe=v=>{var i;return i=class extends v{changeTooltip(t,r){const n=this;return r==null||r.destroy(),!n.showTooltip||!t?null:j.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},t)}getHoverTipHtml({activeTarget:t}){return this.tooltipTemplate(this.resolveDependencyRecord(t))}},w(i,"$name","DependencyTooltip"),w(i,"configurable",{showTooltip:!0,tooltipTemplate(t){return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:this.L("L{Dependencies.from}")},{text:t.fromEvent.name},{className:`b-sch-box b-${t.fromSide||Zt[t.type]}`},{tag:"label",text:this.L("L{Dependencies.to}")},{text:t.toEvent.name},{className:`b-sch-box b-${t.toSide||qt[t.type]}`}]}]}},tooltip:{$config:"nullify",value:{}}}),i};const Kt={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},Ze=v=>{var i;const e=[v];return(i=v.resource)!==null&&i!==void 0&&i.hasLinks&&e.push(...v.resource.$links.map(t=>({id:`${t.id}_${v.id}`,resource:t,event:v.event,drawDependencies:v.drawDependencies}))),e};class K extends N.mixin(Me,Ee,Ge,jt,Xt,Xe){constructor(){super(...arguments);w(this,"domConfigs",new Map);w(this,"drawingLive",!1);w(this,"lastScrollX",null);w(this,"highlighted",new Map);w(this,"visibleResources",null);w(this,"usingLinks",null);w(this,"visibleDateRange",null);w(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,t){super.construct(e,t);const{scheduledEventName:r}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[r+"DragStart"]:"refresh",[r+"DragAbort"]:"refresh",[r+"ResizeStart"]:"refresh",[r+"SegmentDragStart"]:"refresh",[r+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(e==null||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:t}),t.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),e==null||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e==null||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),e==null||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),e==null||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),e==null||e.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const t=this;t.detachListeners("scroll"),e?t.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:t}):(t.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}))}onHorizontalScroll({subGrid:e,scrollX:t}){t!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=t,this.draw())}onPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,t,r){return this.getElementsForDependency(e,t,r)[0]}getElementsForDependency(e,t,r){let n=`[data-dep-id="${e.id}"]`;return t&&(n+=`[data-from-id="${t.id}"]`),r&&(n+=`[data-to-id="${r.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(n))}resolveDependencyRecord(e){var t;return(t=e.elementData)===null||t===void 0?void 0:t.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const t=this.resolveDependencyRecord(e.target);if(t){const r=Kt[e.type];this.client.trigger(`dependency${r}`,{dependency:t,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this,r=t.resolveDependencyRecord(e.target);r&&(t.client.trigger("dependencyMouseOver",{dependency:r,event:e}),t.overCls&&t.highlight(r))}onElementMouseOut(e){const t=this,r=t.resolveDependencyRecord(e.target);r&&(t.client.trigger("dependencyMouseOut",{dependency:r,event:e}),t.overCls&&t.unhighlight(r))}isDependencyVisible(e){const t=this,{rowStore:r}=t,{fromEvent:n,toEvent:s}=e;if(!n||!s)return!1;const a=n.resource,o=s.resource;return!r.isAvailable(a)||!r.isAvailable(o)?!1:n.isModel&&!a.instanceMeta(r).hidden&&!o.instanceMeta(r).hidden}updateHighlightDependenciesOnEventHover(e){const t=this;if(e){const{client:r}=t;r.ion({name:"highlightOnHover",[`${r.scheduledEventName}MouseEnter`]:n=>t.highlightEventDependencies(n.eventRecord||n.taskRecord),[`${r.scheduledEventName}MouseLeave`]:n=>t.unhighlightEventDependencies(n.eventRecord||n.taskRecord),thisObj:t})}else t.detachListeners("highlightOnHover")}highlight(e,t=this.overCls){let r=this.highlighted.get(e);r||this.highlighted.set(e,r=new Set),r.add(t);for(const n of this.getElementsForDependency(e))n.classList.add(t)}unhighlight(e,t=this.overCls){const r=this.highlighted.get(e);r&&(r.delete(t),r.size||this.highlighted.delete(e));for(const n of this.getElementsForDependency(e))n.classList.remove(t)}highlightEventDependencies(e,t){e.dependencies.forEach(r=>this.highlight(r,t))}unhighlightEventDependencies(e,t){e.dependencies.forEach(r=>this.unhighlight(r,t))}getDependenciesToConsider(e,t,r,n){var a;var s;return(a=(s=super.getDependenciesToConsider)===null||s===void 0?void 0:s.call(this,e,t,r,n))!=null?a:this.project.dependencyStore.records.filter(o=>o.isValid)}getDependencyKey(e,t,r){return`dep:${e.id};from:${t.id};to:${r.id}`}drawDependency(e,t=!1,r=null){var n,s;const a=this,{domConfigs:o,client:l,rowStore:d,topIndex:c,bottomIndex:u}=a,{eventStore:h,useInitialAnimation:f}=l,{idMap:p}=d,{startMS:m,endMS:D}=a.visibleDateRange,{fromEvent:b,toEvent:S}=e;let C=b.assigned,T=S.assigned;if(b.isScheduled&&S.isScheduled&&h.includes(b)&&h.includes(S)&&(n=C)!==null&&n!==void 0&&n.size&&(s=T)!==null&&s!==void 0&&s.size){a.usingLinks&&(C=[...C].flatMap(Ze),T=[...T].flatMap(Ze));for(const R of C)for(const L of T){var y,x,M,z;const E=(y=p[(x=R.resource)===null||x===void 0?void 0:x.id])===null||y===void 0?void 0:y.index,A=(M=p[(z=L.resource)===null||z===void 0?void 0:z.id])===null||M===void 0?void 0:M.index,P=Math.min(b.startDateMS,S.startDateMS),W=Math.max(b.endDateMS,S.endDateMS);if(l.isExporting||E!=null&&A!=null&&R.drawDependencies!==!1&&L.drawDependencies!==!1&&d.isAvailable(R.resource)&&d.isAvailable(L.resource)&&!(E<c&&A<c||E>u&&A>u||P<m&&W<m||P>D&&W>D)){const F=a.getDependencyKey(e,R,L),V=a.getDomConfigs(e,R,L,r);V?(f&&(V[0].style={animationDelay:`${Math.max(E,A)/20*1e3}ms`}),o.set(F,V)):o.delete(F)}a.afterDrawDependency(e,E,A,P,W)}}t||a.domSync()}afterDrawDependency(e,t,r,n,s){var a;(a=super.afterDrawDependency)===null||a===void 0||a.call(this,e,t,r,n,s)}beforeDraw(){var e;(e=super.beforeDraw)===null||e===void 0||e.call(this)}afterDraw(){var e;(e=super.afterDraw)===null||e===void 0||e.call(this)}domSync(e=this.client.svgCanvas){q.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}})}fillDrawingCache(){const e=this,{client:t}=e;e.relativeTo=I.from(t.foregroundCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),e.usingLinks==null&&(e.usingLinks=t.resourceStore.some(r=>r.hasLinks))}draw(){const e=this,{client:t}=e;if(!(t.refreshSuspended||!t.foregroundCanvas||!t.isEngineReady||e.disabled&&!e._isDisabling||t.isExporting)){if(e.fillDrawingCache(),e.domConfigs.clear(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&e.visibleDateRange.endMS-e.visibleDateRange.startMS>0){const{visibleDateRange:r}=t,{topIndex:n,bottomIndex:s}=e,a=e.getDependenciesToConsider(r.startMS,r.endMS,n,s);e.beforeDraw();for(const o of a)e.drawDependency(o,!0);e.afterDraw()}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var e,t,r,n;const s=this,{client:a}=s,{scheduledEventName:o}=a;s.draw(),s.drawingLive=a.dependencyStore.count&&(a.isAnimating||a.useInitialAnimation&&a.eventStore.count||((e=a.features[`${o}Drag`])===null||e===void 0?void 0:e.isActivelyDragging)||((t=a.features[`${o}Resize`])===null||t===void 0?void 0:t.isResizing)||((r=a.features[`${o}SegmentDrag`])===null||r===void 0?void 0:r.isActivelyDragging)||((n=a.features[`${o}SegmentResize`])===null||n===void 0?void 0:n.isResizing)),s.drawingLive&&s.refresh()}refresh(){const{client:e}=this;!e.refreshSuspended&&!this.disabled&&e.isPainted&&!e.timeAxisSubGrid.collapsed&&this.doRefresh()}reset(){var e;(e=super.reset)===null||e===void 0||e.call(this),this.refresh()}drawForEvent(){ne.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}}w(K,"$name","Dependencies"),w(K,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null}),w(K,"delayable",{doRefresh:10}),K._$name="Dependencies",_.registerFeature(K,!1,["Scheduler","ResourceHistogram"]),_.registerFeature(K,!0,"SchedulerPro");class de extends N{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:i}){const e=this;i.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:e.disabled,localeClass:e,weight:100,menu:{type:"popup",localeClass:e,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:e,width:200,internalListeners:{change:e.onEventFilterChange,thisObj:e}}},onBeforeShow({source:t}){const[r]=t.items,n=e.store.filters.getBy("property","name");r.value=(n==null?void 0:n.value)||""}}}}onEventFilterChange({value:i}){i!==""?this.store.filter("name",i):this.store.removeFilter("name")}get store(){const{client:i}=this;return i.isGanttBase?i.store:i.eventStore}}de.featureClass="b-event-filter",de._$name="EventFilter",_.registerFeature(de,!0,["Scheduler","Gantt"]),_.registerFeature(de,!1,"ResourceHistogram");var qe=v=>{var i;return i=class extends v{getNonWorkingTimeRanges(t,r,n){if(!t.getNonWorkingTimeRanges){const s=[];return t.forEachAvailabilityInterval({startDate:r,endDate:n,isForward:!0},(a,o,l)=>{for(const[d,c]of l.intervalGroups)c.getIsWorking()||s.push({name:d.name,iconCls:d.iconCls,cls:d.cls,startDate:a,endDate:o})}),s}return t.getNonWorkingTimeRanges(r,n)}getCalendarTimeRanges(t,r=!1){const n=this,{timeAxis:s,fillTicks:a}=n.client,{unit:o,increment:l}=s,d=!n.maxTimeAxisUnit||g.compareUnits(o,n.maxTimeAxisUnit)<=0;if(t&&d&&s.count){const c=n.getNonWorkingTimeRanges(t,s.startDate,s.endDate),u=c.map(p=>new Ce({name:p.name,cls:`b-nonworkingtime ${p.cls||""}`,startDate:p.startDate,endDate:p.endDate})),h=[];let f=null;for(const p of u)f&&p.startDate<=f.endDate&&(r||p.name===f.name)&&p.duration>0?f.endDate=p.endDate:(h.push(p),p.setData("id",`nonworking-${h.length}`),f=p);return a&&h.forEach(p=>{p.setStartEndDate(g.ceil(p.startDate,{magnitude:l,unit:o}),g.floor(p.endDate,{magnitude:l,unit:o}))}),h}else return[]}setupDefaultCalendar(){const{client:t,project:r}=this;!this.autoGeneratedWeekends&&!t.isSchedulerPro&&!t.isGantt&&r.effectiveCalendar===r.defaultCalendar&&!r.defaultCalendar.intervalStore.count&&(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const t=this.client.project.effectiveCalendar,r=this.defaultNonWorkingIntervals,n=!!r.length;t.clearIntervals(n),n&&t.addIntervals(r)}}updateLocalization(){var t;(t=super.updateLocalization)===null||t===void 0||t.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return g.nonWorkingDaysAsArray.map(r=>({recurrentStartDate:`on ${t[r]} at 0:00`,recurrentEndDate:`on ${t[(r+1)%7]} at 0:00`,isWorking:!1}))}},w(i,"$name","NonWorkingTimeMixin"),w(i,"configurable",{maxTimeAxisUnit:"week"}),i};class re extends le.mixin(Me,qe){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(i){ne.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!i}get highlightWeekends(){return!this.disabled}onConfigChange({name:i}){!this.isConfiguring&&i==="fillTicks"&&this.refresh()}attachToProject(i){super.attachToProject(i),this.attachToCalendar(i.effectiveCalendar),!i.graph&&!this.client.isScheduler&&i.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(i.effectiveCalendar),once:!0},thisObj:this}),i.ion({name:"project",calendarChange:()=>this.attachToCalendar(i.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...i){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...i)}attachToCalendar(i){const e=this,{project:t,client:r}=e;e.detachListeners("calendar"),e.autoGeneratedWeekends=!1,i&&(e.setupDefaultCalendar(),i.intervalStore.ion({name:"calendar",change:()=>e.setTimeout(()=>e.refresh(),1)})),r.isEngineReady&&!r.project.isDelayingCalculation&&!r.isDestroying?e.refresh():t.isDestroyed||(e.detachListeners("initialProjectListener"),t.ion({name:"initialProjectListener",refresh({isCalculated:n}){n!==!1&&(e.refresh(),e.detachListeners("initialProjectListener"))},thisObj:e}))}get calendar(){var i;return(i=this.project)===null||i===void 0?void 0:i.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=g.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(i){return super.shouldRenderRange(i)&&(!this.hideRangesOnZooming||i.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const i=this;return i._timeRanges||(i._timeRanges=i.getCalendarTimeRanges(i.calendar)),i._timeRanges}}w(re,"$name","NonWorkingTime"),w(re,"pluginConfig",{chain:["onPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]}),re._$name="NonWorkingTime",_.registerFeature(re,!1,"Scheduler"),_.registerFeature(re,!0,["SchedulerPro","Gantt","ResourceHistogram"]);class ce extends N{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:i=>`<div class="b-sch-hovertip-msg">${i.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:i}){if(!i)return;const e=this,{client:t}=e;t.isSchedulerPro&&e.hideForNonWorkingTime===void 0&&(e.hideForNonWorkingTime=!0);let r;const n=e.hoverTip=new j({id:`${t.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",getHtml:e.getHoverTipHtml.bind(e),onDocumentMouseDown(s){n.forElement.contains(s.event.target)&&(r=O.on({thisObj:e,element:t.timeAxisSubGridElement,mousemove:o=>n.internalOnPointerOver(o),capture:!0}));const a=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,s),n.hideAnimation=a},...e.config,internalListeners:e.configuredListeners});n.ion({pointerover({event:s}){const a="buttons"in s?s.buttons>0:s.which>0;return!a&&r&&r(),!e.disabled&&!a},innerhtmlupdate({source:s}){e.clockTemplate.updateDateIndicator(s.element,e.lastTime)}}),t.ion({timeAxisViewModelUpdate:"updateTip",thisObj:e}),e.clockTemplate=new se({scheduler:t})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:i,event:e}){const t=this,r=t.client,n=e&&r.getDateFromDomEvent(e,"floor",!0);let s=t.lastHtml;if(n&&e.target){const a=r.resolveResourceRecord(e);if(a&&(n-t.lastTime!==0||a.id!==t.lastResourceId)){if(t.hideForNonWorkingTime){const o=a.isWorkingTime(n);i.element.classList.toggle("b-nonworking-time",!o)}t.lastResourceId=a.id,s=t.lastHtml=t.generateTipContent({date:n,event:e,resourceRecord:a})}}else i.hide(),t.lastTime=null,t.lastResourceId=null;return s}generateTipContent({date:i,event:e,resourceRecord:t}){const r=this,n=r.clockTemplate.generateContent({date:i,text:r.client.getFormattedDate(i)}),s=r.messageTemplate({message:r.getText(i,e,t)||""});return r.lastTime=i,n+s}getText(i,e,t){}}ce.featureClass="b-scheduletip",ce._$name="ScheduleTooltip",_.registerFeature(ce,!0,"Scheduler"),_.registerFeature(ce,!1,"ResourceUtilization");const Jt={maintainVisibleStart:!0};class pe extends mt{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateTimeAxisHeaderMenu"),i}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(i){const{column:e,targetElement:t}=i,{client:r}=this;return r.isHorizontal?(e==null?void 0:e.enableHeaderContextMenu)!==!1&&(e==null?void 0:e.isTimeAxisColumn):t.matches(".b-sch-header-timeaxis-cell")}showContextMenu(i){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:i}){const e=this,{client:t}=e,r={magnitude:t.timeAxis.shiftIncrement,unit:t.timeAxis.shiftUnit};Object.assign(i,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:e,icon:"b-fw-icon b-icon-search-plus",disabled:!t.presets.count||e.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:n}){const[s]=n.items;s.min=t.minZoomLevel,s.max=t.maxZoomLevel,s.value=t.zoomLevel,e.zoomDetatcher=s.ion({change:"onZoomSliderChange",thisObj:e})},onHide(){e.zoomDetatcher&&(e.zoomDetatcher(),e.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:e,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:e},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:r,internalListeners:{change:e.onRangeDateFieldChange,thisObj:e}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:r,internalListeners:{change:e.onRangeDateFieldChange,thisObj:e}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:e.onLeftShiftBtnClick,thisObj:e}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",internalListeners:{click:e.onTodayBtnClick,thisObj:e}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:e.onRightShiftBtnClick,thisObj:e}}},internalListeners:{paint:e.initDateRangeFields,thisObj:e}}}})}onZoomSliderChange({value:i}){const e=this;e.menu.scrollAction="realign",e.client.zoomLevel=i,e.menu.setTimeout({fn:()=>e.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:i,firstPaint:e}){if(e){const{widgetMap:t}=i;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const i=this;i.startDateField.suspendEvents(),i.endDateField.suspendEvents(),i.startDateField.value=i.startDateFieldInitialValue=i.client.startDate,i.endDateField.value=i.endDateFieldInitialValue=i.client.endDate,i.startDateField.resumeEvents(),i.endDateField.resumeEvents()}onRangeDateFieldChange({source:i}){const e=this,t=i===e.startDateField,{client:r}=e,{timeAxis:n}=r,s=e.startDateFieldInitialValue&&!t?e.startDateFieldInitialValue:e.startDateField.value;let a=e.endDateFieldInitialValue&&t?e.endDateFieldInitialValue:e.endDateField.value;t?e.startDateFieldInitialValue=null:e.endDateFieldInitialValue=null,a-s?a<s&&(a=g.add(s,n.shiftIncrement,n.shiftUnit)):a=g.add(a,n.shiftIncrement,n.shiftUnit),r.setTimeSpan(s,a,Jt),e.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const i=g.clearTime(new Date);this.client.setTimeSpan(i,g.add(i,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}pe._$name="TimeAxisHeaderMenu",_.registerFeature(pe,!0,["Scheduler","Gantt"]),_.registerFeature(pe,!1,"ResourceHistogram");class Le extends Oe(){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(i){const e=this;e.unitToPixelsCache={},super.construct(i);const t=e.timeAxis.viewPreset||e.viewPreset;if(t)if(t instanceof Y)e.consumeViewPreset(t);else{const r=ie.getPreset(t);r&&e.consumeViewPreset(r)}e.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:e}),e.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(i,e,t=this.viewPreset){const{timeAxis:r,availableSpace:n}=this,{bufferCoef:s}=this.owner,{leafUnit:a,leafIncrement:o,topUnit:l,topIncrement:d,tickSize:c}=t,u=a===l&&Math.round(d)===d&&Math.round(o)===o,h=u?d:o,f=u?l:a;if(e){const p=Math.ceil((n*s+n/2)/c);return{startDate:r.floorDate(g.add(i,-p*o,a),!1,f,h),endDate:r.ceilDate(g.add(i,p*o,a),!1,f,h)}}else{const p=Math.ceil(n*s/c);return{startDate:r.floorDate(g.add(i,-p*o,a),!1,f,h),endDate:r.ceilDate(g.add(i,Math.ceil((n/c+p)*o),a),!1,f,h)}}}get columnConfig(){return this._columnConfig}set columnConfig(i){this._columnConfig=i}get headers(){return this._headers}set headers(i){if(i&&i.length&&i[i.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=i}get isTimeAxisViewModel(){return!0}get isHorizontal(){return this.mode!=="vertical"}get isVertical(){return this.mode==="vertical"}set forceFit(i){i!==this._forceFit&&(this._forceFit=i,this.update())}reconfigure(i){this.headers=null,this.setConfig(i),this.trigger("reconfigure")}onTimeAxisReconfigure({source:i,suppressRefresh:e}){this.viewPreset!==i.viewPreset&&this.consumeViewPreset(i.viewPreset),!e&&i.count>0&&this.update()}update(i,e=!1,t=!1){const r=this,{timeAxis:n,headers:s}=r,a=i!==0;if(r.isConfiguring||a&&r._availableSpace===i){t&&r.trigger("update");return}if(r._availableSpace=Math.max(i||r.availableSpace||0,0),typeof r.availableSpace!="number")throw new Error("Invalid available space provided to TimeAxisModel");r.columnConfig=[];const o=r._tickSize=r.calculateTickSize(r.originalTickSize);if(typeof o!="number"||o<=0)throw new Error("Invalid timeAxis tick size");r.unitToPixelsCache={},r._totalSize=null;for(let l=0,{length:d}=s;l<d;l++){const c=s[l];if(c.cellGenerator){const u=c.cellGenerator.call(r,n.startDate,n.endDate);r.columnConfig[l]=r.createHeaderRow(l,c,u)}else r.columnConfig[l]=r.createHeaderRow(l,c)}e||r.trigger("update")}getDistanceBetweenDates(i,e){return this.getPositionFromDate(e)-this.getPositionFromDate(i)}getDistanceForDuration(i){return this.getSingleUnitInPixels("millisecond")*i}getPositionFromDate(i,e={}){const t=this.getScaledTick(i,e);return t===-1?-1:this.tickSize*(t-this.timeAxis.visibleTickStart)}getScaledTick(i,{respectExclusion:e,snapToNextIncluded:t,isEnd:r,min:n,max:s}){const{timeAxis:a}=this,{include:o,unit:l}=a;let d=a.getTickFromDate(i);if(d!==-1&&e&&o){let c=!1;if(o.hour&&g.compareUnits(l,"hour")>0&&l!=="day"){const{from:u,to:h,lengthFactor:f,center:p}=o.hour,m=i.getHours(),D=Math.min(Math.max(m,u),h);if(!t&&D!==m)return-1;const b=D+i.getMinutes()/60,S=p-b,C=p-S*f;i=g.add(i,C-m,"h"),c=!0}if(o.day&&g.compareUnits(l,"day")>0){const{from:u,to:h,lengthFactor:f,center:p}=o.day;let m=i.getDay();r&&i.getHours()===0&&i.getMinutes()===0&&i.getSeconds()===0&&i.getMilliseconds()===0&&--m<0&&(m=6);let D=0;if(m<u||m>=h)if(t){if(r?D=(h-m-8)%7:D=(u-m+7)%7,i=g.add(i,D,"d"),i=g.startOf(i,"d",!1),s&&i.getTime()>=s||n&&i.getTime()<=n)return-1}else return-1;const{weekStartDay:b}=a,S=i.getDay()===0?0:p,C=i.getDay()+i.getHours()/24,T=S-C,y=S-T*f;i=g.add(i,y-C+b,"d"),c=!0}c&&(i=g.constrain(i,a.startDate,a.endDate),d=a.getTickFromDate(i))}return d}getDateFromPosition(i,e,t=!1){const r=this,{timeAxis:n}=r,s=r.getScaledPosition(i)/r.tickSize+n.visibleTickStart;if(s<0||s>n.count){if(t){let a;return s<0?a=g.add(n.startDate,s,n.unit):a=g.add(n.endDate,s-n.count,n.unit),e&&(a=n[e+"Date"](a)),a}return null}return n.getDateFromTick(s,e)}getScaledPosition(i){const{include:e,unit:t,weekStartDay:r}=this.timeAxis;if(e){const n=this.getSingleUnitInPixels("day");if(e.day&&g.compareUnits(t,"day")>0){const{from:s,lengthFactor:a}=e.day,o=i%(n*7),l=i-o;i=o/a+(s-r)*n+l}if(e.hour&&g.compareUnits(t,"hour")>0&&t!=="day"){const{from:s,lengthFactorExcl:a}=e.hour,o=this.getSingleUnitInPixels("hour"),l=i%n,d=i-l;i=l/a+s*o+d}}return i}getSingleUnitInPixels(i){const e=this;return e.unitToPixelsCache[i]||(e.unitToPixelsCache[i]=g.getUnitToBaseUnitRatio(e.timeAxis.unit,i,!0)*e.tickSize/e.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:i}=this.timeAxis;return(i.increment||1)*this.getSingleUnitInPixels(i.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(i){this.setTickSize(i,!1)}setTickSize(i,e){this._tickSize=this.originalTickSize=i,this.update(void 0,e)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(i){const e=this,{forceFit:t,timeAxis:r,suppressFit:n}=e,s=r.unit;let a=0,o=1;if(e.snap){const l=r.resolution;o=g.getUnitToBaseUnitRatio(s,l.unit)*l.increment}if(n)a=i;else{const l=e.availableSpace/r.visibleTickTimeSpan;a=t||i<l?l:i,o>0&&(!t||o<1)&&(a=Math.max(1,o*a)/o)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(i){const e=this;if(e._availableSpace=Math.max(0,i),e._availableSpace>0){const t=e.calculateTickSize(e.originalTickSize);t>0&&t!==e.tickSize&&e.update()}}getDates(i=this.columnLinesFor,e=!1,t=!1){const r=this,n=[],s=e?r.lowestHeader:i,a=r.majorHeaderLevel,o=r.headers&&r.headers[i].unit,l=a!=null&&r.headers&&r.headers[a].unit,d=a!=null&&g.doesUnitsAlign(l,o);if(!!(r.headers&&r.headers[s].cellGenerator)){const u=r.columnConfig[s];for(let h=1,f=u.length;h<f;h++)n.push({date:u[h].startDate})}else r.forEachInterval(s,(u,h)=>{n.push({date:t?h:u,isMajor:a!==i&&d&&r.isMajorTick(t?h:u)})});return n}get forceFit(){return this._forceFit}fitToAvailableSpace(i){const e=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(e,i)}get snap(){return this._snap}set snap(i){i!==this._snap&&(this._snap=i,this.configured&&this.update())}createHeaderRow(i,e,t){const r=this,n=[],{align:s,headerCellCls:a=""}=e,o=g.clearTime(new Date),{timeAxis:l}=r,d=r.headers.length-1,c=(h,f,p,m,D)=>{let b=g.format(h,e.dateFormat);const S=p>0&&!m,C={align:s,start:h,end:f,value:D?D.header:b,headerCellCls:a,width:d===i&&r.owner&&(l.fullTicks||S)?r.owner.tickSize:r.getDistanceBetweenDates(h,f),index:p};C.width!==0&&(C.coord=u-1,u+=C.width,r.headersDatesCache[i][h.getTime()]=1,e.renderer&&(b=e.renderer.call(e.thisObj||r,h,f,C,p),C.value=b==null?"":b),e.unit==="day"&&(!e.increment||e.increment===1)&&(C.headerCellCls+=" b-sch-dayheadercell-"+h.getDay(),g.clearTime(h,!0)-o===0&&(C.headerCellCls+=" b-sch-dayheadercell-today")),n.push(C))};let u=0;return r.headersDatesCache[i]={},t?t.forEach((h,f)=>c(h.start,h.end,f,f===t.length-1,h)):r.forEachInterval(i,c),n}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:i}=this;return i?Math.max(i.length-2,0):null}isMajorTick(i){const e=this.majorHeaderLevel;return e!=null&&this.headersDatesCache[e]&&this.headersDatesCache[e][i.getTime()]||!1}forEachInterval(i,e,t=this){const{headers:r,timeAxis:n}=this;if(r)if(i===r.length-1)n.forEach((s,a)=>e.call(t,s.startDate,s.endDate,a,a===n.count-1));else{const s=r[i];n.forEachAuxInterval(s.unit,s.increment,e,t)}}forEachMainInterval(i,e){this.forEachInterval(this.mainHeaderLevel,i,e)}consumeViewPreset(i){const e=this;e.headers=null,e.getConfig("tickSize"),e.viewPreset=i,Object.assign(e,{headers:i.headers,columnLinesFor:i.columnLinesFor,mainHeaderLevel:i.mainHeaderLevel,_tickSize:e.isHorizontal?i.tickWidth:i.tickHeight}),e.originalTickSize=e.tickSize}}Le._$name="TimeAxisViewModel";const Ke=new Date;var Je=v=>{var i;return i=class extends(v||U){getRtlX(t){return this.rtl&&this.isHorizontal&&(t=this.timeAxisViewModel.totalSize-t),t}getDateFromCoordinate(t,r,n=!0,s=!1,a=!1){return n||(t=this.currentOrientation.translateToScheduleCoordinate(t)),a||(t=this.getRtlX(t)),this.timeAxisViewModel.getDateFromPosition(t,r,s)}getDateFromCoord(t){return this.getDateFromCoordinate(t.coord,t.roundingMethod,t.local,t.allowOutOfRange,t.ignoreRTL)}getDateFromXY(t,r,n=!0,s=!1){return this.currentOrientation.getDateFromXY(t,r,n,s)}getDateFromDomEvent(t,r,n=!1){return this.getDateFromXY([t.pageX,t.pageY],r,!1,n)}getStartEndDatesFromRectangle(t,r,n,s=!1){const a=this,{isHorizontal:o}=a,l=o?t.x:t.top,d=o?t.right:t.bottom;let c,u;return l>=0&&d<a.timeAxisViewModel.totalSize?(c=a.getDateFromCoordinate(l,r,!0),u=a.getDateFromCoordinate(d,r,!0)):l<0?(u=a.getDateFromCoordinate(d,r,!0,s),c=u&&g.add(u,-n,"ms")):(c=a.getDateFromCoordinate(l,r,!0,s),u=c&&g.add(c,n,"ms")),{start:c,end:u}}getDisplayEndDate(t,r){return t.getHours()===0&&t.getMinutes()===0&&(!r||!(t.getYear()===r.getYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()))&&!g.formatContainsHourInfo(this.displayDateFormat)&&(t=g.add(t,-1,"day")),t}getFormattedEndDate(t,r){return this.getFormattedDate(this.getDisplayEndDate(t,r))}getCoordinateFromDate(t,r=!0){const n=this,{timeAxisViewModel:s}=n,{isContinuous:a,startMS:o,endMS:l,startDate:d,endDate:c,unit:u}=n.timeAxis,h=t.valueOf();r===!0?r={local:!0}:r?"local"in r||(r.local=!0):r={local:!1};let f;if(t instanceof Date||(Ke.setTime(t),t=Ke),a&&t.getTimezoneOffset()===d.getTimezoneOffset()&&d.getTimezoneOffset()===c.getTimezoneOffset()&&g.getUnitToBaseUnitRatio(u,"day")!==-1){if(h<o||h>l)return-1;f=(h-o)/(l-o)*s.totalSize}else f=s.getPositionFromDate(t,r);return n.rtl&&n.isHorizontal&&(f=s.totalSize-f),r.local||(f=n.currentOrientation.translateToPageCoordinate(f)),f}getTimeSpanDistance(t,r){return this.timeAxisViewModel.getDistanceBetweenDates(t,r)}get viewportCenterDate(){const{timeAxis:t,timelineScroller:r}=this;if(t.isContinuous){const n=(r.position+r.clientSize/2)/r.scrollSize;return new Date(t.startMS+(t.endMS-t.startMS)*n)}return this.getDateFromCoordinate(r.position+r.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(t){this.timeAxis.resolution=typeof t=="number"?{increment:t,unit:this.timeAxis.resolution.unit}:t}get snap(){var r;var t;return(r=(t=this._timeAxisViewModel)===null||t===void 0?void 0:t.snap)!=null?r:this._snap}updateSnap(t){this.isConfiguring||(this.timeAxisViewModel.snap=t,this.timeAxis.forceFullTicks=t&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:t,scrollLeft:r,scrollX:n}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},w(i,"$name","TimelineDateMapper"),w(i,"configurable",{snap:!1}),i};const{eventNameMap:Qt}=O;var Qe=v=>{var i;return i=class extends(v||U){constructor(){super(...arguments);w(this,"hoveredEvents",new Set)}initDomEvents(){const r=this,{schedulerEvents:n,schedulerEnterLeaveEvents:s}=r;n.element=s.element=r.timeAxisSubGridElement,n.thisObj=s.thisObj=r,O.on(n),O.on(s),Te.supportsPointerEventConstructor&&O.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:r})}getTimeSpanMouseEventParams(r,n){throw new Error("Implement in subclass")}getScheduleMouseEventParams(r,n){throw new Error("Implement in subclass")}handleScheduleEvent(r){const n=this,s=n.getTimelineEventContext(r);n.lastPointerEvent=r,s&&n.trigger(`${s.eventElement?n.scheduledEventName:"schedule"}${Qt[r.type]||$.capitalize(r.type)}`,s),n.timelineContext=s}handleScheduleEnterLeaveEvent(r){r.target.parentElement===this.foregroundCanvas&&this.handleScheduleEvent(r)}onScheduleScroll({target:r}){var l,d;var n;const s=this;if(r&&s.updateTimelineContextOnScroll&&!((n=s.features.pan)!==null&&n!==void 0&&n.isActive)&&!s.partners.some(c=>{var u;return(u=c.features.pan)===null||u===void 0?void 0:u.isActive})&&(r.contains(s.element)||s.bodyElement.contains(r))){const{timelineContext:c,lastPointerEvent:u}=s;if(c){var a,o;const h=k.elementFromPoint(c.domEvent.clientX,c.domEvent.clientY),f=new Te.PointerEventConstructor("pointermove",u),p=new MouseEvent("mousemove",u);Object.defineProperty(f,"pointerId",{value:(d=(l=(a=xe.currentPointerDown)===null||a===void 0?void 0:a.pointerId)!=null?l:(o=xe.currentTouch)===null||o===void 0?void 0:o.identifier)!=null?d:1}),f.scrollInitiated=p.scrollInitiated=!0,h==null||h.dispatchEvent(f),h==null||h.dispatchEvent(p)}}}updateTimelineContext(r,n){this.trigger("timelineContextChange",{oldContext:n,context:r}),r||this.trigger("scheduleMouseLeave")}getTimelineEventContext(r){const n=this,s=r.target.closest(n.eventInnerSelector),a=n.getCellElementFromDomEvent(r);if(a){const o=n.getDateFromDomEvent(r,"floor");if(!o)return;const l=Tt.get(a),d=s?n.getTimeSpanMouseEventParams(s,r):n.getScheduleMouseEventParams(l,r);if(!d)return;const c=n.isVertical?n.resourceStore.indexOf(d.resourceRecord):l.row.dataIndex,u=n.timeAxis.getTickFromDate(o),h=n.timeAxis.getAt(Math.floor(u));if(h)return{isTimelineContext:!0,domEvent:r,eventElement:s,cellElement:a,index:c,tick:h,tickIndex:u,date:o,tickStartDate:h.startDate,tickEndDate:h.endDate,tickParentIndex:h.parentIndex,row:l.row,event:r,...d}}}getCellElementFromDomEvent({target:r,clientY:n,type:s}){const a=this,{isVertical:o,foregroundCanvas:l}=a,d=r.closest(a.eventSelector);if(d)return a.getCell({[o?"row":"record"]:o?0:a.resolveRowRecord(d),column:a.timeAxisColumn});if(l.contains(r)){if(r===l||s==="mousemove"){var c;return(c=a.rowManager.getRowAt(n,!1))===null||c===void 0?void 0:c.getCell(a.timeAxisColumn.id)}}else return r.matches(".b-grid-row")?r.firstElementChild:r.closest(a.timeCellSelector)}matchScheduleCell(r){return r.closest(this.timeCellSelector)}onElementMouseButtonEvent(r){const n=r.target.closest(".b-sch-header-timeaxis-cell");if(n){const s=this,a=n.parentElement.dataset.headerPosition,o=s.timeAxisViewModel.columnConfig[a],l=s.timeAxis.isFiltered?o.findIndex(u=>u.index==n.dataset.tickIndex):n.dataset.tickIndex,d=o[l],c=s.features.contextMenu;(!c||r.type!==c.triggerEvent)&&this.trigger(`timeAxisHeader${$.capitalize(r.type)}`,{startDate:d.start,endDate:d.end,event:r})}}onElementMouseDown(r){this.onElementMouseButtonEvent(r),super.onElementMouseDown(r)}onElementClick(r){this.onElementMouseButtonEvent(r),super.onElementClick(r)}onElementDblClick(r){this.onElementMouseButtonEvent(r),super.onElementDblClick(r)}onElementContextMenu(r){this.onElementMouseButtonEvent(r),super.onElementContextMenu(r)}onElementMouseOver(r){var n;super.onElementMouseOver(r);const s=this,{target:a}=r,{hoveredEvents:o}=s;if(a.closest(s.eventInnerSelector)&&!((n=s.features.eventDrag)!==null&&n!==void 0&&n.isDragging)){const l=a.closest(s.eventSelector);if(!o.has(l)&&!s.preventOverCls){o.add(l),l.classList.add(s.overScheduledEventClass);const d=s.getTimeSpanMouseEventParams(l,r);d&&s.trigger(`${s.scheduledEventName}MouseEnter`,d)}}else o.size&&s.unhoverAll(r)}onElementMouseOut(r){var n;super.onElementMouseOut(r);const s=this,{target:a,relatedTarget:o}=r,l=a.closest(s.eventInnerSelector),d=a.closest(s.eventSelector),c=s.resolveTimeSpanRecord(a);if(l&&c&&s.hoveredEvents.has(d)&&!((n=s.features.eventDrag)!==null&&n!==void 0&&n.isDragging)){if(o&&k.isDescendant(l,o))return;s.unhover(d,r)}}unhover(r,n){const s=this;r.classList.remove(s.overScheduledEventClass),s.trigger(`${s.scheduledEventName}MouseLeave`,s.getTimeSpanMouseEventParams(r,n)),s.hoveredEvents.delete(r)}unhoverAll(r){for(const n of this.hoveredEvents)!n.isReleased&&!n.classList.contains("b-released")&&this.unhover(n,r);this.hoveredEvents.clear()}get widgetClass(){}},w(i,"$name","TimelineDomEvents"),w(i,"configurable",{timelineContext:{$config:{equal(r,n){return(r==null?void 0:r.index)===(n==null?void 0:n.index)&&(r==null?void 0:r.tickParentIndex)===(n==null?void 0:n.tickParentIndex)&&!(((r==null?void 0:r.tickStartDate)||0)-((n==null?void 0:n.tickStartDate)||0))}}},updateTimelineContextOnScroll:!0}),w(i,"properties",{schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"},schedulerEnterLeaveEvents:{mouseenter:"handleScheduleEnterLeaveEvent",mouseleave:"handleScheduleEnterLeaveEvent",capture:!0}}),w(i,"delayable",{onScheduleScroll:"raf"}),i};const ue=(v=0,i=0)=>i-v;var et=v=>class extends(v||U){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const t={owner:this};let r=[];if(e===!0)r=ie.allRecords;else if(Array.isArray(e))for(const s of e)if(typeof s=="string"){const a=ie.getById(s);a&&r.push(a)}else r.push(s);else H.assign(t,e);const n=new me(t);return n.add(r),n}changeViewPreset(e,t){const r=this,{presets:n}=r;e?(e=n.createRecord(e),n.includes(e)||n.add(e)):e=n.first;const s=r.lastViewPresetOptions||{},a=e.options||(e.options={}),o=a.event={startDate:a.startDate,endDate:a.endDate,from:t,to:e,preset:e},l=!r._viewPreset||!r._viewPreset.equals(e),d=ue(a.startDate,s.startDate)||ue(a.endDate,s.endDate)||ue(a.centerDate,s.centerDate)||a.startDate&&ue(a.startDate,r.startDate)||a.endDate&&ue(a.endDate,r.endDate);if((l||d)&&(l||(r._viewPreset=null),r.isConfiguring||r.trigger("beforePresetChange",o)!==!1))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(e){this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return g.format(e,this.displayDateFormat)}updateViewPreset(e){const t=this,{options:r}=e,{event:n,startDate:s,endDate:a}=r,{isHorizontal:o,_timeAxis:l,_timeAxisViewModel:d}=t,c=o&&t.rtl;let{centerDate:u,zoomDate:h,zoomPosition:f}=r,p=!1;if(delete e.options,t._viewPresetChanging=!0,l&&!t.isConfiguring){const{timelineScroller:m}=t;if(t.lastViewPresetOptions=r,l.isConfigured){t.suspendRefresh();const D=H.copyProperties({},t,["weekStartDay","startTime","endTime"]);t.infiniteScroll?Object.assign(D,d.calculateInfiniteScrollingDateRange(u||new Date((s.getTime()+a.getTime())/2),!0,e)):s?(D.startDate=s,D.endDate=a,!u&&a&&(u=new Date((s.getTime()+a.getTime())/2))):(D.startDate=l.startDate,D.endDate=a||l.endDate,u||(u=t.viewportCenterDate)),l.isConfigured=!1,D.viewPreset=e,l.reconfigure(D,!0),d.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:e.columnLinesFor!=null?e.columnLinesFor:e.headers.length-1,tickSize:o?e.tickWidth:e.tickHeight||e.tickWidth||60}),t.resumeRefresh(!1)}if(t.refresh(),!r.notScroll&&t.isPainted)if(r.visibleDate)t.visibleDate=r.visibleDate;else if(h&&f){const D=ye[l.resolutionUnit],b=D>3?"hour":"minute",S=g.asMilliseconds(b==="minute"?15:1,b),C=new Date(Math.round(h/S)*S);n.zoomDate=h,n.zoomPosition=f,n.zoomLevel=r.zoomLevel,c?m.position=m.scrollWidth-(t.getCoordinateFromDate(C)+f):m.position=t.getCoordinateFromDate(C)-f}else if(u){t.cachedCenterDate=u,n.centerDate=u;const D=t.timelineScroller.clientSize,b=c?t.timeAxisViewModel.totalSize-t.getCoordinateFromDate(u,!0):t.getCoordinateFromDate(u,!0),S=Math.max(b-D/2,0);t.scrollingToCenter=!0,S===(t.isHorizontal?t.scrollLeft:t.scrollTop)?p=!0:t.isHorizontal?t.scrollHorizontallyTo(S,!1):t.scrollVerticallyTo(S,!1),t.setTimeout(()=>{t.scrollingToCenter=!1},100)}else(t.isHorizontal?t.scrollLeft:t.scrollTop)===0?p=!0:t.timelineScroller.scrollTo(0)}t.dataset.presetId=e.id,t.trigger("presetChange",n),t._viewPresetChanging=!1,p&&(t.isHorizontal?t.currentOrientation.updateFromHorizontalScroll(t.scrollLeft,t.scrollX):t.currentOrientation.updateFromVerticalScroll(t.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.viewPreset&&t.viewPreset.name&&!t.viewPreset.base&&delete t.viewPreset.name,t}get widgetClass(){}},tt=v=>{var i;return i=class extends(v||U){constructor(){super(...arguments);w(this,"lastWheelTime",-1);w(this,"lastZoomPosition",-1)}construct(r){const n=this;super.construct(r),n.zoomOnMouseWheel&&O.on({element:n.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:s=>s.ctrlKey&&s.preventDefault()},thisObj:n,capture:!0,passive:!1}),n.zoomOnTimeAxisDoubleClick&&n.ion({timeaxisheaderdblclick:({startDate:s,endDate:a})=>{n.forceFit||n.zoomToSpan({startDate:s,endDate:a})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(r){if(typeof r!="number"&&(r=this.presets.count-1),r<0||r>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=r}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(r){if(typeof r!="number"&&(r=0),r<0||r>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=r}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(r){this.zoomToLevel(r)}getMilliSecondsPerPixelForZoomLevel(r,n){const{bottomHeader:s}=r,a=this.isHorizontal?r.tickWidth:r.tickHeight;return Math.round((g.add(new Date(1,0,1),s.increment||1,s.unit)-new Date(1,0,1))/(n?a:r.actualWidth||a))}zoomTo(r){const n=this;typeof r=="object"?r.preset?n.zoomToLevel(r.preset,r):r.level!=null?n.zoomToLevel(r.level,r):n.zoomToSpan(r):n.zoomToLevel(r)}zoomToLevel(r,n={}){if(this.forceFit){console.warn("Warning: The forceFit setting and zooming cannot be combined");return}typeof r=="number"&&(r=Math.min(Math.max(r,this.minZoomLevel),this.maxZoomLevel));const s=this,{presets:a}=s,o=s.isVertical?"tickHeight":"tickWidth",l=a.createRecord(r),d=l[o],c=n.startDate?new Date(n.startDate):null,u=n.endDate?new Date(n.endDate):null;a.add(l);let h=c&&u?{startDate:c,endDate:u}:null;const f=n.centerDate?new Date(n.centerDate):h?new Date((c.getTime()+u.getTime())/2):s.viewportCenterDateCached;let p=s.isVertical?s.scrollable.clientHeight:s.timeAxisSubGrid.width;if(p===0){const{_beforeCollapseState:m}=s.timeAxisSubGrid;if(s.isHorizontal&&s.timeAxisSubGrid.collapsed&&m!==null&&m!==void 0&&m.width)p=m.width;else return null}return h||(h=s.calculateOptimalDateRange(f,p,l)),"width"in n&&l.setData(o,n.width),s.isZooming=!0,l.options={...n,startDate:h.startDate||s.startDate,endDate:h.endDate||s.endDate,centerDate:f},s.viewPreset=l,l.actualWidth=s.timeAxisViewModel.tickSize,s.isZooming=!1,l.setData(o,d),s.zoomLevel}zoomToFit(r){const n=this.eventStore,s=n.getTotalTimeSpan();r={leftMargin:0,rightMargin:0,...r,...s},r.startDate&&r.endDate&&(r.endDate>r.startDate?this.zoomToSpan(r):this.scrollToDate(r.startDate))}zoomToSpan(r={}){if((r.leftMargin||r.rightMargin)&&(r.adjustStart=0,r.adjustEnd=0),r.leftMargin||(r.leftMargin=0),r.rightMargin||(r.rightMargin=0),!r.startDate||!r.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const n=this,{timeAxis:s}=n,a=r.adjustStart>=0||r.adjustEnd>=0;let{startDate:o,endDate:l}=r;if(a&&(o=g.add(o,-r.adjustStart,s.mainUnit),l=g.add(l,r.adjustEnd,s.mainUnit)),o<=l){const{availableSpace:d}=n.timeAxisViewModel,c=n.presets.allRecords,u=l-o||1;let h=n.zoomLevel,f,p;h===-1&&(h=0);let m=n.getMilliSecondsPerPixelForZoomLevel(c[h],!0),D=h+(f=u/m+r.leftMargin+r.rightMargin>d?-1:1),b,S=null;for(;D>=0&&D<=c.length-1;){b=c[D],m=n.getMilliSecondsPerPixelForZoomLevel(b,!0);const z=u/m+r.leftMargin+r.rightMargin;if(f===-1){if(z<=d){S=D;break}}else if(z<=d)h!==D-f&&(S=D);else break;D+=f}S=S!=null?S:D-f,b=c[S];const C=b.bottomHeader.unit;m=n.getMilliSecondsPerPixelForZoomLevel(b,!0),(r.leftMargin||r.rightMargin)&&(o=new Date(o.getTime()-m*r.leftMargin),l=new Date(l.getTime()+m*r.rightMargin));const T=g.getDurationInUnit(o,l,C,!0)/b.bottomHeader.increment;if(T===0)return null;const y=Math.floor(d/T),x=r.centerDate||new Date((o.getTime()+l.getTime())/2);a?p={startDate:o,endDate:l}:p=n.calculateOptimalDateRange(x,d,b);let M=n.zoomLevel;return n.zoomLevel===S?s.reconfigure(p):M=n.zoomToLevel(S,Object.assign(p,{width:y,centerDate:x})),n.infiniteScroll&&n.scrollToDate(o,{block:"start"}),M}return null}zoomIn(r=1,n){typeof r=="object"&&(n=r,r=1);const s=this.zoomLevel;return s>=this.maxZoomLevel?null:this.zoomToLevel(s+r,n)}zoomOut(r=1,n){typeof r=="object"&&(n=r,r=1);const s=this.zoomLevel;return s<=this.minZoomLevel?null:this.zoomToLevel(s-r,n)}zoomInFull(r){return this.zoomToLevel(this.maxZoomLevel,r)}zoomOutFull(r){return this.zoomToLevel(this.minZoomLevel,r)}calculateOptimalDateRange(r,n,s,a){if(a)return a;const o=this,{timeAxis:l}=o,{bottomHeader:d}=s,c=o.isHorizontal?s.tickWidth:s.tickHeight;if(o.zoomKeepsOriginalTimespan)return{startDate:l.startDate,endDate:l.endDate};const u=d.unit,h=Math.ceil(n/c*d.increment*o.visibleZoomFactor/2),f=g.add(r,-h,u),p=g.add(r,h,u);return o.infiniteScroll?o.timeAxisViewModel.calculateInfiniteScrollingDateRange(r,!0):{startDate:l.floorDate(f,!1,u,d.increment),endDate:l.ceilDate(p,!1,u,d.increment)}}onElementMouseMove(r){const{isHorizontal:n,zoomContext:s}=this;super.onElementMouseMove(r),r.isTrusted&&s&&Math.abs(r[`client${n?"X":"Y"}`]-s.coordinate)>10&&(this.zoomContext=null)}async onWheel(r){if(r.ctrlKey&&!this.forceFit){r.preventDefault();const n=this,{zoomContext:s,isHorizontal:a,timelineScroller:o,zoomLevel:l}=n,d=performance.now(),c=r[`client${a?"X":"Y"}`];let u=c-o.viewport[`${a?"x":"y"}`];a&&n.rtl&&(u=o.viewport.width+o.viewport.x-c),d-n.lastWheelTime>200||!s||Math.abs(c-n.zoomContext.coordinate)>20?n.zoomContext={zoomLevel:l,coordinate:c,zoomPosition:u,zoomDate:n.getDateFromDomEvent(r)}:(l>s.zoomLevel&&(s.zoomDate=n.getDateFromDomEvent(r),s.zoomLevel=l),s.zoomPosition=u),n.lastWheelTime=d,n[`zoom${r.deltaY>0?"Out":"In"}`](void 0,n.zoomContext)}}setTimeSpan(r,n){this.timeAxis.setTimeSpan(r,n)}shift(r,n){this.timeAxis.shift(r,n)}shiftNext(r){this.timeAxis.shiftNext(r)}shiftPrevious(r){this.timeAxis.shiftPrevious(r)}get widgetClass(){}},w(i,"$name","TimelineZoomable"),w(i,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),i},it=v=>{var i;return i=class extends(v||U){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green",tickSize:null}}updateFillTicks(t){this.isConfiguring||(this.timeAxis.forceFullTicks=t&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(t){return H.assertNumber(t,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),t):t}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return this._resourceMargin==null?this.barMargin:this._resourceMargin}set resourceMargin(t){const r=this;H.assertNumber(t,"resourceMargin"),r.isHorizontal&&r.rowHeight&&(t=Math.min(Math.ceil(r.rowHeight/2),t)),r._resourceMargin!==t&&(r._resourceMargin=t,r.rendered&&(r.currentOrientation.onBeforeRowHeightChange(),r.refreshWithTransition()))}set tickSize(t){H.assertNumber(t,"tickSize"),this.timeAxisViewModel.tickSize=t}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}},w(i,"configurable",{barMargin:10,fillTicks:!1}),i};const ei={maintainVisibleStart:!0},ti={block:"nearest"};var rt=v=>class extends(v||U){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const e=this,{isHorizontal:t,visibleDate:r}=e;super.initScroll();const{scrollable:n}=t?e.timeAxisSubGrid:e;if(n.ion({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll){const s=r?{...r,visibleDate:r.date}:{visibleDate:e.viewportCenterDate,block:"center"},{startDate:a,endDate:o}=e.timeAxisViewModel.calculateInfiniteScrollingDateRange(s.visibleDate,s.block==="center");e.setTimeSpan(a,o,s)}}get timelineScroller(){const e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new ii({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}doDestroy(){var e;(e=this._timelineScroller)===null||e===void 0||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const t=this,r=t.timelineScroller,{clientSize:n}=r,s=n*t.bufferCoef,a=s*t.bufferThreshold,o=r.maxPosition,{style:l}=t.timeAxisSubGrid.virtualScrollerElement;(o-e<a||e<a)&&(l.overflow="hidden",l.pointerEvents="none",l.paddingBottom=`${k.scrollBarWidth}px`,t.setTimeout(()=>{l.overflow="",l.paddingBottom="",l.pointerEvents=""},100),t.shiftToDate(t.getDateFromCoordinate(e,null,!0,!1,!0)))}shiftToDate(e,t){const r=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(r.startDate,r.endDate,ei)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}async scrollToDate(e,t={}){const r=this,{timeAxis:n,visibleDateRange:s,infiniteScroll:a}=r,{unit:o,increment:l}=n,d=t.edgeOffset||0,c=g.ceil(s.endDate,l+" "+o)-g.floor(s.startDate,l+" "+o),u=e>r.viewportCenterDate?1:-1,h=(a?c*r.bufferCoef*r.bufferThreshold:t.block==="center"?c/2:d?r.getMilliSecondsPerPixelForZoomLevel(r.viewPreset)*d:0)*u,f=new Date(e.getTime()+h);(f>n.endDate?1:f<n.startDate?-1:0)&&r.infiniteScroll&&(r.shiftToDate(new Date(e-h),null,!0),await r.nextAnimationFrame());const m=r.timelineScroller.viewport,D=r.getCoordinateFromDate(e,!0),b=Math.min(r.timeAxisViewModel.tickSize,r.timeAxisViewModel.availableSpace),S=r.isHorizontal?new I(r.getCoordinateFromDate(e,!1)-(r.rtl?b:0),m.y,b,m.height):new I(m.x,r.getCoordinateFromDate(e,!1),m.width,r.timeAxisViewModel.tickSize);await r.scrollToCoordinate(D,S,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,r,n={}){const s=this;if(e<0){const a=s.endDate-s.startDate,{unit:o,increment:l}=s.timeAxis,d=g.floor(new Date(r.getTime()-a/2),l+" "+o),c=g.add(d,a);return d-s.startDate!==0&&c-s.endDate!==0?(s.setTimeSpan(d,c),s.scrollToDate(r,n)):void 0}return await s.timelineScroller.scrollIntoView(t,n),!s.isDestroyed&&s.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};class ii extends Et{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(i){super.onScroll(i),this._position=null}syncPartners(i){this.scrollable.syncPartners(i)}updatePosition(i){this.scrollable[this.isHorizontal?"x":"y"]=i}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable[`client${this.isHorizontal?"Width":"Height"}`]}get scrollSize(){return this.scrollable[`scroll${this.isHorizontal?"Width":"Height"}`]}get maxPosition(){return this.scrollable[`max${this.isHorizontal?"X":"Y"}`]}scrollTo(i,e){return this.isHorizontal?this.scrollable.scrollTo(i,null,e):this.scrollable.scrollTo(null,i,e)}scrollBy(i=0,e=0,t=ti){return this.isHorizontal?this.scrollable.scrollBy(i||e,0,t):this.scrollable.scrollBy(0,e||i,t)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(i){this.position=i}changeY(i){this.position=i}get x(){return this.position}set x(i){this.scrollable[this.isHorizontal?"x":"y"]=i}get y(){return this.position}set y(i){this.scroller[this.isHorizontal?"x":"y"]=i}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}const nt=["barMargin"];var st=v=>class extends(v||U){static get $name(){return"TimelineState"}getState(){const e=this,t=H.copyProperties(super.getState(),e,nt);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:void 0,width:e.tickSize},t}applyState(e){const t=this;if(t.suspendRefresh(),H.copyProperties(t,e,nt),super.applyState(e),e.zoomLevel!=null){if(t.infiniteScroll){var r;e!=null&&(r=e.scroll)!==null&&r!==void 0&&r.scrollLeft&&(e.scroll.scrollLeft={})}t.isPainted?t.zoomToLevel(e.zoomLevel,e.zoomLevelOptions):t._zoomAfterPaint={zoomLevel:e.zoomLevel,zoomLevelOptions:e.zoomLevelOptions}}t.resumeRefresh(!0)}onPaint(...e){if(super.onPaint(...e),this._zoomAfterPaint){const{zoomLevel:t,zoomLevelOptions:r}=this._zoomAfterPaint;this.zoomToLevel(t,r),delete this._zoomAfterPaint}}get widgetClass(){}};class at extends gt{static get $name(){return"SchedulerHeader"}refreshContent(){var i;(i=this.headersElement)!==null&&i!==void 0&&i.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}}at._$name="Header";class He extends ft{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:at}}startConfigure(i){const{grid:e}=i;e.timeAxisSubGrid=this,super.startConfigure(i),e.isHorizontal&&(i.header={cls:{"b-sticky-headers":e.stickyHeaders}},delete i.headerClass),"flex"in i||"width"in i||(i.flex=1)}changeScrollable(){const i=this,e=super.changeScrollable(...arguments);return e&&Object.defineProperty(e,"scrollWidth",{get(){var r;var t;return(r=(t=this.element)===null||t===void 0?void 0:t.scrollWidth)!=null?r:0},set(){i.grid.updateCanvasSize()}}),e}syncScrollingPartners(i=!0){this.grid._viewPresetChanging||super.syncScrollingPartners(i)}onInternalResize(i,e,t,r,n){const s=this;if(s.isPainted&&e!==r){const a=s.grid,o=a._bodyRectangle.height;k.scrollBarWidth&&e<r&&(s.monitorResize=!1),a.onSchedulerViewportResize(e,o,r,o),s.monitorResize||s.requestAnimationFrame(()=>s.monitorResize=!0)}super.onInternalResize(...arguments)}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(){const{owner:i}=this;await super.expand(),i.isPainted&&i.timeAxisViewModel.update(this.width,!1,!0)}}He.initClass(),He._$name="TimeAxisSubGrid";const ot={fn:"exitTransition",delay:0,cancelOutstanding:!0},Fe={};class ve extends pt.mixin(Je,Qe,it,rt,st,et,tt,Lt){constructor(){super(...arguments);w(this,"timeCellSelector",null)}static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit",viewportResizeTimeout:250,testConfig:{viewportResizeTimeout:50}}}updateTimeZone(e){this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e}get timeZone(){return this.project.timeZone}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:r}=t;(!r||r.startDate-e.startDate||r.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:r,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.ion({refresh:()=>{t.forceLayout=!1}})}createSubGrid(e,t={}){const r=this,{stickyHeaders:n}=r;return e===(r.schedulerRegion||"normal")?t.type="timeaxissubgrid":e==="locked"&&n&&r.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},r.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:r}=e;r==null||r.destroy(),t?(t.forEach(n=>{e.removePartner(n)}),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),xt.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return typeof e=="string"&&(e=g.parse(e)),e}onPaint({firstPaint:e}){if(e){const n=this,s=n.isHorizontal?n.timeAxisSubGrid.scrollable:n.scrollable,a=s.element.getBoundingClientRect()[n.isHorizontal?"width":"height"];if(n.timeAxisViewModel.update(a,n.infiniteScroll,!0),n.infiniteScroll){var t,r;(t=(r=n.currentOrientation).doUpdateTimeView)===null||t===void 0||t.call(r)}}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,t,r){this.currentOrientation.updateFromHorizontalScroll(r),super.onSchedulerHorizontalScroll(e,t,r)}initScroll(){const e=this;let t=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:r,scrollLeft:n,scrollX:s})=>{e.isPainted&&r===e.timeAxisSubGrid&&!e.isDestroying&&!e.refreshSuspended&&e.onSchedulerHorizontalScroll(r,n,s),t++}}),e.testPerformance==="horizontal"&&e.setTimeout(()=>{const r=performance.now();let n=5,s=1;const a=e.setInterval(()=>{if(n=n+5,e.scrollX+=(10+Math.floor(n))*s,s===1&&e.scrollX>5500&&(s=-1,n=5),s===-1&&e.scrollX<=0){const d=(performance.now()-r)/t,c=Math.round(1e3/d*10)/10;clearInterval(a),console.log(e.eventPositionMode,e.eventScrollMode,c+"fps")}},0)},500)}preserveViewCenter(e,t=this,...r){const n=this,s=n.viewportCenterDate,a=e.apply(t,r),o=n.timelineScroller,{clientSize:l}=o,d=Math.max(Math.floor(n.getCoordinateFromDate(s,!0)-l/2),0);return n.scrollingToCenter=!0,o.scrollTo(d,!1).then(()=>n.scrollingToCenter=!1),a}setTimeSpan(e,t,r=Fe){const n=this,{timeAxis:s}=n,{preventThrow:a=!1,maintainVisibleStart:o=!1,visibleDate:l}=r,{startDate:d,endDate:c}=s.getAdjustedDates(e,t),u=s.startDate-d!==0,h=s.endDate-c!==0;if(u||h){if(o){const{timeAxisViewModel:p}=n,{totalSize:m}=p,D=p.tickSize,b=n.timelineScroller,S=b.position,C=p.getDateFromPosition(S);C>=d&&C<c&&p.ion({update(){const T=p.tickSize!==D;n.updateCanvasSize(),u&&!h&&!T?b.position+=p.totalSize-m:!u&&!T?b.position=S:b.position=p.getPositionFromDate(C),b.syncPartners(!0)},prio:1e4,once:!0})}const f=s.reconfigure({startDate:d,endDate:c},!1,a);return l?n.scrollToDate(l,r).then(()=>f):f}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=$.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){(t.partneredWith||(t.partneredWith=new Ve)).add(e),(e.partneredWith||(e.partneredWith=new Ve)).add(t),t.getConfig("viewPreset"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:t});const n=t.partnerSharedConfigs.reduce((s,a)=>(s[a]=e[a],s),{});t.setConfig(n),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),t.isPainted?(t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=Mt.createSequence(t.initScroll,()=>{t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()},t)}}removePartner(e){const t=this,{partneredWith:r}=t;t.isPartneredWith(e)&&(r.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return!!(!((t=this.partneredWith)===null||t===void 0)&&t.includes(e))}onPartnerOverflowChange({source:e,y:t}){const{scrollable:r}=this,n=r.hasOverflow("y");n!==t?n?e.overflowY="scroll":(e.overflowY=!0,r.overflowY="scroll",this.refreshVirtualScrollbars()):r.overflowY=!0}onPartnerPresetChange({preset:e,startDate:t,endDate:r,centerDate:n,zoomDate:s,zoomPosition:a,zoomLevel:o}){!this._viewPresetChanging&&this.viewPreset!==e&&(e.options={startDate:t,endDate:r,centerDate:n,zoomDate:s,zoomPosition:a,zoomLevel:o},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}changeColumns(e,t){const r=this;let n,s;if(e){const a=Array.isArray(e);let o=e;a||(o=e.data),n=o&&o.length,o.some((l,d)=>l.type==="timeAxis"?(n=d,s=H.assign(l,r.timeAxisColumn),!0):!1),r.isVertical?(o=[H.assign({type:"verticalTimeAxis"},r.verticalTimeAxisColumn),o[n]],n=1):o=o.slice(),o[n]=this._timeAxisColumn||{type:"timeAxis",cellCls:r.timeCellCls,mode:r.mode,...s},a||e.isStore&&e.owner!==this?e=o:e.data=o}return super.changeColumns(e,t)}updateColumns(e,t){if(super.updateColumns(e,t),e){const r=this,n=r._timeAxisColumn=r.columns.find(s=>s.isTimeAxisColumn);r.isVertical&&(r.verticalTimeAxisColumn=r.columns.find(s=>s.isVerticalTimeAxisColumn),r.verticalTimeAxisColumn.relayAll(r)),n.relayAll(r)}}onColumnsChanged({action:e,changes:t,record:r,records:n}){var s;const{timeAxisColumn:a,columns:o}=this;(e==="dataset"||e==="batch")&&!o.includes(a)?o.add(a,!0):r===a&&"width"in t&&this.updateCanvasSize(),r&&((s=this.partneredWith)===null||s===void 0||s.forEach(l=>{const d=l.columns.getAt(r.allIndex);if(d!=null&&d.shouldSync(r)){const c={};for(const u in t)c[u]=t[u].value;d.set(c)}})),super.onColumnsChanged(...arguments)}get timeView(){var e,t;const r=this;return r.columns&&r.isVertical?(e=r.verticalTimeAxisColumn)===null||e===void 0?void 0:e.view:(t=r.timeAxisColumn)===null||t===void 0?void 0:t.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=`.${e}-wrap`),t.eventInnerSelector||(t.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){var t;const r=this,n=r._timeAxisViewModel,s={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:r};r.partner&&!e||n&&n===e||((n==null?void 0:n.owner)===r&&n.destroy(),r.detachListeners("timeAxisViewModel"),(t=e)!==null&&t!==void 0&&t.isTimeAxisViewModel?e.ion(s):e=Le.new({mode:r._mode,snap:r.snap,forceFit:r.forceFit,timeAxis:r.timeAxis,suppressFit:r.suppressFit,internalListeners:s,owner:r},e),r.isConfiguring||(r.isHorizontal?r.timeAxisColumn.timeAxisViewModel=e:r.verticalTimeAxisColumn.view.model=e),r._timeAxisViewModel=e,r.relayEvents(e,["update"],"timeAxisViewModel"),n&&e&&r.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var t;var e;return(t=(e=this._timeAxisViewModel)===null||e===void 0?void 0:e.suppressFit)!=null?t:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){var t;const r=this,n=r._timeAxis,s={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:r};r.partner&&!e||n&&n===e||(n&&n.owner===r&&n.destroy(),r.detachListeners("timeAxis"),(t=e)!==null&&t!==void 0&&t.isTimeAxis||(e=H.assign({owner:r,viewPreset:r.viewPreset,autoAdjust:r.autoAdjustTimeAxis,weekStartDay:r.weekStartDay,forceFullTicks:r.fillTicks&&r.snap},e),r.startDate&&(e.startDate=r.startDate),r.endDate&&(e.endDate=r.endDate),r.workingTime&&r.applyWorkingTime(e),e=new ke(e)),e.ion(s),r._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:t}){e&&(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}}),this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,r=t._workingTime;if(r){let s=null;r.fromHour>=0&&r.fromHour<24&&r.toHour>r.fromHour&&r.toHour<=24&&r.toHour-r.fromHour<24&&(s={from:r.fromHour,to:r.toHour});let a=null;r.fromDay>=0&&r.fromDay<7&&r.toDay>r.fromDay&&r.toDay<=7&&r.toDay-r.fromDay<7&&(a={from:r.fromDay,to:r.toDay}),s||a?e.include={hour:s,day:a}:e.include=null}else e.include=null;if(t.isPainted){var n;t.timeAxisColumn.refreshHeader(),(n=t.features.columnLines)===null||n===void 0||n.refresh(),t.refreshWithTransition()}}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const r=this,n=r._timeAxis,{startDate:s,endDate:a,mainUnit:o}=n||Fe;if(typeof e=="string"&&(e=g.parse(e)),n&&a){if(e){let l=a;if(t&&s){const d=g.diff(s,a,o,!0);l=g.add(e,d,o)}r.setTimeSpan(e,l)}}else r._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}changeEndDate(e){typeof e=="string"&&(e=g.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const r=this,n=r._timeAxis,{startDate:s,endDate:a,mainUnit:o}=n||Fe;if(typeof e=="string"&&(e=g.parse(e)),n&&s){if(e){let l=s;if(t&&a){const d=g.diff(s,a,o,!0);l=g.add(e,-d,o)}r.setTimeSpan(l,e)}}else r._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||g.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){if(e instanceof Date)return{date:e,block:"nearest"};if(e instanceof Object)return{date:e.date,...e}}updateVisibleDate(e){const t=this;t.infiniteScroll&&t.isConfiguring||(t.isPainted?t.scrollToDate(e.date,e):t.ion({paint:()=>t.scrollToDate(e.date,e),once:!0}))}get features(){return super.features}set features(e){e=e===!0?{}:e,"regionResize"in e||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){this._eventStyle=e,this.refreshWithTransition(),this.trigger("stateChange")}get eventColor(){return this._eventColor}set eventColor(e){this._eventColor=e,this.refreshWithTransition(),this.trigger("stateChange")}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:r,height:n}){this.isVertical&&t&&r!==t.width&&delete this.timeAxisSubGrid._width;const s=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&n!==t.height&&this.onSchedulerViewportResize(s,n,s,t.height)}onSchedulerViewportResize(e,t,r,n){if(this.isPainted){const s=this,{isHorizontal:a,partneredWith:o}=s;s.currentOrientation.onViewportResize(e,t,r,n),s.updateViewModelAvailableSpace(a?e:Math.floor(t)),o&&!s.isSyncingFromPartner&&s.syncPartnerSubGrids(),s.trigger("timelineViewportResize",{width:e,height:t,oldWidth:r,oldHeight:n})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){!this._viewPresetChanging&&!this.timeAxisSubGrid.collapsed&&(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid(t=>{const r=e.subGrids[t.region];r.width!==t.width&&(t.collapsed?r.collapse():(r.collapsed&&r.expand(),t.flex?t.flex!==r.flex&&(r.flex=t.flex):r.width=t.width))}),e.isSyncingFromPartner=!1)})}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",$e.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){if(!this._timeAxisSubGridElement){var e;this.getConfig("regions"),this._timeAxisSubGridElement=(e=this.timeAxisColumn)===null||e===void 0?void 0:e.subGridElement}return this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:t}=e.timeAxisViewModel,r=e.isHorizontal?t:e.timeAxisColumn.width;let n=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(t+e._rowBorderHeight,!0),e.suppressFit&&k.setLength(e.foregroundCanvas,"height",t),n=!0),r!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&k.setLength(e.backgroundCanvas,"width",r),k.setLength(e.foregroundCanvas,"width",r),e.$canvasWidth=r,n=!0),n}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;t.isVisible?(e==="dataset"&&t.project.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.isVertical||t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=k.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const r=e._foregroundCanvas=k.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-e.resourceMargin*2}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=r,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){const r=this;r.isConfiguring||(r.currentOrientation.refreshRows(t),super.refreshRows(e))}getCellDataFromEvent(e,t){return t&&(t=!e.target.closest(".b-sch-foreground-canvas")),super.getCellDataFromEvent(e,t)}onCellNavigate(e,t,r){var n,s;(n=r.cell)!==null&&n!==void 0&&n.classList.contains("b-timeaxis-cell")&&!((s=xe.currentMouseDown)!==null&&s!==void 0&&s.target.classList.contains("b-grid-cell"))&&(this.preventDragSelect=!0),super.onCellNavigate(...arguments)}runWithTransition(e,t){const r=this;r.isVisible&&((t==null||t===!0)&&(t=r.transitionDuration),t&&r.enableEventAnimations&&(r.hasTimeout("exitTransition")||(r.isAnimating=!0),ot.delay=t,r.setTimeout(ot))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){this.isEngineReady||await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){const r=this;!r.refreshSuspended&&r.isPainted&&(r.rowManager.topRow?r.runWithTransition(()=>r.refresh(e),t):r.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some(t=>{var r;return t.column?t.column.isTimeAxisColumn:(r=t.cell)===null||r===void 0?void 0:r.closest(".b-timeaxis-cell")})}formatDuration(e,t=this.durationDisplayPrecision){const r=Math.pow(10,t);return Math.round(e*r)/r}beginListeningForBatchedUpdates(){this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1}endListeningForBatchedUpdates(){this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1)}onConnectedCallback(e,t){e&&!t&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(e){const t=this,{isConfiguring:r}=t;let n;r||(n=t.visibleDateRange),super.updateRtl(e),r||(t.currentOrientation.clearAll(),t.infiniteScroll?(t.shiftToDate(n.startDate),t.scrollToDate(n.startDate,{block:"start"})):t.timelineScroller.position+=.5)}applyStartEndParameters(e){const t=this,r=t.eventStore.modelClass.fieldMap.startDate;t.passStartEndParameters&&(e[t.startParamName]=r.print(t.startDate),e[t.endParamName]=r.print(t.endDate))}}w(ve,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null}),ve.initClass(),ne.setVersion("scheduler","5.3.7"),ve._$name="TimelineBase";export{le as AbstractTimeRanges,Ht as Base,De as CalendarCacheIntervalMultiple,je as CalendarCacheMultiple,Ae as ColumnLines,K as Dependencies,Ge as DependencyCreation,Xe as DependencyTooltip,Ue as DragBase,ge as DragCreateBase,Re as DurationColumn,de as EventFilter,oe as EventResize,ee as HorizontalTimeAxis,re as NonWorkingTime,qe as NonWorkingTimeMixin,me as PresetStore,J as RectangularPathFinder,te as ResourceHeader,ce as ScheduleTooltip,ke as TimeAxis,ae as TimeAxisBase,he as TimeAxisColumn,pe as TimeAxisHeaderMenu,He as TimeAxisSubGrid,Le as TimeAxisViewModel,ve as TimelineBase,Je as TimelineDateMapper,Qe as TimelineDomEvents,it as TimelineEventRendering,rt as TimelineScroll,st as TimelineState,et as TimelineViewPresets,tt as TimelineZoomable,Ne as TooltipBase,Y as ViewPreset,Pt as combineCalendars,ie as pm};
//# sourceMappingURL=TimelineBase.js.map
