/*!
 *
 * Bryntum Scheduler Pro 5.3.7
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var Bn=Object.defineProperty;var Vn=(a,n,e)=>n in a?Bn(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var F=(a,n,e)=>(Vn(a,typeof n!="symbol"?n+"":n,e),e);import{DateHelper as x,TimeZoneHelper as z,Store as N,Model as _,ObjectHelper as $,Events as Rt,Delayable as Ke,Base as B,ArrayHelper as V,StringHelper as G,Objects as re,AjaxHelper as Yn,LoadMaskable as Un,Mask as qn,AjaxStore as ue,VersionHelper as ce,FunctionHelper as Et,DayTime as Ze,DomClassList as xt,Duration as de,BrowserHelper as Wn}from"./Editor.js";import{StateTrackingManager as zn}from"./AvatarRendering.js";import{GridRowModel as Hn}from"./GridRowModel.js";const It=(a,n)=>new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()+n,a.getMilliseconds()),L=function(){var a={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(n){if(this==null)throw new TypeError;var e=Object(this),r=e.length>>>0;if(r===0)return-1;var s=0;if(arguments.length>1&&(s=Number(arguments[1]),s!=s?s=0:s!=0&&s!=1/0&&s!=-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=r)return-1;for(var t=s>=0?s:Math.max(r-Math.abs(s),0);t<r;t++)if(t in e&&e[t]===n)return t;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a.array={},a.array.sort=function(n,e){n.sort(function(r,s){return+r-+s}),e&&n[0]===0&&n.push(n.shift())},a.array.next=function(n,e,r){for(var s,t=r[0]!==0,i=0,o=e.length-1;o>-1;--o){if(s=e[o],s===n)return s;if(s>n||s===0&&t&&r[1]>n){i=o;continue}break}return e[i]},a.array.nextInvalid=function(n,e,r){for(var s=r[0],t=r[1],i=e.length,o=e[i-1]===0&&s!==0?t:0,l=n,u=e.indexOf(n),c=l;l===(e[u]||o);)if(l++,l>t&&(l=s),u++,u===i&&(u=0),l===c)return;return l},a.array.prev=function(n,e,r){for(var s,t=e.length,i=r[0]!==0,o=t-1,l=0;l<t;l++){if(s=e[l],s===n)return s;if(s<n||s===0&&i&&r[1]<n){o=l;continue}break}return e[o]},a.array.prevInvalid=function(n,e,r){for(var s=r[0],t=r[1],i=e.length,o=e[i-1]===0&&s!==0?t:0,l=n,u=e.indexOf(n),c=l;l===(e[u]||o);)if(l--,l<s&&(l=t),u--,u===-1&&(u=i-1),l===c)return;return l},a.day=a.D={name:"day",range:86400,val:function(n){return n.D||(n.D=a.date.getDate.call(n))},isValid:function(n,e){return a.D.val(n)===(e||a.D.extent(n)[1])},extent:function(n){if(n.DExtent)return n.DExtent;var e=a.M.val(n),r=a.DAYS_IN_MONTH[e-1];return e===2&&a.dy.extent(n)[1]===366&&(r=r+1),n.DExtent=[1,r]},start:function(n){return n.DStart||(n.DStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)))},end:function(n){return n.DEnd||(n.DEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)))},next:function(n,e){e=e>a.D.extent(n)[1]?1:e;var r=a.date.nextRollover(n,e,a.D,a.M),s=a.D.extent(r)[1];return e=e>s?1:e||s,a.date.next(a.Y.val(r),a.M.val(r),e)},prev:function(n,e){var r=a.date.prevRollover(n,e,a.D,a.M),s=a.D.extent(r)[1];return a.date.prev(a.Y.val(r),a.M.val(r),e>s?s:e||s)}},a.dayOfWeekCount=a.dc={name:"day of week count",range:604800,val:function(n){return n.dc||(n.dc=Math.floor((a.D.val(n)-1)/7)+1)},isValid:function(n,e){return a.dc.val(n)===e||e===0&&a.D.val(n)>a.D.extent(n)[1]-7},extent:function(n){return n.dcExtent||(n.dcExtent=[1,Math.ceil(a.D.extent(n)[1]/7)])},start:function(n){return n.dcStart||(n.dcStart=a.date.next(a.Y.val(n),a.M.val(n),Math.max(1,(a.dc.val(n)-1)*7+1||1)))},end:function(n){return n.dcEnd||(n.dcEnd=a.date.prev(a.Y.val(n),a.M.val(n),Math.min(a.dc.val(n)*7,a.D.extent(n)[1])))},next:function(n,e){e=e>a.dc.extent(n)[1]?1:e;var r=a.date.nextRollover(n,e,a.dc,a.M),s=a.dc.extent(r)[1];e=e>s?1:e;var t=a.date.next(a.Y.val(r),a.M.val(r),e===0?a.D.extent(r)[1]-6:1+7*(e-1));return t.getTime()<=n.getTime()?(r=a.M.next(n,a.M.val(n)+1),a.date.next(a.Y.val(r),a.M.val(r),e===0?a.D.extent(r)[1]-6:1+7*(e-1))):t},prev:function(n,e){var r=a.date.prevRollover(n,e,a.dc,a.M),s=a.dc.extent(r)[1];return e=e>s?s:e||s,a.dc.end(a.date.prev(a.Y.val(r),a.M.val(r),1+7*(e-1)))}},a.dayOfWeek=a.dw=a.d={name:"day of week",range:86400,val:function(n){return n.dw||(n.dw=a.date.getDay.call(n)+1)},isValid:function(n,e){return a.dw.val(n)===(e||7)},extent:function(){return[1,7]},start:function(n){return a.D.start(n)},end:function(n){return a.D.end(n)},next:function(n,e){return e=e>7?1:e||7,a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(e-a.dw.val(n))+(e<=a.dw.val(n)?7:0))},prev:function(n,e){return e=e>7?7:e||7,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)+(e-a.dw.val(n))+(e>=a.dw.val(n)?-7:0))}},a.dayOfYear=a.dy={name:"day of year",range:86400,val:function(n){return n.dy||(n.dy=Math.ceil(1+(a.D.start(n).getTime()-a.Y.start(n).getTime())/a.DAY))},isValid:function(n,e){return a.dy.val(n)===(e||a.dy.extent(n)[1])},extent:function(n){var e=a.Y.val(n);return n.dyExtent||(n.dyExtent=[1,e%4?365:366])},start:function(n){return a.D.start(n)},end:function(n){return a.D.end(n)},next:function(n,e){e=e>a.dy.extent(n)[1]?1:e;var r=a.date.nextRollover(n,e,a.dy,a.Y),s=a.dy.extent(r)[1];return e=e>s?1:e||s,a.date.next(a.Y.val(r),a.M.val(r),e)},prev:function(n,e){var r=a.date.prevRollover(n,e,a.dy,a.Y),s=a.dy.extent(r)[1];return e=e>s?s:e||s,a.date.prev(a.Y.val(r),a.M.val(r),e)}},a.hour=a.h={name:"hour",range:3600,val:function(n){return n.h||(n.h=a.date.getHour.call(n))},isValid:function(n,e){return a.h.val(n)===e},extent:function(){return[0,23]},start:function(n){return n.hStart||(n.hStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n)))},end:function(n){return n.hEnd||(n.hEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n)))},next:function(n,e){e=e>23?0:e;var r=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(e<=a.h.val(n)?1:0),e);return!a.date.isUTC&&r.getTime()<=n.getTime()&&(r=a.date.next(a.Y.val(r),a.M.val(r),a.D.val(r),e+1)),r},prev:function(n,e){return e=e>23?23:e,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)+(e>=a.h.val(n)?-1:0),e)}},a.minute=a.m={name:"minute",range:60,val:function(n){return n.m||(n.m=a.date.getMin.call(n))},isValid:function(n,e){return a.m.val(n)===e},extent:function(n){return[0,59]},start:function(n){return n.mStart||(n.mStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n),a.m.val(n)))},end:function(n){return n.mEnd||(n.mEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n),a.m.val(n)))},next:function(n,e){var r=a.m.val(n),s=a.s.val(n),t=e>59?60-r:e<=r?60-r+e:e-r,i=new Date(n.getTime()+t*a.MIN-s*a.SEC);return!a.date.isUTC&&i.getTime()<=n.getTime()&&(i=new Date(n.getTime()+(t+120)*a.MIN-s*a.SEC)),i},prev:function(n,e){return e=e>59?59:e,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n)+(e>=a.m.val(n)?-1:0),e)}},a.month=a.M={name:"month",range:2629740,val:function(n){return n.M||(n.M=a.date.getMonth.call(n)+1)},isValid:function(n,e){return a.M.val(n)===(e||12)},extent:function(){return[1,12]},start:function(n){return n.MStart||(n.MStart=a.date.next(a.Y.val(n),a.M.val(n)))},end:function(n){return n.MEnd||(n.MEnd=a.date.prev(a.Y.val(n),a.M.val(n)))},next:function(n,e){return e=e>12?1:e||12,a.date.next(a.Y.val(n)+(e>a.M.val(n)?0:1),e)},prev:function(n,e){return e=e>12?12:e||12,a.date.prev(a.Y.val(n)-(e>=a.M.val(n)?1:0),e)}},a.second=a.s={name:"second",range:1,val:function(n){return n.s||(n.s=a.date.getSec.call(n))},isValid:function(n,e){return a.s.val(n)===e},extent:function(){return[0,59]},start:function(n){return n},end:function(n){return n},next:function(n,e){var r=a.s.val(n),s=e>59?60-r:e<=r?60-r+e:e-r,t=new Date(n.getTime()+s*a.SEC);return!a.date.isUTC&&t.getTime()<=n.getTime()&&(t=new Date(n.getTime()+(s+7200)*a.SEC)),t},prev:function(n,e,r){return e=e>59?59:e,a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n),a.h.val(n),a.m.val(n)+(e>=a.s.val(n)?-1:0),e)}},a.time=a.t={name:"time",range:1,val:function(n){return n.t||(n.t=a.h.val(n)*3600+a.m.val(n)*60+a.s.val(n))},isValid:function(n,e){return a.t.val(n)===e},extent:function(){return[0,86399]},start:function(n){return n},end:function(n){return n},next:function(n,e){e=e>86399?0:e;var r=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(e<=a.t.val(n)?1:0),0,0,e);return!a.date.isUTC&&r.getTime()<n.getTime()&&(r=a.date.next(a.Y.val(r),a.M.val(r),a.D.val(r),a.h.val(r),a.m.val(r),e+7200)),r},prev:function(n,e){return e=e>86399?86399:e,a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)+(e>=a.t.val(n)?-1:0),0,0,e)}},a.weekOfMonth=a.wm={name:"week of month",range:604800,val:function(n){return n.wm||(n.wm=(a.D.val(n)+(a.dw.val(a.M.start(n))-1)+(7-a.dw.val(n)))/7)},isValid:function(n,e){return a.wm.val(n)===(e||a.wm.extent(n)[1])},extent:function(n){return n.wmExtent||(n.wmExtent=[1,(a.D.extent(n)[1]+(a.dw.val(a.M.start(n))-1)+(7-a.dw.val(a.M.end(n))))/7])},start:function(n){return n.wmStart||(n.wmStart=a.date.next(a.Y.val(n),a.M.val(n),Math.max(a.D.val(n)-a.dw.val(n)+1,1)))},end:function(n){return n.wmEnd||(n.wmEnd=a.date.prev(a.Y.val(n),a.M.val(n),Math.min(a.D.val(n)+(7-a.dw.val(n)),a.D.extent(n)[1])))},next:function(n,e){e=e>a.wm.extent(n)[1]?1:e;var r=a.date.nextRollover(n,e,a.wm,a.M),s=a.wm.extent(r)[1];return e=e>s?1:e||s,a.date.next(a.Y.val(r),a.M.val(r),Math.max(1,(e-1)*7-(a.dw.val(r)-2)))},prev:function(n,e){var r=a.date.prevRollover(n,e,a.wm,a.M),s=a.wm.extent(r)[1];return e=e>s?s:e||s,a.wm.end(a.date.next(a.Y.val(r),a.M.val(r),Math.max(1,(e-1)*7-(a.dw.val(r)-2))))}},a.weekOfYear=a.wy={name:"week of year (ISO)",range:604800,val:function(n){if(n.wy)return n.wy;var e=a.dw.next(a.wy.start(n),5),r=a.dw.next(a.Y.prev(e,a.Y.val(e)-1),5);return n.wy=1+Math.ceil((e.getTime()-r.getTime())/a.WEEK)},isValid:function(n,e){return a.wy.val(n)===(e||a.wy.extent(n)[1])},extent:function(n){if(n.wyExtent)return n.wyExtent;var e=a.dw.next(a.wy.start(n),5),r=a.dw.val(a.Y.start(e)),s=a.dw.val(a.Y.end(e));return n.wyExtent=[1,r===5||s===5?53:52]},start:function(n){return n.wyStart||(n.wyStart=a.date.next(a.Y.val(n),a.M.val(n),a.D.val(n)-(a.dw.val(n)>1?a.dw.val(n)-2:6)))},end:function(n){return n.wyEnd||(n.wyEnd=a.date.prev(a.Y.val(n),a.M.val(n),a.D.val(n)+(a.dw.val(n)>1?8-a.dw.val(n):0)))},next:function(n,e){e=e>a.wy.extent(n)[1]?1:e;var r=a.dw.next(a.wy.start(n),5),s=a.date.nextRollover(r,e,a.wy,a.Y);a.wy.val(s)!==1&&(s=a.dw.next(s,2));var t=a.wy.extent(s)[1],i=a.wy.start(s);return e=e>t?1:e||t,a.date.next(a.Y.val(i),a.M.val(i),a.D.val(i)+7*(e-1))},prev:function(n,e){var r=a.dw.next(a.wy.start(n),5),s=a.date.prevRollover(r,e,a.wy,a.Y);a.wy.val(s)!==1&&(s=a.dw.next(s,2));var t=a.wy.extent(s)[1],i=a.wy.end(s);return e=e>t?t:e||t,a.wy.end(a.date.next(a.Y.val(i),a.M.val(i),a.D.val(i)+7*(e-1)))}},a.year=a.Y={name:"year",range:31556900,val:function(n){return n.Y||(n.Y=a.date.getYear.call(n))},isValid:function(n,e){return a.Y.val(n)===e},extent:function(){return[1970,2099]},start:function(n){return n.YStart||(n.YStart=a.date.next(a.Y.val(n)))},end:function(n){return n.YEnd||(n.YEnd=a.date.prev(a.Y.val(n)))},next:function(n,e){return e>a.Y.val(n)&&e<=a.Y.extent()[1]?a.date.next(e):a.NEVER},prev:function(n,e){return e<a.Y.val(n)&&e>=a.Y.extent()[0]?a.date.prev(e):a.NEVER}},a.fullDate=a.fd={name:"full date",range:1,val:function(n){return n.fd||(n.fd=n.getTime())},isValid:function(n,e){return a.fd.val(n)===e},extent:function(){return[0,3250368e7]},start:function(n){return n},end:function(n){return n},next:function(n,e){return a.fd.val(n)<e?new Date(e):a.NEVER},prev:function(n,e){return a.fd.val(n)>e?new Date(e):a.NEVER}},a.modifier={},a.modifier.after=a.modifier.a=function(n,e){var r=e[0];return{name:"after "+n.name,range:(n.extent(new Date)[1]-r)*n.range,val:n.val,isValid:function(s,t){return this.val(s)>=r},extent:n.extent,start:n.start,end:n.end,next:function(s,t){return t!=r&&(t=n.extent(s)[0]),n.next(s,t)},prev:function(s,t){return t=t===r?n.extent(s)[1]:r-1,n.prev(s,t)}}},a.modifier.before=a.modifier.b=function(n,e){var r=e[e.length-1];return{name:"before "+n.name,range:n.range*(r-1),val:n.val,isValid:function(s,t){return this.val(s)<r},extent:n.extent,start:n.start,end:n.end,next:function(s,t){return t=t===r?n.extent(s)[0]:r,n.next(s,t)},prev:function(s,t){return t=t===r?r-1:n.extent(s)[1],n.prev(s,t)}}},a.compile=function(n){var e=[],r=0,s;for(var t in n){var i=t.split("_"),o=i[0],l=i[1],u=n[t],c=l?a.modifier[l](a[o],u):a[o];e.push({constraint:c,vals:u}),r++}e.sort(function(f,p){var m=f.constraint.range,D=p.constraint.range;return D<m?-1:D>m?1:0}),s=e[r-1].constraint;function d(f){return f==="next"?function(p,m){return p.getTime()>m.getTime()}:function(p,m){return m.getTime()>p.getTime()}}return{start:function(f,p){for(var m=p,D=a.array[f],R=1e3,I;R--&&!I&&m;){I=!0;for(var S=0;S<r;S++){var C=e[S].constraint,M=C.val(m),h=C.extent(m),g=D(M,e[S].vals,h);if(!C.isValid(m,g)){m=C[f](m,g),I=!1;break}}}return m!==a.NEVER&&(m=f==="next"?s.start(m):s.end(m)),m},end:function(f,p){for(var m,D=a.array[f+"Invalid"],R=d(f),I=r-1;I>=0;I--){var S=e[I].constraint,C=S.val(p),M=S.extent(p),h=D(C,e[I].vals,M),g;h!==void 0&&(g=S[f](p,h),g&&(!m||R(m,g))&&(m=g))}return m},tick:function(f,p){return new Date(f==="next"?s.end(p).getTime()+a.SEC:s.start(p).getTime()-a.SEC)},tickSafe:function(f,p){return f==="next"?It(s.end(p),1):It(s.start(p),-1)},tickStart:function(f){return s.start(f)}}},a.schedule=function(n){if(!n)throw new Error("Missing schedule definition.");if(!n.schedules)throw new Error("Definition must include at least one schedule.");for(var e=[],r=n.schedules.length,s=[],t=n.exceptions?n.exceptions.length:0,i=0;i<r;i++)e.push(a.compile(n.schedules[i]));for(var o=0;o<t;o++)s.push(a.compile(n.exceptions[o]));function l(h,g,v,y,E){var T=C(h),b=g,w=1e6,A=[],j=[],O,k,W=[],le=h==="next",J,Ln=le?0:1,ze=le?1:0;if(v=v?new Date(v):new Date,!v||!v.getTime())throw new Error("Invalid start date.");for(c(h,e,A,v),f(h,s,j,v);w--&&b&&(O=M(A,T))&&!(y&&T(O,y));){if(t&&(p(h,s,j,O),k=R(h,j,O))){d(h,e,A,k);continue}if(E){var Nn=I(j,T);k=S(h,e,A,O,Nn);var He=le?[new Date(Math.max(v,O)),k?new Date(y?Math.min(k,y):k):void 0]:[k?new Date(y?Math.max(y,k.getTime()+a.SEC):k.getTime()+a.SEC):void 0,new Date(Math.min(v,O.getTime()+a.SEC))];if(J&&He[Ln].getTime()===J[ze].getTime()?(J[ze]=He[ze],b++):(J=He,W.push(J)),!k)break;d(h,e,A,k)}else W.push(le?new Date(Math.max(v,O)):D(e,A,O,y)),m(h,e,A,O);b--}for(var Ie=0,_n=W.length;Ie<_n;Ie++){var Me=W[Ie];W[Ie]=Object.prototype.toString.call(Me)==="[object Array]"?[u(Me[0]),u(Me[1])]:u(Me)}return W.length===0?a.NEVER:g===1?W[0]:W}function u(h){if(h instanceof Date&&!isNaN(h.valueOf()))return new Date(h)}function c(h,g,v,y){for(var E=0,T=g.length;E<T;E++)v[E]=g[E].start(h,y)}function d(h,g,v,y){for(var E=C(h),T=0,b=g.length;T<b;T++)v[T]&&!E(v[T],y)&&(v[T]=g[T].start(h,y))}function f(h,g,v,y){for(var E=0,T=g.length;E<T;E++){var b=g[E].start(h,y);b?v[E]=[b,g[E].end(h,b)]:v[E]=a.NEVER}}function p(h,g,v,y){for(var E=C(h),T=0,b=g.length;T<b;T++)if(v[T]&&!E(v[T][0],y)){var w=g[T].start(h,y);w?v[T]=[w,g[T].end(h,w)]:v[T]=a.NEVER}}function m(h,g,v,y){for(var E=0,T=g.length;E<T;E++)if(v[E]&&v[E].getTime()===y.getTime()){const b=g[E].start(h,g[E].tick(h,y));b!==a.NEVER&&b.getTime()===v[E].getTime()?v[E]=g[E].start(h,g[E].tickSafe(h,y)):v[E]=b}}function D(h,g,v,y){for(var E,T=0,b=g.length;T<b;T++)if(g[T]&&g[T].getTime()===v.getTime()){var w=h[T].tickStart(v);if(y&&w<y)return y;(!E||w>E)&&(E=w)}return E}function R(h,g,v){for(var y=C(h),E,T=0,b=g.length;T<b;T++){var w=g[T];w&&!y(w[0],v)&&(!w[1]||y(w[1],v))&&(!E||y(w[1],E))&&(E=w[1])}return E}function I(h,g){for(var v,y=0,E=h.length;y<E;y++)h[y]&&(!v||g(v,h[y][0]))&&(v=h[y][0]);return v}function S(h,g,v,y,E){for(var T=C(h),b,w=0,A=g.length;w<A;w++){var j=v[w];if(j&&j.getTime()===y.getTime()){var O=g[w].end(h,j);if(E&&(!O||T(O,E)))return E;(!b||T(O,b))&&(b=O)}}return b}function C(h){return h==="next"?function(g,v){return!v||g.getTime()>v.getTime()}:function(g,v){return!g||v.getTime()>g.getTime()}}function M(h,g){for(var v=h[0],y=1,E=h.length;y<E;y++)h[y]&&g(v,h[y])&&(v=h[y]);return v}return{isValid:function(h){return l("next",1,h,h)!==a.NEVER},next:function(h,g,v){return l("next",h||1,g,v)},prev:function(h,g,v){return l("prev",h||1,g,v)},nextRange:function(h,g,v){return l("next",h||1,g,v,!0)},prevRange:function(h,g,v){return l("prev",h||1,g,v,!0)}}},a.setTimeout=function(n,e){var r=a.schedule(e),s;n&&t();function t(){var i=Date.now(),o=r.next(2,i);if(!o[0]){s=void 0;return}var l=o[0].getTime()-i;l<1e3&&(l=o[1]?o[1].getTime()-i:1e3),l<2147483647?s=setTimeout(n,l):s=setTimeout(t,2147483647)}return{isDone:function(){return!s},clear:function(){clearTimeout(s)}}},a.setInterval=function(n,e){if(!n)return;var r=a.setTimeout(t,e),s=r.isDone();function t(){s||(n(),r=a.setTimeout(t,e))}return{isDone:function(){return r.isDone()},clear:function(){s=!0,r.clear()}}},a.date={},a.date.timezone=function(n){a.date.build=n?function(s,t,i,o,l,u){return new Date(s,t,i,o,l,u)}:function(s,t,i,o,l,u){return new Date(Date.UTC(s,t,i,o,l,u))};var e=n?"get":"getUTC",r=Date.prototype;a.date.getYear=r[e+"FullYear"],a.date.getMonth=r[e+"Month"],a.date.getDate=r[e+"Date"],a.date.getDay=r[e+"Day"],a.date.getHour=r[e+"Hours"],a.date.getMin=r[e+"Minutes"],a.date.getSec=r[e+"Seconds"],a.date.isUTC=!n},a.date.UTC=function(){a.date.timezone(!1)},a.date.localTime=function(){a.date.timezone(!0)},a.date.UTC(),a.SEC=1e3,a.MIN=a.SEC*60,a.HOUR=a.MIN*60,a.DAY=a.HOUR*24,a.WEEK=a.DAY*7,a.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],a.NEVER=0,a.date.next=function(n,e,r,s,t,i){return a.date.build(n,e!==void 0?e-1:0,r!==void 0?r:1,s||0,t||0,i||0)},a.date.nextRollover=function(n,e,r,s){var t=r.val(n),i=r.extent(n)[1];return(e||i)<=t||e>i?new Date(s.end(n).getTime()+a.SEC):s.start(n)},a.date.prev=function(n,e,r,s,t,i){var o=arguments.length;return e=o<2?11:e-1,r=o<3?a.D.extent(a.date.next(n,e+1))[1]:r,s=o<4?23:s,t=o<5?59:t,i=o<6?59:i,a.date.build(n,e,r,s,t,i)},a.date.prevRollover=function(n,e,r,s){var t=r.val(n);return e>=t||!e?s.start(s.prev(n,s.val(n)-1)):s.start(n)},a.parse={},a.parse.cron=function(n,e){var r={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},s={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},t={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function i(S,C,M){return isNaN(S)?r[S]||null:Math.min(+S+(C||0),M||9999)}function o(S){var C={},M;for(M in S)M!=="dc"&&M!=="d"&&(C[M]=S[M].slice(0));return C}function l(S,C,M,h,g){var v=M;for(S[C]||(S[C]=[]);v<=h;)S[C].indexOf(v)<0&&S[C].push(v),v+=g||1;S[C].sort(function(y,E){return y-E})}function u(S,C,M,h){(C.d&&!C.dc||C.dc&&C.dc.indexOf(h)<0)&&(S.push(o(C)),C=S[S.length-1]),l(C,"d",M,M),l(C,"dc",h,h)}function c(S,C,M){var h={},g={};M===1?(l(C,"D",1,3),l(C,"d",r.MON,r.FRI),l(h,"D",2,2),l(h,"d",r.TUE,r.FRI),l(g,"D",3,3),l(g,"d",r.TUE,r.FRI)):(l(C,"D",M-1,M+1),l(C,"d",r.MON,r.FRI),l(h,"D",M-1,M-1),l(h,"d",r.MON,r.THU),l(g,"D",M+1,M+1),l(g,"d",r.TUE,r.FRI)),S.exceptions.push(h),S.exceptions.push(g)}function d(S,C,M,h,g,v){var y=S.split("/"),E=+y[1],T=y[0];if(T!=="*"&&T!=="0"){var b=T.split("-");h=i(b[0],v,g),g=i(b[1],v,g)||g}l(C,M,h,g,E)}function f(S,C,M,h,g,v){var y,E,T=C.schedules,b=T[T.length-1];S==="L"&&(S=h-1),(y=i(S,v,g))!==null?l(b,M,y,y):(y=i(S.replace("W",""),v,g))!==null?c(C,b,y):(y=i(S.replace("L",""),v,g))!==null?u(T,b,y,h-1):(E=S.split("#")).length===2?(y=i(E[0],v,g),u(T,b,y,i(E[1]))):d(S,b,M,h,g,v)}function p(S){return S.indexOf("#")>-1||S.indexOf("L")>0}function m(S,C){return p(S)&&!p(C)?1:S-C}function D(S){var C={schedules:[{}],exceptions:[]},M=S.replace(/(\s)+/g," ").split(" "),h,g,v,y;for(h in t)if(g=t[h],v=M[g[0]],v&&v!=="*"&&v!=="?"){y=v.split(",").sort(m);var E,T=y.length;for(E=0;E<T;E++)f(y[E],C,h,g[1],g[2],g[3])}return C}function R(S){var C=S.toUpperCase();return s[C]||C}var I=R(n);return D(e?I:"0 "+I)},a.parse.recur=function(){var n=[],e=[],r,s=n,t,i,o,l,u,c,d,f;function p(m,D,R){if(m=l?m+"_"+l:m,r||(s.push({}),r=s[0]),r[m]||(r[m]=[]),t=r[m],o){for(i=[],d=D;d<=R;d+=o)i.push(d);f={n:m,x:o,c:t.length,m:R}}i=u?[D]:c?[R]:i;var I=i.length;for(d=0;d<I;d+=1){var S=i[d];t.indexOf(S)<0&&t.push(S)}i=o=l=u=c=0}return{schedules:n,exceptions:e,on:function(){return i=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(m){return o=m||1,this},after:function(m){return l="a",i=[m],this},before:function(m){return l="b",i=[m],this},first:function(){return u=1,this},last:function(){return c=1,this},time:function(){for(var m=0,D=i.length;m<D;m++){var R=i[m].split(":");R.length<3&&R.push(0),i[m]=+R[0]*3600+ +R[1]*60+ +R[2]}return p("t"),this},second:function(){return p("s",0,59),this},minute:function(){return p("m",0,59),this},hour:function(){return p("h",0,23),this},dayOfMonth:function(){return p("D",1,c?0:31),this},dayOfWeek:function(){return p("d",1,7),this},onWeekend:function(){return i=[1,7],this.dayOfWeek()},onWeekday:function(){return i=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return p("dc",1,c?0:5),this},dayOfYear:function(){return p("dy",1,c?0:366),this},weekOfMonth:function(){return p("wm",1,c?0:5),this},weekOfYear:function(){return p("wy",1,c?0:53),this},month:function(){return p("M",1,12),this},year:function(){return p("Y",1970,2450),this},fullDate:function(){for(var m=0,D=i.length;m<D;m++)i[m]=i[m].getTime();return p("fd"),this},customModifier:function(m,D){var R=a.modifier[m];if(!R)throw new Error("Custom modifier "+m+" not recognized!");return l=m,i=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(m){var D=a[m];if(!D)throw new Error("Custom time period "+m+" not recognized!");return p(m,D.extent(new Date)[0],D.extent(new Date)[1]),this},startingOn:function(m){return this.between(m,f.m)},between:function(m,D){return r[f.n]=r[f.n].splice(0,f.c),o=f.x,p(f.n,m,D),this},and:function(){return r=s[s.push({})-1],this},except:function(){return s=e,r=null,this}}},a.parse.text=function(n){var e=a.parse.recur,r=0,s="",t,i={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(h,g,v,y){return{startPos:h,endPos:g,text:v,type:y}}function u(h){var g=h instanceof Array?h:[h],v=/\s+/,y,E,T,b,w,A;for(g.push(v),w=r;!y||y.type===v;){A=-1,E=s.substring(w),y=l(w,w,s.split(v)[0]);var j,O=g.length;for(j=0;j<O;j++)b=g[j],T=b.exec(E),T&&T.index===0&&T[0].length>A&&(A=T[0].length,y=l(w,w+A,E.substring(0,A),b));y.type===v&&(w=y.endPos)}return y}function c(h){var g=u(h);return r=g.endPos,g}function d(h){for(var g=+C(h),v=I(i.through)?+C(h):g,y=[],E=g;E<=v;E++)y.push(E);return y}function f(h){for(var g=d(h);I(i.and);)g=g.concat(d(h));return g}function p(h){var g,v,y,E;I(i.weekend)?h.on(o.sun,o.sat).dayOfWeek():I(i.weekday)?h.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(g=C(i.rank),h.every(g),v=R(h),I(i.start)?(g=C(i.rank),h.startingOn(g),S(v.type)):I(i.between)&&(y=C(i.rank),I(i.and)&&(E=C(i.rank),h.between(y,E))))}function m(h){I(i.first)?h.first():I(i.last)?h.last():h.on(f(i.rank)),R(h)}function D(h){r=0,s=h,t=-1;for(var g=e();r<s.length&&t<0;){var v=S([i.every,i.after,i.before,i.onthe,i.on,i.of,i.in,i.at,i.and,i.except,i.also]);switch(v.type){case i.every:p(g);break;case i.after:u(i.time).type!==void 0?(g.after(C(i.time)),g.time()):u(i.fullDate).type!==void 0?(g.after(C(i.fullDate)),g.fullDate()):(g.after(C(i.rank)),R(g));break;case i.before:u(i.time).type!==void 0?(g.before(C(i.time)),g.time()):u(i.fullDate).type!==void 0?(g.before(C(i.fullDate)),g.fullDate()):(g.before(C(i.rank)),R(g));break;case i.onthe:m(g);break;case i.on:g.on(f(i.dayName)).dayOfWeek();break;case i.of:g.on(f(i.monthName)).month();break;case i.in:g.on(f(i.yearIndex)).year();break;case i.at:for(g.on(C(i.time)).time();I(i.and);)g.on(C(i.time)).time();break;case i.and:break;case i.also:g.and();break;case i.except:g.except();break;default:t=r}}return{schedules:g.schedules,exceptions:g.exceptions,error:t}}function R(h){var g=S([i.second,i.minute,i.hour,i.dayOfYear,i.dayOfWeek,i.dayInstance,i.day,i.month,i.year,i.weekOfMonth,i.weekOfYear]);switch(g.type){case i.second:h.second();break;case i.minute:h.minute();break;case i.hour:h.hour();break;case i.dayOfYear:h.dayOfYear();break;case i.dayOfWeek:h.dayOfWeek();break;case i.dayInstance:h.dayOfWeekCount();break;case i.day:h.dayOfMonth();break;case i.weekOfMonth:h.weekOfMonth();break;case i.weekOfYear:h.weekOfYear();break;case i.month:h.month();break;case i.year:h.year();break;default:t=r}return g}function I(h){var g=u(h).type===h;return g&&c(h),g}function S(h){var g=c(h);return g.type?g.text=M(g.text,h):t=r,g}function C(h){return S(h).text}function M(h,g){var v=h;switch(g){case i.time:var y=h.split(/(:|am|pm)/),E=y[3]==="pm"&&y[0]<12?parseInt(y[0],10)+12:y[0],T=y[2].trim();v=(E.length===1?"0":"")+E+":"+T;break;case i.rank:v=parseInt(/^\d+/.exec(h)[0],10);break;case i.monthName:case i.dayName:v=o[h.substring(0,3)];break;case i.fullDate:v=new Date(h.toUpperCase());break}return v}return D(n.toLowerCase())},a}();L.date.localTime();function Mt(a){const n=[],e=[];let r;const s=function*(){for(r||(r=a[Symbol.iterator]());n.length&&(yield*n,n.length=0),!!r;){const{value:i,done:o}=r.next();if(o){r=null,a=null;break}e.push(i),yield i}},t=function*(){for(r||(r=a[Symbol.iterator]());e.length&&(yield*e,e.length=0),!!r;){const{value:i,done:o}=r.next();if(o){r=null,a=null;break}n.push(i),yield i}};return[s(),t()]}function*Kn(a,n){if(n<0)throw new Error("Batch size needs to a natural number");n=n|0;const e=[];for(const r of a)e.length===n&&(yield e,e.length=0),e.push(r);e.length>0&&(yield e)}function*Zn(a,n){let e=0;for(const r of a)n(r,e++)&&(yield r)}function*Jn(a,n){let e=0;for(const r of a)++e>n&&(yield r)}function Gn(a,n){let e=0;for(const r of a)if(!n(r,e++))return!1;return!0}function Xn(a,n){let e=0;for(const r of a)if(n(r,e++))return!0;return!1}function*Tt(a,n){let e=0;for(const r of a)yield n(r,e++)}function Qn(a,n,e){let r=0,s=e;for(const t of a)s=n(s,t,r++);return s}function*bt(a){const n=new Set;for(const e of a)n.has(e)||(n.add(e),yield e)}function*er(a,n){const e=new Set;for(const r of a){const s=n(r);e.has(s)||(e.add(s),yield r)}}function*tr(a,n){let e=0;for(const r of a)if(n(r,e++))yield r;else return}function*nr(...a){for(let n=0;n<a.length;n++)yield*a[n]}function*At(a){for(const n of a)yield*n}class oe{constructor(n){if(this.iterable=void 0,!n)throw new Error("Require an iterable instance for chaining");this.iterable=n}derive(n){return this.iterable=void 0,new oe(n)}copy(){const[n,e]=Mt(this.iterable);return this.iterable=e,new oe(n)}split(){const[n,e]=Mt(this.iterable);return[new oe(n),this.derive(e)]}inBatchesBySize(n){return this.derive(Kn(this.iterable,n))}filter(n){return this.derive(Zn(this.iterable,n))}drop(n){return this.derive(Jn(this.iterable,n))}map(n){return this.derive(Tt(this.iterable,n))}reduce(n,e){return Qn(this,n,e)}concat(){return this.derive(At(this.iterable))}uniqueOnly(){return this.derive(bt(this.iterable))}uniqueOnlyBy(n){return this.derive(er(this.iterable,n))}every(n){return Gn(this,n)}some(n){return Xn(this,n)}takeWhile(n){return this.derive(tr(this.iterable,n))}*[Symbol.iterator](){let n=this.iterable;if(!n)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*n,n=void 0}toArray(){return Array.from(this)}sort(n){return Array.from(this).sort(n)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const n of this);}memoize(){return new wt(this)}}const rr=a=>new oe(a),X=rr;class wt extends oe{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(n){this.$iterable=n}get iterable(){return this}derive(n){return new oe(n)}*[Symbol.iterator](){const n=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let e=this.$iterator,r=n.length;for(r>0&&(yield*n);;){if(n.length>r){for(let i=r;i<n.length;i++)yield n[i];r=n.length}if(!e)break;const{value:s,done:t}=e.next();t?(e=this.$iterator=null,this.$iterable=null):(n.push(s),r++,yield s)}}else yield*n}}const sr=a=>new wt(a),Pt=sr,Te=Symbol("MixinIdentity"),ye=Symbol("MixinStateProperty");class ir{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=Pt(this.linearizedByTopoLevels())}static new(n){const e=new this;return n&&Object.assign(e,n),e}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((n,e)=>n-e)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(n,e){let r=n.get(e);return r||(r=[],n.set(e,r)),r}buildElementsByTopoLevel(){let n=0;const e=this.baseEl?X(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,r=X(this.sourceEl.requirements).map(s=>s.walkDepthState.elementsByTopoLevel).concat().reduce((s,[t,i])=>(t>n&&(n=t),this.getOrCreateLevel(s,t).push(i),s),new Map);return this.getOrCreateLevel(r,n+1).push([this.sourceEl]),X(r).map(([s,t])=>[s,X(t).concat().uniqueOnly().filter(i=>!e.has(i)).sort((i,o)=>i.id-o.id)]).toMap()}*linearizedByTopoLevels(){yield*X(this.topoLevels).map(n=>this.elementsByTopoLevel.get(n)).concat()}}let jt=1;const ar=a=>class extends a{};class be{}class Je{constructor(){this.id=jt++,this.requirements=[],this.baseClass=be,this.identitySymbol=void 0,this.mixinLambda=ar,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(n){const e=new this;n&&Object.assign(e,n),e.walkDepthState=ir.new({sourceEl:e,baseEl:lr(e.baseClass)});const r=e.mixinLambda,s=e.identitySymbol=Symbol(r.name),t=Object.assign(function(i){const o=r(i);return o.prototype[s]=!0,o},{[Te]:s,[ye]:e});return Object.defineProperty(t,Symbol.hasInstance,{value:Ft}),e.mixinLambda=t,e}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(n){const e=this.constructor,r=e.baseClassesIds.get(n);if(r!==void 0)return r;const s=jt++;return e.baseClassesIds.set(n,s),s}buildMinimalClass(){const n=this.constructor;let e=this.baseClass;const r=this.walkDepthState.linearizedByTopoLevelsSource.reduce((t,i)=>{const{cls:o,hash:l}=t,u=l+String.fromCharCode(i.id);let c=n.minimalClassesByLinearHash.get(u);return c||(c=i.mixinLambda(o),i.name=c.name,n.minimalClassesByLinearHash.set(u,c)),t.cls=c,t.hash=u,t},{cls:e,hash:String.fromCharCode(this.getBaseClassMixinId(e))}).cls,s=Object.assign(r,{[Te]:this.identitySymbol,[ye]:this,mix:this.mixinLambda,derive:t=>P([s,t],i=>class extends i{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(s,Symbol.hasInstance,{value:Ft}),s}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((n,e)=>`${e.name}(${n})`,this.baseClass.name)}}Je.minimalClassesByLinearHash=new Map,Je.baseClassesIds=new Map;const or=a=>Object.getPrototypeOf(a.prototype).constructor.hasOwnProperty(ye),lr=a=>Object.getPrototypeOf(a.prototype).constructor[ye],Ot=(a,n)=>{let e;if(a.length>0){const t=a[a.length-1];!or(t)&&t!==be&&(e=t)}const r=[];return a.forEach((t,i)=>{const o=t[ye];if(o!==void 0){const l=o.baseClass;if(l!==be)if(e){if(e!==l){const u=l.prototype.isPrototypeOf(e.prototype),c=e.prototype.isPrototypeOf(l.prototype);if(!u&&!c)throw new Error("Base class mismatch");e=c?l:e}}else e=l;r.push(o)}else if(i!==a.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),Je.new({requirements:r,mixinLambda:n,baseClass:e||be}).minimalClass},Ft=function(a){return!!(a&&a[this[Te]])},U=(a,n)=>!!(a&&a[n[Te]]),P=Ot,ur=Ot;var he;(function(a){a.Millisecond="millisecond",a.Second="second",a.Minute="minute",a.Hour="hour",a.Day="day",a.Week="week",a.Month="month",a.Quarter="quarter",a.Year="year"})(he||(he={}));var Ge;(function(a){a.MustStartOn="muststarton",a.MustFinishOn="mustfinishon",a.StartNoEarlierThan="startnoearlierthan",a.StartNoLaterThan="startnolaterthan",a.FinishNoEarlierThan="finishnoearlierthan",a.FinishNoLaterThan="finishnolaterthan"})(Ge||(Ge={}));var Xe;(function(a){a.Normal="Normal",a.FixedDuration="FixedDuration",a.FixedEffort="FixedEffort",a.FixedUnits="FixedUnits"})(Xe||(Xe={}));var Qe;(function(a){a[a.NoError=0]="NoError",a[a.CyclicDependency=1]="CyclicDependency",a[a.DuplicatingDependency=2]="DuplicatingDependency"})(Qe||(Qe={}));var et;(function(a){a[a.StartToStart=0]="StartToStart",a[a.StartToEnd=1]="StartToEnd",a[a.EndToStart=2]="EndToStart",a[a.EndToEnd=3]="EndToEnd"})(et||(et={}));var tt;(function(a){a.Project="Project",a.FromEvent="FromEvent",a.ToEvent="ToEvent"})(tt||(tt={}));var nt;(function(a){a[a.SchedulerBasic=1]="SchedulerBasic",a[a.SchedulerPro=2]="SchedulerPro",a[a.Gantt=3]="Gantt"})(nt||(nt={}));var rt;(function(a){a.Forward="Forward",a.Backward="Backward",a.None="None"})(rt||(rt={}));var st;(function(a){a.Start="Start",a.End="End"})(st||(st={}));const se=new Date(-864e13),Q=new Date(864e13),cr=a=>{if(!a)return!1;const n=a.getTime();return n!==se.getTime()&&n!==Q.getTime()};var ie;(function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"})(ie||(ie={}));var Y;(function(a){a[a.FullRangeIterated=0]="FullRangeIterated",a[a.StoppedByIterator=1]="StoppedByIterator",a[a.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",a[a.MaxRangeReached=3]="MaxRangeReached"})(Y||(Y={}));class kt{constructor(n){this.cacheFilledStartDate=Q,this.cacheFilledEndDate=se,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=he.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,n&&Object.assign(this,n)}includeWrappingRangeFrom(n,e,r){n.ensureCacheFilledForInterval(e,r),this.intervalCache.includeWrappingRange(n.intervalCache,e,r)}ensureCacheFilledForInterval(n,e){const r=this.cacheFilledStartDate.getTime(),s=this.cacheFilledEndDate.getTime();if(r!==Q.getTime()){const t=n.getTime(),i=e.getTime();if(r<=t&&i<=s)return;if(i<=r)e=new Date(r-1);else if(t>=s)n=new Date(s);else if(r<=t&&t<=s)n=new Date(s+1);else if(r<=i&&i<=s)e=new Date(r-1);else{this.ensureCacheFilledForInterval(n,new Date(r-1)),this.ensureCacheFilledForInterval(new Date(s+1),e);return}}(r===Q.getTime()||n.getTime()<s)&&(this.cacheFilledStartDate=n),(s===se.getTime()||s<e.getTime())&&(this.cacheFilledEndDate=e),this.fillCache(n,e)}fillCache(n,e){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=Q,this.cacheFilledEndDate=se,this.intervalCache.clear()}forEachAvailabilityInterval(n,e,r){var m;r=r||this;const s=n.startDate,t=n.endDate,i=s&&s.getTime(),o=t&&t.getTime(),l=(m=n.maxRange)!=null?m:this.maxRange,u=n.isForward!==!1;if(u?!s:!t)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const c=this.intervalCache;let d=u?s:t,f=u?s:t;const p=f.getTime();for(let D=1;D<this.maxCacheExtendCycles;D++){u?this.ensureCacheFilledForInterval(d,t||x.add(d,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(s||x.add(d,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),d);let R=c.getIntervalOf(f,u?ie.Left:ie.Right);for(;R;){const I=R.startDate,S=R.endDate;if(u&&o&&I.getTime()>=o||!u&&i&&S.getTime()<=i)return Y.FullRangeIterated;if(u&&I.getTime()-p>=l||!u&&p-S.getTime()>=l)return Y.MaxRangeReached;if(u&&I.getTime()>=this.cacheFilledEndDate.getTime()||!u&&S.getTime()<=this.cacheFilledStartDate.getTime())break;f=u?S:I;const C=i&&I.getTime()<i?s:I,M=o&&S.getTime()>o?t:S;if(e.call(r,C,M,R.cacheInterval)===!1)return Y.StoppedByIterator;R=u?c.getNextInterval(R):c.getPrevInterval(R)}if(u&&f.getTime()===Q.getTime()||!u&&f.getTime()===se.getTime())return Y.FullRangeIterated;d=u?this.cacheFilledEndDate:this.cacheFilledStartDate}return Y.MaxCacheExtendCyclesReached}}const $t=a=>Array.from(new Set(a));class xe{constructor(n){if(this.intervals=[],n&&Object.assign(this,n),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(n){if(this.intervals.indexOf(n)==-1){const e=this.intervals.slice();return e.push(n),new xe({intervals:e,calendar:this.calendar})}else return this}combineWith(n){return new xe({intervals:this.intervals.concat(n.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const n=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=n[0].isWorking}normalizeIntervals(n){const e=$t(n);return e.sort((r,s)=>s.getPriorityField()-r.getPriorityField()),e}}const Se=(a,n,e=(r,s)=>r-s)=>{let r=0,s=n.length;for(;r<s;){const t=(r+s)/2|0,i=e(a,n[t]);if(i===0)return{found:!0,index:t};i<0?s=t:r=t+1}return{found:!1,index:s}};var ae;(function(a){a[a.Exact=0]="Exact",a[a.Next=1]="Next"})(ae||(ae={}));class Lt{constructor(n){this.keys=[],this.values=[],this.comparator=n||((e,r)=>e-r)}set(n,e){const r=Se(n,this.keys,this.comparator);return r.found?this.values[r.index]=e:(this.keys.splice(r.index,0,n),this.values.splice(r.index,0,e)),r.index}insertAt(n,e,r){this.keys.splice(n,0,e),this.values.splice(n,0,r)}setValueAt(n,e){this.values[n]=e}get(n){const e=Se(n,this.keys,this.comparator);return e.found?this.values[e.index]:void 0}getEntryAt(n){return n<this.keys.length?{key:this.keys[n],value:this.values[n]}:void 0}getKeyAt(n){return this.keys[n]}getValueAt(n){return this.values[n]}delete(n){const e=Se(n,this.keys,this.comparator);e.found&&this.deleteAt(e.index)}size(){return this.keys.length}deleteAt(n){this.keys.splice(n,1),this.values.splice(n,1)}indexOfKey(n){const e=Se(n,this.keys,this.comparator);return{found:e.found?ae.Exact:ae.Next,index:e.index}}map(n){const e=this.keys,r=this.values,s=[];for(let t=0;t<e.length;t++)s.push(n(r[t],e[t],t));return s}getAllEntries(){return this.map((n,e)=>({value:n,key:e}))}clear(){this.keys.length=0,this.values.length=0}}class Nt{constructor(n){if(this.points=new Lt((e,r)=>e.getTime()-r.getTime()),this.leftInfinityKey=se,this.rightInfinityKey=Q,Object.assign(this,n),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(n){return this.points.indexOfKey(n)}getDateAt(n){return this.points.getKeyAt(n)}getPointAt(n){return this.points.getValueAt(n)}getIntervalOf(n,e=ie.Left){let{found:r,index:s}=this.indexOf(n),t;return e===ie.Left?t=r===ae.Exact?s:s-1:t=s-1,this.getIntervalWithStartDateIndex(t)}getPrevInterval(n){return n.startDateIndex===0?null:this.getIntervalWithStartDateIndex(n.startDateIndex-1)}getNextInterval(n){return n.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(n.startDateIndex+1)}getIntervalWithStartDateIndex(n){return{startDateIndex:n,startDate:this.getDateAt(n),endDate:n+1<this.size()?this.getDateAt(n+1):this.rightInfinityKey,cacheInterval:this.getPointAt(n)}}addInterval(n,e,r){const s=this.points,{found:t,index:i}=s.indexOfKey(n);let o,l;if(t==ae.Exact){const u=r(l=s.getValueAt(i));s.setValueAt(i,u),o=i+1}else{const u=r(l=s.getValueAt(i-1));s.insertAt(i,n,u),o=i+1}for(;o<s.size()&&!(s.getKeyAt(o).getTime()>=e.getTime());){const c=r(l=s.getValueAt(o));s.setValueAt(o,c),o++}o===s.size()?s.insertAt(s.size(),e,this.emptyInterval):s.getKeyAt(o).getTime()===e.getTime()||s.insertAt(o,e,l)}includeWrappingRange(n,e,r){let s=n.getIntervalOf(e);for(;s&&(this.addInterval(s.startDate,s.endDate,t=>this.combineIntervalsFn(t,s.cacheInterval)),!(s.endDate.getTime()>r.getTime()));)s=n.getNextInterval(s)}getSummary(){return this.points.map((n,e)=>({label:n,date:e}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class _t extends kt{constructor(n){if(super(n),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new Nt({emptyInterval:new xe({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,r)=>e.combineWith(r)})}fillCache(n,e){var r;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,n,e);const s=n.getTime(),t=e.getTime(),i=(r=this.calendar.project)===null||r===void 0?void 0:r.timeZone;if(s>t)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(o=>{const l=o.getStartDateSchedule(),u=o.getEndDateSchedule();let c=l.prev(1,n),d;if(u==="EOD"){const m=l.next(1,e);m!==L.NEVER?d=x.getStartOfNextDay(m,!0):d=L.NEVER}else d=u.next(1,e);if(c!==L.NEVER&&c.getTime()===s){const m=l.prev(2,n);m!==L.NEVER&&m.length===2&&(c=m[1])}if(d!==L.NEVER&&d.getTime()===t){const m=u.next(2,e);m!==L.NEVER&&m.length===2&&(d=m[1])}const f=l.next(1/0,c!==L.NEVER?c:n,d!==L.NEVER?new Date(d.getTime()-1):e);if(f===L.NEVER)return;const p=u==="EOD"?f.map(m=>x.getStartOfNextDay(m,!0)):u.next(1/0,new Date(f[0].getTime()+1),d!==L.NEVER?d:e);p!==L.NEVER&&(p.length>f.length?p.length=f.length:p.length<f.length&&(f.length=p.length),f.forEach((m,D)=>{let R=m,I=p[D];i!=null&&(R=z.toTimeZone(R,i),I=z.toTimeZone(I,i)),this.intervalCache.addInterval(R,I,S=>S.includeInterval(o))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(n=>{var e;const r=(e=this.calendar.project)===null||e===void 0?void 0:e.timeZone;let{startDate:s,endDate:t}=n;r!=null&&(s=z.toTimeZone(s,r),t=z.toTimeZone(t,r)),this.intervalCache.addInterval(s,t,i=>i.includeInterval(n))})}forEachStaticInterval(n){this.intervalStore.forEach(e=>{e.isStatic()&&n(e)})}forEachRecurrentInterval(n){this.intervalStore.forEach(e=>{e.isRecurrent()&&n(e)})}}class Ae extends P([],n=>{n.prototype;class e extends n{async commitAsync(){return this.project.commitAsync()}set project(s){this.$project=s}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(s){return this.project=s}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const s=this.getProject();return s==null?void 0:s.assignmentStore}getDependencyStore(){const s=this.getProject();return s==null?void 0:s.dependencyStore}getEventStore(){const s=this.getProject();return s==null?void 0:s.eventStore}getResourceStore(){const s=this.getProject();return s==null?void 0:s.resourceStore}getCalendarManagerStore(){const s=this.getProject();return s==null?void 0:s.calendarManagerStore}}return e}){}class q extends P([Ae,N],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}construct(t={}){return t.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},e.construct.call(this,t)}trigger(t,i){const o=this,{asyncEvents:l,project:u}=o,c=l==null?void 0:l[t];return c&&(c===!0||c[i.action])?(e.trigger.call(o,`${t}PreCommit`,{...i}),!u||u.isEngineReady()&&!u.isWritingData?e.trigger.call(o,t,i):!o.eventsSuspended&&u&&(u.dataReadyDetacher||(u.queuedDataReadyEvents=[],u.dataReadyDetacher=u.ion({dataReady(){this.queuedDataReadyEvents.forEach(([f,p,m,D])=>{f.trigger.call(p,m,D)}),u.queuedDataReadyEvents=null,u.dataReadyDetacher(),u.dataReadyDetacher=null},once:!0})),u.queuedDataReadyEvents.push([e,o,t,i])),!0):e.trigger.call(o,t,i)}calculateProject(){return this.project}setStoreData(t){var i;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,e.setStoreData.call(this,t),this.isLoadingData=!1,(i=this.project)===null||i===void 0||i.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),e.doAutoCommit.call(this)}async addAsync(t,i){const o=this.add(t,i);return await this.project.commitAsync(),o}async insertAsync(t,i,o){const l=this.insert(t,i,o);return await this.project.commitAsync(),l}async loadDataAsync(t){this.data=t,await this.project.commitAsync()}performFilter(){var t;return this.project&&(this.isLoadingData||(t=this.rootNode)!==null&&t!==void 0&&t.isLoading)&&this.project.commitAsync().then(()=>this.filter()),super.performFilter(...arguments)}}return r}){}class De extends P([Ae,_],n=>{const e=n.prototype;class r extends n{joinStore(t){let i=null;if(U(t,q)){const o=t.getProject();o&&!this.getProject()&&(this.setProject(o),i=o)}e.joinStore.call(this,t),i&&!i.isRepopulatingStores&&this.joinProject()}unjoinStore(t,i=!1){e.unjoinStore.call(this,t,i);const{project:o}=this,l=U(t,q)&&!t.isFillingFromMaster&&o===(t.isChained&&t.project?t.masterStore.project:t.project);o&&!o.isDestroying&&!o.isRepopulatingStores&&l&&(this.leaveProject(i),this.setProject(null)),l&&(this.graph=null)}joinProject(){}leaveProject(t=!1){}calculateProject(){const t=this.stores.find(i=>U(i,q)&&!!i.getProject());return t==null?void 0:t.getProject()}async setAsync(t,i,o){var l;const u=this.set(t,i,o);return await((l=this.project)===null||l===void 0?void 0:l.commitAsync()),u}async getAsync(t){var i;return await((i=this.project)===null||i===void 0?void 0:i.commitAsync()),this.get(t)}get isStmRestoring(){const t=this.getProject();return(t==null?void 0:t.isRestoringData)||(t==null?void 0:t.stm.isRestoring)||!1}}return r}){}class it extends P([De],n=>{n.prototype;class e extends n{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let s=1e4+this.getCalendar().getDepth()*100,t=this.priority;return t==null&&(t=this.isRecurrent()?20:30),this.priorityField=s+t}isRecurrent(){return!!(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return!!(this.startDate&&this.endDate)}parseDateSchedule(s){let t=s;if(s&&s!==Object(s)&&(t=L.parse.text(s),t!==Object(t)||t.error>=0))try{t=JSON.parse(s)}catch(i){return null}return t}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const s=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=L.schedule(s)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const s=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=L.schedule(s)}}return e}){}class Bt extends P([q],n=>{n.prototype;class e extends n{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:it}}}return e}){}class Vt extends P([it],n=>{n.prototype;class e extends n{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return e}){}class we extends P([Ae],n=>{n.prototype;class e extends n{get eventStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.eventStore}get resourceStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.resourceStore}get assignmentStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.assignmentStore}get dependencyStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.dependencyStore}get calendarManagerStore(){var s;return(s=this.project)===null||s===void 0?void 0:s.calendarManagerStore}getEventById(s){var t;return(t=this.eventStore)===null||t===void 0?void 0:t.getById(s)}getDependencyById(s){var t;return(t=this.dependencyStore)===null||t===void 0?void 0:t.getById(s)}getResourceById(s){var t;return(t=this.resourceStore)===null||t===void 0?void 0:t.getById(s)}getAssignmentById(s){var t;return(t=this.assignmentStore)===null||t===void 0?void 0:t.getById(s)}getCalendarById(s){var t;return(t=this.calendarManagerStore)===null||t===void 0?void 0:t.getById(s)}}return e}){}class Yt extends P([De],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return Bt}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(t){t.storeClass=this.intervalStoreClass,t.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,t.calendar=this}processIntervalsStoreData(t){this.bumpVersion()}isDefault(){const t=this.getProject();return t?this===t.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(t,i,o){var l;const u=(l=this.getProject())===null||l===void 0?void 0:l.maxCalendarRange;return u&&(t=Object.assign({maxRange:u},t)),this.calendarCache.forEachAvailabilityInterval(t,i,o)}accumulateWorkingTime(t,i,o){var d;var l;if(i===0)return{finalDate:new Date(t),remainingDurationInMs:0};if(isNaN(i))throw new Error("Invalid duration");let u=t;const c=(d=(l=this.getProject())===null||l===void 0?void 0:l.adjustDurationToDST)!=null?d:!1;return this.forEachAvailabilityInterval(o?{startDate:t,isForward:!0}:{endDate:t,isForward:!1},(f,p,m)=>{let D=!0;if(m.getIsWorking()){let R=p.getTime()-f.getTime();if(i<=R){if(c){const I=o?f.getTimezoneOffset()-new Date(f.getTime()+i).getTimezoneOffset():new Date(p.getTime()-i).getTimezoneOffset()-p.getTimezoneOffset();i-=I*60*1e3}u=o?new Date(f.getTime()+i):new Date(p.getTime()-i),i=0,D=!1}else{if(c){const I=f.getTimezoneOffset()-p.getTimezoneOffset();R+=I*60*1e3}u=o?p:f,i-=R}}return D}),{finalDate:new Date(u),remainingDurationInMs:i}}calculateDurationMs(t,i,o=!1){let l=0;const u=t.getTime()<=i.getTime()||!o?1:-1;u<0&&([t,i]=[i,t]);const c=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:t,endDate:i},(d,f,p)=>{if(p.getIsWorking()&&(l+=f.getTime()-d.getTime(),c)){const m=d.getTimezoneOffset()-f.getTimezoneOffset();l+=m*60*1e3}}),l*u}calculateEndDate(t,i){const o=i>=0,l=this.accumulateWorkingTime(t,Math.abs(i),o);return l.remainingDurationInMs===0?l.finalDate:null}calculateStartDate(t,i){const o=i<=0,l=this.accumulateWorkingTime(t,Math.abs(i),o);return l.remainingDurationInMs===0?l.finalDate:null}skipNonWorkingTime(t,i=!0){let o;const l=this.forEachAvailabilityInterval(i?{startDate:t,isForward:!0}:{endDate:t,isForward:!1},(u,c,d)=>{if(d.getIsWorking())return o=i?u:c,!1});return l===Y.MaxRangeReached||l===Y.FullRangeIterated?"empty_calendar":o?new Date(o):new Date(t)}addInterval(t){return this.addIntervals([t])}addIntervals(t){return this.bumpVersion(),this.intervalStore.add(t)}removeInterval(t){return this.removeIntervals([t])}removeIntervals(t){return this.bumpVersion(),this.intervalStore.remove(t)}clearIntervals(t){return t||this.bumpVersion(),this.intervalStore.removeAll(t)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const t=new Vt({isWorking:this.unspecifiedTimeIsWorking});return t.calendar=this,this.$calendarCache=new _t({calendar:this,unspecifiedTimeInterval:t,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(t=>{t.intervalStore.forEach(i=>i.resetPriority())})}insertChild(t,i,o){let l=e.insertChild.call(this,...arguments);return Array.isArray(l)||(l=[l]),l.forEach(u=>{u.bumpVersion(),u.resetPriorityOfAllIntervals()}),l}joinProject(){e.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){e.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(t){const i=x.clearTime(t),o=x.getNext(t,he.Day);let l=!1;return this.forEachAvailabilityInterval({startDate:i,endDate:o,isForward:!0},(u,c,d)=>(l=d.getIsWorking(),!l)),!l}getDailyHolidaysRanges(t,i){const o=[];for(t=x.clearTime(t);t<i;)this.isDayHoliday(t)&&o.push({startDate:t,endDate:x.getStartOfNextDay(t,!0,!0)}),t=x.getNext(t,he.Day);return o}getWorkingTimeRanges(t,i){const o=[];return this.forEachAvailabilityInterval({startDate:t,endDate:i,isForward:!0},(l,u,c)=>{if(c.getIsWorking()){const d=c.intervals[0];o.push({name:d.name,startDate:l,endDate:u})}}),o}getNonWorkingTimeRanges(t,i){const o=[];return this.forEachAvailabilityInterval({startDate:t,endDate:i,isForward:!0},(l,u,c)=>{if(!c.getIsWorking()){const d=c.intervals[0];o.push({name:d.name,iconCls:d.iconCls,cls:d.cls,startDate:l,endDate:u})}}),o}isWorkingTime(t,i,o){if(o){let l;const u=this.forEachAvailabilityInterval({startDate:t,endDate:i,isForward:!0},(c,d,f)=>{if(f.getIsWorking()&&c<=t&&d>=i)return l=!0,!1});return u===Y.MaxRangeReached||u===Y.FullRangeIterated?!1:l}else{const l=this.skipNonWorkingTime(t);return l&&l!=="empty_calendar"?i?l<i:l.getTime()===t.getTime():!1}}}return r}){}class Ut extends P([De],n=>{const e=n.prototype;class r extends n{getAssignmentFor(t){var i;for(const o of(i=this.assigned)!=null?i:[])if(o.resource===t)return o;return null}isAssignedTo(t){return!!this.getAssignmentFor(t)}async assign(t){const i=this.project.assignmentStore.modelClass;return this.addAssignment(new i({event:this,resource:t})),this.commitAsync()}async unassign(t){const i=this.getAssignmentFor(t);return this.removeAssignment(i),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const t=this.getEventStore();this.assigned.forEach(i=>t.assignmentsForRemoval.add(i))}e.leaveProject.call(this,...arguments)}remove(){if(this.parent){const t=this.getEventStore();e.remove.call(this),t&&t.afterEventRemoval()}else return e.remove.call(this)}addAssignment(t){return this.getProject().assignmentStore.add(t),t}removeAssignment(t){return this.getProject().assignmentStore.remove(t),t}}return r}){}class ge extends P([De,we,_],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(t=!1){var i;e.leaveProject.call(this,t),(i=this.project)===null||i===void 0||i.bufferedCommitAsync()}invalidate(){var t;(t=this.project)===null||t===void 0||t.invalidate(this)}getCurrentOrProposed(t){var i;return t in this.$changed&&this.$changed[t]!==!0?this.$changed[t]:(i=this.get(t))!=null?i:null}hasCurrentOrProposed(t){return t in this.$changed&&this.$changed[t]!=!0||this.get(t)!=null}propose(t){var i;if(this.project||(i=this.recurringTimeSpan)!==null&&i!==void 0&&i.project){const o=Object.keys(t);for(let l=0;l<o.length;l++){const u=o[l];this.$changed[u]=t[u]}this.invalidate()}else this.set(t)}setChanged(t,i,o=!0,l=!1){const u=this;u.$changed[t]=i,l&&(t in u.$beforeChange||(u.$beforeChange[t]=u.get(t)),u.setData(t,i)),o&&u.invalidate()}calculateInvalidated(){}finalizeInvalidated(t=!1){const i=this;i.$isCalculating=!0,t?i.setData(i.$changed):(i.setData(i.$beforeChange),i.set(i.$changed)),i.$changed={},i.$beforeChange={},i.$isCalculating=!1}}return r}){}const dr=a=>Number(a)!==a,at=a=>a instanceof Set||a instanceof Array?X(a):X([a]),qt=a=>new Promise(n=>setTimeout(n,a)),hr=(a,...n)=>a.replace(/{(\d+)}/g,(e,r)=>typeof n[r]!="undefined"?n[r]:e);class Wt extends P([q],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(t,i){this.assignmentsForRemoval=at(t).toSet();const o=e.remove.call(this,t,i);return this.assignmentsForRemoval.clear(),o}removeAll(t){this.allAssignmentsForRemoval=!0;const i=e.removeAll.call(this,t);return this.allAssignmentsForRemoval=!1,i}}return r}){}class zt extends P([q],n=>{n.prototype;class e extends n{doDestroy(){var s;const t=[];(s=this.rootNode)!==null&&s!==void 0&&s.isDestroyed||this.traverse(i=>t.push(i)),super.doDestroy(),t.forEach(i=>i.destroy())}}return e}){}class Ht extends P([q],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(t,i){this.dependenciesForRemoval=at(t).toSet();const o=e.remove.call(this,t,i);return this.dependenciesForRemoval.clear(),o}removeAll(t){this.allDependenciesForRemoval=!0;const i=e.removeAll.call(this,t);return this.allDependenciesForRemoval=!1,i}}return r}){}const gr={splice:1,clear:1};class Kt extends P([q],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(t){var i;const o=gr[t.action];super.onDataChange(t),o&&(i=t.removed)!==null&&i!==void 0&&i.length&&this.afterEventRemoval()}remove(t,i){const o=e.remove.call(this,t,i);return this.afterEventRemoval(),o}removeAll(t){const i=e.removeAll.call(this,t);return this.afterEventRemoval(),i}onNodeRemoveChild(t,i,o,l){const u=e.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),u}afterEventRemoval(){const{assignmentsForRemoval:t,dependenciesForRemoval:i}=this;if(!t)return;const o=this.getAssignmentStore();if(o&&!o.allAssignmentsForRemoval&&t.size){const u=[...t].filter(c=>!o.assignmentsForRemoval.has(c));u.length>0&&o.remove(u)}t.clear();const l=this.getDependencyStore();if(l&&!l.allDependenciesForRemoval&&i.size){const u=[...i].filter(c=>!l.dependenciesForRemoval.has(c));u.length>0&&l.remove(u)}i.clear()}processRecord(t,i=!1){var o;if(!((o=this.project)!==null&&o!==void 0&&o.isRepopulatingStores)){const l=this.getById(t.id);if(l&&l!==t&&l.assigned)for(const c of l.assigned)c.event=t}return t}}return r}){}const fr={splice:1,clear:1};class Zt extends P([q],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(t){var i;const o=fr[t.action];super.onDataChange(t),o&&(i=t.removed)!==null&&i!==void 0&&i.length&&this.afterResourceRemoval()}remove(t,i){const o=e.remove.call(this,t,i);return this.afterResourceRemoval(),o}removeAll(t){const i=e.removeAll.call(this,t);return this.afterResourceRemoval(),i}afterResourceRemoval(){const t=this.getAssignmentStore();if(t&&!t.allAssignmentsForRemoval){const i=[...this.assignmentsForRemoval].filter(o=>!t.assignmentsForRemoval.has(o));i.length>0&&t.remove(i)}this.assignmentsForRemoval.clear()}processRecord(t,i=!1){const o=this.getById(t.id);if(o&&o!==t)for(const u of o.assigned||[])u.resource=t;return t}}return r}){}class H extends P([ge],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var t,i;return(i=(t=this._startDate)!=null?t:this.get("startDate"))!=null?i:null}get endDate(){var t,i;return(i=(t=this._endDate)!=null?t:this.get("endDate"))!=null?i:null}get duration(){var t,i;return(i=(t=this._duration)!=null?t:this.get("duration"))!=null?i:null}set startDate(t){this.proposeStartDate(t)}set endDate(t){this.proposeEndDate(t)}set duration(t){this.proposeDuration(t)}inSet(t,i,o,l,u){const c=this;return c.project&&!c.project.isWritingData&&typeof t!="string"&&!u&&("startDate"in t&&!("startDate"in c.$changed)&&(c.$changed.startDate=!0,c.invalidate()),"endDate"in t&&!("endDate"in c.$changed)&&(c.$changed.endDate=!0,c.invalidate())),e.inSet.call(c,t,i,o,l,u)}getStartDate(){return this.startDate}proposeStartDate(t,i=!("endDate"in this.$changed)){var o;(this.inSetting||(t==null?void 0:t.getTime())!==((o=this.startDate)===null||o===void 0?void 0:o.getTime()))&&(this._startDate=t,this.propose({startDate:t,keepDuration:i}))}async setStartDate(t,i=!0){var o;return this.proposeStartDate(t,i),(o=this.project)===null||o===void 0?void 0:o.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(t,i=!1){var o;(this.inSetting||(t==null?void 0:t.getTime())!==((o=this.endDate)===null||o===void 0?void 0:o.getTime()))&&(this._endDate=t,this.propose({endDate:t,keepDuration:i}))}async setEndDate(t,i=!1){var o;return this.proposeEndDate(t,i),(o=this.project)===null||o===void 0?void 0:o.commitAsync()}getDuration(){return this.duration}proposeDuration(t,i,o=!0){this._duration=t,this.propose({duration:t,keepStart:o}),i&&this.propose({durationUnit:i})}async setDuration(t,i,o=!0){var l;return this.proposeDuration(t,i,o),(l=this.project)===null||l===void 0?void 0:l.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){const t=this,i=t.$changed,o=t.getCurrentOrProposed("startDate"),l=t.getCurrentOrProposed("endDate"),u=t.getCurrentOrProposed("duration");if(o!=null&&(i.startDate=t._startDate=o),l!=null&&(i.endDate=t._endDate=l),u!=null&&(i.duration=t._duration=u),t.eventStore&&!t.eventStore.isLoadingData){var c;const f=(c=t.assignmentStore)===null||c===void 0?void 0:c.storage.findItem("event",null);if(f){var d;const p=(d=t.assignmentStore)===null||d===void 0?void 0:d.storage.findItem("eventId",t.id);if(p)for(const m of p)m.setChanged("event",t);else for(const m of f)m.getCurrentOrProposed("event")===t.id&&m.setChanged("event",t)}}e.joinProject.call(t)}applyValue(t,i,o,l,u){var c;if((this.project||(c=this.recurringTimeSpan)!==null&&c!==void 0&&c.project)&&u){const{name:d}=u;(d==="startDate"||d=="duration"||d==="endDate")&&(t=!0,this["_"+d]=o),l&&(t=!1)}e.applyValue.call(this,t,i,o,l,u)}afterChange(t,i,o,l,u){!this.$isCalculating&&!u&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),e.afterChange.call(this,t,i,o,l,u)}calculateInvalidated(){const t=this,i=t.$changed,o="startDate"in i,l="endDate"in i,u="duration"in i,{startDate:c,endDate:d,duration:f,keepDuration:p,keepStart:m}=i;let D=null;o&&!l&&!u?c===null?i.endDate=null:t.hasCurrentOrProposed("endDate")&&c>t.getCurrentOrProposed("endDate")&&!p?(i.endDate=c,i.duration=0):t.hasCurrentOrProposed("duration")&&(p||!t.hasCurrentOrProposed("endDate"))?D="endDate":t.hasCurrentOrProposed("endDate")&&(D="duration"):!o&&l&&!u?d===null?i.startDate=null:t.hasCurrentOrProposed("startDate")&&!p&&d!==!0&&d<t.getCurrentOrProposed("startDate")?(i.startDate=d,i.duration=0):t.hasCurrentOrProposed("duration")&&(p||!t.hasCurrentOrProposed("startDate"))?D="startDate":t.hasCurrentOrProposed("startDate")&&(D="duration"):!o&&!l&&u?f===null?i.endDate=null:t.hasCurrentOrProposed("startDate")&&(m||!t.hasCurrentOrProposed("endDate"))?(m&&i.duration<0&&(i.duration=0),D="endDate"):t.hasCurrentOrProposed("endDate")&&(D="startDate"):o&&l&&!u?c===null&&d===null?i.duration=null:D="duration":o&&!l&&u?D="endDate":!o&&l&&u?D="startDate":o&&l&&u&&(f==null?D="duration":c==null?D="startDate":D="endDate");const R=t.getCurrentOrProposed("startDate"),I=t.getCurrentOrProposed("endDate"),S=t.getCurrentOrProposed("duration"),C=t.getCurrentOrProposed("durationUnit");let M,h;switch(D){case"startDate":i.startDate=x.add(I,-S,C);break;case"endDate":M=x.as("hour",S,C),h=x.as(C,M,"h"),i.endDate=x.add(R,h,C);break;case"duration":M=x.diff(R,I,"h"),i.duration=x.as(C,M,"h");break}"startDate"in i&&i.startDate!==!0&&(this._startDate=i.startDate),"endDate"in i&&i.endDate!==!0&&(this._endDate=i.endDate),"duration"in i&&i.duration!==!0&&(this._duration=i.duration),i.startDate===!0&&delete i.startDate,i.endDate===!0&&delete i.endDate,delete i.keepDuration,delete i.keepStart}}return r}){}class fe extends P([ge],n=>{const e=n.prototype;class r extends n{get assigned(){var t;return(t=this.project)===null||t===void 0?void 0:t.assignmentStore.getResourcesAssignments(this)}joinProject(){if(this.resourceStore&&!this.resourceStore.isLoadingData){var t;(t=this.assignmentStore)===null||t===void 0||t.query(i=>i.get("resource")===this.id).forEach(i=>i.setChanged("resource",this))}e.joinProject.call(this)}leaveProject(t=!1){var i;if(this.assigned&&!t&&!((i=this.resourceStore)!==null&&i!==void 0&&i.isLoadingData)){const o=this.resourceStore;this.assigned.forEach(l=>o.assignmentsForRemoval.add(l))}e.leaveProject.call(this)}applyValue(t,i,o,l,u){(u==null?void 0:u.name)==="id"&&this.assigned.forEach(c=>{c.set("resourceId",o)}),e.applyValue.call(this,t,i,o,l,u)}}return r}){}function Pe(a){return a!=null&&a.isModel?a.id:a}class je extends P([ge],n=>{const e=n.prototype;class r extends n{static get fields(){return[{name:"resource",isEqual:(t,i)=>t===i,persist:!1},{name:"event",isEqual:(t,i)=>t===i,persist:!1}]}setChanged(t,i,o){const{assignmentStore:l,eventStore:u,resourceStore:c,project:d}=this;let f=!1;if(t==="event"){const p=U(i,H)?i:u==null?void 0:u.$master.getById(i);p&&(f=!0),i=p||i}if(t==="resource"){const p=U(i,fe)?i:c==null?void 0:c.$master.getById(i);p&&(f=!0),i=p||i}e.setChanged.call(this,t,i,o,!0),l&&f&&!d.isPerformingCommit&&!l.isLoadingData&&!c.isLoadingData&&!l.skipInvalidateIndices&&l.invalidateIndices()}joinProject(){e.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){let{event:t=this.event,resource:i=this.resource}=this.$changed;if(t!==null&&!U(t,H)){var o;const u=(o=this.eventStore)===null||o===void 0?void 0:o.getById(t);u&&this.setChanged("event",u,!1)}if(i!==null&&!U(i,fe)){var l;const u=(l=this.resourceStore)===null||l===void 0?void 0:l.getById(i);u&&this.setChanged("resource",u,!1)}}finalizeInvalidated(t){const i=this.$changed;"resource"in i&&(i.resourceId=Pe(i.resource)),"event"in i&&(i.eventId=Pe(i.event)),e.finalizeInvalidated.call(this,t)}set event(t){this.setChanged("event",t),this.setChanged("eventId",Pe(t))}get event(){const t=this.get("event");return(t==null?void 0:t.id)!=null?t:null}set resource(t){this.setChanged("resource",t),this.setChanged("resourceId",Pe(t))}get resource(){const t=this.get("resource");return(t==null?void 0:t.id)!=null?t:null}}return r}){}class me extends P([q,we,N],n=>{const e=n.prototype;class r extends n{setProject(t){const i=e.setProject.call(this,t);return t&&this.joinProject(t),i}joinProject(t){}onCommitAsync(){}}return r}){}const Jt=new Set;class ot extends P([Wt,me],n=>{n.prototype;class e extends n{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:je,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(s){this.allAssignmentsForRemoval=!0,super.data=s,this.allAssignmentsForRemoval=!1}getEventsAssignments(s){return this.storage.findItem("event",s,!0)||Jt}getResourcesAssignments(s){return this.storage.findItem("resource",s.$original,!0)||Jt}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(s,t){s=s.masterStore||s;const i=this.count&&this.storage.findItem(t,null,!0);if(i){for(const o of i){const l=s.getById(o.getCurrentOrProposed(t));l&&o.setChanged(t,l)}this.invalidateIndices()}}unlinkAssignments(s){this.forEach(t=>{var o,l;var i;return t.setChanged(s,(l=(o=(i=t[s])===null||i===void 0?void 0:i.id)!=null?o:t==null?void 0:t.getData(s))!=null?l:t[s+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return e}){}class lt extends P([Yt,ge],n=>{n.prototype;class e extends n{}return e}){}class Gt extends P([zt,me],n=>{n.prototype;class e extends n{static get defaultConfig(){return{tree:!0,modelClass:lt}}}return e}){}class Oe extends P([ge],n=>{const e=n.prototype;class r extends n{static get fields(){return[{name:"fromEvent",isEqual:(t,i)=>t===i,persist:!1},{name:"toEvent",isEqual:(t,i)=>t===i,persist:!1}]}setChanged(t,i,o){var l;let u=!1;if(t==="fromEvent"||t==="toEvent"){var c;const f=U(i,H)?i:(c=this.eventStore)===null||c===void 0?void 0:c.getById(i);f&&(u=!0),i=f||i}if(e.setChanged.call(this,t,i,o,!0),u&&!this.project.isPerformingCommit&&!((l=this.dependencyStore)!==null&&l!==void 0&&l.isLoadingData)){var d;(d=this.dependencyStore)===null||d===void 0||d.invalidateIndices()}}joinProject(){e.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){let{fromEvent:t,toEvent:i}=this.$changed;if(t!==null&&!U(t,H)){var o;const u=(o=this.eventStore)===null||o===void 0?void 0:o.getById(t);u&&(this.$changed.fromEvent=u)}if(i!==null&&!U(i,H)){var l;const u=(l=this.eventStore)===null||l===void 0?void 0:l.getById(i);u&&(this.$changed.toEvent=u)}}set fromEvent(t){this.setChanged("fromEvent",t)}get fromEvent(){const t=this.get("fromEvent");return(t==null?void 0:t.id)!=null?t:null}set toEvent(t){this.setChanged("toEvent",t)}get toEvent(){const t=this.get("toEvent");return(t==null?void 0:t.id)!=null?t:null}}return r}){}const Xt=new Set;class ut extends P([Ht,me],n=>{n.prototype;class e extends n{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:Oe,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(s){return this.storage.findItem("toEvent",s)||Xt}getOutgoingDepsForEvent(s){return this.storage.findItem("fromEvent",s)||Xt}set data(s){this.allDependenciesForRemoval=!0,super.data=s,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return e}){}class Qt extends P([H,Ut],n=>{const e=n.prototype;class r extends n{get assigned(){var i;var t;return(i=(t=this.project)===null||t===void 0?void 0:t.assignmentStore.getEventsAssignments(this))!=null?i:this.$cachedAssignments}leaveProject(t=!1){this.$cachedAssignments=this.assigned,super.leaveProject(t)}applyValue(t,i,o,l,u){if(i==="id"){var c;(c=this.assigned)===null||c===void 0||c.forEach(d=>d.set("eventId",o))}e.applyValue.call(this,t,i,o,l,u)}copy(t=null,i=null){const o=e.copy.call(this,t,i);return($.isObject(i)&&!i.skipFieldIdentifiers||!$.isObject(i))&&(o.$cachedAssignments=this.assigned),o}}return r}){}class en extends P([H],n=>{const e=n.prototype;class r extends n{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const t=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(i=>t.dependenciesForRemoval.add(i)),this.incomingDeps&&this.incomingDeps.forEach(i=>t.dependenciesForRemoval.add(i)),e.leaveProject.call(this)}}return r}){}class Fe extends P([H,Qt,en],n=>{n.prototype;class e extends n{}return e}){}class ct extends P([Kt,me],n=>{n.prototype;class e extends n{static get defaultConfig(){return{modelClass:Fe}}joinProject(){var s;(s=this.assignmentStore)===null||s===void 0||s.linkAssignments(this,"event")}afterLoadData(){var s;this.afterEventRemoval(),(s=this.assignmentStore)===null||s===void 0||s.linkAssignments(this,"event")}}return e}){}class dt extends P([Zt,me],n=>{const e=n.prototype;class r extends n{static get defaultConfig(){return{modelClass:fe}}joinProject(){var t;(t=this.assignmentStore)===null||t===void 0||t.linkAssignments(this,"resource")}afterLoadData(){var t;(t=this.assignmentStore)===null||t===void 0||t.linkAssignments(this,"resource")}clear(t){var i;e.clear.call(this,t),(i=this.assignmentStore)===null||i===void 0||i.unlinkAssignments("resource")}}return r}){}class mr extends P([],Rt){}class pr extends P([],Ke){}class tn extends P([mr,pr,_],n=>{const e=n.prototype;class r extends n{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(t={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const i="silenceInitialCommit"in t?t.silenceInitialCommit:!0,o="adjustDurationToDST"in t?t.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in t?t.maxCalendarRange:15768e7,delete t.maxCalendarRange,delete t.silenceInitialCommit,delete t.adjustDurationToDST,e.construct.call(this,t),this.silenceInitialCommit=i,this.adjustDurationToDST=o}repopulateStore(t){}repopulateReplica(){}deferUntilRepopulationIfNeeded(t,i,o){i(...o)}attachStore(t){}detachStore(t){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return r}){}class nn extends P([],Ke){}class rn extends P([tn,we,nn,_],n=>{const e=n.prototype;class r extends n{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Fe,assignmentModelClass:je,resourceModelClass:fe,dependencyModelClass:Oe,calendarModelClass:lt,eventStoreClass:ct,assignmentStoreClass:ot,resourceStoreClass:dt,dependencyStoreClass:ut,calendarManagerStoreClass:Gt,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(t={}){const i=this;if(i.$invalidated=new Set,i.isPerformingCommit=!1,i.silenceInitialCommit=!0,i.ongoing=Promise.resolve(),t.eventStore&&!t.assignmentStore){var o;const m=t.eventStore.masterStore||t.eventStore,D=m.assignmentStore||((o=m.crudManager)===null||o===void 0?void 0:o.assignmentStore);D!=null&&D.isAssignmentStore&&(t.assignmentStore=D,i.isSharingAssignmentStore=!0)}e.construct.call(i,t),i.defaultCalendar=new i.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:i.unspecifiedTimeIsWorking}),i.defaultCalendar.project=i;const{calendarsData:l,eventsData:u,dependenciesData:c,resourcesData:d,assignmentsData:f}=i;!!(l||u||c||d||f)?(i.loadInlineData({calendarsData:l,eventsData:u,dependenciesData:c,resourcesData:d,assignmentsData:f}),delete i.calendarsData,delete i.eventsData,delete i.dependenciesData,delete i.resourcesData,delete i.assignmentsData):i.bufferedCommitAsync()}doDestroy(){var t,i,o,l,u,c;const d=this;(t=d.eventStore)===null||t===void 0||t.destroy(),(i=d.dependencyStore)===null||i===void 0||i.destroy(),(o=d.assignmentStore)===null||o===void 0||o.destroy(),(l=d.resourceStore)===null||l===void 0||l.destroy(),(u=d.calendarManagerStore)===null||u===void 0||u.destroy(),d.defaultCalendar.destroy(),(c=d.stm)===null||c===void 0||c.destroy(),e.doDestroy.call(this)}async loadInlineData(t){const i=this;i.isLoadingInlineData=!0,t.calendarsData&&(i.calendarManagerStore.data=t.calendarsData),t.resourcesData&&(i.resourceStore.data=t.resourcesData),t.assignmentsData&&(i.assignmentStore.data=t.assignmentsData),t.eventsData&&(i.eventStore.data=t.eventsData),t.tasksData&&(i.eventStore.data=t.tasksData),t.dependenciesData&&(i.dependencyStore.data=t.dependenciesData),await i.commitLoad(),i.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(t){const i=o=>{o.setProject(this),o.joinProject()};t.rootNode?t.rootNode.traverse(i):t.forEach(i)}unJoinStoreRecords(t){const i=o=>{o.leaveProject(),o.setProject(this)};t.rootNode?t.rootNode.traverse(o=>{o!==t.rootNode&&i(o)}):t.forEach(i)}resolveStoreAndModelClass(t,i){const o=(i==null?void 0:i.storeClass)||this[`${t}StoreClass`];let l=i==null?void 0:i.modelClass;return l||(this.getDefaultConfiguration()[`${t}ModelClass`]!==o.getDefaultConfiguration().modelClass?l=o.getDefaultConfiguration().modelClass:l=this[`${t}ModelClass`]),{storeClass:o,modelClass:l}}setEventStore(t){this.eventStore=t}changeEventStore(t,i){const o=this,{stm:l}=o;if(o.detachStore(i),t instanceof N)t.project=o,l.addStore(t),o.joinStoreRecords(t);else{const{storeClass:u,modelClass:c}=o.resolveStoreAndModelClass("event",t);t=new u($.assign({modelClass:c,project:o,stm:l},t))}if(i&&l.hasStore(i)){l.removeStore(i),o.unJoinStoreRecords(i);const{assignmentsForRemoval:u}=i;u.forEach(c=>{const d=c.event;if(d){const f=t.getById(d.id);f&&(c.event=f,u.delete(c))}}),i.afterEventRemoval()}return t.setProject(o),t}updateEventStore(t,i){this.attachStore(t),this.trigger("eventStoreChange",{store:t})}setAssignmentStore(t){this.assignmentStore=t}changeAssignmentStore(t,i){const o=this,{stm:l}=o;if(o.detachStore(i),i&&l.hasStore(i)&&(l.removeStore(i),o.unJoinStoreRecords(i)),t instanceof N)t.project=o,l.addStore(t),o.joinStoreRecords(t);else{const{storeClass:u,modelClass:c}=o.resolveStoreAndModelClass("assignment",t);t=new u($.assign({modelClass:c,project:o,stm:l},t))}return t.setProject(o),t}updateAssignmentStore(t,i){this.attachStore(t),this.trigger("assignmentStoreChange",{store:t})}setResourceStore(t){this.resourceStore=t}changeResourceStore(t,i){const o=this,{stm:l}=o;if(o.detachStore(i),t instanceof N)t.project=o,l.addStore(t),o.joinStoreRecords(t);else{const{storeClass:u,modelClass:c}=o.resolveStoreAndModelClass("resource",t);t=new u($.assign({modelClass:c,project:o,stm:l},t))}if(i&&l.hasStore(i)){l.removeStore(i),o.unJoinStoreRecords(i);const{assignmentsForRemoval:u}=i;u.forEach(c=>{const d=c.resource;if(d){const f=t.getById(d.id);f&&(c.resource=f,u.delete(c))}}),i.afterResourceRemoval()}return t.setProject(o),t}updateResourceStore(t,i){this.attachStore(t),this.trigger("resourceStoreChange",{store:t})}setDependencyStore(t){this.dependencyStore=t}changeDependencyStore(t,i){const o=this;if(o.detachStore(i),t instanceof N)t.project=o,o.stm.addStore(t),o.joinStoreRecords(t);else{const{storeClass:l,modelClass:u}=o.resolveStoreAndModelClass("dependency",t);t=new l($.assign({modelClass:u,project:o,stm:o.stm},t))}return t}updateDependencyStore(t,i){this.attachStore(t),this.trigger("dependencyStoreChange",{store:t})}setCalendarManagerStore(t){this.calendarManagerStore=t}changeCalendarManagerStore(t,i){const o=this;if(o.detachStore(i),t instanceof N)o.stm.addStore(t);else{var l,u;const c=((l=t)===null||l===void 0?void 0:l.storeClass)||o.calendarManagerStoreClass,d=((u=t)===null||u===void 0?void 0:u.modelClass)||c.getDefaultConfiguration().modelClass||o.calendarModelClass;t=new c($.assign({modelClass:d,project:o,stm:o.stm},t))}return t.setProject(o),t}updateCalendarManagerStore(t,i){this.attachStore(t),this.trigger("calendarManagerStoreChange",{store:t})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(t){this.$calendar=t}get effectiveCalendar(){return this.calendar}async addEvent(t){return this.eventStore.add(t),this.commitAsync()}async addAssignment(t){return this.assignmentStore.add(t),this.commitAsync()}async addResource(t){return this.resourceStore.add(t),this.commitAsync()}async addDependency(t){return this.dependencyStore.add(t),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const t=this;if(t.isPerformingCommit=!0,t.unScheduleAutoCommit(),await qt(0),!t.isDestroyed){for(const c of t.$invalidated)c.calculateInvalidated();const{isInitialCommit:i,silenceInitialCommit:o}=t,l=i&&o;t.assignmentStore.onCommitAsync(),t.dependencyStore.onCommitAsync(),t.isInitialCommitPerformed=!0,t.hasLoadedDataToCommit=!1,t.isPerformingCommit=!1;const u=[t.assignmentStore,t.dependencyStore,t.eventStore,t.resourceStore,t.calendarManagerStore];if(u.forEach(c=>{var d;return(d=c.suspendAutoCommit)===null||d===void 0?void 0:d.call(c)}),t.isWritingData=!0,t.trigger("refresh",{isInitialCommit:i,isCalculated:!0}),l)for(const c of t.$invalidated)c.finalizeInvalidated(!0);else{for(const c of t.$invalidated)c.beginBatch(!0),c.finalizeInvalidated();for(const c of t.$invalidated)c.endBatch(!1,!0)}return t.isWritingData=!1,t.$invalidated.clear(),t.trigger("dataReady"),u.forEach(c=>{var d;return(d=c.resumeAutoCommit)===null||d===void 0?void 0:d.call(c)}),t.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(t){this.$invalidated.add(t),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(t){t=this.$stm=new zn($.assign({disabled:!0},t)),t.ion({restoringStop:async()=>{t.disable(),await this.commitAsync(),this.isDestroyed||(t.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return r.applyConfigs=!0,r}){}var sn=a=>class extends a{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(e,r,s){const t=[],{storeId:i}=e,o=this.crudLoadValidationMandatoryStores,l={[i]:{}};return r?r.rows||(t.push(`- "${i}" store section should have a "rows" property with an array of the store records.`),l[i].rows=["..."]):o!=null&&o.includes(i)&&(t.push(`- No "${i}" store section found. It should contain the store data.`),l[i].rows=["..."]),t.length&&Object.assign(s,l),t}getLoadResponseWarnings(e){const r=[],s={};return this.skipSuccessProperty||(s.success=!0),this.forEachCrudStore((t,i,o)=>{r.push(...this.getStoreLoadResponseWarnings(o,e==null?void 0:e[i],s))}),r.length&&(r.push(`Please adjust your response to look like this:
`+JSON.stringify(s,null,4).replace(/"\.\.\."/g,"...")),r.push(this.disableValidationNote)),r}validateLoadResponse(e){const r=this.getLoadResponseWarnings(e);r.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+r.join(`
`))}getStoreSyncResponseWarnings(e,r,s,t){const i=[],o=[],l=[],{storeId:u}=e,c={[u]:{}},d=e.phantomIdField||this.phantomIdField,{modelClass:f}=e.store,{idField:p}=f,m=(s==null?void 0:s.rows)||[],D=(s==null?void 0:s.removed)||[];let R=!1;if(r!=null&&r.added&&(o.push(...r.added.filter(I=>!m.find(S=>S[d]==I[d])&&!D.find(S=>S[d]==I[d]||S[p]==I[d])).map(I=>({[d]:I[d],[p]:"..."}))),o.length)){const I=o.map(S=>"#"+S[d]).join(", ");i.push(`- "${u}" store "rows" section should mention added record(s) ${I} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!o.length&&s&&((typeof s!="object"||Array.isArray(s))&&(i.push(`- "${u}" store section should be an Object.`),c[u]["..."]="..."),s.rows&&!Array.isArray(s.rows)&&(i.push(`- "${u}" store "rows" section should be an array`),o.push("...")),s.removed&&!Array.isArray(s.removed)&&(i.push(`- "${u}" store "removed" section should be an array:`),l.push("...")));else{if(r!=null&&r.updated){const I=r.updated.filter(S=>!m.find(C=>C[p]==S[p])).map(S=>({[p]:S[p]}));if(o.push(...I),I.length){const S=I.map(C=>"#"+C[p]).join(", ");i.push(`- "${u}" store "rows" section should mention updated record(s) ${S} sent in the request. It should contain the updated record identifiers.`),R=!0}}if(o.length&&o.push("..."),r!=null&&r.removed&&(l.push(...r.removed.filter(I=>!m.find(S=>S[p]==I[p])).map(I=>({[p]:I[p]}))),l.length)){const I=l.map(S=>"#"+S[p]).join(", ");i.push(`- "${u}" store "removed" section should mention removed record(s) ${I} sent in the request. It should contain the removed record identifiers.`),c[u].removed=l,l.push("..."),R=!0}}return o.length&&(c[u].rows=o),i.length||delete c[u],Object.assign(t,c),{messages:i,showSupportShortSyncResponseNote:R}}getSyncResponseWarnings(e,r){const s=[],t={},i=r.pack;this.skipSuccessProperty||(t.success=!0);let o=!1;return this.forEachCrudStore((l,u,c)=>{const d=this.getStoreSyncResponseWarnings(c,i==null?void 0:i[u],e[u],t);o=o||d.showSupportShortSyncResponseNote,s.push(...d.messages)}),s.length&&(s.push(`Please adjust your response to look like this:
`+JSON.stringify(t,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&s.push(this.supportShortSyncResponseNote),s.push(this.disableValidationNote)),s}validateSyncResponse(e,r){const s=this.getSyncResponseWarnings(e,r);s.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+s.join(`
`))}};class vr extends Error{}class an extends vr{constructor(n={}){var e,r;super(n.message||n.request&&G.capitalize((e=n.request)===null||e===void 0?void 0:e.type)+" failed"||"Crud Manager request failed"),Object.assign(this,n),this.action=(r=this.request)===null||r===void 0?void 0:r.type}}const on=function(a,n,e){return a.store&&(a=a.store),n.store&&(n=n.store),a=a[e]||0,n=n[e]||0,a<n?-1:a>n?1:0},yr=function(a,n){return on(a,n,"loadPriority")},Sr=function(a,n){return on(a,n,"syncPriority")};var ln=a=>{var e;a.$$meta=a.$meta;const n=[];return a.isEvents||n.push(Rt),a.isDelayable||n.push(Ke),n.push(sn),e=class extends(a||B).mixin(...n){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(s={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(s)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var s,t;return(s=this.transport)===null||s===void 0||(t=s.load)===null||t===void 0?void 0:t.url}updateLoadUrl(s){$.setPath(this,"transport.load.url",s)}get syncUrl(){var s,t;return(s=this.transport)===null||s===void 0||(t=s.sync)===null||t===void 0?void 0:t.url}updateSyncUrl(s){$.setPath(this,"transport.sync.url",s)}getStoreDescriptor(s){return s?s instanceof N?this.crudStores.find(t=>t.store===s):typeof s=="object"?this.crudStoresIndex[s.storeId]:this.crudStoresIndex[s]||this.getStoreDescriptor(N.getStore(s)):null}fillStoreDescriptor(s){const{store:t}=s,{storeIdProperty:i=this.storeIdProperty,modelClass:o}=t;return s.storeId||(s.storeId=t[i]||t.id),s.idField||(s.idField=o.idField),s.phantomIdField||(s.phantomIdField=o.phantomIdField),s.phantomParentIdField||(s.phantomParentIdField=o.phantomParentIdField),"writeAllFields"in s||(s.writeAllFields=t.writeAllFields),s}updateCrudStoreIndex(){const s=this.crudStoresIndex={};this.crudStores.forEach(t=>t.storeId&&(s[t.storeId]=t))}getCrudStore(s){const t=this.getStoreDescriptor(s);return t==null?void 0:t.store}forEachCrudStore(s,t=this){if(!s)throw new Error("Iterator function must be provided");this.crudStores.every(i=>s.call(t,i.store,i.storeId,i)!==!1)}set crudStores(s){this._crudStores=[],this.addCrudStore(s);for(const t of this._crudStores)t.loadPriority=t.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(s){return this._orderedCrudStores=s}set syncApplySequence(s){this._syncApplySequence=[],this.addStoreToApplySequence(s)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(s){const t=this;let i;return s instanceof N?i={store:s}:typeof s=="object"?(s.store||(s={storeId:s.id,store:new N(s)}),i=s):i={store:N.getStore(s)},t.fillStoreDescriptor(i),s=i.store,s.setCrudManager?s.setCrudManager(t):s.crudManager=t,s.pageSize=null,(t.loadUrl||t.syncUrl)&&(s.autoCommit=!1,s.autoLoad=!1,(s.createUrl||s.updateUrl||s.deleteUrl||s.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),t.bindCrudStoreListeners(s),i}addCrudStore(s,t,i){var o;if(s=V.asArray(s),!((o=s)!==null&&o!==void 0&&o.length))return;const l=this,u=s.map(l.internalAddCrudStore,l);typeof t=="undefined"?l.crudStores.push(...u):(i&&((i instanceof N||typeof i!="object")&&(i=l.getStoreDescriptor(i)),t+=l.crudStores.indexOf(i)),l.crudStores.splice(t,0,...u)),l.orderedCrudStores.push(...u),l.updateCrudStoreIndex()}addPrioritizedStore(s){const t=this;t.hasCrudStore(s)||t.addCrudStore(s,V.findInsertionIndex(s,t.crudStores,yr)),t.hasApplySequenceStore(s)||t.addStoreToApplySequence(s,V.findInsertionIndex(s,t.syncApplySequence,Sr))}hasCrudStore(s){var t;return(t=this.crudStores)===null||t===void 0?void 0:t.some(i=>i===s||i.store===s||i.storeId===s)}removeCrudStore(s){const t=this,i=t.crudStores,o=i.find(l=>l===s||l.store===s||l.storeId===s);if(o)t.unbindCrudStoreListeners(o.store),delete t.crudStoresIndex[o.storeId],V.remove(i,o),t.syncApplySequence&&t.removeStoreFromApplySequence(s);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(s){s.ion({name:s.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(s){this.detachListeners(s.id)}addStoreToApplySequence(s,t,i){if(!s)return;s=V.asArray(s);const o=this,l=s.reduce((c,d)=>{const f=o.getStoreDescriptor(d);return f&&c.push(f),c},[]);if(typeof t=="undefined")o.syncApplySequence.push(...l);else{let c=t;i&&((i instanceof N||typeof i!="object")&&(i=o.getStoreDescriptor(i)),c+=o.syncApplySequence.indexOf(i)),o.syncApplySequence.splice(c,0,...l)}const u=o.syncApplySequence.map(({storeId:c})=>c);o.orderedCrudStores=[...o.syncApplySequence],o.crudStores.forEach(c=>{u.includes(c.storeId)||o.orderedCrudStores.push(c)})}removeStoreFromApplySequence(s){const t=this.syncApplySequence.findIndex(i=>i===s||i.store===s||i.storeId===s);t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(s){return this.syncApplySequence.some(t=>t===s||t.store===s||t.storeId===s)}onCrudStoreDestroy({source:s}){this.removeCrudStore(s)}onCrudStoreChange(s){const t=this;t.crudIgnoreUpdates||(t.crudStoreHasChanges(s==null?void 0:s.source)?(t.trigger("hasChanges"),t.autoSync&&t.scheduleAutoSync()):t.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(s=!0){const t=this;t.autoSyncSuspendCounter--,t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,s&&t.autoSync&&t.crudStoreHasChanges()&&t.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const s=this;!s.hasTimeout("autoSync")&&!s.isAutoSyncSuspended&&s.setTimeout({name:"autoSync",fn:()=>{s.sync().catch(t=>{})},delay:s.autoSyncTimeout})}async triggerFailedRequestEvents(s,t,i,o){const{options:l,type:u}=s;this.trigger("requestFail",{requestType:u,response:t,responseText:i,responseOptions:o}),this.trigger(u+"Fail",{response:t,responseOptions:o,responseText:i,options:l})}async internalOnResponse(s,t,i){const o=this,l=t?o.decode(t):null,{options:u,type:c}=s;if(t&&!l&&console.error("Failed to parse response: "+t),!l||(o.skipSuccessProperty?l.success===!1:!l.success))o.triggerFailedRequestEvents(s,l,t,i);else if(o.trigger("beforeResponseApply",{requestType:c,response:l})!==!1&&o.trigger(`before${G.capitalize(c)}Apply`,{response:l,options:u})!==!1){if(o.crudRevision=l.revision,await o.applyResponse(s,l,u),o.isDestroyed)return;o.trigger("requestDone",{requestType:c,response:l,responseOptions:i}),o.trigger(c,{response:l,responseOptions:i,options:u}),(c==="load"||!o.crudStoreHasChanges())&&(o.trigger("noChanges"),c==="load"&&o.emitCrudStoreEvents(s.pack.stores,"afterRequest"))}return l}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(s){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!s&&this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(s){return s?this.isCrudStoreDirty(this.getCrudStore(s)):this.crudStores.some(t=>this.isCrudStoreDirty(t.store))}isCrudStoreDirty(s){return!!s.changes}doAutoLoad(){return this.load().catch(s=>{})}emitCrudStoreEvents(s,t,i){const o={action:"read"+t,...i};for(const l of this.crudStores)s.includes(l.storeId)&&l.store.trigger(t,o)}getLoadPackage(s){const t={type:"load",requestId:this.requestId},i=this.crudStores,o=Object.assign({},s);return delete o.request,t.stores=i.map(l=>{var u;const c=o==null?void 0:o[l.storeId],d=l.pageSize||((u=l.store)===null||u===void 0?void 0:u.pageSize);if(c||d){const f=Object.assign({storeId:l.storeId,page:1},c);return d&&(f.pageSize=d),l.currentPage=f.page,c&&delete o[l.storeId],f}return l.storeId}),Object.assign(t,o),t}loadCrudStore(s,t,i){const o=t==null?void 0:t.rows;i!=null&&i.append||t!=null&&t.append?s.add(o):s.data=o,s.trigger("load",{data:o})}loadDataToCrudStore(s,t,i){const o=s.store,l=t==null?void 0:t.rows;o.__loading=!0,l&&this.loadCrudStore(o,t,i,s),o.__loading=!1}loadCrudManagerData(s,t={}){this.suspendChangesTracking(),this.crudStores.forEach(i=>{const o=i.storeId,l=s[o];l&&this.loadDataToCrudStore(i,l,t[o])}),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(s){typeof s=="string"&&(s={request:{url:s}});const t=this,i=t.getLoadPackage(s);return t._autoLoadPromise=null,new Promise((o,l)=>{if(t.trigger("beforeLoad",{pack:i})!==!1){var u;const{load:c}=t.activeRequests;c&&(t.cancelRequest(c.desc,c.reject),t.trigger("loadCanceled",{pack:i}));const d=re.assign({id:i.requestId,data:t.encode(i),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},(u=s)===null||u===void 0?void 0:u.request);t.activeRequests.load={type:"load",options:s,pack:i,resolve:o,reject(...f){d.success=d.failure=null,l(...f)},id:i.requestId,desc:t.sendRequest(d)},t.emitCrudStoreEvents(i.stores,"loadStart"),t.trigger("loadStart",{pack:i})}else t.trigger("loadCanceled",{pack:i}),l({cancelled:!0})})}getActiveCrudManagerRequest(s){let t=this.activeRequests[s];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}prepareAddedRecordData(s,t){const i=this,{store:o}=t,{isTree:l}=o,u=t.phantomIdField||i.phantomIdField,c=t.phantomParentIdField||i.phantomParentIdField,d=o.modelClass.allFields.filter(m=>m.subStore),f=s.constructor,p=Object.assign(s.persistableData,{[u]:s.id});if(l){const{parent:m}=s;m&&!m.isRoot&&m.isPhantom&&(p[c]=m.id)}return i.resetIdsBeforeSync&&$.deletePath(p,f.idField),d.forEach(m=>{const D=s.get(m.name);D.allCount&&(p[m.dataSource]={added:D.getRange().map(R=>i.prepareAddedRecordData(R,{store:D}))})}),p}prepareAdded(s,t){return s.filter(i=>i.isValid).map(i=>this.prepareAddedRecordData(i,t))}prepareUpdated(s,t){const{store:i}=t,{isTree:o}=i,l=t.writeAllFields||t.writeAllFields!==!1&&this.writeAllFields,u=t.phantomParentIdField||this.phantomParentIdField,c=i.modelClass.allFields.filter(d=>d.subStore);if(t.store.tree){const d=t.store.rootNode;s=s.filter(f=>f!==d)}return s.filter(d=>d.isValid).reduce((d,f)=>{let p;if(l?p=f.persistableData:p=f.modificationDataToWrite,o){const{parent:m}=f;m&&!m.isRoot&&m.isPhantom&&(p[u]=m.id)}return c.forEach(m=>{const D=f.get(m.name);p[m.dataSource]=this.getCrudStoreChanges({store:D})}),$.isEmpty(p)||d.push(p),d},[])}prepareRemoved(s){return s.map(t=>{const i=t.constructor;return $.setPath({},i.idField,t.id)})}getCrudStoreChanges(s){const{store:t}=s;let{added:i=[],modified:o=[],removed:l=[]}=t.changes||{},u;return i.length&&(i=this.prepareAdded(i,s)),o.length&&(o=this.prepareUpdated(o,s)),l.length&&(l=this.prepareRemoved(l)),(i.length||o.length||l.length)&&(u={},i.length&&(u.added=i),o.length&&(u.updated=o),l.length&&(u.removed=l)),u}getChangesetPackage(){const{changes:s}=this;return s||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...s}:null}get changes(){const s={};return this.crudStores.forEach(t=>{const i=this.getCrudStoreChanges(t);i&&(s[t.storeId]=i)}),Object.keys(s).length>0?s:null}getRowsToApplyChangesTo({store:s,storeId:t},i,o){var l,u;const c=this,{modelClass:d}=s,f=d.idField,{updated:p,removed:m}=o||{};let D,R,I;if(i){var S,C;I=!0;const M={};D=((S=i.rows)===null||S===void 0?void 0:S.slice())||[],R=((C=i.removed)===null||C===void 0?void 0:C.slice())||[],[...D,...R].forEach(h=>{const g=$.getPath(h,f);M[g]=!0}),c.supportShortSyncResponse&&(p==null||p.forEach(h=>{const g=$.getPath(h,f);M[g]||D.push({[f]:g})}),m==null||m.forEach(h=>{const g=$.getPath(h,f);M[g]||R.push({[f]:g})}))}else(p||m)&&(I=!1,D=p,R=m);return D=(l=D)!==null&&l!==void 0&&l.length?D:null,R=(u=R)!==null&&u!==void 0&&u.length?R:null,{rows:D,removed:R,remote:I}}applyChangesToStore(s,t,i){var C;const o=this,l=s.phantomIdField||o.phantomIdField,{store:u}=s,c=u.modelClass.getFieldDataSource("id"),d=u.modelClass.allFields.filter(M=>M.subStore),{rows:f,removed:p,remote:m}=o.getRowsToApplyChangesTo(s,t,i),D=[],R=[];if(f)for(const M of f)u.getById((C=M[l])!=null?C:M[c])?R.push(M):D.push(M);const I=[];R.length&&d.length&&R.forEach(M=>{var T;var h,g;const v=u.getById((T=M[l])!=null?T:M[c]),y=((h=i.added)===null||h===void 0?void 0:h.find(b=>b[l]==M[l]))||((g=i.updated)===null||g===void 0?void 0:g.find(b=>b[c]==M[c])),E={};d.forEach(b=>{const w=v.get(b.name);o.applyChangesToStore({store:w},M[b.dataSource],y==null?void 0:y[b.dataSource]),E[b.dataSource]="foo",delete M[b.dataSource]}),I.push([v,E])});const S=u.applyChangeset({removed:p,added:D,updated:R},null,l,m,!0);return I.forEach(([M,h])=>Object.assign(S.get(M.id),h)),S}applySyncResponse(s,t){const i=this,o=i.orderedCrudStores;i.applyingChangeset=i.applyingSyncResponse=!0,i.suspendChangesTracking();for(const u of o){var l;i.applyChangesToStore(u,s[u.storeId],t==null||(l=t.pack)===null||l===void 0?void 0:l[u.storeId])}i.resumeChangesTracking(!0),i.applyingChangeset=i.applyingSyncResponse=!1}applyLoadResponse(s,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(s,t),this.applyingLoadResponse=!1}async applyResponse(s,t,i){const o=this;switch(o.trackResponseType&&t.type||s.type){case"load":o.validateResponse&&o.validateLoadResponse(t),o.applyLoadResponse(t,i);break;case"sync":o.validateResponse&&o.validateSyncResponse(t,s),o.applySyncResponse(t,s);break}}applyChangeset(s,t=null,i,o=!1){const l=this,u=o?new Map:void 0;l.suspendAutoSync(),l.suspendChangesTracking();for(const{store:c,phantomIdField:d}of l.orderedCrudStores)if(s[c.id]){const f=c.applyChangeset(s[c.id],t,d||l.phantomIdField,!0,o);f&&u.set(c.id,f)}return l.resumeChangesTracking(!0),l.resumeAutoSync(!1),u}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const s=this;return s.clearTimeout("autoSync"),s.activeRequests.sync?(s.trigger("syncDelayed"),s.activeSyncPromise=s.activeSyncPromise.finally(()=>s.sync())):s.activeSyncPromise=new Promise((t,i)=>{const o=s.getChangesetPackage();if(!o){t(null);return}s.trigger("beforeSync",{pack:o})!==!1?(s.trigger("syncStart",{pack:o}),s.activeRequests.sync={type:"sync",pack:o,resolve:t,reject:i,id:o.requestId,desc:s.sendRequest({id:o.requestId,data:s.encode(o),type:"sync",success:s.onCrudRequestSuccess,failure:s.onCrudRequestFailure,thisObj:s})}):(s.trigger("syncCanceled",{pack:o}),i({cancelled:!0}))}).catch(t=>{if(t&&!t.cancelled)throw t;return t})}async onCrudRequestSuccess(s,t,i){var o;const l=this,{type:u,id:c}=i;if(l.isDestroyed)return;let d="";i=l.activeRequests[u];try{d=await s.text()}catch(p){}if(l.isDestroyed)return;if(((o=i)===null||o===void 0?void 0:o.id)!==c)throw new Error(`Interleaved ${u} operation detected`);l.activeRequests[u]=null;const f=await l.internalOnResponse(i,d,t);if(!l.isDestroyed){if(!f||(l.skipSuccessProperty?(f==null?void 0:f.success)===!1:!(f!=null&&f.success))){const p={rawResponse:s,response:f,request:i};f!=null&&f.message&&(p.message=f.message),i.reject(new an(p))}l["crud"+G.capitalize(i.type)+"ed"]=!0,i.resolve({response:f,rawResponse:s,responseText:d,request:i})}}async onCrudRequestFailure(s,t,i){var o;const l=this;if(l.isDestroyed)return;i=l.activeRequests[i.type];const u=t==null||(o=t.abortController)===null||o===void 0?void 0:o.signal;if(!!!(u!=null&&u.aborted)){let d,f="";try{f=await s.text(),d=l.decode(f)}catch(p){}if(l.isDestroyed||(l.triggerFailedRequestEvents(i,d,f,t),l.isDestroyed))return;i.reject(new an({rawResponse:s,request:i}))}l.activeRequests[i.type]=null}acceptChanges(){this.crudStores.forEach(s=>s.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:s}=this.eventStore;this.orderedCrudStores.forEach(({store:t})=>(!t.isAssignmentStore||!s)&&t.revertChanges())}doDestroy(){const s=this,{load:t,sync:i}=s.activeRequests;for(t&&s.cancelRequest(t.desc,t.reject),i&&s.cancelRequest(i.desc,i.reject);s.crudStores.length>0;)s.removeCrudStore(s.crudStores[0]);super.doDestroy&&super.doDestroy()}},F(e,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),F(e,"delayable",{doAutoLoad:"raf"}),e},un=a=>class $n extends(a||B){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,r){var s;(s=e.abort)===null||s===void 0||s.call(e),this.isDestroying||r({cancelled:!0})}shouldUseBodyForRequestData(e,r,s){return!(r==="HEAD"||r==="GET")&&!s}sendRequest(e){const r=this,{data:s}=e,t=r.transport[e.type]||{},i=re.assign({},t,t.requestConfig);e.url&&(i.url=e.url),i.method=i.method||$n.defaultMethod[e.type],i.params=re.assign(i.params||{},e.params);let{paramName:o}=i;if(r.shouldUseBodyForRequestData(t,i.method,o)?(i.body=s,i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"):(o=o||"data",i.params[o]=s),!i.url)throw new Error("Trying to request without URL specified");delete i.requestConfig,delete i.paramName;let l,u;function c(){i.queryParams=i.params,delete i.params;let f=!1;const p=re.assign({},i,i.fetchOptions);return l=Yn.fetch(i.url,p),l.catch(m=>{var D,R;l.done=!0,(D=r.trigger)===null||D===void 0||D.call(r,"responseReceived",{success:!1});const I=(R=p.abortController)===null||R===void 0?void 0:R.signal;return I&&(f=I.aborted,f||console.warn(m)),{error:m,cancelled:f}}).then(m=>{var D;l.done=!0,(D=r.trigger)===null||D===void 0||D.call(r,"responseReceived",{success:!!(m!=null&&m.ok)});const R=m!=null&&m.ok?e.success:e.failure;return R==null?void 0:R.call(e.thisObj||r,m,p,e)})}const d=r.trigger("beforeSend",{params:i.params,requestType:e.type,requestConfig:i,config:e});return re.isPromise(d)?u=d.then(c):u=c(),u.abort=()=>{if(!l.done){var f,p;(f=(p=l).abort)===null||f===void 0||f.call(p)}},u}},cn=a=>class extends(a||B){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(e){var r;return e=Object.assign({},(r=this.encoder)===null||r===void 0?void 0:r.requestData,e),G.safeJsonStringify(e)}decode(e){return G.safeJsonParse(e)}},Dr=a=>{var n;return n=class extends a.mixin(Un){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:r,project:s}=this;this.loadMask&&(r||s).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:r}=this;r&&(this.masked=qn.mergeConfigs(this.loadMaskDefaults,r))}bindCrudManager(r){this.detachListeners("crudManager"),r==null||r.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",thisObj:this})}onCrudManagerBeforeSend({params:r}){var s;(s=this.applyStartEndParameters)===null||s===void 0||s.call(this,r)}onCrudManagerLoadStart(){var r;this.applyLoadMask(),(r=this.toggleEmptyText)===null||r===void 0||r.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){var r;(r=this.suspendRefresh)===null||r===void 0||r.call(this)}onCrudManagerApplyResponse(){var r;(r=this.resumeRefresh)===null||r===void 0||r.call(this,!0)}onCrudManagerRequestFinalize(r=!0,s,t){const i=this;if(r){var o;(o=i.toggleEmptyText)===null||o===void 0||o.call(i)}else i.masked||i.applyLoadMask(),i.applyMaskError(`<div class="b-grid-load-failure">
                    <div class="b-grid-load-fail">${i.L(`L{GridBase.${s}FailedMessage}`)}</div>
                    ${t&&t.message?`<div class="b-grid-load-fail">${i.L("L{CrudManagerView.serverResponseLabel}")} ${t.message}</div>`:""}
                </div>`)}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:r,response:s}){this.onCrudManagerRequestFinalize(!1,r,s)}onAjaxTransportResponseReceived(){const r=this;r.clearMaskDelay!=null?r.setTimeout(()=>r.masked=null,r.clearMaskDelay):r.masked=null}get widgetClass(){}},F(n,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),n},K=a=>class extends(a||B){static get $name(){return"PartOfProject"}},dn=a=>class extends a{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...r){e=e||{};const{fieldMap:s}=this,t=s.eventId.dataSource,i=s.resourceId.dataSource,o=s.event.dataSource,l=s.resource.dataSource,u=e[t],c=e[i],d=e[o],f=e[l];u!=null?e[o]=u:d!=null&&(e[t]=d.isModel?d.id:d),c!=null?e[l]=c:f!=null&&(e[i]=f.isModel?f.id:f),super.construct(e,...r)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(e,r){let s,t;return e?s=e.isModel?e.id:e:s=this.internalId,r?t=r.isModel?r.id:r:t=this.internalId,`${s}-${t}`}buildIndexKey({event:e,resource:r}){return this.buildEventResourceKey(e,r)}set(e,r,...s){const t=this.fieldToKeys(e,r);if("resource"in t){var i;((i=t.resource)===null||i===void 0?void 0:i.id)!==void 0&&(t.resourceId=t.resource.id)}else"resourceId"in t&&this.constructor.isProAssignmentModel&&(t.resource=t.resourceId);if("event"in t){var o;((o=t.event)===null||o===void 0?void 0:o.id)!==void 0&&(t.eventId=t.event.id)}else"eventId"in t&&this.constructor.isProAssignmentModel&&(t.event=t.eventId);return super.set(t,null,...s)}afterChange(e,r,s,t,i){var o,l;const u=this;return!u.constructor.isProAssignmentModel&&r!==null&&r!==void 0&&r.resourceId&&((o=u.resource)===null||o===void 0?void 0:o.id)!==r.resourceId.value?u.resource=r.resourceId.value:u.constructor.isProAssignmentModel&&(l=u.project)!==null&&l!==void 0&&l.propagatingSyncChanges&&r!==null&&r!==void 0&&r.eventId&&!(r!=null&&r.event)&&(e.event.value===r.eventId.value||e.event.value.id===r.eventId.value)&&(delete r.eventId,delete u.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(e){const{resource:r}=this;r!=null&&r.isModel&&r.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var r;var e;return(r=(e=this.resource)===null||e===void 0?void 0:e.id)!=null?r:this.get("resourceId")}set eventId(e){const{event:r}=this;r!=null&&r.isModel&&r.id===e?this.set("eventId",e):this.event=e}get eventId(){var r;var e;return(r=(e=this.event)===null||e===void 0?void 0:e.id)!=null?r:this.get("eventId")}get eventName(){var e;return(e=this.event)===null||e===void 0?void 0:e.name}get resourceName(){var e;return(e=this.resource)===null||e===void 0?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var e;const{event:r,resource:s,unjoinedStores:t,assignmentStore:i}=this,o=i==null?void 0:i.crudManager;let l;return i?l=this.isValid&&r.isPersistable&&(o||!r.hasGeneratedId&&!s.hasGeneratedId):l=!this.isPhantom&&!!t[0],l&&super.isPersistable&&!((e=this.event)!==null&&e!==void 0&&e.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(e,r,s){if(!super.shouldRecordFieldChange(e,r,s))return!1;if(e==="event"||e==="eventId"){var t;const o=(t=this.project)===null||t===void 0?void 0:t.eventStore;if(o&&o.oldIdMap[r]===o.getById(s))return!1}if(e==="resource"||e==="resourceId"){var i;const o=(i=this.project)===null||i===void 0?void 0:i.resourceStore;if(o&&o.oldIdMap[r]===o.getById(s))return!1}return!0}};const Cr=je;class Ce extends dn(K(Cr.derive(_))){static get $name(){return"AssignmentModel"}}Ce.exposeProperties(),Ce._$name="AssignmentModel";var hn=a=>class extends a{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(e,...r){e=V.asArray(e);for(let t=0;t<e.length;t++){var s;let i=e[t];if(i instanceof _||(e[t]=i=this.createRecord(i)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",i.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${i.eventId} to resource: ${i.resourceId}`);(s=i.event)!==null&&s!==void 0&&s.isCreating&&(i.isCreating=!0)}return super.add(e,...r)}includesAssignment(e,r){return this.storage.findIndex("eventResourceKey",`${e}-${r}`,!0)!==-1}setStoreData(e){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(e)}set storage(e){super.storage=e,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(e,r){if(!e||!(r!=null&&r.isOccurrence))return e;const s=this;return{id:`${r.id}:a${e.id}`,event:r,resource:e.resource,eventId:r.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(t){return s.occurrenceInstanceMeta(this,t)}}}occurrenceInstanceMeta(e,r){const s=this,t=r.id||r,{id:i}=e;let{occurrenceMeta:o}=s;return o||(o=s.occurrenceMeta={}),o[i]||(o[i]={}),o[i][t]||(o[i][t]={})}mapAssignmentsForEvent(e,r,s){e=this.eventStore.getById(e);const t=!!r,i=!!s;return t||i?e.assignments.reduce((o,l)=>{const u=t?r(l):l;return(!i||s(u))&&o.push(u),o},[]):e.assignments}mapAssignmentsForResource(e,r,s){e=this.resourceStore.getById(e);const t=!!r,i=!!s;return t||i?e.assignments.reduce((o,l)=>{const u=t?r(l):l;return(!i||s(u))&&o.push(u),o},[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return e=this.resourceStore.getById(e),e.assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){var r;return e=this.resourceStore.getById(e),(r=e)===null||r===void 0?void 0:r.events}assignEventToResource(e,r,s=null,t=!1){var i;const o=this,l=t?new Set(e.assignments):null;if(r=V.asArray(r).map(d=>{var f;return(f=d.$original)!=null?f:d}),(i=o.eventStore)!==null&&i!==void 0&&i.usesSingleAssignment){var u;if((u=e.assignments)!==null&&u!==void 0&&u.length)return o.isEventAssignedToResource(e,r[0])||(e.resource=r[0]),[];e.resourceId=r[0].id}let c=[];return o.suspendAutoCommit(),r.forEach(d=>{var p;const f=o.getAssignmentForEventAndResource(e,d);if(f)t&&l.delete(f);else{const m={event:e,resource:d};c.push((p=s==null?void 0:s(m))!=null?p:m)}}),c=o.add(c),t&&o.remove(Array.from(l)),o.resumeAutoCommit(),c}unassignEventFromResource(e,r){const s=this,t=[];if(!r)return s.removeAssignmentsForEvent(e);r=V.asArray(r);for(let i=0;i<r.length;i++)s.isEventAssignedToResource(e,r[i])&&t.push(s.getAssignmentForEventAndResource(e,r[i]));return s.remove(t)}isEventAssignedToResource(e,r){return!!this.getAssignmentForEventAndResource(e,r)}getAssignmentForEventAndResource(e,r){let s;return!(e=this.eventStore.getById(e))||!(s=e.assignments)||!(r=this.resourceStore.$master.getById(r))?null:this.getOccurrence(s.find(t=>{var i;return((i=t.resource)===null||i===void 0?void 0:i.$original)===r.$original}),e)}};const Rr=K(ot.derive(ue));class ke extends hn(Rr){static get defaultConfig(){return{modelClass:Ce}}}F(ke,"$name","AssignmentStore"),ke._$name="AssignmentStore";var gn=a=>class extends(a||B){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:r,value:s}){super.onRecordIdChange({record:e,oldValue:r,value:s}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:e,endDate:r}){return this.query(s=>this.eventStore.isDateRangeAvailable(e,r,null,s))}},fn=a=>class extends a{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(e=>{e.resourceId=this.id})}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((e,r)=>(r.event&&e.push(r.event),e),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){e.forEach(r=>{r.resource=this})}getEvents(){return ce.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:e=""}=this;if(!e)return"";const r=e.split(" "),s=r[0][0],t=r.length>1?r[r.length-1][0]:"";return s+t}isWorkingTime(e){var r,s;const t=this.effectiveCalendar||((r=this.project)===null||r===void 0?void 0:r.calendar);return!t||((s=t.isWorkingTime)===null||s===void 0?void 0:s.call(t,e))}};const Er=fe;class pe extends fn(K(Er.derive(Hn))){}F(pe,"$name","ResourceModel"),pe.exposeProperties(),pe._$name="ResourceModel";const xr=K(dt.derive(ue));class ht extends gn(xr){static get defaultConfig(){return{modelClass:pe}}}ht._$name="ResourceStore";var mn=a=>class extends(a||B){static get $name(){return"EventStoreMixin"}construct(e){super.construct(e),this.autoTree=!0}set filtersFunction(e){super.filtersFunction=e}get filtersFunction(){const e=super.filtersFunction;return e&&e!==Et.returnTrue?r=>r.isCreating||e(r):e}getEventCounts(e){const r=this,{filtersFunction:s,added:t}=r,i=r.getEvents({...e,storeFilterFn:r.isFiltered?r.reapplyFilterOnAdd?s:o=>t.includes(o)?r.indexOf(o)>-1:s(o):null,dateMap:e.dateMap||!0});return i.forEach((o,l)=>i.set(l,o.length)),i}forEachScheduledEvent(e,r=this){this.forEach(s=>{const{startDate:t,endDate:i}=s;if(t&&i)return e.call(r,s,t,i)})}getTotalTimeSpan(){let e=new Date(9999,0,1),r=new Date(0);return this.forEach(s=>{s.startDate&&(e=x.min(s.startDate,e)),s.endDate&&(r=x.max(s.endDate,r))}),e=e<new Date(9999,0,1)?e:null,r=r>new Date(0)?r:null,this.lastTotalTimeSpan={startDate:e||null,endDate:r||e||null}}isEventPersistable(e){return e.isPersistable}isDateRangeAvailable(e,r,s,t){if(t.data.generatedParent)return!1;const i=new Set(this.getEventsForResource(t));if(s!=null&&s.isAssignment&&s.event.resources.forEach(u=>{u.id!==s.resourceId&&this.getEventsForResource(u).forEach(c=>i.add(c))}),s){const o=s.isAssignment?s.event:s;i.delete(o)}return!Array.from(i).some(o=>o.isScheduled&&x.intersectSpans(e,r,o.startDate,o.endDate))}filterEventsForResource(e,r,s=this){return e.getEvents(this).filter(r.bind(s))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,r,s=!1){return this.assignmentStore.assignEventToResource(e,r,void 0,s)}unassignEventFromResource(e,r){this.assignmentStore.unassignEventFromResource(e,r)}reassignEventFromResourceToResource(e,r,s){const t=this,i=_.asId(s),o=t.assignmentStore.getAssignmentForEventAndResource(e,r);o?o.resourceId=i:t.assignmentStore.assignEventToResource(e,s)}isEventAssignedToResource(e,r){return this.assignmentStore.isEventAssignedToResource(e,r)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}};const Ir=()=>!0,Mr=a=>!a.isRecurring;var pn=a=>{var n;return n=class extends a{getEvents({filter:r,date:s,startDate:t,endDate:i,startOnly:o,includeOccurrences:l,allowPartial:u,onlyAssigned:c=!1,dateMap:d=!1,dayTime:f=null,getDateIndex:p}){const m=this,D=arguments[0],{lastDateRange:R,added:I,filtersFunction:S}=m,C=r;if(c&&(D.filter=C?h=>C(h)&&h.resources.length:h=>h.resources.length),"startDate"in D||(t=D.startDate=s),"includeOccurrences"in D||(l=D.includeOccurrences=!0),"allowPartial"in D||(u=D.allowPartial=!o),D.storeFilterFn=m.isFiltered&&!D.ignoreFilters?m.reapplyFilterOnAdd?S:h=>I.includes(h)?m.indexOf(h)>-1:S(h):null,!i)if(t)i=D.endDate=x.clearTime(t),i.setDate(i.getDate()+1);else{if(l)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");D.dateFilter=Ir}D.dateFilter||(o?D.dateFilter=h=>{const g=h.hasBatchedChange("startDate")?h.get("startDate"):h.startDate;return g&&!(x.clearTime(g)-t)}:u?D.dateFilter=h=>{const g=h.hasBatchedChange("startDate")?h.get("startDate"):h.startDate,v=h.hasBatchedChange("endDate")?h.get("endDate"):h.endDate||g,y=!(g-v);return g&&(y?x.betweenLesserEqual(g,t,i):x.intersectSpans(g,v,t,i))}:D.dateFilter=h=>{const g=h.hasBatchedChange("startDate")?h.get("startDate"):h.startDate,v=h.hasBatchedChange("endDate")?h.get("endDate"):h.endDate||g;return g&&g>=t&&v<=i});const M={startDate:t,endDate:i};return m.processConfiguredListeners(),m.trigger("loadDateRange",{old:R||{},new:re.clone(M),changed:!!(!R||R.startDate-M.startDate||R.endDate-M.endDate)}),m.lastDateRange=re.clone(M),d?m.getEventsAsMap(D):m.getEventsAsArray(D)}getEventsAsArray({filter:r,date:s,resourceRecord:t,startDate:i=s,endDate:o,startOnly:l,includeOccurrences:u=!0,dayTime:c=null,dateFilter:d,storeFilterFn:f,getDateIndex:p}){const m=this,D=[];if(f?m.count:m.allCount){let I=t?m.getEventsForResource(t):null;if(!t){const S=m.useDayIndex(c),C=new Set,M=l?"startDate":"date";m.recurringEvents.forEach(h=>{S.dayTime.startOfDay(h.startDate)<=i&&C.add(h)});for(const h=new Date(i);h<o;h.setDate(h.getDate()+1)){const g=S.get(p?p(h):M,h);g==null||g.forEach(v=>C.add(v))}I=[...C]}f&&(I=I.filter(f));for(let S=0,{length:C}=I;S<C;S++){const M=I[S];u&&M.isRecurring?D.push.apply(D,M.getOccurrencesForDateRange(i,o).filter(d)):d(M)&&D.push(M)}}return r?D.filter(r):D}getEventsAsMap({filter:r,date:s,resourceRecord:t,startDate:i=s,endDate:o,startOnly:l,includeOccurrences:u=!0,dateMap:c,dayTime:d=null,storeFilterFn:f,getDateIndex:p}){var m;const D=this;if((m=c)!==null&&m!==void 0&&m.clear?c.clear():c=new Map,D.count){const S=D.useDayIndex(d),C=l?"startDate":"date",M=[],h=v=>(!r||r(v))&&(!f||f(v)),g=v=>Mr(v)&&h(v);if(d=S.dayTime,t)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");var R;(R=D.recurringEvents)===null||R===void 0||R.forEach(v=>{d.startOfDay(v.startDate)<o&&M.push(v)});for(const v=new Date(i);v<o;v.setDate(v.getDate()+1)){var I;let[y,E]=S.get(p?p(v):C,v,!0);(I=y)!==null&&I!==void 0&&I.size&&(y=[...y].filter(g),y.length&&(c.get(E)||c.set(E,[]).get(E)).push(...y))}for(let v=0,{length:y}=M;v<y;v++){const E=M[v],T=(u?E.getOccurrencesForDateRange(i,o):[E]).filter(h),b=x.add(o,1,"day");for(let w,A=0,{length:j}=T;A<j;A++){const O=T[A],k=d.startOfDay(O.startDate),W=p?p(k):l?"startDate":"date",le=W==="startDate"||!O.durationMS?x.add(k,1,"day"):x.min(O.endDate||x.add(O.startDate,O.duration,O.durationUnit),b);for(;k<le;k.setDate(k.getDate()+1)){const J=d.dateKey(k);(w=c.get(J))||c.set(J,w=[]),w.push(O)}}}}return c}},F(n,"$name","GetEventsMixin"),n};const $e={date:"_dateIndex",startDate:"_startDateIndex"},gt=Object.values($e),vn=Object.freeze([]),{MILLIS_PER_DAY:yn}=Ze;class Le{constructor(n,e){this.dayTime=e||Ze.MIDNIGHT,this.store=n,this.users=[this.dayTime]}add(n,e,r){const s=this[$e[n]],t=this.dayTime.dateKey(e);(s[t]||(s[t]=new Set)).add(r)}addEvent(n){var i;var e;let r=(e=this.dayTime.startOfDay(n.startDate))===null||e===void 0?void 0:e.getTime(),s;if(r){var t;s=(i=(t=n.endDate)===null||t===void 0?void 0:t.getTime())!=null?i:r,this.add("startDate",r,n);do this.add("date",r,n),r+=yn;while(r<s)}}clear(){gt.forEach(n=>this[n]=Object.create(null))}get(n,e,r){!this.initialized&&this.initialize();let s=this[$e[n]],t;return e&&(t=this.dayTime.dateKey(e),s=r?[s[t],t]:s[t]),s}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,gt.forEach(n=>this[n]=null)}matches(n){return this.dayTime.startShift===n.startShift}remove(n,e,r){const s=this[$e[n]],t=this.dayTime.dateKey(e),i=s[t];i&&i.delete(r)}removeEvent(n,e,r){var o;var s;let t=(s=this.dayTime.startOfDay(e))===null||s===void 0?void 0:s.getTime(),i;if(t){i=(o=r==null?void 0:r.getTime())!=null?o:t,this.remove("startDate",t,n);do this.remove("date",t,n),t+=yn;while(t<i)}}sync(n,e,r,s,t){var i,o;e=e||vn,r=r||vn;const l=this,u=e.length,c=r.length,d=s==null?void 0:s.length;let f,p,m;if(l.initialized)switch(n){case"clear":l.clear();break;case"splice":if(d)for(e=e.slice(),r=r.slice(),f=0;f<d;f++)r.push(s[f][0]),e.push(s[f][1]);if(c)for(f=0;f<c;f++)m=r[f],l.removeEvent(m,m.startDate,m.endDate);if(u)for(f=0;f<u;f++)p=e[f],p.isScheduled&&!p.isParent&&l.addEvent(p);break;case"reschedule":m=e[0],l.removeEvent(m,((i=t.startDate)===null||i===void 0?void 0:i.oldValue)||m.startDate,((o=t.endDate)===null||o===void 0?void 0:o.oldValue)||m.endDate),l.sync("splice",e);break}}register(n){this.users.push(n)}unregister(n){const{users:e}=this,r=e.indexOf(n);return r>-1&&e.splice(r,1),!e.length}}const Sn=Le.prototype;gt.forEach(a=>Sn[a]=null),Sn.initialized=!1,Le._$name="EventDayIndex";const{MIDNIGHT:Dn}=Ze;var Cn=a=>{var n;return n=class extends a{construct(r){super.construct(r),this.dayIndices=null}afterLoadData(){var r;this.syncIndices("splice",this.storage.allValues),(r=super.afterLoadData)===null||r===void 0||r.call(this)}onDataChange({action:r,added:s,removed:t,replaced:i}){this.syncIndices(r,s,t,i),super.onDataChange(...arguments)}onDataReplaced(r,s){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(r,s)}onModelChange(r,s,t,i,o){("startDate"in t||"endDate"in t)&&this.syncIndices("reschedule",[r],null,null,t),super.onModelChange(...arguments)}invalidateDayIndices(){var r;(r=this.dayIndices)===null||r===void 0||r.forEach(s=>s.invalidate())}registerDayIndex(r){const s=this,t=s.dayIndices||(s.dayIndices=[]);let i,o;for(o=0;!i&&o<t.length;++o)t[o].matches(r)&&(i=t[o]).register(r);return!i&&t.push(i=new Le(s,r)),i}syncIndices(...r){var s;(s=this.dayIndices)===null||s===void 0||s.forEach(t=>t.sync(...r))}unregisterDayIndex(r){const s=this,{dayIndices:t}=s;for(let i=t==null?void 0:t.length;i-- >0;)if(t[i].matches(r)){t[i].unregister(r)&&t.splice(i,1);break}}useDayIndex(r){const s=this,{dayIndices:t}=s;r=r||Dn;for(let i=0;t&&i<t.length;++i)if(t[i].matches(r))return t[i];if(r.startShift)throw new Error(`No day index registered for ${r} on ${s.id}`);return s.registerDayIndex(Dn)}},F(n,"$name","DayIndexMixin"),n},Rn=a=>class extends a{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(e){if(super.construct(e,!0),this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}append(e){return this.add(e)}get project(){return super.project}set project(e){if(super.project=e,this.detachListeners("project"),e){var r;(r=e.assignmentStore)!==null&&r!==void 0&&r.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore),e.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200})}}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(e){this._usesSingleAssignment=e}processRecords(e){var r;const{assignmentStore:s}=this,t=[];return s&&(s.skipInvalidateIndices=!0),e=super.processRecords(e,s&&!((r=this.stm)!==null&&r!==void 0&&r.isRestoring)&&(i=>{const o=i.get("resourceId");!i.reassignedFromReplace&&o!=null&&(s.includesAssignment(i.id,o)||t.push({id:s.modelClass.generateId(""),resourceId:o,eventId:i.id})),i.reassignedFromReplace=!1})||void 0),s&&(s.storage.invalidateIndices(),s.skipInvalidateIndices=!1,s.add(t)),e}joinRecordsToStore(e){const{assignmentStore:r}=this;r?(r.skipInvalidateIndices=!0,super.joinRecordsToStore(e),r.storage.invalidateIndices(),r.skipInvalidateIndices=!1):super.joinRecordsToStore(e)}processRecord(e,r=!1){e=super.processRecord(e,r);const s=e.get("resourceId");if(s!=null&&!e.meta.skipEnforcingSingleAssignment){const t=this,{assignmentStore:i}=t,o=t.getById(e.id);if(o&&o!==e&&!r){const u=i.find(c=>c.eventId===e.id);u&&(u.resource=s,e.reassignedFromReplace=!0)}else t.$processResourceIds=!0;t.usesSingleAssignment=!0}return e}processResourceIds(){var i;var e,r;const s=this,t=(i=s.assignmentStore)!=null?i:(e=s.crudManager)===null||e===void 0?void 0:e.assignmentStore;if(s.$processResourceIds&&t!==null&&t!==void 0&&t.isAssignmentStore&&!((r=s.project)!==null&&r!==void 0&&r.isSharingAssignmentStore&&s.isChained)){const o=[];s.forEach(l=>{const{resourceId:u,id:c}=l;u!=null&&o.push({id:t.modelClass.generateId(""),resourceId:u,eventId:c})}),t.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},t.usesSingleAssignment=!1,t.verifyNoGeneratedIds=!1,t.data=o,t.usesSingleAssignment=!0,s.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var r;const s=this;if(s.removeUnassignedEvent&&!s.isRemoving&&!s.isSettingData&&!((r=s.stm)!==null&&r!==void 0&&r.isRestoring)&&!s.usesSingleAssignment&&!s.assignmentStore.isSyncingDataOnLoad&&!s.resourceStore.isSyncingDataOnLoad){const t=new Set;e.forEach(i=>{const{event:o}=i;o&&!o.isRemoved&&o.assignments.every(l=>e.includes(l))&&t.add(o)}),t.size&&s.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const r=this;r.detachListeners("assignmentStore"),e&&(r.processResourceIds(),e.ion({name:"assignmentStore",addPreCommit({records:s}){r.usesSingleAssignment&&!r.isSettingData&&!r.isAssigning&&s.forEach(t=>{const{event:i}=t;i!=null&&i.isEvent&&i.resourceId!==t.resourceId&&(i.meta.isAssigning=!0,i.set("resourceId",t.resourceId),i.meta.isAssigning=!1)})},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:s}){r.usesSingleAssignment&&s.forEach(t=>{var i;(i=r.getById(t.eventId))===null||i===void 0||i.set("resourceId",null)})},removeAllPreCommit(){r.usesSingleAssignment&&!r.isSettingData&&r.allRecords.forEach(s=>s.set("resourceId",null))},update({record:s,changes:t}){if(r.usesSingleAssignment&&"resourceId"in t){const{event:i}=s;i.meta.isAssigning=!0,i.set("resourceId",t.resourceId.value),i.meta.isAssigning=!1}},thisObj:r}))}set data(e){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=e,this.isSettingData=!1}trigger(e,r){var s;const{changes:t}=r||{};return t&&"resourceId"in t&&Object.keys(t).length===1&&!((s=this.stm)!==null&&s!==void 0&&s.isRestoring)&&(r.isAssign=!0),super.trigger(...arguments)}remove(e,...r){const s=super.remove(e,...r);if(s.length&&this.usesSingleAssignment){for(const o of s)if(!o.isOccurrence){var t,i;(t=this.assignmentStore||((i=this.crudManager)===null||i===void 0?void 0:i.assignmentStore))===null||t===void 0||t.remove(o.assignments,!0)}}return s}};const En=Object.freeze([]);var ft=a=>class extends(a||B){static get $name(){return"RecurringTimeSpansMixin"}construct(...e){const r=this;r.globalOccurrences=new Map,r.recurringEvents=new Set,super.construct(...e)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:r,removed:s,replaced:t}){this.refreshRecurringEventsCache(e,r,s,t),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,r=En,s=En,t){const i=this,{recurringEvents:o}=i,l=t==null?void 0:t.length;switch(e){case"clear":o.clear();break;case"splice":{if(l){r=r.slice(),s=s.slice();for(let d=0;d<l;d++)s.push(t[d][0]),r.push(t[d][1])}const u=r.length,c=s.length;if(c&&o.size)for(let d=0;d<c;d++)o.delete(s[d]);if(u)for(let d=0;d<u;d++){const f=r[d];f.isRecurring&&o.add(f)}break}}}getById(e){let r=super.getById(e);return r||(r=this.globalOccurrences.get(this.modelClass.asId(e))),r}onModelChange(e,r,s,t,i){const o=!t&&this.isRecurrenceRelatedFieldChange(e,s);if(o&&e.removeOccurrences(),super.onModelChange(...arguments),o){const l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}isRecurrenceRelatedFieldChange(e,r){return e.isRecurring||"recurrenceRule"in r}getOccurrencesForTimeSpan(e,r,s){const t=[];return e.isRecurring&&e.recurrence.forEachOccurrence(r,s,i=>t.push(i)),t}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},xn=a=>class extends ft(a||B){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};const mt={startDate:1,endDate:1,constraintDate:1,deadlineDate:1};var In=a=>{var n;return n=class extends(a||ee){get timeZone(){return this.getData("timeZone")}set timeZone(r){this.setData("timeZone",r)}setLocalDate(r,s){this.set(r,this.timeZone!=null?z.toTimeZone(s,this.timeZone):s,!0),this.data[r]=this[r]}getLocalDate(r){return this.timeZone!=null&&this[r]?z.fromTimeZone(this[r],this.timeZone):this[r]}applyChangeset(r){if(this.timeZone!=null)for(const s in mt)r[s]&&(this.setLocalDate(s,new Date(r[s])),delete r[s]);return super.applyChangeset(...arguments)}getFieldPersistentValue(r){var s,t;if(this.timeZone!=null){const i=(t=(s=r==null?void 0:r.field)!=null?s:r==null?void 0:r.name)!=null?t:r;if(mt[i])return this.getLocalDate(i)}return super.getFieldPersistentValue(r)}convertToTimeZone(r){const s=this,t={...s.meta.modified},i={...mt};s.isTask&&!s.manuallyScheduled&&(delete i.startDate,delete i.endDate);for(const o in i)s[o]!=null?(i[o]=s[o],s.timeZone!=null&&(i[o]=s.getLocalDate(o),t[o]&&(t[o]=z.fromTimeZone(t[o],s.timeZone)))):delete i[o];s.timeZone=r;for(const o in i)s.setLocalDate(o,i[o],!1),i[o]=1,s.timeZone!=null&&t[o]&&(t[o]=z.toTimeZone(t[o],s.timeZone));s.clearChanges(!0,!0,i),$.isEmpty(t)||(s.meta.modified=t,s.stores.forEach(o=>o.modified.add(s)))}},F(n,"$name","TimeZonedDatesMixin"),F(n,"fields",[{name:"timeZone",persist:!1}]),n};class ee extends _.mixin(In){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"}},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}construct(n,...e){if(n!=null&&n.fullDuration){const{magnitude:r,unit:s}=n.fullDuration;n.duration=r,n.unit=s,delete n.fullDuration}super.construct(n,...e),this.normalize()}get eventStore(){const n=this;if(n.isOccurrence)return n.recurringTimeSpan.eventStore;if(!n._eventStore){var e;n._eventStore=(e=n.stores)===null||e===void 0?void 0:e.find(r=>r.isEventStore)}return n._eventStore}normalize(){const n=this,{startDate:e,endDate:r,duration:s,durationUnit:t}=n,i=s!=null;e&&r&&!i?n.setData("duration",x.diff(e,r,t,!0)):e&&!r&&i?n.setData("endDate",x.add(e,s,t)):!e&&r&&i&&n.setData("startDate",x.add(r,-s,t))}updateInternalCls(n){this._cls?this._cls.value=n:this._cls=new xt(n)}set internalCls(n){this.updateInternalCls(n),this.set("cls",this._cls.value)}get internalCls(){const{cls:n}=this;return n!=null&&n.isDomClassList?n:(this.internalCls=n,this._cls)}get cls(){return this._cls||(this._cls=new xt(super.get("cls"))),this._cls}set cls(n){this.internalCls=n}get startDate(){return this.get("startDate")}set startDate(n){this.setStartDate(n)}get endDate(){return this.get("endDate")}set endDate(n){this.setEndDate(n)}get endingDate(){const n=this,{endDate:e,startDate:r}=n;return e||x.add(r,n.duration,n.durationUnit)}get duration(){return this.get("duration")}set duration(n){this.setDuration(n,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(n,e=this.durationUnit){n=parseFloat(n),this.set({duration:n,durationUnit:e,...this.updateDatesFromDuration(n,e)})}updateDatesFromDuration(n,e,r=this.startDate,s=this.endDate){const t={};return r?t.endDate=x.add(r,n,e):s&&(t.startDate=x.add(s,-n,e)),t}getDurationInUnit(n,e){const r=this;return r.startDate&&r.endDate?x.getDurationInUnit(r.startDate,r.endDate,n,e):x.as(n,r.duration,r.durationUnit)}get fullDuration(){return new de({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(n){typeof n=="string"&&(n=x.parseDuration(n,!0,this.durationUnit)),this.setDuration(n.magnitude,n.unit)}setStartDate(n,e=!0){const r=this,s={startDate:n};if(n){let t;if(e)t=r.duration!=null;else if(r.endDate){if(s.duration=x.diff(n,r.endDate,r.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else t=this.duration!=null;t&&(s.endDate=x.add(n,r.getDurationInUnit("h"),"h"))}else s.duration=null;r.set(s)}setEndDate(n,e=!1){const r=this,s={endDate:n};if(n){let t;if(e===!0)t=r.duration!=null;else if(r.startDate){if(s.duration=x.diff(r.startDate,n,r.durationUnit,!0),s.duration<0)throw new Error("Negative duration")}else t=this.duration!=null;t&&(s.startDate=x.add(n,-r.duration,r.durationUnit))}r.set(s)}setStartEndDate(n,e,r){this.set({startDate:n,endDate:e},null,r)}get dates(){const n=[],e=x.startOf(this.startDate,"day"),r=this.endDate;for(let s=e;s<r;s=x.add(s,1,"day"))n.push(s);return n}get startDateMS(){var n;return(n=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)===null||n===void 0?void 0:n.getTime()}get endDateMS(){var n;return(n=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)===null||n===void 0?void 0:n.getTime()}get durationMS(){const{endDateMS:n,startDateMS:e}=this;return n&&e?n-e:x.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(n){if(typeof n!="string"){let{startDate:e,endDate:r,duration:s,durationUnit:t=this.durationUnit}=n;typeof e=="string"&&(e=this.getFieldDefinition("startDate").convert(e)),typeof r=="string"&&(r=this.getFieldDefinition("endDate").convert(r)),"duration"in n?(e&&!r&&(r=x.add(e,s,t,!0,!0)),!e&&r&&(e=x.add(r,-s,t,!0,!0))):e&&r&&(s=x.as(t,x.diff(e,r,"h",!0),"h"));const i=Object.isFrozen(n)?$.clone(n):n;return e&&(i.startDate=e),r&&(i.endDate=r),s!=null&&(i.duration=s),i}}fieldToKeys(n,e){var s,t;const r=super.fieldToKeys(n,e);if(r.fullDuration){const{magnitude:i,unit:o}=r.fullDuration;r.duration=i,r.durationUnit=o}return!this.isEventModel&&!this.isTaskModel&&("duration"in r||r.durationUnit)&&!(r.startDate&&r.endDate)&&Object.assign(r,this.updateDatesFromDuration((s=r.duration)!=null?s:this.duration,(t=r.durationUnit)!=null?t:this.durationUnit,r.startDate,r.endDate)),r}inSet(n,e,r,s,t,i){return t||(n=this.inSetNormalize(n)||n),super.inSet(n,e,r,s,t,i)}applyValue(n,e,r,s,t){e==="cls"&&this.updateInternalCls(r),e==="fullDuration"&&(this[e]=r),super.applyValue(n,e,r,s,t)}forEachDate(n,e){return this.dates.forEach(n.bind(e))}get isScheduled(){const{startDateMS:n,endDateMS:e}=this;return e-n>=0}get isValid(){const{startDate:n,endDate:e}=this;return!n||!e||e-n>=0}shift(n,e=this.durationUnit){if(typeof n=="string"){const r=n;n=e,e=r}return this.setStartDate(x.add(this.startDate,n,e,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(n){this._wbsCode=n}fullCopy(){return this.copy.apply(this,arguments)}intersects(n){return this.intersectsRange(n.startDate,n.endDate)}intersectsRange(n,e){const r=this.startDate,s=this.endDate;return r&&s&&x.intersectSpans(r,s,n,e)}split(n=.5){const e=this,r=e.copy(),{fullDuration:s,eventStore:t,assignmentStore:i}=e,o=new de(s),l=new de(s);let u,c;return typeof n=="string"?(u=new de(n),u.unit===o.unit?l.magnitude-=u.magnitude:(l.magnitude=x.as(u.unit,o)-u.magnitude,l.unit=u.unit,c=!0)):(u=new de(n>1?n:e.duration*n,e.durationUnit),l.magnitude-=u.magnitude),r.startDate=x.add(e.startDate,u.magnitude,u.unit),c?(r.fullDuration=l,e.fullDuration=u):(r.duration=l.magnitude,e.duration=u.magnitude),t&&(t.add(r),i&&!t.usesSingleAssignment&&i.add(e.assignments.map(d=>{const f=Object.assign({},d.data,{eventId:r.id,event:null,resource:null});return delete f.id,f}))),r}toICSString(n={}){if(!this.isScheduled)return"";const{startDate:e,endDate:r}=this,s=n.DTSTAMP||x.format(new Date,"uu");delete n.DTSTAMP;let t={};this.allDay?t={"DTSTART;VALUE=DATE":x.format(e,"u"),"DTEND;VALUE=DATE":x.format(r,"u")}:t={DTSTART:x.format(e,"uu"),DTEND:x.format(r,"uu")};const i=ce.scheduler&&ce.getVersion("scheduler")||ce.calendar&&ce.getVersion("calendar")||"",o={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${i} //EN`,END:"VCALENDAR"},l={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:s,...t,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...n,END:"VEVENT"},u=Object.keys(o).map(d=>`${d}:${o[d]}`),c=Object.keys(l).map(d=>`${d}:${l[d]}`);return u.splice(u.length-1,0,...c),u.join(`
`)}exportToICS(n){if(this.isScheduled){const e=new Blob([this.toICSString(n)],{type:"text/calendar"});Wn.downloadBlob(e,(this.name||"Event")+".ics")}}isEditable(n){return this.getFieldDefinition(n)?!0:void 0}isFieldModified(n){return n==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(n)}}ee._$name="TimeSpan";const Tr=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,Mn=["SU","MO","TU","WE","TH","FR","SA"];class ve extends B{static decodeDay(n){let e,r;return(e=Tr.exec(n))&&(r=[Mn.indexOf(e[2])],e[1]&&(e[1]=parseInt(e[1],10),r.push(e[1]))),r}static encodeDay(n){let e;return Array.isArray(n)&&([n,e]=n),(e?e.toString():"")+Mn[n]}static decode(n){const e=[];let r;if(n)for(let s=0;s<n.length;s++)(r=this.decodeDay(n[s]))&&e.push(r);return e}static encode(n){const e=[];let r;if(n)for(let s=0;s<n.length;s++)(r=this.encodeDay(n[s]))&&e.push(r);return e}}ve._$name="RecurrenceDayRuleEncoder";const br=/ly$/i,pt=a=>{const n=a.replace(br,"");return n==="DAI"?"DAY":n},Ar=(a,n,e,r)=>r.buildOccurrence(a,e),wr=a=>vt=a;let vt;class Z extends B{static processIterationConfig(n){var e;const{recurrence:r}=n,{frequency:s,interval:t,timeSpan:i,endDate:o,count:l}=r;if(!n.syncingStartDate&&!i.meta.isSyncedWithRule){const p=x.add(i.startDate,t,pt(s)),m=x.min(p,n.endDate||p);this.forEachDate({syncingStartDate:!0,startDate:i.startDate,endDate:m,recurrence:r,fn:Ar})}const u=i.startDate;let{startDate:c=u,endDate:d=o}=n;c<u&&(c=u),o?(!d||d>o)&&(d=o):l&&c>u&&(this.forEachDate({recurrence:r,fn:wr}),(!d||d>vt)&&(d=new Date(vt.getTime()+1)));const f=c;return n.startOnly||(c=new Date(x.max(x.add(c,-t,pt(s)),u))),Object.assign({extraArgs:[],startOnly:!i.durationMS},n,{startDate:c,endDate:d,timeSpan:i,timeSpanStart:u,earliestVisibleDate:f,endDateMS:(e=d)===null||e===void 0?void 0:e.getTime(),timeSpanStartMS:u.getTime(),earliestVisibleDateMS:f.getTime(),durationMS:i.durationMS,spansStart:c<=u&&d>u})}static getOccurrenceIndex(n){if(n.isOccurrence)return x.diff(n.recurringTimeSpan.startDate,n.startDate,pt(n.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(n,e,r,s){let t,i,o;if(s){s>0?(i=1,o=n):(i=-1,o=e);const l=r-o.getDay();i*l<0&&(s+=i),t=new Date(o),t.setDate(o.getDate()+(s-i)*7+l),(t<n||t>e)&&(t=null)}return t}static buildDate(n,e,r){const s=new Date(n,e,r);if(s.getFullYear()===n&&s.getMonth()===e&&s.getDate()===r)return s}static isValidPosition(n){return!!n}static forEachDateAtPositions(n,e,r,s){const t=n.length,i={};for(let o=0;o<e.length;o++){const l=e[o];if(this.isValidPosition(l)){const u=l>0?n[l-1]:n[t+l];if(u&&!i[u.getTime()]&&(i[u.getTime()]=!0,r.call(s,u)===!1))return!1}}}static isInView(n,e,r,s,t){return(n?e>=r:e.valueOf()+s>r)&&!t.hasException(e)}static isInViewMS(n,e,r,s,t,i){return(n?r>=s:r+t>s)&&!i.hasException(e)}}F(Z,"frequency","NONE"),F(Z,"MAX_OCCURRENCES_COUNT",1e6),Z._$name="AbstractRecurrenceIterator";class Ne extends Z{static forEachDate(n){const{startOnly:e,startDate:r,endDate:s,endDateMS:t,timeSpan:i,timeSpanStart:o,earliestVisibleDateMS:l,durationMS:u,spansStart:c,recurrence:d,fn:f,extraArgs:p,scope:m=this}=this.processIterationConfig(n),{interval:D}=d,R=r-o,I=D*864e5,S=Math.floor(R/I);let{count:C}=d,M=0,h=x.add(o,S*D,"day"),g=h.getTime();for(!s&&!C&&(C=this.MAX_OCCURRENCES_COUNT);!t||g<t;){const v=this.isInViewMS(e,h,g,l,u,i);if(M++,v&&(t&&g>t||f.apply(m,[h,M,M===1&&c,i,...p])===!1||C&&M>=C))break;h=x.add(h,D,"day"),g=h.getTime()}}}F(Ne,"frequency","DAILY"),Ne._$name="DailyRecurrenceIterator";class _e extends Z{static forEachDate(n){var e;const{startOnly:r,startDate:s,endDateMS:t,timeSpan:i,timeSpanStart:o,timeSpanStartMS:l,earliestVisibleDateMS:u,durationMS:c,spansStart:d,recurrence:f,fn:p,extraArgs:m,scope:D=this}=this.processIterationConfig(n),{interval:R,days:I}=f,{weekStartDay:S}=x,C=o.getHours(),M=o.getMinutes(),h=o.getSeconds(),g=o.getMilliseconds();let v=0,{count:y}=f,E=ve.decode(I),T,b;if((e=E)!==null&&e!==void 0&&e.length||(E=[[o.getDay()]]),S>0)for(let w=0;w<E.length;w++)S>E[w][0]?E[w][0]=7-S-E[w][0]:E[w][0]-=S;for(E.sort((w,A)=>w[0]-A[0]),T=x.getNext(y||R>1?o:s,"week",0),!t&&!y&&(y=this.MAX_OCCURRENCES_COUNT);!t||T.getTime()<t;){for(let w=0;w<E.length;w++){b=new Date(T.getFullYear(),T.getMonth(),T.getDate()+E[w][0],C,M,h,g);const A=b.getTime();if(A>=l){const j=this.isInViewMS(r,b,A,u,c,i);if(v++,j&&(t&&A>=t||p.apply(D,[b,v,v===1&&d,i,...m])===!1||y&&v>=y))return}}T=x.getNext(T,"week",R)}}}F(_e,"frequency","WEEKLY"),_e._$name="WeeklyRecurrenceIterator";class Be extends Z{static getNthDayOfMonth(n,e){const r=x.daysInMonth(n);let s=null;return e&&Math.abs(e)<=r&&(s=new Date(n.getFullYear(),n.getMonth(),e<0?r+e+1:e)),s}static isValidPosition(n){return n&&Math.abs(n)>0&&Math.abs(n)<=31}static forEachDate(n){const{startOnly:e,startDate:r,endDate:s,timeSpan:t,timeSpanStart:i,earliestVisibleDate:o,durationMS:l,spansStart:u,recurrence:c,fn:d,extraArgs:f,scope:p=this}=this.processIterationConfig(n),{interval:m,days:D,count:R,positions:I}=c,S=ve.decode(D),C=I&&I.length,M={};let{monthDays:h}=c,g=0,v,y,E,T,b,w;for(y=x.startOf(R||m>1?i:r,"month"),E=new Date(x.getNext(y,"month",1)-1),!(h&&h.length)&&!(S&&S.length)&&(h=[i.getDate()]),S&&S.length&&S.forEach(A=>{A[1]&&(v=v||{},v[A[0]]=A[1])});(!s||s>y)&&(!R||g<R);){if(T=[],S&&S.length){if(S.forEach(A=>{const j=A[0];let O=1,k=53;for(A[1]&&(O=k=A[1]),w=O;w<=k;w++)(b=this.getNthDayInPeriod(y,E,j,w))&&(b=x.copyTimeValues(b,i),M[b.getTime()]||(M[b.getTime()]=!0,T.push(b)))}),T.sort((A,j)=>A-j),!C){for(w=0;w<T.length;w++)if(b=T[w],b>=i){const A=this.isInView(e,b,o,l,t);if(g++,A&&(s&&b>=s||d.apply(p,[b,g,g===1&&u,t,...f])===!1||R&&g>=R))return!1}}}else{const A=[];for(w=0;w<h.length;w++)(b=this.getNthDayOfMonth(y,h[w]))&&!M[b.getTime()]&&(M[b.getTime()]=!0,A.push(b));for(A.sort((j,O)=>j-O),w=0;w<A.length;w++)if(b=x.copyTimeValues(A[w],i),C)T.push(b);else if(b>=i){const j=this.isInView(e,b,o,l,t);if(g++,j&&(s&&b>s||d.apply(p,[b,g,g===1&&u,t,...f])===!1||R&&g>=R))return}}C&&T.length&&this.forEachDateAtPositions(T,I,A=>{if(A>=i){const j=e?A>=o:A.valueOf()+l>o&&!t.hasException(A);if(g++,j&&(!s||A<=s)&&(d.apply(p,[A,g,g===1&&u,t,...f])===!1||R&&g>=R))return!1}}),y=x.getNext(y,"month",m),E=new Date(x.getNext(y,"month",1)-1)}}}F(Be,"frequency","MONTHLY"),Be._$name="MonthlyRecurrenceIterator";class Ve extends Z{static forEachDate(n){const{startOnly:e,startDate:r,endDate:s,timeSpan:t,timeSpanStart:i,earliestVisibleDate:o,durationMS:l,spansStart:u,recurrence:c,fn:d,extraArgs:f,scope:p=this}=this.processIterationConfig(n),{interval:m,days:D,count:R,positions:I}=c,S=ve.decode(D),C=I&&I.length,M={};let{months:h}=c,g=0,v,y,E,T,b,w;for(T=x.startOf(R||m>1?i:r,"year"),b=new Date(x.getNext(T,"year",1)-1),h&&h.sort((A,j)=>A-j),!(h&&h.length)&&!(S&&S.length)&&(h=[i.getMonth()+1]),S&&S.length&&S.forEach(A=>{A[1]&&(w=w||{},w[A[0]]=A[1])});(!s||s>T)&&(!R||g<R);){if(E=[],S&&S.length){if(S.forEach(A=>{const j=A[0];let O=1,k=53;for(A[1]&&(O=k=A[1]),v=O;v<=k;v++)(y=this.getNthDayInPeriod(T,b,j,v))&&(y=x.copyTimeValues(y,i),M[y.getTime()]||(M[y.getTime()]=!0,E.push(y)))}),E.sort((A,j)=>A-j),!C){for(v=0;v<E.length;v++)if(y=E[v],y>=i){const A=this.isInView(e,y,o,l,t);if(g++,A&&(s&&y>=s||d.apply(p,[y,g,g===1&&u,t,...f])===!1||R&&g>=R))return}}}else for(v=0;v<h.length;v++)if((y=this.buildDate(T.getFullYear(),h[v]-1,i.getDate()))&&(y=x.copyTimeValues(y,i),!M[y.getTime()])){if(M[y.getTime()]=!0,C)E.push(y);else if(y>=i){const A=e?y>=o:y.valueOf()+l>o&&!t.hasException(y);if(g++,A&&(s&&y>=s||d.apply(p,[y,g,g===1&&u,t,...f])===!1||R&&g>=R))return}}C&&E.length&&this.forEachDateAtPositions(E,I,A=>{if(A>=i){const j=e?A>=o:A.valueOf()+l>o&&!t.hasException(A);if(g++,j&&(!s||A<s)&&(d.apply(p,[A,g,g===1&&u,t,...f])===!1||R&&g>=R))return!1}}),T=x.getNext(T,"year",m),b=new Date(x.getNext(T,"year",1)-1)}}}F(Ve,"frequency","YEARLY"),Ve._$name="YearlyRecurrenceIterator";const Tn={};[Ne,_e,Be,Ve].forEach(a=>{Tn[a.frequency]=a});function yt(a){return a?typeof a=="string"&&(a=a.split(",").map(n=>parseInt(n,10))):a=null,a}function Pr(a){return a?typeof a=="string"&&(a=a.split(",")):a=null,a}function Ye(a,n){return String(a)===String(n)}function bn(a){return this.defaultValue&&a===void 0?this.defaultValue:this.allowNull&&a==null?null:(a=parseInt(a),isNaN(a)?void 0:a)}class St extends _{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:bn},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:bn},{name:"days",convert:Pr,isEqual:Ye},{name:"monthDays",convert:yt,isEqual:Ye},{name:"months",convert:yt,isEqual:Ye},{name:"positions",convert:yt,isEqual:Ye}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(n){this._dateFormat=n}get recurrenceIterator(){return Tn[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(n){this._timeSpan=n}get rule(){const n=this,e=[];return n.frequency&&(e.push(`FREQ=${n.frequency}`),n.interval>1&&e.push(`INTERVAL=${n.interval}`),n.days&&n.days.length&&e.push("BYDAY="+n.days.join(",")),n.monthDays&&n.monthDays.length&&e.push("BYMONTHDAY="+n.monthDays.join(",")),n.months&&n.months.length&&e.push("BYMONTH="+n.months.join(",")),n.count&&e.push(`COUNT=${n.count}`),n.endDate&&e.push("UNTIL="+x.format(n.endDate,n.dateFormat)),n.positions&&n.positions.length&&e.push("BYSETPOS="+n.positions.join(","))),e.join(";")}set rule(n){const e=this,r={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(e.beginBatch(),n){const s=n.split(";");for(let t=0,i=s.length;t<i;t++){const o=s[t].split("="),l=o[1];switch(o[0]){case"FREQ":r.frequency=l;break;case"INTERVAL":r.interval=l;break;case"COUNT":r.count=l,r.until=null;break;case"UNTIL":l?r.endDate=x.parse(l,e.dateFormat):r.endDate=null,r.count=null;break;case"BYDAY":r.days=l;break;case"BYMONTHDAY":r.monthDays=l;break;case"BYMONTH":r.months=l;break;case"BYSETPOS":r.positions=l;break}}}e.set(r),n&&e.sanitize(),e.endBatch()}construct(n={}){const e=this,{rule:r,timeSpan:s}=n;e._suspendedTimeSpanNotifying=0,delete n.timeSpan,delete n.rule,super.construct(...arguments),r&&(e.suspendTimeSpanNotifying(),e.rule=r,e.resumeTimeSpanNotifying()),e.timeSpan=s}forEachOccurrence(n,e,r){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:n,endDate:e,fn(s,t,i,o){return r(o.buildOccurrence(s,i),i,t,s)}})}sanitize(){var n;const e=this,r=(n=e.timeSpan)===null||n===void 0?void 0:n.startDate,s={};switch(e.isSanitizing=!0,e.frequency){case"DAILY":s.positions=null,s.days=null,s.monthDays=null,s.months=null;break;case"WEEKLY":{s.positions=null,s.monthDays=null,s.months=null;const{days:i}=e;r&&(i==null?void 0:i.length)===1&&i[0]===ve.encodeDay(r.getDay())&&(s.days=null);break}case"MONTHLY":{var t;(t=e.monthDays)!==null&&t!==void 0&&t.length&&(s.positions=null,s.days=null),s.months=null;const{monthDays:i}=e;r&&(i==null?void 0:i.length)===1&&i[0]===r.getDate()&&(s.monthDays=null);break}case"YEARLY":{s.monthDays=null;const{months:i}=e;r&&(i==null?void 0:i.length)===1&&i[0]===r.getMonth()+1&&(s.months=null);break}}e.set(s),e.isSanitizing=!1}copy(...n){const e=super.copy(...n);return e.dateFormat=this.dateFormat,e.timeSpan=this.timeSpan,e}afterChange(n,e,r){const s=super.afterChange(n,e,r),{timeSpan:t}=this;return this.isSanitizing||this.sanitize(),t&&(t.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||t.onRecurrenceChanged()),s}set(n,e,...r){const s=typeof n=="object"?n:{[n]:e};s.count?s.endDate=null:s.endDate&&(s.count=null),super.set(s,void 0,...r)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}St._$name="RecurrenceModel";function jr(a){const n={},{dateFormat:e}=this;return a&&(a=typeof a=="string"?a.split(","):V.asArray(a),a.forEach(r=>{typeof r=="string"&&(r=x.parse(r,e)),isNaN(r)||(n[x.makeKey(r)]=1)})),n}function Or(a){const n=[],{dateFormat:e}=this;for(const r in a)a[r]&&n.push(x.format(x.parseKey(r),e));return n}const Fr=[];var Dt=a=>class extends(a||ee){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:jr,serialize:Or,internal:!0}]}remove(){if(this.isOccurrence){const e=this,{recurringTimeSpan:r}=e;e.cancelBatch(),r.beginBatch(),e.detachFromRecurringEvent(),r.endBatch()}else return super.remove(...arguments)}get eventStore(){var e;let r=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!r&&(e=this.firstStore)!==null&&e!==void 0&&e.isRecurringTimeSpansMixin&&(r=this.firstStore),r}get recurrenceModel(){return this._recurrenceModel||St}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,r,s){const t=this;let i;e&&(e.isRecurrenceModel||(typeof e=="string"&&(e={frequency:e},r&&(e.interval=r),s&&(s instanceof Date?e.endDate=s:e.count=s)),e=new t.recurrenceModel(e)),e.timeSpan=t,i=e.rule),t.recurrence=e,t.recurrenceRule=i}get recurrence(){const e=this,r=e.recurrenceRule;return!e._recurrence&&r&&(e._recurrence=new e.recurrenceModel({rule:r,timeSpan:e,id:`${e.id}-recurrence`})),e._recurrence}set recurrence(e){const r=this;r._recurrence=e,e?(e.timeSpan=r,r.recurrenceRule=e.rule):r.isOccurrence?r.setData("recurrenceRule",null):r.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,r=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,r)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach(r=>{r!==this&&e.push(r)}),e}return Fr}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(e){var r;const s=e.isTimeSpan?e.occurrenceDate:e;(r=this.eventStore)===null||r===void 0||r.globalOccurrences.delete(this.createRecurrenceKey(s)),this.occurrenceMap.delete(x.makeKey(s))}removeOccurrencesFrom(e){this.occurrenceMap.forEach((r,s)=>{x.parseKey(s)>=e&&this.removeOccurrence(r)})}removeOccurrences(){[this,...this.occurrences].forEach(e=>this.removeOccurrence(e))}onRecurrenceChanged(){var e;this.recurrenceRule=((e=this.recurrence)===null||e===void 0?void 0:e.rule)||null}sanitizeRecurrenceData(e=this.recurrence){if(e.endDate){const r=x.clearTime(e.endDate),{exceptionDates:s}=this;if(this.removeOccurrencesFrom(r),s)for(const t in s)x.parseKey(t)>=r&&delete s[t]}}get occurrenceDate(){var e;return((e=this.meta.modified)===null||e===void 0?void 0:e.startDate)||this.startDate}get occurrenceIndex(){return Z.getOccurrenceIndex(this)}buildOccurrence(e,r){var s;const t=this,{occurrenceMap:i,recurrence:o,meta:l}=t,u=(s=t.eventStore)===null||s===void 0?void 0:s.globalOccurrences,c=x.makeKey(e),d=t.createRecurrenceKey(e,c),f=!(e-t.startDate),{fieldMap:p}=t.constructor;let m=u==null?void 0:u.get(d),{duration:D}=t;t.endDate&&(t.allDay||!D)&&(D=x.as(t.durationUnit,t.endDate.getTime()-t.startDate.getTime()));const R=D!==void 0?x.add(e,D,t.durationUnit):void 0;return m||(r||f?(m=t,f||(t.setStartEndDate(e,R,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),l.isSyncedWithRule=!0):(m=t.copy({[p.id.dataSource]:d,[p.startDate.dataSource]:e,[p.endDate.dataSource]:R,[p.duration.dataSource]:D,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),m.recurringTimeSpan=t),u==null||u.set(d,m),i.set(c,m)),m}createRecurrenceKey(e=this.startDate,r=null){return`_generated:${this.id}:${r||x.makeKey(e)}`}convertToRealEvent(e,r){var s;if(!this.isOccurrence)return;const t=this,{recurringTimeSpan:i,resource:o,occurrenceIndex:l,recurrence:u}=t,c=u&&i.recurrence.count,d=(e==null||(s=e.resourceRecords)===null||s===void 0?void 0:s.value)||t.data.newResource;i.beginBatch(),t.detachFromRecurringEvent(),t.clearChanges(),t.setData("id",t.generateId(i.eventStore)),d&&delete t.data.resourceId,i.eventStore.add(t,r),c&&(t.recurrence.count=c-l),(d||o)&&t.assign(d||o),d&&delete t.data.resourceRecords,e&&delete e.resourceRecords,i.endBatch()}afterChange(e,r,s,...t){const i=this,{eventStore:o}=i;return"recurrenceRule"in r&&(i._recurrence=null,o==null||o.recurringEvents[r.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence?i.convertToRealEvent(r,s):"newExceptionDate"in r&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(r.newExceptionDate.value)),super.afterChange(e,r,s,...t)}detachFromRecurringEvent(){const e=this,{recurringTimeSpan:r,occurrenceDate:s,startDate:t}=e;e.recurringTimeSpan=null,r.addExceptionDate(s),e.recurrenceRule&&(r.recurrence.endDate=x.add(t,-1,"minute"))}set newExceptionDate(e){if(e){const r=this.exceptionDates||(this.exceptionDates={});r[x.makeKey(e)]=1}}addExceptionDate(e){return this.set({newExceptionDate:e})}hasException(e){var r;return(r=this.exceptionDates)===null||r===void 0?void 0:r[x.makeKey(e)]}};const kr=1e3*60*60*24;var An=a=>class extends a{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(e=>{e.eventId=this.id})}syncId(e){super.syncId(e),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce((e,{resource:r})=>(r&&e.push(r.$original),e),[])}set resources(e){e=V.asArray(e);const r=this,s=e.map(r.constructor.asId);if(r.usesSingleAssignment)r.set("resourceId",s[0]);else{const t=r.assignments.map(l=>l.resource.id),{onlyInA:i,onlyInB:o}=V.delta(s,t);r.assignmentStore.add(i.map(l=>({resource:l,event:r}))),r.assignmentStore.remove(o.map(l=>r.assignments.find(u=>u.resource.id===l)))}}forEachResource(e,r=this){for(const s of this.resources)if(e.call(r,s)===!1)return}getResource(e){return e==null?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){var r;let e;return this.isOccurrence?e=this.get("startDate"):e=(r=this._startDate)!=null?r:super.startDate,this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){this.batching?(this._startDate=e,this.set({startDate:e})):super.startDate=e}get endDate(){var r;let e;return this.isOccurrence?e=this.get("endDate"):e=(r=this._endDate)!=null?r:super.endDate,this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){this.batching?(this._endDate=e,this.set({endDate:e})):super.endDate=e}get wrapStartDate(){return this.startDate}set wrapStartDate(e){}get wrapEndDate(){return this.endDate}set wrapEndDate(e){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const e=this,{isPersistable:r,meta:{batchChanges:s}}=e;if(s&&("endDate"in s&&(delete e._endDate,e.postamble&&(e.wrapEndDate=null)),"startDate"in s&&(delete e._startDate,e.preamble&&(e.wrapStartDate=null))),super.endBatch(...arguments),e.isPersistable&&!r&&!e.ignoreBag&&e.assigned)for(const t of e.assigned)t.stores.forEach(i=>i.updateModifiedBagForRecord(t))}get isCreating(){return super.isCreating}set isCreating(e){super.isCreating=e,this.assignments.forEach(r=>r.isCreating=e)}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...e){const r=super.copy(...e);return this.usesSingleAssignment||(r.resourceId=null),r}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):(e=this.resource)===null||e===void 0?void 0:e.id}set resourceId(e){this.applyResourceId(e)}get $linkedResources(){var r;var e;return(r=(e=this.resources)===null||e===void 0?void 0:e.flatMap(s=>[s,...s.$links]))!=null?r:[]}applyResourceId(e,r=!1){const s=this,{eventStore:t,assignments:i}=s;if(t){var o;const l=t.assignmentStore||((o=t.crudManager)===null||o===void 0?void 0:o.assignmentStore);if(e!=null)if(s.meta.skipEnforcingSingleAssignment||(t.usesSingleAssignment=!0),i!=null&&i.length&&e!==i[0].resourceId){const u=!!t.eventsSuspended;u&&l.suspendEvents(),i[0].resource=e,u&&l.resumeEvents()}else l.assignEventToResource(s,e);else l.remove(i)}else r||s.set({resourceId:e})}applyValue(e,r,s,t,i){if(i&&i.name==="resourceId"&&!this.meta.isAssigning){const{eventStore:o}=this;o&&(o.isAssigning=!0),this.applyResourceId(s,!0),o&&(o.isAssigning=!1)}super.applyValue(e,r,s,t,i)}get assignments(){return[...this.assigned||[]]}assign(e,r=!1){const{eventStore:s}=this;s&&!s.usesSingleAssignment?s.assignEventToResource(this,e,r):(this.resourceId=this.constructor.asId(e),s||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(e,r=!1){var s;const t=this;e=t.constructor.asId(e),t.meta.removingResource=r,(s=t.eventStore)===null||s===void 0||s.unassignEventFromResource(t,e),t.meta.removingResource=null}reassign(e,r){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,r)}isAssignedTo(e){const r=this.constructor.asId(e);return this.assignments.some(s=>s.resourceId===r)}get predecessors(){var e;return[...(e=this.incomingDeps)!=null?e:[]]}get successors(){var e;return[...(e=this.outgoingDeps)!=null?e:[]]}get dependencies(){var e,r;return[...(e=this.incomingDeps)!=null?e:[],...(r=this.outgoingDeps)!=null?r:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:e}=this;if(e>=kr||!e&&this.allDay)return!0;const{endDate:r,startDate:s}=this,t=x.clearTime(s);if(s&&r)return t.setDate(t.getDate()+1),(r||x.add(s,e))>t}static getAllDayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=x.clearTime(e,!0)),e}static getAllDayEndDate(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=x.getNext(e,"d",1)),e}static getAllDayDisplayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),x.clearTime(e,!0)}static getAllDayDisplayEndDate(e,r){return e&&e.isEvent&&(r=e.get("endDate"),e=e.get("startDate")),r&&(e=this.constructor.getAllDayDisplayStartDate(e),x.clearTime(r,!0).valueOf()===r.valueOf()?r=x.add(r,x.DAY,-1):e.valueOf()!==r.valueOf()&&(r=x.clearTime(r,!0))),r}isEditable(e){switch(e){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(e)}};const $r=Fe;class Re extends $r.derive(ee).mixin(Dt,K,An){static get $name(){return"EventModel"}}Re.exposeProperties(),Re._$name="EventModel";const Lr=K(ct.derive(ue));class Ue extends Lr.mixin(Rn,xn,mn,Cn,pn){static get defaultConfig(){return{modelClass:Re}}}F(Ue,"$name","EventStore"),Ue._$name="EventStore";const Nr=["SS","SF","FS","FF"];class ne extends _{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(n){const e=n[this.fieldMap.from.dataSource],r=n[this.fieldMap.to.dataSource];e!=null&&(n.fromEvent=e),r!=null&&(n.toEvent=r),super.construct(...arguments)}get eventStore(){var n;return this.eventStore||((n=this.unjoinedStores[0])===null||n===void 0?void 0:n.eventStore)}set from(n){const{fromEvent:e}=this;e!=null&&e.isModel&&e.id===n?this.set("from",n):this.fromEvent=n}get from(){return this.get("from")}set to(n){const{toEvent:e}=this;e!=null&&e.isModel&&e.id===n?this.set("to",n):this.toEvent=n}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(n){this.setHardType(n)}getHardType(){return this.get("type")}setHardType(n){let e;return n!==this.hardType&&(e=this.set({type:n,fromSide:null,toSide:null})),e}get lag(){return this.get("lag")}set lag(n){this.setLag(n)}setLag(n,e=this.lagUnit){if(arguments.length===1){typeof n=="number"?this.lag=n:(n=x.parseDuration(n),this.set({lag:n.magnitude,lagUnit:n.unit}));return}n=parseFloat(n),this.set({lag:n,lagUnit:e})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${x.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new de({unit:this.lagUnit,magnitude:this.lag})}set fullLag(n){typeof n=="string"?this.setLag(n):this.setLag(n.magnitude,n.unit)}get isPersistable(){const n=this,{stores:e,unjoinedStores:r}=n,s=e[0];let t;if(s){const{fromEvent:i,toEvent:o}=n,l=s.crudManager;t=i&&(l||!i.hasGeneratedId)&&o&&(l||!o.hasGeneratedId)}else t=!!r[0];return t&&super.isPersistable}getDateRange(){const{fromEvent:n,toEvent:e}=this;if(n!=null&&n.isScheduled&&e!==null&&e!==void 0&&e.isScheduled){const r=ne.Type;let s,t;switch(this.type){case r.StartToStart:s=n.startDateMS,t=e.startDateMS;break;case r.StartToEnd:s=n.startDateMS,t=e.endDateMS;break;case r.EndToEnd:s=n.endDateMS,t=e.endDateMS;break;case r.EndToStart:s=n.endDateMS,t=e.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(s,t),end:Math.max(s,t)}}return null}highlight(n){var s;var e;const r=(s=(e=this.highlighted)===null||e===void 0?void 0:e.split(" "))!=null?s:[];r.includes(n)||(this.highlighted=r.concat(n).join(" "))}unhighlight(n){const{highlighted:e}=this;if(e){const r=e.split(" "),s=r.indexOf(n);s>=0&&(r.splice(s,1),this.highlighted=r.join(" "))}}isHighlightedWith(n){return this.highlighted&&this.highlighted.split(" ").includes(n)}getConnectorString(n){const e=Nr[this.type];return n?e:this.type===ne.Type.EndToStart?"":e}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:n,toEvent:e,type:r}=this;return typeof r=="number"&&n&&e&&n!==e}get fromEventName(){var n;return((n=this.fromEvent)===null||n===void 0?void 0:n.name)||""}get toEventName(){var n;return((n=this.toEvent)===null||n===void 0?void 0:n.name)||""}shouldRecordFieldChange(n,e,r){if(!super.shouldRecordFieldChange(n,e,r))return!1;if(n==="from"||n==="to"||n==="fromEvent"||n==="toEvent"){var s;const t=(s=this.project)===null||s===void 0?void 0:s.eventStore;if(t&&t.oldIdMap[e]===t.getById(r))return!1}return!0}}ne.exposeProperties(),ne._$name="DependencyBaseModel";const _r=Oe;class Ee extends K(_r.derive(ne)){static get $name(){return"DependencyModel"}getTypeFromSides(n,e,r){const s=ne.Type,t=r?"right":"left",i=r?"left":"right";return n===t?e===t?s.StartToStart:s.StartToEnd:e===i?s.EndToEnd:s.EndToStart}}Ee.exposeProperties(),Ee._$name="DependencyModel";var wn=a=>class extends a{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(e,r,s,t=!0,i){return i=i||(o=>this.getEventDependencies(o)),e=V.asArray(e),e.reduce((o,l)=>{l.children&&!t?l.traverse(u=>{o=i(u).reduce(r,o)}):o=i(l).reduce(r,o)},s),s}mapEventDependencies(e,r,s,t,i){return this.reduceEventDependencies(e,(o,l)=>(s(l)&&o.push(l),o),[],t,i)}mapEventPredecessors(e,r,s,t){return this.reduceEventPredecessors(e,(i,o)=>(s(o)&&i.push(o),i),[],t)}mapEventSuccessors(e,r,s,t){return this.reduceEventSuccessors(e,(i,o)=>(s(o)&&i.push(o),i),[],t)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,r){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find(r=>e==this.constructor.makeDependencySourceTargetCompositeKey(r.from,r.to))}getDependencyForSourceAndTargetEvents(e,r){return e=_.asId(e),r=_.asId(r),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,r))}getEventsLinkingDependency(e,r){return this.getDependencyForSourceAndTargetEvents(e,r)||this.getDependencyForSourceAndTargetEvents(r,e)}async isValidDependency(e,r,s){let t=e,i=r;return e==null?!1:(e.isDependencyModel&&({fromEvent:t,toEvent:i}=e),t=this.eventStore.getById(t),i=this.eventStore.getById(i),t&&i?!t.project||!i.project?!1:this.project.isValidDependency(t,i,s):e!==r)}isValidDependencyToCreate(e,r,s){return this.isValidDependency(e,r,s)}getHighlightedDependencies(e){return this.records.reduce((r,s)=>(s.isHighlightedWith(e)&&r.push(s),r),[])}static makeDependencySourceTargetCompositeKey(e,r){return`source(${e})-target(${r})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}};const Br=K(ut.derive(ue));class Ct extends wn(Br.derive(ue)){static get defaultConfig(){return{modelClass:Ee}}}Ct._$name="DependencyStore";var Vr=a=>class extends(a||B).mixin(ln,un,cn){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e),this._changesToClear=new Map}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}applyProjectResponse(e){const r=this,{project:s}=r;r.applyingProjectResponse=!0;const t=s.fieldMap.startDate,i=s.fieldMap.endDate,o=$.getPath(e,t.dataSource),l=$.getPath(e,i.dataSource);typeof o=="string"&&$.setPath(e,t.dataSource,t.convert(o)),typeof l=="string"&&$.setPath(e,i.dataSource,i.convert(l)),Object.assign(s,e),r._changesToClear.set(r,e),r.applyingProjectResponse=!1}loadCrudManagerData(e,r={}){const s=this,{project:t}=s;s.suspendChangesTracking(),super.loadCrudManagerData(...arguments),e!=null&&e.project&&(t.delayEnteringReplica?t.ion({recordsUnlinked:()=>{s.suspendChangesTracking(),s.applyProjectResponse(e.project),s.resumeChangesTracking()},once:!0}):s.applyProjectResponse(e.project)),s.resumeChangesTracking()}async sync(){const{project:e}=this;if(this.suspendAutoSync(),e&&await e.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(e,r,s){var t,i,o;const l=this;if(!(l.isDestroyed||(t=l.project)!==null&&t!==void 0&&t.isDestroyed)){if(l.trigger("beforeApplyResponse"),await super.applyResponse(e,r,s),r!=null&&r.project||l.supportShortSyncResponse&&e!==null&&e!==void 0&&(i=e.pack)!==null&&i!==void 0&&i.project){var u;l.applyProjectResponse(r.project||(e==null||(u=e.pack)===null||u===void 0?void 0:u.project))}if(l.project){var c,d;let f=e.type;l.trackResponseType&&(f=r.type||f);const p=`propagating${G.capitalize(f)}Changes`;l.suspendAutoSync(),l[p]=!0;const m=l.project.isInitialCommit&&!l.project.silenceInitialCommit;await l.project.commitAsync(),l[p]=!1,(c=l.resumeAutoSync)===null||c===void 0||c.call(l,m),(d=l.commitRespondedChanges)===null||d===void 0||d.call(l)}(o=l.trigger)===null||o===void 0||o.call(l,"applyResponse")}}applySyncResponse(...e){var r;const s=this,t=(r=s.project)===null||r===void 0?void 0:r.stm.disabled;t===!1&&s.ignoreRemoteChangesInSTM&&s.project.stm.disable(),super.applySyncResponse(...e),t===!1&&s.project.stm.enable()}shouldClearRecordFieldChange(e,r,s){var t;const i=e[r];return r=e.getFieldDefinition(r),(t=r)!==null&&t!==void 0&&t.isEqual?r.isEqual(i,s):$.isEqual(i,s)}commitRespondedChanges(){this._changesToClear.forEach((e,r)=>{Object.entries(e).forEach(([s,t])=>{this.shouldClearRecordFieldChange(r,s,t)&&delete r.meta.modified[s]})}),this._changesToClear.clear()}applyChangesToStore(e,r,s,...t){const i=super.applyChangesToStore(e,r,s,...t);if(i.size&&this.project)for(const[o,l]of i){const u=e.store.getById(o);u&&this._changesToClear.set(u,l)}return i}},Pn=a=>{var n;return n=class extends(a||_){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.allRecords}updateAssignments(r){this.assignmentStore.data=r}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(r){this.dependencyStore.data=r}get resources(){return this.resourceStore.allRecords}updateResources(r){this.resourceStore.data=r}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(r,s){const t=this.timeRangeStore,i=[];for(const o of t)o.isRecurring?i.push(...o.getOccurrencesForDateRange(r,s)):o.startDate<s&&r<o.endDate&&i.push(o);return i}updateTimeRanges(r){this.timeRangeStore.data=r}getResourceTimeRanges(r,s){const t=this.resourceTimeRangeStore,i=[];for(const o of t)o.isRecurring?i.push(...o.getOccurrencesForDateRange(r,s)):o.startDate<s&&r<o.endDate&&i.push(o);return i}},F(n,"$name","ProjectModelCommon"),n};class te extends ee.mixin(Dt){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}}F(te,"$name","ResourceTimeRangeModel"),F(te,"fields",["resourceId","timeRangeColor"]),F(te,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),F(te,"domIdPrefix","resourcetimerange"),te._$name="ResourceTimeRangeModel";class qe extends ue.mixin(ft){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:te,storeId:"resourceTimeRanges"}}set resourceStore(n){this._resourceStore=n,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(n){return[n.resource]}getRanges({resourceRecord:n,startDate:e,endDate:r}){return n.timeRanges.flatMap(t=>t.supportsRecurring?t.getOccurrencesForDateRange(e,r):t.intersectsRange(e,r)?t:[]).sort((t,i)=>t.startDate-i.startDate)}}F(qe,"$name","ResourceTimeRangeStore"),qe._$name="ResourceTimeRangeStore";var jn=a=>{var n;return n=class extends(a||_){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(r=>r)}overrideStoreProcessRecord(r){this._storesWithDates.includes(r)&&!r.$originalProcessRecord&&(r.$originalProcessRecord=Et.before(r,"processRecord",(s,t)=>{(t||r.isLoadingData)&&this.convertRecordToTimeZone(s)}))}attachStore(r){super.attachStore(r),r&&this.timeZone!=null&&this._storesWithDates.includes(r)&&(this.convertStoresToTimeZone([r]),this.overrideStoreProcessRecord())}detachStore(r){if(super.detachStore(r),r&&!r.isDestroyed){const{$originalProcessRecord:s}=r;s&&(s(),r.$originalProcessRecord=null,this.convertStoresToTimeZone([r],null))}}relayStoreChange({source:r,action:s,records:t,replaced:i}){const o=this;if(o.timeZone!=null&&o._storesWithDates.includes(r)&&["add","replace"].includes(s)){var l;!((l=t)!==null&&l!==void 0&&l.length)&&i!==null&&i!==void 0&&i.length&&(t=i),t.length&&t.forEach(u=>u.timeZone=o.timeZone)}}convertStoresToTimeZone(r,s=this.timeZone){var t;const i=this,o=(t=i.stm)===null||t===void 0?void 0:t.autoRecord;o&&(i.stm.autoRecord=!1);for(const l of r)l==null||l.forEach(u=>i.convertRecordToTimeZone(u,s));o&&(i.stmAutoRecord=o)}convertRecordToTimeZone(r,s=this.timeZone){if(r.timeZone!==s){var t;if(r.$ignoreChange=!0,(t=r.baselines)!==null&&t!==void 0&&t.count)for(const i of r.baselines)r.timeZone!==i.timeZone&&(i.timeZone=r.timeZone),i.convertToTimeZone(s);r.convertToTimeZone(s),r.$ignoreChange=!1}}updateTimeZone(r,s){const t=this,i=t._isConfiguringTimeZone||t.isConfiguring;if(t.trigger("beforeTimeZoneChange",{timeZone:r,oldTimeZone:s,isConfiguring:i}),t.calendarManagerStore.forEach(o=>o.bumpVersion()),t.convertStoresToTimeZone(t._storesWithDates),t._storesWithDates.forEach(o=>t.overrideStoreProcessRecord(o)),t.startDate){const o=s!=null?z.fromTimeZone(t.startDate,s):t.startDate;t.startDate=r!=null?z.toTimeZone(o,r):o}t.ignoreRecordChanges=!0,t.commitAsync().then(()=>{t.isDestroyed||t.trigger("timeZoneChange",{timeZone:r,oldTimeZone:s,isConfiguring:i}),delete t._isConfiguringTimeZone})}},F(n,"$name","ProjectModelTimeZoneMixin"),F(n,"configurable",{timeZone:{$config:"lazy",value:null}}),n},On=a=>{var n;return n=class extends(a||_).mixin(Pn,jn){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:ee,resourceTimeRangeModelClass:te,timeRangeStoreClass:N,resourceTimeRangeStoreClass:qe,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return G.safeJsonParse(super.json)}set inlineData(r){this.json=r}construct(r={}){super.construct(...arguments),r.timeRangesData&&(this.timeRangeStore.data=r.timeRangesData),r.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=r.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const r=this;!r.timeRangeStore.stm&&r.stm.addStore(r.timeRangeStore),!r.resourceTimeRangeStore.stm&&r.stm.addStore(r.resourceTimeRangeStore)}attachStore(r){r&&r.ion({name:r.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(r)}detachStore(r){r&&(this.detachListeners(r.$$name),super.detachStore(r))}relayStoreChange(r){return super.relayStoreChange(r),this.trigger("change",{store:r.source,...r,source:this})}updateTimeRangeStore(r,s){this.detachStore(s),this.attachStore(r)}setTimeRangeStore(r){this.timeRangeStore=r}changeTimeRangeStore(r){return r&&!r.isStore&&(r=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},r)),r}updateResourceTimeRangeStore(r,s){this.detachStore(s),this.attachStore(r)}changeResourceTimeRangeStore(r){return r&&!r.isStore&&(r=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},r)),r}setResourceTimeRangeStore(r){this.resourceTimeRangeStore=r}get events(){return this.eventStore.allRecords}updateEvents(r){this.eventStore.data=r}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(r){this.resourceTimeRangeStore.data=r}async loadInlineData(r){return this.isLoadingInlineData=!0,r.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=r.resourceTimeRangesData),r.timeRangesData&&(this.timeRangeStore.data=r.timeRangesData),super.loadInlineData(r)}toJSON(){const r=this,s={eventsData:r.eventStore.toJSON(),resourcesData:r.resourceStore.toJSON(),dependenciesData:r.dependencyStore.toJSON(),timeRangesData:r.timeRangeStore.toJSON(),resourceTimeRangesData:r.resourceTimeRangeStore.toJSON()};return r.eventStore.usesSingleAssignment||(s.assignmentsData=r.assignmentStore.toJSON()),s}get json(){return super.json}changeJson(r){return typeof r=="string"&&(r=G.safeJsonParse(r)),r}updateJson(r){r&&this.loadInlineData(r)}afterChange(r,s){super.afterChange(...arguments),s.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},F(n,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:ee},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),n},Fn=a=>class extends a{getCurrentConfig(e){const r=this,s=super.getCurrentConfig(e);if(s){for(const t of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const i=r[t];if(i){i.count&&(s[i.id+"Data"]=i.getInlineData(e));const o=i.getCurrentConfig(e);o&&Object.keys(o).length>0?s[t]=Object.assign(s[t]||{},o):s[t]&&Object.keys(s[t]).length===0&&delete s[t]}}return s.timeRangeStore&&((r.timeRangeStore.originalModelClass===r.timeRangeModelClass||r.timeRangeStore.originalModelClass.$name==="TimeSpan")&&delete s.timeRangeStore.modelClass,s.timeRangeStore.storeId==="timeRanges"&&delete s.timeRangeStore.storeId,Object.keys(s.timeRangeStore).length===1&&delete s.timeRangeStore),r.taskStore.isTaskStore&&(delete s.eventModelClass,delete s.eventStoreClass,delete s.children),s}}};class kn extends B{set eventStore(n){const e=this;e.eventStoreDetacher&&e.eventStoreDetacher(),e._eventStore=n,n&&n.autoCommit&&(e.eventStoreDetacher=n.ion({beforecommit:e.onEventStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(n){const e=this;e.resourceStoreDetacher&&e.resourceStoreDetacher(),e._resourceStore=n,n&&n.autoCommit&&(e.resourceStoreDetacher=n.ion({beforecommit:e.onResourceStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(n){const e=this;e.assignmentStoreDetacher&&e.assignmentStoreDetacher(),e._assignmentStore=n,n&&n.autoSync&&(e.assignmentStoreDetacher=n.ion({beforecommit:e.onAssignmentStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(n){const e=this;e.dependencyStoreDetacher&&e.dependencyStoreDetacher(),e._dependencyStore=n,n&&n.autoSync&&(e.dependencyStoreDetacher=n.ion({beforecommit:e.onDependencyStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:n}){const e=this;return e.removeNonPersistableRecordsToCreate(n),e.shallContinueSync(n)}onResourceStoreBeforeSync({changes:n}){const e=this;return e.removeNonPersistableRecordsToCreate(n),e.shallContinueSync(n)}onAssignmentStoreBeforeSync({changes:n}){const e=this;return e.removeNonPersistableRecordsToCreate(n),e.shallContinueSync(n)}onDependencyStoreBeforeSync({changes:n}){const e=this;return e.removeNonPersistableRecordsToCreate(n),e.shallContinueSync(n)}removeNonPersistableRecordsToCreate(n){const e=n.added||[];let r,s;for(s=e.length-1;s>=0;--s)r=e[s],r.isPersistable||e.splice(e.indexOf(r),1);e.length===0&&(n.added.length=0)}shallContinueSync(n){return!!(n.added&&n.added.length>0||n.modified&&n.modified.length>0||n.removed&&n.removed.length>0)}}kn._$name="ModelPersistencyManager";const Yr=rn;class We extends Fn(On(Yr)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:Re,dependencyModelClass:Ee,resourceModelClass:pe,assignmentModelClass:Ce,eventStoreClass:Ue,dependencyStoreClass:Ct,resourceStoreClass:ht,assignmentStoreClass:ke}}construct(...n){super.construct(...n),ce.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new kn({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}We.applyConfigs=!0,We.initClass(),We._$name="ProjectModel";export{Wt as AbstractAssignmentStoreMixin,zt as AbstractCalendarManagerStoreMixin,Yt as AbstractCalendarMixin,ln as AbstractCrudManagerMixin,sn as AbstractCrudManagerValidation,Ht as AbstractDependencyStoreMixin,Kt as AbstractEventStoreMixin,Ut as AbstractHasAssignmentsMixin,Ae as AbstractPartOfProjectGenericMixin,De as AbstractPartOfProjectModelMixin,q as AbstractPartOfProjectStoreMixin,tn as AbstractProjectMixin,Z as AbstractRecurrenceIterator,Zt as AbstractResourceStoreMixin,un as AjaxTransport,Ce as AssignmentModel,dn as AssignmentModelMixin,ke as AssignmentStore,hn as AssignmentStoreMixin,X as CI,at as CIFromSetOrArrayOrValue,kt as CalendarCache,xe as CalendarCacheInterval,_t as CalendarCacheSingle,it as CalendarIntervalMixin,Bt as CalendarIntervalStore,Y as CalendarIteratorResult,st as ConstraintIntervalSide,Ge as ConstraintType,je as CoreAssignmentMixin,ot as CoreAssignmentStoreMixin,Gt as CoreCalendarManagerStoreMixin,lt as CoreCalendarMixin,Oe as CoreDependencyMixin,ut as CoreDependencyStoreMixin,H as CoreEventMixin,ct as CoreEventStoreMixin,Qt as CoreHasAssignmentsMixin,en as CoreHasDependenciesMixin,we as CorePartOfProjectGenericMixin,ge as CorePartOfProjectModelMixin,me as CorePartOfProjectStoreMixin,fe as CoreResourceMixin,dt as CoreResourceStoreMixin,Dr as CrudManagerView,Ne as DailyRecurrenceIterator,Cn as DayIndexMixin,nn as DelayableWrapper,tt as DependenciesCalendar,ne as DependencyBaseModel,Ee as DependencyModel,Ct as DependencyStore,wn as DependencyStoreMixin,et as DependencyType,Qe as DependencyValidationResult,rt as Direction,ie as EdgeInclusion,Le as EventDayIndex,Re as EventModel,An as EventModelMixin,Ue as EventStore,mn as EventStoreMixin,pn as GetEventsMixin,ae as IndexPosition,Nt as IntervalCache,cn as JsonEncoder,Q as MAX_DATE,Pt as MI,se as MIN_DATE,P as Mixin,ur as MixinAny,Be as MonthlyRecurrenceIterator,K as PartOfProject,Vr as ProjectCrudManager,Fn as ProjectCurrentConfig,We as ProjectModel,Pn as ProjectModelCommon,On as ProjectModelMixin,jn as ProjectModelTimeZoneMixin,nt as ProjectType,ve as RecurrenceDayRuleEncoder,St as RecurrenceModel,xn as RecurringEventsMixin,Dt as RecurringTimeSpan,ft as RecurringTimeSpansMixin,pe as ResourceModel,fn as ResourceModelMixin,ht as ResourceStore,gn as ResourceStoreMixin,te as ResourceTimeRangeModel,qe as ResourceTimeRangeStore,Fe as SchedulerCoreEvent,rn as SchedulerCoreProjectMixin,Xe as SchedulingMode,Rn as SharedEventStoreMixin,Lt as SortedMap,ee as TimeSpan,he as TimeUnit,In as TimeZonedDatesMixin,Vt as UnspecifiedTimeIntervalModel,_e as WeeklyRecurrenceIterator,Ve as YearlyRecurrenceIterator,Se as binarySearch,nr as concat,At as concatIterable,qt as delay,hr as format,cr as isDateFinite,U as isInstanceOf,dr as isNotNumber,L as later,Tt as map,$t as stripDuplicates,bt as uniqueOnly};
//# sourceMappingURL=ProjectModel.js.map
