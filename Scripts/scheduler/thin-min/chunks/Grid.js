/*!
 *
 * Bryntum Scheduler Pro 5.3.7
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var R=Object.defineProperty;var x=(u,l,e)=>l in u?R(u,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[l]=e;var h=(u,l,e)=>(x(u,typeof l!="symbol"?l+"":l,e),e);import{GridFeatureManager as f,GridBase as v}from"./GridBase.js";import{Delayable as S,InstancePlugin as b}from"./Editor.js";const y="store";class m extends S(b){static get $name(){return"ColumnAutoWidth"}static get configurable(){return{default:null,delay:0}}static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(l){super.construct(l);const{store:e}=this.client;e&&this.bindStore(e)}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(l){this.lastSync=null,l.ion({name:y,[`change${this.client.asyncEventSuffix}`]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(y)}get columnAutoWidthPending(){return this.lastSync===null||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:l}){if(l!=="move"){const e=this,{cellEdit:t}=e.client.features;++e.storeGeneration,t!=null&&t.isEditing&&!t.editingStoppedByTapOutside?e.syncAutoWidthColumns():e.hasTimeout("syncAutoWidthColumns")||e.setTimeout("syncAutoWidthColumns",e.delay)}}onInternalResize(l,e,t,i){i===0&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){const l=this,e=l.client,t=l.storeGeneration;if(l.lastSync!==t){l.lastSync=t;let i,o;for(const s of e.columns.visibleColumns)i=s.autoWidth,i&&(i===!0&&(i=l.default),e.resizingColumns=o=!0,s.resizeToFitContent(i));o&&(e.resizingColumns=!1,e.afterColumnsResized())}l.hasTimeout("syncAutoWidthColumns")&&l.clearTimeout("syncAutoWidthColumns")}}m.prototype.storeGeneration=0,m._$name="ColumnAutoWidth",f.registerFeature(m,!0);class d extends b{constructor(){super(...arguments);h(this,"clipboardRecords",[]);h(this,"entityName","row")}construct(e,t){super.construct(e,t),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}onBeforeRenderRow({row:e,record:t}){e.cls["b-cut-row"]=this._isCut&&this.clipboardRecords.includes(t)}isActionAvailable({event:e}){var t;const{grid:i}=this,{cellEdit:o}=i.features,{target:s}=e;return!this.disabled&&globalThis.getSelection().toString().length===0&&(!o||!o.isEditing)&&((t=i.selectedRecords)===null||t===void 0?void 0:t.length)>0&&(!s||!!s.closest(".b-gridbase:not(.b-schedulerbase) .b-grid-subgrid,.b-grid-subgrid:not(.b-timeaxissubgrid)"))}copy(){this.copyRows()}cut(){this.copyRows(!0)}paste(e){this.pasteRows(e!=null&&e.isModel?e:null)}copyRows(e=!1){const t=this,{client:i,entityName:o}=t,s=t.selectedRecords.filter(r=>!r.readOnly||!e);!s.length||i.readOnly||i.trigger("beforeCopy",{records:s,isCut:e,entityName:o})===!1||(t._isCut=e,t.clipboardRecords.forEach(r=>{var n;return(n=i.rowManager.getRowById(r))===null||n===void 0?void 0:n.removeCls("b-cut-row")}),t.clipboardRecords=s.slice(),i.store.forEach(r=>{r.meta.isCut=t._isCut&&t.clipboardRecords.includes(r)}),s.forEach(r=>this.onRowCutOrCopy(r,e)),i.trigger("copy",{records:s,isCut:e,entityName:o}))}onRowCutOrCopy(e,t){var i;(i=this.client.rowManager.getRowById(e))===null||i===void 0||i.toggleCls("b-cut-row",t)}pasteRows(e){var t,i;const o=this,s=o.clipboardRecords,{client:r,entityName:n}=o,{store:a}=r,c=e||r.selectedRecord;if(r.readOnly||r.isTreeGrouped||!s.length||a.tree&&o._isCut&&s.some(w=>w.contains(c,!0))||r.trigger("beforePaste",{records:s,referenceRecord:c,isCut:o._isCut,entityName:n})===!1)return[];o.sortByIndex(s);const g={},p=o.extractParents(s,g);return o.insertCopiedRecords(p,c),o._isCut?o.clearClipboard():r.selectedRecords=p,r.trigger("paste",{records:p,originalRecords:s,isCut:o._isCut,referenceRecord:c,entityName:n}),(t=r.getRowFor(p[p.length-1]))===null||t===void 0||(i=t.cells)===null||i===void 0||i[0].focus(),p}clearClipboard(){this._isCut&&this.clipboardRecords.forEach(e=>{var t;return(t=this.client.rowManager.getRowById(e))===null||t===void 0?void 0:t.removeCls("b-cut-row")}),this._isCut=!1,this.clipboardRecords=[]}generateNewName(e){const t=e[this.nameField];let i=2;for(;this.client.store.findRecord(this.nameField,`${t} - ${i}`);)i++;return`${t} - ${i}`}insertCopiedRecords(e,t){const{store:i}=this.client,o=i.indexOf(t)+1;if(i.tree)return t.parent.insertChild(e,t.nextSibling,!1,{orderedBeforeNode:t.nextOrderedSibling});if(this._isCut)i.move(e,i.getAt(o));else return i.insert(o,e)}get selectedRecords(){const e=[...this.client.selectedRecords];return this.client.selectedCells.forEach(t=>{e.includes(t.record)||e.push(t.record)}),e}getMenuItemText(e,t=!1){const i=this;let o=i[e+"RecordText"];return t&&(o+=` (${i.selectedRecords.length>1?i.rowSpecifierTextPlural:i.rowSpecifierText})`),o}populateCellMenu({record:e,items:t,cellSelector:i}){var o;const s=this,{client:r,rowOptionsOnCellContextMenu:n}=s,a=((o=r.features.cellCopyPaste)===null||o===void 0?void 0:o.enabled)===!0,c=a&&r.isCellSelected(i);!r.readOnly&&!r.isTreeGrouped&&(e==null?void 0:e.isSpecialRow)===!1&&(a?r.selectedRows.length:r.selectedRecords.length)&&(!c||s.rowOptionsOnCellContextMenu)&&(t.cut={text:s.getMenuItemText("cut",c&&n),localeClass:s,icon:"b-icon b-icon-cut",weight:135,disabled:e.readOnly,onItem:()=>s.cut()},t.copy={text:s.getMenuItemText("copy",c&&n),localeClass:s,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:()=>s.copy()},t.paste={text:s.getMenuItemText("paste",c&&n),localeClass:s,icon:"b-icon b-icon-paste",weight:140,disabled:!s.clipboardRecords.length,onItem:()=>s.paste(e)})}sortByIndex(e){const{store:t}=this.client;return e.sort((i,o)=>{const s=i.indexPath,r=o.indexPath;if(!e.includes(i.parent)&&!e.includes(o.parent))return t.indexOf(i)-t.indexOf(o);if(s.length===r.length){for(let n=0;n<s.length;n++){if(s[n]<r[n])return-1;if(s[n]>r[n])return 1}return 0}else return s.length-r.length})}extractParents(e,t){const i=this,{client:o,_isCut:s}=i;o.store.tree&&e.forEach(n=>{n.traverse(a=>{const c=a.getTopParent(!0);!e.includes(a)&&(!s||!e.some(g=>c.includes(g)))&&e.push(a)})});const r=e.reduce((n,a)=>{let c;const g=a.parentId||a.meta.modified;return s?(c=a,c.meta.isCut=!1):(c=a.copy(),c[i.nameField]=i.generateNewName(c),c.data.expanded=a.isExpanded(o.store)),t[a.id]=c,a.parent===o.store.rootNode?n.push(c):g in t?t[g].appendChild(c,!0):n.push(c),n},[]);return r.forEach(n=>{n.sortOrderedChildren(!0,!0)}),r}}h(d,"$name","RowCopyPaste"),h(d,"type","rowCopyPaste"),h(d,"pluginConfig",{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}),h(d,"configurable",{nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1}),d.featureClass="b-row-copypaste",d._$name="RowCopyPaste",f.registerFeature(d,!0,"Grid"),f.registerFeature(d,!1,"Gantt"),f.registerFeature(d,!1,"SchedulerPro"),f.registerFeature(d,!1,"ResourceHistogram");class C extends v{static get $name(){return"Grid"}static get type(){return"grid"}}C.initClass(),C._$name="Grid";export{m as ColumnAutoWidth,C as Grid,d as RowCopyPaste};
//# sourceMappingURL=Grid.js.map
