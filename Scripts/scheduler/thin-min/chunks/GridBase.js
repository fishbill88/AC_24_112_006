/*!
 *
 * Bryntum Scheduler Pro 5.3.7
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var ut=Object.defineProperty;var ht=(m,e,t)=>e in m?ut(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var I=(m,e,t)=>(ht(m,typeof e!="symbol"?e+"":e,t),t);import{Widget as J,DomHelper as p,Model as $e,Events as gt,Localizable as Ve,Config as ft,ObjectHelper as w,StringHelper as B,Store as Me,Objects as mt,Delayable as Te,InstancePlugin as $,Editor as pt,GlobalEvents as T,ContextMenuBase as je,BrowserHelper as O,EventHelper as X,TemplateHelper as ie,ScrollManager as Ke,ArrayHelper as L,VersionHelper as K,Tooltip as qe,CollectionFilter as Ue,DomSync as he,DomDataStore as G,DomClassList as Le,Base as j,Rectangle as D,Scroller as De,Collection as Xe,LocaleHelper as bt,Panel as Ct,Pluggable as vt,State as wt,LoadMaskable as St,LocaleManagerSingleton as Ye,AjaxStore as yt,Mask as xt}from"./Editor.js";import{WidgetHelper as ge,Checkbox as Rt,MessageDialog as fe,DragHelper as Et,ResizeHelper as Ft,FieldFilterPicker as It,SUPPORTED_FIELD_DATA_TYPES as Ht,isSupportedDurationField as Je,FieldFilterPickerGroup as Mt}from"./MessageDialog.js";import{GridRowModel as Qe}from"./GridRowModel.js";class y{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const t=J.fromElement(e,"gridbase"),i=t&&e.closest(t.focusableSelector);if(i){const{dataset:r}=i.parentNode;this.init({grid:t,rowIndex:t.store.includes(r.id)?t.store.indexOf(r.id):r.index||-1,columnId:i.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var t;const i=this,r=i.grid=e.grid,{store:l,columns:o}=r,{visibleColumns:s}=o;if(e.target&&(i.actionTargets=[i._target=e.target]),e.record)i._id=e.record.id;else if("id"in e)i._id=e.id,e.id==null&&(i._rowIndex=-1);else{var n;const a=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;i._rowIndex=Math.max(Math.min(Number(a),l.count-1),r.hideHeaders?0:-1),i._id=(n=l.getAt(i._rowIndex))===null||n===void 0?void 0:n.id}if("_rowIndex"in i||(i._rowIndex=l.indexOf(i.id)),i.isSpecialRow=(t=i.record)===null||t===void 0?void 0:t.isSpecialRow,"columnId"in e)i._column=o.getById(e.columnId);else if("field"in e)i._column=o.get(e.field);else{const a=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(a)?i._column="column"in e?isNaN(e.column)?e.column:s[e.column]:s[0]:(i._columnIndex=Math.min(Number(a),s.length-1),i._column=s[i._columnIndex])}"_columnIndex"in i||(i._columnIndex=s.indexOf(i._column))}get isLocation(){return!0}equals(e,t=!1){const i=this;return(e==null?void 0:e.isLocation)&&e.grid===i.grid&&(t?i.id===e.id&&i._column===e._column:e.record===i.record&&e.column===i.column&&e.target===i.target)}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return t===-1?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return e!=null&&e.includes(this._column)?this._column:e==null?void 0:e[this.columnIndex]}get columnId(){var e;return(e=this.column)===null||e===void 0?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,((e=this.grid.columns.visibleColumns)===null||e===void 0?void 0:e.length)-1)}move(e){const t=this,{record:i,column:r,grid:l}=t,{store:o}=l,s=l.columns.visibleColumns,n=new y;let a=o.includes(i)?o.indexOf(i):t.rowIndex,d=s.includes(r)?s.indexOf(r):t.columnIndex;const u=l.hideHeaders?0:-1,c=o.count-1,h=s.length-1,g=a===u,f=a===c,C=d===0,b=d===h;switch(e){case y.PREV_CELL:C?g||(d=h,a--):d--;break;case y.NEXT_CELL:b?f||(d=0,a++):d++;break;case y.UP:g||a--;break;case y.DOWN:f||(a===-1?a=l.rowManager.firstFullyVisibleRow.dataIndex:a++);break;case y.FIRST_COLUMN:d=0;break;case y.LAST_COLUMN:d=h;break;case y.FIRST_CELL:a=u,d=0;break;case y.LAST_CELL:a=c,d=h;break;case y.PREV_PAGE:a=Math.max(u,a-Math.floor(l.scrollable.clientHeight/l.rowHeight));break;case y.NEXT_PAGE:a=Math.min(c,a+Math.floor(l.scrollable.clientHeight/l.rowHeight));break}return n.init({grid:l,rowIndex:a,columnIndex:d}),n}get cell(){const e=this,{grid:t,id:i,_cell:r}=e;if(r)return r;if(i==null){var l;return(l=t.columns.getById(e.columnId))===null||l===void 0?void 0:l.element}else{const{row:s}=e;if(s){var o;return s.getCell(e.columnId)||s.getCell((o=t.columns.getAt(e.columnIndex))===null||o===void 0?void 0:o.id)}}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:i}=this.grid;if(e)return t||(i.currentNode=this.grid.focusableFinderCell=e,i.nextNode()||e)}get isActionable(){const{cell:e,_target:t}=this,i=e&&p.getActiveElement(e);return!!(i&&e.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY||t&&t!==this.cell)}get isColumnHeader(){return this.cell&&this.rowIndex===-1}get isCell(){return this.cell&&this.record}}y.UP=1,y.NEXT_CELL=2,y.DOWN=3,y.PREV_CELL=4,y.FIRST_COLUMN=5,y.LAST_COLUMN=6,y.FIRST_CELL=7,y.LAST_CELL=8,y.PREV_PAGE=9,y.NEXT_PAGE=10,y._$name="Location";const Ze=m=>typeof m=="number"||(m==null?void 0:m.endsWith("px"));class H extends $e.mixin(gt,Ve){static get $name(){return"Column"}static get type(){return"column"}static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t,i){if(!e)return!1;if(e===!0)return!0;const r={};return typeof e=="function"?(r.originalSortFn=e,r.sortFn=e.bind(i)):typeof e=="object"&&(Object.assign(r,e),r.fn&&(r.sortFn=r.fn,delete r.fn)),r}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(e===!0)return!0;const t={columnOwned:!0};return typeof e=="function"?t.filterFn=e:typeof e=="object"&&Object.assign(t,e),t}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,t){var i;const r=this;r.masterStore=t,t&&(r._grid=Array.isArray(t)?t[0].grid:t.grid),r.localizableProperties=ft.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(r.localeClass=e.localeClass),super.construct(...arguments),r.isLeaf&&!("field"in r.data)&&(r.field="_"+(r.type||"")+ ++H.emptyCount,r.noFieldSpecified=!0),r.hasComplexMapping=(i=r.field)===null||i===void 0?void 0:i.includes("."),!r.width&&!r.flex&&!r.children&&r.set({width:H.defaultWidth,flex:null},null,!0),r.headerWidgets&&r.initHeaderWidgets(r.headerWidgets),r.isParent&&(r.meta.visibleChildren=new Set,r.collapsible&&(r.collapsible=!0))}shouldSync(e){return e.isColumn&&e.text===this.text&&(e.field===this.field||String(e.renderer)===String(this.renderer))&&(!e.previousSibling&&!this.previousSibling||e.previousSibling.shouldSync(this.previousSibling))}get isCollapsible(){var e;return((e=this.children)===null||e===void 0?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),e.rowIndex!==-1&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){p.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var t,i;if(!((t=this.location)!==null&&t!==void 0&&t.isSpecialRow)&&(i=this.location)!==null&&i!==void 0&&i.cell){var r;(r=e)!==null&&r!==void 0&&r.length||(e=this.location.column.text),p.setAttributes(this.location.cell,{"aria-label":e})}}doDestroy(){var e,t,i;(e=this.data)===null||e===void 0||(t=e.editor)===null||t===void 0||(i=t.destroy)===null||i===void 0||i.call(t),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const t=this.headerWidgetMap={};for(const i of e){const r=J.create({owner:this,...i});t[r.ref||r.id]=r}}destroyHeaderWidgets(){for(const t of Object.values(this.headerWidgetMap||{})){var e;(e=t.destroy)===null||e===void 0||e.call(t)}}static generateAutoCls(){const e=[];for(let i=this;i!==H;i=i.superclass)i.type&&i.type!==i.superclass.type&&e.push(`b-${i.type.toLowerCase()}-cell`);const t=e.join(" ");return(H.autoClsMap||(H.autoClsMap=new Map)).set(this,t),t}getCellClass(e){var t,i;const{record:r,column:l}=e,{cellCls:o,internalCellCls:s,grid:n,constructor:a,align:d}=l,u=((t=H.autoClsMap)===null||t===void 0?void 0:t.get(a))||a.generateAutoCls(),c=e.cell.classList.contains("b-editing"),h={[n.cellCls]:n.cellCls,[u]:u,[o]:o,[s]:s,"b-cell-dirty":r.isFieldModified(l.field)&&(l.compositeField||((i=r.fieldMap[l.field])===null||i===void 0?void 0:i.persist)!==!1),[`b-grid-cell-align-${d}`]:d,"b-selected":n.selectionMode.cell&&n.isCellSelected(e),"b-focused":n.isFocused(e),"b-auto-height":l.autoHeight,"b-editing":c};return r.isSpecialRow&&h["b-checkbox-selection"]&&(h["b-checkbox-selection"]=!1),h}get locked(){return this.data.region==="locked"}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}get editor(){const e=this;let{editor:t}=e.data;if(t&&!t.isWidget){const i=e.grid.processCellEditor({editor:t,field:e.field});i?t=e.data.editor=i.editor:(typeof t=="string"&&(t={type:t}),t=e.data.editor=J.create(w.merge(e.defaultEditor,{owner:e.grid,label:B.encodeHtml(e.text)},t)))}return t}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||((e=this.parent)===null||e===void 0?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||((e=this.grid)===null||e===void 0?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get previousVisibleSibling(){const e=this.region;let t=this.previousSibling;for(;t&&(t.hidden||t.region!==e);)t=t.previousSibling;return t}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get allowDrag(){return!this.parent.isRoot||!!(this.nextVisibleSibling||this.previousVisibleSibling)}get textWrapper(){return p.getChild(this.element,".b-grid-header-text")}get textElement(){return p.down(this.element,".b-grid-header-text-content")}get contentElement(){return p.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some(e=>e.field===this.field)}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?B.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const i=this,{parent:r}=i;i.hidden||(i.hidden=!0,r&&!r.isRoot&&!r.isTogglingAll&&!r.children.some(o=>o.hidden!==!0)&&!r.hidden&&(e=!0,r.hide()),i.isParent?i.children.forEach(l=>l.hide(!0,!0)):r.isRoot||r.meta.visibleChildren[t?"add":"delete"](i),e||i.stores.forEach(l=>l.trigger("columnHide",{column:i})))}show(e=!1){const t=this,{parent:i}=t;if(t.hidden){if(t.hidden=!1,i!=null&&i.hidden&&i.show(),t.isParent){var r;(r=t.meta.visibleChildren)===null||r===void 0||r.forEach(l=>l.show(!0))}e||t.stores.forEach(l=>l.trigger("columnShow",{column:t}))}}toggle(e){if(this.hidden&&e===void 0||e===!0)return this.show();if(!this.hidden&&e===void 0||e===!1)return this.hide()}toggleChildren(e=this.children,t=void 0){var i,r;const l=this;(i=l.grid.columns)===null||i===void 0||i.beginBatch(),l.isTogglingAll=!0,e.forEach(o=>o.toggle(t)),l.isTogglingAll=!1,(r=l.grid.columns)===null||r===void 0||r.endBatch()}onCollapseChange(e=void 0){const t=this;if(t.collapseMode==="toggleAll")t.toggleChildren();else{var i,r;const{firstChild:l}=t;l.flex!=null&&t.collapsed?(l.oldFlex=l.flex,l.width=l.element.offsetWidth):!t.collapsed&&l.oldFlex&&(l.flex=l.oldFlex,l.oldFlex=null),(i=t.grid.columns)===null||i===void 0||i.beginBatch(),t.isTogglingAll=!0,t.children.slice(1).forEach(o=>o.toggle(e)),t.isTogglingAll=!1,(r=t.grid.columns)===null||r===void 0||r.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:i=[]}=t;if(e)i.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:`b-icon-collapse-${t.grid.rtl?"right":"left"}`,pressedIcon:`b-icon-collapse-${t.grid.rtl?"left":"right"}`,cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:r})=>t.collapsed=r});else{const r=i.findIndex(l=>l.ref==="collapseExpand");r>-1&&i.splice(r,1)}t.headerWidgets=i,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return H.generatedIdIndex||(H.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++H.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var t;return p.measureSize(e,(t=this.subGrid)===null||t===void 0?void 0:t.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return Ze(e)&&Ze(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),i=e.measureSize(e.minWidth);let r=0;return e.children&&(r=e.children.reduce((l,o)=>l+o.calculateMinWidth(),0)),Math.max(t,i,r)}resizeToFitContent(e,t,i=!1){const r=this,{grid:l,element:o,fitMode:s}=r,{rowManager:n,store:a}=l,{count:d}=a;if(d<=0||r.fitMode==="none"||!r.fitMode)return;const[u]=n.rows,{rowElement:c,cellElement:h}=l.beginGridMeasuring(),g=new y({grid:l,column:r,id:null});let f=0,C,b,x,S,E,v,R={length:0,record:null};if(h._domData={columnId:r.id,row:u,rowElement:c},g._cell=h,g.updatingSingleRow=!0,g.isMeasuring=!0,h.innerHTML="",l.resizeToFitIncludesHeader){if(!l.$headerPadding){const M=globalThis.getComputedStyle(o);l.$headerPadding=parseInt(M.paddingLeft)}const F=o.querySelector(".b-grid-header-text-content");F.style.cssText="flex: none; width: auto",f=F.offsetWidth+l.$headerPadding*2+2,F.style.cssText=""}for(d>1e3?(C=Math.max(Math.min(n.topIndex+Math.round(n.rowCount/2)-500,d-1e3),0),b=C+1e3):(C=0,b=d),x=C;x<b;x++){if(S=a.getAt(x),E=r.getRawValue(S),s==="value")v=String(E).length;else if(g._record=R.record,g._id=S.id,g._rowIndex=x,u.renderCell(g),s==="textContent")v=h.textContent.length;else{const F=h.offsetWidth;F>f&&(f=F)}v>R.length&&(R={record:S,length:v,rowIndex:x})}return R.length>0&&(s==="value"||s==="textContent")&&(g._record=R.record,g._id=R.record.id,g._rowIndex=R.rowIndex,u.renderCell(g),f=Math.max(f,h.offsetWidth)),Array.isArray(e)&&([e,t]=e),f=Math.max(f,e||0),f=Math.min(f,t||1e6),i||l.endGridMeasuring(),r.width=r.maxWidth?f=Math.min(f,r.maxWidth):f,f}getState(){const e=this,t={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(t[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(t.collapsed=e.collapsed),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"region"in e&&(t.region=e.region),t.endBatch(),"hidden"in e&&t.toggle(e.hidden!==!0),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:t}=this,i=e&&(t==null?void 0:t.focusedCell);(i==null?void 0:i.columnId)===this.id&&(t.owns(p.getActiveElement(t))?t.navigateRight():t._focusedCell=new y({grid:t,rowIndex:i.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return this.hasComplexMapping?w.getPath(e,this.field):e[this.field]}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const t=e.isEditable(this.field);if(t!==void 0)return t}return!0}insertChild(e,t=null,i=!1){return e=Array.isArray(e)?e:[e],e.forEach(r=>{const{parent:l}=r;l!=null&&l.collapsed&&r===l.firstChild&&l.children.length>1&&l.children.filter(o=>!o.hidden).length===1&&(r.nextSibling.hidden=!1)}),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(e){var t;const i=super.getCurrentConfig(e);return(t=this.sortable)!==null&&t!==void 0&&t.originalSortFn&&(i.sortable=this.sortable.originalSortFn),i.renderer===this.internalRenderer&&delete i.renderer,i.headerRenderer===this.internalHeaderRenderer&&delete i.headerRenderer,delete i.ariaLabel,delete i.cellAriaLabel,i}}H.emptyCount=0,H.defaultWidth=100,H.exposeProperties(),H._$name="Column";const Tt={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},Lt=[{field:"region"}];class k extends Ve(Me){static get defaultConfig(){return{modelClass:H,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:Lt,reapplySortersOnAdd:!0}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`,e.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.ion({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}doDestroy(){const e=[];this.isChained||this.traverse(t=>e.push(t)),super.doDestroy(),this.isChained||e.forEach(t=>t.destroy())}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile((i,r)=>e.call(t,i,r),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach(i=>e+=this.calculateFixedWidth(i)):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some(e=>e.flex)}calculateFixedWidth(e){return e.flex?e.measureSize(H.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter(t=>t.isVisible&&(!t.subGrid||!t.subGrid.collapsed))),e._visibleColumns}onStoreChange({action:e,changes:t}){e==="update"&&!("hidden"in t)||this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,(e=this.masterStore)===null||e===void 0||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),(e.action!=="update"||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,i=!1){const r=this.visibleColumns,l=e instanceof H?e:this.getById(e);let o=r.indexOf(l)+(t?1:-1);if(!r[o])if(i)o=t?0:r.length-1;else return null;return r[o]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var t,i;const{grid:r={}}=this,{store:l}=r,o=l==null||(t=l.modelClass)===null||t===void 0||(i=t.fieldMap)===null||i===void 0?void 0:i[e.field];let s=this.modelClass;if(o!=null&&o.column&&(e=mt.merge({},o.column,e)),e.type&&(s=k.getColumnClass(e.type),!s))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const n=new s(e,this);if(n.data.region||(n.data.region=r.defaultRegion||"normal"),this.autoAddField&&!n.noFieldSpecified&&l&&!o){let a=n.field;n.constructor.fieldType&&(a={name:n.field,type:n.constructor.fieldType}),l.modelClass.addField(a)}return n}indexOf(e){if(e==null)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex(i=>i.field===e)}get usesAutoHeight(){return this.find(e=>e.autoHeight)}get usesFlexAutoHeight(){return this.find(e=>e.autoHeight&&e.flex!=null)}resolveSyncNode(e){return e.id?super.resolveSyncNode(e):e.field?{id:e.field,node:this.allRecords.find(t=>t.field===e.field)}:e.type?{id:e.type,node:this.allRecords.find(t=>t.type===e.type)}:{id:null,node:null}}static registerColumnType(e,t=!1){e.simpleRenderer=t,(k.columnTypes||(k.columnTypes={}))[e.type]=e}static getColumnClass(e){return k.columnTypes&&k.columnTypes[e]}generateColumnForField(e,t){if(typeof e=="string"&&this.grid){var i;e=(i=this.grid.store)===null||i===void 0?void 0:i.modelClass.fieldMap[e]}let r=e.column||Tt[e.type]||{};return typeof r=="string"&&(r={type:r}),r=Object.assign({text:e.text||B.separate(e.name),field:e.name},t,r),e.precision!=null&&(r.format.maximumFractionDigits=e.precision),e.columnType&&(r.type=e.columnType),this.createRecord(r)}}const Dt=(m,e)=>({update:({store:t,record:i,changes:r})=>{let l=!0;return("width"in r||"minWidth"in r||"maxWidth"in r||"flex"in r)&&(l=m.call(e,{store:t,record:i,changes:r})),l}});k.registerColumnType(H,!0),k._$name="ColumnStore";class q extends H{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(e,t){const i=this;i.widgetMap={},super.construct(...arguments),i.externalRenderer=i.renderer,i.renderer=i.internalRenderer}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const t of Object.values(this.widgetMap))t.cellInfo.record.readOnly||(t.readOnly=e)}internalRenderer(e){var t;const i=this,{cellElement:r,column:l,record:o,isExport:s}=e,{widgets:n}=l;return!s&&n&&(r.widgets||i.clearCell(r),r.widgets=e.widgets=n.map((a,d)=>{var u,c;let h,g;if(r.widgets&&(h=r.widgets[d],g=h.element.nextElementSibling,a.recreate&&h&&(delete i.widgetMap[h.id],h.destroy(),r.widgets[d]=null)),h||(i.onBeforeWidgetCreate(a,e),a.recomposeAsync=!1,a.owner=i.grid,h=ge.append(a,g?{insertBefore:g}:r)[0],i.widgetMap[h.id]=h,i.onAfterWidgetCreate(h,e),h.name&&h.ion({change:({value:f,userAction:C})=>{C&&(h.cellInfo.record[h.name]=f)}})),h.cellInfo={record:o,column:l},i.grid&&!i.meta.isSelectionColumn&&(h.readOnly=i.grid.readOnly||o.readOnly),((u=i.onBeforeWidgetSetValue)===null||u===void 0?void 0:u.call(i,h,e))!==!1){const f=a.valueProperty||"value"in h&&"value"||h.defaultBindProperty;if(f){const C=h.name?o[h.name]:e.value;h[f]=C}}return(c=i.onAfterWidgetSetValue)===null||c===void 0||c.call(i,h,e),h})),s?null:(t=this.externalRenderer)===null||t===void 0?void 0:t.call(this,e)}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach(t=>{delete this.widgetMap[t.id],t.destroy()}),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}I(q,"$name","WidgetColumn"),I(q,"type","widget"),I(q,"fields",["widgets"]),k.registerColumnType(q),q.exposeProperties(),q._$name="WidgetColumn";class Y extends q{construct(e,t){super.construct(...arguments);const i=this;if(Object.assign(i,{externalHeaderRenderer:i.headerRenderer,externalOnBeforeWidgetSetValue:i.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:i.onAfterWidgetSetValue,onBeforeWidgetSetValue:i.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:i.internalOnAfterWidgetSetValue,headerRenderer:i.internalHeaderRenderer}),!i.meta.isSelectionColumn){var r;const l=(r=i.grid)===null||r===void 0?void 0:r.store.modelClass;i.field?l&&!l.fieldMap[i.field]&&!i.constructor.suppressNoModelFieldWarning&&(console.warn(i.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),l.addField({name:i.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var e;(e=this.headerCheckbox)===null||e===void 0||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:t}){let i;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new Rt({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:t}})):i=t.headerText,i=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):i,t.showCheckAll?void 0:i}updateCheckAllState(e){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=e,this.headerCheckbox.resumeEvents())}onCheckAllChange({checked:e}){const t=this;if(t.field){const{store:i}=t.grid;i.beginBatch(),i.forEach(r=>t.updateRecord(r,t.field,e)),i.endBatch()}t.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:t,record:i,cellElement:r}){if(t)return e==null?"":e;const l=super.internalRenderer(...arguments);return i.readOnly&&!this.meta.isSelectionColumn&&(r.widgets[0].readOnly=!0),e?r.widgets[0].input.setAttribute("checked",!0):r.widgets[0].input.removeAttribute("checked"),l}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var t;e.record=e.cellInfo.record,this.isInitialSet=!0,(t=this.externalOnBeforeWidgetSetValue)===null||t===void 0||t.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;this.isInitialSet=!1,(t=this.externalOnAfterWidgetSetValue)===null||t===void 0||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t,userAction:i}){const r=this,{grid:l}=r,{record:o}=e.cellInfo;if(i&&r.field&&(!l.features.cellEdit||l.features.cellEdit.disabled)||r.meta.isSelectionColumn&&!l.isSelectable(o)&&t)return!1;if(!r.isInitialSet)return r.trigger("beforeToggle",{record:o,checked:t})}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const i=this,{record:r}=e.cellInfo,{field:l}=i;l&&(i.updateRecord(r,l,t),t?i.updateCheckAllState(i.grid.store.every(o=>o[l],null,!0)):i.updateCheckAllState(!1)),i.trigger("toggle",{record:r,checked:t})}}updateRecord(e,t,i){const r=`set${B.capitalize(t)}`;e[r]?e[r](i):e.set(t,i)}onCellKeyDown({event:e,cellElement:t}){if(e.key===" "){const i=t.widget;i==null||i.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}}I(Y,"$name","CheckColumn"),I(Y,"type","check"),I(Y,"fields",["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),I(Y,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]}),k.registerColumnType(Y,!0),Y._$name="CheckColumn";class re extends H{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:50,width:50,align:"center",text:"#",editor:!1,readOnly:!0}}construct(e){super.construct(...arguments);const t=this,{grid:i}=t;t.internalCellCls="b-row-number-cell",t.externalHeaderRenderer=t.headerRenderer,t.headerRenderer=t.internalHeaderRenderer,i&&(i.ion({bindStore:"bindStore",thisObj:t}),t.bindStore({store:i.store,initial:!0}),i.store.count&&!i.rendered&&i.ion({paint:"resizeToFitContent",thisObj:t,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const i=this;i.detachListeners("grid"),e.ion({name:"grid",[`change${i.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:i}),t||i.resizeToFitContent()}onStoreChange({action:e,isMove:t}){if(e==="dataset"||e==="add"||e==="remove"||e==="removeall"){if(e==="remove"&&t)return;const i=this,r=i.resizeToFitContent();e==="dataset"&&!r&&i.grid.store.count&&i.grid.rowManager.ion({renderDone(){this.resizeToFitContent()},once:!0,thisObj:i})}}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:t}=e,{count:i}=t;if(i&&!this.hidden){const r=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(r){const l=parseInt(p.getStyleValue(r,"padding-left")),o=p.measureText(i,r);return this.width=Math.max(this.minWidth,o+2*l),!0}}return!1}set flex(e){}internalHeaderRenderer({headerElement:e,column:t}){var i;return e.classList.add("b-rownumber-header"),((i=t.externalHeaderRenderer)===null||i===void 0?void 0:i.call(this,...arguments))||t.headerText}}I(re,"$name","RowNumberColumn"),I(re,"type","rownumber"),k.registerColumnType(re,!0),re._$name="RowNumberColumn";const le=new Map,Q=new Map,me="Grid",pe={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},_t=/\$\d+$/;class _{static registerFeature(e,t=!1,i=null,r=null){r=B.uncapitalize(r||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name),r=r.replace(_t,""),Array.isArray(i)||(i=[i||me]),i.forEach(l=>{const o=pe[l]||l,s=le.get(o)||new Map,n=Q.get(o)||new Map;s.set(r,e),n.set(e,t),le.set(o,s),Q.set(o,n)})}static getTypeNameFeatures(e=me){const t=pe[e]||e,i=le.get(t),r={};return i&&i.forEach((l,o)=>r[o]=l),r}static getTypeNameDefaultFeatures(e=me){const t=pe[e]||e,i=le.get(t),r=Q.get(t),l={};return i&&r&&i.forEach((o,s)=>{r.get(o)&&(l[s]=o)}),l}static getInstanceFeatures(e){return e.$meta.names.reduce((t,i)=>Object.assign(t,this.getTypeNameFeatures(i)),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce((t,i)=>Object.entries(this.getTypeNameFeatures(i)).reduce((r,[l,o])=>(this.isDefaultFeatureForTypeName(o,i)?r[l]=o:delete r[l],r),t),{})}static isDefaultFeatureForTypeName(e,t=me){const i=pe[t]||t,r=Q.get(i);return r&&r.get(e)||!1}static isDefaultFeatureForInstance(e,t){const i=t.$meta.names.slice().reverse();let r=null;for(let l=0,o=i.length;l<o&&r===null;++l){const s=Q.get(i[l]);s&&s.has(e)&&(r=s.get(e))}return r||!1}static reset(){le.clear(),Q.clear()}}const At={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1};class be extends Te($){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,addToCurrentParent:!1,autoEdit:null,editNextOnEnterPress:!0,editorClass:pt,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:"finishAndEditNextCell","Shift+Tab":"finishAndEditPrevCell"},ignoreCSSSelector:"button,.b-icon,.b-fa,svg"}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const i=this,r={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:i};i.grid=e,i.triggerEvent!=="cellclick"&&(r[i.triggerEvent]="onTriggerEditEvent"),i.autoEdit&&!("editNextOnEnterPress"in t)&&(i.editNextOnEnterPress=!1),e.ion(r),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:i}),i.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(fe.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await fe.confirm(e),fe.owner=null),t===fe.yesButton}doDestroy(){this.grid.columns.allRecords.forEach(e=>{var t;(t=e._cellEditor)===null||t===void 0||t.destroy()}),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return!!(super.disabled||e.disabled||e.readOnly)}get isEditing(){return!!this.editorContext}get activeRecord(){var e;return((e=this.editorContext)===null||e===void 0?void 0:e.record)||null}getEditorForCell({id:e,cell:t,column:i,columnId:r,editor:l}){var o;const s=this,{grid:n,editorClass:a}=s;let d=i.cellEditor,u=0;return i.editTargetSelector&&(u=t.querySelector(i.editTargetSelector).offsetLeft),l.autoSelect=s.autoSelect,(o=d)!==null&&o!==void 0&&o.isEditor||(d=i.data.cellEditor=a.create(a.mergeConfigs({type:a.type,constrainTo:null,cls:"b-cell-editor",inputField:l,blurAction:"none",invalidAction:i.invalidAction,completeKey:!1,cancelKey:!1,owner:n,align:{align:"t0-t0",offset:[u,0]},internalListeners:s.getEditorListeners(),onInternalKeyDown:s.onEditorKeydown.bind(s),allowMouseEvents:l.allowMouseEvents},d))),d.minHeight=n.rowHeight,d.inputField!==l&&(d.remove(d.items[0]),d.add(l)),d.align.offset[0]=u,i.instantUpdate&&!l.cellEditValueSetter&&(w.wrapProperty(l,"value",null,c=>{const{editorContext:h}=s,g=h==null?void 0:h.editor.inputField;h!=null&&h.editor.isValid&&!w.isEqual(h.record[h.column.field],c)&&(!(g!=null&&g.isDateField)||g._isPickerInput)&&(h.record[h.column.field]=c)}),l.cellEditValueSetter=!0),Object.assign(d.element.dataset,{rowId:e,columnId:r,field:i.field}),d.inputField.revertOnEscape=i.revertOnEscape,s.editor=d}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){const t=this,i=t.editorContext=e.cellEditorContext;if(i){var r;const{grid:l}=t;t.triggerEvent!=="cellclick"&&(t.detachListeners("cellClickWhileEditing"),l.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:t})),(r=t.removeEditingListeners)===null||r===void 0||r.call(t),t.removeEditingListeners=T.addListener({globaltap:"onTapOut",thisObj:t}),l.trigger("startCellEdit",{grid:l,editorContext:i})}}onEditorBeforeComplete(e){const{grid:t}=this,i=e.source,r=i.cellEditorContext;return e.grid=t,e.editorContext=r,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,i=e.cellEditorContext;i.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:i})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:t,muteEvents:i,grid:r}=this;i||r.trigger("cancelCellEdit",{grid:r,editorContext:t,event:e})}onBeforeEditorHide({source:e}){const t=this,{row:i,cell:r}=e.cellEditorContext;r==null||r.classList.remove("b-editing"),i==null||i.removeCls("b-editing"),t.detachListeners("cellClickWhileEditing"),t.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,t){const{grid:i}=this,{store:r,columns:l}=i,{visibleColumns:o}=l;let s=e.id,n=l.getAdjacentVisibleLeafColumn(e.columnId,t);for(;s;)if(n){if(n.editor&&n.canEdit(r.getById(s)))return{id:s,columnId:n.id};n=l.getAdjacentVisibleLeafColumn(n,t)}else{const a=r.getAdjacent(e.id,t,!1,!0);s=a==null?void 0:a.id,a&&(n=t?o[0]:o[o.length-1])}return null}doAddNewAtEnd(){const e=typeof this.addNewAtEnd=="object"?w.clone(this.addNewAtEnd):{},{grid:{store:t,rowManager:i},addToCurrentParent:r}=this;let l;return t.tree&&r?l=t.last.parent.appendChild(e):l=t.add(e)[0],i.getRowFor(l)||i.displayRecordAtBottom(),l}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:t,record:i}=e;if(t!=null&&t.isVisible&&t.editor&&!t.readOnly&&i&&!i.isSpecialRow&&!i.readOnly&&t.canEdit(i)){const r=i&&t.getRawValue(i);return Object.assign(e,{value:r===void 0?null:r,editor:t.editor}),e}else return!1}async startEditing(e={}){var o;const t=this;if(!t.disabled){var i,r,l;const{grid:s}=t;if((i=e)!==null&&i!==void 0&&i.fromKeyMap&&(e=t.grid.focusedCell),w.isEmpty(e)&&(e.id=s.firstVisibleRow.id),s.store.isTree&&s.features.tree){const h=e.id?s.store.getById(e.id):(o=e.record)!=null?o:s.store.getAt(e.row);if(h)await s.expandTo(h);else return!1}const n=t.getEditingContext(e);if(!n||(t.editorContext&&t.cancelEditing(),(r=s.focusedCell)!==null&&r!==void 0&&r.equals(n)||s.focusCell(n),s.trigger("beforeCellEditStart",{grid:s,editorContext:n})===!1))return!1;const a=n.editor=t.getEditorForCell(n),{row:d,cell:u,record:c}=n;return a.inputField.highlightExternalChange=!1,a.cellEditorContext=n,a.render(u),u.classList.add("b-editing"),d.addCls("b-editing"),await a.startEdit({target:u,field:a.inputField.name||n.column.field,value:n.value,record:c})||(u.classList.remove("b-editing"),d.removeCls("b-editing")),(l=t.onCellEditStart)===null||l===void 0||l.call(t),!0}return!1}cancelEditing(e=!1,t){var i;const r=this,{editor:l}=r;r.isEditing&&(e.fromKeyMap&&(t=e,e=!1),r.muteEvents=e,l.cancelEdit(t),r.muteEvents=!1,r.finishEditingPromise=!1,(i=r.afterCellEdit)===null||i===void 0||i.call(r))}async finishEditing(){const e=this,{editorContext:t,grid:i}=e;let r=!1;if(e.finishEditingPromise)return e.finishEditingPromise;if(t){var l;const{column:o}=t;e.finishEditingPromise=t.editor.completeEdit(o.bindCallback(o.finalizeCellEdit)),r=await e.finishEditingPromise,await i.waitForAnimations(),e.finishEditingPromise=null,(l=e.afterCellEdit)===null||l===void 0||l.call(e)}return r}async onCellClickWhileEditing({event:e,cellSelector:t}){const i=this;if(!e.target.closest(".b-editor")){if(p.isTouchEvent||e.target.matches(i.ignoreCSSSelector)){await i.finishEditing();return}i.finishEditingPromise||i.editorContext&&!i.editorContext.editor.owns(e.target)&&(i.getEditingContext(t)?await i.finishEditing()?i.continueEditingOnCellClick&&await i.startEditing(t):(i.grid.focusCell(i.editorContext),i.editor.inputField.focus()):await i.finishEditing())}}async onCellClick({source:e,cellSelector:t,target:i,event:r,column:l}){if(l.onCellClick)return;const o=this,{focusedCell:s}=o.client;if(i.closest(".b-tree-expander"))return!1;p.isTouchEvent&&o._lastCellClicked===(s==null?void 0:s.cell)&&r.timeStamp-o.touchEditDelay>o._lastCellClickedTime?await o.startEditing(t):this.triggerEvent==="cellclick"&&await o.onTriggerEditEvent({cellSelector:t,target:i}),o._lastCellClicked=s==null?void 0:s.cell,o._lastCellClickedTime=r.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:t,event:i}){var r;const{editorContext:l,client:o}=this;t.closest(".b-tree-expander")||p.isTouchEvent&&i.type==="dblclick"||i&&((r=o.features.cellMenu)===null||r===void 0?void 0:r.triggerEvent)===i.type||l&&(l.equals(this.grid.normalizeCellContext(e))||!await this.finishEditing())||await this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:i}=this;i!=null&&i.editor.isVisible&&t===i.record&&i.editor.dataField in e&&i.editor.refreshEdit()}onStoreBeforeSort(){var e;const t=(e=this.editorContext)===null||e===void 0?void 0:e.editor;this.isEditing&&!(t!=null&&t.isFinishing)&&!t.isValid&&this.cancelEditing()}onGridRefreshed(){const e=this,{grid:t,editorContext:i}=e;if(i&&t.isVisible&&t.focusedCell){const r=t.getCell(t.focusedCell),{editor:l}=i;r&&p.isInView(r)&&!l.isFinishing?(i._cell=r,T.suspendFocusEvents(),l.render(r),l.showBy(r),l.focus(),T.resumeFocusEvents()):e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable({actionName:e,event:t}){const i=this;if(!i.disabled&&!t.target.closest(".b-grid-header")){if(i.isEditing){if(e==="finishAllSelected")return i.multiEdit&&i.gridSelection.length>1;if(At[e])return!0}else if(e==="startEditing")return i.grid.focusedCell.cell===t.target}return!1}async finishAllSelected(){const e=this,{dataField:t,record:i}=e.editor;if(await e.finishEditing()&&!e.isDestroyed)for(const r of e.gridSelection)r.isModel?r!==i&&(r[t]=i[t]):r.record.set(r.column.field,i[t])}async finishAndEditNextRow(e,t=!1){const i=this,{grid:r}=i,{record:l}=i.editorContext;let o;if(await i.finishEditing()){if(i.isDestroyed)return;i.isEditing||(t?o=r.internalNextPrevRow(!1,!0,e,!1):(i.addNewAtEnd&&l===r.store.last&&await i.doAddNewAtEnd(),i.isDestroyed||(o=r.internalNextPrevRow(!0,!0,e))),o&&i.editNextOnEnterPress&&!r.touch&&i.startEditing(o))}}finishAndEditPrevRow(e){this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,t=!1){const i=this,{focusedCell:r}=i.grid;if(r){let l=i.getAdjacentEditableCell(r,!t);if(!l&&!t&&i.addNewAtEnd&&await i.finishEditing()===!0&&(await this.doAddNewAtEnd(),l=!i.isDestroyed&&i.getAdjacentEditableCell(r,!t)),l){let o=!0;i.isEditing&&(o=await i.finishEditing()),!i.isDestroyed&&o&&(i.grid.focusCell(l,{animate:i.focusCellAnimationDuration}),await i.startEditing(l)||await i.finishAndEditNextCell(e,t))}}}finishAndEditPrevCell(e){this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const t=this,{grid:i}=t,{focusedCell:r}=i;if(e.handled||!t.autoEdit||t.isEditing||!r||r.isActionable||e.ctrlKey)return;const{key:l}=e,o=e.key==="Delete"||e.key==="Backspace",{gridSelection:s}=o?t:{},n=t.multiEdit&&(s==null?void 0:s.length)>1;if((l.length<=1||o&&!n)&&await t.startEditing(r)){const{inputField:a}=t.editor,{input:d}=a;d&&(a.internalOnKeyEvent(e),e.defaultPrevented||(d.value=o?"":l,a.internalOnInput(e))),e.preventDefault()}else if(n&&i.trigger("beforeCellRangeDelete",{grid:i,gridSelection:s})!==!1)for(const a of s)a.isModel?i.columns.visibleColumns.forEach(d=>{!d.readOnly&&a.set(d.field,null)}):a.column.readOnly||a.record.set(a.column.field,null)}onEditorKeydown(e){if(e.key.length!==1&&this.grid.matchKeyMapEntry(e)&&!this.grid.matchKeyMapEntry(e,this.keyMap))return!e.key.startsWith("Arrow")&&!e.key==="Backspace"&&e.preventDefault(),e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const t=this,{grid:i,editor:r,editorContext:l}=t,o=new y(e.relatedTarget),s=o.grid===i&&t.getEditingContext(o);l&&!r.isFinishing&&r.owns(e._target)&&(t.blurAction==="cancel"?t.cancelEditing(void 0,e):!t.finishEditingPromise&&(t.triggerEvent==="cellclick"||t.triggerEvent!=="cellclick"&&!s)&&await t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:e}){const t=this;(!t.grid.bodyContainer.contains(e.target)||e.button)&&(t.editor.owns(e.target)||(t.editingStoppedByTapOutside=!0,t.blurAction==="cancel"?t.cancelEditing(void 0,e):await t.finishEditing(),delete t.editingStoppedByTapOutside))}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}}I(be,"$name","CellEdit"),be._$name="CellEdit",_.registerFeature(be,!0);class oe extends je{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const t=this,{cellSelector:i,event:r}=e;t.client.focusCell(i,{doSelect:!t.client.isSelected(i),event:r}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&e.enableCellContextMenu!==!1}getDataFromEvent(e){const t=this.client.getCellDataFromEvent(e);if(t)return w.assign(super.getDataFromEvent(e),t)}beforeContextMenuShow({record:e,items:t,column:i}){if(i.cellMenuItems===!1)return!1;(!e||e.isSpecialRow)&&(t.removeRow=!1)}populateCellMenu({items:e,column:t,record:i}){const{client:r}=this;t!=null&&t.cellMenuItems&&w.merge(e,t.cellMenuItems),r.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:i.readOnly,onItem:()=>r.store.remove(r.selectedRecords.filter(l=>!l.readOnly))})}get showMenu(){return!0}}oe.featureClass="",oe._$name="CellMenu",_.registerFeature(oe,!0,["Grid","Scheduler"]),_.registerFeature(oe,!1,["Gantt"]);class Ce extends Te($){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart({context:i}){const r=t.columns.getById(i.element.dataset.columnId);e.showToolbar(r)},gridheaderdrag:({context:i})=>e.onDrag(i),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:i})=>{i.valid?e.hideToolbar():e.onDrop(i)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,i=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),i.forEach(l=>{l.text=l.localeClass.L(l.text);let o=r.find(s=>s.text===l.group);o||(o={text:l.localeClass.L(l.group),buttons:[]},r.push(o)),o.buttons.push(l)}),t.element=p.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=i,t.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await X.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const i=this;if(e.dragProxy.getBoundingClientRect().top-i.grid.element.getBoundingClientRect().top>100?i.element.classList.add("b-closer"):i.element.classList.remove("b-closer"),i.hoveringButton&&(i.hoveringButton.classList.remove("b-hover"),i.hoveringButton=null),(t=e.targetElement)!==null&&t!==void 0&&t.closest(".b-columndragtoolbar")){i.element.classList.add("b-hover");const r=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),i.hoveringButton=r)}else i.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const i=e.targetElement,r=t.buttons.find(l=>l.ref===i.dataset.ref);r&&(i.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout(()=>{t.hideToolbar(),r.onDrop({column:t.column})},100))}else t.hideToolbar()}template(e){return ie.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map(t=>ie.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${t.buttons.map(i=>ie.tpl`
                        <div class="b-target-button" data-ref="${i.ref}" data-disabled="${i.disabled}">
                            <i class="${i.icon}"></i>
                            ${i.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${t.text}</div>
                </div>
            `)}
            </div>`}}Ce.featureClass="b-hascolumndragtoolbar",Ce._$name="ColumnDragToolbar",_.registerFeature(Ce,O.isTouchDevice);class se extends ${static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const t=this,{createColumnsFromModel:i}=t;let r;if(t.groupByRegion)r=t.grid.regions.map(l=>{const o=t.grid.getSubGrid(l).columns.topColumns;return{text:B.capitalize(l),menu:t.buildColumnMenu(o),disabled:o.length===0,region:l}}),i&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const l={};e.topColumns.forEach(o=>{o.tags&&Array.isArray(o.tags)&&o.hideable!==!1&&o.tags.forEach(s=>{l[s]||(l[s]=1)})}),r=Object.keys(l).sort().map(o=>({text:B.capitalize(o),menu:t.buildColumnMenu(t.getColumnsForTag(o)),tag:o,onBeforeSubMenu:({item:s,itemEl:n})=>{t.refreshTagMenu(s,n)}})),i&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else r=t.buildColumnMenu(e.topColumns),i&&r.items.push(...w.transformNamedObjectToArray(t.createAutoColumnItems()));return r}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:i,store:r}=t,{modelClass:l}=r,{allFields:o}=l,s={};for(let n=0,{length:a}=o;n<a;n++){const d=o[n],u=d.name;i.get(u)||d.internal||(s[u]={text:d.text||B.separate(d.name),checked:!1,onToggle:c=>{const h=i.get(u);h?h[c.checked?"show":"hide"]():i.add(i.generateColumnForField(d,{region:e.forColumn.region})),c.bubbles=!1}})}return s}getColumnsForTag(e){return this.grid.columns.records.filter(t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&t.hideable!==!1)}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach(r=>{const l=e.items.find(o=>o.column===r);l&&(l.checked=r.hidden!==!0)})}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:i}=this,r=e.reduce((l,o)=>{const s=i.columns.visibleColumns.filter(n=>n.region===o.region);if(o.hideable!==!1){const n={grid:i,column:o,text:o.headerText,checked:o.hidden!==!0,disabled:o.hidden!==!0&&s.length===1,cls:o.region!==t?"b-separator":""};t=o.region,o.children&&!o.isCollapsible&&(n.menu=this.buildColumnMenu(o.children)),l.push(n)}return l},[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:e,items:t}){const i=this,{columns:r}=i.grid;i.forColumn=e,e.showColumnPicker!==!1&&r.some(l=>l.hideable)&&(t.columnPicker={text:"L{columnsMenu}",localeClass:i,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:i.getColumnPickerItems(r),onToggle:i.onColumnToggle,disabled:i.disabled}),e.hideable!==!1&&!e.parent.isCollapsible&&(t.hideColumn={text:"L{hideColumn}",localeClass:i,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!e.allowDrag||i.disabled,onItem:()=>e.hide()})}onColumnToggle({menu:e,item:t,checked:i}){if(!!t.column.hidden!=!i){var r,l;t.column[i?"show":"hide"]();const{grid:o,column:s}=t,{columns:n,features:a}=o,d=e.items,u=n.visibleColumns.filter(g=>g.region===t.column.region),c=((r=a.headerMenu)===null||r===void 0?void 0:r.enabled)&&a.headerMenu.menu.widgetMap.hideColumn;if(u.length===1){const g=d.find(f=>f.column===u[0]);g&&(g.disabled=!0),c&&s.region===t.column.region&&(c.disabled=!0)}else u.forEach(g=>{const f=d.find(C=>C.column===g);f&&(f.disabled=!1)}),c&&s.region===t.column.region&&(c.disabled=!1);(l=t.menu)===null||l===void 0||l.eachWidget(g=>{g.checked=i});const h=e.owner;h&&h.column===s.parent&&(h.checked=d.some(g=>g.checked===!0))}}getColumnDragToolbarItems(e,t){const i=this.grid.columns.visibleColumns.filter(r=>r.region===e.region);return e.hideable!==!1&&i.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:r})=>r.hide()}),t}}I(se,"$name","ColumnPicker"),I(se,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),se._$name="ColumnPicker",_.registerFeature(se,!0);class ne extends Te($){constructor(){super(...arguments);I(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}doDestroy(){var t,i;(t=this.dragHelper)===null||t===void 0||t.scrollManager.destroy(),(i=this.dragHelper)===null||i===void 0||i.destroy(),super.doDestroy()}get grid(){return this.client}init(){const t=this,{grid:i}=t,r=i.element,l=p.children(r,".b-grid-headers");l.push(...p.children(r,".b-grid-header-children")),t.dragHelper?t.dragHelper.containers=l:(t.dragHelper=new Et({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:i,rtlSource:i,outerElement:i.headerContainer,monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:Ke.new({direction:"horizontal",element:i.headerContainer}),containers:l,isElementDraggable(o){if(!!o.closest(t.ignoreSelectors.join(","))||t.disabled)return!1;const n=o.closest(this.targetSelector),a=n&&i.columns.getById(n.dataset.columnId),d=(a==null?void 0:a.childLevel)===0&&i.subGrids[a.region].columns.count===1;return!!a&&a.draggable!==!1&&!d},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:t.onBeforeDragStart,dragstart:t.onDragStart,drag:t.onDrag,drop:t.onDrop,thisObj:t}}),t.relayEvents(t.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["onPaint","renderContents"]}}onBeforeDragStart({context:t,event:i}){const{element:r}=t,l=t.column=this.client.columns.getById(r.dataset.columnId);return l.allowDrag&&this.client.trigger("beforeColumnDragStart",{column:l,event:i})}onDragStart({context:t,event:i}){const r=this,{grid:l}=r,{column:o}=t;if(!l.features.columnDragToolbar){const s=l.element.querySelector(".b-grid-header-container").getBoundingClientRect();r.dragHelper.minY=s.top,r.dragHelper.maxY=s.bottom}l.headerContainer.classList.add("b-dragging-header"),t.dragProxy.style.fontSize=p.getStyleValue(t.element,"fontSize"),l.trigger("columnDragStart",{column:o,event:i})}onDrag({context:t,event:i}){const r=this,l=r.client,{insertBefore:o,column:s}=t,n=J.fromElement(i.target,"gridheader");if(l.trigger("columnDrag",{column:s,insertBefore:o,event:i,context:t}),n!=null&&n.subGrid.sealedColumns){t.valid=!1;return}t.valid&&!r.grid.features.columnDragToolbar&&(t.valid=!!i.target.closest(".b-grid-headers"))}onDrop({context:t,event:i}){if(!t.valid)return this.onInvalidDrop({context:t});const r=this,{grid:l}=r,o=t.dragging,s=t.target.closest(".b-grid-header"),n=t.draggedTo.dataset.region,a=s?l.columns.get(s.dataset.column):l.subGrids[n].columns.last,d=n||a.region,u=t.insertBefore,c=l.columns.getById(o.dataset.columnId),h=c.parent,g=u?l.columns.getById(u.dataset.columnId):l.subGrids[d].columns.last.nextSibling;let f;if(g)f=g.parent;else{const b=s==null?void 0:s.parentElement.closest(".b-grid-header");b?f=l.columns.getById(b.dataset.columnId):f=l.columns.rootNode}l.headerContainer.classList.remove("b-dragging-header"),o.remove();let C=d===c.region&&h===f&&(a===c.previousSibling||g===c.nextSibling);C=C||l.trigger("beforeColumnDropFinalize",{column:c,newParent:f,insertBefore:g,event:i})===!1,C||(C=!f.insertChild(c,g)),t.valid=!C,C||(c.region=d,h.children.length===0&&h.parent.removeChild(h)),l.trigger("columnDrop",{column:c,newParent:f,insertBefore:g,valid:t.valid,event:i})}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}get isReordering(){var t;return!!(!((t=this.dragHelper)===null||t===void 0)&&t.isDragging)}}I(ne,"$name","ColumnReorder"),ne.featureClass="b-column-reorder",ne._$name="ColumnReorder",_.registerFeature(ne,!0);class _e extends ${static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,t){const i=this;i.grid=e,super.construct(e,t),i.resizer=new Ft({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,internalListeners:{beforeresizestart:i.onBeforeResizeStart,resizestart:i.onResizeStart,resizing:i.onResizing,resize:i.onResize,cancel:i.onCancel,thisObj:i}})}doDestroy(){var e;(e=this.resizer)===null||e===void 0||e.destroy(),super.doDestroy()}changeLiveResize(e){return e==="auto"?!O.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:i}=this,r=e.column=t.columns.getById(e.element.dataset.columnId);i.minWidth=r.minWidth,t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:i}=e;t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized(i)):i.width=e.newWidth)}onCancel({context:e}){const{grid:t}=this;t.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,t.resizingColumns=!1}}_e._$name="ColumnResize",_.registerFeature(_e,!0);const Ie=class extends It{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){var t;const e=this;if(!e.grid)throw new Error(`${e.constructor.$name} requires 'grid' to be configured.`);e.fields=(t=e.fields)!=null?t:{},super.afterConstruct()}updateGrid(e){var t;if(!((t=e.store)!==null&&t!==void 0&&t.modelClass))throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getModelClassFields(e){const t=new Set(e.fields.map(({name:i})=>i));return(e==null?void 0:e.allFields.filter(i=>!i.internal&&(Ht.includes(i.type)||Je(i))&&(i.definedBy!==$e||t.has(i.name))))||[]}static getColumnFields(e,t,i){var o;const r=L.keyBy(Ie.getModelClassFields(t),"name"),l=i&&new Set(i);return Object.fromEntries((o=e==null?void 0:e.records.filter(({field:s})=>s&&r[s]&&(!l||l.has(s))).map(({field:s,text:n})=>[s,{title:n||s,type:Je(r[s])?"duration":r[s].type}]))!=null?o:[])}changeFields(e){var t;let i=e;return Array.isArray(e)&&(K.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),i=L.keyBy(i,"name")),w.merge({},Ie.getColumnFields(this.grid.columns,(t=this.grid.store)===null||t===void 0?void 0:t.modelClass,this.allowedFieldNames),i)}};let Z=Ie;I(Z,"configurable",{grid:null,allowedFieldNames:null}),Z.initClass(),Z._$name="GridFieldFilterPicker";class ae extends Mt{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:t,allowedFieldNames:i}=this;return{...super.getFilterPickerConfig(e),grid:t,allowedFieldNames:i}}updateGrid(e){this.store=this.grid.store}canManage(e){const t=this;return super.canManage(e)&&(!t.allowedFieldNames||t.allowedFieldNames.includes(e.property))}}I(ae,"configurable",{grid:null,allowedFieldNames:null}),I(ae,"childPickerType","gridfieldfilterpicker"),ae.initClass(),ae._$name="GridFieldFilterPickerGroup";const Ae={date:"date",int:"number",integer:"number",number:"number",string:"text",duration:"duration"};class Oe extends ${static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},isMulti:!1}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const i=this;if(i.grid=e,i.closeFilterEditor=i.closeFilterEditor.bind(i),super.construct(e,t),i.bindStore(e.store),t&&typeof t=="object"){const r=w.clone(t);delete r.prioritizeColumns,delete r.isMulti,delete r.dateFormat,w.isEmpty(r)||e.store.filter(r,null,e.isConfiguring)}}doDestroy(){var e,t;(e=this.filterTip)===null||e===void 0||e.destroy(),(t=this.filterEditorPopup)===null||t===void 0||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,i=t.grid,r=i.headerContainer;r&&(p.children(r,".b-filter-icon.b-latest").forEach(l=>l.classList.remove("b-latest")),t.filterTip||(t.filterTip=new qe({forElement:r,forSelector:".b-filter-icon",getHtml({activeTarget:l}){return l.dataset.filterText}})),i.store.isFiltered||t.filterTip.hide(),i.columns.visibleColumns.forEach(l=>{if(l.filterable!==!1){const o=t.store.filters.allValues.filter(({property:a,disabled:d,internal:u})=>a===l.field&&!d&&!u),s=o.length>0,n=l.element;if(n){const a=l.textWrapper;let d=a==null?void 0:a.querySelector(".b-filter-icon"),u;if(s){const c="&#x2022 ";u=`${t.L("L{filter}")}: `+(o.length>1?"<br/><br/>":"")+o.map(h=>{var E;var g,f;let C=(E=h.value)!=null?E:"";const b=Array.isArray(C),x=(g=t.store)===null||g===void 0||(f=g.modelRelations)===null||f===void 0?void 0:f.find(({foreignKey:v})=>v===h.property);if(h.displayValue)C=h.displayValue;else{if(t.isMulti&&x){var S;const{relatedDisplayField:v}=(S=t.isMulti.fields)===null||S===void 0?void 0:S[h.property];if(v){const R=F=>{var M;return(M=x.foreignStore.getById(F))===null||M===void 0?void 0:M[v]};b?C=C.map(R).sort((F,M)=>(F!=null?F:"").localeCompare(M!=null?M:"")):C=R(C)}}else l.formatValue&&C&&(C=b?C.map(v=>l.formatValue(v)):l.formatValue(C));b&&(C=`[ ${C.join(", ")} ]`)}return(o.length>1?c:"")+(typeof h=="string"?h:`${h.operator} ${C}`)}).join("<br/><br/>")}else u=t.L("L{applyFilter}");d?d.dataset.filterText=u:d=p.createElement({parent:a,tag:"div",className:"b-filter-icon",dataset:{filterText:u}}),l.field===t.store.latestFilterField&&d.classList.add("b-latest"),n.classList.add("b-filterable"),n.classList.toggle("b-filter",s)}l.meta.isFiltered=s}}),e&&i.refreshRows())}applyFilter(e,t){const{store:i}=this,{filterFn:r}=e.filterable;e.$filter=i.addFilter({...e.filterable,...t,property:e.field,[r?"filterBy":"_"]:function(l){return r({value:this.value,record:l,operator:this.operator,property:this.property,column:e})}},!0),i.filter()}removeFilter(e){if(this.isMulti)for(const t of this.getCurrentMultiFilters(e))this.store.removeFilter(t);else this.store.removeFilter(e.field)}disableFilter(e){for(const t of this.getCurrentMultiFilters(e))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter(t=>t.property===e.field)}getPopupDateItems(e,t,i,r,l,o,s,n){const a=this,d=o;function u(){a.removeFilter(e)}function c({event:g}){g.key==="Enter"&&o()}function h({source:g,value:f}){f==null?u():(a.clearSiblingsFields(g),a.applyFilter(e,{operator:g.operator,value:f,displayValue:g._value,type:"date"}))}return[w.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(i==null?void 0:i.operator)==="sameDay"?i.value:r,operator:"sameDay",onKeydown:c,onChange:h,onClose:d,onClear:u},n),w.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:(i==null?void 0:i.operator)==="<"?i.value:null,operator:"<",onKeydown:c,onChange:h,onClose:d,onClear:u},n),w.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:(i==null?void 0:i.operator)===">"?i.value:null,operator:">",onKeydown:c,onChange:h,onClose:d,onClear:u},n)]}getPopupNumberItems(e,t,i,r,l,o,s,n){const a=this,d=o;function u(){a.removeFilter(e)}function c({event:g}){g.key==="Enter"&&o()}function h({source:g,value:f}){f==null?u():(a.clearSiblingsFields(g),a.applyFilter(e,{operator:g.operator,value:f}))}return[w.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(i==null?void 0:i.operator)==="="?i.value:r,operator:"=",onKeydown:c,onChange:h,onEsc:d,onClear:u},n),w.assign({type:"number",placeholder:"L{lessThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(i==null?void 0:i.operator)==="<"?i.value:null,operator:"<",onKeydown:c,onChange:h,onEsc:d,onClear:u},n),w.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(i==null?void 0:i.operator)===">"?i.value:null,operator:">",onKeydown:c,onChange:h,onEsc:d,onClear:u},n)]}clearSiblingsFields(e){var t;(t=this.filterEditorPopup)===null||t===void 0||t.items.forEach(i=>{i!==e&&(i==null||i.clear())})}getPopupDurationItems(e,t,i,r,l,o,s,n){const a=this,d=o,u=()=>a.removeFilter(e);function c({source:h,value:g}){g==null?u():(a.clearSiblingsFields(h),a.applyFilter(e,{operator:h.operator,value:g}))}return[w.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(i==null?void 0:i.operator)==="="?i.value:r,operator:"=",onChange:c,onEsc:d,onClear:u},n),w.assign({type:"duration",placeholder:"L{lessThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(i==null?void 0:i.operator)==="<"?i.value:null,operator:"<",onChange:c,onEsc:d,onClear:u},n),w.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(i==null?void 0:i.operator)===">"?i.value:null,operator:">",onChange:c,onEsc:d,onClear:u},n)]}getPopupStringItems(e,t,i,r,l,o,s,n){const a=this;return[w.assign({type:t,cls:"b-last-row",placeholder:"L{filter}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:i?i.value||i:r,operator:"*",onChange({source:d,value:u}){u===""?s():(a.applyFilter(e,{operator:d.operator,value:u,displayValue:d.displayField&&d.records?d.records.map(c=>c[d.displayField]).join(", "):void 0}),d.multiSelect||o())},onClose:o,onClear:s},n)]}getPopupItems(e,t,i,r,l,o,s,n){const a=this;if(a.isMulti)return a.getMultiFilterPopupItems(...arguments);switch(t){case"date":return a.getPopupDateItems(...arguments);case"number":return a.getPopupNumberItems(...arguments);case"duration":return a.getPopupDurationItems(...arguments);default:return a.getPopupStringItems(...arguments)}}getMultiFilterPopupItems(e){var t;const{grid:i,isMulti:r}=this,l=(t=i.store)===null||t===void 0?void 0:t.filters.find(o=>o.property===e.field);return[{...typeof r=="object"?r:void 0,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:i,filters:l?[]:[{property:e.field}],propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",width:"400px"}]}showFilterEditor(e,t){e=this.grid.columns.getById(e);const i=this,{store:r,isMulti:l}=i,o=e.element,s=r.filters.getBy("property",e.field),n=i.getFilterType(e);if(e.filterable===!1)return;i.closeFilterEditor();const a=i.getPopupItems(e,n,s!=null&&s.internal?null:s,t,r,i.closeFilterEditor,()=>{i.removeFilter(e),i.closeFilterEditor()},e.filterable.filterField,l);a.forEach(d=>d.placeholder=d.placeholder?this.L(d.placeholder):d.placeholder),i.filterEditorPopup=ge.openPopup(o,{owner:i.grid,cls:"b-filter-popup",scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:a})}closeFilterEditor(){var e;(e=this.filterEditorPopup)===null||e===void 0||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){const t=e.field,i=this.client.store.modelClass.getFieldDefinition(t),r=e.filterType;return r?Ae[r]:Ae[e.type]||i&&Ae[i.type]||"text"}populateCellMenuWithDateItems({column:e,record:t,items:i}){const r=e.field;if(this.getFilterType(e)==="date"){const o=this,s=t[r],n=a=>{o.applyFilter(e,{operator:a,value:s,displayValue:e.formatValue?e.formatValue(s):s,type:"date"})};i.filterDateEquals={text:"L{on}",localeClass:o,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:o.disabled,onItem:()=>n("=")},i.filterDateBefore={text:"L{before}",localeClass:o,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:o.disabled,onItem:()=>n("<")},i.filterDateAfter={text:"L{after}",localeClass:o,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:o.disabled,onItem:()=>n(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:i}){const r=e.field;if(this.getFilterType(e)==="number"){const o=this,s=t[r],n=a=>{o.applyFilter(e,{operator:a,value:s})};i.filterNumberEquals={text:"L{equals}",localeClass:o,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:o.disabled,onItem:()=>n("=")},i.filterNumberLess={text:"L{lessThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:o.disabled,onItem:()=>n("<")},i.filterNumberMore={text:"L{moreThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:o.disabled,onItem:()=>n(">")}}}populateCellMenuWithDurationItems({column:e,record:t,items:i}){if(this.getFilterType(e)==="duration"){const l=this,o=e.getFilterableValue(t),s=n=>{l.applyFilter(e,{operator:n,value:o})};i.filterDurationEquals={text:"L{equals}",localeClass:l,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:l.disabled,onItem:()=>s("=")},i.filterDurationLess={text:"L{lessThan}",localeClass:l,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:l.disabled,onItem:()=>s("<")},i.filterDurationMore={text:"L{moreThan}",localeClass:l,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:l.disabled,onItem:()=>s(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:i}){var o;const r=this.getFilterType(e);if(!/(date|number|duration)/.test(r)){var l;const s=this,n=e.getFilterableValue(t),a=(o=(l=e.filterable.filterField)===null||l===void 0?void 0:l.operator)!=null?o:"*";i.filterStringEquals={text:"L{equals}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>s.applyFilter(e,{value:n,operator:a})}}}populateCellMenu({column:e,record:t,items:i}){const r=this;e.filterable!==!1&&!t.isSpecialRow&&(r.populateCellMenuWithDateItems(...arguments),r.populateCellMenuWithNumberItems(...arguments),r.populateCellMenuWithDurationItems(...arguments),r.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(i.filterRemove={text:"L{removeFilter}",localeClass:r,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:400,disabled:r.disabled||r.isMulti&&!r.columnHasRemovableFilters(e),onItem:()=>r.removeFilter(e)}),r.isMulti&&(i.filterDisable={text:"L{disableFilter}",localeClass:r,icon:"b-fw-icon b-icon-filter-disable",cls:"b-separator",weight:400,disabled:r.disabled||!r.columnHasEnabledFilters(e),onItem:()=>r.disableFilter(e)}))}columnHasRemovableFilters(e){const t=this;return!!t.getCurrentMultiFilters(e).find(i=>!t.canDeleteFilter||t.callback(t.canDeleteFilter,t,[i])!==!1)}columnHasEnabledFilters(e){return!!this.getCurrentMultiFilters(e).find(t=>!t.disabled)}populateHeaderMenu({column:e,items:t}){const i=this;e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:i,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:i.disabled,onItem:()=>i.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:i,weight:110,icon:"b-fw-icon b-icon-remove",disabled:i.disabled||i.isMulti&&!i.columnHasRemovableFilters(e),onItem:()=>i.removeFilter(e)},i.isMulti&&(t.disableFilter={text:"L{disableFilter}",localeClass:i,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:i.disabled||!i.columnHasEnabledFilters(e),onItem:()=>i.disableFilter(e)})):e.filterable!==!1&&(t.filter={text:"L{filter}",localeClass:i,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:i.disabled,onItem:()=>i.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){const l=e.getAt(r);if(!l.internal){var i;const o=(l.columnOwned||this.prioritizeColumns)&&t.find(s=>s.filterable!==!1&&s.field===l.property);o!=null&&(i=o.filterable)!==null&&i!==void 0&&i.filterFn&&(o.$filter||(o.$filter=new Ue({columnOwned:!0,property:l.property,operator:l.operator,value:l.value,filterBy(s){return o.filterable.filterFn({value:this.value,record:s,operator:this.operator,property:this.property,column:o})}})),o.$filter.value=l.value,o.$filter.displayValue=l.displayValue,o.$filter.operator=l.operator,e.splice(r,1,o.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const t=e.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const t=e.matches(".b-grid-header")&&e;return t&&this.showFilterEditor(t.dataset.columnId),!!t}isActionAvailable({event:e}){const t=e.target.closest(".b-grid-header"),i=t&&this.client.columns.find(r=>r.id===t.dataset.columnId);return!!(i!=null&&i.filterable)}}Oe._$name="Filter",_.registerFeature(Oe);const Ot={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null};class ve extends ${static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const i=this;i.grid=e,i.onColumnFilterFieldChange=i.onColumnFilterFieldChange.bind(i),super.construct(e,Array.isArray(t)?{filter:t}:t),i.bindStore(e.store),i.filter&&e.store.filter(i.filter),i.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:i})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),(e=this.gridDetacher)===null||e===void 0||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;t==null||t.forEach(i=>{const r=this.getColumnFilterField(i);r&&(r.disabled=e)}),super.doDisable(e)}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const i=this._columnFilters[t];i.placeholder=e?i.column.headerText:null}}destroyFilterBar(){var e;(e=this.grid.columns)===null||e===void 0||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),(e=t.grid.columns)===null||e===void 0||e.forEach(i=>t.hideColumnFilterField(i,!0)),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t.hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(),this.resumeStoreTracking(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach(e=>this.renderColumnFilterField(e)),this.rendered=!0)}renderColumnFilterField(e){const t=this,{grid:i}=t,r=t.getColumnFilterable(e);if(r&&e.isVisible){const l=e.element,o=i.store.filters.get(e.id)||i.store.filters.getBy("property",e.field);let s=t.getColumnFilterField(e);if(s)t.onColumnFilterFieldChange({source:s,value:s.value}),s.render(l),s.show();else{const n=`${e.filterType||"text"}field`,{filterField:a}=r,d=a==null?void 0:a.cls;d&&delete r.filterField.cls,s=ge.append(w.assign({type:n,cls:{[t.filterFieldCls]:1,[d]:d},dataset:{column:e.field},column:e,owner:i,clearable:!0,name:e.field,value:o&&!o._filterBy&&!o.internal?t.buildFilterValue(o):"",inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled,placeholder:t.compactMode?e.headerText:null,format:e.format},a),l)[0],a!=null&&a.hasOwnProperty("min")||Object.defineProperty(s,"min",{get:()=>{var c;return(c=e.editor)===null||c===void 0?void 0:c.min},set:()=>null}),a!=null&&a.hasOwnProperty("max")||Object.defineProperty(s,"max",{get:()=>{var c;return(c=e.editor)===null||c===void 0?void 0:c.max},set:()=>null}),a!=null&&a.hasOwnProperty("strictParsing")||Object.defineProperty(s,"strictParsing",{get:()=>{var c;return(c=e.editor)===null||c===void 0?void 0:c.strictParsing},set:()=>null}),s.element.retainElement=!0,t.setColumnFilterField(e,s);const u=(a==null?void 0:a.store)&&(a.store.readUrl||a.store.data||a.store.isChained);if(s.isCombo&&!u&&s.store.count===0){const c=s.value,h=()=>{s.store.readUrl||s.store.isChained||(s.store.data=i.store.getDistinctValues(e.field,!0).map(g=>i.store.modelClass.new({id:g,[e.field]:g})))};s.value=null,s.store.isSorted||s.store.sort({field:e.field,ascending:!0}),s.picker.ion({beforeShow:h}),h(),s.value=c}!t.filter&&s.value&&i.store.autoLoad!==!1&&t.onColumnFilterFieldChange({source:s,value:s.value})}l.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:t,store:i}=e.grid;let r,l;e._updatingFields=!0;for(const o of t.visibleColumns)r=e.getColumnFilterField(o),r&&(l=i.filters.get(o.id)||i.filters.getBy("property",o.field),l&&!l.internal?l._filterBy?r.value=l.value:r.value=e.buildFilterValue(l):r.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&e.filterable!==!1&&e.field&&e.isLeaf)return typeof e.filterable=="function"&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const i=this,{store:r}=i.grid,l=e.element,o=i.getColumnFilterField(e);if(o){i.isDestroying||o.hide();const{$filter:s}=e;!r.isDestroyed&&i.clearStoreFiltersOnHide&&s&&r.removeFilter(s,t),l==null||l.classList.remove(i.filterableColumnCls)}}getColumnFilterField(e){var t;return(t=this._columnFilters)===null||t===void 0?void 0:t[e.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e,t,i){var r;if(Array.isArray(t))return{value:t};if(w.isDate(t))return{operator:i.isDateField?"sameDay":i.isTimeField?"sameTime":"=",value:t};const l=String(t).match(this.filterParseRegExp);return{operator:l[1]||((r=e.filterable)===null||r===void 0?void 0:r.operator)||"*",value:l[2]}}buildFilterValue({operator:e,value:t}){return t instanceof Date||Array.isArray(t)?t:(e in Ot?"":e)+t}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){var i;const l=e.getAt(r),o=(l.columnOwned||this.prioritizeColumns)&&t.find(s=>s.filterable!==!1&&s.field===l.property);o!=null&&(i=o.filterable)!==null&&i!==void 0&&i.filterFn&&(o.$filter||(o.$filter=new Ue({columnOwned:!0,property:l.property,id:o.id,filterBy(s){return o.filterable.filterFn({value:this.value,record:s,property:this.property,column:o})}})),o.$filter.value=l.value,e.splice(r,1,o.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({action:e,changes:t,column:i,columns:r}){!this.hidden&&t!==null&&t!==void 0&&t.hidden&&(t.hidden.value?this.destroyColumnFilterField(i):this.renderColumnFilterField(i)),e==="remove"&&r.forEach(l=>this.destroyColumnFilterField(l))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))e==null||e.element.remove()}disableGridNavigation(e){return e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:t}){const i=this,{column:r}=e,{filterFn:l}=r.filterable,{store:o}=i.grid,s=r.$filter||o.filters.find(u=>(u.id===r.id||u.property===r.field)&&!u.internal);if(i._updatingFields)return;const n=t==null||t===""||Array.isArray(t)&&t.length===0;if(o.removeFilter(s,!0),r.$filter=null,n){if(!s)return}else{var a,d;r.$filter=o.addFilter({property:e.name,...i.parseFilterValue(r,t,e),[typeof((a=r.filterable)===null||a===void 0?void 0:a.caseSensitive)=="boolean"?"caseSensitive":void 0]:(d=r.filterable)===null||d===void 0?void 0:d.caseSensitive,[l?"filterBy":"_"]:function(u){return l({value:this.value,record:u,operator:this.operator,property:this.property,column:r})}},!0)}o.filter()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}}ve.featureClass="b-filter-bar",ve._$name="FilterBar",_.registerFeature(ve);class we extends ${static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}construct(e,t){const i=this;e.features.tree||(i._thisIsAUsedExpression(e.features.groupSummary),t=i.processConfig(t),i.grid=e,super.construct(e,t),i.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:i}))}processConfig(e){return typeof e=="string"?{field:e,ascending:null}:e}setConfig(e){e===null?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",thisObj:this}),this.onStoreGroup({groupers:e.groupers})}updateRenderer(e){this.groupRenderer=e}updateField(e){this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:i}=t;i.unshift(...t.groupers),this.currentGroupers=t.groupers,t.clearGroupers(),t.sort(i)}else!e&&this.currentGroupers&&(t.group(this.currentGroupers[0]),this.currentGroupers=null);super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,i=!1,r){const l=this,{store:o,grid:s}=l,n=o.getById(e);n.isGroupHeader&&(t=t===void 0?!n.meta.collapsed:t,s.trigger("beforeToggleGroup",{groupRecord:n,collapse:t,domEvent:r})!==!1&&(t?o.collapse(n):o.expand(n),i||(s.rowManager.rowCount>s.store.count?s.rowManager.renderFromRow():s.rowManager.renderFromRecord(n)),s.trigger("toggleGroup",{groupRecord:n,collapse:t}),s.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!0,!0)),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!1,!0)),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const t=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(t==null?void 0:t.isGroupHeader)}renderCell(e){const t=this,{cellElement:i,row:r,column:l}=e,{meta:o}=e.record,s={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in o){if(l.type==="action")return;l.clearCell(i),s["b-grid-group-collapsed"]=o.collapsed,s["b-group-row"]=1,t.buildGroupHeader(e),l===t.groupHeaderColumn&&(p.createElement({parent:i,tag:"i",className:"b-group-state-icon",nextSibling:i.firstChild}),i.classList.add("b-group-title"),i.$groupHeader=i._hasHtml=!0)}else if(i.$groupHeader){var n;(n=i.querySelector(".b-group-state-icon"))===null||n===void 0||n.remove(),i.classList.remove("b-group-title"),i.$groupHeader=!1}r.assignCls(s)}buildGroupHeader(e){const t=this,{record:i,cellElement:r,column:l,persist:o}=e,{grid:s}=t,n=i.meta,{groupRowFor:a}=n,{groupSummary:d}=s.features,u=n.childCount-(d&&d.target!=="header"?1:0);let c=null,h=!0;if(o||l){const g=s.columns.get(n.groupField),f=e.isFirstColumn=l===t.groupHeaderColumn;g!=null&&g.groupRenderer?f&&(c=g.groupRenderer({...e,groupRowFor:a,groupRecords:i.groupChildren,groupColumn:g,count:u}),h=!1):t.groupRenderer&&(c=t.groupRenderer({...e,groupRowFor:a,groupRecords:i.groupChildren,groupColumn:g,count:u,isFirstColumn:f})),f&&c==null&&h&&p.getChildElementCount(r)===0&&(c=B.encodeHtml(`${a==="__novalue__"?"":a} (${u})`))}else t.groupRenderer&&(c=t.groupRenderer(e));return typeof c=="string"?r.innerHTML=c:typeof c=="object"&&he.sync({targetElement:r,domConfig:{onlyChildren:!0,children:L.asArray(c)}}),p.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find(e=>!e.groupHeaderReserved)}renderHeader(e){const{store:t,grid:i}=this;if(t.isGrouped)for(const r of t.groupers){const l=i.columns.get(r.field),o=l&&i.getHeaderElement(l.id);o==null||o.classList.add("b-group",r.ascending?"b-asc":"b-desc")}}populateHeaderMenu({column:e,items:t}){const i=this;e.groupable!==!1&&(t.groupAsc={text:"L{groupAscending}",localeClass:i,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:i.disabled,onItem:()=>i.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:i,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:i.disabled,onItem:()=>i.store.group(e.field,!1)}),i.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:i,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:i.disabled,onItem:()=>i.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var i;const r=this,{store:l,disabled:o}=r;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:o,onDrop:({column:n})=>l.group(n.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:o,onDrop:({column:n})=>l.group(n.field,!1)});const s=((i=l.groupers)===null||i===void 0?void 0:i.some(n=>n.field===e.field))&&!o;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!s,weight:110,onDrop:({column:n})=>l.removeGrouper(n.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:i}=t,r=i&&p.children(i,".b-grid-header.b-group");if(i){for(const l of r)l.classList.remove("b-group","b-asc","b-desc");if(e)for(const l of e){const o=t.getHeaderElementByField(l.field);o&&o.classList.add("b-group",l.ascending?"b-asc":"b-desc")}}}onStoreChange({action:e,records:t}){const{client:i}=this,{rowManager:r,store:l}=i;if(l.isGrouped&&e==="move"){const{field:o}=l.groupers[0],s=Math.min(...t.reduce((n,a)=>{if(n.push(l.indexOf(a.instanceMeta(l).groupParent)),o in a.meta.modified){const d=l.groupRecords.find(u=>u.meta.groupRowFor===a.meta.modified[o]);d&&n.push(l.indexOf(d))}return n},[]));r.renderFromRow(r.getRow(s))}}onElementTouchStart(e){const t=this,{target:i}=e,r=i.closest(".b-grid-header"),l=r&&t.grid.getColumnFromElement(r);e.touches.length>1&&l&&l.groupable!==!1&&!t.disabled&&t.store.group(l.field)}onElementClick(e){const t=this,{store:i}=t,{target:r}=e,l=r.closest(".b-group-row"),o=r.closest(".b-grid-header"),s=o==null?void 0:o.dataset.column;if(!(r.classList.contains("b-resizer")||t.disabled||r.classList.contains("b-action-item")||e.handled)){if(o&&s){var n;const a=(n=i.groupers)===null||n===void 0?void 0:n.find(d=>d.field===s);if(a&&!e.shiftKey)return a.ascending=!a.ascending,i.group(),!1;e.shiftKey&&t.grid.columns.get(s).groupable!==!1&&(e.altKey?i.removeGrouper(s):i.group(s))}if(l&&(t.toggleOnRowClick||e.target.classList.contains("b-group-state-icon")))return t.internalToggleCollapse(G.get(l).id,void 0,void 0,e),!1}}toggleGroup(e){var t;const{grid:i}=this,{focusedCell:r}=i;return!this.disabled&&!r.isActionable&&(t=r.record)!==null&&t!==void 0&&t.isGroupHeader?(this.internalToggleCollapse(r.id),!0):!1}}we._$name="Group",_.registerFeature(we,!0,["Grid","Scheduler"]),_.registerFeature(we,!1,["TreeGrid"]);class Se extends je{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:t}=e;return t&&t.enableHeaderContextMenu!==!1&&t!==this.client.timeAxisColumn}getDataFromEvent(e){return w.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){const i=this;if(t){if(t.headerMenuItems&&w.merge(e,t.headerMenuItems),t.isCollapsible){const{collapsed:r}=t,l=r?i.client.rtl?"left":"right":i.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${l}`,text:i.L(r?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!r}}if(i.moveColumns){const r=i.getColumnToMoveBefore(t),l=i.getColumnToMoveAfter(t);r&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:i.L("L{moveBefore}",B.encodeHtml(r.text)),onItem:()=>{const{parent:o}=t;if(r.parent.insertChild(t,r)){var s;t.region=r.region,(s=o.children)!==null&&s!==void 0&&s.length||o.remove()}}}),l&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:i.L("L{moveAfter}",B.encodeHtml(l.text)),onItem:()=>{const{parent:o}=t;if(l.parent.insertChild(t,l.nextSibling)){var s;t.region=l.region,(s=o.children)!==null&&s!==void 0&&s.length||o.remove()}}})}}return e}getColumnToMoveBefore(e){const{previousSibling:t,parent:i}=e;if(t)return t.children&&!e.children?t.children[t.children.length-1]:t;if(!i.isRoot)return i}getColumnToMoveAfter(e){const{nextSibling:t,parent:i}=e;if(t)return t;if(!i.isRoot)return i}}Se.featureClass="",Se._$name="HeaderMenu",_.registerFeature(Se,!0);class ye extends ${static get $name(){return"Sort"}static get configurable(){return{multiSort:!0,prioritizeColumns:!1,toggleOnHeaderClick:!0}}static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(this.store),super.construct(e,t)}processConfig(e){return typeof e=="string"||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this})}set field(e){const t=this.grid.columns.get(e);t&&typeof t.sortable=="object"&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){const e=this,{grid:t}=e;if(!t.hideHeaders&&t.isPainted){const r=e.store.sorters,l=r.length,o=new Le;let s;for(const n of t.columns.visibleColumns){if(!n.sortable)continue;const a=n.element,d=n.textWrapper,u=d==null?void 0:d.dataset;let c="none";if(u!=null&&u.sortIndex&&delete u.sortIndex,o.value=a.classList,n.sortable===!1){var i;o.remove(e.sortableCls),d==null||(i=d.querySelector(".b-sort-icon"))===null||i===void 0||i.remove()}else d!=null&&d.querySelector(".b-sort-icon")||p.createElement({parent:d,className:"b-sort-icon"}),o.add(e.sortableCls),s=r.find(h=>h.field===n.field||h.sortFn&&h.sortFn===n.sortable.sortFn),s?(l>1&&u&&(u.sortIndex=r.indexOf(s)+1),o.add(e.sortedCls),s.ascending?(o.add(e.sortedAscCls),o.remove(e.sortedDescCls),c="ascending"):(o.add(e.sortedDescCls),o.remove(e.sortedAscCls),c="descending")):(o.remove(e.sortedCls),o["b-group"]||(o.remove(e.sortedAscCls),o.remove(e.sortedDescCls)));p.syncClassList(a,o),p.setAttributes(a,{"aria-sort":c})}}}populateHeaderMenu({column:e,items:t}){const i=this,{store:r}=i,l={...e.sortable,field:e.field,columnOwned:!0};if(e.sortable!==!1&&(t.sortAsc={text:"L{sortAscending}",localeClass:i,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>r.sort(l,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:i,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:i.disabled,onItem:()=>r.sort(l,!1)},i.multiSort&&i.grid.columns.records.some(o=>o.sortable))){const o=r.sorters.find(s=>s.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===s.sortFn);t.multiSort={text:"L{multiSort}",localeClass:i,icon:"b-fw-icon b-icon-sort",weight:320,disabled:i.disabled,menu:{addSortAsc:{text:o?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:i,icon:"b-fw-icon b-icon-sort-asc",disabled:o&&(o==null?void 0:o.ascending),weight:330,onItem:()=>r.addSorter(l,!0)},addSortDesc:{text:o?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:i,icon:"b-fw-icon b-icon-sort-desc",disabled:o&&!o.ascending,weight:340,onItem:()=>r.addSorter(l,!1)},removeSorter:{text:"L{removeSorter}",localeClass:i,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!o,onItem:()=>{r.removeSorter(l.field)}}}}}}getColumnDragToolbarItems(e,t){const i=this,{store:r,disabled:l}=i;if(e.sortable!==!1){const o=r.sorters.find(s=>s.field===e.field);t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:i,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:l,onDrop:({column:s})=>r.sort(s.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:i,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:l,onDrop:({column:s})=>r.sort(s.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:i,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:l||o&&o.ascending,weight:105,onDrop:({column:s})=>r.addSorter(s.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:i,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:l||o&&!o.ascending,weight:105,onDrop:({column:s})=>r.addSorter(s.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:i,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:l||!o,onDrop:({column:s})=>r.removeSorter(s.field)})}return t}onStoreBeforeSort({sorters:e}){const{columns:t}=this.client;for(let r=0;r<e.length;r++){var i;const l=e[r],o=(l.columnOwned||this.prioritizeColumns)&&t.get(l.field);o!=null&&(i=o.sortable)!==null&&i!==void 0&&i.sortFn&&(e[r]={...l,...o.sortable,columnOwned:!0})}}onElementClick(e){const t=this,{store:i}=t,{target:r}=e,l=r.closest(".b-grid-header.b-sortable"),o=l==null?void 0:l.dataset.column;if(!(t.ignoreRe.test(r.className)||t.disabled||e.handled)&&l&&o&&(t.toggleOnHeaderClick||r.closest(".b-sort-icon"))){const s=t.grid.columns.getById(l.dataset.columnId);if(i.isGrouped&&i.groupers.find(a=>a.field===o)&&!e.shiftKey)return;if(s.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)i.removeSorter(s.field);else{const a={columnOwned:!0,field:s.field};typeof s.sortable=="object"&&w.assign(a,s.sortable),i.sort(a,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}}ye.featureClass="b-sort",ye._$name="Sort",_.registerFeature(ye,!0);class Be extends ${static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:t}=this,i=e.dataIndex%2===0;e.assignCls({"b-even":!t&&i,"b-odd":!t&&!i})}}Be._$name="Stripe",_.registerFeature(Be);const ke=document.createRange();class de extends j{static get configurable(){return{cls:{$config:{equal:(e,t)=>(e==null?void 0:e.isDomClassList)&&(t==null?void 0:t.isDomClassList)&&e.isEqual(t)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new y({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),this.grid.positionMode==="position"&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement(t=>{t.dataset.index=e,t.ariaRowIndex=this.grid.hideHeaders?e+1:e+2}))}get id(){return this._id}set id(e){const t=this,i={id:e},r=t.rowManager.idMap;(t._id!==e||r[e]!==t)&&(r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e,t.eachElement(l=>{G.assign(l,i),l.dataset.id=e}),t.eachCell(l=>G.assign(l,i)))}addElement(e,t){const i=this;let r=t.firstElementChild;for(i._elements[e]=t,i._elementsArray.push(t),i._regions.push(e),G.assign(t,{index:i.index}),i._cells[e]=[];r;)i._cells[e].push(r),i._allCells.push(r),G.set(r,{column:r.dataset.column,columnId:r.dataset.columnId,rowElement:r.parentNode,row:i}),r=r.nextElementSibling;t.dataset.index=i.index,t.ariaRowIndex=i.grid.hideHeaders?i.index+1:i.index+2}getElement(e){return this._elements[e]}getRectangle(e){return D.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e,t=!1){return this._allCells.find(i=>{const r=G.get(i);return r.columnId==e||!t&&r.column==e})}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement(i=>i.remove()),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement(i=>i.style.height=`${t.offsetHeight}px`),t.lastHeight=t.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return e!=null&&e.isDomClassList?e:new Le(e)}updateCls(e){this.eachElement(t=>p.syncClassList(t,e))}setAttribute(e,t){this.eachElement(i=>i.setAttribute(e,t))}removeAttribute(e){this.eachElement(t=>t.removeAttribute(e))}get isFirst(){return this.dataIndex===0}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translate(e,t=!1){return this.setTop(e,t),e+this.offsetHeight}translateElements(e){const t=this,{top:i,_elementsArray:r}=t;if(t.lastTop!==i){for(let l=0,{length:o}=r;l<o;l++)r[l].style.transform=`translate(0,${i}px)`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=i}}positionElements(e){const t=this,{top:i,_elementsArray:r}=t;if(t.lastTop!==i){for(let l=0,{length:o}=r;l<o;l++)r[l].style.top=`${i}px`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=i}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,i=!0,r=!1,l=!1){var U;var o,s;const n=this,{cellContext:a,cls:d,elements:u,grid:c,rowManager:h,height:g,_id:f}=n,C=G.get(n._elementsArray[0]),b=h._rowHeight,{store:x}=c,{isTree:S}=x;let E=0,v;if(!t&&t!==!1&&(t=c.store.getById(C.id),e=c.store.indexOf(t)),!t)return;const R=(o=t)===null||o===void 0?void 0:o.cls,F=R?R.isDomClassList?R:new Le(R):null;d.assign({"b-grid-row-updating":i&&c.transitionDuration&&!l,"b-selected":c.isSelected((s=t)===null||s===void 0?void 0:s.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),n.lastRecordCls&&d.remove(n.lastRecordCls),F?(d.add(F),n.lastRecordCls=Object.assign({},F)):n.lastRecordCls=null,h.trigger("beforeRenderRow",{row:n,record:t,recordIndex:e,oldId:f}),c.beforeRenderRow({row:n,record:t,recordIndex:e,oldId:f}),n.updateCls(d),i&&c.transitionDuration&&!l&&c.setTimeout(()=>{n.isDestroyed||(d.remove("b-grid-row-updating"),n.updateCls(d))},c.transitionDuration),n.id=t.id,n.dataIndex=e;const M=!c.fixedRowHeight&&c.getRowHeight(t)||b;let P=n.maxRequestedHeight=null;if(S)for(const V in u){const W=u[V];if(W.id=`${c.id}-${V}-${n.id}`,p.setAttributes(W,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(x)){var z,N;p.setAttributes(W,{"aria-expanded":!0,"aria-owns":(z=t.children)!==null&&z!==void 0&&z.length?(N=t.children)===null||N===void 0?void 0:N.map(He=>`${c.id}-${V}-${He.id}`).join(" "):null})}else t.isLeaf?W.removeAttribute("aria-expanded"):W.setAttribute("aria-expanded",!1),W.removeAttribute("aria-owns")}for(a._record=t,a._id=t.id,a._rowIndex=e,E=0;E<c.columns.visibleColumns.length;E++){const V=c.columns.visibleColumns[E];a._columnId=V.id,a._column=V,a._columnIndex=E,a._cell=n.getCell(V.id,!0),a.height=M,a.maxRequestedHeight=P,a.updatingSingleRow=i,v=n.renderCell(a),h.fixedRowHeight||v.height!=null&&(P=Math.max(P,v.height),v.transient||(n.maxRequestedHeight=P))}const A=P!=null?P:M;n.height=(U=c.processRowHeight(t,A))!=null?U:A,n.updateElementsHeight(l),i&&!l&&(g!==n.height&&h.translateFromRow(n,r),h.trigger("updateRow",{row:n,record:t,recordIndex:e,oldId:f}),h.trigger("renderDone")),c.afterRenderRow({row:n,record:t,recordIndex:e,oldId:f,oldHeight:g,isExport:l}),h.trigger("renderRow",{row:n,record:t,recordIndex:e,oldId:f,isExport:l}),g&&n.height!==g&&h.trigger("rowRowHeight",{row:n,record:t,height:n.height,oldHeight:g}),n.forceInnerHTML=!1}renderCell(e){var t,i;e.isLocation||(e=new y(e));let{cell:r,record:l}=e;const o=this,{grid:s,column:n,height:a,maxRequestedHeight:d,updatingSingleRow:u=!0,isMeasuring:c=!1}=e,h=(t=s.features)===null||t===void 0?void 0:t.cellEdit,g=G.get(r),f=g.rowElement,C=G.get(f);if(!l&&(l=e._record=s.store.getById(C.id),!l))return;let b=n.getRawValue(l);const x=l.fieldMap[n.field],S={configuredHeight:a,height:null,maxRequestedHeight:d},E=n.getCellClass(e),v={cellElement:r,dataField:x,rowElement:f,value:b,record:l,column:n,size:S,grid:s,row:g.row,updatingSingleRow:u,isMeasuring:c},R=n.renderer||n.defaultRenderer;s.beforeRenderCell(v),v.cellElement!==r&&(r=v.cellElement),p.syncClassList(r,E);let F=!0;R?(b=n.callback(R,n,[v]),b===void 0&&n.alwaysClearCell===!1&&(F=!1)):x&&(b=x.print(b));const M=(i=s.hasFrameworkRenderer)===null||i===void 0?void 0:i.call(s,{cellContent:b,column:n});M&&l.isSpecialRow&&(b="");const P=M&&!n.data.tree&&!l.isSpecialRow;if(F&&!P){var z;let A=r;h!=null&&(z=h.editorContext)!==null&&z!==void 0&&z.equals(e)&&!h.editor.isFinishing&&(A=o.moveContentFromCell(r,h.editor.element));const U=b!=null&&typeof b=="object",V=typeof b=="string",W=U||b==null?"":String(b);if(o.forceInnerHTML&&(A.innerHTML="",delete A._content,r.lastDomConfig=null),!U&&n.htmlEncode&&!n.disableHtmlEncode?r._hasHtml?(A.innerText=W,r._hasHtml=!1):p.setInnerText(A,W):n.autoSyncHtml&&(!V||p.getChildElementCount(A))?V?p.sync(W,A.firstElementChild):U&&he.sync({domConfig:b,targetElement:A}):U?he.sync({targetElement:A,domConfig:{onlyChildren:!0,children:L.asArray(b)}}):A._content!==W&&(A.innerHTML=A._content=W),A!==r){const{firstChild:He}=r;for(const ct of A.childNodes)r.insertBefore(ct,He)}}if(!l.isSpecialRow){var N;(N=s.processCellContent)===null||N===void 0||N.call(s,{cellElementData:g,rendererData:v,rendererHtml:v.rendererHtml||b})}return n.autoHeight&&S.height==null&&(r.classList.add("b-measuring-auto-height"),S.height=Math.max(r.offsetHeight,s.rowHeight),r.classList.remove("b-measuring-auto-height")),c||o.rowManager.trigger("renderCell",v),S}moveContentFromCell(e,t){ke.setStart(e,0),ke.setEndBefore(t);const i=document.createElement("div");return i.appendChild(ke.extractContents()),i}}I(de,"$name","Row"),de.initClass(),de._$name="Row";class ce extends J{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:t}=e.columns;let i;e.columns.traverse(r=>{const l=e.getBarCellElement(r.id),o=p.setLength(r.width),s=p.setLength(r.minWidth),n=p.setLength(r.maxWidth);if(l){if(i=o,l.style.maxWidth=n,r.isParent&&r.width==null&&r.flex==null){const a=r.children.reduce((d,u)=>d+=!u.hidden&&u.flex||0,0);l.style.flex=a>0?`${a} 0 auto`:"",l.style.minWidth=null,a>0&&r.traverse(d=>d.data.minWidth=null)}else if(parseInt(r.minWidth)>=0&&(l.style.minWidth=s),l.style.flex=l.style.flexBasis=l.style.width="",r.flex)!isNaN(parseInt(r.flex))&&r.children?l.style.flex=`${r.flex} 0 auto`:l.style.flex=r.flex;else if(parseInt(r.width)>=0){const a=r.parent;e.isHeader&&!a.isRoot&&!a.width?l.style.width=o:l.style.flexBasis=i}r.height>=0&&(l.style.height=p.setLength(r.height))}}),e.scrollable.element.classList.toggle("b-has-flex",t)}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}ce.initClass(),ce._$name="Bar";class xe extends ce{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return ie.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map(t=>ie.tpl`
                <div
                    class="b-grid-footer ${t.align?`b-grid-footer-align-${t.align}`:""} ${t.cls||""}"
                    data-column="${t.field||""}" data-column-id="${t.id}" data-all-index="${t.allIndex}"
                    role="presentation">
                    ${t.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}}xe.initClass(),xe._$name="Footer";class Re extends ${static get pluginConfig(){return{chain:["destroy"],assign:["rowHeight","topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach(e=>e.destroy()),super.doDestroy()}initWithHeight(e,t=!1){const i=this;return i.autoHeight&&(e=i.store.allCount*i.preciseRowOffsetHeight),i.viewHeight=e,i.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const i=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:r}=t;r&&(r.dataIndex=t.topIndex,r.setTop(i,!0)),t.estimateTotalHeight(),t.renderFromRow(r)}matchRowCount(e=!1){const t=this,{rows:i,grid:r}=t,l=i.length,o=l-t.rowCount;if(o)if(o<0){const a=[];for(let d=l,u=l?i[l-1].dataIndex+1:0;d<t.rowCount;d++,u++)a.push(new de({cls:r.rowCls,rowManager:t,grid:r,index:d,dataIndex:u}));i.push.apply(i,a),t.trigger("addRows",{rows:a}),e||t.renderFromRow(i[Math.max(0,l-1)])}else{var s;const{focusedCell:a}=r,d=(a==null?void 0:a.id)!=null&&(a==null||(s=a.cell)===null||s===void 0?void 0:s.contains(p.getActiveElement(r))),u=i.splice(l-o,o);if(d){var n;o===l?r.onFocusedRowDerender():((n=t.getRowFor(a._record))===null||n===void 0?void 0:n.index)>=i.length&&i[i.length-1].cells[a.columnIndex].focus()}t.trigger("removeRows",{rows:u}),u.forEach(c=>c.destroy())}}calculateRowCount(e=!1,t=!0,i=!1){var r;const l=this,{store:o}=l,s=Math.ceil(l.viewHeight/l.minRowOffsetHeight),n=s+l.prependRowBuffer+l.appendRowBuffer;if(!((r=l.grid.columns)!==null&&r!==void 0&&r.count)||isNaN(s))return l.rowCount=0,0;if(n<l.rowCount&&!t)return l.rowCount;if(l.visibleRowCount=s,l.rowCount=Math.min(o.count,n),!e){if(l.rows&&l.rowCount!==l.rows.length){var a;if(l.matchRowCount(i),((a=l.bottomRow)===null||a===void 0?void 0:a.dataIndex)>=o.count&&l.topRow.dataIndex!==0){const d=l.bottomRow.dataIndex-o.count+1;for(const u of l.rows)u.dataIndex-=d;l.topIndex-=d}}else l.rowCount||l.trigger("changeTotalHeight",{totalHeight:l.totalHeight});l.grid.toggleEmptyText()}return l.rowCount}removeAllRows(){const e=this,{topRow:t}=e,i=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,r=e.rows.slice();return e.trigger("removeRows",{rows:r}),e.rows.forEach(l=>l.destroy()),e.rows.length=0,e.idMap={},i}setPosition(e){const{topRow:t}=this,{topRowIndex:i,topRowTop:r}=e;t.setTop(r),t.dataIndex=i}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return e=e.closest(".b-grid-row"),e&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=D.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=p.roundPx(e),this.rows.find(i=>e>=i.top&&e<i.bottom)}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t=typeof e=="number"?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find(e=>e.bottom>Math.ceil(this.grid.scrollable.y))}get firstFullyVisibleRow(){return this.rows.find(e=>e.top>=Math.ceil(this.grid.scrollable.y))}get lastVisibleRow(){const{grid:e}=this;return L.findLast(this.rows,t=>t.top<e.scrollable.y+e.bodyHeight)}get lastFullyVisibleRow(){const{grid:e}=this;return L.findLast(this.rows,t=>t.bottom<e.scrollable.y+e.bodyHeight)}offsetRows(e){if(e!==0){const{rows:t}=this,{length:i}=t;for(let r=0;r<i;r++)t[r].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:i,fixedRowHeight:r}=t,l=t.rowHeight;if(l!==e){if(w.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,r&&(t.averageRowHeight=e),t.rows.length){const o=i.scrollable.y,s=t.getRowAt(o,!0),n=s?s.top-o:0;let a,d;r?(a=e,d=l):(d=a=t.averageRowHeight,t.clearKnownHeights(),a*=e/l),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(a+i._rowBorderHeight),!0),t.refresh(),o*(a/d)!==o&&i.scrollRowIntoView(s.id,{block:"start",edgeOffset:n})}t.trigger("rowHeight",{height:e,oldHeight:l})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const i=this,{heightMap:r}=i;i.fixedRowHeight||(r.has(e)&&(i.totalKnownHeight-=r.get(e)),r.set(e,t),i.totalKnownHeight+=t,t<i.minRowHeight&&(i.minRowHeight=t),i.averageRowHeight=i.totalKnownHeight/r.size)}getOffsetHeight(e){const t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:i}=t;e=L.asArray(e),e.forEach(r=>{r&&i.has(r.id)&&(t.totalKnownHeight-=i.get(r.id),i.delete(r.id))}),t.averageRowHeight=t.totalKnownHeight/i.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let i=0;for(let r=0;r<e;r++){const l=t.getAt(r);i+=this.getOffsetHeight(l)}return Math.floor(i)}getRecordCoords(e,t=!1,i=!1){const r=this,l=r.getRowById(e);let o=r.client._bodyRectangle;return t||(o=r.client.refreshBodyRectangle()),l?new D(o.x,Math.round(t?l.top:l.top+o.y-r.client.scrollable.y),o.width,l.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(e),t,i)}getRecordCoordsByIndex(e,t=!1,i=!1){const r=this,{topRow:l,bottomRow:o}=r,s=r.client._bodyRectangle,{id:n}=r.store.getAt(e),a=r.preciseRowOffsetHeight,d=l.dataIndex,u=o.dataIndex,c=e>u?{index:e-u-1,y:o.bottom,from:"bottomRow"}:e>d/2?{index:e-d,y:l.top,from:"topRow"}:{index:e,y:0,from:"top"},h=r.allHeightsKnown&&!i?r.calculateTop(e):Math.floor(c.y+c.index*a),g=new D(s.x,t?h:h+s.y-r.client.scrollable.y,s.width,Math.floor(r.heightMap.get(n)||a));return g.virtual=!0,g.block=g.bottom<s.y?"start":g.y>s.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const i=new y({grid:this.grid,record:e,columnId:t});return!!(i.cell&&i.row.renderCell(i))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:i,store:r}=t,l=r.count;if(t.calculateRowCount(!1,l<i.length,!0)===0){t.estimateTotalHeight(!0);return}const o=e?i.indexOf(e):0;let s=e?e.dataIndex:i[0].dataIndex;const n=l-s-1,a=Math.min(i.length-1,o+n);let d=i.length-a-1,u=o>0?i[o-1].bottom:i[o].top,c;for(let h=o;h<=a;h++)c=i[h],c.dataIndex=s,c.setTop(u,!0),c.render(s,r.getAt(s++),!1),u+=c.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,i=!1;e=Array.from(e),e.sort((r,l)=>r.dataIndex-l.dataIndex);for(const r of e)t=r.height,r.render(null,null,!1),i|=r.height!==t;i&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const i=this;let r=e.bottom,l,o;for(o=e.dataIndex+1,l=i.getRow(o);l;l=i.getRow(++o))r=l.translate(r);t||i.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:t}=e;!t||e.grid.refreshSuspended||(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(e,t){const i=this,{store:r,heightMap:l}=i,o=r.count;if(i.allHeightsKnown&&!i.fixedRowHeight){const s=e-i.prependBufferHeight,n=i.grid._rowBorderHeight;let a=0,d=0;for(;a<s;){const c=r.getAt(d);a+=l.get(c.id)+n,d++}const u=Math.max(Math.min(d,o-i.rowCount),0);i.lastScrollTop=e,i.topRow.dataIndex=i.topIndex=u,i.topRow.setTop(i.calculateTop(u),!1),i.refresh()}else{const s=i.preciseRowOffsetHeight,n=t==null?Math.floor(e/s)-i.prependRowBuffer:t-Math.floor(i.rowCount/2),a=Math.max(Math.min(n,o-i.rowCount),0),d=i.client.scrollable.y,u=Math.min(i.client._bodyRectangle.height+d+i.appendBufferHeight,i.totalHeight);if(i.lastScrollTop=e,i.topRow.dataIndex=i.topIndex=a,i.topRow.setTop(Math.floor(a*s),!1),i.refresh(),i.bottomRow.bottom<u)for(i.calculateRowCount(!1,!1,!1);i.bottomRow.bottom<u&&i._rows[i.prependRowBuffer].top<d&&i.bottomRow.dataIndex<o-1;)i.displayRecordAtBottom();i.estimateTotalHeight()}if(t!=null){const{scrollable:s}=i.grid,n=i.getRow(t),a=n&&D.from(n._elementsArray[0]).center.y,d=s.viewport.center.y;n&&(s.y=e=Math.floor(s.y+(a-d)))}return e}warpIfNeeded(e){const t=this,i={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(i.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),i.newScrollTop=t.jumpToPosition(e,r),i.deltaTop=0}return i}updateRenderedRows(e,t,i=!1){const r=this,l=r.client._bodyRectangle;if(r.rowCount===0)return 0;let o=r.totalHeight;if(t||Math.abs(e-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>e||r.bottomRow.bottom<e+l.height){const s=r.warpIfNeeded(e);r.scrollTargetRecordId=null,r.lastScrollTop=s.newScrollTop,s.deltaTop>0?r.fillBelow(s.newScrollTop):s.deltaTop<0&&r.fillAbove(s.newScrollTop),!r.fixedRowHeight&&!i&&r.correctError(s,l,e),o=r.estimateTotalHeight()}return o}correctError(e,t,i){const r=this;let l=0;(r.allHeightsKnown||e.deltaTop<0&&i<t.height*2||e.deltaTop>0&&i>r.totalHeight-t.height*2-3)&&(l=r.topRow.top-r.calculateTop(r.topRow.dataIndex)),l&&(r.offsetRows(-l),r.grid.scrollable.y=r.lastScrollTop=r.grid.scrollable.y-l)}fillAbove(e){const t=this,i=e-t.topRow.top-t.prependBufferHeight;let r=0;for(;r>i&&t.topIndex>0;)r-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,i=e-t.topRow.top-t.prependBufferHeight,r=t.store.count,l=t.rowCount;let o=0;for(;o<i&&t.topIndex+l<r&&t.topRow.top+t.topRow.offsetHeight<e;)o+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const i=t.store.count,r=i-t.heightMap.size,{bottomRow:l}=t;let o;if(t.fixedRowHeight)o=i*t.rowOffsetHeight;else{if(o=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+r*t.preciseRowOffsetHeight,l&&r){const s=l.bottom;(s>o||t.topIndex+t.rowCount>=i&&o>s&&s>0)&&(o=s,l.dataIndex<i-1&&(o+=(i-1-l.dataIndex)*t.preciseRowOffsetHeight))}o=Math.floor(o)}return o!==t.totalHeight&&t.trigger("changeTotalHeight",{totalHeight:o,immediate:e})!==!1&&(t._totalHeight=o),o}displayRecordAtTop(){var e;const t=this,{grid:i}=t,r=t.topIndex-1,l=t.store.getAt(r),o=t.bottomRow,s=o.top;return t.trigger("beforeTranslateRow",{row:o,newRecord:l}),o.dataIndex===((e=i.focusedCell)===null||e===void 0?void 0:e.rowIndex)&&i.onFocusedRowDerender(),o._top=t.topRow.top-t.getOffsetHeight(l),o.estimatedTop=!t.fixedRowHeight,o.render(r,l,!1),o._top=s,o.setBottom(t.topRow.top),o.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),o.offsetHeight}displayRecordAtBottom(){var e;const t=this,{grid:i}=t,r=t.topIndex+t.rowCount,l=t.store.getAt(r),o=t.topRow;return t.trigger("beforeTranslateRow",{row:o,newRecord:l}),o.dataIndex===((e=i.focusedCell)===null||e===void 0?void 0:e.rowIndex)&&i.onFocusedRowDerender(),o.dataIndex=r,o.setTop(t.bottomRow.bottom),o.render(r,l,!1),t.topIndex++,t._rows.push(t._rows.shift()),o.offsetHeight}}Re.featureClass="",Re._$name="RowManager";const Bt={x:1},et=m=>m.isSubGrid;class tt extends De{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=Bt){if(typeof t=="string"&&(t={[t]:1}),t.x){e.owner.initScroll();const i=this.widget.items.filter(et),r=e.widget.items.filter(et);for(let l=0,{length:o}=i;l<o;l++)i[l].scrollable.addPartner(r[l].scrollable,"x")}t.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach((t,i)=>{t.isDestroyed||t.removePartner(e.xScrollers[i])}),super.removePartner(e)}updateOverflowX(e){var t;const i=e===!1;(t=this.xScrollers)===null||t===void 0||t.forEach(r=>r.overflowX=i?"hidden":"hidden-scroll"),this.widget.virtualScrollers.classList.toggle("b-hide-display",i)}scrollIntoView(e,t){if(e.nodeType===Element.ELEMENT_NODE&&this.element.contains(e)){for(const i of this.xScrollers)if(i.element.contains(e))return i.scrollIntoView(e,t)}else return super.scrollIntoView(e,t)}hasOverflow(e="y"){return e==="y"?this.scrollHeight>this.clientHeight:!1}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}tt._$name="GridScroller";class ee extends ce{get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return(e=this.subGrid)===null||e===void 0?void 0:e.region}changeElement(e,t){const{region:i}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${i}`]:i},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${i}`]:i},dataset:{region:i,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:t,align:i,resizable:r,isLeaf:l,isParent:o,isLastInSubGrid:s,cls:n,childLevel:a,field:d,tooltip:u,children:c,isFocusable:h,grid:g}=e,f=g==null?void 0:g.focusedCell,C=(f==null?void 0:f.rowIndex)===-1&&(f==null?void 0:f.column)===e;if(e.isVisible)return{className:{"b-grid-header":1,"b-grid-header-parent":o,[`b-level-${a}`]:1,[`b-depth-${e.meta.depth}`]:1,[`b-grid-header-align-${i}`]:i,"b-grid-header-resizable":r&&l,[n]:n,"b-collapsible":e.collapsible,"b-last-parent":o&&s,"b-last-leaf":l&&s},role:h?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[h?"tabIndex":""]:C?0:-1,dataset:{...qe.encodeConfig(u),columnId:t,[d?"column":""]:d},children:[{className:"b-grid-header-text",children:[{[g&&h?"id":""]:`${g==null?void 0:g.id}-column-${e.id}`,className:"b-grid-header-text-content"}]},c?{className:"b-grid-header-children",children:c.map(b=>this.getColumnConfig(b)),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach(t=>{e+=t.calculateMinWidth()}),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse(t=>{const i=e.getBarCellElement(t.id);if(i){let r=t.headerText;t.headerRenderer&&(r=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:i})),t.headerWidgetMap&&Object.values(t.headerWidgetMap).forEach(o=>{o.render(t.textWrapper)}),t.icon&&(r=`<i class="${B.encodeHtml(t.icon)}"></i>`+(r||""));const l=i.querySelector(".b-grid-header-text-content");l&&(l.innerHTML=r||"")}}),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){const i=this;let r=0;t!=null&&t.meta&&t.meta.depth++;for(const l of e){const{meta:o}=l;o.depth=0,l.children&&(i.initDepths(l.children.filter(i.columns.chainedFilterFn),l),o.depth&&t&&(t.meta.depth+=o.depth)),o.depth>r&&(r=o.depth)}return t||(i.maxDepth=r),r}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;he.sync({domConfig:{children:e.columns.topColumns.map(t=>e.getColumnConfig(t)),onlyChildren:!0},targetElement:e.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}}I(ee,"$name","Header"),I(ee,"type","gridheader"),ee.initClass(),ee._$name="Header";const Pe={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},it=["pageX","pageY","clientX","clientY","screenX","screenY"];function ue(m,e=!0){m==null||m.classList.toggle("b-hover",e)}function Ee(m,e,t=!0){e&&m&&ue(e.getCell(m),t)}var rt=m=>class extends(m||j){static get $name(){return"GridElementEvents"}static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const t=Object.keys(Pe),i=t.length,r={element:this.bodyElement,thisObj:this};for(let l=0;l<i;l++){const o=t[l];r[o]={handler:"handleEvent"},o.startsWith("touch")&&(r[o].passive=!1)}X.on(r),X.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(t,i=!1){const r=this,{columns:l}=r,{target:o}=t;let s=o.closest(".b-grid-cell");if(!s&&i&&!o.classList.contains("b-grid-row")&&!o.classList.contains("b-grid-subgrid")){const{top:a,left:d,right:u,bottom:c}=r.bodyContainer.getBoundingClientRect();let h,{x:g,y:f}=t;if(g>=d&&g<=u?f=h=Math.ceil(r[`${f<a?"first":"last"}FullyVisibleRow`].element.getBoundingClientRect().y):f>=a&&f<=c&&(g=h=Math.ceil(l.visibleColumns[g<d?0:l.visibleColumns.length-1].element.getBoundingClientRect().x)),h!==void 0){var n;s=(n=p.childFromPoint(t.target,t.offsetX,t.offsetY))===null||n===void 0?void 0:n.closest(".b-grid-cell")}}if(s){const a=G.get(s),{id:d,columnId:u}=a,c=r.store.getById(d),h=l.getById(u);return c?{cellElement:s,cellData:a,columnId:u,id:d,record:c,column:h,cellSelector:{id:d,columnId:u}}:null}}getHeaderDataFromEvent(t){const i=t.target.closest(".b-grid-header");if(i){const r=w.assign({},i.dataset),{columnId:l}=r,o=this.columns.getById(l);return o?{headerElement:i,headerData:r,columnId:l,column:o}:null}}handleEvent(t){!this.disabled&&Pe[t.type]&&this[Pe[t.type]](t)}onElementTouchStart(t){const i=this,r=i.getCellDataFromEvent(t);p.isTouchEvent=!0,t.touches.length===1&&(i.longPressTimeout=i.setTimeout(()=>{i.onElementLongPress(t),t.preventDefault(),i.longPressPerformed=!0},i.longPressTime)),r&&!t.defaultPrevented&&i.onFocusGesture(t)}onElementTouchMove(t){const i=this,{lastTouchTarget:r}=i,l=t.changedTouches[0],{pageX:o,pageY:s}=l,n=document.elementFromPoint(o,s);if(i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null),n!==r){if(r){const a=new MouseEvent("mouseout",w.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},l,it));a.preventDefault=()=>t.preventDefault(),r==null||r.dispatchEvent(a)}if(n){const a=new MouseEvent("mouseover",w.copyProperties({relatedTarget:r,pointerType:"touch",bubbles:!0},l,it));a.preventDefault=()=>t.preventDefault(),n==null||n.dispatchEvent(a)}}i.lastTouchTarget=n}onElementTouchEnd(t){const i=this;i.longPressPerformed&&(t.cancelable&&t.preventDefault(),i.longPressPerformed=!1),i.longPressTimeout&&(i.clearTimeout(i.longPressTimeout),i.longPressTimeout=null)}onElementLongPress(t){}triggerCellMouseEvent(t,i,r=this.getCellDataFromEvent(i)){const l=this;if(r){const s=l.columns.getById(r.columnId),n={grid:l,record:r.record,column:s,cellSelector:r.cellSelector,cellElement:r.cellElement,target:i.target,event:i};if(l.trigger("cell"+B.capitalize(t),n),t==="click"){var o;(o=s.onCellClick)===null||o===void 0||o.call(s,n)}}}onElementMouseDown(t){const i=this,r=i.getCellDataFromEvent(t);i.skipFocusSelection=!0,i.isScrollbarOrRowBorderOrSplitterClick(t)?t.preventDefault():(i.triggerCellMouseEvent("mousedown",t,r),r&&!t.defaultPrevented&&i.onFocusGesture(t))}isScrollbarOrRowBorderOrSplitterClick({target:t,x:i,y:r}){if(t.closest(".b-grid-splitter")||t.matches(".b-grid-row, .b-virtual-width"))return!0;if(t.matches(".b-vertical-overflow")){const l=t.getBoundingClientRect();return i>l.right-p.scrollBarWidth}else if(t.matches(".b-horizontal-overflow")){const l=t.getBoundingClientRect();return r>l.bottom-p.scrollBarWidth-1}}onElementMouseMove(t){this.mouseMoveEvent=t}onElementMouseUp(t){}onElementPointerDown(t){}onElementPointerUp(t){}onHandleElementClick(t){this.trigger("beforeElementClick",{event:t})!==!1&&this.onElementClick(t)}onElementClick(t){const i=this,r=i.getCellDataFromEvent(t);r&&i.triggerCellMouseEvent("click",t,r)}onFocusGesture(t){const i=this,{navigationEvent:r}=i,{target:l}=t,o=t.button===2,s=!o&&l.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),n=!document.hasFocus()&&O.isMac&&o;if(s||n)t.preventDefault();else{var a;i.navigationEvent=t;const d=new y(l);if(o||(a=i.focusedCell)!==null&&a!==void 0&&a.equals(d)){let u;globalThis.TouchEvent&&t instanceof MouseEvent&&r instanceof TouchEvent&&l===r.target&&(u={doSelect:!1}),i.focusCell(d,u)}}}onElementDblClick(t){const{target:i}=t;if(this.triggerCellMouseEvent("dblClick",t),i.classList.contains("b-grid-header-resize-handle")){const r=i.closest(".b-grid-header");this.columns.getById(r.dataset.columnId).resizeToFitContent()}}onElementMouseOver(t){if(!this.scrolling){const r=this,{hoveredCell:l}=r,o=(typeof t.buttons!="number"||t.buttons===0)&&t.pointerType!=="touch";let s=t.target.closest(".b-grid-cell");if(!s&&t.target.classList.contains("b-grid-row")){var i;s=(i=p.childFromPoint(t.target,t.offsetX,t.offsetY-2))===null||i===void 0?void 0:i.closest(".b-grid-cell")}s&&(o&&(r.hoveredCell=s),!l&&r.hoveredCell&&r.triggerCellMouseEvent("mouseOver",t)),r.trigger("mouseOver",{event:t})}}onElementMouseOut(t){const i=this,{hoveredCell:r}=i,{target:l,relatedTarget:o}=t;if(!(o!=null&&o.closest(".b-grid-cell")&&l.matches(".b-grid-row"))){var s;o&&l.matches(".b-grid-cell")&&!l.contains(o)?o!=null&&o.matches(".b-grid-row")||(i.hoveredCell=o.closest(".b-grid-cell")):!(o!=null&&o.matches(".b-grid-row,.b-grid-cell"))&&!((s=i.hoveredCell)!==null&&s!==void 0&&s.contains(o))&&(i.hoveredCell=null)}i.scrolling||(r&&!i.hoveredCell&&i.triggerCellMouseEvent("mouseOut",t),i.trigger("mouseOut",{event:t}))}updateHoveredCell(t,i){var r,l;const o=this,{selectionMode:s}=o,n=s.rowNumber&&((r=o.columns.find(c=>c.type=="rownumber"))===null||r===void 0?void 0:r.id),a=s.checkbox&&((l=o.checkboxSelectionColumn)===null||l===void 0?void 0:l.id);if(i){ue(i,!1);const c=G.get(i),{row:h}=c;if(h&&!h.isDestroyed&&(Ee(n,h,!1),Ee(a,h,!1)),c!=null&&c.columnId){var d;ue((d=o.columns.getById(c.columnId))===null||d===void 0?void 0:d.element,!1)}}if(o._hoveredRow&&!o._hoveredRow.isDestroyed&&o._hoveredRow.removeCls("b-hover"),o._hoveredRow=null,t&&!o.scrolling){const c=G.get(t),{row:h}=c;if(h)if(s.cell&&c.columnId!==n&&c.columnId!==a){var u;ue(t),Ee(a,h),Ee(n,h),ue((u=o.columns.getById(c.columnId))===null||u===void 0?void 0:u.element)}else o._hoveredRow=h,h.addCls("b-hover");else o.hoveredCell=null}}keyMapOnKeyDown(t){this.onElementKeyDown(t),super.keyMapOnKeyDown(t)}onElementKeyDown(t){if(t.handled)return;const i=this,r=i.focusedCell;if(r!=null&&r.isCell&&!r.isActionable){var l,o;const s=r.cell;(l=(o=i.columns.getById(s.dataset.columnId)).onCellKeyDown)===null||l===void 0||l.call(o,{event:t,cellElement:s})}}undoRedoKeyPress(t){var i;const{stm:r}=this.store;return r&&this.enableUndoRedoKeys&&!((i=this.features.cellEdit)!==null&&i!==void 0&&i.isEditing)?(r.onUndoKeyPress(t),!0):!1}clickCellByKey(t){const i=this,r=i.focusedCell,l=r==null?void 0:r.cell,o=i.columns.getById(l.dataset.columnId);return r!=null&&r.isCell&&!r.isActionable&&o.onCellClick?(o.onCellClick({grid:i,column:o,record:i.store.getById(r.id),cellElement:l,target:t.target,event:t}),!0):!1}onElementKeyPress(t){}onElementKeyUp(t){}onElementContextMenu(t){const i=this,r=i.getCellDataFromEvent(t);r&&(i.triggerCellMouseEvent("contextMenu",t,r),p.isTouchEvent&&i.onFocusGesture(t))}onInternalResize(t,i,r,l,o){const s=this;s._devicePixelRatio&&s._devicePixelRatio!==globalThis.devicePixelRatio&&p.resetScrollBarWidth(),s._devicePixelRatio=globalThis.devicePixelRatio,s._bodyRectangle=D.client(s.bodyContainer),super.onInternalResize(...arguments),r!==o&&(s._bodyHeight=s.bodyContainer.offsetHeight,s.isPainted&&s.rowManager.initWithHeight(s._bodyHeight)),s.refreshVirtualScrollbars(),i!==l&&s.setTimeout(()=>{s.isDestroyed||s.updateResponsive(i,l)},0)}get widgetClass(){}};const kt={string:1,object:1,function:1};var lt=m=>class extends(m||j){static get $name(){return"GridFeatures"}set features(t){const i=this,r=_.getInstanceDefaultFeatures(this);t=i._features=w.assign({},t),r&&Object.keys(r).forEach(o=>{o in t||(t[o]=!0)});const l=_.getInstanceFeatures(this);for(const o of Object.keys(t)){const s=t[o];if(s){const n=!globalThis.__bryntum_code_editor_changed;if(B.uncapitalize(o)!==o){const d=`Invalid feature name '${o}', must start with a lowercase letter`;if(n)throw new Error(d);console.error(d),i._errorDuringConfiguration=d}const a=l[o];if(!a){const d=`Feature '${o}' not available, make sure you have imported it`;if(n)throw new Error(d);console.error(d),i._errorDuringConfiguration=d;return}Reflect.defineProperty(t,o,i.createFeatureInitializer(t,o,a,s))}}}get features(){return this._features}createFeatureInitializer(t,i,r,l){const o=[this],s=r.prototype.construct;return l===!0&&(l={}),kt[typeof l]&&(o[1]=l),{configurable:!0,get(){return delete t[i],r.prototype.construct=function(...n){t[i]=this,s.apply(this,n),r.prototype.construct=s},new r(...o)}}}hasFeature(t){const{features:i}=this;if(i){const r=Object.getOwnPropertyDescriptor(this.features,t);if(r)return!!(r.value||r.get)}return!1}hasActiveFeature(t){var i,r;return!!(!((i=this.features)===null||i===void 0)&&i[t]&&!((r=this.features)!==null&&r!==void 0&&r[t].disabled))}getConfigValue(t,i){if(t==="features"){const s={};for(const n in this.features){var r,l,o;const a=(r=this.features[n])===null||r===void 0||(l=(o=r).getCurrentConfig)===null||l===void 0?void 0:l.call(o,i);a?w.isEmpty(a)?_.isDefaultFeatureForInstance(this.features[n].constructor,this)||(s[n]=!0):s[n]=a:s[n]=!1}return s}return super.getConfigValue(t,i)}get widgetClass(){}};const Pt=Object.freeze({}),Gt=Object.freeze({x:!1,y:!1}),Nt=function(m){return this.focusableFinderCell.contains(m)?p.isFocusable(m)&&!m.disabled?p.NodeFilter.FILTER_ACCEPT:p.NodeFilter.FILTER_SKIP:p.NodeFilter.FILTER_REJECT};var Wt=m=>{var e;return e=class extends(m||j){static get $name(){return"GridNavigation"}onStoreRecordIdChange(i){var r;(r=super.onStoreRecordIdChange)===null||r===void 0||r.call(this,i);const{focusedCell:l}=this,{oldValue:o,value:s}=i;l&&l.id===o&&(l._id=s)}onFocusedRowDerender(){const i=this,{focusedCell:r}=i;if((r==null?void 0:r.id)!=null&&r.cell){const l=r.cell.contains(p.getActiveElement(i));if(i.hideHeaders)l&&i.revertFocus();else{const o=i.normalizeCellContext({rowIndex:-1,columnIndex:l?r.columnIndex:0});l?i.focusCell(o):o.cell.tabIndex=0}r.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(y.FIRST_CELL)}navigateFirstColumn(){this.focusCell(y.FIRST_COLUMN)}navigateLastCell(){this.focusCell(y.LAST_CELL)}navigateLastColumn(){this.focusCell(y.LAST_COLUMN)}navigatePrevPage(){this.focusCell(y.PREV_PAGE)}navigateNextPage(){this.focusCell(y.NEXT_PAGE)}activateHeader(i){if(i.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){var r;const{column:l}=this.focusedCell;(r=l.onKeyDown)===null||r===void 0||r.call(l,i),this.getHeaderElement(l.id).click()}return!1}onEscape(i){const{focusedCell:r}=this;!i.target.closest(".b-dragging")&&r!==null&&r!==void 0&&r.isActionable&&(i.stopImmediatePropagation(),this._focusedCell=null,this.focusCell({rowIndex:r.rowIndex,column:r.column},{disableActionable:!0}))}onTab(i){const{target:r}=i,{focusedCell:l,bodyElement:o}=this,{isActionable:s,actionTargets:n}=l;if(s&&p.isEditable(r)&&!r.readOnly&&r===n[n.length-1])i.preventDefault(),this.navigateRight(i);else if(!s||r===n[n.length-1])return o.style.display="none",this.requestAnimationFrame(()=>o.style.display=""),!1}onShiftTab(i){const r=this,{target:l}=i,{focusedCell:o,bodyElement:s}=r,{cell:n,isActionable:a,actionTargets:d}=o,u=a&&p.isEditable(l)&&!l.readOnly,c=o.columnIndex===0&&o.rowIndex===(r.hideHeaders?0:-1);if(!c&&u&&l===d[0])i.preventDefault(),r.navigateLeft(i);else if(!a||l===d[0]){const h=!c&&!r.hideHeaders&&r.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return h?(h.cell.tabIndex=-1,n.tabIndex=0,r._focusedCell=o):(s.style.display="none",r.requestAnimationFrame(()=>s.style.display="")),!1}}onSpace(i){return this.focusedCell.isActionable||i.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var i;return(i=this._focusedCell)===null||i===void 0?void 0:i.isActionable}set focusedCell(i){this.focusCell(i)}get focusedRecord(){var i;return(i=this._focusedCell)===null||i===void 0?void 0:i.record}get cellCSSSelector(){const i=this._focusedCell;return i?`[data-index=${i.rowIndex}] [data-column-id=${i.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(i){var r;return!!(!((r=this._focusedCell)===null||r===void 0)&&r.equals(this.normalizeCellContext(i)))}get focusElement(){if(!this.isDestroying){let r;if(this.store.count&&this._focusedCell)r=this._focusedCell.target;else{var i;r=this.normalizeCellContext({rowIndex:-1,columnIndex:((i=this._focusedCell)===null||i===void 0?void 0:i.columnIndex)||0}).target}const l=super.focusElement;return l&&(!r||r.compareDocumentPosition(l)===Node.DOCUMENT_POSITION_PRECEDING)?l:r}}onPaint({firstPaint:i}){var r;const l=this;(r=super.onPaint)===null||r===void 0||r.call(this,...arguments);const o=this.normalizeCellContext({rowIndex:l.hideHeaders?0:-1,column:l.hideHeaders?0:l.columns.find(s=>!s.hidden&&s.isFocusable)});if(o.cell){l._focusedCell=o;const{target:s}=o;s===o.cell&&(o.cell.tabIndex=0)}}onGridBodyFocusIn(i){const r=this,{bodyElement:l}=r,o=r.focusedCell,s=(o==null?void 0:o.initialTarget)||(o==null?void 0:o.target),{target:n,relatedTarget:a}=i,d=n.closest(r.focusableSelector);if(d&&(!T.currentMouseDown||T.isMouseDown(0)||T.isMouseDown(2))){var u;const g=new y(n),{cell:f}=g,C=o==null?void 0:o.cell,b=g.actionTargets=r.findFocusables(d),x=(!r._fromFocusCell||r.selectOnFocus)&&(n===f||r._selectActionCell)&&!(n!=null&&n._isRevertingFocus);if(!r.store.getById(d.parentNode.dataset.id)&&f!==d){f.focus({preventScroll:!0});return}if(n.matches(r.focusableSelector)){if(r.disableActionable)g._target=f;else if(b.length){var c;r._selectActionCell=((c=T.currentMouseDown)===null||c===void 0?void 0:c.target)===n,b[0].focus(),delete r._selectActionCell;return}}else{var h;if(o!=null&&o.target&&a&&(!T.isMouseDown()||!l.contains((h=T.currentMouseDown)===null||h===void 0?void 0:h.target))&&!l.contains(a)&&!g.equals(o)){s.focus();return}g._target=n}if(C&&(C.classList.remove("b-focused"),C.tabIndex=-1),f&&(f.classList.add("b-focused"),g.column.onCellFocus(g),f===n&&(f.tabIndex=0),f.contains(i.relatedTarget)&&s===n))return;r._focusedCell=g,(u=r.onCellNavigate)===null||u===void 0||u.call(r,r,o,g,x),r.trigger("navigate",{lastFocusedCell:o,focusedCell:g,event:i})}else n.closest(".b-rowexpander-body")||s==null||s.focus()}findFocusables(i){const{focusableFinder:r}=this,l=[];r.currentNode=this.focusableFinderCell=i;for(let o=r.nextNode();o;o=r.nextNode())l.push(o);return l}get focusableFinder(){const i=this;return i._focusableFinder||(i._focusableFinder=i.setupTreeWalker(i.bodyElement,p.NodeFilter.SHOW_ELEMENT,{acceptNode:Nt.bind(i)})),i._focusableFinder}restoreActiveItem(i=this._focusedCell){if(this.rowManager.count)return isNaN(i)?i.isModel||(i=this.store.getById(i)):i=this.store.getAt(i),this.focusCell(i)}focusCell(i,r=Pt){var l,o;const s=this,{_focusedCell:n}=s,{scroll:a,disableActionable:d}=r;if(((l=i)===null||l===void 0?void 0:l.rowIndex)===-1&&s.hideHeaders){s.revertFocus();return}i=typeof i=="number"&&n!==null&&n!==void 0&&n.isLocation?n.move(i):s.normalizeCellContext(i);const u="doSelect"in r?r.doSelect:!i.isActionable||i.initialTarget===i.cell;if(i.equals(n)){var c;return(c=s.onCellNavigate)===null||c===void 0||c.call(s,s,n,i,u),n}const h=s.getSubGridFromColumn(i.columnId),{cell:g}=i,f=g||s.getCell({rowIndex:s.rowManager.topIndex,columnId:i.columnId}),C=D.from(h.element),b=D.from(s.bodyElement),x=D.from(f).moveTo(null,C.y);return a===!1||i.rowIndex===-1?r=Object.assign({},r,Gt):(r=Object.assign({},r,a),x.width>C.width||x.height>b.height?r.x=r.y=!1:r.column=i.columnId,s.scrollRowIntoView(i.id,r)),(s._hoveredRow||s.hoveredCell)&&(s.hoveredCell=null),s.disableActionable=d,s.selectOnFocus=u,s._fromFocusCell=!0,(o=i[d?"cell":"target"])===null||o===void 0||o.focus({preventScroll:!0}),s.disableActionable=s.selectOnFocus=!1,delete s._fromFocusCell,i}blurCell(i){const r=this,l=r.getCell(i);l&&l.classList.remove("b-focused")}clearFocus(i){const r=this;r._focusedCell&&(r.lastFocusedCell=i?null:r._focusedCell,r.blurCell(r._focusedCell),r._focusedCell=null)}internalNextPrevCell(i=!0){const r=this,l=r._focusedCell;return l?r.focusCell({id:l.id,columnId:r.columns.getAdjacentVisibleLeafColumn(l.columnId,i,!0).id}):null}navigateRight(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(this.rtl?y.PREV_CELL:y.NEXT_CELL):(arguments[0]&&K.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(this.rtl?y.NEXT_CELL:y.PREV_CELL):(arguments[0]&&K.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!!this.rtl))}internalNextPrevRow(i,r=!0,l=!0){const o=this,s=o._focusedCell;if(!s)return!1;const n=o.store[`get${i?"Next":"Prev"}`](s.id,!1,r);if(n)return o.focusCell({id:n.id,columnId:s.columnId,scroll:{x:!1}});if(!i&&l&&!s.isColumnHeader)return this.clearFocus(),this.getHeaderElement(s.columnId).focus()}navigateDown(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(y.DOWN):(arguments[0]&&K.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var i;return(i=arguments[0])!==null&&i!==void 0&&i.fromKeyMap?this.focusCell(y.UP):(arguments[0]&&K.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},I(e,"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1},Tab:{handler:"onTab",preventDefault:!1}," ":{handler:"onSpace",preventDefault:!1}}}),e},ot=m=>class extends(m||j){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(t){const i=this,r=Object.keys(w.assign({},i.responsiveLevels));let l=null,o=99995,s=null;return r.forEach(n=>{let a=i.responsiveLevels[n];if(["number","string"].includes(typeof a)||(a=a.levelWidth),a==="*")s=n;else if(t<a){const d=a-t;d<o&&(o=d,l=n)}}),l||s}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(t,i){const r=this,l=r.getClosestBiggerLevel(i),o=r.getClosestBiggerLevel(t);if(i===0||l!==o){const s=r.responsiveLevels[o];["number","string"].includes(typeof s)||r.applyState(s),r.columns.forEach(n=>{const a=n.responsiveLevels;a&&(a[o]?n.applyState(a[o]):a["*"]&&n.applyState(a["*"]))}),r.element.classList.remove("b-responsive-"+l),r.element.classList.add("b-responsive-"+o),r.trigger("responsive",{level:o,width:t,oldLevel:l,oldWidth:i})}}get widgetClass(){}};const zt={string:1,number:1},$t={dataset:1,batch:1};var st=m=>{var e;return e=class extends(m||j){static get $name(){return"GridSelection"}construct(i){this._selectedCells=[],this._selectedRows=[],super.construct(i),i!=null&&i.selectedRecords&&(this.selectedRecords=i.selectedRecords)}getDefaultGridSelection(i){if(i.$name==="GridSelection")return i.configurable.selectionMode;if(i.superclass)return this.getDefaultGridSelection(i.superclass)}changeSelectionMode(i){const r=this;return r.selectionMode?(w.assign(r.selectionMode,i),r.selectionMode):(r.$defaultGridSelection=r.getDefaultGridSelection(r.constructor),new Proxy(i,{set(l,o,s){const n=w.assign({},l);return l[o]=s,r.updateSelectionMode(l,n),!0}}))}updateSelectionMode(i,r=this.$defaultGridSelection){const l=this,{columns:o,checkboxSelectionColumn:s}=l,n={},{rowReorder:a}=l.features;for(const c in i)i[c]!=r[c]&&(n[c]=i[c]);if(i.rowCheckboxSelection&&!i.checkboxOnly&&(i.checkboxOnly=!0,delete i.rowCheckboxSelection),n.column&&(i.cell=!0,i.multiSelect=!0),n.cell&&(i.checkboxOnly=!1),n.cell===!1&&(i.column=!1),n.checkboxOnly&&(i.checkbox||(i.checkbox=!0),i.cell=!1),n.checkbox===!1&&(n.checkboxOnly=!1,n.showCheckAll=!1),n.showCheckAll&&(i.checkbox=i.checkbox||!0,i.multiSelect=!0),(n.includeChildren||n.includeParents)&&(i.multiSelect=!0),n.multiSelect===!1&&(i.column=i.showCheckAll=i.dragSelect=i.includeChildren=i.includeParents=!1),n.dragSelect&&(a!=null&&a.enabled&&a.gripOnly!==!0&&(a.showGrip=a.gripOnly=!0),i.multiSelect=!0,l._selectionListenersDetachers={}),n.dragSelect===!1&&l._selectionListenersDetachers){var d,u;(d=(u=l._selectionListenersDetachers).selectiondrag)===null||d===void 0||d.call(u),delete l._selectionListenersDetachers.selectiondrag}r&&(n.cell!==void 0||n.deselectFilteredOutRecords!==void 0||n.multiSelect!==void 0)&&l.deselectAll(),n.rowNumber?o.findRecord("type","rownumber")||(o.insert(0,{...typeof i.rowNumber=="object"?i.rowNumber:{},type:"rownumber"}),l._selectionAddedRowNumberColumn=!0):n.rowNumber===!1&&l._selectionAddedRowNumberColumn&&(o.remove(o.findRecord("type","rownumber")),delete l._selectionAddedRowNumberColumn),(i.checkbox!==(r==null?void 0:r.checkbox)||i.checkbox&&i.showCheckAll!==(r==null?void 0:r.showCheckAll))&&(r&&l.deselectAll(),l.isConfiguring?l.shouldInitCheckboxSelection=!0:l.initCheckboxSelection()),r&&i.checkbox&&r.checkbox&&i.checkboxIndex!==r.checkboxIndex&&s&&s.parent.insertChild(s,o.getAt(l.checkboxSelectionColumnInsertIndex)),l.trigger("selectionModeChange",w.clone(i)),l.afterSelectionModeChange(i)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){const i=this,{selectionMode:r,columns:l,checkboxSelectionColumn:o}=i,{checkbox:s}=r;if(o&&(i.checkboxSelectionColumn=null,l.remove(o)),s){var n,a;const d=k.getColumnClass("check"),u=s===!0?null:s;if(!d)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const c=i.checkboxSelectionColumn=new d(w.assign({id:`${i.id}-selection-column`,width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:(n=i.items)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.region,showCheckAll:r.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},u),l,{isSelectionColumn:!0});c.meta.depth=0,c._grid=i;const h=c.renderer;c.renderer=g=>{g.value=i.isSelected(g.record),h.call(c,g)},c.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:i}),l.insert(i.checkboxSelectionColumnInsertIndex,c)}}get checkboxSelectionColumnInsertIndex(){const{columns:i}=this;let{checkboxIndex:r}=this.selectionMode;return r?typeof r=="string"&&(r=i.indexOf(i.getById(r))):r=i.indexOf(i.findRecord("type","rownumber"))+1,r}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(i){return i instanceof Xe?i:new Xe(i)}updateSelectedRecordCollection(i){i.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:i=[],removed:r}){this.selectedRecordCollection._fromSelection||(i=i.filter(l=>this.isSelectable(l)),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:i,deselectedRecords:r}))}changeSelectedRecordCollectionSilent(i){this.selectedRecordCollection._fromSelection=!0;const r=i(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,r}bindStore(i){var r;this.detachListeners("selectionStoreFilter"),i.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),(r=super.bindStore)===null||r===void 0||r.call(this,i)}unbindStore(i){this.detachListeners("selectionStoreFilter"),super.unbindStore(i)}onStoreFilter({source:i}){const r=this,l=[];for(const s of r.selectedRows)i.includes(s)||l.push(s);const o=r.prepareSelection(r.selectionMode.deselectFilteredOutRecords?l:[]);if(r.isCellSelectionMode){const{deselectedCells:s}=r.prepareSelection(r.getSelectedCellsForRecords(l));s!=null&&s.length&&(o.deselectedCells=(o.deselectedCells||[]).concat(s))}(o.deselectedCells.length||o.deselectedRecords.length)&&(r.performSelection(o,!1),r.updateCheckboxHeader())}onStoreRecordIdChange({record:i,oldValue:r}){var l;(l=super.onStoreRecordIdChange)===null||l===void 0||l.call(this,...arguments),this.selectedRecordCollection.get(r)===i&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(i){var r;if((r=super.onStoreRemove)===null||r===void 0||r.call(this,i),!i.isCollapse){const l=this,o=i.records.filter(s=>this.isSelected(s));if(o.length){const s=l.prepareSelection(o);if(l.isCellSelectionMode){const{deselectedCells:n}=l.prepareSelection(l.getSelectedCellsForRecords(o));n!=null&&n.length&&(s.deselectedCells=(s.deselectedCells||[]).concat(n))}l.performSelection(s)}}}onStoreDataChange({action:i,source:r}){var l;const o=this,{selectionMode:s}=o;let n;if((l=super.onStoreDataChange)===null||l===void 0||l.call(this,...arguments),i==="pageLoad")s.preserveSelectionOnPageChange||(n=o.prepareSelection(null,null,!0)),o.updateCheckboxHeader();else if($t[i]){const a=[];if(s.preserveSelectionOnDatasetChange===!1)n=o.prepareSelection(null,null,!0);else{a.push(...o.changeSelectedRecordCollectionSilent(d=>d.match(r.storage)));for(const d of o._selectedCells)r.getById(d.id)||a.push(d);n=o.prepareSelection(a)}}n&&(n.deselectAll||n.deselectedCells.length||n.deselectedRecords.length||n.selectedCells.length||n.selectedRecords.length)&&(o.performSelection(n,!1),o.updateCheckboxHeader())}onStoreRemoveAll(){var i;(i=super.onStoreRemoveAll)===null||i===void 0||i.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:i,record:r}){const l=this,o=!l.selectionMode.multiSelect&&i,s=!o&&!i?[r]:null,n=i?[r]:null;i&&!T.shiftKeyDown&&(l._lastSelectionChecked=r),i&&l._lastSelectionChecked&&T.shiftKeyDown?l.performSelection(l.internalSelectRange(l._lastSelectionChecked,r,!0)):l.performSelection(l.prepareSelection(s,n,o,!0))}updateCheckboxHeader(){const{selectionMode:i,checkboxSelectionColumn:r,store:l}=this;if(i.checkbox&&i.showCheckAll&&r!==null&&r!==void 0&&r.headerCheckbox){const o=l.count&&!l.some(s=>!this.isSelected(s));r.headerCheckbox.checked!==o&&(r.suspendEvents(),r.headerCheckbox.checked=o,r.resumeEvents())}}onCheckAllChange({checked:i}){this[i?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}get selectionDragMouseEventListenerElement(){return globalThis}onSelectionDrag(i){const r=this,{_selectionStartCell:l}=r;if(T.isMouseDown()||r.onSelectionEnd(),!l)return;const{items:o,_lastSelectionDragRegion:s}=r,n=r.getCellDataFromEvent(i,!0),a=n==null?void 0:n.column.region,d=(n==null?void 0:n.cellSelector)&&r.normalizeCellContext(n.cellSelector);if(d&&!d.equals(r._lastSelectionDragCell,!0)){if(r._isSelectionDragging||r.enableScrollingCloseToEdges(o),r._clearSelectionOnSelectionDrag&&!l.equals(d,!0)&&(r.deselectAll(),delete r._clearSelectionOnSelectionDrag),s&&a!==s){var u,c;const g=r.subGrids[s],f=r.subGrids[a],C=g.scrollable,b=f.scrollable,x=o.indexOf(g)-o.indexOf(f)<0;if(b.x=x?0:b.maxX,x?C.x<C.maxX-1:C.x>1)return;(u=r.scrollManager._activeScroll)===null||u===void 0||(c=u.horizontal)===null||c===void 0||c.stopScroll()}r._lastSelectionDragRegion=a,r._lastSelectionDragCell=d,r._isSelectionDragging=!0;const h=r._lastSelectionDragChange=r.internalSelectRange(l,d,r.isRowNumberSelecting(d)||r.isRowNumberSelecting(l));h.deselectedCells=h.deselectedCells.filter(g=>!r.isCellSelected(g)),h.deselectedRecords=h.deselectedRecords.filter(g=>!r.isSelected(g)),r.refreshGridSelectionUI(h),r.trigger("dragSelecting",h)}}onSelectionEnd(){var i,r;const l=this,o=l._lastSelectionDragChange;l._isSelectionDragging&&!l._selectionStartCell.equals(l._lastSelectionDragCell,!0)&&o&&l.performSelection(o,!1),l.disableScrollingCloseToEdges(l.items),l._isSelectionDragging=!1,l._lastSelectionDragChange=l._lastSelectionDragCell=l._lastSelectionDragRegion=null,(i=(r=l._selectionListenersDetachers).selectiondrag)===null||i===void 0||i.call(r),delete l._selectionListenersDetachers.selectiondrag}onHandleElementClick(i){const r=this;r.selectionMode.rowNumber&&i.target.closest(".b-rownumber-header")?(i.handled=!0,r.store.count&&r.store.some(l=>!r.isSelected(l))?r.selectAll():r.deselectAll()):r.selectionMode.column&&i.target.closest(".b-grid-header")&&(i.handled=!0,r.selectColumn(i,i.ctrlKey)),super.onHandleElementClick(i)}selectColumn(i,r=!1){const l=this,{store:o}=l,{columnId:s}=l.getHeaderDataFromEvent(i);l._shiftSelectRange=null,i.shiftKey||(l._shiftSelectColumn=s);const n=i.shiftKey&&l._shiftSelectColumn||s,a=l.internalSelectRange(l.normalizeCellContext({id:o.first.id,columnId:n}),l.normalizeCellContext({id:o.last.id,columnId:s}));r&&!a.selectedCells.some(d=>!l.isCellSelected(d))&&(a.deselectedCells=a.selectedCells,a.selectedCells=[]),r||(a.deselectedCells=l._selectedCells),l.cleanSelectionChange(a),l.performSelection(a)}isSelected(i){var r;return(r=i)!==null&&r!==void 0&&r.id&&(i=i.id),zt[typeof i]?this.selectedRows.some(l=>l.id===i):!1}isCellSelected(i,r){return i=this.normalizeCellContext(i),this.isCellSelectionMode&&this._selectedCells.some(l=>i.equals(l,!0))||r&&this.isSelected(i)}isSelectable(i){return this.normalizeCellContext({id:i.id||i}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(i){this.selectRow({record:i})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(i){this.selectRows(i)}get selectedRows(){return[...this._selectedRows]}set selectedRows(i){this.selectRows(i)}spliceSelectedRecords(i,r,l){const o=this;if(typeof r=="number"){const s=[...o.selectedRecords];s.splice(i,r,...L.asArray(l)),o.performSelection(o.prepareSelection(null,s,!0,!0))}else o.performSelection(o.prepareSelection(r,l,!1,!0))}selectRow(i){(typeof i=="number"||i.isModel||!("record"in i))&&(i={records:[i]}),w.assignIf(i,{scrollIntoView:!0}),this.selectRows(i)}selectRows(i){(!i||Array.isArray(i)||i.isModel||typeof i=="number"||!("records"in i)&&!("record"in i))&&(i={records:L.asArray(i)||[]});const r=this,{store:l}=r,o=[],{records:s=i.record?[i.record]:[],column:n=r.columns.visibleColumns[0],scrollIntoView:a,addToSelection:d=arguments[1]}=i;for(let u of s)u=l.getById(u),u&&o.push(u);d||(r._shiftSelectRange=null),r.performSelection(r.prepareSelection(null,o,!d,!0)),o.length&&a&&r.scrollRowIntoView(o[0].id,{column:n})}selectAll(i=!1){const{store:r}=this,l=(r.isGrouped?r.allRecords:r.records).filter(o=>!o.isSpecialRow);this.performSelection(this.prepareSelection(null,l,!1,!0),!0,i)}deselectAll(i=!1,r=!1){const{store:l}=this,o=i?(l.isGrouped?l.allRecords:l.records).filter(s=>!s.isSpecialRow):null;this.performSelection(this.prepareSelection(o,null,!i),!0,r)}deselectRow(i){this.deselectRows(i)}deselectRows(i){const{store:r}=this,l=L.asArray(i).map(o=>r.getById(o)).filter(o=>o);this.performSelection(this.prepareSelection(l))}selectRange(i,r,l=!1){const o=this,{store:s}=o,n=o.internalSelectRange(s.getById(i),s.getById(r),!0);o._shiftSelectRange=null,o.performSelection(n)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(i){this.selectCells([i])}get selectedCells(){return[...this._selectedCells]}set selectedCells(i){this.selectCells(i)}get selectedCellCSSSelector(){const i=this.selectedCell,r=i&&this.getRowById(i.id);return!i||!r?"":`[data-index=${r.dataIndex}] [data-column-id=${i.columnId}]`}selectCell(i){var r;return"id"in i&&(i={cell:i},i=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},i)),(r=this.selectCells(i))===null||r===void 0?void 0:r[0]}selectCells(i){Array.isArray(i)&&(i={cells:i});const r=this,{cells:l=i.cell?[i.cell]:[],scrollIntoView:o=!0,addToSelection:s=!1,silent:n=!1}=i,a=r.prepareSelection(null,l,!s);return s||(r._shiftSelectRange=null),r.performSelection(a,!0,n),o&&r.scrollRowIntoView(l[0].id,{column:l[0].columnId}),r.isCellSelectionMode?a.selectedCells:a.selectedRecords}deselectCell(i){var r;return(r=this.deselectCells([i]))===null||r===void 0?void 0:r[0]}deselectCells(i){const r=this.prepareSelection(i);return this.performSelection(r),this.isCellSelectionMode?r.deselectedCells:r.deselectedRecords}toggleSelection(i){const r=this,{_focusedCell:l,selectionMode:o}=r,s=r.isRowNumberSelecting(l),n=r.isCellSelected(l,!0);if(o.selectOnKeyboardNavigation===!0||l.isActionable)return!1;r.performSelection(r.prepareSelection(n?l:null,n?null:l,!o.multiSelect,s)),i.preventDefault()}selectCellRange(i,r){this.performSelection(this.internalSelectRange(i,r))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(i){const{deselectedRecords:r,selectedRecords:l,deselectedCells:o,selectedCells:s,deselectedCellRecords:n,selectedCellRecords:a}=i;return r!=null&&r.length&&l!==null&&l!==void 0&&l.length&&(i.deselectedRecords=r.filter(d=>!l.some(u=>d===u))),o!=null&&o.length&&s!==null&&s!==void 0&&s.length&&(i.deselectedCells=o.filter(d=>!s.some(u=>d.equals(u,!0)))),n.length&&(a!=null&&a.length||l!=null&&l.length)&&(i.deselectedCellRecords=n.filter(d=>!a.some(u=>d.id===u.id)&&!l.some(u=>d.id===u.id))),i}getSelectedCellsForRecords(i){return this._selectedCells.filter(r=>r.id&&i.some(l=>l.id===r.id))}delayUntilMouseUp(i){const r=X.on({element:globalThis,blur:l=>i(l,r),mouseup:l=>i(l,r),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return this.selectionMode.cell===!0}isRowNumberSelecting(...i){return this.selectionMode.rowNumber&&!i.some(r=>r.column.type!=="rownumber")}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(i){this._isKeyboardRangeSelecting=!0,this["navigate"+i](),this._isKeyboardRangeSelecting=!1}onCellNavigate(i,r,l,o){var s;const{selectionMode:n,_selectionListenersDetachers:a}=i,{multiSelect:d,deselectOnClick:u,dragSelect:c}=n,{ctrlKeyDown:h,shiftKeyDown:g}=T,f=T.isMouseDown(),C=T.isMouseDown(2),b=T.currentMouseDown||T.currentKeyDown;if(l=i.normalizeCellContext(l),!o||l.rowIndex===-1||(s=l.record)!==null&&s!==void 0&&s.isGroupHeader||b!=null&&b.fromKeyMap&&!n.selectOnKeyboardNavigation||i.columns.getById(l.columnId)===i.checkboxSelectionColumn||n.checkboxOnly||(b==null?void 0:b.handled)===!0)return;g||(i._isAddingToSelection=h&&d,i._selectionStartCell=l),d&&c&&f&&!a.selectiondrag&&!i.preventDragSelect&&(a.selectiondrag=X.on({name:"selectiondrag",element:i.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:globalThis},mousemove:"onSelectionDrag",thisObj:i})),i.preventDragSelect=!1;const x=i._selectionStartCell,S=i._isAddingToSelection;if((g&&f||i._isKeyboardRangeSelecting)&&x&&d)i.performSelection(i.internalSelectRange(x,l,i.isRowNumberSelecting(x,l)));else{let E=!1,v=!0,R;if(i.isCellSelected(l,!0)){if(C)return;if(S||u)R=u?null:[l],v=!1;else if(i.selectedRecords.length+(i.isCellSelectionMode?i._selectedCells.length:0)<=1)return;E=u||d}!R&&!S&&(R=null,c&&E&&a.selectiondrag&&(i._clearSelectionOnSelectionDrag=!0));const F=(M,P)=>{var z;if(P==null||P(),(M==null||(z=M.target)===null||z===void 0?void 0:z.nodeType)===Node.ELEMENT_NODE){const N=new y(M.target);if(N!=null&&N.grid&&!N.equals(l,!0))return}g||(i._shiftSelectRange=null),i.performSelection(i.prepareSelection(R,v&&[l],R===null,v&&i.isRowNumberSelecting(l)))};E?i.delayUntilMouseUp(F):F()}}prepareSelection(i,r,l=!1,o=!1){const s=this,n=s._isSelectionDragging,{includeParents:a,selectRecordOnCell:d}=s.selectionMode,u=[],c=[];let h=[],g=[],f=[],C=[];if(l)h=s._selectedCells,g=s._selectedRows,C=s.selectedRecords.filter(S=>!g.some(E=>E.id===S.id));else if(i)for(const S of L.asArray(i)){const E=s.normalizeCellContext(S),v=(E==null?void 0:E.record)||(S.isModel?S:s.store.getById(E.id));if(!E.isSpecialRow&&(h.push(E),v&&!g.some(R=>R.id===v.id))){var b;if(n||s.isSelected(v)?g.push(v):d&&s.selectedRecordCollection.get(v.id)&&!C.some(R=>R.id===v.id)&&C.push(v),s.selectionMode.includeChildren&&s.selectionMode.multiSelect&&!v.isLeaf&&(b=v.allChildren)!==null&&b!==void 0&&b.length)for(const R of v.allChildren)!g.some(F=>F.id===R.id)&&(n||s.isSelected(R))&&g.push(R)}}if(r){for(const S of L.asArray(r)){const E=s.normalizeCellContext(S),v=(E==null?void 0:E.record)||(S.isModel?S:s.store.getById(E.id));if(!(!v||E.isSpecialRow)&&(s.isCellSelectionMode&&!o&&c.push(E),(s.isRowSelectionMode||o)&&!u.some(R=>R.id===v.id))){var x;if(u.push(v),s.selectionMode.includeChildren&&s.selectionMode.multiSelect&&!v.isLeaf&&(x=v.allChildren)!==null&&x!==void 0&&x.length)for(const R of v.allChildren)u.some(F=>F.id===R.id)||u.push(R)}}d&&c.length&&(f=L.unique(c.map(S=>S.record)).filter(S=>!u.some(E=>E.id===S.id)))}if(a&&(g.length||u.length)){const S=[...g,...u];L.unique(S.filter(v=>v.parent&&!v.allChildren.some(R=>S.includes(R))).map(v=>v.parent)).forEach(v=>s.toggleParentSelection(v,u,g))}return s.cleanSelectionChange({selectedCells:c,selectedRecords:u,deselectedCells:h,deselectedRecords:g,deselectAll:l,action:u!=null&&u.length||c!=null&&c.length?"select":"deselect",selectedCellRecords:f,deselectedCellRecords:C})}toggleParentSelection(i,r,l){if(!i||i.isRoot)return;const o=this.isSelected(i),s=r.includes(i),n=l.includes(i),a=d=>this.isSelected(d)&&!l.includes(d)||r.includes(d);this.selectionMode.includeParents==="some"?i.allChildren.some(a)?(!o||n)&&!s&&r.push(i):o&&!n&&l.push(i):o?!n&&!s&&i.allChildren.some(d=>l.includes(d))&&l.push(i):s||i.allChildren.every(a)&&r.push(i),i.parent&&this.toggleParentSelection(i.parent,r,l)}internalSelectRange(i,r,l=!1){const o=this,s=o.isRowSelectionMode||l,n=o.prepareSelection(o._shiftSelectRange,o.getRange(i,r,s),!1,l);return o._shiftSelectRange=n[`selected${s?"Records":"Cells"}`],n}getRange(i,r,l=!1){const o=this,{store:s}=o,n=o.normalizeCellContext(i),a=o.normalizeCellContext(r),d=Math.min(n.rowIndex,a.rowIndex),u=Math.max(n.rowIndex,a.rowIndex),c=[],h=Math.min(n.columnIndex,a.columnIndex),g=Math.max(n.columnIndex,a.columnIndex);if(d===-1||u===-1)throw new Error("Record not found in selectRange");if(l){const f=s.getRange(d,u+1,!1);a.rowIndex<n.rowIndex&&f.reverse(),c.push(...f)}else for(let f=d;f<=u;f++)for(let C=h;C<=g;C++)c.push({rowIndex:f,columnIndex:C});return c.map(f=>o.normalizeCellContext(f))}performSelection(i,r=!0,l=!1){const o=this,{selectedRecords:s=[],selectedCells:n=[],selectedCellRecords:a=[],deselectedRecords:d=[],deselectedCells:u=[],deselectedCellRecords:c=[],action:h}=i,g=[...s,...a],f=[...d,...c],C=o.isRowSelectionMode;if(o.trigger("beforeSelectionChange",{mode:C?"row":"cell",action:h,selected:g,deselected:f,selection:o.selectedRecords,selectedCells:n,deselectedCells:u,cellSelection:o.selectedCells})!==!1){if(o._selectedCells===u)o._selectedCells=[];else{const b=[];for(const x of o._selectedCells)u.some(S=>x.equals(S,!0))||b.push(x);o._selectedCells=b}if(i.deselectedRecords=[...i.deselectedRecords],d===o._selectedRows)o.changeSelectedRecordCollectionSilent(b=>b.clear()),o._selectedRows.length=0;else{const b=[],x=[];for(const S of o.selectedRecords)f.some(E=>S.id===E.id)||(o.isSelected(S)?b.push(S):x.push(S));o.changeSelectedRecordCollectionSilent(S=>S.values=[...b,...x]),o._selectedRows=b}if(n.length)for(const b of n)o._selectedCells.some(x=>x.equals(b,!0))||o._selectedCells.push(b);s.length&&(o.changeSelectedRecordCollectionSilent(b=>b.add(...s)),o._selectedRows.push(...s.filter(b=>!o._selectedRows.some(x=>x.id===b.id)))),a.length&&o.changeSelectedRecordCollectionSilent(b=>b.add(...a)),r&&o.refreshGridSelectionUI(i),o.afterSelectionChange(i),l||o.triggerSelectionChangeEvent(i)}}refreshGridSelectionUI({selectedRecords:i,selectedCells:r,deselectedRecords:l,deselectedCells:o}){const s=this,{checkboxSelectionColumn:n}=s;n==null||n.suspendEvents(),s.updateGridSelectionRecords(i,!0),s.updateGridSelectionRecords(l,!1),s.updateCheckboxHeader(),n==null||n.resumeEvents(),s.isCellSelectionMode&&(s.updateGridSelectionCells(r,!0),s.selectionMode.column&&s.updateGridSelectionColumns(r)),s.updateGridSelectionCells(o,!1)}updateGridSelectionRecords(i,r){const{checkboxSelectionColumn:l}=this;if(i!=null&&i.length)for(let o=0;o<i.length;o++){const s=this.getRowFor(i[o]);s&&(s.toggleCls("b-selected",r),s.setAttribute("aria-selected",r),l&&!l.hidden&&!i[o].isSpecialRow&&(s.getCell(l.id).widget.checked=r))}}updateGridSelectionCells(i,r){if(i!=null&&i.length)for(let l=0;l<i.length;l++){const o=this.getCell(i[l]);o&&(o.setAttribute("aria-selected",r),o.classList.toggle("b-selected",r))}}updateGridSelectionColumns(i){const{count:r}=this.store;for(const o of this.columns.visibleColumns){var l;(l=o.element)===null||l===void 0||l.classList.toggle("b-selected",(i==null?void 0:i.filter(s=>s.columnId===o.id).length)===r)}}triggerSelectionChangeEvent(i){const{selectedRecords:r=[],selectedCells:l=[],selectedCellRecords:o=[],deselectedRecords:s=[],deselectedCells:n=[],deselectedCellRecords:a=[]}=i,d=[...r,...o],u=[...s,...a],c=this.isRowSelectionMode;this.trigger("selectionChange",{mode:c?"row":"cell",action:i.action,selected:d,deselected:u,selection:this.selectedRecords,selectedCells:l,deselectedCells:n,cellSelection:this.selectedCells})}doDestroy(){var i;(i=this.selectedRecordCollection)===null||i===void 0||i.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const r in this._selectionListenersDetachers)this._selectionListenersDetachers[r]();super.doDestroy()}get widgetClass(){}},I(e,"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{}}),e};const Vt=m=>m.columns.suspendEvents(),jt=m=>m.columns.resumeEvents(),Kt=m=>{m.columns.clearCaches(),m.columns.fillFromMaster()},Ge=(m,e)=>m.stateSortIndex-e.stateSortIndex;var nt=m=>class extends(m||j){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScroll","stateChange"]}}updateStore(t,i){var r;(r=super.updateStore)===null||r===void 0||r.call(this,t,i),this.detachListeners("stateStoreListeners"),t==null||t.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(t,i){var r;(r=super.updateColumns)===null||r===void 0||r.call(this,t,i),this.detachListeners("stateColumnListeners"),t.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(t,i){var r;(r=super.updateRowManager)===null||r===void 0||r.call(this,t,i),this.detachListeners("stateRowManagerListeners"),t.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const t=this,i=t.element.style.cssText,r={rowHeight:t.rowHeight};if(i&&(r.style=i),t.selectedCell){const{id:l,columnId:o}=t.selectedCell;r.selectedCell={id:l,columnId:o}}return r.selectedRecords=t.selectedRecords.map(l=>l.id),r.columns=t.columns.allRecords.map(l=>l.getState()),r.store=t.store.state,r.scroll=t.storeScroll(),r.subGrids={},t.eachSubGrid(l=>{var s;const o=r.subGrids[l.region]=r.subGrids[l.region]||{};l.isPainted?l.flex==null&&(o.width=l.width):l.config.width!=null?o.width=l.config.width:o.flex=l.config.flex,o.collapsed=(s=l.collapsed)!=null?s:!1,o.collapsed&&(o._beforeCollapseState=l._beforeCollapseState)}),r}applyState(t){const i=this;if(i.suspendRefresh(),"columns"in t){let r=!1,l=!1;i.columns.suspendEvents(),i.eachSubGrid(Vt),t.columns.forEach((o,s)=>{const n=i.columns.getById(o.id);if(n){const a=n.generation;"region"in o&&!(o.region in i.subGrids)&&(delete o.region,delete o.locked),n.applyState(o),r=r||n.generation!==a,n.stateSortIndex=s,n.allIndex!==s&&(l=r=!0)}}),r&&i.eachSubGrid(Kt),l&&(i.eachSubGrid(o=>{o.columns.records.sort(Ge),o.columns.allRecords.sort(Ge)}),i.columns.sort({fn:Ge,ascending:!0})),i.isPainted&&r&&i.renderContents(),i.columns.resumeEvents(),i.eachSubGrid(jt)}"subGrids"in t&&i.eachSubGrid(r=>{if(r.region in t.subGrids){const l=t.subGrids[r.region];"width"in l?r.width=l.width:"flex"in l&&(r.flex=l.flex),"collapsed"in l&&(r.collapsed=l.collapsed,r._beforeCollapseState=l._beforeCollapseState)}r.clearWidthCache()}),"rowHeight"in t&&(i.rowHeight=t.rowHeight),"style"in t&&(i.style=t.style),"selectedCell"in t&&(i.selectedCell=t.selectedCell),"store"in t&&(i.store.state=t.store),"selectedRecords"in t&&(i.selectedRecords=t.selectedRecords),i.resumeRefresh(!0),i.whenVisible(()=>i.applyScrollState(t))}applyScrollState(t){const i=this;i.eachSubGrid(r=>r.refreshFakeScroll()),"scroll"in t&&(i.restoreScroll(t.scroll),t.scroll.scrollTop&&i.element.querySelectorAll(".b-resize-monitored").forEach(r=>{const l=ge.fromElement(r);l&&l.onElementResize(r)}))}get widgetClass(){}};const Ne=Promise.resolve(),qt={block:"nearest"};class We extends De{updateYScroller(e){e==null||e.addScroller(this)}scrollIntoView(e,t=qt){const i=this,{xDelta:r,yDelta:l}=i.getDeltaTo(e,t),o=r||l?i.scrollBy(r,l,t):Ne;return(t.highlight||t.focus)&&o.then(()=>{t.highlight&&(e instanceof D?e.translate(-r,-l).highlight():p.highlight(e)),t.focus&&e.focus&&e.focus()}),o}scrollBy(e,t,i){const r=t&&this.yScroller.scrollBy(0,t,i),l=e&&super.scrollBy(e,0,i);if(l&&l.cancel&&r&&r.cancel){const o=l.cancel,s=r.cancel;return l.cancel=r.cancel=()=>{o(),s()},Promise.all([l,r])}return l||r||Ne}scrollTo(e,t,i){const r=t!=null&&this.yScroller.scrollTo(null,t,i),l=e!=null&&super.scrollTo(e,null,i);if(i&&i.animate||this.syncPartners(),l&&l.cancel&&r&&r.cancel){const o=l.cancel,s=r.cancel;return l.cancel=r.cancel=()=>{o(),s()},Promise.all([l,r])}return l||r||Ne}get viewport(){const e=D.from(this.element);return e.intersect(D.from(this.yScroller.element))||new D(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}I(We,"configurable",{propagate:!1,overflowX:"hidden-scroll",yScroller:null}),We._$name="SubGridScroller";const Ut=(m,e)=>m+e.getBoundingClientRect().width;class te extends J{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:We,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(e){const t=this;if(super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),O.isFirefox){const{element:i}=t,r=t.grid.scrollable;let l=0;i.addEventListener("wheel",({ctrlKey:o,deltaY:s,deltaX:n})=>{const a=Math.abs(s)>Math.abs(n);!o&&a&&!t.scrollEndDetacher&&r.y!==l&&(i.style.pointerEvents="none",l=r.y,t.scrollEndDetacher=r.ion({scrollEnd:async()=>{l=r.y,i.style.pointerEvents="",t.scrollEndDetacher=null},once:!0}))})}K.isTestEnv&&(t.hideOverlayScroller.delay=50)}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),(e=t.fakeScroller)===null||e===void 0||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach(i=>i.remove()),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:i}=e.element.style,r={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return i?r.flex=i:t&&(r.width=t),r}changeHeader(e){return new this.headerClass(w.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(w.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,t=!0){this.splitterElements.forEach(i=>i==null?void 0:i.classList[t?"add":"remove"](e))}hideSplitter(){this.splitterElements.forEach(e=>e.classList.add("b-hide-display")),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach(e=>e.classList.remove("b-hide-display")),this.$showingSplitter=!0}changeElement(e,t){const{region:i}=this;return super.changeElement({"aria-label":i,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${i}`]:i,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:i}},t)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map((t,i)=>({role:"gridcell","aria-colindex":i+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}}))}}changeVirtualScrollerElement(){const e=p.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=p.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[O.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[O.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[O.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[O.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return p.createElement(this.splitterConfig)}changeScrollerSplitter(){return p.createElement(this.splitterConfig)}changeFooterSplitter(){return p.createElement(this.splitterConfig)}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach(i=>X.on({element:i,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t})),t._collapsed&&t.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;(e=this.footer)===null||e===void 0||e.refreshContent()}eachWidget(e,t=!0){const i=this,r=[i.header,i.footer];for(let l=0;l<r.length;l++){const o=r[l];if(e(o)===!1)return;t&&o.eachWidget&&o.eachWidget(e,t)}}fixCellWidths(e){const{visibleColumns:t}=this.columns;let i=e.firstElementChild,r=0;for(;i;){const l=t[r],{element:o}=l;l.minWidth&&(i.style.minWidth=p.setLength(l.minWidth)),l.maxWidth&&(i.style.maxWidth=p.setLength(l.maxWidth)),l.flex?l.childLevel&&o?(i.style.flex=`0 0 ${o.getBoundingClientRect().width}px`,i.style.width=""):(i.style.flex=l.flex,i.style.width=""):l.width?i.style.width=p.setLength(l.width):i.style.flex=i.style.width=i.style.minWidth="",i=i.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:i,footer:r}=e;if(!e.collapsed){if(e.flex)i.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some(o=>!o.hidden&&o.flex)&&e.totalFixedWidth!==e.width){e.width=e.totalFixedWidth,e.hasCalculatedWidth=!0;return}let l=e.width;if(!l&&e.hasCalculatedWidth){l=0;for(const o of e.columns)!o.flex&&!o.hidden&&(l+=o.width)}t.style.width=`${l}px`,i.width=l,r&&(r.width=l)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(O.isSafari){const e=this,{region:t,header:i}=e,r=i.calculateMinWidthForSafari();e.rowManager.forEach(l=>{const o=l.getElement(t);o&&(o.style.width=`${r}px`)}),i.headersElement.style.width=`${r}px`}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,i,r,l){const o=this,{grid:s}=o;super.onInternalResize(...arguments),s!=null&&s.isPainted&&(o.syncSplitterButtonPosition(),t!==r&&(s.trigger("horizontalScroll",{grid:s,subGrid:o,scrollLeft:o.scrollable.element.scrollLeft,scrollX:o.scrollable.x}),o.fakeScroller&&o.refreshFakeScroll(),s.syncFlexedSubCols(),o.fixRowWidthsInSafariEdge()),i!==l&&s.onHeightChange(),o.trigger("afterInternalResize",o))}syncParallelSplitters(e){const t=this,{grid:i}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const r=i.getSubGrid(i.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:t}=e;!e.collapsed&&(!t||!t.collapsed)&&e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),!e.collapsed&&(!t||!t.collapsed)&&e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new D(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach(t=>p.toggleClasses(t,["b-disabled"],!e))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach(e=>{e.resizeToFitContent(null,null,!0)}),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&this.scrollable.hasOverflow("x")}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:i,virtualScrollerWidth:r,header:l,footer:o,scrollable:s}=e,n=[...l.contentElement.children].reduce(Ut,0);s.scrollWidth=n,i.style.width=t.style.width,i.style.flex=t.style.flex,i.style.minWidth=t.style.minWidth,i.style.maxWidth=t.style.maxWidth,l.scrollable.syncOverflowState(),o.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(r.style.width=`${s.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:i}=e;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),O.isFirefox&&t.element.addEventListener("wheel",r=>{r.deltaX&&(t.x+=r.deltaX,r.preventDefault())}),e.fakeScroller=new De({element:i,overflowX:!0,widget:e}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),t.addPartner(e.header.scrollable,"x"),t.addPartner(e.footer.scrollable,"x"),e.refreshFakeScroll()}onSubGridScrollEnd(){const e=this;e.forceScrollUpdate||e.syncScrollingPartners(),e.scrolling=!1,p.scrollBarWidth||(e.grid.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller())}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:i}=t;!t.scrolling&&e&&(t.scrolling=!0,p.scrollBarWidth||(i.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),i.trigger("horizontalScroll",{subGrid:t,grid:i,scrollLeft:t.scrollable.element.scrollLeft,scrollX:t.scrollable.x})}scrollColumnIntoView(e,t){const{columns:i,header:r}=this,l=r.scrollable;if(e=e instanceof H?e:i.get(e)||i.getById(e)||i.getAt(e),e){const o=r.getHeader(e.id);if(o)return l.scrollIntoView(D.from(o,null,!0),t)}}onAddRow({rows:e,isExport:t}){const i=this,r=i.rowElementConfig,l=document.createDocumentFragment();e.forEach(o=>{const s=p.createElement(r);l.appendChild(s),o.addElement(i.region,s),i.fixCellWidths(s)}),t||(i.fixRowWidthsInSafariEdge(),i.element.insertBefore(l,i.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=p.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return(e=this.grid)===null||e===void 0?void 0:e.rowManager}toggleTransitionClasses(e=!1){const t=this,i=t.grid,r=i.getSubGrid(i.getNextRegion(t.region)),l=i.resolveSplitter(r);r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),l.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,{grid:t,element:i}=e,r=t.getSubGrid(t.getNextRegion(e.region)),l=e.splitterElement?e:e.previousSibling;let{_beforeCollapseState:o}=e,s=0;if(!(t.rendered&&e._collapsed===!0))return t.eachSubGrid(n=>{n!==e&&!n._collapsed&&++s}),s===0&&await r.expand(),new Promise(n=>{if(o)n();else{o=e._beforeCollapseState={};let a=!1;e.width&&(a=!0,e.ion({afterinternalresize:()=>{n(e)},thisObj:e,once:!0})),o.width=e.width,o.elementWidth=i.style.width,r.element.style.flex===""&&(o.nextRegionWidth=r.width,r.width="",r.flex="1"),i.style.flex!==""&&(o.flex=i.style.flex,e.header.element.style.flex=i.style.flex=""),i.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e._collapsed=!0,e.width="",a||(e.syncParallelSplitters(!0),n(!1))}t.trigger("subGridCollapse",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!0})}).then(n=>{if(!e.isDestroyed&&n!==!1){var a;t.refreshVirtualScrollbars(),e.syncParallelSplitters(!0),(a=l.startSplitterButtonSyncing)===null||a===void 0||a.call(l)}})}async expand(){const e=this,{grid:t,_beforeCollapseState:i}=e,r=t.getSubGrid(t.getNextRegion(e.region)),l=e.splitterElement?e:e.previousSibling;if(!(t.rendered&&e._collapsed!==!0))return new Promise(o=>{if(i!=null){let s=!1;e.width!==i.elementWidth&&(s=!0,e.ion({afterinternalresize(){e.setTimeout(()=>o(e),10)},thisObj:e,once:!0})),i.nextRegionWidth&&(r.width=i.nextRegionWidth,r.flex=null),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),i.flex?(e.width=i.width,e.header.flex=e.flex=i.flex,e.footer.flex=i.flex,e._width=null):e.width=i.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,s?(l.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1)):o(!1),delete e._beforeCollapseState}else o();t.trigger("subGridExpand",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!1})})}hide(){var e,t;return(e=this.header)===null||e===void 0||e.hide(),(t=this.footer)===null||t===void 0||t.hide(),this.hideSplitter(),super.hide()}show(){var e,t;return(e=this.header)===null||e===void 0||e.show(),(t=this.footer)===null||t===void 0||t.show(),this.showSplitter(),super.show()}}I(te,"delayable",{hideOverlayScroller:1e3}),te.initClass(),te._$name="SubGrid";var at=m=>class extends(m||j){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(t){const i=this,r=new Set;for(const l of i.columns){const{region:o}=l;o&&(t[o]||(t[o]={}),r.add(o))}t.normal&&w.isEmpty(t.normal)&&(t.normal=Fe.defaultConfig.subGridConfigs.normal);for(const l of r)i.createSubGrid(l,t[l]);return i.items=i.subGrids,t}createSubGrid(t,i=null){const r=this,l=r.columns.makeChained(a=>a.region===t,["region"]),o=w.assign({type:"subgrid",id:`${r.id}-${t}Subgrid`,parent:r,grid:r,region:t,headerClass:r.headerClass,footerClass:r.footerClass,columns:l,weight:t,scrollable:{yScroller:r.scrollable}},i||r.subGridConfigs[t]);let s=!1;!o.flex&&!o.width&&(o.width=l.totalFixedWidth,s=!0);const n=r.subGrids[t]=te.create(o);return n.hasCalculatedWidth=s,t===r.regions[0]&&(n.isFirstRegion=!0),n}onChildAdd(t){if(t.isSubGrid){const i=this,{items:r,headerContainer:l,virtualScrollers:o,footerContainer:s}=i,n=r.indexOf(t)*2;i.hideHeaders||(p.insertAt(l,t.headerSplitter,n),p.insertAt(l,t.header.element,n)),p.insertAt(o,t.scrollerSplitter,n),p.insertAt(o,t.virtualScrollerElement,n),p.insertAt(s,t.footerSplitter,n),p.insertAt(s,t.footer.element,n),r.forEach((a,d)=>{d<r.length-1&&a.showSplitter()}),n===0&&i.emptyTextEl&&t.element.appendChild(i.emptyTextEl)}return super.onChildAdd(t)}onChildRemove(t){if(super.onChildRemove(t),t.isSubGrid){const{items:i}=this;delete this.subGrids[t.region],L.remove(this.regions,t.region),t.destroy(),i.length&&i[i.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid(t=>t.destroy()),super.doDestroy()}eachSubGrid(t,i=null){this.items.forEach((r,l)=>{r.isSubGrid&&t.call(i||r,r,l++)})}callEachSubGrid(t,...i){let r=null;return this.items.forEach((l,o)=>{if(l.isSubGrid&&l[t]){const s=l[t](...i);o===0&&(r=s)}}),r}get regions(){return this.items.map(t=>t.region)}getLastRegions(){const t=this.regions.slice(-2);return t.length===2?t:[t[0],t[0]]}getNextRegion(t){const i=this.regions;return i[i.indexOf(t)+1]||i[i.length-2]}getPreviousRegion(t){return this.regions[this.regions.indexOf(t)-1]}getSubGrid(t){return this.subGrids[t]}getSubGridFromColumn(t){return t=t instanceof H?t:this.columns.getById(t)||this.columns.get(t),this.getSubGrid(t.region)}resolveSplitter(t){const i=this.getLastRegions();let r=t instanceof te?t.region:t;return i[1]===r&&(r=i[0]),this.subGrids[r].splitterElement}get widgetClass(){}};const Xt=new String,Yt={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:m=>`Move before "${m}"`,moveAfter:m=>`Move after "${m}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Column:{columnLabel:m=>`${m.text?`${m.text} column. `:""}SPACE for context menu${m.sortable?", ENTER to sort":""}`,cellLabel:Xt},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:m=>{var e;return`${m.text?m.text:""} ${(e=m.location)!==null&&e!==void 0&&e.record?`rating : ${m.location.record[m.field]||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:m=>`Move column to ${m}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:m,totalPages:e})=>`Exporting page ${m}/${e}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:m,totalPages:e})=>`Exporting page ${m}/${e}`},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"}};bt.publishLocale(Yt);const dt=new Promise(m=>m()),ze="GridBase:store",Jt={block:"nearest",inline:"nearest"},Qt={dataset:1,pageLoad:1,filter:1};class Fe extends Ct.mixin(vt,wt,rt,lt,Wt,ot,st,nt,at,St){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideFooters:!0,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store"}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,hideHeaders:null,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:ee,footerClass:xe,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:tt,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const t=this,{initScroll:i}=t;t.initScroll=()=>!t.scrollInitialized&&i.call(t),K.isTestEnv&&(t.bufferedAfterColumnsResized.delay=50,t.bufferedElementResize.delay=50),super.finishConfigure(e),Ye.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),Ye.ion({locale:"onLocaleChange",prio:-1,thisObj:t}),T.ion({theme:"onThemeChange",thisObj:t}),t.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",t.fixElementHeightsBuffer,t),t.setGridClassList(t.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return t==null||t.destroy(),e?Ke.new({element:this.element,owner:this},e):null}doDestroy(){var e;const t=this;t.detachListeners(ze),(e=t.scrollManager)===null||e===void 0||e.destroy();for(const r of Object.values(t.features)){var i;(i=r.destroy)===null||i===void 0||i.call(r)}t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach(i=>{if(i.disabled)return;let r;Object.prototype.hasOwnProperty.call(i.constructor,"featureClass")?r=i.constructor.featureClass:r=`b-${i instanceof j?i.$$name:i.constructor.name}`,r&&e.add(r.toLowerCase())})}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:i,fillLastColumn:r,positionMode:l,showDirty:o}=this;return{class:{[`b-grid-${l}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!i,"b-autoheight":e,"b-fill-last-column":r,"b-show-dirty":o}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:t,hideHeaders:i}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":i}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:O.isFirefox&&p.scrollBarWidth?{height:`${p.scrollBarWidth}px`}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideFooters(e){var t;(t=this.footerContainer)===null||t===void 0||t.classList[e?"add":"remove"]("b-hidden")}changeColumns(e,t){const i=this;if(!e&&t)return i.isDestroying?t.owner===i&&t.destroy():t.removeAll(),t;if(e.isStore)return(t==null?void 0:t.owner)===i&&t.destroy(),e.grid=i,e;if(Array.isArray(e)){if(t){const r=t.allRecords.slice();t.data=e;for(const l of r)t.includes(l)||l.destroy();return t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return k.new({grid:i,owner:i},e)}updateColumns(e,t){var i,r;const l=this;(i=super.updateColumns)===null||i===void 0||i.call(this,e,t),e.ion({refresh:l.onColumnsChanged,change:l.onColumnsChanged,sort:l.onColumnsChanged,thisObj:l}),e.ion(Dt(l.onColumnsResized,l)),O.isTouchDevice&&(l.touch=!0,e.forEach(o=>{const{touchConfig:s}=o;s&&o.applyState(s)})),(r=l.bodyElement)===null||r===void 0||r.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:t,changes:i,record:r,records:l,isMove:o}){const s=this,{columns:n,checkboxSelectionColumn:a}=s,d=i&&Object.keys(i).length===1;if(e==="refresh"&&t!=="batch"||t==="update"&&d&&"parentIndex"in i||t==="sort"&&n.isSyncingDataOnLoad)return;const u=t==="add"&&l.some(h=>h.region&&!s.subGrids[h.region]);if(!(s.isConfiguring||!u&&(!s.isPainted||o&&t==="remove"))){if(t==="add")for(const h of l){const{region:g}=h;if(!s.subGrids[g]){var c;s.add(s.createSubGrid(g,(c=s.subGridConfigs)===null||c===void 0?void 0:c[g]))}}if(t==="update"){if(("width"in i||"minWidth"in i||"maxWidth"in i||"flex"in i)&&!("region"in i)){const{region:h}=r;n.visibleColumns.forEach(g=>{g.region===h&&g.repaintOnResize&&s.refreshColumn(g)}),s.afterColumnsChange({action:t,changes:i,column:r});return}if("text"in i&&d){r.subGrid.refreshHeader();return}if("hidden"in i){const h=s.getSubGridFromColumn(r.id);h.header.fixHeaderWidths(),h.footer.fixFooterWidths(),h.updateHasFlex()}}if(t==="dataset"||t==="batch"||t==="update"&&"region"in i){const h=n.getDistinctValues("region",!0),{toRemove:g,toAdd:f}=L.delta(h,s.regions,!0);s.remove(g.map(C=>s.getSubGrid(C))),s.add(f.map(C=>s.createSubGrid(C,s.subGridConfigs[C])))}if(a&&!n.includes(a)){const h=n.indexOf(n.findRecord("type","rownumber"))+1;n.insert(h,a,!0)}s._suspendRenderContentsOnColumnsChanged||s.renderContents(),s.syncFlexedSubCols(),s.bodyElement.setAttribute("aria-colcount",n.visibleColumns.length),s.afterColumnsChange({action:t,changes:i,column:r,columns:l})}}onColumnsResized({changes:e,record:t}){var n;const i=this;if(i.isConfiguring)return;const r=p.setLength(t.width),l=p.setLength(t.minWidth),o=p.setLength(t.maxWidth),s=i.getSubGridFromColumn(t.id);if(s.header.fixHeaderWidths(),s.footer.fixFooterWidths(),s.updateHasFlex(),!(t.flex&&t.childLevel)){(!i.cellEls||t!==i.lastColumnResized)&&(i.cellEls=p.children(i.element,`.b-grid-cell[data-column-id="${t.id}"]`),i.lastColumnResized=t);for(const a of i.cellEls)"width"in e&&(a.style.width=r),"minWidth"in e&&(a.style.minWidth=l),"maxWidth"in e&&(a.style.maxWidth=o),"flex"in e&&(a.style.flex=(n=t.flex)!=null?n:null)}i.resizingColumns||i.afterColumnsResized(t),i.syncFlexedSubCols()}afterColumnsResized(e){const t=this;t.eachSubGrid(i=>{!i.collapsed&&(!e||e.region===i.region)&&(i.fixWidths(),i.fixRowWidthsInSafariEdge())}),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(e),t.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query(t=>t.flex&&t.childLevel&&t.element);if(e)for(const t of e){const i=t.element.getBoundingClientRect().width,r=p.children(this.element,`.b-grid-cell[data-column-id="${t.id}"]`);for(const l of r)l.style.flex=`0 0 ${i}px`}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid(t=>{!t.collapsed&&(!e||e.region===t.region)&&t.refreshFakeScroll()})}bufferedElementResize(){this.refreshRows()}onInternalResize(e,t,i,r,l){p.scrollBarWidth&&t<r&&this.eachSubGrid(o=>{o.flex&&o.onElementResize(o.element)}),super.onInternalResize(...arguments),this.isPainted&&t!==r&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,t){const i=this;if(i._isRowMeasured||i.measureRowHeight(),t==null||t.destroy(),e){const r=Re.new({grid:i,rowHeight:i.rowHeight,rowScrollMode:i.rowScrollMode||"move",autoHeight:i.autoHeight,fixedRowHeight:i.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:i}},e);return i.relayEvents(r,["beforeRenderRow","renderRow"]),i._rowManager=null,r}}getRowHeight(e){return e.rowHeight}processRowHeight(e,t){}bindStore(e){const t=this.asyncEventSuffix;e.ion({name:ze,[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",[`move${t}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",loadSync:"onStoreLoadSync",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(ze),this.destroyStore&&e.destroy()}changeStore(e){if(e==null)return null;if(typeof e=="string"&&(e=Me.getStore(e)),!e.isStore){var t;e=w.assign({data:this.data,tree:!!(!((t=this.initialConfig.features)===null||t===void 0)&&t.tree)},e),e.data||delete e.data,e.modelClass||(e.modelClass=Qe),e=new(e.readUrl?yt:Me)(e)}return e}updateStore(e,t){var i;const r=this;if((i=super.updateStore)===null||i===void 0||i.call(this,e,t),t&&r.unbindStore(t),e&&(t&&r.deselectAll(),r.bindStore(e)),r.trigger("bindStore",{store:e,oldStore:t}),!r.isDestroying&&r.isPainted&&!r.refreshSuspended){var l;(l=r._rowManager)===null||l===void 0||l.reinitialize()}}onStoreLoadSync(){this.rowManager.renderFromRow(this.topRow)}onStoreUpdateRecord({source:e,record:t,changes:i}){const r=this;if(!(r.refreshSuspended||e.isSyncingDataOnLoad))if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let l;if(t.isFieldModified("id")&&(l=r.getRowFor(t.meta.modified.id)),l=l||r.getRowFor(t),!l)return;if(r.fullRowRefresh||t.isSpecialRow){const o=e.indexOf(t);o!==-1&&l.render(o,t)}else r.columns.visibleColumns.forEach(o=>{const s=o.field;if(!(o.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(o.data,"renderer"))||i[s]){const a=l.getCell(s);a&&l.renderCell(a)}})}}refreshFromRowOnStoreAdd(e,t){const i=this,{rowManager:r}=i;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),i.store.count===1&&i.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:i,oldIndex:r,isChild:l,oldParent:o,parent:s,isMove:n,isExpandAll:a}){var d;const u=this,{rowManager:c}=u;if(!u.isPainted||a||u.refreshSuspended||e.isSyncingDataOnLoad||(d=e.project)!==null&&d!==void 0&&d.applyingChangeset)return;const h=n&&t.some(v=>{if(n[v.id]){const R=e.getById(v.meta.modified.parentId);return(R==null?void 0:R.isExpanded(e))&&(R==null?void 0:R.ancestorsExpanded(e))}});if(l&&!t[0].ancestorsExpanded(e)&&!h){if(!s.isLeaf){const v=c.getRowById(s);v&&c.renderRows([v])}return}c.calculateRowCount(!1,!0,!0),e.isFiltered&&(i=e.indexOf(t[0]));const{topIndex:g,rows:f,rowCount:C}=c,b=c.topIndex+c.rowCount-1,x=i,S=i+t.length-1,E=b>=e.count-t.length-1;o||r>-1||l&&n&&Object.values(n).some(v=>v)?c.refresh():x>=g&&x<g+C?u.refreshFromRowOnStoreAdd(f[x-g],...arguments):S>=g&&S<g+C?c.refresh():(E&&i>b&&c.fillBelow(u._scrollTop||0),c.estimateTotalHeight(!0))}onStoreException({action:e,type:t,response:i,exceptionType:r,error:l}){var o;const s=this;let n;switch(t){case"server":n=i.message||s.L("L{unspecifiedFailure}");break;case"exception":n=r==="network"?s.L("L{networkFailure}"):(l==null?void 0:l.message)||(i==null||(o=i.parsedJson)===null||o===void 0?void 0:o.message)||s.L("L{parseFailure}");break}s.applyMaskError(`<div class="b-grid-load-failure">
                <div class="b-grid-load-fail">${s.L(e==="read"?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>
                ${i!=null&&i.url?`<div class="b-grid-load-fail">${i.url}</div>`:""}
                <div class="b-grid-load-fail">${s.L("L{serverResponse}")}</div>
                <div class="b-grid-load-fail">${n}</div>
            </div>`)}onStoreDataChange({action:e,changes:t,source:i,syncInfo:r}){var l;(l=super.onStoreDataChange)===null||l===void 0||l.call(this,...arguments);const o=this;if(o.refreshSuspended||!o.rowManager||i.isSyncingDataOnLoad||e==="dataset"&&(o.rowManager.clearKnownHeights(),i.isTree&&i.isFiltered))return;const s=i.isGrouped&&t&&i.groupers.some(n=>n.field in t);o.isPainted&&!s&&o.renderRows(!!(!(e in Qt)||o.preserveScrollOnDatasetChange)),o.toggleEmptyText()}onStoreRecordIdChange(){var e;(e=super.onStoreRecordIdChange)===null||e===void 0||e.call(this,...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){const t=this._features;return(t==null?void 0:t.group)&&!t.group.disabled||(t==null?void 0:t.groupSummary)&&!t.groupSummary.disabled||this.store.tree&&!e&&this.store.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:e,records:t,isCollapse:i,isChild:r,isMove:l,isCollapseAll:o}){var s;if(!this.isPainted||l||o)return;(s=super.onStoreRemove)===null||s===void 0||s.call(this,...arguments);const n=this,{rowManager:a}=n;if(a.invalidateKnownHeight(t),!e.isSyncingDataOnLoad){if(n.animateRemovingRows&&!i&&!r){const d=t.reduce((u,c)=>{const h=a.getRowById(c.id);return h&&u.push(h),u},[]);if(d.length){const u=d[0];n.isAnimating=!0,X.onTransitionEnd({element:u._elementsArray[0],property:"left",duration:n.transitionDuration,thisObj:n,handler:()=>{n.isAnimating=!1,d.forEach(c=>!c.isDestroyed&&c.removeCls("b-removing")),a.refresh(),n.trigger("rowRemove"),n.afterRemove(arguments[0])}}),d.forEach(c=>c.addCls("b-removing"));return}}if(n.needsFullRefreshOnStoreRemove(...arguments))a.refresh(),n.afterRemove(arguments[0]);else{const d=a.topIndex;if(a.calculateRowCount(!1,!0,!0),a.topIndex!==d)a.renderFromRow(a.topRow);else{const{rows:u}=a,c=t.reduce((h,g)=>{const f=a.getRowById(g.id);return f&&(h=Math.min(h,u.indexOf(f))),h},u.length);u[c]?!n.refreshSuspended&&a.renderFromRow(u[c]):a.trigger("changeTotalHeight",{totalHeight:a.totalHeight})}n.trigger("rowRemove",{isCollapse:i}),n.afterRemove(arguments[0])}}}onFlatStoreMove({from:e,to:t}){const{rowManager:i,store:r}=this,{topIndex:l,rowCount:o}=i,[s,n]=[e,t].sort((u,c)=>u-c),a=r.indexOf(r.getAt(s,!0)),d=r.indexOf(r.getAt(n,!0));a>=l&&a<l+o?i.renderFromRow(i.rows[a-l]):d>=l&&d<l+o&&i.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:i}=this;if(t)i.clearKnownHeights(),i.refresh();else{const r=e.reduce((l,[,o])=>{const s=this.getRowFor(o);return s&&l.push(s),l},[]);i.invalidateKnownHeight(e),i.renderRows(r)}}relayStoreDataChange(e){if(this.ariaElement.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...e,store:e.source,source:this})}onStoreRemoveAll(){var e;(e=super.onStoreRemoveAll)===null||e===void 0||e.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach(i=>{const r=this.rowManager.getRowFor(i);r&&t.push(r)}),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:t}){const i=this,{subGrids:r,regions:l}=i,{parent:o}=e;let s=!0;Object.entries(r).forEach(([n,a])=>{if(!a.sealedColumns&&e.draggable&&n!==e.region&&(!o&&r[e.region].columns.count>1||o&&o.children.length>1)){const d=a.element.compareDocumentPosition(r[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,u=i.rtl?!d:d,c=l.length>2?i.L("L{moveColumnTo}",i.optionalL(n)):i.L(u?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${n}Region`]={targetSubGrid:n,text:c,icon:"b-fw-icon b-icon-column-move-"+(u?"right":"left"),separator:s,disabled:!e.allowDrag,onItem:({item:h})=>{e.traverse(g=>g.region=n),i.columns.insert(i.columns.indexOf(r[h.targetSubGrid].columns.last)+1,e),i.scrollColumnIntoView(e)}},s=!1}})}populateCellMenu({record:e,items:t}){}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const t=this,{columns:i}=t;return e.isLocation?e:e.isModel?new y({grid:t,id:e.id,columnId:i.visibleColumns[0].id}):new y(w.assign({grid:t},e))}getCell(e){const{store:t,columns:i}=this,{visibleColumns:r}=this.columns,l=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,o=isNaN(e.column)?isNaN(e.columnIndex)?r.indexOf(e.column||i.getById(e.columnId)||i.get(e.field)||r[0]):e.columnIndex:e.column;return l>-1&&l<t.count&&o>-1&&o<r.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return!!(!((e=this.features.treeGroup)===null||e===void 0)&&e.isGrouped)}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const i=G.get(t);return this.columns.getById(i.columnId)}updateAutoHeight(e){w.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){w.assertBoolean(e,"columnLines"),p.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:i}=e;t<i;t++)e[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const i=this;if(i.renderingRows||!i.isVisible)return!1;const r=i.scrollable,l=Math.abs(i.virtualScrollHeight-e),o=i._bodyRectangle.height,s=e-o;if(l){const n=s-i._scrollTop<o*2||i._verticalScrollHeight&&i._verticalScrollHeight-o<i._scrollTop;r.scrollHeight=i.virtualScrollHeight=e,i.isPainted&&(i.scrolling&&!n||l<100)&&!t?i.bufferedFixElementHeights():(i.virtualScrollHeightDirty&&i.virtualScrollHeightDirty(),i.bufferedFixElementHeights.cancel(),i.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,i=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=i,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=i,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=D.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...L.asArray(e||[]).map(t=>({element:(typeof t=="string"?this.subGrids[t]:t).scrollable.element}))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...L.asArray(e||[]).map(t=>(typeof t=="string"?this.subGrids[t]:t).element)])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:t}=e;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),O.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const t=this,{y:i}=e;i!==t._scrollTop&&(t._scrollTop=i,t.scrolling||(t.scrolling=!0,t.eachSubGrid(r=>r.suspendResizeMonitor=!0)),t.rowManager.updateRenderedRows(i),t.afterScroll({scrollTop:i}),t.trigger("scroll",{scrollTop:i}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid(e=>e.suspendResizeMonitor=!1)}async scrollRowIntoView(e,t=Jt){const i=this,r=t.block||"nearest",{rowManager:l}=i,o=i.store.getById(e);if(o){let n;if(i.store.indexOf(o)===-1)return dt;let a=i.scrollable,d=i.getRecordCoords(o);const u=D.from(a.element);if(d.virtual){const c=d.block,h=r!=="nearest"?t:{block:c};if(n=a.scrollIntoView(d,{block:"center"}),l.scrollTargetRecordId=o,l.updateRenderedRows(a.y,!0),d=i.getRecordCoords(o),l.lastScrollTop=a.y,d.virtual)return dt;if(t.animate)a.suspendEvents(),r==="end"||r==="nearest"&&c==="end"?a.y-=u.bottom-d.bottom:(r==="start"||r==="nearest"&&c==="start")&&(a.y+=d.y-u.y),l.updateRenderedRows(a.y,!1,!0),c==="end"?a.y-=l.appendRowBuffer*l.rowHeight-1:a.y+=l.prependRowBuffer*l.rowHeight-1,a.scrollIntoView(i.getRecordCoords(o),Object.assign({},t,h)),a.resumeEvents();else{var s;t.recursive||await n,await((s=i.scrollRowIntoView)===null||s===void 0?void 0:s.call(i,o,Object.assign({recursive:!0},t,h)))}}else{let{column:c}=t;if(c){if(c.isModel||(c=i.columns.getById(c)||i.columns.get(c)),c){a=i.getSubGridFromColumn(c).scrollable;const h=D.from(l.getRowFor(o).getCell(c.id));d.x=h.x,d.width=h.width}}else t.x=!1;return a.scrollIntoView(d,t)}}}scrollColumnIntoView(e,t){return e=e instanceof H?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},typeof t=="boolean"?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid(i=>{t.scrollLeft[i.region]=i.scrollable.x}),t}restoreScroll(e=this.storedScrollState){const t=this;t.eachSubGrid(i=>{const r=e.scrollLeft[i.region];if(r!=null){var l;i.scrollable.updateX(r),i.header.scrollable.updateX(r),i.footer.scrollable.updateX(r),(l=i.fakeScroller)===null||l===void 0||l.updateX(r)}}),t.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=p.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:O.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const t=e.appendTo||e.insertBefore||document.body,i=p.getRootElement(typeof t=="string"?document.getElementById(t):t)||document.body;(!e.adopt||!i.contains(e.element))&&(i.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:t}=e.beginGridMeasuring(),i=p.getStyleValue(t,["height","border-top-width","border-bottom-width"]),r=parseInt(i.height),l=O.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,o=i["border-top-width"]?Math.round(l*parseFloat(i["border-top-width"])):0,s=i["border-bottom-width"]?Math.round(l*parseFloat(i["border-bottom-width"])):0;(e.rowHeight==null||e.rowHeight===e._rowHeightFromStyle)&&(e.rowHeight=!isNaN(r)&&r?r:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=o+s,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:i}=this;t.classList.add("b-notransition"),e?i.returnToTop():i.refresh(),t.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach(t=>t.renderCell(t.getCell(e.id))):e.children.forEach(t=>this.refreshColumn(t)))}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:i,virtualScrollers:r,scrollable:l,hasVerticalOverflow:o}=e,{classList:s}=r,n=!s.contains("b-hide-display"),a=Object.values(e.subGrids).some(u=>u.overflowingHorizontally),d=a!==n;if(d&&r.classList.toggle("b-hide-display",!a),p.scrollBarWidth){const u=o||l.overflowY==="scroll";t.classList.toggle("b-show-yscroll-padding",u),i.classList.toggle("b-show-yscroll-padding",u),r.classList.toggle("b-show-yscroll-padding",u),d&&(a&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const t=this,i=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(i),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:i,footerContainer:r,rowManager:l}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",i),e.callEachSubGrid("refreshFooter",r),e.renderHeader(i,t),e.renderFooter(r,t),e.fixSizes();const o=l.removeAllRows();l.calculateRowCount(!1,!0,!0),l.rowCount&&(l.setPosition(o),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){var t;const i=this;if(i.ariaElement.setAttribute("aria-rowcount",i.store.count+1),(t=super.onPaint)===null||t===void 0||t.call(this,...arguments),i.onPaintOverride()||!e)return;const{rowManager:r,store:l,element:o,headerContainer:s,bodyContainer:n,footerContainer:a}=i,d=p.scrollBarPadElement;let u,c=0;i.role=l!=null&&l.isTree?"treegrid":"grid",i.columns.ion({change:()=>u=!0,once:!0}),i.updateResponsive(i.width,0),u&&(i.callEachSubGrid("refreshHeader",s),i.callEachSubGrid("refreshFooter",a)),i.renderHeader(s,o),i.renderFooter(a,o),p.append(s,d),p.append(a,d),p.append(i.virtualScrollers,d),i.refreshBodyRectangle();const h=i.bodyContainer.offsetHeight;if(i.autoHeight?(i._bodyHeight=r.initWithHeight(o.offsetHeight-s.offsetHeight-a.offsetHeight,!0),n.style.height=i.bodyHeight+"px"):(i._bodyHeight=h,r.initWithHeight(i._bodyHeight,!0)),i.eachSubGrid(g=>{g.header.maxDepth>c&&(c=g.header.maxDepth)}),s.dataset.maxDepth=c,i.fixSizes(),(l.count||!l.isLoading)&&i.renderRows(),i.columns.usesAutoHeight){const{fonts:g}=document;(g==null?void 0:g.status)!=="loaded"&&g.ready.then(()=>!i.isDestroyed&&i.refreshRows())}i.initScroll(),i.initInternalEvents()}render(){const e=this;e.requireSize=!!e.owner,super.render(...arguments),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),!("minHeight"in e.initialConfig)&&!("height"in e.initialConfig)&&parseInt(globalThis.getComputedStyle(e.element).minHeight)===e.height&&console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,t){}renderFooter(e,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}syncMaskCover(e=this.masked){if(e){const t=e.cover==="body"&&this.rectangleOf("bodyContainer"),i=t&&this.rectangleOf("virtualScrollers"),{style:r}=e.element;r.marginTop=t?`${t.y}px`:"",r.height=t?`${t.height+((i==null?void 0:i.height)||0)}px`:""}}maskBody(e){let t;return this.bodyContainer&&(this.masked=xt.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(e){var t,i;(t=this.emptyTextEl)===null||t===void 0||t.remove(),this.emptyTextEl=p.createElement({parent:(i=this.firstItem)===null||i===void 0?void 0:i.element,className:"b-empty-text",[e!=null&&e.includes("<")?"html":"text"]:e})}toggleEmptyText(){const{bodyContainer:e,store:t}=this;e==null||e.classList.toggle("b-grid-empty",!(t.count>0||t.isLoading||t.isCommitting))}updateReadOnly(e,t){if(super.updateReadOnly(e,t),!this.isConfiguring)for(const r of this.columns.bottomColumns){var i;(i=r.updateReadOnly)===null||i===void 0||i.call(r,e)}}getCurrentConfig(e){const t=super.getCurrentConfig(e),{store:i}=this,r=i.getInlineData(e),l=i.getCurrentConfig(e)||t.store;return r.length&&(t.data=r),l&&i.originalModelClass===Qe&&delete l.modelClass,w.isEmpty(l)||(t.store=l),t.store&&delete t.store.data,t}}Fe.initClass(),K.setVersion("grid","5.3.7"),Fe._$name="GridBase";export{ce as Bar,be as CellEdit,oe as CellMenu,Y as CheckColumn,H as Column,Ce as ColumnDragToolbar,se as ColumnPicker,ne as ColumnReorder,_e as ColumnResize,k as ColumnStore,Oe as Filter,ve as FilterBar,xe as Footer,Fe as GridBase,rt as GridElementEvents,_ as GridFeatureManager,lt as GridFeatures,Z as GridFieldFilterPicker,ae as GridFieldFilterPickerGroup,ot as GridResponsive,st as GridSelection,nt as GridState,at as GridSubGrids,we as Group,ee as Header,Se as HeaderMenu,y as Location,de as Row,Re as RowManager,re as RowNumberColumn,ye as Sort,Be as Stripe,te as SubGrid,q as WidgetColumn};
//# sourceMappingURL=GridBase.js.map
