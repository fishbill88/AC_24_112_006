/*!
 *
 * Bryntum Scheduler Pro 5.3.7
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var De=Object.defineProperty;var Re=(f,e,t)=>e in f?De(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var y=(f,e,t)=>(Re(f,typeof e!="symbol"?e+"":e,t),t);import{CalendarField as Te,SchedulerProEvent as xe,PartOfProject as se,PercentDoneMixin as Pe,EventSegmentModel as Me,ChronoEventStoreMixin as we,ProjectChangeHandlerMixin as Ae,ProjectCrudManager as Be,SchedulerProProjectMixin as oe,CalendarModel as Ie,DependencyModel as Oe,AssignmentModel as ke,ResourceModel as He,CalendarManagerStore as Le,DependencyStore as je,AssignmentStore as Ue,ResourceStore as Fe,StateTrackingManager as _e,ProjectProgressMixin as Ve,SchedulingIssueResolution as We,CalculatedValueGen as $e,BaseCalendarMixin as Ge}from"./chunks/SchedulingIssueResolution.js";import{AdvancedTab as Zt,AssignmentAllocationInterval as Kt,AssignmentModel as Jt,AssignmentStore as er,BaseAllocationInfo as tr,BaseAllocationInterval as rr,BaseAssignmentMixin as ir,BaseCalendarMixin as nr,BaseDependencyMixin as sr,BaseDependencyResolution as or,BaseEmptyCalendarEffectResolution as ar,BaseEventMixin as lr,BaseHasAssignmentsMixin as cr,BaseResourceMixin as dr,BreakCurrentStackExecution as ur,CalculateProposed as gr,CalculatedValueGen as hr,CalculatedValueGenC as fr,CalculatedValueSync as mr,CalculatedValueSyncC as pr,CalculationGen as vr,CalculationSync as yr,CalendarField as Cr,CalendarIntervalModel as Er,CalendarManagerStore as br,CalendarModel as Sr,CanCombineCalendarsMixin as Dr,ChangeLogAction as Rr,ChangeLogAssignmentEntity as Tr,ChangeLogDependencyEntity as xr,ChangeLogEntity as Pr,ChangeLogStore as Mr,ChangeLogTransactionModel as wr,ChronoAbstractProjectMixin as Ar,ChronoAssignmentStoreMixin as Br,ChronoCalendarManagerStoreMixin as Ir,ChronoDependencyStoreMixin as Or,ChronoEventStoreMixin as kr,ChronoEventTreeStoreMixin as Hr,Field as Lr,ChronoGraph as jr,ChronoModelFieldIdentifier as Ur,ChronoModelMixin as Fr,ChronoModelReferenceBucketFieldIdentifier as _r,ChronoModelReferenceFieldIdentifier as Vr,ChronoModelReferenceFieldQuark as Wr,ChronoPartOfProjectGenericMixin as $r,ChronoPartOfProjectModelMixin as Gr,ChronoPartOfProjectStoreMixin as zr,ChronoResourceStoreMixin as Nr,ChronoStoreMixin as qr,Transaction as Yr,CommitZero as Qr,ComputationCycle as Xr,ConflictEffect as Zr,ConflictEffectDescription as Kr,ConflictResolution as Jr,ConflictSymbol as ei,ConstrainedEarlyEventMixin as ti,ConstraintInterval as ri,ConstraintIntervalDescription as ii,ConstraintTypePicker as ni,ContextGen as si,ContextSync as oi,CycleDescription as ai,CycleEffect as li,CycleEffectDescription as ci,CycleResolution as di,CycleResolutionInput as ui,CycleResolutionInputChrono as gi,CycleResolutionPopup as hi,CycleSymbol as fi,DateConstraintInterval as mi,DateConstraintIntervalDescription as pi,DateInterval as vi,DeactivateDependencyCycleEffectResolution as yi,DeactivateDependencyResolution as Ci,DependencyConstraintInterval as Ei,DependencyConstraintIntervalDescription as bi,DependencyModel as Si,DependencyStore as Di,DependencyTab as Ri,DependencyTypePicker as Ti,DurationConverterMixin as xi,DurationVar as Pi,EMPTY_INTERVAL as Mi,EarlyLateLazyness as wi,EdgeType as Ai,EdgeTypeNormal as Bi,EdgeTypePast as Ii,EditorTab as Oi,Effect as ki,EffectResolutionResult as Hi,EffortField as Li,EffortVar as ji,EmptyCalendarEffect as Ui,EmptyCalendarEffectDescription as Fi,EmptyCalendarSymbol as _i,EndDateField as Vi,EndDateVar as Wi,EngineReplica as $i,EngineRevision as Gi,EngineTransaction as zi,Entity as Ni,EntityIdentifier as qi,EntityMeta as Yi,EventLoader as Qi,EventResize as Xi,EventSegmentModel as Zi,EventSegmentResize as Ki,EventSegments as Ji,EventUpdateAction as en,FieldIdentifier as tn,FixedDurationMixin as rn,FormTab as nn,Formula as sn,FormulasCache as on,GanttTaskEditor as an,GeneralTab as ln,GetTransaction as cn,HasCalendarMixin as dn,HasChildrenMixin as un,HasDateConstraintMixin as gn,HasDependenciesMixin as hn,HasEffortMixin as fn,HasPercentDoneMixin as mn,HasProposedNotPreviousValue as pn,HasProposedNotPreviousValueEffect as vn,HasProposedNotPreviousValueSymbol as yn,HasProposedValue as Cn,HasProposedValueEffect as En,HasProposedValueSymbol as bn,HasSchedulingModeMixin as Sn,HasSubEventsMixin as Dn,Identifier as Rn,IdentifierC as Tn,Instruction as xn,IsChronoModelSymbol as Pn,Levels as Mn,Listener as wn,Meta as An,MinimalChronoModelFieldIdentifierGen as Bn,MinimalChronoModelFieldIdentifierSync as In,MinimalChronoModelFieldVariable as On,MinimalEntityIdentifier as kn,MinimalFieldIdentifierGen as Hn,MinimalFieldIdentifierSync as Ln,MinimalFieldVariable as jn,MinimalReferenceBucketIdentifier as Un,MinimalReferenceBucketQuark as Fn,MinimalReferenceIdentifier as _n,ModelBucketField as Vn,ModelCombo as Wn,ModelField as $n,ModelReferenceField as Gn,NOT_VISITED as zn,NotesTab as Nn,OnCycleAction as qn,OwnIdentifier as Yn,OwnIdentifierSymbol as Qn,OwnQuark as Xn,OwnQuarkSymbol as Zn,PartOfProject as Kn,PercentBar as Jn,PercentDoneMixin as es,PredecessorsTab as ts,PreviousValueOf as rs,PreviousValueOfEffect as is,PreviousValueOfSymbol as ns,ProjectChangeHandlerMixin as ss,ProjectCrudManager as os,ProjectProgressMixin as as,ProjectWebSocketHandlerMixin as ls,ProposedArgumentsOf as cs,ProposedArgumentsOfEffect as ds,ProposedArgumentsOfSymbol as us,ProposedOrPrevious as gs,ProposedOrPreviousSymbol as hs,ProposedOrPreviousValueOf as fs,ProposedOrPreviousValueOfEffect as ms,ProposedOrPreviousValueOfSymbol as ps,ProposedValueOf as vs,ProposedValueOfEffect as ys,ProposedValueOfSymbol as Cs,Quark as Es,QuarkGen as bs,QuarkSync as Ss,ReadMode as Ds,ReadyStatePropagator as Rs,RecurrenceTab as Ts,ReferenceBucketField as xs,ReferenceBucketIdentifier as Ps,ReferenceBucketQuark as Ms,ReferenceField as ws,ReferenceIdentifier as As,Reject as Bs,RejectEffect as Is,RejectSymbol as Os,RemoveDateConstraintConflictResolution as ks,RemoveDependencyCycleEffectResolution as Hs,RemoveDependencyResolution as Ls,Replica as js,ResourceAllocationEventRangeCalendar as Us,ResourceAllocationEventRangeCalendarIntervalMixin as Fs,ResourceAllocationEventRangeCalendarIntervalStore as _s,ResourceAllocationInfo as Vs,ResourceAllocationInterval as Ws,ResourceModel as $s,ResourceStore as Gs,ResourcesTab as zs,Revision as Ns,SEDBackwardCycleResolutionContext as qs,SEDDispatcher as Ys,SEDDispatcherIdentifier as Qs,SEDForwardCycleResolutionContext as Xs,SEDGraphDescription as Zs,SEDWUDispatcher as Ks,SEDWUDispatcherIdentifier as Js,ScheduledByDependenciesEarlyEventMixin as eo,SchedulerAdvancedTab as to,SchedulerBasicEvent as ro,SchedulerBasicProjectMixin as io,SchedulerGeneralTab as no,SchedulerProAssignmentMixin as so,SchedulerProCycleEffect as oo,SchedulerProDependencyMixin as ao,SchedulerProEvent as lo,SchedulerProHasAssignmentsMixin as co,SchedulerProProjectMixin as uo,SchedulerProResourceMixin as go,SchedulerTaskEditor as ho,SchedulingIssueEffectResolution as fo,SchedulingIssueResolution as mo,SchedulingIssueResolutionPopup as po,SchedulingModePicker as vo,Schema as yo,StartDateField as Co,StartDateVar as Eo,StateTrackingManager as bo,SuccessorsTab as So,SynchronousCalculationStarted as Do,TaskEdit as Ro,TaskEditorBase as To,TombStone as xo,TransactionCycleDetectionWalkContext as Po,TransactionSymbol as Mo,TransactionWalkDepth as wo,UnitsVar as Ao,UnsafePreviousValueOf as Bo,UnsafePreviousValueOfEffect as Io,UnsafePreviousValueOfSymbol as Oo,UnsafeProposedOrPreviousValueOf as ko,UnsafeProposedOrPreviousValueOfEffect as Ho,UnsafeProposedOrPreviousValueOfSymbol as Lo,Use24hrsEmptyCalendarEffectResolution as jo,Use8hrsEmptyCalendarEffectResolution as Uo,VISITED_TOPOLOGICALLY as Fo,Variable as _o,VariableC as Vo,VariableInputState as Wo,VariableWalkContext as $o,VersionModel as Go,VersionStore as zo,Versions as No,WalkContext as qo,WalkSource as Yo,WalkState as Qo,Write as Xo,WriteEffect as Zo,WriteSeveral as Ko,WriteSeveralEffect as Jo,WriteSeveralSymbol as ea,WriteSymbol as ta,bucket as ra,build_proposed as ia,calculate as na,calculateEffectiveEndDateConstraintInterval as sa,calculateEffectiveStartDateConstraintInterval as oa,createEntityOnPrototype as aa,cycleInfo as la,dateConverter as ca,durationFormula as da,effortFormula as ua,endDateByEffortFormula as ga,endDateFormula as ha,ensureEntityOnPrototype as fa,entity as ma,entityDecoratorBody as pa,field as va,fixedDurationAndEffortSEDWUGraphDescription as ya,fixedDurationSEDWUBackwardEffortDriven as Ca,fixedDurationSEDWUBackwardNonEffortDriven as Ea,fixedDurationSEDWUForwardEffortDriven as ba,fixedDurationSEDWUForwardNonEffortDriven as Sa,fixedDurationSEDWUGraphDescription as Da,generic_field as Ra,getDecoratedModelFields as Ta,injectStaticFieldsProperty as xa,intersectIntervals as Pa,isAtomicValue as Ma,isSerializableEqual as wa,model_field as Aa,prototypeValue as Ba,reference as Ia,required as Oa,runGeneratorAsyncWithEffect as ka,runGeneratorSyncWithEffect as Ha,startDateByEffortFormula as La,startDateFormula as ja,throwUnknownIdentifier as Ua,unitsFormula as Fa,validateRequiredProperties as _a,write as Va}from"./chunks/SchedulingIssueResolution.js";import{TimeSpan as ze,RecurringTimeSpan as Ne,EventModelMixin as qe,SharedEventStoreMixin as Ye,RecurringEventsMixin as Qe,GetEventsMixin as Xe,DayIndexMixin as Ze,EventStoreMixin as Ke,ResourceTimeRangeModel as ae,ProjectModelMixin as Je,TimeUnit as C,AbstractPartOfProjectStoreMixin as et}from"./chunks/ProjectModel.js";import{AbstractPartOfProjectStoreMixin as $a}from"./chunks/ProjectModel.js";import{Column as le,ColumnStore as ce,GridFeatureManager as S}from"./chunks/GridBase.js";import{AttachToProjectMixin as de}from"./chunks/EventNavigation.js";import{Scale as tt,Histogram as rt}from"./chunks/Scale.js";import{Duration as U,DateHelper as p,AjaxStore as ue,Base as ge,ArrayHelper as b,InstancePlugin as V,Tooltip as he,Rectangle as M,Delayable as it,DomSync as O,DomHelper as w,EventHelper as nt,VersionHelper as st,StringHelper as A,Model as ot,ObjectHelper as fe,Store as at}from"./chunks/Editor.js";import{HorizontalLayoutStack as lt,HorizontalLayoutPack as ct,ResourceTimeRangesBase as me,DependencyEdit as dt,EventDrag as ut,HorizontalRendering as gt,VerticalRendering as ht,SchedulerBase as pe}from"./chunks/SchedulerBase.js";import{NumberFormat as ft}from"./chunks/MessageDialog.js";import"./chunks/TimelineBase.js";import{Tree as mt}from"./chunks/Tree.js";import"./chunks/RegionResize.js";import{GridRowModel as pt}from"./chunks/GridRowModel.js";import{TreeGrid as vt}from"./chunks/TreeGrid.js";import"./chunks/AvatarRendering.js";import"./chunks/Grid.js";import"./chunks/TextAreaField.js";import"./chunks/TabPanel.js";import"./chunks/Card.js";import"./chunks/ButtonGroup.js";import"./chunks/EventSelection.js";import"./chunks/Slider.js";class W extends le.mixin(de){static get $name(){return"ResourceCalendarColumn"}static get type(){return"resourceCalendar"}static get defaults(){return{field:"calendar",text:"Calendar",editor:{type:Te.type,clearable:!0,allowInvalid:!1}}}attachToProject(e){e&&(this.defaultCalendar=e.defaultCalendar,this.editor.store=e.calendarManagerStore)}attachToResourceStore(e){super.attachToResourceStore(e),e&&e.ion({name:"resourceStore",update:"onResourceUpdate",thisObj:this})}onResourceUpdate({record:e,changes:t}){const r=t[this.field];if(r){var i;if(typeof r.oldValue=="string"&&((i=r.value)===null||i===void 0?void 0:i.id)===r.oldValue)return;this.refreshCell(e)}}renderer({value:e}){if(e===this.defaultCalendar)return"";if(e&&e.id){const t=this.editor.store.getById(e.id);return t&&t[this.editor.displayField]||""}else return""}}ce.registerColumnType(W),W._$name="ResourceCalendarColumn";class $ extends le{static get $name(){return"ScaleColumn"}static get type(){return"scale"}static get isScaleColumn(){return!0}static get fields(){return["scalePoints"]}static get defaults(){return{text:"\xA0",width:40,minWidth:40,cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:[{value:4},{value:8,text:8}]}}onDestroy(){this.scaleWidget.destroy()}set width(e){super.width=e,this.scaleWidget.width=e}get width(){return super.width}applyValue(e,t,r){return t==="scalePoints"&&(this.scaleWidget[t]=r),super.applyValue(...arguments)}buildScaleWidget(){const e=this,t=new tt({owner:e.grid,appendTo:e.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1});return Object.defineProperties(t,{width:{get(){return e.width},set(r){this.element.style.width=`${r}px`,this._width=e.width}},height:{get(){return this._height},set(r){this.element.style.height=`${r}px`,this._height=r}}}),t.width=e.width,t}get scaleWidget(){const e=this;return e._scaleWidget||(e._scaleWidget=e.buildScaleWidget()),e._scaleWidget}renderer({cellElement:e,scaleWidget:t=this.scaleWidget}){t.height=this.grid.rowHeight,t.refresh();const r=t.element.cloneNode(!0);r.removeAttribute("id"),r.classList.remove("b-hide-offscreen"),e.innerHTML="",e.appendChild(r)}}ce.registerColumnType($),$._$name="ScaleColumn";class k extends xe.derive(ze).mixin(Ne,se,qe,Pe){static get $name(){return"EventModel"}static get fields(){return[{name:"showInTimeline",type:"boolean",defaultValue:!1},"note",{name:"preamble",convert:e=>e?new U(e):null},{name:"postamble",convert:e=>e?new U(e):null}]}getDefaultSegmentModelClass(){return Me}updateWrapDate(e,t,r=!0){return t=new U(t),new Date(e.getTime()+(r?1:-1)*t.milliseconds)}get startDate(){var t;let e;return this.isOccurrence?e=this.get("startDate"):e=(t=this._startDate)!=null?t:super.startDate,this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){const t=this;if(t.generation&&t.isParent&&!t.$ignoreChange){const r=p.diff(t.startDate,e);if(r)for(const i of this.children)i.startDate=p.add(i.startDate,r)}t.batching?(t._startDate=e,t.set({startDate:e})):(super.startDate=e,t.preamble&&(t.wrapStartDate=null,t.wrapEndDate=null))}get endDate(){var t;let e;return this.isOccurrence?e=this.get("endDate"):e=(t=this._endDate)!=null?t:super.endDate,this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){const t=this;t.batching?(t._endDate=e,t.set({endDate:e})):(super.endDate=e,t.postamble&&(t.wrapStartDate=null,t.wrapEndDate=null))}get fullEffort(){return new U({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get wrapStartDate(){const e=this,{preamble:t,startDate:r}=e,i=e._wrapStartDate;let n;return i?n=i:t?(n=e.updateWrapDate(r,t,!1),e._wrapStartDate=n):n=r,n}set wrapStartDate(e){this._wrapStartDate=e}get wrapEndDate(){const e=this,{postamble:t,endDate:r}=e,i=e._wrapEndDate;let n;return i?n=i:t?(n=e.updateWrapDate(r,t,!0),e._wrapEndDate=n):n=r,n}set wrapEndDate(e){this._wrapEndDate=e}set(e){const t=typeof e=="object";return(e==="preamble"||t&&"preamble"in e)&&(this.wrapStartDate=null),(e==="postamble"||t&&"postamble"in e)&&(this.wrapEndDate=null),super.set(...arguments)}get outerStartDate(){return this.wrapStartDate}get outerEndDate(){return this.wrapEndDate}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":return!1;case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}get stm(){var t;var e;return(t=(e=this.recurringEvent)===null||e===void 0?void 0:e.stm)!=null?t:super.stm}set stm(e){super.stm=e}get assigned(){const{project:e}=this,t=super.assigned;return e!=null&&e.isDelayingCalculation&&!t?e.assignmentStore.storage.findItem("event",this):t}set assigned(e){super.assigned=e}getCurrentConfig(e){const{segments:t}=this,r=super.getCurrentConfig(e);return r&&t&&(r.segments=t.map(i=>i.getCurrentConfig(e))),r}}y(k,"isProEventModel",!0),k._$name="EventModel";class F extends se(Ye(Qe(Xe(Ze(Ke(we.derive(ue))))))){static get defaultConfig(){return{modelClass:k}}}y(F,"$name","EventStore"),F._$name="EventStore";const ve=(f,e)=>f<e?-1:f>e?1:0;var G=f=>class extends(f||ge){static get configurable(){return{type:null,weights:null,groupBy:null,groupByThisObj:null,layoutFn:null}}get grouped(){return!!this.groupBy}getGroupValue(t){var i;let r;if(t.group!=null)r=t.group;else{const{groupBy:n,weights:s,groupByThisObj:o=this}=this,{eventRecord:a}=t;typeof n=="function"?r=n.call(o,a):(r=a[n],s&&(r=(i=s[r])!=null?i:1/0)),t.group=r}return r}getEventGroups(t){if(this.grouped){const r=new Set;return t.sort((i,n)=>{const s=this.getGroupValue(i),o=this.getGroupValue(n);return r.add(s),r.add(o),ve(s,o)}),Array.from(r).sort(ve)}else return[]}};class z extends lt.mixin(G){static get $name(){return"ProHorizontalLayoutStack"}layoutEventsInBands(e,t=!1){return this.getEventGroups(e),super.layoutEventsInBands(e,t)}}z._$name="ProHorizontalLayoutStack";class N extends ct.mixin(G){static get $name(){return"ProHorizontalLayoutPack"}layoutEventsInBands(e){const t=this.getEventGroups(e),r=t.length||1,i=this.packEventsInBands(e,(n,s,o,a)=>{const l=a/r,c=r===1?0:t.indexOf(n.group),d=c/r;n.height=l,n.top=d+o.start/r+s*l,n.inBandHeight=a,n.inBandTop=o.start+s*a});return e.forEach(n=>{Object.assign(n,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,n.top,n.height,n.eventRecord,n.resourceRecord))}),i}}N._$name="ProHorizontalLayoutPack";let yt=0;class _ extends ae{static get $name(){return"CalendarHighlightModel"}static generateId(){return++yt}}y(_,"domIdPrefix","calendarhighlight");class q extends me{static get $name(){return"CalendarHighlight"}static get configurable(){return{calendar:"event",unhighlightOnDrop:null,collectAvailableResources:null,rangeCls:"b-sch-highlighted-calendar-range",resourceTimeRangeModelClass:_,inflate:3}}static get pluginConfig(){const e=super.pluginConfig;return e.assign=["highlightEventCalendars","highlightResourceCalendars","unhighlightCalendars"],e}afterConstruct(){super.afterConstruct(),this.client.ion({eventDragStart:"onEventDragStart",eventDragReset:"unhighlightCalendars",eventResizeStart:"onEventResizeStart",eventResizeEnd:"unhighlightCalendars",dragCreateStart:"onDragCreateStart",afterDragCreate:"unhighlightCalendars",thisObj:this})}highlightCalendar(e,t){e=b.asArray(e),t=b.asArray(t),this.calendar==="event"?this.highlightEventCalendars(e,t):this.highlightResourceCalendars(t)}highlightEventCalendars(e,t,r=!0){const i=this,{client:n}=i,{startDate:s,endDate:o}=n;i.disabled||(r&&i.unhighlightCalendars(),e=b.asArray(e),t||(t=e.flatMap(a=>a.$linkedResources)),i.highlight=new Map,t=b.asArray(t),e.forEach(a=>{var l;if(!a.calendar)return;const c=(l=a.calendar)===null||l===void 0?void 0:l.getWorkingTimeRanges(s,o).map(d=>new _(d));if(c){for(const d of t)i.highlight.set(d,c),n.currentOrientation.refreshEventsForResource(d,!0,!1);t.length>0&&n.currentOrientation.onRenderDone()}}))}highlightResourceCalendars(e,t=!0){const r=this,{startDate:i,endDate:n,currentOrientation:s}=r.client;if(!r.disabled){t&&r.unhighlightCalendars(),r.highlight=new Map;for(const a of e){var o;const l=(o=a.calendar)===null||o===void 0?void 0:o.getWorkingTimeRanges(i,n).map(c=>new _(c));l&&(r.highlight.set(a,l),s.refreshEventsForResource(a,!0,!1))}e.length>0&&s.onRenderDone()}}unhighlightCalendars(){if(!this.highlight)return;const{currentOrientation:e}=this.client,t=this.highlight.keys();this.highlight=null;for(const r of t)e.refreshEventsForResource(r,!0,!1);e.onRenderDone()}onEventDragStart({context:e}){var o;var t;if(this.disabled)return;const r=this,{client:i}=r,{eventRecords:n}=e,s=e.availableResources=i.features.eventDrag.constrainDragToResource?[e.resourceRecord]:(o=(t=r.collectAvailableResources)===null||t===void 0?void 0:t.call(r,{scheduler:i,eventRecords:n}))!=null?o:i.resourceStore.records;r.highlightCalendar(n,s)}onEventResizeStart({eventRecord:e,resourceRecord:t}){this.disabled||this.highlightCalendar(e,[t])}onDragCreateStart({eventRecord:e,resourceRecord:t}){this.disabled||this.highlightCalendar(e,[t])}getEventsToRender(e,t){var r;const i=(r=this.highlight)===null||r===void 0?void 0:r.get(e);return i&&t.push(...i),t}onEventDataGenerated(e){const{eventRecord:t}=e;if(t.isCalendarHighlightModel){const{inflate:r}=this;e.fillSize=this.client.isVertical,e.wrapperCls["b-sch-highlighted-calendar-range"]=1,e.children.push({className:"b-sch-event-content",html:t.name,dataset:{taskBarFeature:"content"}}),e.width+=r*2,e.height+=r*2,e.left-=r,e.top-=r,e.eventId=`${this.generateElementId(t)}-resource-${e.resourceRecord.id}`}}updateDisabled(e,t){super.updateDisabled(e,t),e&&this.unhighlightCalendars()}shouldInclude(e){return e.isCalendarHighlightModel}get featureClass(){}}q._$name="CalendarHighlight",S.registerFeature(q,!1,"SchedulerPro");class Y extends dt{static get $name(){return"DependencyEdit"}static get configurable(){return{showLagField:!0,editorConfig:{items:{activeField:{type:"checkbox",name:"active",label:"L{Active}"}}}}}}Y._$name="DependencyEdit",S.registerFeature(Y,!1);class Q extends V{static get $name(){return"EventBuffer"}static get configurable(){return{showDuration:!0,tooltipTemplate:{value:null,$config:"nullify"}}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}updateTooltipTemplate(e){const t=this;if(e)t.tooltip=he.new({forElement:t.client.timeAxisSubGridElement,forSelector:".b-sch-event-buffer-before,.b-sch-event-buffer-after",align:{align:"b-t",offset:[0,10]},getHtml({activeTarget:i}){const n=t.client.resolveEventRecord(i),s=i.matches(".b-sch-event-buffer-before"),o=s?n.preamble:n.postamble;return t.tooltipTemplate({eventRecord:n,duration:o,before:s})}});else{var r;(r=t.tooltip)===null||r===void 0||r.destroy()}}onEventDataGenerated({useEventBuffer:e,bufferBeforeWidth:t,bufferAfterWidth:r,eventRecord:i,wrapperChildren:n}){if(this.enabled&&e){const{isHorizontal:s}=this.client,{showDuration:o}=this,{preamble:a,postamble:l}=i,c=s?"width":"height";n.push({className:{"b-sch-event-buffer":1,"b-sch-event-buffer-before":1,"b-buffer-thin":!t},style:`${c}: ${t}px`,children:o&&a?[{tag:"span",className:"b-buffer-label",html:a.toString(!0)}]:void 0},{className:{"b-sch-event-buffer":1,"b-sch-event-buffer-after":1,"b-buffer-thin":!r},style:`${c}: ${r}px`,children:o&&l?[{tag:"span",className:"b-buffer-label",html:l.toString(!0)}]:void 0})}}updateShowDuration(){this.isConfiguring||this.client.refreshWithTransition()}doDisable(e){super.doDisable(e);const{client:t}=this;!t.isConfiguring&&t.isPainted&&(t.element.classList.add("b-eventbuffer-transition"),t.refreshWithTransition(),t.waitForAnimations().then(()=>{t.element.classList.remove("b-eventbuffer-transition")}))}}Q._$name="EventBuffer",S.registerFeature(Q,!1,"SchedulerPro");class H extends ut{static get defaultConfig(){return{constrainDragToResource:!0}}static get configurable(){return{capitalizedEventName:"EventSegment"}}static get pluginConfig(){return{chain:["onPaint","isEventElementDraggable"]}}getTriggerParams(e){const{assignmentRecords:t,eventRecords:r,resourceRecord:i,browserEvent:n}=e;return{context:e,eventRecords:r,resourceRecord:i,assignmentRecords:t,event:n}}triggerEventDrag(e,t){this.scheduler.trigger("eventSegmentDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate}))}triggerDragStart(e){this.scheduler.navigator.skipNextClick=!0,this.scheduler.trigger("eventSegmentDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.scheduler.trigger("eventSegmentDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.scheduler.trigger("eventSegmentDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){if(this.scheduler.trigger("afterEventSegmentDrop",Object.assign(this.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:r,eventStore:i}=this.client;this.dragData.initialAssignmentsState.find(({resource:s,assignment:o},a)=>{var l;return!r.includes(o)||!i.includes(o.event)||s.id!==((l=this.dragData.assignmentRecords[a])===null||l===void 0?void 0:l.resourceId)})&&this.client.refresh()}}async updateRecords(e){const t=this,{client:r}=t,i=!1;let n;return e.externalDropTarget||(r.eventStore.suspendAutoCommit(),n=await t.updateSegment(r,e,i),r.eventStore.resumeAutoCommit()),r.trigger("eventSegmentDrop",Object.assign(t.getTriggerParams(e),{isCopy:i,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),n}async updateSegment(e,t){const r=this,i=e.mode==="vertical",{eventRecords:n,assignmentRecords:s,timeDiff:o}=t;e.suspendRefresh();let a=!1;i&&n.forEach((u,h)=>{const v=t.eventBarEls[h];delete u.instanceMeta(e).hasTemporaryDragElement,v.dataset.transient&&v.remove()});const l=t.eventBarEls.slice(),c=t.eventRecord,d=r.adjustStartDate(t.origStart,o);if(!p.isEqual(c.startDate,d)){var g;e.endListeningForBatchedUpdates(),r.cancelBatchUpdate(c),c.startDate=d,a=!0,await e.project.commitAsync(),(g=r.endBatchUpdate)===null||g===void 0||g.call(r,c)}e.resumeRefresh(),s.length>0&&(a?(e.fillTicks&&l.forEach(u=>delete u.lastDomConfig),e.refreshWithTransition()):t.valid=!1)}isEventElementDraggable(e,t,r,i){const n=this;return n.disabled||!(t.isEventSegment||t.segments)?!0:!r.closest(n.drag.targetSelector)}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getMinimalDragData(e){const t=this,{client:r}=t,i=t.getElementFromContext(e),n=r.resolveEventRecord(i),s=r.resolveResourceRecord(i),o=r.resolveAssignmentRecord(i);return{eventRecord:n,resourceRecord:s,assignmentRecord:o,eventRecords:[n],assignmentRecords:o?[o]:[]}}beginBatchUpdate(e){e.event.beginBatch(),e.beginBatch()}endBatchUpdate(e){var t;(t=e.event)===null||t===void 0||t.endBatch(),e.endBatch()}cancelBatchUpdate(e){var t;(t=e.event)===null||t===void 0||t.cancelBatch(),e.cancelBatch()}setupProductDragData(e){var t;const r=this,{client:i}=r,n=r.getElementFromContext(e),{eventRecord:s,resourceRecord:o}=r.getMinimalDragData(e),a=[],l=i.getElementsFromEventRecord(s.event,o,!0)[0];if(r.constrainDragToResource&&!o)throw new Error("Resource could not be resolved for event: "+s.id);r.drag.ignoreSamePositionDrop=!i.rtl||s.nextSegment,i.listenToBatchedUpdates||i.beginListeningForBatchedUpdates(),r.beginBatchUpdate(s);const c=(t=r.getDateConstraints)===null||t===void 0?void 0:t.call(r,o,s),d=r.constrainRectangle=r.getConstrainingRectangle(c,o,s),g=M.from(n,i.foregroundCanvas,!0),u=M.from(l,i.foregroundCanvas,!0);return d.translate(-u.x),super.setupConstraints(d,g,i.timeAxisViewModel.snapPixelAmount,!!c.start),a.push(n),{record:s,draggedEntities:[s],dateConstraints:c!=null&&c.start?c:null,eventBarEls:a,mainEventElement:l}}suspendRecordElementRedrawing(){}suspendElementRedrawing(){}getDateConstraints(e,t){let{minDate:r,maxDate:i}=super.getDateConstraints(e,t);return t.previousSegment&&(!r||r<t.previousSegment.endDate)&&(r=t.previousSegment.endDate),t.nextSegment&&(!i||i<t.nextSegment.startDate)&&(i=t.nextSegment.startDate),{start:r,end:i}}get tipId(){return`${this.client.id}-segment-drag-tip`}internalSnapToPosition(e){super.internalSnapToPosition(),this.client.rtl&&!this.dragData.eventRecord.nextSegment&&(e.x=0)}updateDragContext(e,t){super.updateDragContext(...arguments);const{client:r}=this,{dirty:i,eventRecord:n,endDate:s}=this.dragData;if(i&&!n.nextSegment){var o;const{enableEventAnimations:a}=r;r.enableEventAnimations=!1,n.event.set("endDate",s),(o=r.features.eventBuffer)!==null&&o!==void 0&&o.enabled&&(n.event.wrapEndDate=s),r.enableEventAnimations=a}}}y(H,"$name","EventSegmentDrag"),H._$name="EventSegmentDrag",S.registerFeature(H,!0,"SchedulerPro"),S.registerFeature(H,!1,"ResourceHistogram");const Ct={border:1,hollow:2};class x extends V.mixin(de,it){construct(e,t){super.construct(e,t),this.client.eventStore.tree=!0}refreshClient(){!this.client.isConfiguring&&this.client.refreshWithTransition()}doDisable(){this.refreshClient()}updateEventLayout(e){e==="stack"&&this.client.isVertical&&console.warn("Stacked nested events are not supported in vertical mode"),this.refreshClient()}updateBarMargin(){this.refreshClient()}updateResourceMargin(){this.refreshClient()}updateEventHeight(){this.refreshClient()}updateHeaderHeight(e){this.client.element.style.setProperty("--schedulerpro-nested-event-header-height",`${e}px`),this.refreshClient()}getEventLayout(e,t){return t?{type:this.eventLayout}:this.overridden.getEventLayout(e)}getResourceMargin(e,t){return t&&!t.isRoot?this.resourceMargin:this.overridden.getResourceMargin(e)}getBarMargin(e,t){return t&&!t.isRoot?this.barMargin:this.overridden.getBarMargin(e)}getAppliedResourceHeight(e,t){var i;const r=this;if(t&&!t.isRoot){if(r.eventLayout==="stack")return r.eventHeight+r.resourceMargin*2;{const n=(i=Ct[r.client.getEventStyle(t,e)])!=null?i:0;return r.currentParentsHeight-r.headerHeight-n}}return r.overridden.getAppliedResourceHeight(e)}getResourceWidth(e,t){return t&&!t.isRoot?this.currentParentsWidth-this.headerHeight:this.overridden.getResourceWidth(e)}attachToEventStore(e){e==null||e.ion({name:"eventStore",change:"onEventStoreChange",thisObj:this})}onEventStoreChange({records:e}){e!=null&&e.some(t=>t.parent&&!t.parent.isRoot)&&this.refreshClient()}onEventStoreBatchedUpdate({records:e}){if(this.client.listenToBatchedUpdates&&e!==null&&e!==void 0&&e.some(t=>t.parent&&!t.parent.isRoot))return this.refreshClient(),!1}beforeEventDragStart(e,t){const r=this,{client:i}=r,{eventRecord:n,assignmentRecords:s}=t,{parentElement:o}=e.element;if(n.parent&&o!==i.foregroundCanvas){r.isDraggingNestedEvent=!0,e.originalParentElement=o,e.originalBounds=[];for(const a of s){const{event:l}=a;if(l.parent===n.parent){const c=i.getElementFromAssignmentRecord(a,!0);if(e.originalBounds.push({element:c,bounds:M.from(c,o)}),!r.constrainDragToParent&&i.features.eventDrag.constrainDragToTimeline){const d=M.from(c,i.timeAxisSubGridElement);c.style.top=`${d.top}px`,c.style.left=`${d.left}px`,O.addChild(i.foregroundCanvas,c,a.id)}}}}else r.isDraggingNestedEvent=!1}afterEventDragStart(e,t){if(this.isDraggingNestedEvent&&this.constrainDragToParent){const{eventDrag:r}=this.client.features,{parent:i}=t.eventRecord,n=e.originalParentElement.getBoundingClientRect();r.setYConstraint(0,n.height-e.originalBounds[0].bounds.height),r.setXConstraint(0,n.width-e.originalBounds[0].bounds.width),t.dateConstraints={start:i.startDate,end:i.endDate}}}checkEventDragValidity({targetEventRecord:e,eventRecord:t,timeDiff:r,newResource:i,resourceRecord:n}){const s=this;if(s.isDraggingNestedEvent&&!s.allowDeNestingOnDrop&&!e&&(r||i!==n))return{valid:!1,message:s.L("L{deNestingNotAllowed}")};if(!s.allowNestingOnDrop&&e&&e!==t.parent)return{valid:!1,message:s.L("L{nestingNotAllowed}")}}processEventDrop({context:e,toScheduler:t,eventRecord:r,resourceRecord:i,reassignedFrom:n,element:s,eventsToAdd:o,addedEvents:a,draggedAssignment:l}){var c;const{parent:d}=r,{targetEventRecord:g}=e;let u=d;if(d!==g&&!this.constrainDragToParent&&!((c=r.children)!==null&&c!==void 0&&c.length)){if(g&&this.allowNestingOnDrop){u=g.parent.isRoot?g:g.parent;const h=this.client.resolveResourceRecord(e.browserEvent);h!==i&&(i=l.resource=h)}else u=t.eventStore.rootNode;u&&u!==d&&(a.push(u.appendChild(r)),b.remove(o,r))}if(d!=null&&d.isRoot&&r.isParent&&n&&n!==i)for(const h of r.children){const v=h.assignments.find(m=>m.resource===n);v&&(v.resource=i)}if(u&&!u.isRoot){const h=this.client.getElementFromEventRecord(u,i).syncIdMap.nestedEventsContainer,v=h&&M.from(s,h);h&&(s.style.top=`${v.top}px`,s.style.left=`${v.left}px`,s.lastDomConfig=null,O.addChild(h,s,s.dataset.syncId))}}processCrossSchedulerEventDrop({eventRecord:e}){if(e.isParent)for(const t of e.children)t.resource=e.resource}async afterEventDragAbortFinalized({originalParentElement:e,originalBounds:t}){if(this.isDraggingNestedEvent){for(const r of t[0].element.getAnimations())(r.transitionProperty==="top"||r.transitionProperty==="left")&&await r.finished;for(const{element:r,bounds:i}of t)r.style.top=`${i.top}px`,r.style.left=`${i.left}px`,e.appendChild(r)}}afterEventResizeStart(e){if(this.constrainResizeToParent){const{parent:t}=e.timespanRecord;if(t&&!t.isRoot){let{startDate:r,endDate:i}=t;e.dateConstraints&&(r=p.max(r,e.dateConstraints.start),i=p.min(i,e.dateConstraints.end)),e.dateConstraints={start:r,end:i}}}}getElementFromAssignmentRecord(e,t){var r;if(e!=null&&(r=e.event)!==null&&r!==void 0&&r.parent&&!e.event.parent.isRoot){const i=this.client.getElementFromEventRecord(e.event.parent,e.resource);return O.getChild(i,`nestedEventsContainer.${e.id}${t?"":".event"}`)}return this.overridden.getElementFromAssignmentRecord(e,t)}async scheduleEvent({eventRecord:e,parentEventRecord:t,startDate:r,element:i}){if(t){if(e.startDate=r,e=t.appendChild(e),e.assign(t.resource),i){const n=this.client.getElementFromEventRecord(t).syncIdMap.nestedEventsContainer,s=M.from(i,n);w.setTranslateXY(i,0,0),w.setTopLeft(i,s.y,s.x),O.addChild(n,i,e.assignments[0].id)}await this.client.project.commitAsync()}else return this.overridden.scheduleEvent(...arguments)}getEventsToRender(e,t){return this.disabled||b.remove(t,...t.filter(r=>r.isEventModel&&!r.parent.isRoot)),t}onEventDataGenerated({eventRecord:e,resourceRecord:t,wrapperCls:r,height:i,width:n,children:s,left:o,top:a}){if(e.isParent){r["b-nested-events-parent"]=1;const l=this;l.currentParentsHeight=i,l.currentParentsWidth=n;const{currentOrientation:c,isVertical:d}=l.client,g=e.children.filter(m=>{var E;return(E=m.$linkedResources)===null||E===void 0?void 0:E.includes(t)}),u=c.layoutEvents(t,g,!1,e,l.overlappingEventSorter),h=[];let v;if(d){v=[];for(const m of Object.values(u))v.push(m.renderData)}else v=u==null?void 0:u.eventsData;if(v)for(const m of v){d?(m.left-=o,m.top-=a,m.absoluteTop=m.top):(l.eventLayout==="none"?(m.top=0,m.height=l.getAppliedResourceHeight(t,e)):l.eventLayout==="stack"&&(m.height=l.eventHeight),m.left-=o,m.absoluteTop=m.top);const E=c.renderEvent(d?{renderData:m}:m,i);E.className["b-nested-event"]=1,h.push(E)}s.push({className:{"b-nested-events-container":1,[`b-nested-events-layout-${l.eventLayout}`]:1},dataset:{taskBarFeature:"nestedEventsContainer"},children:h,syncOptions:{syncIdField:"syncId",releaseThreshold:0}})}}}y(x,"$name","NestedEvents"),y(x,"configurable",{eventLayout:"pack",barMargin:5,resourceMargin:0,eventHeight:30,headerHeight:20,constrainDragToParent:!1,allowNestingOnDrop:!0,allowDeNestingOnDrop:!0,constrainResizeToParent:!0}),y(x,"pluginConfig",{before:["onEventStoreBatchedUpdate"],chain:["getEventsToRender","onEventDataGenerated","processEventDrop","processCrossSchedulerEventDrop","beforeEventDragStart","afterEventDragStart","afterEventDragAbortFinalized","checkEventDragValidity","afterEventResizeStart"],override:["getResourceMargin","getBarMargin","getAppliedResourceHeight","getResourceWidth","getEventLayout","getElementFromAssignmentRecord","scheduleEvent"]}),y(x,"delayable",{refreshClient:"raf"}),x._$name="NestedEvents",S.registerFeature(x,!1,"SchedulerPro");class B extends me{static get properties(){return{resourceMap:new Map}}construct(){var e;super.construct(...arguments),this.resourceTimeRangeModelClass=(e=class extends this.resourceTimeRangeModelClass{},y(e,"$name","ResourceNonWorkingTimeModel"),y(e,"domIdPrefix","resourcenonworkingtimemodel"),e),this.client.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e==null||e.ion({name:"resourceStore",changePreCommit:"onResourceChange",thisObj:this})}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e),e==null||e.ion({name:"calendarManagerStore",changePreCommit:"onCalendarChange",thisObj:this})}onTimeAxisReconfigure(){this.resourceMap.clear()}onResourceChange({action:e,records:t,record:r,changes:i}){const n=this;if(e==="update"){var s;const o=i.calendar;o&&(typeof o.oldValue!="string"||((s=o.value)===null||s===void 0?void 0:s.id)!==o.oldValue)&&(n.resourceMap.delete(r.id),n.client.runWithTransition(()=>{n.client.currentOrientation.refreshEventsForResource(r)}))}e==="remove"&&t.forEach(o=>n.resourceMap.delete(o.id)),e==="removeall"&&n.resourceMap.clear()}onCalendarChange({action:e,records:t,record:r,changes:i}){this.resourceMap.clear(),this.client.refresh()}getEventsToRender(e,t){const r=this,{resourceMap:i,client:n}=r,{timeAxis:s}=n,o=!r.maxTimeAxisUnit||p.compareUnits(s.unit,r.maxTimeAxisUnit)<=0;if(!r.disabled&&o&&e.effectiveCalendar){if(!i.has(e.id)){const a=e.effectiveCalendar.getNonWorkingTimeRanges(n.startDate,n.endDate),l=a.map((c,d)=>new r.resourceTimeRangeModelClass({id:`r${e.id}i${d}`,iconCls:c.iconCls||e.effectiveCalendar.iconCls||"",cls:`${e.effectiveCalendar.cls||""} ${c.cls||""}`,startDate:c.startDate,endDate:c.endDate,name:c.name||"",resourceId:e.id,isNonWorking:!0}));i.set(e.id,l)}t.push(...i.get(e.id))}return t}shouldInclude({isNonWorking:e}){return e}resolveResourceNonWorkingTimeInterval(e){var t;return e==null||(t=e.closest(".b-sch-resourcenonworkingtime"))===null||t===void 0?void 0:t.elementData.eventRecord}}y(B,"$name","ResourceNonWorkingTime"),y(B,"configurable",{rangeCls:"b-sch-resourcenonworkingtime",maxTimeAxisUnit:"hour",enableMouseEvents:!1,resourceTimeRangeModelClass:ae,entityName:"resourceNonWorkingTime"}),B.featureClass="",B._$name="ResourceNonWorkingTime",S.registerFeature(B,!1,"SchedulerPro");const Et={isHighlightConfig:!0,clearExisting:!1};class X extends V{constructor(){super(...arguments);y(this,"domConfigs",[]);y(this,"configs",[])}static get $name(){return"TimeSpanHighlight"}static get configurable(){return{padding:0}}static get pluginConfig(){return{assign:["highlightTimeSpan","highlightTimeSpans","unhighlightTimeSpans"],chain:["onTimeAxisViewModelUpdate"]}}construct(){super.construct(...arguments),this.client.rowManager.ion({renderDone:this.onViewChanged,thisObj:this})}highlightTimeSpan(t,r=!0){const i=this,{startDate:n,endDate:s,name:o,surround:a,padding:l=i.padding,clearExisting:c=!0}=t,{client:d}=i,g=t.isTimeSpan?t:t.taskRecord;let u=t.resourceRecord||t.resource;const{animationId:h}=t;if(h&&w.addTemporaryClass(d.element,"b-transition-highlight",500,d),c&&(i.domConfigs.length=i.configs.length=0),i.disabled)return;if(a){i.surroundTimeSpan(t);return}i.configs.push(t);let v;d.isGanttBase?v=d.getScheduleRegion(g,!0,{start:n,end:s}):(u&&(u=d.store.getById(u)),v=d.getScheduleRegion(u,null,!0,{start:n,end:s},!u)),v&&(l&&(d.isHorizontal?v.inflate(l,0,l,0):v.inflate(0,l,0,l)),i.domConfigs.push(v.visualize({children:[{class:"b-sch-highlighted-range-name",html:o}],dataset:{syncId:h},class:{"b-sch-highlighted-range":1,[t.cls]:t.cls,[t.class||"b-sch-highlighted-range-default"]:1}},!0)),r&&i.draw())}draw(){O.sync({targetElement:this.containerEl,domConfig:{onlyChildren:!0,children:this.domConfigs}})}surroundTimeSpan(t){this.highlightTimeSpans([Object.assign({},t,{animationId:(t.animationId||"")+"Before",class:"b-unavailable",surround:!1,startDate:this.client.startDate,endDate:t.startDate}),Object.assign({},t,{animationId:(t.animationId||"")+"After",class:"b-unavailable",surround:!1,startDate:t.endDate,endDate:this.client.endDate})],{clearExisting:t.clearExisting})}highlightTimeSpans(t,r={}){const i=this,{clearExisting:n=!0}=r;n&&(t=t.slice(),i.domConfigs.length=i.configs.length=0),!i.disabled&&(t.forEach(s=>{i.highlightTimeSpan(s.isHighlightConfig?s:Object.setPrototypeOf(Et,s),!1)}),i.draw())}async unhighlightTimeSpans(t=!1){const r=this,{client:i}=r;t&&w.addTemporaryClass(i.element,"b-transition-highlight",500,i),Array.from(r.containerEl.children).forEach(n=>{t?(n.style.opacity=0,r.fadeOutDetacher=nt.onTransitionEnd({element:n,property:"opacity",thisObj:i,handler:()=>{r.domConfigs.length=r.configs.length=0,r.draw()}})):(r.domConfigs.length=r.configs.length=0,r.draw())})}get containerEl(){return this._containerEl||(this._containerEl=w.createElement({parent:this.client.foregroundCanvas,retainElement:!0,class:"b-sch-highlight-container"})),this._containerEl}onTimeAxisViewModelUpdate(){this.onViewChanged()}onViewChanged(){this.configs.length>0&&this.highlightTimeSpans(this.configs)}updateDisabled(t,r){t&&this.unhighlightTimeSpans(),super.updateDisabled(t,r)}get featureClass(){}}X._$name="TimeSpanHighlight",S.registerFeature(X,!1,["SchedulerPro","Gantt"]);class Z{constructor({property:e,before:t,after:r}){Object.assign(this,{property:e,before:t,after:r}),Object.freeze(this)}}y(Z,"$name","ChangeLogPropertyUpdate"),Z._$name="ChangeLogPropertyUpdate";class K extends Ae(Be(Je(oe))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:Ie,dependencyModelClass:Oe,eventModelClass:k,assignmentModelClass:ke,resourceModelClass:He,calendarManagerStoreClass:Le,dependencyStoreClass:je,eventStoreClass:F,assignmentStoreClass:Ue,resourceStoreClass:Fe,calendarsData:null,supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/schedulerpro/docs/api/SchedulerPro/model/ProjectModel#config-supportShortSyncResponse)',delayCalculation:!0,calendarManagerStore:{},stmClass:_e}}static get configurable(){return{calendars:null}}get taskStore(){return this.eventStore}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}}K._$name="ProjectModel";var ye=f=>class extends(f||ge){static get $name(){return"SchedulerProEventRendering"}static get configurable(){return{eventLayout:"stack",horizontalLayoutPackClass:N,horizontalLayoutStackClass:z}}updateInternalEventLayout(t,r){const i=this;i.isConfiguring||i.clearLayouts(),super.updateInternalEventLayout(t,r)}getEventLayout(t){return t=super.getEventLayout(t),"layoutFn"in t&&(t.type="layoutFn"),t}clearLayouts(){const t=this;if(t.layouts)for(const r in t.layouts)t.layouts[r].destroy(),delete t.layouts[r]}getEventLayoutHandler(t){const r=this;if(!r.isHorizontal)return null;const{timeAxisViewModel:i,horizontal:n}=r;r.layouts||(r.layouts={});const{layouts:s}=r;switch(t.type){case"stack":return s.horizontalStack||(s.horizontalStack=r.horizontalLayoutStackClass.new({scheduler:r,timeAxisViewModel:i,bandIndexToPxConvertFn:n.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:n,groupByThisObj:r},t)),s.horizontalStack;case"pack":return s.horizontalPack||(s.horizontalPack=r.horizontalLayoutPackClass.new({scheduler:r,timeAxisViewModel:i,bandIndexToPxConvertFn:n.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:n,groupByThisObj:r},t)),s.horizontalPack;case"layoutFn":return{type:"layoutFn",scheduler:r,applyLayout:t.layoutFn,layoutEventsInBands:t.layoutFn};default:return null}}get widgetClass(){}};class J extends gt{fillInnerSpanHorizontalPosition(e){const t=this,{eventRecord:r}=e,{startMS:i,endMS:n,durationMS:s}=t.calculateMS(r,"startDate","endDate"),o=t.calculateHorizontalPosition(e,i,n,s);if(o){const{left:a,width:l}=o;return Object.assign(e,{innerStartMS:i,innerEndMS:n,innerDurationMS:s,bufferBeforeWidth:Math.max(a-e.left,0),bufferAfterWidth:Math.max(Math.floor(e.left+e.width-a-l),0)}),!0}else return!1}getTimeSpanRenderData(e,t,r=!1){const i=super.getTimeSpanRenderData(e,t,r);return i!=null&&i.useEventBuffer&&!this.fillInnerSpanHorizontalPosition(i)?null:i}}y(J,"$name","ProHorizontalRendering"),J._$name="ProHorizontalRendering";class ee extends ht{fillInnerSpanVerticalPosition(e){const t=this,{scheduler:r}=t,{eventRecord:i}=e,{isBatchUpdating:n}=i,s=n?i.get("startDate"):i.startDate,o=n?i.get("endDate"):i.endDate,a=r.getCoordinateFromDate(s),l=s.getTime(),c=o.getTime(),d=c-l;let g=r.getCoordinateFromDate(o),u=g-a;return g===-1&&(u=Math.round(d*r.timeAxisViewModel.getSingleUnitInPixels("millisecond")),g=a+u),Object.assign(e,{innerStartMS:l,innerEndMS:c,innerDurationMS:d,bufferBeforeWidth:a-e.top,bufferAfterWidth:e.top+e.height-a-u}),!0}getTimeSpanRenderData(e,t,r=!1){const i=super.getTimeSpanRenderData(e,t,r);return i!=null&&i.useEventBuffer&&!this.fillInnerSpanVerticalPosition(i)?null:i}}y(ee,"$name","ProVerticalRendering"),ee._$name="ProVerticalRendering";class L extends pe.mixin(Ve,We,ye){static get $name(){return"SchedulerProBase"}static get type(){return"schedulerprobase"}static get configurable(){return{projectModelClass:K,dependencyIdField:"id"}}static get isSchedulerPro(){return!0}onPaintOverride(){}set calendars(e){this.project.calendars=e}get calendars(){return this.project.calendars}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),e==="horizontal"?(t.horizontal=new J(t),t.isPainted&&t.horizontal.init()):e==="vertical"&&(t.vertical=new ee(t),t.rendered&&t.vertical.init()))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&w.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get taskStore(){return this.project.eventStore}createEvent(e,t,r){if(t.isWorkingTime(e))if(this.taskEdit&&this.taskEdit.isEditing)this.ion({aftertaskedit:()=>super.createEvent(e,t,r),once:!0});else return super.createEvent(e,t,r)}}L.initClass(),st.setVersion("schedulerpro","5.3.7"),L._$name="SchedulerProBase";const bt=()=>{};class P extends L{static get properties(){return{allocationReportByRecord:new Map,allocationDataByRecord:new Map,allocationObserverByRecord:new Map,resourceGroupsToUpdate:new Set,resourceGroupsAllocation:new Map}}construct(e){super.construct(e);const t=this;t.scheduleRefreshRows=t.createOnFrame(t.refreshRows,[],t,!0),t.horizontal.refreshResourcesWhenReady=t.horizontal.onAssignmentStoreChange=t.horizontal.renderer=function(){},t.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",renderRow:"onRowManagerRenderRow",thisObj:t})}get timeAxis(){return super.timeAxis}set timeAxis(e){const t=this._timeAxis;super.timeAxis=e,!(this.partner&&!e||t&&t===e)&&this._timeAxis.ion({name:"timeAxis",endReconfigure:"onTimeAxisEndReconfigure",thisObj:this})}async onRowManagerRenderRow({record:e}){if(e.isSpecialRow){const t=this;if(t.project.isDelayingCalculation&&(await t.project.commitAsync(),t.isDestroyed))return;t.renderGroupHistogram(e),t.renderGroupScale(e)}}onDestroy(){var e,t;const r=this;for(const[o,a]of(i=r.allocationObserverByRecord)===null||i===void 0?void 0:i.entries()){var i;o.removeObserver&&(o.removeObserver(a),r.allocationObserverByRecord.delete(o))}for(const[o,a]of(n=r.allocationReportByRecord)===null||n===void 0?void 0:n.entries()){var n;if(o.removeEntity){var s;(s=o.removeEntity)===null||s===void 0||s.call(o,a),r.allocationReportByRecord.delete(a)}}r.allocationDataByRecord.clear(),(e=r._histogramWidget)===null||e===void 0||e.destroy(),(t=r._groupHistogramWidget)===null||t===void 0||t.destroy(),r.barTooltip=null}updateProject(e){this.detachListeners("resourceHistogramProject"),e.ion({name:"resourceHistogramProject",refresh:"internalOnProjectRefresh",delayCalculationStart:"onProjectDelayCalculationStart",delayCalculationEnd:"onProjectDelayCalculationEnd",repopulateReplica:"onRepopulateReplica",thisObj:this}),this.store=e.resourceStore}scheduleRefreshRows(){}getEventsToRender(){}getRowHeight(){return this.rowHeight}convertEffortUnit(e,t,r){return this.project.run("$convertDuration",e,t,r)}updateUseProjectTimeUnitsForScale(){const e=this;if(e.isPainted){const t={scalePoints:e.generateScalePoints()};e.trigger("generateScalePoints",t),e._generatedScalePoints=e.scalePoints=t.scalePoints,e.scheduleRefreshRows()}}get eventStore(){var e;return(e=this.project)===null||e===void 0?void 0:e.eventStore}set eventStore(e){super.eventStore=e}get scaleColumn(){return this.columns.query(e=>e.isScaleColumn)[0]}get scalePoints(){return this._scalePoints}set scalePoints(e){const{histogramWidget:t,scaleColumn:r}=this,i=e[e.length-1],{value:n,unit:s}=i;this.scaleUnit=s,this._scalePoints=e;let o=n;if(r){const{scaleWidget:a}=r;o+=a.scaleMaxPadding*n}t.topValue=this.useProjectTimeUnitsForScale?this.convertEffortUnit(o,s,C.Millisecond):p.asMilliseconds(o,s),r&&(r.scalePoints=e)}buildScalePointText(e){return`${e.value}${p.getShortNameOfUnit(e.unit)}`}generateScalePoints(e,t){var r;if(!((r=this.project)!==null&&r!==void 0&&r.graph))return;const{timeAxis:i}=this,n=[];e=e||i.increment,t=t||i.unit;let s;e===1&&(t=p.getSmallerUnit(t),e=Math.round(this.useProjectTimeUnitsForScale?this.convertEffortUnit(e,i.unit,t):p.as(t,e,i.unit)));for(const a of[7,5,4,3,2])if(!(e%a)){s=e/a;break}s||(s=e);for(let a=s;a<=e;a+=s)n.push({value:a});const o=n[n.length-1];return o.unit=t,o.text=this.buildScalePointText(o),n}updateViewPreset(e){const t=this;t._updatingViewPreset=!0,super.updateViewPreset(...arguments),t._updatingViewPreset=!1,t.project.isInitialCommitPerformed&&t.isPainted&&t.onTimeAxisEndReconfigure()}onPaint({firstPaint:e}){super.onPaint({firstPaint:e}),e&&this.showBarTip&&(this.barTooltip={})}updateGetBarTip(e){return e&&(this.barTooltipTemplate=null),e}changeBarTooltip(e,t){return t==null||t.destroy(),e?e.isTooltip?e:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,e):null}onRepopulateReplica(){this.ticksIdentifier=null,this.allocationReportByRecord.clear(),this.allocationDataByRecord.clear(),this.allocationObserverByRecord.clear()}getTipHtml(e){var t;const{activeTarget:r}=e,i=r.dataset.index,n=this.getRecordFromElement(r),s=this.allocationDataByRecord.get(n);return e=Object.assign({},e),e.index=parseInt(i,10),e.datum=s[e.index],(t=this.barTooltipTemplate)===null||t===void 0?void 0:t.call(this,e)}buildTicksIdentifier(){const e=this,t=e.project.getGraph();return e.ticksIdentifier||(e.ticksIdentifier=t.addIdentifier($e.new())),e.ticksIdentifier.writeToGraph(t,new Ge({unspecifiedTimeIsWorking:!1,intervals:e.timeAxis.ticks.map(r=>({startDate:r.startDate,endDate:r.endDate,isWorking:!0}))})),e.collectTicksWidth(),e.ticksIdentifier}collectTicksWidth(){const{ticks:e}=this.timeAxis,t=e[0].endDate-e[0].startDate,r={0:t};let i=t,n=!0;for(let s=1,{length:o}=e;s<o;s++){const a=e[s],l=a.endDate-a.startDate;t!==l&&(n=!1),i+=l,r[s]=l}if(n)this.ticksWidth=null;else{const s={};for(let o=0,{length:a}=e;o<a;o++)s[o]=r[o]/i;this.ticksWidth=s}}onProjectDelayCalculationStart(){this.suspendRefresh()}onProjectDelayCalculationEnd(){this.resumeRefresh(!0)}projectUnitsHasChanged(){const{project:e}=this;return e.daysPerMonth!==this._projectDaysPerMonth||e.daysPerWeek!==this._projectDaysPerWeek||e.hoursPerDay!==this._projectHoursPerDay}internalOnProjectRefresh({source:e,isCalculated:t}){if(t){const r=this;if(r.ticksIdentifier||r.onTimeAxisEndReconfigure(),r.useProjectTimeUnitsForScale&&r.projectUnitsHasChanged()){r._projectDaysPerMonth=e.daysPerMonth,r._projectDaysPerWeek=e.daysPerWeek,r._projectHoursPerDay=e.hoursPerDay;const i={scalePoints:r.generateScalePoints()};r.trigger("generateScalePoints",i),r._generatedScalePoints=r.scalePoints=i.scalePoints}}}relayStoreDataChange(e){super.relayStoreDataChange(e),this.store.count===0&&(this.histogramWidget.data=[],this.histogramWidget.refresh())}get columns(){return super.columns}set columns(e){const t=this;super.columns=e,t.isDestroying||(t.timeAxisColumn.renderer=t.renderResourceHistogram,t.timeAxisColumn.cellCls=t.timeAxisColumnCellCls,e.some(r=>r.type==="scale")||t.insertScaleColumn())}insertScaleColumn(){this.columns.rootNode.insertChild({type:"scale"},this.timeAxisColumn)}buildHistogramWidget(e){var t;const r=this;r.getBarTextRenderData&&!e.getBarTextRenderData&&(e.getBarTextRenderData=r.getBarTextRenderData);const i=r.histogramWidgetClass.new({owner:r,appendTo:r.element,cls:"b-hide-offscreen b-resourcehistogram-histogram",height:r.rowHeight,width:((t=r.timeAxisColumn)===null||t===void 0?void 0:t.width)||0,omitZeroHeightBars:!0,data:[],getBarTip:!r.barTooltipTemplate&&r.getBarTip||bt,getRectClass:r.getRectClass||r.getRectClassDefault,getBarText:r.getBarText||r.getBarTextDefault,series:r.series},r.histogramWidgetConfig,e);return r.getBarTextDefault.bind(i),i}get histogramWidget(){const e=this;if(!e._histogramWidget){const t=e.series;!e.showMaxEffort&&t.maxEffort&&(t.maxEffort=!1),e._histogramWidget=e.buildHistogramWidget()}return e._histogramWidget}getRectClassDefault(e,t,r){if(e.id==="effort")switch(!0){case r.isOverallocated:return"b-overallocated";case r.isUnderallocated:return"b-underallocated"}return""}get effortFormatter(){const e=this,t=e.effortFormat;let r=e._effortFormatter;return(!r||e._effortFormat!==t)&&(r=ft.get(e._lastFormat=t),e._effortFormatter=r),r}getEffortText(e,t,r=this.showEffortUnit){var i;if(!((i=this.project)!==null&&i!==void 0&&i.graph))return;const{scaleUnit:n,effortFormatter:s}=this;t=t||n;const o=p.getShortNameOfUnit(t),a=this.convertEffortUnit(e,C.Millisecond,t);return s.format(a)+(r?o:"")}getBarTipEffortUnit(){const{effortUnit:e,barTipEffortUnit:t,timeAxis:r}=this,i=t||e;return p.compareUnits(r.unit,i)<0?r.unit:i}getGroupBarTip({datum:e}){const t=this,{showBarTip:r,timeAxis:i}=t;let n="";if(r&&e.effort){const s=t.getBarTipEffortUnit(...arguments),o=t.getEffortText(e.effort,s),a=t.getEffortText(e.maxEffort,s),l=t.L("L{groupBarTipAssignment}");let c="L",d=t.L("L{groupBarTipInRange}"),g="";p.compareUnits(i.unit,C.Day)===0?d=t.L("L{groupBarTipOnDate}"):p.compareUnits(i.unit,C.Second)<=0?c="HH:mm:ss A":p.compareUnits(i.unit,C.Hour)<=0&&(c="LT");let u=[...e.resourceAllocation.entries()].filter(([v,m])=>m.effort).sort(([v,m],[E,I])=>m.effort>I.effort?-1:1);u.length>t.groupBarTipAssignmentLimit&&(g="<br>"+t.L("L{plusMore}").replace("{value}",u.length-t.groupBarTipAssignmentLimit),u=u.slice(0,this.groupBarTipAssignmentLimit));const h=u.map(([v,m])=>l.replace("{resource}",A.encodeHtml(v.name)).replace("{allocated}",t.getEffortText(m.effort,s)).replace("{available}",t.getEffortText(m.maxEffort,s)).replace("{cls}",m.isOverallocated?"b-overallocated":m.isUnderallocated?"b-underallocated":"")).join("<br>")+g;n=d.replace("{assignments}",h).replace("{startDate}",p.format(e.tick.startDate,c)).replace("{endDate}",p.format(e.tick.endDate,c)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getResourceBarTip({datum:e}){const t=this,{showBarTip:r,timeAxis:i}=t;let n="";if(r&&e.effort){const s=t.getBarTipEffortUnit(),o=t.getEffortText(e.effort,s),a=t.getEffortText(e.maxEffort,s);let l="L",c=t.L("L{barTipInRange}");p.compareUnits(i.unit,C.Day)===0?c=t.L("L{barTipOnDate}"):p.compareUnits(i.unit,C.Second)<=0?l="HH:mm:ss A":p.compareUnits(i.unit,C.Hour)<=0&&(l="LT"),n=c.replace("{startDate}",p.format(e.tick.startDate,l)).replace("{endDate}",p.format(e.tick.endDate,l)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),e.resource&&(n=n.replace("{resource}",A.encodeHtml(e.resource.name))),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getBarTextEffortUnit(){const{effortUnit:e,barTextEffortUnit:t,timeAxis:r}=this,i=t||e;return p.compareUnits(r.unit,i)<0?r.unit:i}getBarTextDefault(e,t){const{showBarText:r}=this.owner;let i="";if(r&&e.effort){const n=this.owner.getBarTextEffortUnit();i=this.owner.getEffortText(e.effort,n)}return i}updateShowBarText(e){this.scheduleRefreshRows()}updateShowBarTip(e){this.barTooltip=e}updateShowMaxEffort(e){const t=this;t._showMaxEffort=e;let r=!1;[t._histogramWidget,t._groupHistogramWidget].forEach(i=>{if(!i)return;const{series:n}=i;e?typeof e=="object"?n.maxEffort=e:typeof i._seriesMaxEffort=="object"?n.maxEffort=i._seriesMaxEffort:(n.maxEffort={type:"outline",field:"maxEffort"},n.maxEffort.id="maxEffort"):n.maxEffort&&(i._seriesMaxEffort=n.maxEffort,delete n.maxEffort),r=!0}),r&&t.scheduleRefreshRows()}updateIncludeInactiveEvents(e){this.allocationReportByRecord.forEach(t=>t.includeInactiveEvents=e)}onTimeAxisEndReconfigureInternal(){const e=this;if(!e._updatingViewPreset){const{unit:t,increment:r}=e.timeAxis;if(t!==e._lastTimeAxisUnit||r!==e._lastTimeAxisIncrement){e._lastTimeAxisUnit=t,e._lastTimeAxisIncrement=r;const i=e.generateScalePoints(),n={scalePoints:i};e.trigger("generateScalePoints",n),e._generatedScalePoints=e.scalePoints=n.scalePoints}e.buildTicksIdentifier()}}onTimeAxisEndReconfigure(){const e=this;e._updatingViewPreset||(e.project.graph?e.onTimeAxisEndReconfigureInternal():e.project.ion({graphReady(){e.onTimeAxisEndReconfigureInternal()},thisObj:e,once:!0}))}onBeforeRowHeight({height:e}){if(this._timeAxisColumn)for(const t of[this._histogramWidget,this._groupHistogramWidget])t&&(t.height=e,t.onElementResize(t.element))}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(...arguments);for(const e of[this._histogramWidget,this._groupHistogramWidget])e&&(e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element))}getRecordAllocationInfoRenderData(e,t,r,i=null){if(t=Array.isArray(t)?t:t.total,this.ticksWidth)for(let n=0,{length:s}=t;n<s;n++)t[n].width=this.ticksWidth[n];return t}renderRecordAllocationInfo(e,t,r,i=null){i=i||this.histogramWidget;const n=this.getRecordAllocationInfoRenderData(e,t,r,i);if(!n)return;this.allocationDataByRecord.set(e,n),i.data=n,i.refresh();const s=i.element.cloneNode(!0);s.removeAttribute("id"),s.classList.remove("b-hide-offscreen"),r.innerHTML="",r.appendChild(s)}renderRows(){const e=this;return!e.ticksIdentifier&&e.project.isInitialCommitPerformed&&(e.onTimeAxisEndReconfigure(),(!e.timeView.startDate||!e.timeView.endDate)&&(e.timeView.range={startDate:e.startDate,endDate:e.endDate})),super.renderRows(...arguments)}onRecordAllocationCalculated(e,t,r){const i=this;if(!i.isDestroying){const n=i.getCell({record:e,columnId:i.timeAxisColumn.id});n&&i.renderRecordAllocationInfo(e,t,n),i.trigger("allocationChange",{record:e,allocation:t});const s=i.getResourceGroupParent(e);s&&(i.resourceGroupsAllocation.delete(s),i.scheduleGroupRender(s))}}buildResourceAllocationReport(e){return this.project.resourceAllocationInfoClass.new({includeInactiveEvents:this.includeInactiveEvents,ticks:this.ticksIdentifier,resource:e})}registerRecordAllocationReport(e){const t=this,r=t.project.getGraph(),i=t.buildResourceAllocationReport(e);t.allocationReportByRecord.set(e,i),e.addEntity(i);const n=r.observe(function*(){return yield i.$.allocation},s=>t.onRecordAllocationCalculated(e,s,i));return t.allocationObserverByRecord.set(e,n),e.addObserver(n),i}renderResourceHistogram({grid:e,cellElement:t,record:r}){const{project:i}=e;if(e.ticksIdentifier&&i.isInitialCommitPerformed&&!r.isSpecialRow){var n;const{allocationReportByRecord:s,allocationObserverByRecord:o}=e;let a=s.get(r);if(a||(a=e.registerRecordAllocationReport(r)),(n=a)!==null&&n!==void 0&&n.allocation){a.graph?e.renderRecordAllocationInfo(r,a.allocation,t):(s.delete(r),e.allocationDataByRecord.delete(r),o.delete(r));const l=e.getResourceGroupParent(r);l&&e.store.includes(l)&&e.scheduleGroupRender(l)}}}renderScheduledGroups(){for(const e of Array.from(this.resourceGroupsToUpdate))this.renderGroupHistogram(e);this.clearTimeout(this.renderScheduledGroupTimer)}scheduleGroupRender(e){this.resourceGroupsToUpdate.add(e),this.renderScheduledGroupTimer=this.setTimeout({fn:"renderScheduledGroups",delay:10,cancelOutstanding:!0})}getResourceGroupParent(e){const t=e.instanceMeta(this.project.resourceStore.id);return t==null?void 0:t.groupParent}calculateResourceGroupAllocation(e){var t,r;const i=this,{allocationReportByRecord:n}=i,{groupChildren:s}=e,o=s.map(c=>n.get(c)),a=(t=o[0])===null||t===void 0||(r=t.allocation)===null||r===void 0?void 0:r.total,l=a==null?void 0:a.length;if(a&&o.every(c=>(c==null?void 0:c.allocation)&&c.allocation.total.length===l)){const c=[];return o.forEach(({allocation:d})=>{d.total.forEach((g,u)=>{let h=c[u];h||(h=c[u]={tick:g.tick,effort:0,maxEffort:0,units:0,isGroup:!0,resourceAllocation:new Map}),h.resourceAllocation.set(g.resource,{effort:g.effort,maxEffort:g.maxEffort,units:g.units,isOverallocated:g.effort>g.maxEffort,isUnderallocated:g.effort<g.maxEffort}),h.isOverallocated=h.isOverallocated||g.isOverallocated,h.isUnderallocated=h.isUnderallocated||g.isUnderallocated,h.effort+=g.effort,h.maxEffort+=g.maxEffort,g.assignments&&(h.assignments?g.assignments.forEach(v=>h.assignments.add(v)):h.assignments=new Set(g.assignments))})}),c}}renderGroupHistogram(e){const t=this;t.resourceGroupsToUpdate.delete(e),t.store.includes(e)||t.resourceGroupsAllocation.delete(e);const r=t.resourceGroupsAllocation.get(e)||t.calculateResourceGroupAllocation(e);if(r){var i;t.resourceGroupsAllocation.set(e,r);const{groupChildren:n}=e;let s=t.generateScalePoints(t.timeAxis.increment*n.length);const o={scalePoints:s,groupParent:e,isCalculatingTopValue:!0};t.trigger("generateScalePoints",o),s=o.scalePoints;const a=s[s.length-1],l=t.useProjectTimeUnitsForScale?t.convertEffortUnit(a.value,a.unit,C.Millisecond):p.asMilliseconds(a.value,a.unit),c=l+(((i=t.scaleColumn)===null||i===void 0?void 0:i.scaleWidget.scaleMaxPadding)||0)*l,d=t._groupHistogramWidget||t.buildHistogramWidget({topValue:c}),g=t.getCell({id:e.id,columnId:t.timeAxisColumn.id});t._groupHistogramWidget?d.topValue=c:t._groupHistogramWidget=d,g&&(t.renderRecordAllocationInfo(e,r,g,d),t.trigger("groupRendered",{groupParent:e}))}else t.store.includes(e)&&t.scheduleGroupRender(e)}renderGroupScale(e){const t=this,{scaleColumn:r}=t;if(r){const{groupChildren:i}=e,n=t.generateScalePoints(t.timeAxis.increment*i.length),s=t.getCell({id:e.id,columnId:r.id}),o={scalePoints:n,groupParent:e};if(!s)return;let a=t._groupScaleWidget;return a||(a=t._groupScaleWidget=r.buildScaleWidget()),t.trigger("generateScalePoints",o),a.scalePoints=o.scalePoints,r.renderer({cellElement:s,scaleWidget:a})}}updateLocalization(){const e=this;e._generatedScalePoints===e.scalePoints&&e.scalePoints&&e.scalePoints.forEach(t=>{t.text&&t.unit&&(t.text=e.buildScalePointText(t))}),super.updateLocalization(...arguments)}}y(P,"$name","ResourceHistogram"),y(P,"type","resourcehistogram"),y(P,"configurable",{sortFeatureStore:"store",timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourcehistogram-cell",effortFormat:"0.#",showEffortUnit:!0,rowHeight:50,useProjectTimeUnitsForScale:!1,effortUnit:C.Hour,barTextEffortUnit:null,barTipEffortUnit:null,showMaxEffort:!0,showBarText:!1,showBarTip:!1,barTooltip:null,barTooltipClass:he,series:{maxEffort:{type:"outline",field:"maxEffort"},effort:{type:"bar",field:"effort"}},getRectClass:null,createEventOnDblClick:!1,readOnly:!0,getBarTip:null,barTooltipTemplate({datum:e}){let t="";const{effort:r,isGroup:i}=e;return r&&(i?t=this.getGroupBarTip(...arguments):t=this.getResourceBarTip(...arguments)),t},getBarText:null,getBarTextRenderData:void 0,groupBarTipAssignmentLimit:5,histogramWidgetClass:rt,histogramWidgetConfig:null,includeInactiveEvents:!1,fixedRowHeight:!0}),P.initClass(),P._$name="ResourceHistogram";class j extends ot{construct(e,...t){this._childrenIndex=new Map,e.origin&&Object.assign(e,this.mapOriginValues(e.origin)),super.construct(e,...t),this.origin&&this.fillChildren()}mapOriginValues(e){const t={};if(e.isResourceModel)t.name=e.name;else if(e.isAssignmentModel){var r,i;t.name=(r=e.event)===null||r===void 0?void 0:r.name,t.iconCls=(i=e.event)===null||i===void 0?void 0:i.iconCls}return t}fillChildren(){var e;const t=this,{children:r}=t,i=new Set(r),n=[];if((e=t.origin)!==null&&e!==void 0&&e.isResourceModel){const{assigned:s}=t.origin;for(const o of s)t._childrenIndex.has(o)?i.delete(t._childrenIndex.get(o)):n.push(t.constructor.new({origin:o}))}i.size&&this.removeChild([...i]),n.length&&this.appendChild(n)}afterRemoveChild(e){e.forEach(t=>this._childrenIndex.delete(t.origin))}insertChild(...e){let t=super.insertChild(...e);if(t){var r;const{stores:i}=this;if(Array.isArray(t)||(t=[t]),(r=this.origin)!==null&&r!==void 0&&r.isResourceModel)for(const n of t)n.origin&&!this._childrenIndex.has(n.origin)&&this._childrenIndex.set(n.origin,n);if(i!=null&&i.length)for(const n of i)for(const s of t)s.traverse(o=>n.setModelByOrigin(o.origin,o))}return t}getChildByOrigin(e){return this._childrenIndex.get(e)}}y(j,"$name","ResourceUtilizationModel"),y(j,"fields",["name","iconCls"]),j.exposeProperties(),j._$name="ResourceUtilizationModel";class te extends et.derive(ue){static get properties(){return{_modelByOrigin:new Map}}updateProject(e){this.setResourceStore(e==null?void 0:e.resourceStore),this.setAssignmentStore(e==null?void 0:e.assignmentStore),this.setEventStore(e==null?void 0:e.eventStore),this.fillStoreFromProject()}setResourceStore(e){this.detachListeners("resourceStore"),e==null||e.ion({name:"resourceStore",change:this.onResourceStoreDataChanged,thisObj:this})}setEventStore(e){this.detachListeners("eventStore"),e==null||e.ion({name:"eventStore",update:this.onEventUpdate,thisObj:this})}setAssignmentStore(e){this.detachListeners("assignmentStore"),e==null||e.ion({name:"assignmentStore",change:this.onAssignmentsChange,refresh:this.onAssignmentsRefresh,add:this.onAssignmentsAdd,update:this.onAssignmentUpdate,remove:this.onAssignmentsRemove,thisObj:this})}onResourceStoreDataChanged(e){e.isMove&&e.action==="remove"||this.fillStoreFromProject()}onAssignmentsChange(){this.forEach(e=>e.fillChildren())}onAssignmentsRefresh(e){e.action==="batch"&&this.forEach(t=>t.fillChildren())}onAssignmentsAdd({records:e}){e.forEach(t=>{const r=this.getModelByOrigin(t==null?void 0:t.resource);r==null||r.fillChildren()})}onAssignmentUpdate({record:e,changes:t}){if("resource"in t){const r=this.getModelByOrigin(e),i=this.getModelByOrigin(e==null?void 0:e.resource);r&&i&&i.appendChild(r)}}onAssignmentsRemove({records:e}){this.remove(e.map(t=>this.getModelByOrigin(t)))}onEventUpdate({record:e,changes:t}){if("name"in t)for(const r of e.assigned)this.getModelByOrigin(r).set("name",e.name)}fillStoreFromProject(){var e;const t=[];(e=this._project)===null||e===void 0||e.resourceStore.forEach(r=>{r.isSpecialRow||t.push(this.modelClass.new({origin:r}))}),this.removeAll(),this.add(t),this.trigger("fillFromProject")}remove(){const e=super.remove(...arguments);return e==null||e.forEach(t=>{this._modelByOrigin.delete(t.origin)}),e}removeAll(){super.removeAll(...arguments),this._modelByOrigin.clear()}getModelByOrigin(e){return this._modelByOrigin.get(e)}setModelByOrigin(e,t){return this._modelByOrigin.set(e,t)}}y(te,"configurable",{modelClass:j,project:null,tree:!0}),te._$name="ResourceUtilizationStore";const ne=class extends P{updateProject(e){super.updateProject(e),this.store=this.buildStore(e)}buildStore(e){return te.new({project:e})}insertScaleColumn(){}getTipHtml({activeTarget:e}){const t=e.dataset.index,r=this.getRecordFromElement(e),i=this.allocationDataByRecord.get(r.origin),n=i[parseInt(t,10)];return this.barTooltipTemplate(n)}registerRecordAllocationReport(e){if(e.isResourceModel)return super.registerRecordAllocationReport(e);if(e.isAssignmentModel)return this.registerAssignmentAllocationReport(e)}onDestroy(){const e=this;for(const[n,s]of(t=e.allocationObserverByRecord)===null||t===void 0?void 0:t.entries()){var t;n.isAssignmentModel&&(n.resource.removeObserver(s),e.allocationObserverByRecord.delete(n))}for(const[n,s]of(r=e.allocationReportByRecord)===null||r===void 0?void 0:r.entries()){var r;n.isAssignmentModel&&(n.resource.removeEntity(s),e.allocationReportByRecord.delete(s))}if(e.destroyStores){var i;(i=e.store)===null||i===void 0||i.destroy()}super.onDestroy()}registerAssignmentAllocationReport(e){const t=this,r=t.project.getGraph(),i=t.allocationReportByRecord.get(e.resource);if(i){t.allocationReportByRecord.set(e,i);const n=r.observe(function*(){return yield i.$.allocation},s=>t.onRecordAllocationCalculated(e,s,i));t.allocationObserverByRecord.set(e,n),e.resource.addObserver(n)}return i}onRecordAllocationCalculated(e,t,r){if(e.isAssignmentModel)if(t.byAssignments.get(e))super.onRecordAllocationCalculated(e,t,r);else{this.allocationReportByRecord.delete(e);const i=this.allocationObserverByRecord.get(e);i&&(r.resource.removeObserver(i),this.allocationObserverByRecord.delete(e))}else super.onRecordAllocationCalculated(e,t,r)}onRowManagerRenderRow({row:e,record:t}){var r,i;e.assignCls({"b-resource-row":(r=t.origin)===null||r===void 0?void 0:r.isResourceModel,"b-assignment-row":(i=t.origin)===null||i===void 0?void 0:i.isAssignmentModel})}getResourceGroupParent(e){const t=e.instanceMeta(this.store);return t==null?void 0:t.groupParent}renderResourceHistogram(e){const{project:t}=e.grid;if(t.isInitialCommitPerformed&&!e.record.isSpecialRow)return e.record=e.record.origin,super.renderResourceHistogram(e)}getCell(e){var t,r;return((t=e.record)!==null&&t!==void 0&&t.isResourceModel||(r=e.record)!==null&&r!==void 0&&r.isAssignmentModel)&&(e.record=this.store.getModelByOrigin(e.record)),super.getCell(e)}buildHistogramWidget(e={},...t){return!this.getBarTextRenderData&&!(e!=null&&e.getBarTextRenderData)&&(e.getBarTextRenderData=this.getBarTextRenderDataDefault),e.cls="b-hide-offscreen b-resourceutilization-histogram",e.height=this.rowHeight,super.buildHistogramWidget(e,...t)}getBarTextRenderDataDefault(e,t,r){return e.y="50%",e}getRecordAllocationInfoRenderData(e,t,r,i=null){let n;if(e.isResourceModel?n=t.total:e.isAssignmentModel&&(n=t.byAssignments.get(e)),n)for(let s=0,{length:o}=n;s<o;s++)n[s].effort&&(n[s].height=1);return n}getResourceBarTip(e){const t=this,{showBarTip:r,timeAxis:i}=t;let n="";if(r&&e.effort){const s=t.getBarTipEffortUnit(...arguments),o=t.getEffortText(e.effort,s,!0),a=t.getEffortText(e.maxEffort,s,!0),l=t.L("L{groupBarTipAssignment}");let c="L",d=t.L("L{groupBarTipInRange}"),g="";p.compareUnits(i.unit,C.Day)===0?d=t.L("L{groupBarTipOnDate}"):p.compareUnits(i.unit,C.Second)<=0?c="HH:mm:ss A":p.compareUnits(i.unit,C.Hour)<=0&&(c="LT");let u=[...e.assignmentIntervals.entries()].filter(([v,m])=>m.effort).sort(([v,m],[E,I])=>m.effort>I.effort?-1:1);u.length>t.groupBarTipAssignmentLimit&&(g="<br>"+t.L("L{plusMore}").replace("{value}",u.length-t.groupBarTipAssignmentLimit),u=u.slice(0,this.groupBarTipAssignmentLimit));const h=u.map(([v,m])=>l.replace("{event}",A.encodeHtml(v.event.name)).replace("{allocated}",t.getEffortText(m.effort,s,!0)).replace("{available}",t.getEffortText(m.maxEffort,s,!0)).replace("{cls}",m.isOverallocated?"b-overallocated":m.isUnderallocated?"b-underallocated":"")).join("<br>")+g;n=d.replace("{assignments}",h).replace("{startDate}",p.format(e.tick.startDate,c)).replace("{endDate}",p.format(e.tick.endDate,c)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}getAssignmentBarTip(e){const t=this,{showBarTip:r,timeAxis:i}=t;let n="";if(r&&e.effort){const s=t.getBarTipEffortUnit(...arguments),o=t.getEffortText(e.effort,s,!0),a=t.getEffortText(e.maxEffort,s,!0);let l="L",c=t.L("L{barTipInRange}");p.compareUnits(i.unit,C.Day)===0?c=t.L("L{barTipOnDate}"):p.compareUnits(i.unit,C.Second)<=0?l="HH:mm:ss A":p.compareUnits(i.unit,C.Hour)<=0&&(l="LT"),n=c.replace("{startDate}",p.format(e.tick.startDate,l)).replace("{endDate}",p.format(e.tick.endDate,l)).replace("{allocated}",o).replace("{available}",a).replace("{cls}",e.cls||""),e.assignment&&(n=n.replace("{event}",A.encodeHtml(e.assignment.event.name))),n=`<div class="b-histogram-bar-tooltip">${n}</div>`}return n}};let T=ne;y(T,"$name","ResourceUtilization"),y(T,"type","resourceutilization"),y(T,"configurable",{timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourceutilization-cell",rowHeight:30,showEffortUnit:!1,showMaxEffort:!1,showBarText:!0,barTooltipTemplate({effort:e,isGroup:t,resource:r,assignment:i}){let n="";return e&&(r?n=this.getResourceBarTip(...arguments):i?n=this.getAssignmentBarTip(...arguments):t&&(n=this.getGroupBarTip(...arguments))),n},series:{effort:{type:"bar",field:"effort"}},readOnly:!0,columns:[{type:"tree",field:"name",text:"L{nameColumnText}",localeClass:ne}]}),T.initClass(),T._$name="ResourceUtilization",S.registerFeature(mt,!0,"ResourceUtilization");class re extends L{static get $name(){return"SchedulerPro"}static get type(){return"schedulerpro"}}re.initClass(),re._$name="SchedulerPro";class ie extends pe{static get $name(){return"Timeline"}static get type(){return"timeline"}static get configurable(){return{height:"13em",eventLayout:"pack",barMargin:1,forceFit:!0,timeAxis:{autoAdjust:!1},readOnly:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,rowHeight:48,displayDateFormat:"L",resources:[{id:1}],columns:[]}}static get delayable(){return{fillFromTaskStore:100}}construct(e={}){const t=this;t.startDateLabel=document.createElement("label"),t.startDateLabel.className="b-timeline-startdate",t.endDateLabel=document.createElement("label"),t.endDateLabel.className="b-timeline-enddate";let r=!0;if("project"in e)if(e.project)e.project instanceof oe&&(t.taskStore=e.project.eventStore,e.project.isInitialCommitPerformed||(r=!1,e.project.ion({name:"initialCommit",refresh({isInitialCommit:i}){i&&(t.fillFromTaskStore(),t.detachListeners("initialCommit"))},thisObj:t})),delete e.project);else throw new Error("You need to configure the Timeline with a Project");e.features=fe.assign({cellEdit:!1,cellMenu:!1,columnAutoWidth:!1,columnLines:!1,columnPicker:!1,columnReorder:!1,columnResize:!1,contextMenu:!1,eventContextMenu:!1,eventDrag:!1,eventDragCreate:!1,eventEdit:!1,eventFilter:!1,eventMenu:!1,eventResize:!1,eventTooltip:!1,group:!1,headerMenu:!1,regionResize:!1,scheduleContextMenu:!1,scheduleMenu:!1,scheduleTooltip:!1,sort:!1,timeAxisHeaderMenu:!1,timeRanges:!1},e.features),super.construct(e),t.features.timeRanges&&(t.features.timeRanges.store=new at),r&&t.fillFromTaskStore.now(),t.taskStore.ion({refreshPreCommit:t.fillFromTaskStore,changePreCommit:t.onTaskStoreChange,thisObj:t}),t.ion({resize:t.onSizeChanged,thisObj:t}),t.bodyContainer.appendChild(t.startDateLabel),t.bodyContainer.appendChild(t.endDateLabel)}onSizeChanged({width:e,oldWidth:t}){const r=this,i=e!==t;i&&r.suspendRefresh(),r.updateRowHeight(),i&&(r.resumeRefresh(),r.fitTimeline())}updateRowHeight(){this.bodyContainer.isConnected&&(this.rowHeight=this.bodyContainer.offsetHeight)}fitTimeline(){this.eventStore.count>0&&(this.forceFit=!1,this.zoomToFit({leftMargin:50,rightMargin:50}),this.forceFit=!0),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange({action:e,record:t,records:r,changes:i,isCollapse:n}){const s=this,o=s.eventStore;let a;switch(e){case"add":r.forEach(l=>{l.showInTimeline&&(o.add(s.cloneTask(l)),a=!0)});break;case"remove":n||r.forEach(l=>{l.showInTimeline&&(o.remove(l.id),a=!0)});break;case"removeall":s.fillFromTaskStore.now();break;case"update":{const l=t;if(i.showInTimeline){if(l.showInTimeline)o.add(s.cloneTask(l));else{const c=o.getById(l.id);c&&o.remove(c)}a=!0}else if(l.showInTimeline){const c=o.getById(l.id);c&&(c.set(s.cloneTask(l)),a=!0)}break}}a&&s.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,name:e.name,startDate:e.startDate,endDate:e.endDate,cls:e.cls}}render(){super.render(...arguments),this.updateRowHeight()}async fillFromTaskStore(){const e=this,t=[];e.taskStore.traverse(r=>{r.showInTimeline&&r.isScheduled&&t.push(e.cloneTask(r))}),e.events=t,await e.project.commitAsync(),!e.isDestroyed&&e.fitTimeline()}onLocaleChange(){this.updateStartEndLabels(),super.onLocaleChange()}}ie.initClass(),ie._$name="Timeline";const St=[],Ce={remove:1,add:2,update:3},Ee={TaskModel:1,DependencyModel:2,AssignmentModel:3,ProjectModel:4},be=({parent:f,index:e})=>`${f.name}[${e}]`,Dt={AssignmentModel:"Assignment",DependencyModel:"Dependency"};class Se extends pt{}y(Se,"fields",[{name:"description",type:"string"},{name:"occurredAt",type:"date"},{name:"versionModel"},{name:"transactionModel"},{name:"propertyUpdate"},{name:"action"}]);const R=class extends vt{constructor(){super(...arguments);y(this,"_transactionChanges",[]);y(this,"_versionChanges",[]);y(this,"comparingRowCls",`b-${R.type}-comparing`)}static get properties(){return{_rowsByUnderlyingRecord:new WeakMap,_expandedById:new Map}}construct(t){super.construct({...t,features:fe.merge({},R.configurable.features,t.features)})}afterConstruct(){if(!this.project)throw new Error(`${R.$name} requires the project config.`);this.refreshGrid()}updateDateFormat(t){const r=this.columns.get("occurredAt");r&&(r.format=t)}updateProject(t){const r=this;r.detachListeners("storeChange"),r._versionStore=t.getCrudStore("versions"),r._transactionStore=t.getCrudStore("changelogs"),r._versionStore.ion({name:"storeChange",change:r.onVersionStoreChange,thisObj:r}),r._transactionStore.ion({name:"storeChange",change:r.onTransactionStoreChange,thisObj:r})}updateShowNamedVersionsOnly(){this.isPainted&&this.refreshGrid()}updateShowUnattachedTransactions(){this.isPainted&&this.refreshGrid()}updateShowVersions(){this.isPainted&&this.refreshGrid()}updateComparingVersionId(t,r){const[i,n]=[r,t].map(s=>this.store.getById(`v-${s}`));i&&(i.cls="",i.iconCls="b-icon b-icon-version"),n&&(n.cls=this.comparingRowCls,n.iconCls="b-icon b-icon-compare")}onVersionStoreChange({action:t,records:r}){this._versionChanges.push({action:t,records:r}),this.processUpdates()}onTransactionStoreChange({action:t,records:r}){this._transactionChanges.push({action:t,records:r}),this.processUpdates()}processUpdates(){const t=this,r=b.unique(t._versionChanges.flatMap(({records:s})=>s)),i=new Set(r.map(s=>String(s.id))),n=b.unique(t._transactionChanges.flatMap(({records:s})=>s).concat(r.length===0?[]:t._transactionStore.query(s=>i.has(s.versionId))));for(const s of n)s.versionId&&!i.has(s.versionId)&&(r.push(t._versionStore.getById(s.versionId)),i.add(s.versionId));t.replaceRows(b.unique(r),n),t._transactionChanges=[],t._versionChanges=[]}replaceRows(t,r){var g;const i=this,{showNamedVersionsOnly:n,showUnattachedTransactions:s,store:o}=i,a=new Set,l=b.groupBy(r,"versionId"),c=r.concat(t),d=n?t.filter(u=>u.name!=null):t;for(const u of c)for(const h of(g=i._rowsByUnderlyingRecord.get(u))!=null?g:St)a.add(h);i.suspendRefresh(),o.remove(Array.from(a));for(const u of d){const h=o.add(i.getGridRows(u,l[u.id]));i._rowsByUnderlyingRecord.set(u,h)}if(s)for(const u of r.filter(h=>h.versionId==null)){const h=o.add(i.getGridRows(null,[u]));i._rowsByUnderlyingRecord.set(u,h)}i.resumeRefresh(),o.sort(o.sorters)}refreshGrid(){this.replaceRows(this._versionStore.records,this._transactionStore.records)}getGridRows(t,r){const i=this,{showVersions:n,comparingVersionId:s}=i,o=(r==null?void 0:r.map(l=>{var c;const d=`t-${l.id}`;return{id:d,expanded:!!(!((c=i._expandedById)===null||c===void 0)&&c.get(d)),description:l.description,occurredAt:l.occurredAt,transactionModel:l,rootVersionModel:t,children:l.actions.map((g,u)=>{var E;var h,v;const m=`a-${l.id}-${u}`;return{id:m,expanded:!!(!((h=i._expandedById)===null||h===void 0)&&h.get(m)),action:g,rootVersionModel:t,children:(E=(v=g.propertyUpdates)===null||v===void 0?void 0:v.map(I=>({rootVersionModel:t,propertyUpdate:I})))!=null?E:[]}})}}))||[],a=`v-${t==null?void 0:t.id}`;return t&&n?{id:a,expanded:!!i._expandedById.get(a),description:t.description,occurredAt:t.savedAt,children:o,versionModel:t,iconCls:"b-icon-version",cls:t.id===s?i.comparingRowCls:null}:o}renderDescription(t){const{record:r}=t;return r.propertyUpdate?this.renderPropertyUpdate(r.propertyUpdate):r.action?this.renderActionDescription(r.action):r.description}renderPropertyUpdate(t){const r=R.type,{property:i,before:n,after:s}=t;return{children:[{tag:"div",class:`b-${r}-property-update-desc`,children:[{tag:"span",class:`b-${r}-property-name`,html:`${this.formatPropertyName(i)}`},this.renderPropertyValue(n,"before"),{tag:"i",class:"b-icon b-icon-right"},this.renderPropertyValue(s,"after")]}]}}renderPropertyValue(t,r){var i;return{tag:"span",class:[`b-${R.type}-property-${r}`,t==null&&`b-${R.type}-empty-value`],html:t==null?this.L("L{Versions.nullValue}"):(i=this.formatValueString(t))!=null?i:""}}formatValueString(t){return p.isDate(t)?p.format(t,this.dateFormat):typeof t=="number"?t.toFixed(2):t}formatPropertyName(t){return A.separate(t)}getAssignmentTextTokens(t){return{event:t.event.name,resource:t.resource.name}}getDependencyTextTokens(t){return{from:t.fromTask.name,to:t.toTask.name}}renderActionDescription(t){var l;const r=this,{actionType:i,entity:n}=t,s=r.L("L{Versions.entityNames}");let o,a={type:s[n.type],name:n.name};return i==="move"&&(a.from=be(t.from),a.to=be(t.to)),o=r.L(`L{Versions.${i}${(l=Dt[n.type])!=null?l:"Entity"}}`),n.type==="DependencyModel"?a=r.getDependencyTextTokens(n):n.type==="AssignmentModel"&&(a=r.getAssignmentTextTokens(n)),o=o.replace(/\{(\w+)\}/g,(c,d)=>{var g;return(g=a[d])!=null?g:d}),t.isUser&&(o=`[!] ${o}`),r.renderHighlightedTextElements(A.capitalize(o),a)}static sortActionRows(t,r){if(t.parent===r.parent&&t.action&&r.action){const i=!!t.action.isUser,n=!!r.action.isUser,{actionType:s,entity:{type:o}}=t.action,{actionType:a,entity:{type:l}}=r.action;return i!==n?i?-1:1:Math.sign(Ce[s]-Ce[a])||Math.sign(Ee[o]-Ee[l])||0}return 0}triggerRestore(t){this.trigger("restore",{version:t})}triggerCompare(t){this.trigger("compare",{version:t})}triggerStopCompare(t){this.trigger("stopCompare")}renderHighlightedTextElements(t){const r=this.constructor.type;return{children:[{tag:"span",class:`b-${r}-highlighted-text`,children:t.split(/\*\*/g).reduce((i,n)=>(i.children.push({tag:"span",text:n,class:i.isEntity?`b-${r}-highlighted-entity`:null}),i.isEntity=!i.isEntity,i),{children:[],isEntity:!1}).children}]}}};let D=R;y(D,"$name","VersionGrid"),y(D,"type","versiongrid"),y(D,"configurable",{store:{tree:!0,modelClass:Se,sorters:[{field:"occurredAt",ascending:!1},R.sortActionRows],reapplySortersOnAdd:!0},project:null,showUnattachedTransactions:!0,showNamedVersionsOnly:!1,showVersions:!0,comparingVersionId:null,flex:0,features:{group:{field:"id"},cellEdit:{continueEditingOnCellClick:!1,editNextOnEnterPress:!1},cellMenu:{items:{removeRow:!1,cut:!1,copy:!1,paste:!1,renameButton:{text:"L{VersionGrid.rename}",icon:"b-icon b-icon-edit",onItem:({record:t,source:r})=>{r.startEditing({id:t.id,column:r.columns.get("description")})}},restoreButton:{text:"L{VersionGrid.restore}",icon:"b-icon b-icon-undo",onItem:({record:t,source:r})=>{r.triggerRestore(t.versionModel)}},compareButton:{text:"L{VersionGrid.compare}",icon:"b-icon b-icon-compare",onItem:({record:t,source:r})=>{r.triggerCompare(t.versionModel)}},stopComparingButton:{text:"L{VersionGrid.stopComparing}",onItem:({record:t,source:r})=>{r.triggerStopCompare()}}}},rowCopyPaste:!1},columns:[{type:"tree",text:"L{VersionGrid.description}",field:"description",flex:4,groupable:!1,renderer:({grid:t,...r})=>t.renderDescription({grid:t,...r}),autoHeight:!0},{text:"L{VersionGrid.occurredAt}",field:"occurredAt",type:"date",flex:1,groupable:!1}],dateFormat:"M/D/YY h:mm a",internalListeners:{beforeCellEditStart({editorContext:{column:t,record:r}}){if(!(t.field==="description"&&r.versionModel))return!1},finishCellEdit({editorContext:{record:t,value:r}}){t.versionModel.name=r!=null&&r.trim()?r:null},cellMenuBeforeShow({source:t,record:r,items:i}){return i.stopComparingButton.disabled=!t.comparingVersionId,!!r.versionModel},toggleNode({record:t,collapse:r}){this._expandedById.set(t.id,!r)}}}),y(D,"delayable",{processUpdates:{type:"raf",cancelOutstanding:!0}}),D.initClass(),D._$name="VersionGrid";export{$a as AbstractPartOfProjectStoreMixin,Zt as AdvancedTab,Kt as AssignmentAllocationInterval,Jt as AssignmentModel,er as AssignmentStore,tr as BaseAllocationInfo,rr as BaseAllocationInterval,ir as BaseAssignmentMixin,nr as BaseCalendarMixin,sr as BaseDependencyMixin,or as BaseDependencyResolution,ar as BaseEmptyCalendarEffectResolution,lr as BaseEventMixin,cr as BaseHasAssignmentsMixin,dr as BaseResourceMixin,ur as BreakCurrentStackExecution,gr as CalculateProposed,hr as CalculatedValueGen,fr as CalculatedValueGenC,mr as CalculatedValueSync,pr as CalculatedValueSyncC,vr as CalculationGen,yr as CalculationSync,Cr as CalendarField,q as CalendarHighlight,Er as CalendarIntervalModel,br as CalendarManagerStore,Sr as CalendarModel,Dr as CanCombineCalendarsMixin,Rr as ChangeLogAction,Tr as ChangeLogAssignmentEntity,xr as ChangeLogDependencyEntity,Pr as ChangeLogEntity,Z as ChangeLogPropertyUpdate,Mr as ChangeLogStore,wr as ChangeLogTransactionModel,Ar as ChronoAbstractProjectMixin,Br as ChronoAssignmentStoreMixin,Ir as ChronoCalendarManagerStoreMixin,Or as ChronoDependencyStoreMixin,kr as ChronoEventStoreMixin,Hr as ChronoEventTreeStoreMixin,Lr as ChronoField,jr as ChronoGraph,Ur as ChronoModelFieldIdentifier,Fr as ChronoModelMixin,_r as ChronoModelReferenceBucketFieldIdentifier,Vr as ChronoModelReferenceFieldIdentifier,Wr as ChronoModelReferenceFieldQuark,$r as ChronoPartOfProjectGenericMixin,Gr as ChronoPartOfProjectModelMixin,zr as ChronoPartOfProjectStoreMixin,Nr as ChronoResourceStoreMixin,qr as ChronoStoreMixin,Yr as ChronoTransaction,Qr as CommitZero,Xr as ComputationCycle,Zr as ConflictEffect,Kr as ConflictEffectDescription,Jr as ConflictResolution,ei as ConflictSymbol,ti as ConstrainedEarlyEventMixin,ri as ConstraintInterval,ii as ConstraintIntervalDescription,ni as ConstraintTypePicker,si as ContextGen,oi as ContextSync,ai as CycleDescription,li as CycleEffect,ci as CycleEffectDescription,di as CycleResolution,ui as CycleResolutionInput,gi as CycleResolutionInputChrono,hi as CycleResolutionPopup,fi as CycleSymbol,mi as DateConstraintInterval,pi as DateConstraintIntervalDescription,vi as DateInterval,yi as DeactivateDependencyCycleEffectResolution,Ci as DeactivateDependencyResolution,Ei as DependencyConstraintInterval,bi as DependencyConstraintIntervalDescription,Y as DependencyEdit,Si as DependencyModel,Di as DependencyStore,Ri as DependencyTab,Ti as DependencyTypePicker,xi as DurationConverterMixin,Pi as DurationVar,Mi as EMPTY_INTERVAL,wi as EarlyLateLazyness,Ai as EdgeType,Bi as EdgeTypeNormal,Ii as EdgeTypePast,Oi as EditorTab,ki as Effect,Hi as EffectResolutionResult,Li as EffortField,ji as EffortVar,Ui as EmptyCalendarEffect,Fi as EmptyCalendarEffectDescription,_i as EmptyCalendarSymbol,Vi as EndDateField,Wi as EndDateVar,$i as EngineReplica,Gi as EngineRevision,zi as EngineTransaction,Ni as Entity,qi as EntityIdentifier,Yi as EntityMeta,Q as EventBuffer,Qi as EventLoader,k as EventModel,Xi as EventResize,H as EventSegmentDrag,Zi as EventSegmentModel,Ki as EventSegmentResize,Ji as EventSegments,F as EventStore,en as EventUpdateAction,tn as FieldIdentifier,rn as FixedDurationMixin,nn as FormTab,sn as Formula,on as FormulasCache,an as GanttTaskEditor,ln as GeneralTab,cn as GetTransaction,dn as HasCalendarMixin,un as HasChildrenMixin,gn as HasDateConstraintMixin,hn as HasDependenciesMixin,fn as HasEffortMixin,mn as HasPercentDoneMixin,pn as HasProposedNotPreviousValue,vn as HasProposedNotPreviousValueEffect,yn as HasProposedNotPreviousValueSymbol,Cn as HasProposedValue,En as HasProposedValueEffect,bn as HasProposedValueSymbol,Sn as HasSchedulingModeMixin,Dn as HasSubEventsMixin,Rn as Identifier,Tn as IdentifierC,xn as Instruction,Pn as IsChronoModelSymbol,Mn as Levels,wn as Listener,An as Meta,Bn as MinimalChronoModelFieldIdentifierGen,In as MinimalChronoModelFieldIdentifierSync,On as MinimalChronoModelFieldVariable,kn as MinimalEntityIdentifier,Hn as MinimalFieldIdentifierGen,Ln as MinimalFieldIdentifierSync,jn as MinimalFieldVariable,Un as MinimalReferenceBucketIdentifier,Fn as MinimalReferenceBucketQuark,_n as MinimalReferenceIdentifier,Vn as ModelBucketField,Wn as ModelCombo,$n as ModelField,Gn as ModelReferenceField,zn as NOT_VISITED,x as NestedEvents,Nn as NotesTab,qn as OnCycleAction,Yn as OwnIdentifier,Qn as OwnIdentifierSymbol,Xn as OwnQuark,Zn as OwnQuarkSymbol,Kn as PartOfProject,Jn as PercentBar,es as PercentDoneMixin,ts as PredecessorsTab,rs as PreviousValueOf,is as PreviousValueOfEffect,ns as PreviousValueOfSymbol,G as ProHorizontalLayout,N as ProHorizontalLayoutPack,z as ProHorizontalLayoutStack,ss as ProjectChangeHandlerMixin,os as ProjectCrudManager,K as ProjectModel,as as ProjectProgressMixin,ls as ProjectWebSocketHandlerMixin,cs as ProposedArgumentsOf,ds as ProposedArgumentsOfEffect,us as ProposedArgumentsOfSymbol,gs as ProposedOrPrevious,hs as ProposedOrPreviousSymbol,fs as ProposedOrPreviousValueOf,ms as ProposedOrPreviousValueOfEffect,ps as ProposedOrPreviousValueOfSymbol,vs as ProposedValueOf,ys as ProposedValueOfEffect,Cs as ProposedValueOfSymbol,Es as Quark,bs as QuarkGen,Ss as QuarkSync,Ds as ReadMode,Rs as ReadyStatePropagator,Ts as RecurrenceTab,xs as ReferenceBucketField,Ps as ReferenceBucketIdentifier,Ms as ReferenceBucketQuark,ws as ReferenceField,As as ReferenceIdentifier,Bs as Reject,Is as RejectEffect,Os as RejectSymbol,ks as RemoveDateConstraintConflictResolution,Hs as RemoveDependencyCycleEffectResolution,Ls as RemoveDependencyResolution,js as Replica,Us as ResourceAllocationEventRangeCalendar,Fs as ResourceAllocationEventRangeCalendarIntervalMixin,_s as ResourceAllocationEventRangeCalendarIntervalStore,Vs as ResourceAllocationInfo,Ws as ResourceAllocationInterval,W as ResourceCalendarColumn,P as ResourceHistogram,$s as ResourceModel,B as ResourceNonWorkingTime,Gs as ResourceStore,T as ResourceUtilization,zs as ResourcesTab,Ns as Revision,qs as SEDBackwardCycleResolutionContext,Ys as SEDDispatcher,Qs as SEDDispatcherIdentifier,Xs as SEDForwardCycleResolutionContext,Zs as SEDGraphDescription,Ks as SEDWUDispatcher,Js as SEDWUDispatcherIdentifier,$ as ScaleColumn,eo as ScheduledByDependenciesEarlyEventMixin,to as SchedulerAdvancedTab,ro as SchedulerBasicEvent,io as SchedulerBasicProjectMixin,no as SchedulerGeneralTab,re as SchedulerPro,so as SchedulerProAssignmentMixin,L as SchedulerProBase,oo as SchedulerProCycleEffect,ao as SchedulerProDependencyMixin,lo as SchedulerProEvent,ye as SchedulerProEventRendering,co as SchedulerProHasAssignmentsMixin,uo as SchedulerProProjectMixin,go as SchedulerProResourceMixin,ho as SchedulerTaskEditor,fo as SchedulingIssueEffectResolution,mo as SchedulingIssueResolution,po as SchedulingIssueResolutionPopup,vo as SchedulingModePicker,yo as Schema,Co as StartDateField,Eo as StartDateVar,bo as StateTrackingManager,So as SuccessorsTab,Do as SynchronousCalculationStarted,Ro as TaskEdit,To as TaskEditorBase,X as TimeSpanHighlight,ie as Timeline,xo as TombStone,Po as TransactionCycleDetectionWalkContext,Mo as TransactionSymbol,wo as TransactionWalkDepth,Ao as UnitsVar,Bo as UnsafePreviousValueOf,Io as UnsafePreviousValueOfEffect,Oo as UnsafePreviousValueOfSymbol,ko as UnsafeProposedOrPreviousValueOf,Ho as UnsafeProposedOrPreviousValueOfEffect,Lo as UnsafeProposedOrPreviousValueOfSymbol,jo as Use24hrsEmptyCalendarEffectResolution,Uo as Use8hrsEmptyCalendarEffectResolution,Fo as VISITED_TOPOLOGICALLY,_o as Variable,Vo as VariableC,Wo as VariableInputState,$o as VariableWalkContext,D as VersionGrid,Go as VersionModel,zo as VersionStore,No as Versions,qo as WalkContext,Yo as WalkSource,Qo as WalkState,Xo as Write,Zo as WriteEffect,Ko as WriteSeveral,Jo as WriteSeveralEffect,ea as WriteSeveralSymbol,ta as WriteSymbol,ra as bucket,ia as build_proposed,na as calculate,sa as calculateEffectiveEndDateConstraintInterval,oa as calculateEffectiveStartDateConstraintInterval,aa as createEntityOnPrototype,la as cycleInfo,ca as dateConverter,da as durationFormula,ua as effortFormula,ga as endDateByEffortFormula,ha as endDateFormula,fa as ensureEntityOnPrototype,ma as entity,pa as entityDecoratorBody,va as field,ya as fixedDurationAndEffortSEDWUGraphDescription,Ca as fixedDurationSEDWUBackwardEffortDriven,Ea as fixedDurationSEDWUBackwardNonEffortDriven,ba as fixedDurationSEDWUForwardEffortDriven,Sa as fixedDurationSEDWUForwardNonEffortDriven,Da as fixedDurationSEDWUGraphDescription,Ra as generic_field,Ta as getDecoratedModelFields,xa as injectStaticFieldsProperty,Pa as intersectIntervals,Ma as isAtomicValue,wa as isSerializableEqual,Aa as model_field,Ba as prototypeValue,Ia as reference,Oa as required,ka as runGeneratorAsyncWithEffect,Ha as runGeneratorSyncWithEffect,La as startDateByEffortFormula,ja as startDateFormula,Ua as throwUnknownIdentifier,Fa as unitsFormula,_a as validateRequiredProperties,Va as write};
//# sourceMappingURL=schedulerpro.module.thin.js.map
