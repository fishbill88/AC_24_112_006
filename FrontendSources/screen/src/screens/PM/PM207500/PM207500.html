<template>
	<qp-template name="1-2" class="equal-height" id="Allocations_form" wg-container>
		<qp-fieldset slot="A" id="form" view.bind="Allocations">
			<field name="AllocationID"></field>
			<field name="Description" config-rows.bind="3"></field>
		</qp-fieldset>
	</qp-template>
	<qp-template name="1-2" id="AllocationRulesForm">
		<div slot="A" id="AllocationRulesGrid">
			<qp-grid id="Steps_grid" wg-container view.bind="Steps" class="framed-section">
			</qp-grid>
		</div>
		<div slot="B" id="AllocationRulesTab">
			<qp-tabbar id="tab">
				<qp-tab id="CalculationRulesTab" caption="Calculation Rules" wg-container="StepRules_formRules">
					<qp-template name="1-1" id="MethodAndPostForm">
						<qp-fieldset slot="A" id="MethodAndPostFieldset" view.bind="StepRules">
							<field name="Method" ></field>
							<field name="Post" ></field>
						</qp-fieldset>
					</qp-template>

					<qp-template name="1" id="SelectionCriteriaForm">
						<qp-fieldset slot="A" id="SelectionCriteriaFieldset" view.bind="StepRules" caption="Selection Criteria">
							<field name="SelectOption" >
								<qp-field control-state.bind="StepRules.SourceBranchID" class="label-size-m col-sm-12 col-md-12 col-lg-8"></qp-field>
							</field>
						</qp-fieldset>
					</qp-template>

					<qp-template name="1-1" id="AccountGroupAndRangeForm">
						<qp-fieldset slot="A" id="AccountGroupFieldset" view.bind="StepRules">
							<field name="AccountGroupFrom"></field>
							<field name="AccountGroupTo"></field>
						</qp-fieldset>
						<qp-fieldset slot="B" id="RangeFieldset" view.bind="StepRules">
							<field name="RangeStart"></field>
							<field name="RangeEnd"></field>
						</qp-fieldset>
					</qp-template>

					<qp-template name="1" id="RateSettingsForm">
						<qp-fieldset slot="A" id="RateSettingsFieldset" view.bind="StepRules" caption="Rate Settings">
							<field name="RateTypeID">
								<qp-field control-state.bind="StepRules.NoRateOption" class="label-size-m col-sm-12 col-md-12 col-lg-8"></qp-field>
							</field>
						</qp-fieldset>
					</qp-template>

					<qp-template name="1" id="CalculationSettingsForm">
						<qp-fieldset slot="A" id="CalculationSettingsFieldset" view.bind="StepRules" caption="Calculation Settings">
							<field name="StepRules.QtyFormula"
								control-type="qp-formula-editor"
								config-parameters.bind="true"
								config-application-functions.bind="['ConvertAmountToCurrency(fromCuryID, toCuryID, rateType, effectiveDate, value)']"
								config-application-functions-append.bind="true"
								config-dynamic-fields.bind="['PMAccountGroup', 'PMBudget', 'PMProject', 'PMTask', 'PMTran', 'Customer', 'EPEmployee', 'InventoryItem', 'Vendor']"
								config-dynamic-node-name.bind="'Objects'"
								config-preload-dynamic-node.bind="true">
							</field>
							<field name="StepRules.BillableQtyFormula"
								control-type="qp-formula-editor"
								config-parameters.bind="true"
								config-application-functions.bind="['ConvertAmountToCurrency(fromCuryID, toCuryID, rateType, effectiveDate, value)']"
								config-application-functions-append.bind="true"
								config-dynamic-fields.bind="['PMAccountGroup', 'PMBudget', 'PMProject', 'PMTask', 'PMTran', 'Customer', 'EPEmployee', 'InventoryItem', 'Vendor']"
								config-dynamic-node-name.bind="'Objects'"
								config-preload-dynamic-node.bind="true">
							</field>
							<field name="StepRules.AmountFormula"
								control-type="qp-formula-editor"
								config-parameters.bind="true"
								config-application-functions.bind="['ConvertAmountToCurrency(fromCuryID, toCuryID, rateType, effectiveDate, value)']"
								config-application-functions-append.bind="true"
								config-dynamic-fields.bind="['PMAccountGroup', 'PMBudget', 'PMProject', 'PMTask', 'PMTran', 'Customer', 'EPEmployee', 'InventoryItem', 'Vendor']"
								config-dynamic-node-name.bind="'Objects'"
								config-preload-dynamic-node.bind="true">
							</field>
							<field name="StepRules.DescriptionFormula"
								control-type="qp-formula-editor"
								config-parameters.bind="true"
								config-application-functions.bind="['ConvertAmountToCurrency(fromCuryID, toCuryID, rateType, effectiveDate, value)']"
								config-application-functions-append.bind="true"
								config-dynamic-fields.bind="['PMAccountGroup', 'PMBudget', 'PMProject', 'PMTask', 'PMTran', 'Customer', 'EPEmployee', 'InventoryItem', 'Vendor']"
								config-dynamic-node-name.bind="'Objects'"
								config-preload-dynamic-node.bind="true">
							</field>
						</qp-fieldset>
					</qp-template>
				</qp-tab>

				<qp-tab id="AllocationSettingsTab" caption="Allocation Settings" wg-container="StepSettings_formSettings">
					<qp-template name="1-1" id="DateSourceForm">
						<qp-fieldset slot="A" id="DateSourceFieldset" view.bind="StepSettings" caption="Transaction Options">
							<field name="DateSource"></field>
						</qp-fieldset>
					</qp-template>

					<qp-template name="1-1" id="TransactionOptionsForm" class="equal-height no-label">
						<qp-fieldset slot="A" id="TransactionOptionsFieldset01" view.bind="StepSettings">
							<field name="UpdateGL"></field>
							<field name="MarkAsNotAllocated"></field>
						</qp-fieldset>
						<qp-fieldset slot="B" id="TransactionOptionsFieldset02" view.bind="StepSettings">
							<field name="AllocateZeroQty"></field>
							<field name="AllocateZeroAmount"></field>
							<field name="AllocateNonBillable"></field>
						</qp-fieldset>
					</qp-template>

					<qp-template name="1" id="TransactionBranchAndReversalForm">
						<div slot="A">
							<qp-fieldset id="TransactionBranchFieldset" view.bind="StepSettings" caption="Transaction Branch">
								<field name="OffsetBranchOrigin" >
									<qp-field control-state.bind="StepSettings.TargetBranchID" ></qp-field>
								</field>
							</qp-fieldset>
							<qp-fieldset id="TransactionReversalFieldset" view.bind="StepSettings" caption="Transaction Reversal">
								<field name="Reverse">
									<qp-field control-state.bind="StepSettings.UseReversalDateFromOriginal"></qp-field>
								</field>
							</qp-fieldset>
						</div>
					</qp-template>

					<qp-template name="1" id="DebitAndCreditTransactionsForm">
						<div slot="A">
							<qp-fieldset id="DebitTransactionFieldset" view.bind="StepSettings" caption="Debit Transaction">
								<field name="ProjectOrigin">
									<qp-field control-state.bind="StepSettings.ProjectID"></qp-field>
								</field>
								<field name="TaskOrigin">
									<qp-field control-state.bind="StepSettings.TaskID"></qp-field>
									<qp-field control-state.bind="StepSettings.TaskCD"></qp-field>
								</field>
								<field name="AccountGroupOrigin">
									<qp-field control-state.bind="StepSettings.AccountGroupID"></qp-field>
								</field>
								<field name="AccountOrigin">
									<qp-field control-state.bind="StepSettings.AccountID"></qp-field>
								</field>
								<field name="SubMask">
									<qp-field control-state.bind="StepSettings.SubID"></qp-field>
								</field>
							</qp-fieldset>
							<qp-fieldset id="CreditTransactionFieldset" view.bind="StepSettings" caption="Credit Transaction">
								<field name="OffsetProjectOrigin">
									<qp-field control-state.bind="StepSettings.OffsetProjectID"></qp-field>
								</field>
								<field name="OffsetTaskOrigin">
									<qp-field control-state.bind="StepSettings.OffsetTaskID"></qp-field>
									<qp-field control-state.bind="StepSettings.OffsetTaskCD"></qp-field>
								</field>
								<field name="OffsetAccountGroupOrigin">
									<qp-field control-state.bind="StepSettings.OffsetAccountGroupID"></qp-field>
								</field>
								<field name="OffsetAccountOrigin">
									<qp-field control-state.bind="StepSettings.OffsetAccountID"></qp-field>
								</field>
								<field name="OffsetSubMask">
									<qp-field control-state.bind="StepSettings.OffsetSubID"></qp-field>
								</field>
							</qp-fieldset>
						</div>
					</qp-template>

					<qp-template name="1" id="AggregateTransactionsForm">
						<qp-fieldset slot="A" id="AggregateTransactionsFieldset" view.bind="StepSettings" caption="Aggregate Transactions">
							<field name="AggregateTransactionsByFields" unbound>
								<qp-field control-state.bind="StepSettings.GroupByDate" class="col-sm-12 col-md-6 col-lg-3">
								</qp-field>
								<qp-field control-state.bind="StepSettings.GroupByEmployee" class="col-sm-12 col-md-6 col-lg-3">
								</qp-field>
								<qp-field control-state.bind="StepSettings.GroupByVendor" class="col-sm-12 col-md-6 col-lg-3">
								</qp-field>
								<qp-field control-state.bind="StepSettings.GroupByItem" class="col-sm-12 col-md-6 col-lg-3">
								</qp-field>
							</field>
						</qp-fieldset>
					</qp-template>
				</qp-tab>
			</qp-tabbar>
		</div>
	</qp-template>
</template>
